var t,e=Object.defineProperty,s=Object.defineProperties,i=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=Math.pow,h=(t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,l=(t,e)=>{for(var s in e||(e={}))r.call(e,s)&&h(t,s,e[s]);if(n)for(var s of n(e))a.call(e,s)&&h(t,s,e[s]);return t},c=(t,e)=>s(t,i(e)),u=(t,e)=>{var s={};for(var i in t)r.call(t,i)&&e.indexOf(i)<0&&(s[i]=t[i]);if(null!=t&&n)for(var i of n(t))e.indexOf(i)<0&&a.call(t,i)&&(s[i]=t[i]);return s},d=(t,e,s)=>(h(t,"symbol"!=typeof e?e+"":e,s),s),p=(t,e,s)=>new Promise(((i,n)=>{var r=t=>{try{o(s.next(t))}catch(Zf){n(Zf)}},a=t=>{try{o(s.throw(t))}catch(Zf){n(Zf)}},o=t=>t.done?i(t.value):Promise.resolve(t.value).then(r,a);o((s=s.apply(t,e)).next())}));import{i as f,w as m}from"./index-d3b10cbf.js";var g="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function y(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var x={};!function(t){var e=Object.prototype.hasOwnProperty,s="~";function i(){}function n(t,e,s){this.fn=t,this.context=e,this.once=s||!1}function r(t,e,i,r,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var o=new n(i,r||t,a),h=s?s+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],o]:t._events[h].push(o):(t._events[h]=o,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(s=!1)),o.prototype.eventNames=function(){var t,i,n=[];if(0===this._eventsCount)return n;for(i in t=this._events)e.call(t,i)&&n.push(s?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},o.prototype.listeners=function(t){var e=s?s+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,r=i.length,a=new Array(r);n<r;n++)a[n]=i[n].fn;return a},o.prototype.listenerCount=function(t){var e=s?s+t:t,i=this._events[e];return i?i.fn?1:i.length:0},o.prototype.emit=function(t,e,i,n,r,a){var o=s?s+t:t;if(!this._events[o])return!1;var h,l,c=this._events[o],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,i),!0;case 4:return c.fn.call(c.context,e,i,n),!0;case 5:return c.fn.call(c.context,e,i,n,r),!0;case 6:return c.fn.call(c.context,e,i,n,r,a),!0}for(l=1,h=new Array(u-1);l<u;l++)h[l-1]=arguments[l];c.fn.apply(c.context,h)}else{var d,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),u){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,i);break;case 4:c[l].fn.call(c[l].context,e,i,n);break;default:if(!h)for(d=1,h=new Array(u-1);d<u;d++)h[d-1]=arguments[d];c[l].fn.apply(c[l].context,h)}}return!0},o.prototype.on=function(t,e,s){return r(this,t,e,s,!1)},o.prototype.once=function(t,e,s){return r(this,t,e,s,!0)},o.prototype.removeListener=function(t,e,i,n){var r=s?s+t:t;if(!this._events[r])return this;if(!e)return a(this,r),this;var o=this._events[r];if(o.fn)o.fn!==e||n&&!o.once||i&&o.context!==i||a(this,r);else{for(var h=0,l=[],c=o.length;h<c;h++)(o[h].fn!==e||n&&!o[h].once||i&&o[h].context!==i)&&l.push(o[h]);l.length?this._events[r]=1===l.length?l[0]:l:a(this,r)}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=s?s+t:t,this._events[e]&&a(this,e)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=s,o.EventEmitter=o,t.exports=o}({get exports(){return x},set exports(t){x=t}});class v extends x{constructor(){super(...arguments),d(this,"_realCredits",0),d(this,"_credits",0),d(this,"_backupCredits",0),d(this,"_betList",[]),d(this,"_betIndex",0),d(this,"_lastBetIndex",0),d(this,"_betColor",0),d(this,"defaultBet",0),d(this,"cheatRND"),d(this,"_nAutoplays",0),d(this,"testAutoplay")}get realCredits(){return this._realCredits}set realCredits(t){this._backupCredits=this._realCredits,this._realCredits=t}get credits(){return this._credits}set credits(t){t=Math.round(t),this._credits=t,this.emit("credit",t)}syncCredits(){this.credits=this.realCredits}restore(){this._realCredits=this._backupCredits}get totalBet(){return this._betList[this._betIndex]}get betListNum(){return this._betList.length}get betIndex(){return this._betIndex}get maxIndex(){return this._betList.length-1}get lastBetIndex(){return this._lastBetIndex}get betColor(){return this._betColor}isMinBet(){return 0==this._betIndex}isMaxBet(){return this._betIndex==this._betList.length-1}getBetAtId(t){if(t<0||t>=this.betListNum)throw new Error("Bet Index out of range!");return this._betList[t]}setBetAtId(t){if(t<0||t>=this.betListNum)throw new Error("Bet Index out of range!");this._lastBetIndex=this._betIndex,this._betIndex=t,this.emit("bet",t,this._betList[t])}setBetAtValue(t){if(!this._betList.includes(t))return void console.log("Invalid Bet Value");const e=this._betList.indexOf(t);this.setBetAtId(e)}addBetByValue(t){if(!this._betList.includes(t))return void console.log("Invalid Bet Value");const e=this._betList.indexOf(t)+this._betIndex;e>this.maxIndex?this.setBetAtId(this.maxIndex):this.setBetAtId(e)}setBetColor(t){if(t<=0||t>6)throw new Error("Bet Color Value out of range!");this._betColor=t}setBetList(t,e,s){if(Array.isArray(t))this._betList=t;else{this._betList.clear();for(let i=e;i<=s;i+=t)this._betList.push(i)}}setDefaultBet(){let t=this._betList.indexOf(this.defaultBet);t=Math.max(0,t),this.setBetAtId(t),this._lastBetIndex=t}get nAutoPlays(){return this._nAutoplays}set nAutoPlays(t){t<0&&(t=0);let e=this._nAutoplays;void 0===this.testAutoplay||this.testAutoplay(t,e)||(t=0),t!=e&&(this._nAutoplays=t,this.emit("autoplay",t,e))}}const _={Bg:"background"},b={Click:"buttonclick",CoinIncrement:"coinincrement",Hint:"hint"};var w={},E={get exports(){return w},set exports(t){w=t}},S={},T={},A={},C={},M={},I={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.regexpCode=t.getEsmExportName=t.getProperty=t.safeStringify=t.stringify=t.strConcat=t.addCodeArg=t.str=t._=t.nil=t._Code=t.Name=t.IDENTIFIER=t._CodeOrName=void 0;class e{}t._CodeOrName=e,t.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class s extends e{constructor(e){if(super(),!t.IDENTIFIER.test(e))throw new Error("CodeGen: name must be a valid identifier");this.str=e}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}t.Name=s;class i extends e{constructor(t){super(),this._items="string"==typeof t?[t]:t}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const t=this._items[0];return""===t||'""'===t}get str(){var t;return null!==(t=this._str)&&void 0!==t?t:this._str=this._items.reduce(((t,e)=>`${t}${e}`),"")}get names(){var t;return null!==(t=this._names)&&void 0!==t?t:this._names=this._items.reduce(((t,e)=>(e instanceof s&&(t[e.str]=(t[e.str]||0)+1),t)),{})}}function n(t,...e){const s=[t[0]];let n=0;for(;n<e.length;)o(s,e[n]),s.push(t[++n]);return new i(s)}t._Code=i,t.nil=new i(""),t._=n;const r=new i("+");function a(t,...e){const s=[l(t[0])];let n=0;for(;n<e.length;)s.push(r),o(s,e[n]),s.push(r,l(t[++n]));return function(t){let e=1;for(;e<t.length-1;){if(t[e]===r){const s=h(t[e-1],t[e+1]);if(void 0!==s){t.splice(e-1,3,s);continue}t[e++]="+"}e++}}(s),new i(s)}function o(t,e){var n;e instanceof i?t.push(...e._items):e instanceof s?t.push(e):t.push("number"==typeof(n=e)||"boolean"==typeof n||null===n?n:l(Array.isArray(n)?n.join(","):n))}function h(t,e){if('""'===e)return t;if('""'===t)return e;if("string"==typeof t){if(e instanceof s||'"'!==t[t.length-1])return;return"string"!=typeof e?`${t.slice(0,-1)}${e}"`:'"'===e[0]?t.slice(0,-1)+e.slice(1):void 0}return"string"!=typeof e||'"'!==e[0]||t instanceof s?void 0:`"${t}${e.slice(1)}`}function l(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}t.str=a,t.addCodeArg=o,t.strConcat=function(t,e){return e.emptyStr()?t:t.emptyStr()?e:a`${t}${e}`},t.stringify=function(t){return new i(l(t))},t.safeStringify=l,t.getProperty=function(e){return"string"==typeof e&&t.IDENTIFIER.test(e)?new i(`.${e}`):n`[${e}]`},t.getEsmExportName=function(e){if("string"==typeof e&&t.IDENTIFIER.test(e))return new i(`${e}`);throw new Error(`CodeGen: invalid export name: ${e}, use explicit $id name mapping`)},t.regexpCode=function(t){return new i(t.toString())}}(I);var P={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ValueScope=t.ValueScopeName=t.Scope=t.varKinds=t.UsedValueState=void 0;const e=I;class s extends Error{constructor(t){super(`CodeGen: "code" for ${t} not defined`),this.value=t.value}}var i,n;(n=i=t.UsedValueState||(t.UsedValueState={}))[n.Started=0]="Started",n[n.Completed=1]="Completed",t.varKinds={const:new e.Name("const"),let:new e.Name("let"),var:new e.Name("var")};class r{constructor({prefixes:t,parent:e}={}){this._names={},this._prefixes=t,this._parent=e}toName(t){return t instanceof e.Name?t:this.name(t)}name(t){return new e.Name(this._newName(t))}_newName(t){return`${t}${(this._names[t]||this._nameGroup(t)).index++}`}_nameGroup(t){var e,s;if((null===(s=null===(e=this._parent)||void 0===e?void 0:e._prefixes)||void 0===s?void 0:s.has(t))||this._prefixes&&!this._prefixes.has(t))throw new Error(`CodeGen: prefix "${t}" is not allowed in this scope`);return this._names[t]={prefix:t,index:0}}}t.Scope=r;class a extends e.Name{constructor(t,e){super(e),this.prefix=t}setValue(t,{property:s,itemIndex:i}){this.value=t,this.scopePath=e._`.${new e.Name(s)}[${i}]`}}t.ValueScopeName=a;const o=e._`\n`;t.ValueScope=class extends r{constructor(t){super(t),this._values={},this._scope=t.scope,this.opts=c(l({},t),{_n:t.lines?o:e.nil})}get(){return this._scope}name(t){return new a(t,this._newName(t))}value(t,e){var s;if(void 0===e.ref)throw new Error("CodeGen: ref must be passed in value");const i=this.toName(t),{prefix:n}=i,r=null!==(s=e.key)&&void 0!==s?s:e.ref;let a=this._values[n];if(a){const t=a.get(r);if(t)return t}else a=this._values[n]=new Map;a.set(r,i);const o=this._scope[n]||(this._scope[n]=[]),h=o.length;return o[h]=e.ref,i.setValue(e,{property:n,itemIndex:h}),i}getValue(t,e){const s=this._values[t];if(s)return s.get(e)}scopeRefs(t,s=this._values){return this._reduceValues(s,(s=>{if(void 0===s.scopePath)throw new Error(`CodeGen: name "${s}" has no value`);return e._`${t}${s.scopePath}`}))}scopeCode(t=this._values,e,s){return this._reduceValues(t,(t=>{if(void 0===t.value)throw new Error(`CodeGen: name "${t}" has no value`);return t.value.code}),e,s)}_reduceValues(n,r,a={},o){let h=e.nil;for(const l in n){const c=n[l];if(!c)continue;const u=a[l]=a[l]||new Map;c.forEach((n=>{if(u.has(n))return;u.set(n,i.Started);let a=r(n);if(a){const s=this.opts.es5?t.varKinds.var:t.varKinds.const;h=e._`${h}${s} ${n} = ${a};${this.opts._n}`}else{if(!(a=null==o?void 0:o(n)))throw new s(n);h=e._`${h}${a}${this.opts._n}`}u.set(n,i.Completed)}))}return h}}}(P),function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.or=t.and=t.not=t.CodeGen=t.operators=t.varKinds=t.ValueScopeName=t.ValueScope=t.Scope=t.Name=t.regexpCode=t.stringify=t.getProperty=t.nil=t.strConcat=t.str=t._=void 0;const e=I,s=P;var i=I;Object.defineProperty(t,"_",{enumerable:!0,get:function(){return i._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return i.str}}),Object.defineProperty(t,"strConcat",{enumerable:!0,get:function(){return i.strConcat}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return i.nil}}),Object.defineProperty(t,"getProperty",{enumerable:!0,get:function(){return i.getProperty}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return i.stringify}}),Object.defineProperty(t,"regexpCode",{enumerable:!0,get:function(){return i.regexpCode}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return i.Name}});var n=P;Object.defineProperty(t,"Scope",{enumerable:!0,get:function(){return n.Scope}}),Object.defineProperty(t,"ValueScope",{enumerable:!0,get:function(){return n.ValueScope}}),Object.defineProperty(t,"ValueScopeName",{enumerable:!0,get:function(){return n.ValueScopeName}}),Object.defineProperty(t,"varKinds",{enumerable:!0,get:function(){return n.varKinds}}),t.operators={GT:new e._Code(">"),GTE:new e._Code(">="),LT:new e._Code("<"),LTE:new e._Code("<="),EQ:new e._Code("==="),NEQ:new e._Code("!=="),NOT:new e._Code("!"),OR:new e._Code("||"),AND:new e._Code("&&"),ADD:new e._Code("+")};class r{optimizeNodes(){return this}optimizeNames(t,e){return this}}class a extends r{constructor(t,e,s){super(),this.varKind=t,this.name=e,this.rhs=s}render({es5:t,_n:e}){const i=t?s.varKinds.var:this.varKind,n=void 0===this.rhs?"":` = ${this.rhs}`;return`${i} ${this.name}${n};`+e}optimizeNames(t,e){if(t[this.name.str])return this.rhs&&(this.rhs=D(this.rhs,t,e)),this}get names(){return this.rhs instanceof e._CodeOrName?this.rhs.names:{}}}class o extends r{constructor(t,e,s){super(),this.lhs=t,this.rhs=e,this.sideEffects=s}render({_n:t}){return`${this.lhs} = ${this.rhs};`+t}optimizeNames(t,s){if(!(this.lhs instanceof e.Name)||t[this.lhs.str]||this.sideEffects)return this.rhs=D(this.rhs,t,s),this}get names(){return k(this.lhs instanceof e.Name?{}:l({},this.lhs.names),this.rhs)}}class h extends o{constructor(t,e,s,i){super(t,s,i),this.op=e}render({_n:t}){return`${this.lhs} ${this.op}= ${this.rhs};`+t}}class u extends r{constructor(t){super(),this.label=t,this.names={}}render({_n:t}){return`${this.label}:`+t}}class d extends r{constructor(t){super(),this.label=t,this.names={}}render({_n:t}){return`break${this.label?` ${this.label}`:""};`+t}}class p extends r{constructor(t){super(),this.error=t}render({_n:t}){return`throw ${this.error};`+t}get names(){return this.error.names}}class f extends r{constructor(t){super(),this.code=t}render({_n:t}){return`${this.code};`+t}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(t,e){return this.code=D(this.code,t,e),this}get names(){return this.code instanceof e._CodeOrName?this.code.names:{}}}class m extends r{constructor(t=[]){super(),this.nodes=t}render(t){return this.nodes.reduce(((e,s)=>e+s.render(t)),"")}optimizeNodes(){const{nodes:t}=this;let e=t.length;for(;e--;){const s=t[e].optimizeNodes();Array.isArray(s)?t.splice(e,1,...s):s?t[e]=s:t.splice(e,1)}return t.length>0?this:void 0}optimizeNames(t,e){const{nodes:s}=this;let i=s.length;for(;i--;){const n=s[i];n.optimizeNames(t,e)||(F(t,n.names),s.splice(i,1))}return s.length>0?this:void 0}get names(){return this.nodes.reduce(((t,e)=>R(t,e.names)),{})}}class g extends m{render(t){return"{"+t._n+super.render(t)+"}"+t._n}}class y extends m{}class x extends g{}x.kind="else";class v extends g{constructor(t,e){super(e),this.condition=t}render(t){let e=`if(${this.condition})`+super.render(t);return this.else&&(e+="else "+this.else.render(t)),e}optimizeNodes(){super.optimizeNodes();const t=this.condition;if(!0===t)return this.nodes;let e=this.else;if(e){const t=e.optimizeNodes();e=this.else=Array.isArray(t)?new x(t):t}return e?!1===t?e instanceof v?e:e.nodes:this.nodes.length?this:new v(O(t),e instanceof v?[e]:e.nodes):!1!==t&&this.nodes.length?this:void 0}optimizeNames(t,e){var s;if(this.else=null===(s=this.else)||void 0===s?void 0:s.optimizeNames(t,e),super.optimizeNames(t,e)||this.else)return this.condition=D(this.condition,t,e),this}get names(){const t=super.names;return k(t,this.condition),this.else&&R(t,this.else.names),t}}v.kind="if";class _ extends g{}_.kind="for";class b extends _{constructor(t){super(),this.iteration=t}render(t){return`for(${this.iteration})`+super.render(t)}optimizeNames(t,e){if(super.optimizeNames(t,e))return this.iteration=D(this.iteration,t,e),this}get names(){return R(super.names,this.iteration.names)}}class w extends _{constructor(t,e,s,i){super(),this.varKind=t,this.name=e,this.from=s,this.to=i}render(t){const e=t.es5?s.varKinds.var:this.varKind,{name:i,from:n,to:r}=this;return`for(${e} ${i}=${n}; ${i}<${r}; ${i}++)`+super.render(t)}get names(){const t=k(super.names,this.from);return k(t,this.to)}}class E extends _{constructor(t,e,s,i){super(),this.loop=t,this.varKind=e,this.name=s,this.iterable=i}render(t){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(t)}optimizeNames(t,e){if(super.optimizeNames(t,e))return this.iterable=D(this.iterable,t,e),this}get names(){return R(super.names,this.iterable.names)}}class S extends g{constructor(t,e,s){super(),this.name=t,this.args=e,this.async=s}render(t){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(t)}}S.kind="func";class T extends m{render(t){return"return "+super.render(t)}}T.kind="return";class A extends g{render(t){let e="try"+super.render(t);return this.catch&&(e+=this.catch.render(t)),this.finally&&(e+=this.finally.render(t)),e}optimizeNodes(){var t,e;return super.optimizeNodes(),null===(t=this.catch)||void 0===t||t.optimizeNodes(),null===(e=this.finally)||void 0===e||e.optimizeNodes(),this}optimizeNames(t,e){var s,i;return super.optimizeNames(t,e),null===(s=this.catch)||void 0===s||s.optimizeNames(t,e),null===(i=this.finally)||void 0===i||i.optimizeNames(t,e),this}get names(){const t=super.names;return this.catch&&R(t,this.catch.names),this.finally&&R(t,this.finally.names),t}}class C extends g{constructor(t){super(),this.error=t}render(t){return`catch(${this.error})`+super.render(t)}}C.kind="catch";class M extends g{render(t){return"finally"+super.render(t)}}M.kind="finally";function R(t,e){for(const s in e)t[s]=(t[s]||0)+(e[s]||0);return t}function k(t,s){return s instanceof e._CodeOrName?R(t,s.names):t}function D(t,s,i){return t instanceof e.Name?r(t):(n=t)instanceof e._Code&&n._items.some((t=>t instanceof e.Name&&1===s[t.str]&&void 0!==i[t.str]))?new e._Code(t._items.reduce(((t,s)=>(s instanceof e.Name&&(s=r(s)),s instanceof e._Code?t.push(...s._items):t.push(s),t)),[])):t;var n;function r(t){const e=i[t.str];return void 0===e||1!==s[t.str]?t:(delete s[t.str],e)}}function F(t,e){for(const s in e)t[s]=(t[s]||0)-(e[s]||0)}function O(t){return"boolean"==typeof t||"number"==typeof t||null===t?!t:e._`!${V(t)}`}t.CodeGen=class{constructor(t,e={}){this._values={},this._blockStarts=[],this._constants={},this.opts=c(l({},e),{_n:e.lines?"\n":""}),this._extScope=t,this._scope=new s.Scope({parent:t}),this._nodes=[new y]}toString(){return this._root.render(this.opts)}name(t){return this._scope.name(t)}scopeName(t){return this._extScope.name(t)}scopeValue(t,e){const s=this._extScope.value(t,e);return(this._values[s.prefix]||(this._values[s.prefix]=new Set)).add(s),s}getScopeValue(t,e){return this._extScope.getValue(t,e)}scopeRefs(t){return this._extScope.scopeRefs(t,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(t,e,s,i){const n=this._scope.toName(e);return void 0!==s&&i&&(this._constants[n.str]=s),this._leafNode(new a(t,n,s)),n}const(t,e,i){return this._def(s.varKinds.const,t,e,i)}let(t,e,i){return this._def(s.varKinds.let,t,e,i)}var(t,e,i){return this._def(s.varKinds.var,t,e,i)}assign(t,e,s){return this._leafNode(new o(t,e,s))}add(e,s){return this._leafNode(new h(e,t.operators.ADD,s))}code(t){return"function"==typeof t?t():t!==e.nil&&this._leafNode(new f(t)),this}object(...t){const s=["{"];for(const[i,n]of t)s.length>1&&s.push(","),s.push(i),(i!==n||this.opts.es5)&&(s.push(":"),(0,e.addCodeArg)(s,n));return s.push("}"),new e._Code(s)}if(t,e,s){if(this._blockNode(new v(t)),e&&s)this.code(e).else().code(s).endIf();else if(e)this.code(e).endIf();else if(s)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(t){return this._elseNode(new v(t))}else(){return this._elseNode(new x)}endIf(){return this._endBlockNode(v,x)}_for(t,e){return this._blockNode(t),e&&this.code(e).endFor(),this}for(t,e){return this._for(new b(t),e)}forRange(t,e,i,n,r=(this.opts.es5?s.varKinds.var:s.varKinds.let)){const a=this._scope.toName(t);return this._for(new w(r,a,e,i),(()=>n(a)))}forOf(t,i,n,r=s.varKinds.const){const a=this._scope.toName(t);if(this.opts.es5){const t=i instanceof e.Name?i:this.var("_arr",i);return this.forRange("_i",0,e._`${t}.length`,(s=>{this.var(a,e._`${t}[${s}]`),n(a)}))}return this._for(new E("of",r,a,i),(()=>n(a)))}forIn(t,i,n,r=(this.opts.es5?s.varKinds.var:s.varKinds.const)){if(this.opts.ownProperties)return this.forOf(t,e._`Object.keys(${i})`,n);const a=this._scope.toName(t);return this._for(new E("in",r,a,i),(()=>n(a)))}endFor(){return this._endBlockNode(_)}label(t){return this._leafNode(new u(t))}break(t){return this._leafNode(new d(t))}return(t){const e=new T;if(this._blockNode(e),this.code(t),1!==e.nodes.length)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(T)}try(t,e,s){if(!e&&!s)throw new Error('CodeGen: "try" without "catch" and "finally"');const i=new A;if(this._blockNode(i),this.code(t),e){const t=this.name("e");this._currNode=i.catch=new C(t),e(t)}return s&&(this._currNode=i.finally=new M,this.code(s)),this._endBlockNode(C,M)}throw(t){return this._leafNode(new p(t))}block(t,e){return this._blockStarts.push(this._nodes.length),t&&this.code(t).endBlock(e),this}endBlock(t){const e=this._blockStarts.pop();if(void 0===e)throw new Error("CodeGen: not in self-balancing block");const s=this._nodes.length-e;if(s<0||void 0!==t&&s!==t)throw new Error(`CodeGen: wrong number of nodes: ${s} vs ${t} expected`);return this._nodes.length=e,this}func(t,s=e.nil,i,n){return this._blockNode(new S(t,s,i)),n&&this.code(n).endFunc(),this}endFunc(){return this._endBlockNode(S)}optimize(t=1){for(;t-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(t){return this._currNode.nodes.push(t),this}_blockNode(t){this._currNode.nodes.push(t),this._nodes.push(t)}_endBlockNode(t,e){const s=this._currNode;if(s instanceof t||e&&s instanceof e)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${e?`${t.kind}/${e.kind}`:t.kind}"`)}_elseNode(t){const e=this._currNode;if(!(e instanceof v))throw new Error('CodeGen: "else" without "if"');return this._currNode=e.else=t,this}get _root(){return this._nodes[0]}get _currNode(){const t=this._nodes;return t[t.length-1]}set _currNode(t){const e=this._nodes;e[e.length-1]=t}},t.not=O;const N=L(t.operators.AND);t.and=function(...t){return t.reduce(N)};const B=L(t.operators.OR);function L(t){return(s,i)=>s===e.nil?i:i===e.nil?s:e._`${V(s)} ${t} ${V(i)}`}function V(t){return t instanceof e.Name?t:e._`(${t})`}t.or=function(...t){return t.reduce(B)}}(M);var R={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.checkStrictMode=t.getErrorPath=t.Type=t.useFunc=t.setEvaluated=t.evaluatedPropsToName=t.mergeEvaluated=t.eachItem=t.unescapeJsonPointer=t.escapeJsonPointer=t.escapeFragment=t.unescapeFragment=t.schemaRefOrVal=t.schemaHasRulesButRef=t.schemaHasRules=t.checkUnknownRules=t.alwaysValidSchema=t.toHash=void 0;const e=M,s=I;function i(t,e=t.schema){const{opts:s,self:i}=t;if(!s.strictSchema)return;if("boolean"==typeof e)return;const n=i.RULES.keywords;for(const r in e)n[r]||f(t,`unknown keyword: "${r}"`)}function n(t,e){if("boolean"==typeof t)return!t;for(const s in t)if(e[s])return!0;return!1}function r(t){return"number"==typeof t?`${t}`:t.replace(/~/g,"~0").replace(/\//g,"~1")}function a(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function o({mergeNames:t,mergeToName:s,mergeValues:i,resultToName:n}){return(r,a,o,h)=>{const l=void 0===o?a:o instanceof e.Name?(a instanceof e.Name?t(r,a,o):s(r,a,o),o):a instanceof e.Name?(s(r,o,a),a):i(a,o);return h!==e.Name||l instanceof e.Name?l:n(r,l)}}function h(t,s){if(!0===s)return t.var("props",!0);const i=t.var("props",e._`{}`);return void 0!==s&&c(t,i,s),i}function c(t,s,i){Object.keys(i).forEach((i=>t.assign(e._`${s}${(0,e.getProperty)(i)}`,!0)))}t.toHash=function(t){const e={};for(const s of t)e[s]=!0;return e},t.alwaysValidSchema=function(t,e){return"boolean"==typeof e?e:0===Object.keys(e).length||(i(t,e),!n(e,t.self.RULES.all))},t.checkUnknownRules=i,t.schemaHasRules=n,t.schemaHasRulesButRef=function(t,e){if("boolean"==typeof t)return!t;for(const s in t)if("$ref"!==s&&e.all[s])return!0;return!1},t.schemaRefOrVal=function({topSchemaRef:t,schemaPath:s},i,n,r){if(!r){if("number"==typeof i||"boolean"==typeof i)return i;if("string"==typeof i)return e._`${i}`}return e._`${t}${s}${(0,e.getProperty)(n)}`},t.unescapeFragment=function(t){return a(decodeURIComponent(t))},t.escapeFragment=function(t){return encodeURIComponent(r(t))},t.escapeJsonPointer=r,t.unescapeJsonPointer=a,t.eachItem=function(t,e){if(Array.isArray(t))for(const s of t)e(s);else e(t)},t.mergeEvaluated={props:o({mergeNames:(t,s,i)=>t.if(e._`${i} !== true && ${s} !== undefined`,(()=>{t.if(e._`${s} === true`,(()=>t.assign(i,!0)),(()=>t.assign(i,e._`${i} || {}`).code(e._`Object.assign(${i}, ${s})`)))})),mergeToName:(t,s,i)=>t.if(e._`${i} !== true`,(()=>{!0===s?t.assign(i,!0):(t.assign(i,e._`${i} || {}`),c(t,i,s))})),mergeValues:(t,e)=>!0===t||l(l({},t),e),resultToName:h}),items:o({mergeNames:(t,s,i)=>t.if(e._`${i} !== true && ${s} !== undefined`,(()=>t.assign(i,e._`${s} === true ? true : ${i} > ${s} ? ${i} : ${s}`))),mergeToName:(t,s,i)=>t.if(e._`${i} !== true`,(()=>t.assign(i,!0===s||e._`${i} > ${s} ? ${i} : ${s}`))),mergeValues:(t,e)=>!0===t||Math.max(t,e),resultToName:(t,e)=>t.var("items",e)})},t.evaluatedPropsToName=h,t.setEvaluated=c;const u={};var d,p;function f(t,e,s=t.opts.strictSchema){if(s){if(e=`strict mode: ${e}`,!0===s)throw new Error(e);t.self.logger.warn(e)}}t.useFunc=function(t,e){return t.scopeValue("func",{ref:e,code:u[e.code]||(u[e.code]=new s._Code(e.code))})},(p=d=t.Type||(t.Type={}))[p.Num=0]="Num",p[p.Str=1]="Str",t.getErrorPath=function(t,s,i){if(t instanceof e.Name){const n=s===d.Num;return i?n?e._`"[" + ${t} + "]"`:e._`"['" + ${t} + "']"`:n?e._`"/" + ${t}`:e._`"/" + ${t}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return i?(0,e.getProperty)(t).toString():"/"+r(t)},t.checkStrictMode=f}(R);var k={};Object.defineProperty(k,"__esModule",{value:!0});const D=M,F={data:new D.Name("data"),valCxt:new D.Name("valCxt"),instancePath:new D.Name("instancePath"),parentData:new D.Name("parentData"),parentDataProperty:new D.Name("parentDataProperty"),rootData:new D.Name("rootData"),dynamicAnchors:new D.Name("dynamicAnchors"),vErrors:new D.Name("vErrors"),errors:new D.Name("errors"),this:new D.Name("this"),self:new D.Name("self"),scope:new D.Name("scope"),json:new D.Name("json"),jsonPos:new D.Name("jsonPos"),jsonLen:new D.Name("jsonLen"),jsonPart:new D.Name("jsonPart")};k.default=F,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.extendErrors=t.resetErrorsCount=t.reportExtraError=t.reportError=t.keyword$DataError=t.keywordError=void 0;const e=M,s=R,i=k;function n(t,s){const n=t.const("err",s);t.if(e._`${i.default.vErrors} === null`,(()=>t.assign(i.default.vErrors,e._`[${n}]`)),e._`${i.default.vErrors}.push(${n})`),t.code(e._`${i.default.errors}++`)}function r(t,s){const{gen:i,validateName:n,schemaEnv:r}=t;r.$async?i.throw(e._`new ${t.ValidationError}(${s})`):(i.assign(e._`${n}.errors`,s),i.return(!1))}t.keywordError={message:({keyword:t})=>e.str`must pass "${t}" keyword validation`},t.keyword$DataError={message:({keyword:t,schemaType:s})=>s?e.str`"${t}" keyword must be ${s} ($data)`:e.str`"${t}" keyword is invalid ($data)`},t.reportError=function(s,i=t.keywordError,a,h){const{it:l}=s,{gen:c,compositeRule:u,allErrors:d}=l,p=o(s,i,a);(null!=h?h:u||d)?n(c,p):r(l,e._`[${p}]`)},t.reportExtraError=function(e,s=t.keywordError,a){const{it:h}=e,{gen:l,compositeRule:c,allErrors:u}=h;n(l,o(e,s,a)),c||u||r(h,i.default.vErrors)},t.resetErrorsCount=function(t,s){t.assign(i.default.errors,s),t.if(e._`${i.default.vErrors} !== null`,(()=>t.if(s,(()=>t.assign(e._`${i.default.vErrors}.length`,s)),(()=>t.assign(i.default.vErrors,null)))))},t.extendErrors=function({gen:t,keyword:s,schemaValue:n,data:r,errsCount:a,it:o}){if(void 0===a)throw new Error("ajv implementation error");const h=t.name("err");t.forRange("i",a,i.default.errors,(a=>{t.const(h,e._`${i.default.vErrors}[${a}]`),t.if(e._`${h}.instancePath === undefined`,(()=>t.assign(e._`${h}.instancePath`,(0,e.strConcat)(i.default.instancePath,o.errorPath)))),t.assign(e._`${h}.schemaPath`,e.str`${o.errSchemaPath}/${s}`),o.opts.verbose&&(t.assign(e._`${h}.schema`,n),t.assign(e._`${h}.data`,r))}))};const a={keyword:new e.Name("keyword"),schemaPath:new e.Name("schemaPath"),params:new e.Name("params"),propertyName:new e.Name("propertyName"),message:new e.Name("message"),schema:new e.Name("schema"),parentSchema:new e.Name("parentSchema")};function o(t,s,n){const{createErrors:r}=t.it;return!1===r?e._`{}`:function(t,s,n={}){const{gen:r,it:o}=t,c=[h(o,n),l(t,n)];return function(t,{params:s,message:n},r){const{keyword:o,data:h,schemaValue:l,it:c}=t,{opts:u,propertyName:d,topSchemaRef:p,schemaPath:f}=c;r.push([a.keyword,o],[a.params,"function"==typeof s?s(t):s||e._`{}`]),u.messages&&r.push([a.message,"function"==typeof n?n(t):n]);u.verbose&&r.push([a.schema,l],[a.parentSchema,e._`${p}${f}`],[i.default.data,h]);d&&r.push([a.propertyName,d])}(t,s,c),r.object(...c)}(t,s,n)}function h({errorPath:t},{instancePath:n}){const r=n?e.str`${t}${(0,s.getErrorPath)(n,s.Type.Str)}`:t;return[i.default.instancePath,(0,e.strConcat)(i.default.instancePath,r)]}function l({keyword:t,it:{errSchemaPath:i}},{schemaPath:n,parentSchema:r}){let o=r?i:e.str`${i}/${t}`;return n&&(o=e.str`${o}${(0,s.getErrorPath)(n,s.Type.Str)}`),[a.schemaPath,o]}}(C),Object.defineProperty(A,"__esModule",{value:!0}),A.boolOrEmptySchema=A.topBoolOrEmptySchema=void 0;const O=C,N=M,B=k,L={message:"boolean schema is false"};function V(t,e){const{gen:s,data:i}=t,n={gen:s,keyword:"false schema",data:i,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,O.reportError)(n,L,void 0,e)}A.topBoolOrEmptySchema=function(t){const{gen:e,schema:s,validateName:i}=t;!1===s?V(t,!1):"object"==typeof s&&!0===s.$async?e.return(B.default.data):(e.assign(N._`${i}.errors`,null),e.return(!0))},A.boolOrEmptySchema=function(t,e){const{gen:s,schema:i}=t;!1===i?(s.var(e,!1),V(t)):s.var(e,!0)};var $={},U={};Object.defineProperty(U,"__esModule",{value:!0}),U.getRules=U.isJSONType=void 0;const X=new Set(["string","number","integer","boolean","null","object","array"]);U.isJSONType=function(t){return"string"==typeof t&&X.has(t)},U.getRules=function(){const t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:c(l({},t),{integer:!0,boolean:!0,null:!0}),rules:[{rules:[]},t.number,t.string,t.array,t.object],post:{rules:[]},all:{},keywords:{}}};var Y={};function W(t,e){return e.rules.some((e=>j(t,e)))}function j(t,e){var s;return void 0!==t[e.keyword]||(null===(s=e.definition.implements)||void 0===s?void 0:s.some((e=>void 0!==t[e])))}Object.defineProperty(Y,"__esModule",{value:!0}),Y.shouldUseRule=Y.shouldUseGroup=Y.schemaHasRulesForType=void 0,Y.schemaHasRulesForType=function({schema:t,self:e},s){const i=e.RULES.types[s];return i&&!0!==i&&W(t,i)},Y.shouldUseGroup=W,Y.shouldUseRule=j,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.reportTypeError=t.checkDataTypes=t.checkDataType=t.coerceAndCheckDataType=t.getJSONTypes=t.getSchemaTypes=t.DataType=void 0;const e=U,s=Y,i=C,n=M,r=R;var a,o;function h(t){const s=Array.isArray(t)?t:t?[t]:[];if(s.every(e.isJSONType))return s;throw new Error("type must be JSONType or JSONType[]: "+s.join(","))}(o=a=t.DataType||(t.DataType={}))[o.Correct=0]="Correct",o[o.Wrong=1]="Wrong",t.getSchemaTypes=function(t){const e=h(t.type);if(e.includes("null")){if(!1===t.nullable)throw new Error("type: null contradicts nullable: false")}else{if(!e.length&&void 0!==t.nullable)throw new Error('"nullable" cannot be used without "type"');!0===t.nullable&&e.push("null")}return e},t.getJSONTypes=h,t.coerceAndCheckDataType=function(t,e){const{gen:i,data:r,opts:o}=t,h=function(t,e){return e?t.filter((t=>l.has(t)||"array"===e&&"array"===t)):[]}(e,o.coerceTypes),c=e.length>0&&!(0===h.length&&1===e.length&&(0,s.schemaHasRulesForType)(t,e[0]));if(c){const s=u(e,r,o.strictNumbers,a.Wrong);i.if(s,(()=>{h.length?function(t,e,s){const{gen:i,data:r,opts:a}=t,o=i.let("dataType",n._`typeof ${r}`),h=i.let("coerced",n._`undefined`);"array"===a.coerceTypes&&i.if(n._`${o} == 'object' && Array.isArray(${r}) && ${r}.length == 1`,(()=>i.assign(r,n._`${r}[0]`).assign(o,n._`typeof ${r}`).if(u(e,r,a.strictNumbers),(()=>i.assign(h,r)))));i.if(n._`${h} !== undefined`);for(const n of s)(l.has(n)||"array"===n&&"array"===a.coerceTypes)&&c(n);function c(t){switch(t){case"string":return void i.elseIf(n._`${o} == "number" || ${o} == "boolean"`).assign(h,n._`"" + ${r}`).elseIf(n._`${r} === null`).assign(h,n._`""`);case"number":return void i.elseIf(n._`${o} == "boolean" || ${r} === null
              || (${o} == "string" && ${r} && ${r} == +${r})`).assign(h,n._`+${r}`);case"integer":return void i.elseIf(n._`${o} === "boolean" || ${r} === null
              || (${o} === "string" && ${r} && ${r} == +${r} && !(${r} % 1))`).assign(h,n._`+${r}`);case"boolean":return void i.elseIf(n._`${r} === "false" || ${r} === 0 || ${r} === null`).assign(h,!1).elseIf(n._`${r} === "true" || ${r} === 1`).assign(h,!0);case"null":return i.elseIf(n._`${r} === "" || ${r} === 0 || ${r} === false`),void i.assign(h,null);case"array":i.elseIf(n._`${o} === "string" || ${o} === "number"
              || ${o} === "boolean" || ${r} === null`).assign(h,n._`[${r}]`)}}i.else(),p(t),i.endIf(),i.if(n._`${h} !== undefined`,(()=>{i.assign(r,h),function({gen:t,parentData:e,parentDataProperty:s},i){t.if(n._`${e} !== undefined`,(()=>t.assign(n._`${e}[${s}]`,i)))}(t,h)}))}(t,e,h):p(t)}))}return c};const l=new Set(["string","number","integer","boolean","null"]);function c(t,e,s,i=a.Correct){const r=i===a.Correct?n.operators.EQ:n.operators.NEQ;let o;switch(t){case"null":return n._`${e} ${r} null`;case"array":o=n._`Array.isArray(${e})`;break;case"object":o=n._`${e} && typeof ${e} == "object" && !Array.isArray(${e})`;break;case"integer":o=h(n._`!(${e} % 1) && !isNaN(${e})`);break;case"number":o=h();break;default:return n._`typeof ${e} ${r} ${t}`}return i===a.Correct?o:(0,n.not)(o);function h(t=n.nil){return(0,n.and)(n._`typeof ${e} == "number"`,t,s?n._`isFinite(${e})`:n.nil)}}function u(t,e,s,i){if(1===t.length)return c(t[0],e,s,i);let a;const o=(0,r.toHash)(t);if(o.array&&o.object){const t=n._`typeof ${e} != "object"`;a=o.null?t:n._`!${e} || ${t}`,delete o.null,delete o.array,delete o.object}else a=n.nil;o.number&&delete o.integer;for(const r in o)a=(0,n.and)(a,c(r,e,s,i));return a}t.checkDataType=c,t.checkDataTypes=u;const d={message:({schema:t})=>`must be ${t}`,params:({schema:t,schemaValue:e})=>"string"==typeof t?n._`{type: ${t}}`:n._`{type: ${e}}`};function p(t){const e=function(t){const{gen:e,data:s,schema:i}=t,n=(0,r.schemaRefOrVal)(t,i,"type");return{gen:e,keyword:"type",data:s,schema:i.type,schemaCode:n,schemaValue:n,parentSchema:i,params:{},it:t}}(t);(0,i.reportError)(e,d)}t.reportTypeError=p}($);var G={};Object.defineProperty(G,"__esModule",{value:!0}),G.assignDefaults=void 0;const z=M,H=R;function q(t,e,s){const{gen:i,compositeRule:n,data:r,opts:a}=t;if(void 0===s)return;const o=z._`${r}${(0,z.getProperty)(e)}`;if(n)return void(0,H.checkStrictMode)(t,`default is ignored for: ${o}`);let h=z._`${o} === undefined`;"empty"===a.useDefaults&&(h=z._`${h} || ${o} === null || ${o} === ""`),i.if(h,z._`${o} = ${(0,z.stringify)(s)}`)}G.assignDefaults=function(t,e){const{properties:s,items:i}=t.schema;if("object"===e&&s)for(const n in s)q(t,n,s[n].default);else"array"===e&&Array.isArray(i)&&i.forEach(((e,s)=>q(t,s,e.default)))};var K={},Z={};Object.defineProperty(Z,"__esModule",{value:!0}),Z.validateUnion=Z.validateArray=Z.usePattern=Z.callValidateCode=Z.schemaProperties=Z.allSchemaProperties=Z.noPropertyInData=Z.propertyInData=Z.isOwnProperty=Z.hasPropFunc=Z.reportMissingProp=Z.checkMissingProp=Z.checkReportMissingProp=void 0;const Q=M,J=R,tt=k,et=R;function st(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:Q._`Object.prototype.hasOwnProperty`})}function it(t,e,s){return Q._`${st(t)}.call(${e}, ${s})`}function nt(t,e,s,i){const n=Q._`${e}${(0,Q.getProperty)(s)} === undefined`;return i?(0,Q.or)(n,(0,Q.not)(it(t,e,s))):n}function rt(t){return t?Object.keys(t).filter((t=>"__proto__"!==t)):[]}Z.checkReportMissingProp=function(t,e){const{gen:s,data:i,it:n}=t;s.if(nt(s,i,e,n.opts.ownProperties),(()=>{t.setParams({missingProperty:Q._`${e}`},!0),t.error()}))},Z.checkMissingProp=function({gen:t,data:e,it:{opts:s}},i,n){return(0,Q.or)(...i.map((i=>(0,Q.and)(nt(t,e,i,s.ownProperties),Q._`${n} = ${i}`))))},Z.reportMissingProp=function(t,e){t.setParams({missingProperty:e},!0),t.error()},Z.hasPropFunc=st,Z.isOwnProperty=it,Z.propertyInData=function(t,e,s,i){const n=Q._`${e}${(0,Q.getProperty)(s)} !== undefined`;return i?Q._`${n} && ${it(t,e,s)}`:n},Z.noPropertyInData=nt,Z.allSchemaProperties=rt,Z.schemaProperties=function(t,e){return rt(e).filter((s=>!(0,J.alwaysValidSchema)(t,e[s])))},Z.callValidateCode=function({schemaCode:t,data:e,it:{gen:s,topSchemaRef:i,schemaPath:n,errorPath:r},it:a},o,h,l){const c=l?Q._`${t}, ${e}, ${i}${n}`:e,u=[[tt.default.instancePath,(0,Q.strConcat)(tt.default.instancePath,r)],[tt.default.parentData,a.parentData],[tt.default.parentDataProperty,a.parentDataProperty],[tt.default.rootData,tt.default.rootData]];a.opts.dynamicRef&&u.push([tt.default.dynamicAnchors,tt.default.dynamicAnchors]);const d=Q._`${c}, ${s.object(...u)}`;return h!==Q.nil?Q._`${o}.call(${h}, ${d})`:Q._`${o}(${d})`};const at=Q._`new RegExp`;Z.usePattern=function({gen:t,it:{opts:e}},s){const i=e.unicodeRegExp?"u":"",{regExp:n}=e.code,r=n(s,i);return t.scopeValue("pattern",{key:r.toString(),ref:r,code:Q._`${"new RegExp"===n.code?at:(0,et.useFunc)(t,n)}(${s}, ${i})`})},Z.validateArray=function(t){const{gen:e,data:s,keyword:i,it:n}=t,r=e.name("valid");if(n.allErrors){const t=e.let("valid",!0);return a((()=>e.assign(t,!1))),t}return e.var(r,!0),a((()=>e.break())),r;function a(n){const a=e.const("len",Q._`${s}.length`);e.forRange("i",0,a,(s=>{t.subschema({keyword:i,dataProp:s,dataPropType:J.Type.Num},r),e.if((0,Q.not)(r),n)}))}},Z.validateUnion=function(t){const{gen:e,schema:s,keyword:i,it:n}=t;if(!Array.isArray(s))throw new Error("ajv implementation error");if(s.some((t=>(0,J.alwaysValidSchema)(n,t)))&&!n.opts.unevaluated)return;const r=e.let("valid",!1),a=e.name("_valid");e.block((()=>s.forEach(((s,n)=>{const o=t.subschema({keyword:i,schemaProp:n,compositeRule:!0},a);e.assign(r,Q._`${r} || ${a}`);t.mergeValidEvaluated(o,a)||e.if((0,Q.not)(r))})))),t.result(r,(()=>t.reset()),(()=>t.error(!0)))},Object.defineProperty(K,"__esModule",{value:!0}),K.validateKeywordUsage=K.validSchemaType=K.funcKeywordCode=K.macroKeywordCode=void 0;const ot=M,ht=k,lt=Z,ct=C;function ut(t){const{gen:e,data:s,it:i}=t;e.if(i.parentData,(()=>e.assign(s,ot._`${i.parentData}[${i.parentDataProperty}]`)))}function dt(t,e,s){if(void 0===s)throw new Error(`keyword "${e}" failed to compile`);return t.scopeValue("keyword","function"==typeof s?{ref:s}:{ref:s,code:(0,ot.stringify)(s)})}K.macroKeywordCode=function(t,e){const{gen:s,keyword:i,schema:n,parentSchema:r,it:a}=t,o=e.macro.call(a.self,n,r,a),h=dt(s,i,o);!1!==a.opts.validateSchema&&a.self.validateSchema(o,!0);const l=s.name("valid");t.subschema({schema:o,schemaPath:ot.nil,errSchemaPath:`${a.errSchemaPath}/${i}`,topSchemaRef:h,compositeRule:!0},l),t.pass(l,(()=>t.error(!0)))},K.funcKeywordCode=function(t,e){var s;const{gen:i,keyword:n,schema:r,parentSchema:a,$data:o,it:h}=t;!function({schemaEnv:t},e){if(e.async&&!t.$async)throw new Error("async keyword in sync schema")}(h,e);const l=!o&&e.compile?e.compile.call(h.self,r,a,h):e.validate,c=dt(i,n,l),u=i.let("valid");function d(s=(e.async?ot._`await `:ot.nil)){const n=h.opts.passContext?ht.default.this:ht.default.self,r=!("compile"in e&&!o||!1===e.schema);i.assign(u,ot._`${s}${(0,lt.callValidateCode)(t,c,n,r)}`,e.modifying)}function p(t){var s;i.if((0,ot.not)(null!==(s=e.valid)&&void 0!==s?s:u),t)}t.block$data(u,(function(){if(!1===e.errors)d(),e.modifying&&ut(t),p((()=>t.error()));else{const s=e.async?function(){const t=i.let("ruleErrs",null);return i.try((()=>d(ot._`await `)),(e=>i.assign(u,!1).if(ot._`${e} instanceof ${h.ValidationError}`,(()=>i.assign(t,ot._`${e}.errors`)),(()=>i.throw(e))))),t}():function(){const t=ot._`${c}.errors`;return i.assign(t,null),d(ot.nil),t}();e.modifying&&ut(t),p((()=>function(t,e){const{gen:s}=t;s.if(ot._`Array.isArray(${e})`,(()=>{s.assign(ht.default.vErrors,ot._`${ht.default.vErrors} === null ? ${e} : ${ht.default.vErrors}.concat(${e})`).assign(ht.default.errors,ot._`${ht.default.vErrors}.length`),(0,ct.extendErrors)(t)}),(()=>t.error()))}(t,s)))}})),t.ok(null!==(s=e.valid)&&void 0!==s?s:u)},K.validSchemaType=function(t,e,s=!1){return!e.length||e.some((e=>"array"===e?Array.isArray(t):"object"===e?t&&"object"==typeof t&&!Array.isArray(t):typeof t==e||s&&void 0===t))},K.validateKeywordUsage=function({schema:t,opts:e,self:s,errSchemaPath:i},n,r){if(Array.isArray(n.keyword)?!n.keyword.includes(r):n.keyword!==r)throw new Error("ajv implementation error");const a=n.dependencies;if(null==a?void 0:a.some((e=>!Object.prototype.hasOwnProperty.call(t,e))))throw new Error(`parent schema must have dependencies of ${r}: ${a.join(",")}`);if(n.validateSchema){if(!n.validateSchema(t[r])){const t=`keyword "${r}" value is invalid at path "${i}": `+s.errorsText(n.validateSchema.errors);if("log"!==e.validateSchema)throw new Error(t);s.logger.error(t)}}};var pt={};Object.defineProperty(pt,"__esModule",{value:!0}),pt.extendSubschemaMode=pt.extendSubschemaData=pt.getSubschema=void 0;const ft=M,mt=R;pt.getSubschema=function(t,{keyword:e,schemaProp:s,schema:i,schemaPath:n,errSchemaPath:r,topSchemaRef:a}){if(void 0!==e&&void 0!==i)throw new Error('both "keyword" and "schema" passed, only one allowed');if(void 0!==e){const i=t.schema[e];return void 0===s?{schema:i,schemaPath:ft._`${t.schemaPath}${(0,ft.getProperty)(e)}`,errSchemaPath:`${t.errSchemaPath}/${e}`}:{schema:i[s],schemaPath:ft._`${t.schemaPath}${(0,ft.getProperty)(e)}${(0,ft.getProperty)(s)}`,errSchemaPath:`${t.errSchemaPath}/${e}/${(0,mt.escapeFragment)(s)}`}}if(void 0!==i){if(void 0===n||void 0===r||void 0===a)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:i,schemaPath:n,topSchemaRef:a,errSchemaPath:r}}throw new Error('either "keyword" or "schema" must be passed')},pt.extendSubschemaData=function(t,e,{dataProp:s,dataPropType:i,data:n,dataTypes:r,propertyName:a}){if(void 0!==n&&void 0!==s)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:o}=e;if(void 0!==s){const{errorPath:n,dataPathArr:r,opts:a}=e;h(o.let("data",ft._`${e.data}${(0,ft.getProperty)(s)}`,!0)),t.errorPath=ft.str`${n}${(0,mt.getErrorPath)(s,i,a.jsPropertySyntax)}`,t.parentDataProperty=ft._`${s}`,t.dataPathArr=[...r,t.parentDataProperty]}if(void 0!==n){h(n instanceof ft.Name?n:o.let("data",n,!0)),void 0!==a&&(t.propertyName=a)}function h(s){t.data=s,t.dataLevel=e.dataLevel+1,t.dataTypes=[],e.definedProperties=new Set,t.parentData=e.data,t.dataNames=[...e.dataNames,s]}r&&(t.dataTypes=r)},pt.extendSubschemaMode=function(t,{jtdDiscriminator:e,jtdMetadata:s,compositeRule:i,createErrors:n,allErrors:r}){void 0!==i&&(t.compositeRule=i),void 0!==n&&(t.createErrors=n),void 0!==r&&(t.allErrors=r),t.jtdDiscriminator=e,t.jtdMetadata=s};var gt={},yt=function t(e,s){if(e===s)return!0;if(e&&s&&"object"==typeof e&&"object"==typeof s){if(e.constructor!==s.constructor)return!1;var i,n,r;if(Array.isArray(e)){if((i=e.length)!=s.length)return!1;for(n=i;0!=n--;)if(!t(e[n],s[n]))return!1;return!0}if(e.constructor===RegExp)return e.source===s.source&&e.flags===s.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===s.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===s.toString();if((i=(r=Object.keys(e)).length)!==Object.keys(s).length)return!1;for(n=i;0!=n--;)if(!Object.prototype.hasOwnProperty.call(s,r[n]))return!1;for(n=i;0!=n--;){var a=r[n];if(!t(e[a],s[a]))return!1}return!0}return e!=e&&s!=s},xt={},vt={get exports(){return xt},set exports(t){xt=t}}.exports=function(t,e,s){"function"==typeof e&&(s=e,e={}),_t(e,"function"==typeof(s=e.cb||s)?s:s.pre||function(){},s.post||function(){},t,"",t)};function _t(t,e,s,i,n,r,a,o,h,l){if(i&&"object"==typeof i&&!Array.isArray(i)){for(var c in e(i,n,r,a,o,h,l),i){var u=i[c];if(Array.isArray(u)){if(c in vt.arrayKeywords)for(var d=0;d<u.length;d++)_t(t,e,s,u[d],n+"/"+c+"/"+d,r,n,c,i,d)}else if(c in vt.propsKeywords){if(u&&"object"==typeof u)for(var p in u)_t(t,e,s,u[p],n+"/"+c+"/"+p.replace(/~/g,"~0").replace(/\//g,"~1"),r,n,c,i,p)}else(c in vt.keywords||t.allKeys&&!(c in vt.skipKeywords))&&_t(t,e,s,u,n+"/"+c,r,n,c,i)}s(i,n,r,a,o,h,l)}}vt.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0},vt.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},vt.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},vt.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},Object.defineProperty(gt,"__esModule",{value:!0}),gt.getSchemaRefs=gt.resolveUrl=gt.normalizeId=gt._getFullPath=gt.getFullPath=gt.inlineRef=void 0;const bt=R,wt=yt,Et=xt,St=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);gt.inlineRef=function(t,e=!0){return"boolean"==typeof t||(!0===e?!At(t):!!e&&Ct(t)<=e)};const Tt=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function At(t){for(const e in t){if(Tt.has(e))return!0;const s=t[e];if(Array.isArray(s)&&s.some(At))return!0;if("object"==typeof s&&At(s))return!0}return!1}function Ct(t){let e=0;for(const s in t){if("$ref"===s)return 1/0;if(e++,!St.has(s)&&("object"==typeof t[s]&&(0,bt.eachItem)(t[s],(t=>e+=Ct(t))),e===1/0))return 1/0}return e}function Mt(t,e="",s){!1!==s&&(e=Rt(e));const i=t.parse(e);return It(t,i)}function It(t,e){return t.serialize(e).split("#")[0]+"#"}gt.getFullPath=Mt,gt._getFullPath=It;const Pt=/#\/?$/;function Rt(t){return t?t.replace(Pt,""):""}gt.normalizeId=Rt,gt.resolveUrl=function(t,e,s){return s=Rt(s),t.resolve(e,s)};const kt=/^[a-z_][-a-z0-9._]*$/i;gt.getSchemaRefs=function(t,e){if("boolean"==typeof t)return{};const{schemaId:s,uriResolver:i}=this.opts,n=Rt(t[s]||e),r={"":n},a=Mt(i,n,!1),o={},h=new Set;return Et(t,{allKeys:!0},((t,e,i,n)=>{if(void 0===n)return;const u=a+e;let d=r[n];function p(e){const s=this.opts.uriResolver.resolve;if(e=Rt(d?s(d,e):e),h.has(e))throw c(e);h.add(e);let i=this.refs[e];return"string"==typeof i&&(i=this.refs[i]),"object"==typeof i?l(t,i.schema,e):e!==Rt(u)&&("#"===e[0]?(l(t,o[e],e),o[e]=t):this.refs[e]=u),e}function f(t){if("string"==typeof t){if(!kt.test(t))throw new Error(`invalid anchor "${t}"`);p.call(this,`#${t}`)}}"string"==typeof t[s]&&(d=p.call(this,t[s])),f.call(this,t.$anchor),f.call(this,t.$dynamicAnchor),r[e]=d})),o;function l(t,e,s){if(void 0!==e&&!wt(t,e))throw c(s)}function c(t){return new Error(`reference "${t}" resolves to more than one schema`)}},Object.defineProperty(T,"__esModule",{value:!0}),T.getData=T.KeywordCxt=T.validateFunctionCode=void 0;const Dt=A,Ft=$,Ot=Y,Nt=$,Bt=G,Lt=K,Vt=pt,$t=M,Ut=k,Xt=gt,Yt=R,Wt=C;function jt({gen:t,validateName:e,schema:s,schemaEnv:i,opts:n},r){n.code.es5?t.func(e,$t._`${Ut.default.data}, ${Ut.default.valCxt}`,i.$async,(()=>{t.code($t._`"use strict"; ${Gt(s,n)}`),function(t,e){t.if(Ut.default.valCxt,(()=>{t.var(Ut.default.instancePath,$t._`${Ut.default.valCxt}.${Ut.default.instancePath}`),t.var(Ut.default.parentData,$t._`${Ut.default.valCxt}.${Ut.default.parentData}`),t.var(Ut.default.parentDataProperty,$t._`${Ut.default.valCxt}.${Ut.default.parentDataProperty}`),t.var(Ut.default.rootData,$t._`${Ut.default.valCxt}.${Ut.default.rootData}`),e.dynamicRef&&t.var(Ut.default.dynamicAnchors,$t._`${Ut.default.valCxt}.${Ut.default.dynamicAnchors}`)}),(()=>{t.var(Ut.default.instancePath,$t._`""`),t.var(Ut.default.parentData,$t._`undefined`),t.var(Ut.default.parentDataProperty,$t._`undefined`),t.var(Ut.default.rootData,Ut.default.data),e.dynamicRef&&t.var(Ut.default.dynamicAnchors,$t._`{}`)}))}(t,n),t.code(r)})):t.func(e,$t._`${Ut.default.data}, ${function(t){return $t._`{${Ut.default.instancePath}="", ${Ut.default.parentData}, ${Ut.default.parentDataProperty}, ${Ut.default.rootData}=${Ut.default.data}${t.dynamicRef?$t._`, ${Ut.default.dynamicAnchors}={}`:$t.nil}}={}`}(n)}`,i.$async,(()=>t.code(Gt(s,n)).code(r)))}function Gt(t,e){const s="object"==typeof t&&t[e.schemaId];return s&&(e.code.source||e.code.process)?$t._`/*# sourceURL=${s} */`:$t.nil}function zt(t,e){qt(t)&&(Kt(t),Ht(t))?function(t,e){const{schema:s,gen:i,opts:n}=t;n.$comment&&s.$comment&&Qt(t);(function(t){const e=t.schema[t.opts.schemaId];e&&(t.baseId=(0,Xt.resolveUrl)(t.opts.uriResolver,t.baseId,e))})(t),function(t){if(t.schema.$async&&!t.schemaEnv.$async)throw new Error("async schema in sync schema")}(t);const r=i.const("_errs",Ut.default.errors);Zt(t,r),i.var(e,$t._`${r} === ${Ut.default.errors}`)}(t,e):(0,Dt.boolOrEmptySchema)(t,e)}function Ht({schema:t,self:e}){if("boolean"==typeof t)return!t;for(const s in t)if(e.RULES.all[s])return!0;return!1}function qt(t){return"boolean"!=typeof t.schema}function Kt(t){(0,Yt.checkUnknownRules)(t),function(t){const{schema:e,errSchemaPath:s,opts:i,self:n}=t;e.$ref&&i.ignoreKeywordsWithRef&&(0,Yt.schemaHasRulesButRef)(e,n.RULES)&&n.logger.warn(`$ref: keywords ignored in schema at path "${s}"`)}(t)}function Zt(t,e){if(t.opts.jtd)return Jt(t,[],!1,e);const s=(0,Ft.getSchemaTypes)(t.schema);Jt(t,s,!(0,Ft.coerceAndCheckDataType)(t,s),e)}function Qt({gen:t,schemaEnv:e,schema:s,errSchemaPath:i,opts:n}){const r=s.$comment;if(!0===n.$comment)t.code($t._`${Ut.default.self}.logger.log(${r})`);else if("function"==typeof n.$comment){const s=$t.str`${i}/$comment`,n=t.scopeValue("root",{ref:e.root});t.code($t._`${Ut.default.self}.opts.$comment(${r}, ${s}, ${n}.schema)`)}}function Jt(t,e,s,i){const{gen:n,schema:r,data:a,allErrors:o,opts:h,self:l}=t,{RULES:c}=l;function u(l){(0,Ot.shouldUseGroup)(r,l)&&(l.type?(n.if((0,Nt.checkDataType)(l.type,a,h.strictNumbers)),te(t,l),1===e.length&&e[0]===l.type&&s&&(n.else(),(0,Nt.reportTypeError)(t)),n.endIf()):te(t,l),o||n.if($t._`${Ut.default.errors} === ${i||0}`))}!r.$ref||!h.ignoreKeywordsWithRef&&(0,Yt.schemaHasRulesButRef)(r,c)?(h.jtd||function(t,e){if(t.schemaEnv.meta||!t.opts.strictTypes)return;(function(t,e){if(!e.length)return;if(!t.dataTypes.length)return void(t.dataTypes=e);e.forEach((e=>{se(t.dataTypes,e)||ie(t,`type "${e}" not allowed by context "${t.dataTypes.join(",")}"`)})),function(t,e){const s=[];for(const i of t.dataTypes)se(e,i)?s.push(i):e.includes("integer")&&"number"===i&&s.push("integer");t.dataTypes=s}(t,e)})(t,e),t.opts.allowUnionTypes||function(t,e){e.length>1&&(2!==e.length||!e.includes("null"))&&ie(t,"use allowUnionTypes to allow union type keyword")}(t,e);!function(t,e){const s=t.self.RULES.all;for(const i in s){const n=s[i];if("object"==typeof n&&(0,Ot.shouldUseRule)(t.schema,n)){const{type:s}=n.definition;s.length&&!s.some((t=>ee(e,t)))&&ie(t,`missing type "${s.join(",")}" for keyword "${i}"`)}}}(t,t.dataTypes)}(t,e),n.block((()=>{for(const t of c.rules)u(t);u(c.post)}))):n.block((()=>re(t,"$ref",c.all.$ref.definition)))}function te(t,e){const{gen:s,schema:i,opts:{useDefaults:n}}=t;n&&(0,Bt.assignDefaults)(t,e.type),s.block((()=>{for(const s of e.rules)(0,Ot.shouldUseRule)(i,s)&&re(t,s.keyword,s.definition,e.type)}))}function ee(t,e){return t.includes(e)||"number"===e&&t.includes("integer")}function se(t,e){return t.includes(e)||"integer"===e&&t.includes("number")}function ie(t,e){e+=` at "${t.schemaEnv.baseId+t.errSchemaPath}" (strictTypes)`,(0,Yt.checkStrictMode)(t,e,t.opts.strictTypes)}T.validateFunctionCode=function(t){qt(t)&&(Kt(t),Ht(t))?function(t){const{schema:e,opts:s,gen:i}=t;jt(t,(()=>{s.$comment&&e.$comment&&Qt(t),function(t){const{schema:e,opts:s}=t;void 0!==e.default&&s.useDefaults&&s.strictSchema&&(0,Yt.checkStrictMode)(t,"default is ignored in the schema root")}(t),i.let(Ut.default.vErrors,null),i.let(Ut.default.errors,0),s.unevaluated&&function(t){const{gen:e,validateName:s}=t;t.evaluated=e.const("evaluated",$t._`${s}.evaluated`),e.if($t._`${t.evaluated}.dynamicProps`,(()=>e.assign($t._`${t.evaluated}.props`,$t._`undefined`))),e.if($t._`${t.evaluated}.dynamicItems`,(()=>e.assign($t._`${t.evaluated}.items`,$t._`undefined`)))}(t),Zt(t),function(t){const{gen:e,schemaEnv:s,validateName:i,ValidationError:n,opts:r}=t;s.$async?e.if($t._`${Ut.default.errors} === 0`,(()=>e.return(Ut.default.data)),(()=>e.throw($t._`new ${n}(${Ut.default.vErrors})`))):(e.assign($t._`${i}.errors`,Ut.default.vErrors),r.unevaluated&&function({gen:t,evaluated:e,props:s,items:i}){s instanceof $t.Name&&t.assign($t._`${e}.props`,s);i instanceof $t.Name&&t.assign($t._`${e}.items`,i)}(t),e.return($t._`${Ut.default.errors} === 0`))}(t)}))}(t):jt(t,(()=>(0,Dt.topBoolOrEmptySchema)(t)))};class ne{constructor(t,e,s){if((0,Lt.validateKeywordUsage)(t,e,s),this.gen=t.gen,this.allErrors=t.allErrors,this.keyword=s,this.data=t.data,this.schema=t.schema[s],this.$data=e.$data&&t.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,Yt.schemaRefOrVal)(t,this.schema,s,this.$data),this.schemaType=e.schemaType,this.parentSchema=t.schema,this.params={},this.it=t,this.def=e,this.$data)this.schemaCode=t.gen.const("vSchema",he(this.$data,t));else if(this.schemaCode=this.schemaValue,!(0,Lt.validSchemaType)(this.schema,e.schemaType,e.allowUndefined))throw new Error(`${s} value must be ${JSON.stringify(e.schemaType)}`);("code"in e?e.trackErrors:!1!==e.errors)&&(this.errsCount=t.gen.const("_errs",Ut.default.errors))}result(t,e,s){this.failResult((0,$t.not)(t),e,s)}failResult(t,e,s){this.gen.if(t),s?s():this.error(),e?(this.gen.else(),e(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(t,e){this.failResult((0,$t.not)(t),void 0,e)}fail(t){if(void 0===t)return this.error(),void(this.allErrors||this.gen.if(!1));this.gen.if(t),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(t){if(!this.$data)return this.fail(t);const{schemaCode:e}=this;this.fail($t._`${e} !== undefined && (${(0,$t.or)(this.invalid$data(),t)})`)}error(t,e,s){if(e)return this.setParams(e),this._error(t,s),void this.setParams({});this._error(t,s)}_error(t,e){(t?Wt.reportExtraError:Wt.reportError)(this,this.def.error,e)}$dataError(){(0,Wt.reportError)(this,this.def.$dataError||Wt.keyword$DataError)}reset(){if(void 0===this.errsCount)throw new Error('add "trackErrors" to keyword definition');(0,Wt.resetErrorsCount)(this.gen,this.errsCount)}ok(t){this.allErrors||this.gen.if(t)}setParams(t,e){e?Object.assign(this.params,t):this.params=t}block$data(t,e,s=$t.nil){this.gen.block((()=>{this.check$data(t,s),e()}))}check$data(t=$t.nil,e=$t.nil){if(!this.$data)return;const{gen:s,schemaCode:i,schemaType:n,def:r}=this;s.if((0,$t.or)($t._`${i} === undefined`,e)),t!==$t.nil&&s.assign(t,!0),(n.length||r.validateSchema)&&(s.elseIf(this.invalid$data()),this.$dataError(),t!==$t.nil&&s.assign(t,!1)),s.else()}invalid$data(){const{gen:t,schemaCode:e,schemaType:s,def:i,it:n}=this;return(0,$t.or)(function(){if(s.length){if(!(e instanceof $t.Name))throw new Error("ajv implementation error");const t=Array.isArray(s)?s:[s];return $t._`${(0,Nt.checkDataTypes)(t,e,n.opts.strictNumbers,Nt.DataType.Wrong)}`}return $t.nil}(),function(){if(i.validateSchema){const s=t.scopeValue("validate$data",{ref:i.validateSchema});return $t._`!${s}(${e})`}return $t.nil}())}subschema(t,e){const s=(0,Vt.getSubschema)(this.it,t);(0,Vt.extendSubschemaData)(s,this.it,t),(0,Vt.extendSubschemaMode)(s,t);const i=c(l(l({},this.it),s),{items:void 0,props:void 0});return zt(i,e),i}mergeEvaluated(t,e){const{it:s,gen:i}=this;s.opts.unevaluated&&(!0!==s.props&&void 0!==t.props&&(s.props=Yt.mergeEvaluated.props(i,t.props,s.props,e)),!0!==s.items&&void 0!==t.items&&(s.items=Yt.mergeEvaluated.items(i,t.items,s.items,e)))}mergeValidEvaluated(t,e){const{it:s,gen:i}=this;if(s.opts.unevaluated&&(!0!==s.props||!0!==s.items))return i.if(e,(()=>this.mergeEvaluated(t,$t.Name))),!0}}function re(t,e,s,i){const n=new ne(t,s,e);"code"in s?s.code(n,i):n.$data&&s.validate?(0,Lt.funcKeywordCode)(n,s):"macro"in s?(0,Lt.macroKeywordCode)(n,s):(s.compile||s.validate)&&(0,Lt.funcKeywordCode)(n,s)}T.KeywordCxt=ne;const ae=/^\/(?:[^~]|~0|~1)*$/,oe=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function he(t,{dataLevel:e,dataNames:s,dataPathArr:i}){let n,r;if(""===t)return Ut.default.rootData;if("/"===t[0]){if(!ae.test(t))throw new Error(`Invalid JSON-pointer: ${t}`);n=t,r=Ut.default.rootData}else{const a=oe.exec(t);if(!a)throw new Error(`Invalid JSON-pointer: ${t}`);const o=+a[1];if(n=a[2],"#"===n){if(o>=e)throw new Error(h("property/index",o));return i[e-o]}if(o>e)throw new Error(h("data",o));if(r=s[e-o],!n)return r}let a=r;const o=n.split("/");for(const l of o)l&&(r=$t._`${r}${(0,$t.getProperty)((0,Yt.unescapeJsonPointer)(l))}`,a=$t._`${a} && ${r}`);return a;function h(t,s){return`Cannot access ${t} ${s} levels up, current level is ${e}`}}T.getData=he;var le={};Object.defineProperty(le,"__esModule",{value:!0});class ce extends Error{constructor(t){super("validation failed"),this.errors=t,this.ajv=this.validation=!0}}le.default=ce;var ue={};Object.defineProperty(ue,"__esModule",{value:!0});const de=gt;class pe extends Error{constructor(t,e,s,i){super(i||`can't resolve reference ${s} from id ${e}`),this.missingRef=(0,de.resolveUrl)(t,e,s),this.missingSchema=(0,de.normalizeId)((0,de.getFullPath)(t,this.missingRef))}}ue.default=pe;var fe={};Object.defineProperty(fe,"__esModule",{value:!0}),fe.resolveSchema=fe.getCompilingSchema=fe.resolveRef=fe.compileSchema=fe.SchemaEnv=void 0;const me=M,ge=le,ye=k,xe=gt,ve=R,_e=T;class be{constructor(t){var e;let s;this.refs={},this.dynamicAnchors={},"object"==typeof t.schema&&(s=t.schema),this.schema=t.schema,this.schemaId=t.schemaId,this.root=t.root||this,this.baseId=null!==(e=t.baseId)&&void 0!==e?e:(0,xe.normalizeId)(null==s?void 0:s[t.schemaId||"$id"]),this.schemaPath=t.schemaPath,this.localRefs=t.localRefs,this.meta=t.meta,this.$async=null==s?void 0:s.$async,this.refs={}}}function we(t){const e=Se.call(this,t);if(e)return e;const s=(0,xe.getFullPath)(this.opts.uriResolver,t.root.baseId),{es5:i,lines:n}=this.opts.code,{ownProperties:r}=this.opts,a=new me.CodeGen(this.scope,{es5:i,lines:n,ownProperties:r});let o;t.$async&&(o=a.scopeValue("Error",{ref:ge.default,code:me._`require("ajv/dist/runtime/validation_error").default`}));const h=a.scopeName("validate");t.validateName=h;const l={gen:a,allErrors:this.opts.allErrors,data:ye.default.data,parentData:ye.default.parentData,parentDataProperty:ye.default.parentDataProperty,dataNames:[ye.default.data],dataPathArr:[me.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:a.scopeValue("schema",!0===this.opts.code.source?{ref:t.schema,code:(0,me.stringify)(t.schema)}:{ref:t.schema}),validateName:h,ValidationError:o,schema:t.schema,schemaEnv:t,rootId:s,baseId:t.baseId||s,schemaPath:me.nil,errSchemaPath:t.schemaPath||(this.opts.jtd?"":"#"),errorPath:me._`""`,opts:this.opts,self:this};let c;try{this._compilations.add(t),(0,_e.validateFunctionCode)(l),a.optimize(this.opts.code.optimize);const e=a.toString();c=`${a.scopeRefs(ye.default.scope)}return ${e}`,this.opts.code.process&&(c=this.opts.code.process(c,t));const s=new Function(`${ye.default.self}`,`${ye.default.scope}`,c)(this,this.scope.get());if(this.scope.value(h,{ref:s}),s.errors=null,s.schema=t.schema,s.schemaEnv=t,t.$async&&(s.$async=!0),!0===this.opts.code.source&&(s.source={validateName:h,validateCode:e,scopeValues:a._values}),this.opts.unevaluated){const{props:t,items:e}=l;s.evaluated={props:t instanceof me.Name?void 0:t,items:e instanceof me.Name?void 0:e,dynamicProps:t instanceof me.Name,dynamicItems:e instanceof me.Name},s.source&&(s.source.evaluated=(0,me.stringify)(s.evaluated))}return t.validate=s,t}catch(Zf){throw delete t.validate,delete t.validateName,c&&this.logger.error("Error compiling schema, function code:",c),Zf}finally{this._compilations.delete(t)}}function Ee(t){return(0,xe.inlineRef)(t.schema,this.opts.inlineRefs)?t.schema:t.validate?t:we.call(this,t)}function Se(t){for(const i of this._compilations)if(s=t,(e=i).schema===s.schema&&e.root===s.root&&e.baseId===s.baseId)return i;var e,s}function Te(t,e){let s;for(;"string"==typeof(s=this.refs[e]);)e=s;return s||this.schemas[e]||Ae.call(this,t,e)}function Ae(t,e){const s=this.opts.uriResolver.parse(e),i=(0,xe._getFullPath)(this.opts.uriResolver,s);let n=(0,xe.getFullPath)(this.opts.uriResolver,t.baseId,void 0);if(Object.keys(t.schema).length>0&&i===n)return Me.call(this,s,t);const r=(0,xe.normalizeId)(i),a=this.refs[r]||this.schemas[r];if("string"==typeof a){const e=Ae.call(this,t,a);if("object"!=typeof(null==e?void 0:e.schema))return;return Me.call(this,s,e)}if("object"==typeof(null==a?void 0:a.schema)){if(a.validate||we.call(this,a),r===(0,xe.normalizeId)(e)){const{schema:e}=a,{schemaId:s}=this.opts,i=e[s];return i&&(n=(0,xe.resolveUrl)(this.opts.uriResolver,n,i)),new be({schema:e,schemaId:s,root:t,baseId:n})}return Me.call(this,s,a)}}fe.SchemaEnv=be,fe.compileSchema=we,fe.resolveRef=function(t,e,s){var i;s=(0,xe.resolveUrl)(this.opts.uriResolver,e,s);const n=t.refs[s];if(n)return n;let r=Te.call(this,t,s);if(void 0===r){const n=null===(i=t.localRefs)||void 0===i?void 0:i[s],{schemaId:a}=this.opts;n&&(r=new be({schema:n,schemaId:a,root:t,baseId:e}))}return void 0!==r?t.refs[s]=Ee.call(this,r):void 0},fe.getCompilingSchema=Se,fe.resolveSchema=Ae;const Ce=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function Me(t,{baseId:e,schema:s,root:i}){var n;if("/"!==(null===(n=t.fragment)||void 0===n?void 0:n[0]))return;for(const o of t.fragment.slice(1).split("/")){if("boolean"==typeof s)return;const t=s[(0,ve.unescapeFragment)(o)];if(void 0===t)return;const i="object"==typeof(s=t)&&s[this.opts.schemaId];!Ce.has(o)&&i&&(e=(0,xe.resolveUrl)(this.opts.uriResolver,e,i))}let r;if("boolean"!=typeof s&&s.$ref&&!(0,ve.schemaHasRulesButRef)(s,this.RULES)){const t=(0,xe.resolveUrl)(this.opts.uriResolver,e,s.$ref);r=Ae.call(this,i,t)}const{schemaId:a}=this.opts;return r=r||new be({schema:s,schemaId:a,root:i,baseId:e}),r.schema!==r.root.schema?r:void 0}const Ie={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1};var Pe={},Re={};!function(t){function e(){for(var t=arguments.length,e=Array(t),s=0;s<t;s++)e[s]=arguments[s];if(e.length>1){e[0]=e[0].slice(0,-1);for(var i=e.length-1,n=1;n<i;++n)e[n]=e[n].slice(1,-1);return e[i]=e[i].slice(1),e.join("")}return e[0]}function s(t){return"(?:"+t+")"}function i(t){return void 0===t?"undefined":null===t?"null":Object.prototype.toString.call(t).split(" ").pop().split("]").shift().toLowerCase()}function n(t){return t.toUpperCase()}function r(t){return null!=t?t instanceof Array?t:"number"!=typeof t.length||t.split||t.setInterval||t.call?[t]:Array.prototype.slice.call(t):[]}function a(t,e){var s=t;if(e)for(var i in e)s[i]=e[i];return s}function o(t){var i="[A-Za-z]",n="[0-9]",r=e(n,"[A-Fa-f]"),a=s(s("%[EFef]"+r+"%"+r+r+"%"+r+r)+"|"+s("%[89A-Fa-f]"+r+"%"+r+r)+"|"+s("%"+r+r)),o="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",h=e("[\\:\\/\\?\\#\\[\\]\\@]",o),l=t?"[\\uE000-\\uF8FF]":"[]",c=e(i,n,"[\\-\\.\\_\\~]",t?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]");s(i+e(i,n,"[\\+\\-\\.]")+"*"),s(s(a+"|"+e(c,o,"[\\:]"))+"*");var u=s(s("25[0-5]")+"|"+s("2[0-4]"+n)+"|"+s("1"+n+n)+"|"+s("0?[1-9]"+n)+"|0?0?"+n),d=s(u+"\\."+u+"\\."+u+"\\."+u),p=s(r+"{1,4}"),f=s(s(p+"\\:"+p)+"|"+d),m=s(s(p+"\\:")+"{6}"+f),g=s("\\:\\:"+s(p+"\\:")+"{5}"+f),y=s(s(p)+"?\\:\\:"+s(p+"\\:")+"{4}"+f),x=s(s(s(p+"\\:")+"{0,1}"+p)+"?\\:\\:"+s(p+"\\:")+"{3}"+f),v=s(s(s(p+"\\:")+"{0,2}"+p)+"?\\:\\:"+s(p+"\\:")+"{2}"+f),_=s(s(s(p+"\\:")+"{0,3}"+p)+"?\\:\\:"+p+"\\:"+f),b=s(s(s(p+"\\:")+"{0,4}"+p)+"?\\:\\:"+f),w=s(s(s(p+"\\:")+"{0,5}"+p)+"?\\:\\:"+p),E=s(s(s(p+"\\:")+"{0,6}"+p)+"?\\:\\:"),S=s([m,g,y,x,v,_,b,w,E].join("|")),T=s(s(c+"|"+a)+"+");s("[vV]"+r+"+\\."+e(c,o,"[\\:]")+"+"),s(s(a+"|"+e(c,o))+"*");var A=s(a+"|"+e(c,o,"[\\:\\@]"));return s(s(a+"|"+e(c,o,"[\\@]"))+"+"),s(s(A+"|"+e("[\\/\\?]",l))+"*"),{NOT_SCHEME:new RegExp(e("[^]",i,n,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(e("[^\\%\\:]",c,o),"g"),NOT_HOST:new RegExp(e("[^\\%\\[\\]\\:]",c,o),"g"),NOT_PATH:new RegExp(e("[^\\%\\/\\:\\@]",c,o),"g"),NOT_PATH_NOSCHEME:new RegExp(e("[^\\%\\/\\@]",c,o),"g"),NOT_QUERY:new RegExp(e("[^\\%]",c,o,"[\\:\\@\\/\\?]",l),"g"),NOT_FRAGMENT:new RegExp(e("[^\\%]",c,o,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(e("[^]",c,o),"g"),UNRESERVED:new RegExp(c,"g"),OTHER_CHARS:new RegExp(e("[^\\%]",c,h),"g"),PCT_ENCODED:new RegExp(a,"g"),IPV4ADDRESS:new RegExp("^("+d+")$"),IPV6ADDRESS:new RegExp("^\\[?("+S+")"+s(s("\\%25|\\%(?!"+r+"{2})")+"("+T+")")+"?\\]?$")}}var h=o(!1),l=o(!0),c=function(){function t(t,e){var s=[],i=!0,n=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(i=(a=o.next()).done)&&(s.push(a.value),!e||s.length!==e);i=!0);}catch(h){n=!0,r=h}finally{try{!i&&o.return&&o.return()}finally{if(n)throw r}}return s}return function(e,s){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,s);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(t){if(Array.isArray(t)){for(var e=0,s=Array(t.length);e<t.length;e++)s[e]=t[e];return s}return Array.from(t)},d=2147483647,p=36,f=1,m=26,g=38,y=700,x=72,v=128,_="-",b=/^xn--/,w=/[^\0-\x7E]/,E=/[\x2E\u3002\uFF0E\uFF61]/g,S={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},T=p-f,A=Math.floor,C=String.fromCharCode;function M(t){throw new RangeError(S[t])}function I(t,e){for(var s=[],i=t.length;i--;)s[i]=e(t[i]);return s}function P(t,e){var s=t.split("@"),i="";return s.length>1&&(i=s[0]+"@",t=s[1]),i+I((t=t.replace(E,".")).split("."),e).join(".")}function R(t){for(var e=[],s=0,i=t.length;s<i;){var n=t.charCodeAt(s++);if(n>=55296&&n<=56319&&s<i){var r=t.charCodeAt(s++);56320==(64512&r)?e.push(((1023&n)<<10)+(1023&r)+65536):(e.push(n),s--)}else e.push(n)}return e}var k=function(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:p},D=function(t,e){return t+22+75*(t<26)-((0!=e)<<5)},F=function(t,e,s){var i=0;for(t=s?A(t/y):t>>1,t+=A(t/e);t>T*m>>1;i+=p)t=A(t/T);return A(i+(T+1)*t/(t+g))},O=function(t){var e=[],s=t.length,i=0,n=v,r=x,a=t.lastIndexOf(_);a<0&&(a=0);for(var o=0;o<a;++o)t.charCodeAt(o)>=128&&M("not-basic"),e.push(t.charCodeAt(o));for(var h=a>0?a+1:0;h<s;){for(var l=i,c=1,u=p;;u+=p){h>=s&&M("invalid-input");var g=k(t.charCodeAt(h++));(g>=p||g>A((d-i)/c))&&M("overflow"),i+=g*c;var y=u<=r?f:u>=r+m?m:u-r;if(g<y)break;var b=p-y;c>A(d/b)&&M("overflow"),c*=b}var w=e.length+1;r=F(i-l,w,0==l),A(i/w)>d-n&&M("overflow"),n+=A(i/w),i%=w,e.splice(i++,0,n)}return String.fromCodePoint.apply(String,e)},N=function(t){var e=[],s=(t=R(t)).length,i=v,n=0,r=x,a=!0,o=!1,h=void 0;try{for(var l,c=t[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=l.value;u<128&&e.push(C(u))}}catch(G){o=!0,h=G}finally{try{!a&&c.return&&c.return()}finally{if(o)throw h}}var g=e.length,y=g;for(g&&e.push(_);y<s;){var b=d,w=!0,E=!1,S=void 0;try{for(var T,I=t[Symbol.iterator]();!(w=(T=I.next()).done);w=!0){var P=T.value;P>=i&&P<b&&(b=P)}}catch(G){E=!0,S=G}finally{try{!w&&I.return&&I.return()}finally{if(E)throw S}}var k=y+1;b-i>A((d-n)/k)&&M("overflow"),n+=(b-i)*k,i=b;var O=!0,N=!1,B=void 0;try{for(var L,V=t[Symbol.iterator]();!(O=(L=V.next()).done);O=!0){var $=L.value;if($<i&&++n>d&&M("overflow"),$==i){for(var U=n,X=p;;X+=p){var Y=X<=r?f:X>=r+m?m:X-r;if(U<Y)break;var W=U-Y,j=p-Y;e.push(C(D(Y+W%j,0))),U=A(W/j)}e.push(C(D(U,0))),r=F(n,k,y==g),n=0,++y}}}catch(G){N=!0,B=G}finally{try{!O&&V.return&&V.return()}finally{if(N)throw B}}++n,++i}return e.join("")},B=function(t){return P(t,(function(t){return b.test(t)?O(t.slice(4).toLowerCase()):t}))},L=function(t){return P(t,(function(t){return w.test(t)?"xn--"+N(t):t}))},V={version:"2.1.0",ucs2:{decode:R,encode:function(t){return String.fromCodePoint.apply(String,u(t))}},decode:O,encode:N,toASCII:L,toUnicode:B},$={};function U(t){var e=t.charCodeAt(0);return e<16?"%0"+e.toString(16).toUpperCase():e<128?"%"+e.toString(16).toUpperCase():e<2048?"%"+(e>>6|192).toString(16).toUpperCase()+"%"+(63&e|128).toString(16).toUpperCase():"%"+(e>>12|224).toString(16).toUpperCase()+"%"+(e>>6&63|128).toString(16).toUpperCase()+"%"+(63&e|128).toString(16).toUpperCase()}function X(t){for(var e="",s=0,i=t.length;s<i;){var n=parseInt(t.substr(s+1,2),16);if(n<128)e+=String.fromCharCode(n),s+=3;else if(n>=194&&n<224){if(i-s>=6){var r=parseInt(t.substr(s+4,2),16);e+=String.fromCharCode((31&n)<<6|63&r)}else e+=t.substr(s,6);s+=6}else if(n>=224){if(i-s>=9){var a=parseInt(t.substr(s+4,2),16),o=parseInt(t.substr(s+7,2),16);e+=String.fromCharCode((15&n)<<12|(63&a)<<6|63&o)}else e+=t.substr(s,9);s+=9}else e+=t.substr(s,3),s+=3}return e}function Y(t,e){function s(t){var s=X(t);return s.match(e.UNRESERVED)?s:t}return t.scheme&&(t.scheme=String(t.scheme).replace(e.PCT_ENCODED,s).toLowerCase().replace(e.NOT_SCHEME,"")),void 0!==t.userinfo&&(t.userinfo=String(t.userinfo).replace(e.PCT_ENCODED,s).replace(e.NOT_USERINFO,U).replace(e.PCT_ENCODED,n)),void 0!==t.host&&(t.host=String(t.host).replace(e.PCT_ENCODED,s).toLowerCase().replace(e.NOT_HOST,U).replace(e.PCT_ENCODED,n)),void 0!==t.path&&(t.path=String(t.path).replace(e.PCT_ENCODED,s).replace(t.scheme?e.NOT_PATH:e.NOT_PATH_NOSCHEME,U).replace(e.PCT_ENCODED,n)),void 0!==t.query&&(t.query=String(t.query).replace(e.PCT_ENCODED,s).replace(e.NOT_QUERY,U).replace(e.PCT_ENCODED,n)),void 0!==t.fragment&&(t.fragment=String(t.fragment).replace(e.PCT_ENCODED,s).replace(e.NOT_FRAGMENT,U).replace(e.PCT_ENCODED,n)),t}function W(t){return t.replace(/^0*(.*)/,"$1")||"0"}function j(t,e){var s=t.match(e.IPV4ADDRESS)||[],i=c(s,2)[1];return i?i.split(".").map(W).join("."):t}function G(t,e){var s=t.match(e.IPV6ADDRESS)||[],i=c(s,3),n=i[1],r=i[2];if(n){for(var a=n.toLowerCase().split("::").reverse(),o=c(a,2),h=o[0],l=o[1],u=l?l.split(":").map(W):[],d=h.split(":").map(W),p=e.IPV4ADDRESS.test(d[d.length-1]),f=p?7:8,m=d.length-f,g=Array(f),y=0;y<f;++y)g[y]=u[y]||d[m+y]||"";p&&(g[f-1]=j(g[f-1],e));var x=g.reduce((function(t,e,s){if(!e||"0"===e){var i=t[t.length-1];i&&i.index+i.length===s?i.length++:t.push({index:s,length:1})}return t}),[]).sort((function(t,e){return e.length-t.length}))[0],v=void 0;if(x&&x.length>1){var _=g.slice(0,x.index),b=g.slice(x.index+x.length);v=_.join(":")+"::"+b.join(":")}else v=g.join(":");return r&&(v+="%"+r),v}return t}var z=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,H=void 0==="".match(/(){0}/)[1];function q(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s={},i=!1!==e.iri?l:h;"suffix"===e.reference&&(t=(e.scheme?e.scheme+":":"")+"//"+t);var n=t.match(z);if(n){H?(s.scheme=n[1],s.userinfo=n[3],s.host=n[4],s.port=parseInt(n[5],10),s.path=n[6]||"",s.query=n[7],s.fragment=n[8],isNaN(s.port)&&(s.port=n[5])):(s.scheme=n[1]||void 0,s.userinfo=-1!==t.indexOf("@")?n[3]:void 0,s.host=-1!==t.indexOf("//")?n[4]:void 0,s.port=parseInt(n[5],10),s.path=n[6]||"",s.query=-1!==t.indexOf("?")?n[7]:void 0,s.fragment=-1!==t.indexOf("#")?n[8]:void 0,isNaN(s.port)&&(s.port=t.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?n[4]:void 0)),s.host&&(s.host=G(j(s.host,i),i)),void 0!==s.scheme||void 0!==s.userinfo||void 0!==s.host||void 0!==s.port||s.path||void 0!==s.query?void 0===s.scheme?s.reference="relative":void 0===s.fragment?s.reference="absolute":s.reference="uri":s.reference="same-document",e.reference&&"suffix"!==e.reference&&e.reference!==s.reference&&(s.error=s.error||"URI is not a "+e.reference+" reference.");var r=$[(e.scheme||s.scheme||"").toLowerCase()];if(e.unicodeSupport||r&&r.unicodeSupport)Y(s,i);else{if(s.host&&(e.domainHost||r&&r.domainHost))try{s.host=V.toASCII(s.host.replace(i.PCT_ENCODED,X).toLowerCase())}catch(Zf){s.error=s.error||"Host's domain name can not be converted to ASCII via punycode: "+Zf}Y(s,h)}r&&r.parse&&r.parse(s,e)}else s.error=s.error||"URI can not be parsed.";return s}function K(t,e){var s=!1!==e.iri?l:h,i=[];return void 0!==t.userinfo&&(i.push(t.userinfo),i.push("@")),void 0!==t.host&&i.push(G(j(String(t.host),s),s).replace(s.IPV6ADDRESS,(function(t,e,s){return"["+e+(s?"%25"+s:"")+"]"}))),"number"!=typeof t.port&&"string"!=typeof t.port||(i.push(":"),i.push(String(t.port))),i.length?i.join(""):void 0}var Z=/^\.\.?\//,Q=/^\/\.(\/|$)/,J=/^\/\.\.(\/|$)/,tt=/^\/?(?:.|\n)*?(?=\/|$)/;function et(t){for(var e=[];t.length;)if(t.match(Z))t=t.replace(Z,"");else if(t.match(Q))t=t.replace(Q,"/");else if(t.match(J))t=t.replace(J,"/"),e.pop();else if("."===t||".."===t)t="";else{var s=t.match(tt);if(!s)throw new Error("Unexpected dot segment condition");var i=s[0];t=t.slice(i.length),e.push(i)}return e.join("")}function st(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=e.iri?l:h,i=[],n=$[(e.scheme||t.scheme||"").toLowerCase()];if(n&&n.serialize&&n.serialize(t,e),t.host)if(s.IPV6ADDRESS.test(t.host));else if(e.domainHost||n&&n.domainHost)try{t.host=e.iri?V.toUnicode(t.host):V.toASCII(t.host.replace(s.PCT_ENCODED,X).toLowerCase())}catch(Zf){t.error=t.error||"Host's domain name can not be converted to "+(e.iri?"Unicode":"ASCII")+" via punycode: "+Zf}Y(t,s),"suffix"!==e.reference&&t.scheme&&(i.push(t.scheme),i.push(":"));var r=K(t,e);if(void 0!==r&&("suffix"!==e.reference&&i.push("//"),i.push(r),t.path&&"/"!==t.path.charAt(0)&&i.push("/")),void 0!==t.path){var a=t.path;e.absolutePath||n&&n.absolutePath||(a=et(a)),void 0===r&&(a=a.replace(/^\/\//,"/%2F")),i.push(a)}return void 0!==t.query&&(i.push("?"),i.push(t.query)),void 0!==t.fragment&&(i.push("#"),i.push(t.fragment)),i.join("")}function it(t,e){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i={};return arguments[3]||(t=q(st(t,s),s),e=q(st(e,s),s)),!(s=s||{}).tolerant&&e.scheme?(i.scheme=e.scheme,i.userinfo=e.userinfo,i.host=e.host,i.port=e.port,i.path=et(e.path||""),i.query=e.query):(void 0!==e.userinfo||void 0!==e.host||void 0!==e.port?(i.userinfo=e.userinfo,i.host=e.host,i.port=e.port,i.path=et(e.path||""),i.query=e.query):(e.path?("/"===e.path.charAt(0)?i.path=et(e.path):(void 0===t.userinfo&&void 0===t.host&&void 0===t.port||t.path?t.path?i.path=t.path.slice(0,t.path.lastIndexOf("/")+1)+e.path:i.path=e.path:i.path="/"+e.path,i.path=et(i.path)),i.query=e.query):(i.path=t.path,void 0!==e.query?i.query=e.query:i.query=t.query),i.userinfo=t.userinfo,i.host=t.host,i.port=t.port),i.scheme=t.scheme),i.fragment=e.fragment,i}function nt(t,e,s){var i=a({scheme:"null"},s);return st(it(q(t,i),q(e,i),i,!0),i)}function rt(t,e){return"string"==typeof t?t=st(q(t,e),e):"object"===i(t)&&(t=q(st(t,e),e)),t}function at(t,e,s){return"string"==typeof t?t=st(q(t,s),s):"object"===i(t)&&(t=st(t,s)),"string"==typeof e?e=st(q(e,s),s):"object"===i(e)&&(e=st(e,s)),t===e}function ot(t,e){return t&&t.toString().replace(e&&e.iri?l.ESCAPE:h.ESCAPE,U)}function ht(t,e){return t&&t.toString().replace(e&&e.iri?l.PCT_ENCODED:h.PCT_ENCODED,X)}var lt={scheme:"http",domainHost:!0,parse:function(t,e){return t.host||(t.error=t.error||"HTTP URIs must have a host."),t},serialize:function(t,e){var s="https"===String(t.scheme).toLowerCase();return t.port!==(s?443:80)&&""!==t.port||(t.port=void 0),t.path||(t.path="/"),t}},ct={scheme:"https",domainHost:lt.domainHost,parse:lt.parse,serialize:lt.serialize};function ut(t){return"boolean"==typeof t.secure?t.secure:"wss"===String(t.scheme).toLowerCase()}var dt={scheme:"ws",domainHost:!0,parse:function(t,e){var s=t;return s.secure=ut(s),s.resourceName=(s.path||"/")+(s.query?"?"+s.query:""),s.path=void 0,s.query=void 0,s},serialize:function(t,e){if(t.port!==(ut(t)?443:80)&&""!==t.port||(t.port=void 0),"boolean"==typeof t.secure&&(t.scheme=t.secure?"wss":"ws",t.secure=void 0),t.resourceName){var s=t.resourceName.split("?"),i=c(s,2),n=i[0],r=i[1];t.path=n&&"/"!==n?n:void 0,t.query=r,t.resourceName=void 0}return t.fragment=void 0,t}},pt={scheme:"wss",domainHost:dt.domainHost,parse:dt.parse,serialize:dt.serialize},ft={},mt="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",gt="[0-9A-Fa-f]",yt=s(s("%[EFef]"+gt+"%"+gt+gt+"%"+gt+gt)+"|"+s("%[89A-Fa-f]"+gt+"%"+gt+gt)+"|"+s("%"+gt+gt)),xt="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",vt=e("[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",'[\\"\\\\]'),_t="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",bt=new RegExp(mt,"g"),wt=new RegExp(yt,"g"),Et=new RegExp(e("[^]",xt,"[\\.]",'[\\"]',vt),"g"),St=new RegExp(e("[^]",mt,_t),"g"),Tt=St;function At(t){var e=X(t);return e.match(bt)?e:t}var Ct={scheme:"mailto",parse:function(t,e){var s=t,i=s.to=s.path?s.path.split(","):[];if(s.path=void 0,s.query){for(var n=!1,r={},a=s.query.split("&"),o=0,h=a.length;o<h;++o){var l=a[o].split("=");switch(l[0]){case"to":for(var c=l[1].split(","),u=0,d=c.length;u<d;++u)i.push(c[u]);break;case"subject":s.subject=ht(l[1],e);break;case"body":s.body=ht(l[1],e);break;default:n=!0,r[ht(l[0],e)]=ht(l[1],e)}}n&&(s.headers=r)}s.query=void 0;for(var p=0,f=i.length;p<f;++p){var m=i[p].split("@");if(m[0]=ht(m[0]),e.unicodeSupport)m[1]=ht(m[1],e).toLowerCase();else try{m[1]=V.toASCII(ht(m[1],e).toLowerCase())}catch(Zf){s.error=s.error||"Email address's domain name can not be converted to ASCII via punycode: "+Zf}i[p]=m.join("@")}return s},serialize:function(t,e){var s=t,i=r(t.to);if(i){for(var a=0,o=i.length;a<o;++a){var h=String(i[a]),l=h.lastIndexOf("@"),c=h.slice(0,l).replace(wt,At).replace(wt,n).replace(Et,U),u=h.slice(l+1);try{u=e.iri?V.toUnicode(u):V.toASCII(ht(u,e).toLowerCase())}catch(Zf){s.error=s.error||"Email address's domain name can not be converted to "+(e.iri?"Unicode":"ASCII")+" via punycode: "+Zf}i[a]=c+"@"+u}s.path=i.join(",")}var d=t.headers=t.headers||{};t.subject&&(d.subject=t.subject),t.body&&(d.body=t.body);var p=[];for(var f in d)d[f]!==ft[f]&&p.push(f.replace(wt,At).replace(wt,n).replace(St,U)+"="+d[f].replace(wt,At).replace(wt,n).replace(Tt,U));return p.length&&(s.query=p.join("&")),s}},Mt=/^([^\:]+)\:(.*)/,It={scheme:"urn",parse:function(t,e){var s=t.path&&t.path.match(Mt),i=t;if(s){var n=e.scheme||i.scheme||"urn",r=s[1].toLowerCase(),a=s[2],o=n+":"+(e.nid||r),h=$[o];i.nid=r,i.nss=a,i.path=void 0,h&&(i=h.parse(i,e))}else i.error=i.error||"URN can not be parsed.";return i},serialize:function(t,e){var s=e.scheme||t.scheme||"urn",i=t.nid,n=s+":"+(e.nid||i),r=$[n];r&&(t=r.serialize(t,e));var a=t,o=t.nss;return a.path=(i||e.nid)+":"+o,a}},Pt=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,Rt={scheme:"urn:uuid",parse:function(t,e){var s=t;return s.uuid=s.nss,s.nss=void 0,e.tolerant||s.uuid&&s.uuid.match(Pt)||(s.error=s.error||"UUID is not valid."),s},serialize:function(t,e){var s=t;return s.nss=(t.uuid||"").toLowerCase(),s}};$[lt.scheme]=lt,$[ct.scheme]=ct,$[dt.scheme]=dt,$[pt.scheme]=pt,$[Ct.scheme]=Ct,$[It.scheme]=It,$[Rt.scheme]=Rt,t.SCHEMES=$,t.pctEncChar=U,t.pctDecChars=X,t.parse=q,t.removeDotSegments=et,t.serialize=st,t.resolveComponents=it,t.resolve=nt,t.normalize=rt,t.equal=at,t.escapeComponent=ot,t.unescapeComponent=ht,Object.defineProperty(t,"__esModule",{value:!0})}(Re),Object.defineProperty(Pe,"__esModule",{value:!0});const ke=Re;ke.code='require("ajv/dist/runtime/uri").default',Pe.default=ke,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.CodeGen=t.Name=t.nil=t.stringify=t.str=t._=t.KeywordCxt=void 0;var e=T;Object.defineProperty(t,"KeywordCxt",{enumerable:!0,get:function(){return e.KeywordCxt}});var s=M;Object.defineProperty(t,"_",{enumerable:!0,get:function(){return s._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return s.str}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return s.stringify}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return s.nil}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return s.Name}}),Object.defineProperty(t,"CodeGen",{enumerable:!0,get:function(){return s.CodeGen}});const i=le,n=ue,r=U,a=fe,o=M,h=gt,u=$,d=R,f=Ie,m=Pe,g=(t,e)=>new RegExp(t,e);g.code="new RegExp";const y=["removeAdditional","useDefaults","coerceTypes"],x=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),v={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},_={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},b=200;class w{constructor(t={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,t=this.opts=l(l({},t),function(t){var e,s,i,n,r,a,o,h,u,d,p,f,y,x,v,_,w,E,S,T,A,C,M,I,P;const R=t.strict,k=null===(e=t.code)||void 0===e?void 0:e.optimize,D=!0===k||void 0===k?1:k||0,F=null!==(i=null===(s=t.code)||void 0===s?void 0:s.regExp)&&void 0!==i?i:g,O=null!==(n=t.uriResolver)&&void 0!==n?n:m.default;return{strictSchema:null===(a=null!==(r=t.strictSchema)&&void 0!==r?r:R)||void 0===a||a,strictNumbers:null===(h=null!==(o=t.strictNumbers)&&void 0!==o?o:R)||void 0===h||h,strictTypes:null!==(d=null!==(u=t.strictTypes)&&void 0!==u?u:R)&&void 0!==d?d:"log",strictTuples:null!==(f=null!==(p=t.strictTuples)&&void 0!==p?p:R)&&void 0!==f?f:"log",strictRequired:null!==(x=null!==(y=t.strictRequired)&&void 0!==y?y:R)&&void 0!==x&&x,code:t.code?c(l({},t.code),{optimize:D,regExp:F}):{optimize:D,regExp:F},loopRequired:null!==(v=t.loopRequired)&&void 0!==v?v:b,loopEnum:null!==(_=t.loopEnum)&&void 0!==_?_:b,meta:null===(w=t.meta)||void 0===w||w,messages:null===(E=t.messages)||void 0===E||E,inlineRefs:null===(S=t.inlineRefs)||void 0===S||S,schemaId:null!==(T=t.schemaId)&&void 0!==T?T:"$id",addUsedSchema:null===(A=t.addUsedSchema)||void 0===A||A,validateSchema:null===(C=t.validateSchema)||void 0===C||C,validateFormats:null===(M=t.validateFormats)||void 0===M||M,unicodeRegExp:null===(I=t.unicodeRegExp)||void 0===I||I,int32range:null===(P=t.int32range)||void 0===P||P,uriResolver:O}}(t));const{es5:e,lines:s}=this.opts.code;this.scope=new o.ValueScope({scope:{},prefixes:x,es5:e,lines:s}),this.logger=function(t){if(!1===t)return k;if(void 0===t)return console;if(t.log&&t.warn&&t.error)return t;throw new Error("logger must implement log, warn and error methods")}(t.logger);const i=t.validateFormats;t.validateFormats=!1,this.RULES=(0,r.getRules)(),E.call(this,v,t,"NOT SUPPORTED"),E.call(this,_,t,"DEPRECATED","warn"),this._metaOpts=P.call(this),t.formats&&C.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),t.keywords&&I.call(this,t.keywords),"object"==typeof t.meta&&this.addMetaSchema(t.meta),A.call(this),t.validateFormats=i}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:t,meta:e,schemaId:s}=this.opts;let i=f;"id"===s&&(i=l({},f),i.id=i.$id,delete i.$id),e&&t&&this.addMetaSchema(i,i[s],!1)}defaultMeta(){const{meta:t,schemaId:e}=this.opts;return this.opts.defaultMeta="object"==typeof t?t[e]||t:void 0}validate(t,e){let s;if("string"==typeof t){if(s=this.getSchema(t),!s)throw new Error(`no schema with key or ref "${t}"`)}else s=this.compile(t);const i=s(e);return"$async"in s||(this.errors=s.errors),i}compile(t,e){const s=this._addSchema(t,e);return s.validate||this._compileSchemaEnv(s)}compileAsync(t,e){if("function"!=typeof this.opts.loadSchema)throw new Error("options.loadSchema should be a function");const{loadSchema:s}=this.opts;return i.call(this,t,e);function i(t,e){return p(this,null,(function*(){yield r.call(this,t.$schema);const s=this._addSchema(t,e);return s.validate||a.call(this,s)}))}function r(t){return p(this,null,(function*(){t&&!this.getSchema(t)&&(yield i.call(this,{$ref:t},!0))}))}function a(t){return p(this,null,(function*(){try{return this._compileSchemaEnv(t)}catch(Zf){if(!(Zf instanceof n.default))throw Zf;return o.call(this,Zf),yield h.call(this,Zf.missingSchema),a.call(this,t)}}))}function o({missingSchema:t,missingRef:e}){if(this.refs[t])throw new Error(`AnySchema ${t} is loaded but ${e} cannot be resolved`)}function h(t){return p(this,null,(function*(){const s=yield l.call(this,t);this.refs[t]||(yield r.call(this,s.$schema)),this.refs[t]||this.addSchema(s,t,e)}))}function l(t){return p(this,null,(function*(){const e=this._loading[t];if(e)return e;try{return yield this._loading[t]=s(t)}finally{delete this._loading[t]}}))}}addSchema(t,e,s,i=this.opts.validateSchema){if(Array.isArray(t)){for(const e of t)this.addSchema(e,void 0,s,i);return this}let n;if("object"==typeof t){const{schemaId:e}=this.opts;if(n=t[e],void 0!==n&&"string"!=typeof n)throw new Error(`schema ${e} must be string`)}return e=(0,h.normalizeId)(e||n),this._checkUnique(e),this.schemas[e]=this._addSchema(t,s,e,i,!0),this}addMetaSchema(t,e,s=this.opts.validateSchema){return this.addSchema(t,e,!0,s),this}validateSchema(t,e){if("boolean"==typeof t)return!0;let s;if(s=t.$schema,void 0!==s&&"string"!=typeof s)throw new Error("$schema must be a string");if(s=s||this.opts.defaultMeta||this.defaultMeta(),!s)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const i=this.validate(s,t);if(!i&&e){const t="schema is invalid: "+this.errorsText();if("log"!==this.opts.validateSchema)throw new Error(t);this.logger.error(t)}return i}getSchema(t){let e;for(;"string"==typeof(e=S.call(this,t));)t=e;if(void 0===e){const{schemaId:s}=this.opts,i=new a.SchemaEnv({schema:{},schemaId:s});if(e=a.resolveSchema.call(this,i,t),!e)return;this.refs[t]=e}return e.validate||this._compileSchemaEnv(e)}removeSchema(t){if(t instanceof RegExp)return this._removeAllSchemas(this.schemas,t),this._removeAllSchemas(this.refs,t),this;switch(typeof t){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const e=S.call(this,t);return"object"==typeof e&&this._cache.delete(e.schema),delete this.schemas[t],delete this.refs[t],this}case"object":{const e=t;this._cache.delete(e);let s=t[this.opts.schemaId];return s&&(s=(0,h.normalizeId)(s),delete this.schemas[s],delete this.refs[s]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(t){for(const e of t)this.addKeyword(e);return this}addKeyword(t,e){let s;if("string"==typeof t)s=t,"object"==typeof e&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),e.keyword=s);else{if("object"!=typeof t||void 0!==e)throw new Error("invalid addKeywords parameters");if(s=(e=t).keyword,Array.isArray(s)&&!s.length)throw new Error("addKeywords: keyword must be string or non-empty array")}if(F.call(this,s,e),!e)return(0,d.eachItem)(s,(t=>O.call(this,t))),this;B.call(this,e);const i=c(l({},e),{type:(0,u.getJSONTypes)(e.type),schemaType:(0,u.getJSONTypes)(e.schemaType)});return(0,d.eachItem)(s,0===i.type.length?t=>O.call(this,t,i):t=>i.type.forEach((e=>O.call(this,t,i,e)))),this}getKeyword(t){const e=this.RULES.all[t];return"object"==typeof e?e.definition:!!e}removeKeyword(t){const{RULES:e}=this;delete e.keywords[t],delete e.all[t];for(const s of e.rules){const e=s.rules.findIndex((e=>e.keyword===t));e>=0&&s.rules.splice(e,1)}return this}addFormat(t,e){return"string"==typeof e&&(e=new RegExp(e)),this.formats[t]=e,this}errorsText(t=this.errors,{separator:e=", ",dataVar:s="data"}={}){return t&&0!==t.length?t.map((t=>`${s}${t.instancePath} ${t.message}`)).reduce(((t,s)=>t+e+s)):"No errors"}$dataMetaSchema(t,e){const s=this.RULES.all;t=JSON.parse(JSON.stringify(t));for(const i of e){const e=i.split("/").slice(1);let n=t;for(const t of e)n=n[t];for(const t in s){const e=s[t];if("object"!=typeof e)continue;const{$data:i}=e.definition,r=n[t];i&&r&&(n[t]=V(r))}}return t}_removeAllSchemas(t,e){for(const s in t){const i=t[s];e&&!e.test(s)||("string"==typeof i?delete t[s]:i&&!i.meta&&(this._cache.delete(i.schema),delete t[s]))}}_addSchema(t,e,s,i=this.opts.validateSchema,n=this.opts.addUsedSchema){let r;const{schemaId:o}=this.opts;if("object"==typeof t)r=t[o];else{if(this.opts.jtd)throw new Error("schema must be object");if("boolean"!=typeof t)throw new Error("schema must be object or boolean")}let l=this._cache.get(t);if(void 0!==l)return l;s=(0,h.normalizeId)(r||s);const c=h.getSchemaRefs.call(this,t,s);return l=new a.SchemaEnv({schema:t,schemaId:o,meta:e,baseId:s,localRefs:c}),this._cache.set(l.schema,l),n&&!s.startsWith("#")&&(s&&this._checkUnique(s),this.refs[s]=l),i&&this.validateSchema(t,!0),l}_checkUnique(t){if(this.schemas[t]||this.refs[t])throw new Error(`schema with key or id "${t}" already exists`)}_compileSchemaEnv(t){if(t.meta?this._compileMetaSchema(t):a.compileSchema.call(this,t),!t.validate)throw new Error("ajv implementation error");return t.validate}_compileMetaSchema(t){const e=this.opts;this.opts=this._metaOpts;try{a.compileSchema.call(this,t)}finally{this.opts=e}}}function E(t,e,s,i="error"){for(const n in t){const r=n;r in e&&this.logger[i](`${s}: option ${n}. ${t[r]}`)}}function S(t){return t=(0,h.normalizeId)(t),this.schemas[t]||this.refs[t]}function A(){const t=this.opts.schemas;if(t)if(Array.isArray(t))this.addSchema(t);else for(const e in t)this.addSchema(t[e],e)}function C(){for(const t in this.opts.formats){const e=this.opts.formats[t];e&&this.addFormat(t,e)}}function I(t){if(Array.isArray(t))this.addVocabulary(t);else{this.logger.warn("keywords option as map is deprecated, pass array");for(const e in t){const s=t[e];s.keyword||(s.keyword=e),this.addKeyword(s)}}}function P(){const t=l({},this.opts);for(const e of y)delete t[e];return t}t.default=w,w.ValidationError=i.default,w.MissingRefError=n.default;const k={log(){},warn(){},error(){}};const D=/^[a-z_$][a-z0-9_$:-]*$/i;function F(t,e){const{RULES:s}=this;if((0,d.eachItem)(t,(t=>{if(s.keywords[t])throw new Error(`Keyword ${t} is already defined`);if(!D.test(t))throw new Error(`Keyword ${t} has invalid name`)})),e&&e.$data&&!("code"in e)&&!("validate"in e))throw new Error('$data keyword must have "code" or "validate" function')}function O(t,e,s){var i;const n=null==e?void 0:e.post;if(s&&n)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:r}=this;let a=n?r.post:r.rules.find((({type:t})=>t===s));if(a||(a={type:s,rules:[]},r.rules.push(a)),r.keywords[t]=!0,!e)return;const o={keyword:t,definition:c(l({},e),{type:(0,u.getJSONTypes)(e.type),schemaType:(0,u.getJSONTypes)(e.schemaType)})};e.before?N.call(this,a,o,e.before):a.rules.push(o),r.all[t]=o,null===(i=e.implements)||void 0===i||i.forEach((t=>this.addKeyword(t)))}function N(t,e,s){const i=t.rules.findIndex((t=>t.keyword===s));i>=0?t.rules.splice(i,0,e):(t.rules.push(e),this.logger.warn(`rule ${s} is not defined`))}function B(t){let{metaSchema:e}=t;void 0!==e&&(t.$data&&this.opts.$data&&(e=V(e)),t.validateSchema=this.compile(e,!0))}const L={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function V(t){return{anyOf:[t,L]}}}(S);var De={},Fe={},Oe={};Object.defineProperty(Oe,"__esModule",{value:!0});const Ne={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};Oe.default=Ne;var Be={};Object.defineProperty(Be,"__esModule",{value:!0}),Be.callRef=Be.getValidate=void 0;const Le=ue,Ve=Z,$e=M,Ue=k,Xe=fe,Ye=R,We={keyword:"$ref",schemaType:"string",code(t){const{gen:e,schema:s,it:i}=t,{baseId:n,schemaEnv:r,validateName:a,opts:o,self:h}=i,{root:l}=r;if(("#"===s||"#/"===s)&&n===l.baseId)return function(){if(r===l)return Ge(t,a,r,r.$async);const s=e.scopeValue("root",{ref:l});return Ge(t,$e._`${s}.validate`,l,l.$async)}();const c=Xe.resolveRef.call(h,l,n,s);if(void 0===c)throw new Le.default(i.opts.uriResolver,n,s);return c instanceof Xe.SchemaEnv?function(e){const s=je(t,e);Ge(t,s,e,e.$async)}(c):function(i){const n=e.scopeValue("schema",!0===o.code.source?{ref:i,code:(0,$e.stringify)(i)}:{ref:i}),r=e.name("valid"),a=t.subschema({schema:i,dataTypes:[],schemaPath:$e.nil,topSchemaRef:n,errSchemaPath:s},r);t.mergeEvaluated(a),t.ok(r)}(c)}};function je(t,e){const{gen:s}=t;return e.validate?s.scopeValue("validate",{ref:e.validate}):$e._`${s.scopeValue("wrapper",{ref:e})}.validate`}function Ge(t,e,s,i){const{gen:n,it:r}=t,{allErrors:a,schemaEnv:o,opts:h}=r,l=h.passContext?Ue.default.this:$e.nil;function c(t){const e=$e._`${t}.errors`;n.assign(Ue.default.vErrors,$e._`${Ue.default.vErrors} === null ? ${e} : ${Ue.default.vErrors}.concat(${e})`),n.assign(Ue.default.errors,$e._`${Ue.default.vErrors}.length`)}function u(t){var e;if(!r.opts.unevaluated)return;const i=null===(e=null==s?void 0:s.validate)||void 0===e?void 0:e.evaluated;if(!0!==r.props)if(i&&!i.dynamicProps)void 0!==i.props&&(r.props=Ye.mergeEvaluated.props(n,i.props,r.props));else{const e=n.var("props",$e._`${t}.evaluated.props`);r.props=Ye.mergeEvaluated.props(n,e,r.props,$e.Name)}if(!0!==r.items)if(i&&!i.dynamicItems)void 0!==i.items&&(r.items=Ye.mergeEvaluated.items(n,i.items,r.items));else{const e=n.var("items",$e._`${t}.evaluated.items`);r.items=Ye.mergeEvaluated.items(n,e,r.items,$e.Name)}}i?function(){if(!o.$async)throw new Error("async schema referenced by sync schema");const s=n.let("valid");n.try((()=>{n.code($e._`await ${(0,Ve.callValidateCode)(t,e,l)}`),u(e),a||n.assign(s,!0)}),(t=>{n.if($e._`!(${t} instanceof ${r.ValidationError})`,(()=>n.throw(t))),c(t),a||n.assign(s,!1)})),t.ok(s)}():t.result((0,Ve.callValidateCode)(t,e,l),(()=>u(e)),(()=>c(e)))}Be.getValidate=je,Be.callRef=Ge,Be.default=We,Object.defineProperty(Fe,"__esModule",{value:!0});const ze=Be,He=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",Oe.default,ze.default];Fe.default=He;var qe={},Ke={};Object.defineProperty(Ke,"__esModule",{value:!0});const Ze=M,Qe=Ze.operators,Je={maximum:{okStr:"<=",ok:Qe.LTE,fail:Qe.GT},minimum:{okStr:">=",ok:Qe.GTE,fail:Qe.LT},exclusiveMaximum:{okStr:"<",ok:Qe.LT,fail:Qe.GTE},exclusiveMinimum:{okStr:">",ok:Qe.GT,fail:Qe.LTE}},ts={message:({keyword:t,schemaCode:e})=>Ze.str`must be ${Je[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>Ze._`{comparison: ${Je[t].okStr}, limit: ${e}}`},es={keyword:Object.keys(Je),type:"number",schemaType:"number",$data:!0,error:ts,code(t){const{keyword:e,data:s,schemaCode:i}=t;t.fail$data(Ze._`${s} ${Je[e].fail} ${i} || isNaN(${s})`)}};Ke.default=es;var ss={};Object.defineProperty(ss,"__esModule",{value:!0});const is=M,ns={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:{message:({schemaCode:t})=>is.str`must be multiple of ${t}`,params:({schemaCode:t})=>is._`{multipleOf: ${t}}`},code(t){const{gen:e,data:s,schemaCode:i,it:n}=t,r=n.opts.multipleOfPrecision,a=e.let("res"),o=r?is._`Math.abs(Math.round(${a}) - ${a}) > 1e-${r}`:is._`${a} !== parseInt(${a})`;t.fail$data(is._`(${i} === 0 || (${a} = ${s}/${i}, ${o}))`)}};ss.default=ns;var rs={},as={};function os(t){const e=t.length;let s,i=0,n=0;for(;n<e;)i++,s=t.charCodeAt(n++),s>=55296&&s<=56319&&n<e&&(s=t.charCodeAt(n),56320==(64512&s)&&n++);return i}Object.defineProperty(as,"__esModule",{value:!0}),as.default=os,os.code='require("ajv/dist/runtime/ucs2length").default',Object.defineProperty(rs,"__esModule",{value:!0});const hs=M,ls=R,cs=as,us={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:{message:({keyword:t,schemaCode:e})=>hs.str`must NOT have ${"maxLength"===t?"more":"fewer"} than ${e} characters`,params:({schemaCode:t})=>hs._`{limit: ${t}}`},code(t){const{keyword:e,data:s,schemaCode:i,it:n}=t,r="maxLength"===e?hs.operators.GT:hs.operators.LT,a=!1===n.opts.unicode?hs._`${s}.length`:hs._`${(0,ls.useFunc)(t.gen,cs.default)}(${s})`;t.fail$data(hs._`${a} ${r} ${i}`)}};rs.default=us;var ds={};Object.defineProperty(ds,"__esModule",{value:!0});const ps=Z,fs=M,ms={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:{message:({schemaCode:t})=>fs.str`must match pattern "${t}"`,params:({schemaCode:t})=>fs._`{pattern: ${t}}`},code(t){const{data:e,$data:s,schema:i,schemaCode:n,it:r}=t,a=r.opts.unicodeRegExp?"u":"",o=s?fs._`(new RegExp(${n}, ${a}))`:(0,ps.usePattern)(t,i);t.fail$data(fs._`!${o}.test(${e})`)}};ds.default=ms;var gs={};Object.defineProperty(gs,"__esModule",{value:!0});const ys=M,xs={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:{message:({keyword:t,schemaCode:e})=>ys.str`must NOT have ${"maxProperties"===t?"more":"fewer"} than ${e} properties`,params:({schemaCode:t})=>ys._`{limit: ${t}}`},code(t){const{keyword:e,data:s,schemaCode:i}=t,n="maxProperties"===e?ys.operators.GT:ys.operators.LT;t.fail$data(ys._`Object.keys(${s}).length ${n} ${i}`)}};gs.default=xs;var vs={};Object.defineProperty(vs,"__esModule",{value:!0});const _s=Z,bs=M,ws=R,Es={keyword:"required",type:"object",schemaType:"array",$data:!0,error:{message:({params:{missingProperty:t}})=>bs.str`must have required property '${t}'`,params:({params:{missingProperty:t}})=>bs._`{missingProperty: ${t}}`},code(t){const{gen:e,schema:s,schemaCode:i,data:n,$data:r,it:a}=t,{opts:o}=a;if(!r&&0===s.length)return;const h=s.length>=o.loopRequired;if(a.allErrors?function(){if(h||r)t.block$data(bs.nil,l);else for(const e of s)(0,_s.checkReportMissingProp)(t,e)}():function(){const a=e.let("missing");if(h||r){const s=e.let("valid",!0);t.block$data(s,(()=>function(s,r){t.setParams({missingProperty:s}),e.forOf(s,i,(()=>{e.assign(r,(0,_s.propertyInData)(e,n,s,o.ownProperties)),e.if((0,bs.not)(r),(()=>{t.error(),e.break()}))}),bs.nil)}(a,s))),t.ok(s)}else e.if((0,_s.checkMissingProp)(t,s,a)),(0,_s.reportMissingProp)(t,a),e.else()}(),o.strictRequired){const e=t.parentSchema.properties,{definedProperties:i}=t.it;for(const t of s)if(void 0===(null==e?void 0:e[t])&&!i.has(t)){const e=a.schemaEnv.baseId+a.errSchemaPath;(0,ws.checkStrictMode)(a,`required property "${t}" is not defined at "${e}" (strictRequired)`,a.opts.strictRequired)}}function l(){e.forOf("prop",i,(s=>{t.setParams({missingProperty:s}),e.if((0,_s.noPropertyInData)(e,n,s,o.ownProperties),(()=>t.error()))}))}}};vs.default=Es;var Ss={};Object.defineProperty(Ss,"__esModule",{value:!0});const Ts=M,As={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:{message:({keyword:t,schemaCode:e})=>Ts.str`must NOT have ${"maxItems"===t?"more":"fewer"} than ${e} items`,params:({schemaCode:t})=>Ts._`{limit: ${t}}`},code(t){const{keyword:e,data:s,schemaCode:i}=t,n="maxItems"===e?Ts.operators.GT:Ts.operators.LT;t.fail$data(Ts._`${s}.length ${n} ${i}`)}};Ss.default=As;var Cs={},Ms={};Object.defineProperty(Ms,"__esModule",{value:!0});const Is=yt;Is.code='require("ajv/dist/runtime/equal").default',Ms.default=Is,Object.defineProperty(Cs,"__esModule",{value:!0});const Ps=$,Rs=M,ks=R,Ds=Ms,Fs={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:{message:({params:{i:t,j:e}})=>Rs.str`must NOT have duplicate items (items ## ${e} and ${t} are identical)`,params:({params:{i:t,j:e}})=>Rs._`{i: ${t}, j: ${e}}`},code(t){const{gen:e,data:s,$data:i,schema:n,parentSchema:r,schemaCode:a,it:o}=t;if(!i&&!n)return;const h=e.let("valid"),l=r.items?(0,Ps.getSchemaTypes)(r.items):[];function c(i,n){const r=e.name("item"),a=(0,Ps.checkDataTypes)(l,r,o.opts.strictNumbers,Ps.DataType.Wrong),c=e.const("indices",Rs._`{}`);e.for(Rs._`;${i}--;`,(()=>{e.let(r,Rs._`${s}[${i}]`),e.if(a,Rs._`continue`),l.length>1&&e.if(Rs._`typeof ${r} == "string"`,Rs._`${r} += "_"`),e.if(Rs._`typeof ${c}[${r}] == "number"`,(()=>{e.assign(n,Rs._`${c}[${r}]`),t.error(),e.assign(h,!1).break()})).code(Rs._`${c}[${r}] = ${i}`)}))}function u(i,n){const r=(0,ks.useFunc)(e,Ds.default),a=e.name("outer");e.label(a).for(Rs._`;${i}--;`,(()=>e.for(Rs._`${n} = ${i}; ${n}--;`,(()=>e.if(Rs._`${r}(${s}[${i}], ${s}[${n}])`,(()=>{t.error(),e.assign(h,!1).break(a)}))))))}t.block$data(h,(function(){const i=e.let("i",Rs._`${s}.length`),n=e.let("j");t.setParams({i,j:n}),e.assign(h,!0),e.if(Rs._`${i} > 1`,(()=>(l.length>0&&!l.some((t=>"object"===t||"array"===t))?c:u)(i,n)))}),Rs._`${a} === false`),t.ok(h)}};Cs.default=Fs;var Os={};Object.defineProperty(Os,"__esModule",{value:!0});const Ns=M,Bs=R,Ls=Ms,Vs={keyword:"const",$data:!0,error:{message:"must be equal to constant",params:({schemaCode:t})=>Ns._`{allowedValue: ${t}}`},code(t){const{gen:e,data:s,$data:i,schemaCode:n,schema:r}=t;i||r&&"object"==typeof r?t.fail$data(Ns._`!${(0,Bs.useFunc)(e,Ls.default)}(${s}, ${n})`):t.fail(Ns._`${r} !== ${s}`)}};Os.default=Vs;var $s={};Object.defineProperty($s,"__esModule",{value:!0});const Us=M,Xs=R,Ys=Ms,Ws={keyword:"enum",schemaType:"array",$data:!0,error:{message:"must be equal to one of the allowed values",params:({schemaCode:t})=>Us._`{allowedValues: ${t}}`},code(t){const{gen:e,data:s,$data:i,schema:n,schemaCode:r,it:a}=t;if(!i&&0===n.length)throw new Error("enum must have non-empty array");const o=n.length>=a.opts.loopEnum;let h;const l=()=>null!=h?h:h=(0,Xs.useFunc)(e,Ys.default);let c;if(o||i)c=e.let("valid"),t.block$data(c,(function(){e.assign(c,!1),e.forOf("v",r,(t=>e.if(Us._`${l()}(${s}, ${t})`,(()=>e.assign(c,!0).break()))))}));else{if(!Array.isArray(n))throw new Error("ajv implementation error");const t=e.const("vSchema",r);c=(0,Us.or)(...n.map(((e,i)=>function(t,e){const i=n[e];return"object"==typeof i&&null!==i?Us._`${l()}(${s}, ${t}[${e}])`:Us._`${s} === ${i}`}(t,i))))}t.pass(c)}};$s.default=Ws,Object.defineProperty(qe,"__esModule",{value:!0});const js=ss,Gs=rs,zs=ds,Hs=gs,qs=vs,Ks=Ss,Zs=Cs,Qs=Os,Js=$s,ti=[Ke.default,js.default,Gs.default,zs.default,Hs.default,qs.default,Ks.default,Zs.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},Qs.default,Js.default];qe.default=ti;var ei={},si={};Object.defineProperty(si,"__esModule",{value:!0}),si.validateAdditionalItems=void 0;const ii=M,ni=R,ri={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:{message:({params:{len:t}})=>ii.str`must NOT have more than ${t} items`,params:({params:{len:t}})=>ii._`{limit: ${t}}`},code(t){const{parentSchema:e,it:s}=t,{items:i}=e;Array.isArray(i)?ai(t,i):(0,ni.checkStrictMode)(s,'"additionalItems" is ignored when "items" is not an array of schemas')}};function ai(t,e){const{gen:s,schema:i,data:n,keyword:r,it:a}=t;a.items=!0;const o=s.const("len",ii._`${n}.length`);if(!1===i)t.setParams({len:e.length}),t.pass(ii._`${o} <= ${e.length}`);else if("object"==typeof i&&!(0,ni.alwaysValidSchema)(a,i)){const i=s.var("valid",ii._`${o} <= ${e.length}`);s.if((0,ii.not)(i),(()=>function(i){s.forRange("i",e.length,o,(e=>{t.subschema({keyword:r,dataProp:e,dataPropType:ni.Type.Num},i),a.allErrors||s.if((0,ii.not)(i),(()=>s.break()))}))}(i))),t.ok(i)}}si.validateAdditionalItems=ai,si.default=ri;var oi={},hi={};Object.defineProperty(hi,"__esModule",{value:!0}),hi.validateTuple=void 0;const li=M,ci=R,ui=Z,di={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(t){const{schema:e,it:s}=t;if(Array.isArray(e))return pi(t,"additionalItems",e);s.items=!0,(0,ci.alwaysValidSchema)(s,e)||t.ok((0,ui.validateArray)(t))}};function pi(t,e,s=t.schema){const{gen:i,parentSchema:n,data:r,keyword:a,it:o}=t;!function(t){const{opts:i,errSchemaPath:n}=o,r=s.length,h=r===t.minItems&&(r===t.maxItems||!1===t[e]);if(i.strictTuples&&!h){const t=`"${a}" is ${r}-tuple, but minItems or maxItems/${e} are not specified or different at path "${n}"`;(0,ci.checkStrictMode)(o,t,i.strictTuples)}}(n),o.opts.unevaluated&&s.length&&!0!==o.items&&(o.items=ci.mergeEvaluated.items(i,s.length,o.items));const h=i.name("valid"),l=i.const("len",li._`${r}.length`);s.forEach(((e,s)=>{(0,ci.alwaysValidSchema)(o,e)||(i.if(li._`${l} > ${s}`,(()=>t.subschema({keyword:a,schemaProp:s,dataProp:s},h))),t.ok(h))}))}hi.validateTuple=pi,hi.default=di,Object.defineProperty(oi,"__esModule",{value:!0});const fi=hi,mi={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,fi.validateTuple)(t,"items")};oi.default=mi;var gi={};Object.defineProperty(gi,"__esModule",{value:!0});const yi=M,xi=R,vi=Z,_i=si,bi={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:{message:({params:{len:t}})=>yi.str`must NOT have more than ${t} items`,params:({params:{len:t}})=>yi._`{limit: ${t}}`},code(t){const{schema:e,parentSchema:s,it:i}=t,{prefixItems:n}=s;i.items=!0,(0,xi.alwaysValidSchema)(i,e)||(n?(0,_i.validateAdditionalItems)(t,n):t.ok((0,vi.validateArray)(t)))}};gi.default=bi;var wi={};Object.defineProperty(wi,"__esModule",{value:!0});const Ei=M,Si=R,Ti={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:{message:({params:{min:t,max:e}})=>void 0===e?Ei.str`must contain at least ${t} valid item(s)`:Ei.str`must contain at least ${t} and no more than ${e} valid item(s)`,params:({params:{min:t,max:e}})=>void 0===e?Ei._`{minContains: ${t}}`:Ei._`{minContains: ${t}, maxContains: ${e}}`},code(t){const{gen:e,schema:s,parentSchema:i,data:n,it:r}=t;let a,o;const{minContains:h,maxContains:l}=i;r.opts.next?(a=void 0===h?1:h,o=l):a=1;const c=e.const("len",Ei._`${n}.length`);if(t.setParams({min:a,max:o}),void 0===o&&0===a)return void(0,Si.checkStrictMode)(r,'"minContains" == 0 without "maxContains": "contains" keyword ignored');if(void 0!==o&&a>o)return(0,Si.checkStrictMode)(r,'"minContains" > "maxContains" is always invalid'),void t.fail();if((0,Si.alwaysValidSchema)(r,s)){let e=Ei._`${c} >= ${a}`;return void 0!==o&&(e=Ei._`${e} && ${c} <= ${o}`),void t.pass(e)}r.items=!0;const u=e.name("valid");function d(){const t=e.name("_valid"),s=e.let("count",0);p(t,(()=>e.if(t,(()=>function(t){e.code(Ei._`${t}++`),void 0===o?e.if(Ei._`${t} >= ${a}`,(()=>e.assign(u,!0).break())):(e.if(Ei._`${t} > ${o}`,(()=>e.assign(u,!1).break())),1===a?e.assign(u,!0):e.if(Ei._`${t} >= ${a}`,(()=>e.assign(u,!0))))}(s)))))}function p(s,i){e.forRange("i",0,c,(e=>{t.subschema({keyword:"contains",dataProp:e,dataPropType:Si.Type.Num,compositeRule:!0},s),i()}))}void 0===o&&1===a?p(u,(()=>e.if(u,(()=>e.break())))):0===a?(e.let(u,!0),void 0!==o&&e.if(Ei._`${n}.length > 0`,d)):(e.let(u,!1),d()),t.result(u,(()=>t.reset()))}};wi.default=Ti;var Ai={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.validateSchemaDeps=t.validatePropertyDeps=t.error=void 0;const e=M,s=R,i=Z;t.error={message:({params:{property:t,depsCount:s,deps:i}})=>{const n=1===s?"property":"properties";return e.str`must have ${n} ${i} when property ${t} is present`},params:({params:{property:t,depsCount:s,deps:i,missingProperty:n}})=>e._`{property: ${t},
    missingProperty: ${n},
    depsCount: ${s},
    deps: ${i}}`};const n={keyword:"dependencies",type:"object",schemaType:"object",error:t.error,code(t){const[e,s]=function({schema:t}){const e={},s={};for(const i in t){if("__proto__"===i)continue;(Array.isArray(t[i])?e:s)[i]=t[i]}return[e,s]}(t);r(t,e),a(t,s)}};function r(t,s=t.schema){const{gen:n,data:r,it:a}=t;if(0===Object.keys(s).length)return;const o=n.let("missing");for(const h in s){const l=s[h];if(0===l.length)continue;const c=(0,i.propertyInData)(n,r,h,a.opts.ownProperties);t.setParams({property:h,depsCount:l.length,deps:l.join(", ")}),a.allErrors?n.if(c,(()=>{for(const e of l)(0,i.checkReportMissingProp)(t,e)})):(n.if(e._`${c} && (${(0,i.checkMissingProp)(t,l,o)})`),(0,i.reportMissingProp)(t,o),n.else())}}function a(t,e=t.schema){const{gen:n,data:r,keyword:a,it:o}=t,h=n.name("valid");for(const l in e)(0,s.alwaysValidSchema)(o,e[l])||(n.if((0,i.propertyInData)(n,r,l,o.opts.ownProperties),(()=>{const e=t.subschema({keyword:a,schemaProp:l},h);t.mergeValidEvaluated(e,h)}),(()=>n.var(h,!0))),t.ok(h))}t.validatePropertyDeps=r,t.validateSchemaDeps=a,t.default=n}(Ai);var Ci={};Object.defineProperty(Ci,"__esModule",{value:!0});const Mi=M,Ii=R,Pi={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:{message:"property name must be valid",params:({params:t})=>Mi._`{propertyName: ${t.propertyName}}`},code(t){const{gen:e,schema:s,data:i,it:n}=t;if((0,Ii.alwaysValidSchema)(n,s))return;const r=e.name("valid");e.forIn("key",i,(s=>{t.setParams({propertyName:s}),t.subschema({keyword:"propertyNames",data:s,dataTypes:["string"],propertyName:s,compositeRule:!0},r),e.if((0,Mi.not)(r),(()=>{t.error(!0),n.allErrors||e.break()}))})),t.ok(r)}};Ci.default=Pi;var Ri={};Object.defineProperty(Ri,"__esModule",{value:!0});const ki=Z,Di=M,Fi=k,Oi=R,Ni={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:{message:"must NOT have additional properties",params:({params:t})=>Di._`{additionalProperty: ${t.additionalProperty}}`},code(t){const{gen:e,schema:s,parentSchema:i,data:n,errsCount:r,it:a}=t;if(!r)throw new Error("ajv implementation error");const{allErrors:o,opts:h}=a;if(a.props=!0,"all"!==h.removeAdditional&&(0,Oi.alwaysValidSchema)(a,s))return;const l=(0,ki.allSchemaProperties)(i.properties),c=(0,ki.allSchemaProperties)(i.patternProperties);function u(t){e.code(Di._`delete ${n}[${t}]`)}function d(i){if("all"===h.removeAdditional||h.removeAdditional&&!1===s)u(i);else{if(!1===s)return t.setParams({additionalProperty:i}),t.error(),void(o||e.break());if("object"==typeof s&&!(0,Oi.alwaysValidSchema)(a,s)){const s=e.name("valid");"failing"===h.removeAdditional?(p(i,s,!1),e.if((0,Di.not)(s),(()=>{t.reset(),u(i)}))):(p(i,s),o||e.if((0,Di.not)(s),(()=>e.break())))}}}function p(e,s,i){const n={keyword:"additionalProperties",dataProp:e,dataPropType:Oi.Type.Str};!1===i&&Object.assign(n,{compositeRule:!0,createErrors:!1,allErrors:!1}),t.subschema(n,s)}e.forIn("key",n,(s=>{l.length||c.length?e.if(function(s){let n;if(l.length>8){const t=(0,Oi.schemaRefOrVal)(a,i.properties,"properties");n=(0,ki.isOwnProperty)(e,t,s)}else n=l.length?(0,Di.or)(...l.map((t=>Di._`${s} === ${t}`))):Di.nil;return c.length&&(n=(0,Di.or)(n,...c.map((e=>Di._`${(0,ki.usePattern)(t,e)}.test(${s})`)))),(0,Di.not)(n)}(s),(()=>d(s))):d(s)})),t.ok(Di._`${r} === ${Fi.default.errors}`)}};Ri.default=Ni;var Bi={};Object.defineProperty(Bi,"__esModule",{value:!0});const Li=T,Vi=Z,$i=R,Ui=Ri,Xi={keyword:"properties",type:"object",schemaType:"object",code(t){const{gen:e,schema:s,parentSchema:i,data:n,it:r}=t;"all"===r.opts.removeAdditional&&void 0===i.additionalProperties&&Ui.default.code(new Li.KeywordCxt(r,Ui.default,"additionalProperties"));const a=(0,Vi.allSchemaProperties)(s);for(const u of a)r.definedProperties.add(u);r.opts.unevaluated&&a.length&&!0!==r.props&&(r.props=$i.mergeEvaluated.props(e,(0,$i.toHash)(a),r.props));const o=a.filter((t=>!(0,$i.alwaysValidSchema)(r,s[t])));if(0===o.length)return;const h=e.name("valid");for(const u of o)l(u)?c(u):(e.if((0,Vi.propertyInData)(e,n,u,r.opts.ownProperties)),c(u),r.allErrors||e.else().var(h,!0),e.endIf()),t.it.definedProperties.add(u),t.ok(h);function l(t){return r.opts.useDefaults&&!r.compositeRule&&void 0!==s[t].default}function c(e){t.subschema({keyword:"properties",schemaProp:e,dataProp:e},h)}}};Bi.default=Xi;var Yi={};Object.defineProperty(Yi,"__esModule",{value:!0});const Wi=Z,ji=M,Gi=R,zi=R,Hi={keyword:"patternProperties",type:"object",schemaType:"object",code(t){const{gen:e,schema:s,data:i,parentSchema:n,it:r}=t,{opts:a}=r,o=(0,Wi.allSchemaProperties)(s),h=o.filter((t=>(0,Gi.alwaysValidSchema)(r,s[t])));if(0===o.length||h.length===o.length&&(!r.opts.unevaluated||!0===r.props))return;const l=a.strictSchema&&!a.allowMatchingProperties&&n.properties,c=e.name("valid");!0===r.props||r.props instanceof ji.Name||(r.props=(0,zi.evaluatedPropsToName)(e,r.props));const{props:u}=r;function d(t){for(const e in l)new RegExp(t).test(e)&&(0,Gi.checkStrictMode)(r,`property ${e} matches pattern ${t} (use allowMatchingProperties)`)}function p(s){e.forIn("key",i,(i=>{e.if(ji._`${(0,Wi.usePattern)(t,s)}.test(${i})`,(()=>{const n=h.includes(s);n||t.subschema({keyword:"patternProperties",schemaProp:s,dataProp:i,dataPropType:zi.Type.Str},c),r.opts.unevaluated&&!0!==u?e.assign(ji._`${u}[${i}]`,!0):n||r.allErrors||e.if((0,ji.not)(c),(()=>e.break()))}))}))}!function(){for(const t of o)l&&d(t),r.allErrors?p(t):(e.var(c,!0),p(t),e.if(c))}()}};Yi.default=Hi;var qi={};Object.defineProperty(qi,"__esModule",{value:!0});const Ki=R,Zi={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){const{gen:e,schema:s,it:i}=t;if((0,Ki.alwaysValidSchema)(i,s))return void t.fail();const n=e.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},n),t.failResult(n,(()=>t.reset()),(()=>t.error()))},error:{message:"must NOT be valid"}};qi.default=Zi;var Qi={};Object.defineProperty(Qi,"__esModule",{value:!0});const Ji={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:Z.validateUnion,error:{message:"must match a schema in anyOf"}};Qi.default=Ji;var tn={};Object.defineProperty(tn,"__esModule",{value:!0});const en=M,sn=R,nn={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:{message:"must match exactly one schema in oneOf",params:({params:t})=>en._`{passingSchemas: ${t.passing}}`},code(t){const{gen:e,schema:s,parentSchema:i,it:n}=t;if(!Array.isArray(s))throw new Error("ajv implementation error");if(n.opts.discriminator&&i.discriminator)return;const r=s,a=e.let("valid",!1),o=e.let("passing",null),h=e.name("_valid");t.setParams({passing:o}),e.block((function(){r.forEach(((s,i)=>{let r;(0,sn.alwaysValidSchema)(n,s)?e.var(h,!0):r=t.subschema({keyword:"oneOf",schemaProp:i,compositeRule:!0},h),i>0&&e.if(en._`${h} && ${a}`).assign(a,!1).assign(o,en._`[${o}, ${i}]`).else(),e.if(h,(()=>{e.assign(a,!0),e.assign(o,i),r&&t.mergeEvaluated(r,en.Name)}))}))})),t.result(a,(()=>t.reset()),(()=>t.error(!0)))}};tn.default=nn;var rn={};Object.defineProperty(rn,"__esModule",{value:!0});const an=R,on={keyword:"allOf",schemaType:"array",code(t){const{gen:e,schema:s,it:i}=t;if(!Array.isArray(s))throw new Error("ajv implementation error");const n=e.name("valid");s.forEach(((e,s)=>{if((0,an.alwaysValidSchema)(i,e))return;const r=t.subschema({keyword:"allOf",schemaProp:s},n);t.ok(n),t.mergeEvaluated(r)}))}};rn.default=on;var hn={};Object.defineProperty(hn,"__esModule",{value:!0});const ln=M,cn=R,un={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:{message:({params:t})=>ln.str`must match "${t.ifClause}" schema`,params:({params:t})=>ln._`{failingKeyword: ${t.ifClause}}`},code(t){const{gen:e,parentSchema:s,it:i}=t;void 0===s.then&&void 0===s.else&&(0,cn.checkStrictMode)(i,'"if" without "then" and "else" is ignored');const n=dn(i,"then"),r=dn(i,"else");if(!n&&!r)return;const a=e.let("valid",!0),o=e.name("_valid");if(function(){const e=t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},o);t.mergeEvaluated(e)}(),t.reset(),n&&r){const s=e.let("ifClause");t.setParams({ifClause:s}),e.if(o,h("then",s),h("else",s))}else n?e.if(o,h("then")):e.if((0,ln.not)(o),h("else"));function h(s,i){return()=>{const n=t.subschema({keyword:s},o);e.assign(a,o),t.mergeValidEvaluated(n,a),i?e.assign(i,ln._`${s}`):t.setParams({ifClause:s})}}t.pass(a,(()=>t.error(!0)))}};function dn(t,e){const s=t.schema[e];return void 0!==s&&!(0,cn.alwaysValidSchema)(t,s)}hn.default=un;var pn={};Object.defineProperty(pn,"__esModule",{value:!0});const fn=R,mn={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:e,it:s}){void 0===e.if&&(0,fn.checkStrictMode)(s,`"${t}" without "if" is ignored`)}};pn.default=mn,Object.defineProperty(ei,"__esModule",{value:!0});const gn=si,yn=oi,xn=hi,vn=gi,_n=wi,bn=Ai,wn=Ci,En=Ri,Sn=Bi,Tn=Yi,An=qi,Cn=Qi,Mn=tn,In=rn,Pn=hn,Rn=pn;ei.default=function(t=!1){const e=[An.default,Cn.default,Mn.default,In.default,Pn.default,Rn.default,wn.default,En.default,bn.default,Sn.default,Tn.default];return t?e.push(yn.default,vn.default):e.push(gn.default,xn.default),e.push(_n.default),e};var kn={},Dn={};Object.defineProperty(Dn,"__esModule",{value:!0});const Fn=M,On={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:{message:({schemaCode:t})=>Fn.str`must match format "${t}"`,params:({schemaCode:t})=>Fn._`{format: ${t}}`},code(t,e){const{gen:s,data:i,$data:n,schema:r,schemaCode:a,it:o}=t,{opts:h,errSchemaPath:l,schemaEnv:c,self:u}=o;h.validateFormats&&(n?function(){const n=s.scopeValue("formats",{ref:u.formats,code:h.code.formats}),r=s.const("fDef",Fn._`${n}[${a}]`),o=s.let("fType"),l=s.let("format");s.if(Fn._`typeof ${r} == "object" && !(${r} instanceof RegExp)`,(()=>s.assign(o,Fn._`${r}.type || "string"`).assign(l,Fn._`${r}.validate`)),(()=>s.assign(o,Fn._`"string"`).assign(l,r))),t.fail$data((0,Fn.or)(!1===h.strictSchema?Fn.nil:Fn._`${a} && !${l}`,function(){const t=c.$async?Fn._`(${r}.async ? await ${l}(${i}) : ${l}(${i}))`:Fn._`${l}(${i})`,s=Fn._`(typeof ${l} == "function" ? ${t} : ${l}.test(${i}))`;return Fn._`${l} && ${l} !== true && ${o} === ${e} && !${s}`}()))}():function(){const n=u.formats[r];if(!n)return void function(){if(!1===h.strictSchema)return void u.logger.warn(t());throw new Error(t());function t(){return`unknown format "${r}" ignored in schema at path "${l}"`}}();if(!0===n)return;const[a,o,d]=function(t){const e=t instanceof RegExp?(0,Fn.regexpCode)(t):h.code.formats?Fn._`${h.code.formats}${(0,Fn.getProperty)(r)}`:void 0,i=s.scopeValue("formats",{key:r,ref:t,code:e});if("object"==typeof t&&!(t instanceof RegExp))return[t.type||"string",t.validate,Fn._`${i}.validate`];return["string",t,i]}(n);a===e&&t.pass(function(){if("object"==typeof n&&!(n instanceof RegExp)&&n.async){if(!c.$async)throw new Error("async format in sync schema");return Fn._`await ${d}(${i})`}return"function"==typeof o?Fn._`${d}(${i})`:Fn._`${d}.test(${i})`}())}())}};Dn.default=On,Object.defineProperty(kn,"__esModule",{value:!0});const Nn=[Dn.default];kn.default=Nn;var Bn={};Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.contentVocabulary=Bn.metadataVocabulary=void 0,Bn.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"],Bn.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"],Object.defineProperty(De,"__esModule",{value:!0});const Ln=qe,Vn=ei,$n=kn,Un=Bn,Xn=[Fe.default,Ln.default,(0,Vn.default)(),$n.default,Un.metadataVocabulary,Un.contentVocabulary];De.default=Xn;var Yn,Wn,jn={},Gn={};Yn=Gn,Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.DiscrError=void 0,(Wn=Yn.DiscrError||(Yn.DiscrError={})).Tag="tag",Wn.Mapping="mapping",Object.defineProperty(jn,"__esModule",{value:!0});const zn=M,Hn=Gn,qn=fe,Kn=R,Zn={keyword:"discriminator",type:"object",schemaType:"object",error:{message:({params:{discrError:t,tagName:e}})=>t===Hn.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:t,tag:e,tagName:s}})=>zn._`{error: ${t}, tag: ${s}, tagValue: ${e}}`},code(t){const{gen:e,data:s,schema:i,parentSchema:n,it:r}=t,{oneOf:a}=n;if(!r.opts.discriminator)throw new Error("discriminator: requires discriminator option");const o=i.propertyName;if("string"!=typeof o)throw new Error("discriminator: requires propertyName");if(i.mapping)throw new Error("discriminator: mapping is not supported");if(!a)throw new Error("discriminator: requires oneOf keyword");const h=e.let("valid",!1),l=e.const("tag",zn._`${s}${(0,zn.getProperty)(o)}`);function c(s){const i=e.name("valid"),n=t.subschema({keyword:"oneOf",schemaProp:s},i);return t.mergeEvaluated(n,zn.Name),i}e.if(zn._`typeof ${l} == "string"`,(()=>function(){const s=function(){var t;const e={},s=h(n);let i=!0;for(let n=0;n<a.length;n++){let e=a[n];(null==e?void 0:e.$ref)&&!(0,Kn.schemaHasRulesButRef)(e,r.self.RULES)&&(e=qn.resolveRef.call(r.self,r.schemaEnv.root,r.baseId,null==e?void 0:e.$ref),e instanceof qn.SchemaEnv&&(e=e.schema));const c=null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t[o];if("object"!=typeof c)throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${o}"`);i=i&&(s||h(e)),l(c,n)}if(!i)throw new Error(`discriminator: "${o}" must be required`);return e;function h({required:t}){return Array.isArray(t)&&t.includes(o)}function l(t,e){if(t.const)c(t.const,e);else{if(!t.enum)throw new Error(`discriminator: "properties/${o}" must have "const" or "enum"`);for(const s of t.enum)c(s,e)}}function c(t,s){if("string"!=typeof t||t in e)throw new Error(`discriminator: "${o}" values must be unique strings`);e[t]=s}}();e.if(!1);for(const t in s)e.elseIf(zn._`${l} === ${t}`),e.assign(h,c(s[t]));e.else(),t.error(!1,{discrError:Hn.DiscrError.Mapping,tag:l,tagName:o}),e.endIf()}()),(()=>t.error(!1,{discrError:Hn.DiscrError.Tag,tag:l,tagName:o}))),t.ok(h)}};jn.default=Zn;const Qn={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.MissingRefError=e.ValidationError=e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=void 0;const s=S,i=De,n=jn,r=Qn,a=["/properties"],o="http://json-schema.org/draft-07/schema";class h extends s.default{_addVocabularies(){super._addVocabularies(),i.default.forEach((t=>this.addVocabulary(t))),this.opts.discriminator&&this.addKeyword(n.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const t=this.opts.$data?this.$dataMetaSchema(r,a):r;this.addMetaSchema(t,o,!1),this.refs["http://json-schema.org/schema"]=o}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(o)?o:void 0)}}t.exports=e=h,Object.defineProperty(e,"__esModule",{value:!0}),e.default=h;var l=T;Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return l.KeywordCxt}});var c=M;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return c._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return c.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return c.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return c.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return c.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return c.CodeGen}});var u=le;Object.defineProperty(e,"ValidationError",{enumerable:!0,get:function(){return u.default}});var d=ue;Object.defineProperty(e,"MissingRefError",{enumerable:!0,get:function(){return d.default}})}(E,w);const Jn=y(w);class tr{constructor(t,e){d(this,"ajv"),d(this,"handlers"),d(this,"_state","0"),d(this,"_ws"),d(this,"idleMS",599e3),d(this,"_isIdle",!1),d(this,"_idleTimeoutID",-1),d(this,"onOpen",globalThis.doNothing),d(this,"onRetry",globalThis.doNothing),d(this,"onFailed",globalThis.doNothing),d(this,"onSendFailed",globalThis.doNothing),d(this,"onRecvException",globalThis.doNothing),this.ajv=t,this.handlers=e}get state(){return this._state}connect(t,e){"NORMAL"!=this._state&&window.setTimeout((()=>{this._state="NORMAL",this.onOpen(this._ws)}),100)}getWebSocketURL(){return""}setWebSocketCallbacks(t){t.onopen=null,t.onclose=()=>{this._state="CLOSED"},t.onerror=()=>{this._state="CLOSED"},t.onmessage=t=>{this._handleRecv(t.data)}}request(t){const e=this.handlers[t],s=e.state;"PENDING"!=s&&(e.state="REQUESTED"),"IDLE"==s&&(e.prepareSendData(),this.sendRequestIfAny())}_handleRecv(t){window.clearTimeout(this._idleTimeoutID),this._idleTimeoutID=window.setTimeout((()=>this._isIdle=!0),this.idleMS);const e=this.getPending();null!==e&&(this._state="NORMAL",e.onRecvAny(e,t),t?this._parseRecv(e,t):(e.state="SUCCESS",e.onRecvSuccess(e,{})),"SUCCESS"==e.state&&(e.state="IDLE"),this.sendRequestIfAny())}_parseRecv(t,e){try{const s=JSON.parse(e);t.validate(s)?(t.state="SUCCESS",t.nTotalTry=1,t.onRecvSuccess(t,s)):t.validateError(s)?(t.state="ERROR",t.onRecvError(t,s)):(t.state="ERROR",t.onRecvInvalid(t,e))}catch(s){t.state="ERROR",this.onRecvException(t,s)}}sendRequestIfAny(){if(null!==this.getPending())return;const t=this.getRequested();null!==t&&this._sendRequest(t)}_sendRequest(t){var e;this._checkIfCanSend(t)?(window.clearTimeout(this._idleTimeoutID),t.nTried++,t.state="PENDING",t.onSend(t,t.nTried),window.setTimeout((()=>{this._handleRecv(t.testMode.recvMsg)}),null!=(e=t.testMode.sendLatency)?e:0)):t.state="ERROR"}_checkIfCanSend(t){return t.nTried>=t.nTotalTry?(this.onSendFailed(t,"retry-limit"),!1):!this._isIdle||(this.onSendFailed(t,"idle"),!1)}getPending(){for(const t of Object.values(this.handlers))if("PENDING"==t.state)return t;return null}getRequested(){return null}initWebsocket(t,e,s){let i=!1;return new Promise(((n,r)=>{const a=()=>{s<=0?r():i||(s--,i=!0,console.log("retrying connection to websocket! url: "+t+", remaining retries: "+s),this.onRetry(s),this.initWebsocket(t,e,s).then(n,r))};setTimeout((()=>{i||(console.log("opening websocket timed out: "+t),a())}),e);const o=new WebSocket(t);o.onopen=()=>{i?o.close():(console.log("websocket to opened! url: "+t),i=!0,n(o))},o.onclose=()=>{console.warn("websocket closed! url: "+t),a()},o.onerror=()=>{console.warn("websocket error! url: "+t),a()}}))}}class er{constructor(t,e,s,i){d(this,"name"),d(this,"validate"),d(this,"validateError"),d(this,"nTried",0),d(this,"nTotalTry",1),d(this,"timeoutMS",15e3),d(this,"_state"),d(this,"_data"),d(this,"_timeoutID",-1),d(this,"_intervalID",-1),d(this,"onSend",globalThis.doNothing),d(this,"onRecvAny",globalThis.doNothing),d(this,"onRecvSuccess",globalThis.doNothing),d(this,"onRecvError",globalThis.doNothing),d(this,"onRecvInvalid",globalThis.doNothing),d(this,"testMode",{}),this.name=t,this.validate=i.compile(e.R),this.validateError=i.compile(s),this._state="IDLE",this._data=void 0}get state(){return this._state}set state(t){this._state=t,"IDLE"==t&&(this.nTried=0,this.nTotalTry=1)}setTimeout(t){window.clearTimeout(this._timeoutID),this._timeoutID=window.setTimeout(t,this.timeoutMS)}setInterval(t,e){window.clearInterval(this._intervalID),this._intervalID=window.setInterval(t,e)}clearTimeout(){window.clearTimeout(this._timeoutID)}clearInterval(){window.clearInterval(this._intervalID)}get dataToSend(){return this._data}prepareSendData(){}}class sr extends tr{constructor(t,e){super(t,e),d(this,"sessionId"),d(this,"sessionToken"),d(this,"platformUrl");let s=globalThis.API.params.get("sessionId");this.sessionId=null!==s?s:"0",s=globalThis.API.params.get("sessionToken"),this.sessionToken=null!==s?s:"0",s=globalThis.API.params.get("platformUrl"),this.platformUrl=null!==s?window.atob(s):"0"}getWebSocketURL(){return"true"==globalThis.API.params.get("secure")||"https:"==window.location.protocol?`wss://${this.platformUrl}`:"http:"==window.location.protocol?`ws://${this.platformUrl}`:""}getRequested(){return"REQUESTED"==this.handlers.startGame.state?this.handlers.startGame:"REQUESTED"==this.handlers.bet.state?this.handlers.bet:"REQUESTED"==this.handlers.step.state?this.handlers.step:"REQUESTED"==this.handlers.updateBalance.state?this.handlers.updateBalance:null}test(t){let e=this.handlers.startGame.validate;e(t);let s=e.errors;s&&(s.forEach((t=>console.log(t))),e=this.handlers.startGame.validateError,e(t),s=e.errors,s&&s.forEach((t=>console.log(t))))}}const ir={type:"object",properties:{},required:[]},nr={type:"object",properties:{},required:[]},rr={StartGame:{R:nr},Bet:{S:{type:"object",properties:{state:{type:"string",enum:["bet","cheatbet"]},debug:{type:"string"},pick:{type:"number"},dice:{type:"array",items:{type:"number"}},isBonus:{type:"boolean"},bonusDice:{type:"number"}},required:["state","debug","pick","dice","isBonus","bonusDice"]},R:{type:"object",properties:l({},ir.properties),required:ir.required}},Step:{S:nr,R:nr}},ar=new class{constructor(){d(this,"totalwin",0),d(this,"debug",""),d(this,"state",""),d(this,"pick",0),d(this,"dice",[]),d(this,"isBonus",!1),d(this,"bonusDice",0),d(this,"nNonWin",0),d(this,"demoMessages",[]),d(this,"demoResults",[]),d(this,"combCheatTable",[[1066456,738475703,916907404],[64344603,801505779,894285542],[770991269,832449767,985385661],[814542285,872125537,1027873085],[908116364,962889641,1086056791],[977719840,1111690215,1146010273],[1129771500,1152912225,1162662783],[1145692058,1162657968,1166510409],[1152315930,1162673562,1166516494],[1120046750,1144839119,1162855544]])}getDemoExtraction(t){let e;e=!0===pgame.controlCaseGS?9:!0===pgame.controlCaseWild?10:7;let s=this.demoResults[e];Object.assign(this,s)}recvBetGameData(t){Object.assign(this,t)}};ar.demoMessages=['{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[9,4,4,7,4],[9,2,0,0,1],[5,6,3,7,8],[2,1,0,4,6],[5,0,1,6,0]],"mysteryWin":0,"nScatter":0,"ready":0,"shootingWild":[],"totalwin":0,"winningLines":[]}','{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[1,0,2,4,5],[4,2,9,5,3],[5,7,1,0,2],[0,0,2,4,8],[5,0,8,0,5]],"mysteryWin":0,"nScatter":1,"ready":0,"shootingWild":[],"totalwin":0,"winningLines":[]}','{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[3,4,3,0,3],[9,7,4,0,4],[1,7,2,0,1],[9,4,5,5,0],[4,1,7,6,1]],"mysteryWin":0,"nScatter":0,"ready":0,"shootingWild":[],"totalwin":50,"winningLines":[{"lineID":2,"numWinningSymbs":3,"position":[0,1,2,0,0],"symbID":0,"totWin":50}]}','{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[4,2,1,3,5],[2,8,0,3,0],[0,0,3,6,4],[9,1,0,0,3],[0,1,0,4,6]],"mysteryWin":0,"nScatter":0,"ready":0,"shootingWild":[],"totalwin":150,"winningLines":[{"lineID":6,"numWinningSymbs":3,"position":[0,1,2,0,0],"symbID":3,"totWin":150}]}','{"bonus":null,"bonusWin":3300,"freeSpins":[],"grid":[[6,6,2,2,7],[8,4,2,7,7],[6,4,8,5,8],[0,3,6,3,8],[1,7,7,1,5]],"mysteryWin":0,"nScatter":0,"ready":0,"shootingWild":[[0,1]],"totalwin":600,"winningLines":[{"lineID":0,"numWinningSymbs":3,"position":[0,1,2,3,4],"symbID":2,"totWin":100},{"lineID":1,"numWinningSymbs":3,"position":[0,1,2,3,4],"symbID":4,"totWin":250},{"lineID":5,"numWinningSymbs":3,"position":[0,1,2,3,0],"symbID":4,"totWin":250}]}','{"bonus":null,"bonusWin":11400,"freeSpins":[],"grid":[[7,5,2,3,2],[0,9,7,5,2],[0,4,2,0,1],[5,3,6,7,3],[7,0,4,0,1]],"mysteryWin":200,"nScatter":1,"ready":0,"shootingWild":[],"totalwin":200,"winningLines":[]}','{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[3,7,6,2,1],[2,2,8,7,3],[5,0,8,6,7],[5,4,0,1,6],[7,1,3,5,4]],"mysteryWin":500,"nScatter":0,"ready":0,"shootingWild":[],"totalwin":2000,"winningLines":[{"lineID":0,"numWinningSymbs":3,"position":[0,1,2,3,4],"symbID":6,"totWin":1500}]}','{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[7,0,3,9,4],[2,5,7,7,5],[8,5,1,0,1],[1,1,1,3,2],[9,5,0,9,1]],"mysteryWin":500,"nScatter":1,"ready":0,"shootingWild":[[3,1],[0,3]],"totalwin":0,"winningLines":[]}','{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[1,6,3,5,0],[5,6,4,0,0],[3,6,5,3,2],[0,7,9,1,6],[7,4,9,1,0]],"mysteryWin":1000,"nScatter":2,"ready":0,"shootingWild":[[3,3],[1,3]],"totalwin":3900,"winningLines":[{"lineID":1,"numWinningSymbs":3,"position":[0,1,2,3,4],"symbID":6,"totWin":1500},{"lineID":6,"numWinningSymbs":4,"position":[0,1,2,3,4],"symbID":5,"totWin":1200},{"lineID":8,"numWinningSymbs":4,"position":[0,1,2,3,0],"symbID":3,"totWin":200}]}','{"bonus":{"pickWins":[800,0,0,0,0],"scatters":[{"fakeValues0":600,"fakeValues1":700,"fakeValues2":900,"fakeValues3":1000,"reelID":2,"slotID":0},{"fakeValues0":0,"fakeValues1":0,"fakeValues2":0,"fakeValues3":0,"reelID":3,"slotID":1},{"fakeValues0":0,"fakeValues1":0,"fakeValues2":0,"fakeValues3":0,"reelID":0,"slotID":0},{"fakeValues0":0,"fakeValues1":0,"fakeValues2":0,"fakeValues3":0,"reelID":0,"slotID":0},{"fakeValues0":0,"fakeValues1":0,"fakeValues2":0,"fakeValues3":0,"reelID":0,"slotID":0}]},"bonusWin":500,"freeSpins":[{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[8,4,9,2,4],[8,4,9,1,0],[4,2,4,3,9],[8,4,0,5,0],[2,5,0,5,5]],"mysteryWin":0,"nScatter":2,"ready":0,"shootingWild":[],"totalwin":400,"winningLines":[{"lineID":5,"numWinningSymbs":4,"position":[0,1,2,3,3435973836],"symbID":4,"totWin":400}]},{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[2,2,0,0,6],[0,5,3,0,0],[2,6,9,5,5],[7,8,5,3,6],[1,3,0,1,3]],"mysteryWin":0,"nScatter":1,"ready":0,"shootingWild":[[0,3]],"totalwin":0,"winningLines":[]},{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[2,6,2,4,0],[0,0,8,0,9],[6,0,5,3,2],[8,2,1,1,5],[5,6,3,0,0]],"mysteryWin":0,"nScatter":0,"ready":0,"shootingWild":[],"totalwin":0,"winningLines":[]},{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[4,3,2,3,2],[8,9,1,1,8],[1,7,3,5,5],[2,4,1,9,8],[1,5,5,5,3]],"mysteryWin":0,"nScatter":2,"ready":0,"shootingWild":[],"totalwin":0,"winningLines":[]},{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[3,0,1,0,2],[3,1,0,0,6],[1,4,5,4,0],[1,2,1,6,2],[2,2,8,1,1]],"mysteryWin":0,"nScatter":0,"ready":0,"shootingWild":[],"totalwin":0,"winningLines":[]},{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[9,4,9,6,5],[7,4,9,1,8],[5,4,3,3,0],[0,4,1,3,4],[3,0,4,7,3]],"mysteryWin":0,"nScatter":2,"ready":0,"shootingWild":[],"totalwin":400,"winningLines":[{"lineID":1,"numWinningSymbs":4,"position":[0,1,2,3,3435973836],"symbID":4,"totWin":400}]},{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[4,3,5,8,4],[4,4,1,0,7],[9,8,8,3,0],[8,3,6,0,2],[0,0,5,0,7]],"mysteryWin":0,"nScatter":0,"ready":0,"shootingWild":[],"totalwin":300,"winningLines":[{"lineID":4,"numWinningSymbs":3,"position":[0,1,2,3435973836,3435973836],"symbID":1,"totWin":50},{"lineID":6,"numWinningSymbs":5,"position":[0,1,2,3,4],"symbID":0,"totWin":250}]},{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[2,2,4,9,1],[6,9,4,4,9],[8,6,4,2,6],[3,5,4,0,1],[6,3,5,5,7]],"mysteryWin":100,"nScatter":2,"ready":0,"shootingWild":[],"totalwin":400,"winningLines":[{"lineID":0,"numWinningSymbs":4,"position":[0,1,2,3,3435973836],"symbID":4,"totWin":400}]}],"grid":[[3,9,2,8,7],[0,0,3,6,6],[9,9,1,2,2],[7,0,9,8,7],[3,3,0,1,4]],"mysteryWin":0,"nScatter":2,"ready":0,"shootingWild":[],"totalwin":1500,"winningLines":[]}','{"bonus":null,"bonusWin":9800,"freeSpins":[],"grid":[[8,8,3,5,6],[2,9,5,3,6],[6,3,4,4,0],[3,2,2,3,6],[6,9,3,6,2]],"mysteryWin":0,"nScatter":2,"shootingWild":[[3,2],[1,2],[2,3]],"totalwin":10900,"winningLines":[{"lineID":3,"numWinningSymbs":4,"position":[0,1,2,3],"symbID":7,"totWin":10000},{"lineID":8,"numWinningSymbs":5,"position":[0,1,2,3,4],"symbID":3,"totWin":700},{"lineID":9,"numWinningSymbs":4,"position":[0,1,2,3],"symbID":3,"totWin":200}]}'],ar.demoResults=ar.demoMessages.map((t=>JSON.parse(t)));var or=(t=>(t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2",t))(or||{}),hr=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS",t))(hr||{}),lr=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(lr||{}),cr=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(cr||{}),ur=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(ur||{}),dr=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(dr||{}),pr=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(pr||{}),fr=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(fr||{}),mr=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(mr||{}),gr=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(gr||{}),yr=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(yr||{}),xr=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(xr||{}),vr=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))(vr||{}),_r=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))(_r||{}),br=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(br||{}),wr=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(wr||{}),Er=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(Er||{}),Sr=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(Sr||{}),Tr=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(Tr||{});const Ar={ADAPTER:{createCanvas:(t,e)=>{const s=document.createElement("canvas");return s.width=t,s.height=e,s},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>{var t;return null!=(t=document.baseURI)?t:window.location.href},getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>(new DOMParser).parseFromString(t,"text/xml")},RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Cr=/iPhone/i,Mr=/iPod/i,Ir=/iPad/i,Pr=/\biOS-universal(?:.+)Mac\b/i,Rr=/\bAndroid(?:.+)Mobile\b/i,kr=/Android/i,Dr=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Fr=/Silk/i,Or=/Windows Phone/i,Nr=/\bWindows(?:.+)ARM\b/i,Br=/BlackBerry/i,Lr=/BB10/i,Vr=/Opera Mini/i,$r=/\b(CriOS|Chrome)(?:.+)Mobile/i,Ur=/Mobile(?:.+)Firefox\b/i,Xr=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};function Yr(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var s=e.userAgent,i=s.split("[FBAN");void 0!==i[1]&&(s=i[0]),void 0!==(i=s.split("Twitter"))[1]&&(s=i[0]);var n=function(t){return function(e){return e.test(t)}}(s),r={apple:{phone:n(Cr)&&!n(Or),ipod:n(Mr),tablet:!n(Cr)&&(n(Ir)||Xr(e))&&!n(Or),universal:n(Pr),device:(n(Cr)||n(Mr)||n(Ir)||n(Pr)||Xr(e))&&!n(Or)},amazon:{phone:n(Dr),tablet:!n(Dr)&&n(Fr),device:n(Dr)||n(Fr)},android:{phone:!n(Or)&&n(Dr)||!n(Or)&&n(Rr),tablet:!n(Or)&&!n(Dr)&&!n(Rr)&&(n(Fr)||n(kr)),device:!n(Or)&&(n(Dr)||n(Fr)||n(Rr)||n(kr))||n(/\bokhttp\b/i)},windows:{phone:n(Or),tablet:n(Nr),device:n(Or)||n(Nr)},other:{blackberry:n(Br),blackberry10:n(Lr),opera:n(Vr),firefox:n(Ur),chrome:n($r),device:n(Br)||n(Lr)||n(Vr)||n(Ur)||n($r)},any:!1,phone:!1,tablet:!1};return r.any=r.apple.device||r.android.device||r.windows.device||r.other.device,r.phone=r.apple.phone||r.android.phone||r.windows.phone,r.tablet=r.apple.tablet||r.android.tablet||r.windows.tablet,r}const Wr=(null!=(t=Yr.default)?t:Yr)(globalThis.navigator);Ar.RETINA_PREFIX=/@([0-9\.]+)x/,Ar.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var jr={};function Gr(t,e,s){s=s||2;var i,n,r,a,o,h,l,c=e&&e.length,u=c?e[0]*s:t.length,d=zr(t,0,u,s,!0),p=[];if(!d||d.next===d.prev)return p;if(c&&(d=function(t,e,s,i){var n,r,a,o=[];for(n=0,r=e.length;n<r;n++)(a=zr(t,e[n]*i,n<r-1?e[n+1]*i:t.length,i,!1))===a.next&&(a.steiner=!0),o.push(na(a));for(o.sort(ta),n=0;n<o.length;n++)s=ea(o[n],s);return s}(t,e,d,s)),t.length>80*s){i=r=t[0],n=a=t[1];for(var f=s;f<u;f+=s)(o=t[f])<i&&(i=o),(h=t[f+1])<n&&(n=h),o>r&&(r=o),h>a&&(a=h);l=0!==(l=Math.max(r-i,a-n))?32767/l:0}return qr(d,p,s,i,n,l,0),p}function zr(t,e,s,i,n){var r,a;if(n===ya(t,e,s,i)>0)for(r=e;r<s;r+=i)a=fa(r,t[r],t[r+1],a);else for(r=s-i;r>=e;r-=i)a=fa(r,t[r],t[r+1],a);return a&&ha(a,a.next)&&(ma(a),a=a.next),a}function Hr(t,e){if(!t)return t;e||(e=t);var s,i=t;do{if(s=!1,i.steiner||!ha(i,i.next)&&0!==oa(i.prev,i,i.next))i=i.next;else{if(ma(i),(i=e=i.prev)===i.next)break;s=!0}}while(s||i!==e);return e}function qr(t,e,s,i,n,r,a){if(t){!a&&r&&function(t,e,s,i){var n=t;do{0===n.z&&(n.z=ia(n.x,n.y,e,s,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,s,i,n,r,a,o,h,l=1;do{for(s=t,t=null,r=null,a=0;s;){for(a++,i=s,o=0,e=0;e<l&&(o++,i=i.nextZ);e++);for(h=l;o>0||h>0&&i;)0!==o&&(0===h||!i||s.z<=i.z)?(n=s,s=s.nextZ,o--):(n=i,i=i.nextZ,h--),r?r.nextZ=n:t=n,n.prevZ=r,r=n;s=i}r.nextZ=null,l*=2}while(a>1)}(n)}(t,i,n,r);for(var o,h,l=t;t.prev!==t.next;)if(o=t.prev,h=t.next,r?Zr(t,i,n,r):Kr(t))e.push(o.i/s|0),e.push(t.i/s|0),e.push(h.i/s|0),ma(t),t=h.next,l=h.next;else if((t=h)===l){a?1===a?qr(t=Qr(Hr(t),e,s),e,s,i,n,r,2):2===a&&Jr(t,e,s,i,n,r):qr(Hr(t),e,s,i,n,r,1);break}}}function Kr(t){var e=t.prev,s=t,i=t.next;if(oa(e,s,i)>=0)return!1;for(var n=e.x,r=s.x,a=i.x,o=e.y,h=s.y,l=i.y,c=n<r?n<a?n:a:r<a?r:a,u=o<h?o<l?o:l:h<l?h:l,d=n>r?n>a?n:a:r>a?r:a,p=o>h?o>l?o:l:h>l?h:l,f=i.next;f!==e;){if(f.x>=c&&f.x<=d&&f.y>=u&&f.y<=p&&ra(n,o,r,h,a,l,f.x,f.y)&&oa(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Zr(t,e,s,i){var n=t.prev,r=t,a=t.next;if(oa(n,r,a)>=0)return!1;for(var o=n.x,h=r.x,l=a.x,c=n.y,u=r.y,d=a.y,p=o<h?o<l?o:l:h<l?h:l,f=c<u?c<d?c:d:u<d?u:d,m=o>h?o>l?o:l:h>l?h:l,g=c>u?c>d?c:d:u>d?u:d,y=ia(p,f,e,s,i),x=ia(m,g,e,s,i),v=t.prevZ,_=t.nextZ;v&&v.z>=y&&_&&_.z<=x;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==n&&v!==a&&ra(o,c,h,u,l,d,v.x,v.y)&&oa(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==n&&_!==a&&ra(o,c,h,u,l,d,_.x,_.y)&&oa(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;v&&v.z>=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==n&&v!==a&&ra(o,c,h,u,l,d,v.x,v.y)&&oa(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;_&&_.z<=x;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==n&&_!==a&&ra(o,c,h,u,l,d,_.x,_.y)&&oa(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function Qr(t,e,s){var i=t;do{var n=i.prev,r=i.next.next;!ha(n,r)&&la(n,i,i.next,r)&&da(n,r)&&da(r,n)&&(e.push(n.i/s|0),e.push(i.i/s|0),e.push(r.i/s|0),ma(i),ma(i.next),i=t=r),i=i.next}while(i!==t);return Hr(i)}function Jr(t,e,s,i,n,r){var a=t;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&aa(a,o)){var h=pa(a,o);return a=Hr(a,a.next),h=Hr(h,h.next),qr(a,e,s,i,n,r,0),void qr(h,e,s,i,n,r,0)}o=o.next}a=a.next}while(a!==t)}function ta(t,e){return t.x-e.x}function ea(t,e){var s=function(t,e){var s,i=e,n=t.x,r=t.y,a=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var o=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=n&&o>a&&(a=o,s=i.x<i.next.x?i:i.next,o===n))return s}i=i.next}while(i!==e);if(!s)return null;var h,l=s,c=s.x,u=s.y,d=1/0;i=s;do{n>=i.x&&i.x>=c&&n!==i.x&&ra(r<u?n:a,r,c,u,r<u?a:n,r,i.x,i.y)&&(h=Math.abs(r-i.y)/(n-i.x),da(i,t)&&(h<d||h===d&&(i.x>s.x||i.x===s.x&&sa(s,i)))&&(s=i,d=h)),i=i.next}while(i!==l);return s}(t,e);if(!s)return e;var i=pa(s,t);return Hr(i,i.next),Hr(s,s.next)}function sa(t,e){return oa(t.prev,t,e.prev)<0&&oa(e.next,t,t.next)<0}function ia(t,e,s,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function na(t){var e=t,s=t;do{(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next}while(e!==t);return s}function ra(t,e,s,i,n,r,a,o){return(n-a)*(e-o)>=(t-a)*(r-o)&&(t-a)*(i-o)>=(s-a)*(e-o)&&(s-a)*(r-o)>=(n-a)*(i-o)}function aa(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var s=t;do{if(s.i!==t.i&&s.next.i!==t.i&&s.i!==e.i&&s.next.i!==e.i&&la(s,s.next,t,e))return!0;s=s.next}while(s!==t);return!1}(t,e)&&(da(t,e)&&da(e,t)&&function(t,e){var s=t,i=!1,n=(t.x+e.x)/2,r=(t.y+e.y)/2;do{s.y>r!=s.next.y>r&&s.next.y!==s.y&&n<(s.next.x-s.x)*(r-s.y)/(s.next.y-s.y)+s.x&&(i=!i),s=s.next}while(s!==t);return i}(t,e)&&(oa(t.prev,t,e.prev)||oa(t,e.prev,e))||ha(t,e)&&oa(t.prev,t,t.next)>0&&oa(e.prev,e,e.next)>0)}function oa(t,e,s){return(e.y-t.y)*(s.x-e.x)-(e.x-t.x)*(s.y-e.y)}function ha(t,e){return t.x===e.x&&t.y===e.y}function la(t,e,s,i){var n=ua(oa(t,e,s)),r=ua(oa(t,e,i)),a=ua(oa(s,i,t)),o=ua(oa(s,i,e));return n!==r&&a!==o||(!(0!==n||!ca(t,s,e))||(!(0!==r||!ca(t,i,e))||(!(0!==a||!ca(s,t,i))||!(0!==o||!ca(s,e,i)))))}function ca(t,e,s){return e.x<=Math.max(t.x,s.x)&&e.x>=Math.min(t.x,s.x)&&e.y<=Math.max(t.y,s.y)&&e.y>=Math.min(t.y,s.y)}function ua(t){return t>0?1:t<0?-1:0}function da(t,e){return oa(t.prev,t,t.next)<0?oa(t,e,t.next)>=0&&oa(t,t.prev,e)>=0:oa(t,e,t.prev)<0||oa(t,t.next,e)<0}function pa(t,e){var s=new ga(t.i,t.x,t.y),i=new ga(e.i,e.x,e.y),n=t.next,r=e.prev;return t.next=e,e.prev=t,s.next=n,n.prev=s,i.next=s,s.prev=i,r.next=i,i.prev=r,i}function fa(t,e,s,i){var n=new ga(t,e,s);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function ma(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ga(t,e,s){this.i=t,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ya(t,e,s,i){for(var n=0,r=e,a=s-i;r<s;r+=i)n+=(t[a]-t[r])*(t[r+1]+t[a+1]),a=r;return n}({get exports(){return jr},set exports(t){jr=t}}).exports=Gr,jr.default=Gr,Gr.deviation=function(t,e,s,i){var n=e&&e.length,r=n?e[0]*s:t.length,a=Math.abs(ya(t,0,r,s));if(n)for(var o=0,h=e.length;o<h;o++){var l=e[o]*s,c=o<h-1?e[o+1]*s:t.length;a-=Math.abs(ya(t,l,c,s))}var u=0;for(o=0;o<i.length;o+=3){var d=i[o]*s,p=i[o+1]*s,f=i[o+2]*s;u+=Math.abs((t[d]-t[f])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[f+1]-t[d+1]))}return 0===a&&0===u?0:Math.abs((u-a)/a)},Gr.flatten=function(t){for(var e=t[0][0].length,s={vertices:[],holes:[],dimensions:e},i=0,n=0;n<t.length;n++){for(var r=0;r<t[n].length;r++)for(var a=0;a<e;a++)s.vertices.push(t[n][r][a]);n>0&&(i+=t[n-1].length,s.holes.push(i))}return s};var xa={};!function(t,e){!function(s){var i=e&&!e.nodeType&&e,n=t&&!t.nodeType&&t,r="object"==typeof g&&g;r.global!==r&&r.window!==r&&r.self!==r||(s=r);var a,o,h=2147483647,l=36,c=1,u=26,d=38,p=700,f=72,m=128,y="-",x=/^xn--/,v=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=l-c,E=Math.floor,S=String.fromCharCode;function T(t){throw RangeError(b[t])}function A(t,e){for(var s=t.length,i=[];s--;)i[s]=e(t[s]);return i}function C(t,e){var s=t.split("@"),i="";return s.length>1&&(i=s[0]+"@",t=s[1]),i+A((t=t.replace(_,".")).split("."),e).join(".")}function M(t){for(var e,s,i=[],n=0,r=t.length;n<r;)(e=t.charCodeAt(n++))>=55296&&e<=56319&&n<r?56320==(64512&(s=t.charCodeAt(n++)))?i.push(((1023&e)<<10)+(1023&s)+65536):(i.push(e),n--):i.push(e);return i}function I(t){return A(t,(function(t){var e="";return t>65535&&(e+=S((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=S(t)})).join("")}function P(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function R(t,e,s){var i=0;for(t=s?E(t/p):t>>1,t+=E(t/e);t>w*u>>1;i+=l)t=E(t/w);return E(i+(w+1)*t/(t+d))}function k(t){var e,s,i,n,r,a,o,d,p,g,x,v=[],_=t.length,b=0,w=m,S=f;for((s=t.lastIndexOf(y))<0&&(s=0),i=0;i<s;++i)t.charCodeAt(i)>=128&&T("not-basic"),v.push(t.charCodeAt(i));for(n=s>0?s+1:0;n<_;){for(r=b,a=1,o=l;n>=_&&T("invalid-input"),((d=(x=t.charCodeAt(n++))-48<10?x-22:x-65<26?x-65:x-97<26?x-97:l)>=l||d>E((h-b)/a))&&T("overflow"),b+=d*a,!(d<(p=o<=S?c:o>=S+u?u:o-S));o+=l)a>E(h/(g=l-p))&&T("overflow"),a*=g;S=R(b-r,e=v.length+1,0==r),E(b/e)>h-w&&T("overflow"),w+=E(b/e),b%=e,v.splice(b++,0,w)}return I(v)}function D(t){var e,s,i,n,r,a,o,d,p,g,x,v,_,b,w,A=[];for(v=(t=M(t)).length,e=m,s=0,r=f,a=0;a<v;++a)(x=t[a])<128&&A.push(S(x));for(i=n=A.length,n&&A.push(y);i<v;){for(o=h,a=0;a<v;++a)(x=t[a])>=e&&x<o&&(o=x);for(o-e>E((h-s)/(_=i+1))&&T("overflow"),s+=(o-e)*_,e=o,a=0;a<v;++a)if((x=t[a])<e&&++s>h&&T("overflow"),x==e){for(d=s,p=l;!(d<(g=p<=r?c:p>=r+u?u:p-r));p+=l)w=d-g,b=l-g,A.push(S(P(g+w%b,0))),d=E(w/b);A.push(S(P(d,0))),r=R(s,_,i==n),s=0,++i}++s,++e}return A.join("")}if(a={version:"1.3.2",ucs2:{decode:M,encode:I},decode:k,encode:D,toASCII:function(t){return C(t,(function(t){return v.test(t)?"xn--"+D(t):t}))},toUnicode:function(t){return C(t,(function(t){return x.test(t)?k(t.slice(4).toLowerCase()):t}))}},i&&n)if(t.exports==i)n.exports=a;else for(o in a)a.hasOwnProperty(o)&&(i[o]=a[o]);else s.punycode=a}(g)}({get exports(){return xa},set exports(t){xa=t}},xa);var va={};function _a(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var ba=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};va.decode=va.parse=function(t,e,s,i){e=e||"&",s=s||"=";var n={};if("string"!=typeof t||0===t.length)return n;var r=/\+/g;t=t.split(e);var a=1e3;i&&"number"==typeof i.maxKeys&&(a=i.maxKeys);var o=t.length;a>0&&o>a&&(o=a);for(var h=0;h<o;++h){var l,c,u,d,p=t[h].replace(r,"%20"),f=p.indexOf(s);f>=0?(l=p.substr(0,f),c=p.substr(f+1)):(l=p,c=""),u=decodeURIComponent(l),d=decodeURIComponent(c),_a(n,u)?Array.isArray(n[u])?n[u].push(d):n[u]=[n[u],d]:n[u]=d}return n},va.encode=va.stringify=function(t,e,s,i){return e=e||"&",s=s||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map((function(i){var n=encodeURIComponent(ba(i))+s;return Array.isArray(t[i])?t[i].map((function(t){return n+encodeURIComponent(ba(t))})).join(e):n+encodeURIComponent(ba(t[i]))})).join(e):i?encodeURIComponent(ba(i))+s+encodeURIComponent(ba(t)):""};var wa=xa,Ea={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}},Sa=Ua,Ta=function(t,e){return Ua(t,!1,!0).resolve(e)},Aa=function(t){Ea.isString(t)&&(t=Ua(t));return t instanceof Ca?t.format():Ca.prototype.format.call(t)};function Ca(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Ma=/^([a-z0-9.+-]+:)/i,Ia=/:[0-9]*$/,Pa=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,Ra=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),ka=["'"].concat(Ra),Da=["%","/","?",";","#"].concat(ka),Fa=["/","?","#"],Oa=/^[+a-z0-9A-Z_-]{0,63}$/,Na=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Ba={javascript:!0,"javascript:":!0},La={javascript:!0,"javascript:":!0},Va={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},$a=va;function Ua(t,e,s){if(t&&Ea.isObject(t)&&t instanceof Ca)return t;var i=new Ca;return i.parse(t,e,s),i}Ca.prototype.parse=function(t,e,s){if(!Ea.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var i=t.indexOf("?"),n=-1!==i&&i<t.indexOf("#")?"?":"#",r=t.split(n);r[0]=r[0].replace(/\\/g,"/");var a=t=r.join(n);if(a=a.trim(),!s&&1===t.split("#").length){var o=Pa.exec(a);if(o)return this.path=a,this.href=a,this.pathname=o[1],o[2]?(this.search=o[2],this.query=e?$a.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var h=Ma.exec(a);if(h){var l=(h=h[0]).toLowerCase();this.protocol=l,a=a.substr(h.length)}if(s||h||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var c="//"===a.substr(0,2);!c||h&&La[h]||(a=a.substr(2),this.slashes=!0)}if(!La[h]&&(c||h&&!Va[h])){for(var u,d,p=-1,f=0;f<Fa.length;f++){-1!==(m=a.indexOf(Fa[f]))&&(-1===p||m<p)&&(p=m)}-1!==(d=-1===p?a.lastIndexOf("@"):a.lastIndexOf("@",p))&&(u=a.slice(0,d),a=a.slice(d+1),this.auth=decodeURIComponent(u)),p=-1;for(f=0;f<Da.length;f++){var m;-1!==(m=a.indexOf(Da[f]))&&(-1===p||m<p)&&(p=m)}-1===p&&(p=a.length),this.host=a.slice(0,p),a=a.slice(p),this.parseHost(),this.hostname=this.hostname||"";var g="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!g)for(var y=this.hostname.split(/\./),x=(f=0,y.length);f<x;f++){var v=y[f];if(v&&!v.match(Oa)){for(var _="",b=0,w=v.length;b<w;b++)v.charCodeAt(b)>127?_+="x":_+=v[b];if(!_.match(Oa)){var E=y.slice(0,f),S=y.slice(f+1),T=v.match(Na);T&&(E.push(T[1]),S.unshift(T[2])),S.length&&(a="/"+S.join(".")+a),this.hostname=E.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),g||(this.hostname=wa.toASCII(this.hostname));var A=this.port?":"+this.port:"",C=this.hostname||"";this.host=C+A,this.href+=this.host,g&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!Ba[l])for(f=0,x=ka.length;f<x;f++){var M=ka[f];if(-1!==a.indexOf(M)){var I=encodeURIComponent(M);I===M&&(I=escape(M)),a=a.split(M).join(I)}}var P=a.indexOf("#");-1!==P&&(this.hash=a.substr(P),a=a.slice(0,P));var R=a.indexOf("?");if(-1!==R?(this.search=a.substr(R),this.query=a.substr(R+1),e&&(this.query=$a.parse(this.query)),a=a.slice(0,R)):e&&(this.search="",this.query={}),a&&(this.pathname=a),Va[l]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){A=this.pathname||"";var k=this.search||"";this.path=A+k}return this.href=this.format(),this},Ca.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",s=this.pathname||"",i=this.hash||"",n=!1,r="";this.host?n=t+this.host:this.hostname&&(n=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&Ea.isObject(this.query)&&Object.keys(this.query).length&&(r=$a.stringify(this.query));var a=this.search||r&&"?"+r||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||Va[e])&&!1!==n?(n="//"+(n||""),s&&"/"!==s.charAt(0)&&(s="/"+s)):n||(n=""),i&&"#"!==i.charAt(0)&&(i="#"+i),a&&"?"!==a.charAt(0)&&(a="?"+a),e+n+(s=s.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(a=a.replace("#","%23"))+i},Ca.prototype.resolve=function(t){return this.resolveObject(Ua(t,!1,!0)).format()},Ca.prototype.resolveObject=function(t){if(Ea.isString(t)){var e=new Ca;e.parse(t,!1,!0),t=e}for(var s=new Ca,i=Object.keys(this),n=0;n<i.length;n++){var r=i[n];s[r]=this[r]}if(s.hash=t.hash,""===t.href)return s.href=s.format(),s;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),o=0;o<a.length;o++){var h=a[o];"protocol"!==h&&(s[h]=t[h])}return Va[s.protocol]&&s.hostname&&!s.pathname&&(s.path=s.pathname="/"),s.href=s.format(),s}if(t.protocol&&t.protocol!==s.protocol){if(!Va[t.protocol]){for(var l=Object.keys(t),c=0;c<l.length;c++){var u=l[c];s[u]=t[u]}return s.href=s.format(),s}if(s.protocol=t.protocol,t.host||La[t.protocol])s.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),s.pathname=d.join("/")}if(s.search=t.search,s.query=t.query,s.host=t.host||"",s.auth=t.auth,s.hostname=t.hostname||t.host,s.port=t.port,s.pathname||s.search){var p=s.pathname||"",f=s.search||"";s.path=p+f}return s.slashes=s.slashes||t.slashes,s.href=s.format(),s}var m=s.pathname&&"/"===s.pathname.charAt(0),g=t.host||t.pathname&&"/"===t.pathname.charAt(0),y=g||m||s.host&&t.pathname,x=y,v=s.pathname&&s.pathname.split("/")||[],_=(d=t.pathname&&t.pathname.split("/")||[],s.protocol&&!Va[s.protocol]);if(_&&(s.hostname="",s.port=null,s.host&&(""===v[0]?v[0]=s.host:v.unshift(s.host)),s.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),y=y&&(""===d[0]||""===v[0])),g)s.host=t.host||""===t.host?t.host:s.host,s.hostname=t.hostname||""===t.hostname?t.hostname:s.hostname,s.search=t.search,s.query=t.query,v=d;else if(d.length)v||(v=[]),v.pop(),v=v.concat(d),s.search=t.search,s.query=t.query;else if(!Ea.isNullOrUndefined(t.search)){if(_)s.hostname=s.host=v.shift(),(T=!!(s.host&&s.host.indexOf("@")>0)&&s.host.split("@"))&&(s.auth=T.shift(),s.host=s.hostname=T.shift());return s.search=t.search,s.query=t.query,Ea.isNull(s.pathname)&&Ea.isNull(s.search)||(s.path=(s.pathname?s.pathname:"")+(s.search?s.search:"")),s.href=s.format(),s}if(!v.length)return s.pathname=null,s.search?s.path="/"+s.search:s.path=null,s.href=s.format(),s;for(var b=v.slice(-1)[0],w=(s.host||t.host||v.length>1)&&("."===b||".."===b)||""===b,E=0,S=v.length;S>=0;S--)"."===(b=v[S])?v.splice(S,1):".."===b?(v.splice(S,1),E++):E&&(v.splice(S,1),E--);if(!y&&!x)for(;E--;E)v.unshift("..");!y||""===v[0]||v[0]&&"/"===v[0].charAt(0)||v.unshift(""),w&&"/"!==v.join("/").substr(-1)&&v.push("");var T,A=""===v[0]||v[0]&&"/"===v[0].charAt(0);_&&(s.hostname=s.host=A?"":v.length?v.shift():"",(T=!!(s.host&&s.host.indexOf("@")>0)&&s.host.split("@"))&&(s.auth=T.shift(),s.host=s.hostname=T.shift()));return(y=y||s.host&&v.length)&&!A&&v.unshift(""),v.length?s.pathname=v.join("/"):(s.pathname=null,s.path=null),Ea.isNull(s.pathname)&&Ea.isNull(s.search)||(s.path=(s.pathname?s.pathname:"")+(s.search?s.search:"")),s.auth=t.auth||s.auth,s.slashes=s.slashes||t.slashes,s.href=s.format(),s},Ca.prototype.parseHost=function(){var t=this.host,e=Ia.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};const Xa={parse:Sa,format:Aa,resolve:Ta};function Ya(t){if("string"!=typeof t)throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function Wa(t){return t.split("?")[0].split("#")[0]}const ja={toPosix(t){return e="\\",s="/",t.replace(new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),s);var e,s},isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl:t=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t),hasProtocol(t){return/^[^/:]+:\//.test(this.toPosix(t))},getProtocol(t){Ya(t),t=this.toPosix(t);let e="";const s=/^file:\/\/\//.exec(t),i=/^[^/:]+:\/\//.exec(t),n=/^[^/:]+:\//.exec(t);if(s||i||n){const r=(null==s?void 0:s[0])||(null==i?void 0:i[0])||(null==n?void 0:n[0]);e=r,t=t.slice(r.length)}return e},toAbsolute(t,e,s){if(this.isDataUrl(t))return t;const i=Wa(this.toPosix(null!=e?e:Ar.ADAPTER.getBaseUrl())),n=Wa(this.toPosix(null!=s?s:this.rootname(i)));if(Ya(t),(t=this.toPosix(t)).startsWith("/"))return ja.join(n,t.slice(1));return this.isAbsolute(t)?t:this.join(i,t)},normalize(t){if(Ya(t=this.toPosix(t)),0===t.length)return".";let e="";const s=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const i=t.endsWith("/");return(t=function(t,e){let s="",i=0,n=-1,r=0,a=-1;for(let o=0;o<=t.length;++o){if(o<t.length)a=t.charCodeAt(o);else{if(47===a)break;a=47}if(47===a){if(n===o-1||1===r);else if(n!==o-1&&2===r){if(s.length<2||2!==i||46!==s.charCodeAt(s.length-1)||46!==s.charCodeAt(s.length-2))if(s.length>2){const t=s.lastIndexOf("/");if(t!==s.length-1){-1===t?(s="",i=0):(s=s.slice(0,t),i=s.length-1-s.lastIndexOf("/")),n=o,r=0;continue}}else if(2===s.length||1===s.length){s="",i=0,n=o,r=0;continue}e&&(s.length>0?s+="/..":s="..",i=2)}else s.length>0?s+=`/${t.slice(n+1,o)}`:s=t.slice(n+1,o),i=o-n-1;n=o,r=0}else 46===a&&-1!==r?++r:r=-1}return s}(t,!1)).length>0&&i&&(t+="/"),s?`/${t}`:e+t},isAbsolute(t){return Ya(t),t=this.toPosix(t),!!this.hasProtocol(t)||t.startsWith("/")},join(...t){var e;if(0===t.length)return".";let s;for(let i=0;i<t.length;++i){const n=t[i];if(Ya(n),n.length>0)if(void 0===s)s=n;else{const r=null!=(e=t[i-1])?e:"";this.extname(r)?s+=`/../${n}`:s+=`/${n}`}}return void 0===s?".":this.normalize(s)},dirname(t){if(Ya(t),0===t.length)return".";let e=(t=this.toPosix(t)).charCodeAt(0);const s=47===e;let i=-1,n=!0;const r=this.getProtocol(t),a=t;for(let o=(t=t.slice(r.length)).length-1;o>=1;--o)if(e=t.charCodeAt(o),47===e){if(!n){i=o;break}}else n=!1;return-1===i?s?"/":this.isUrl(a)?r+t:r:s&&1===i?"//":r+t.slice(0,i)},rootname(t){Ya(t);let e="";if(e=(t=this.toPosix(t)).startsWith("/")?"/":this.getProtocol(t),this.isUrl(t)){const s=t.indexOf("/",e.length);e=-1!==s?t.slice(0,s):t,e.endsWith("/")||(e+="/")}return e},basename(t,e){Ya(t),e&&Ya(e),t=Wa(this.toPosix(t));let s,i=0,n=-1,r=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let a=e.length-1,o=-1;for(s=t.length-1;s>=0;--s){const h=t.charCodeAt(s);if(47===h){if(!r){i=s+1;break}}else-1===o&&(r=!1,o=s+1),a>=0&&(h===e.charCodeAt(a)?-1==--a&&(n=s):(a=-1,n=o))}return i===n?n=o:-1===n&&(n=t.length),t.slice(i,n)}for(s=t.length-1;s>=0;--s)if(47===t.charCodeAt(s)){if(!r){i=s+1;break}}else-1===n&&(r=!1,n=s+1);return-1===n?"":t.slice(i,n)},extname(t){Ya(t);let e=-1,s=0,i=-1,n=!0,r=0;for(let a=(t=Wa(this.toPosix(t))).length-1;a>=0;--a){const o=t.charCodeAt(a);if(47!==o)-1===i&&(n=!1,i=a+1),46===o?-1===e?e=a:1!==r&&(r=1):-1!==e&&(r=-1);else if(!n){s=a+1;break}}return-1===e||-1===i||0===r||1===r&&e===i-1&&e===s+1?"":t.slice(e,i)},parse(t){Ya(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;let s=(t=Wa(this.toPosix(t))).charCodeAt(0);const i=this.isAbsolute(t);let n;e.root=this.rootname(t),n=i||this.hasProtocol(t)?1:0;let r=-1,a=0,o=-1,h=!0,l=t.length-1,c=0;for(;l>=n;--l)if(s=t.charCodeAt(l),47!==s)-1===o&&(h=!1,o=l+1),46===s?-1===r?r=l:1!==c&&(c=1):-1!==r&&(c=-1);else if(!h){a=l+1;break}return-1===r||-1===o||0===c||1===c&&r===o-1&&r===a+1?-1!==o&&(e.base=e.name=0===a&&i?t.slice(1,o):t.slice(a,o)):(0===a&&i?(e.name=t.slice(1,r),e.base=t.slice(1,o)):(e.name=t.slice(a,r),e.base=t.slice(a,o)),e.ext=t.slice(r,o)),e.dir=this.dirname(t),e},sep:"/",delimiter:":"},Ga={};function za(t,e,s=3){if(Ga[e])return;let i=(new Error).stack;void 0===i?console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`):(i=i.split("\n").splice(s).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}\nDeprecated since v${t}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`),console.warn(i))),Ga[e]=!0}let Ha;var qa,Ka={grad:.9,turn:360,rad:360/(2*Math.PI)},Za=function(t){return"string"==typeof t?t.length>0:"number"==typeof t},Qa=function(t,e,s){return void 0===e&&(e=0),void 0===s&&(s=Math.pow(10,e)),Math.round(s*t)/s+0},Ja=function(t,e,s){return void 0===e&&(e=0),void 0===s&&(s=1),t>s?s:t>e?t:e},to=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},eo=function(t){return{r:Ja(t.r,0,255),g:Ja(t.g,0,255),b:Ja(t.b,0,255),a:Ja(t.a)}},so=function(t){return{r:Qa(t.r),g:Qa(t.g),b:Qa(t.b),a:Qa(t.a,3)}},io=/^#([0-9a-f]{3,8})$/i,no=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},ro=function(t){var e=t.r,s=t.g,i=t.b,n=t.a,r=Math.max(e,s,i),a=r-Math.min(e,s,i),o=a?r===e?(s-i)/a:r===s?2+(i-e)/a:4+(e-s)/a:0;return{h:60*(o<0?o+6:o),s:r?a/r*100:0,v:r/255*100,a:n}},ao=function(t){var e=t.h,s=t.s,i=t.v,n=t.a;e=e/360*6,s/=100,i/=100;var r=Math.floor(e),a=i*(1-s),o=i*(1-(e-r)*s),h=i*(1-(1-e+r)*s),l=r%6;return{r:255*[i,o,a,a,h,i][l],g:255*[h,i,i,o,a,a][l],b:255*[a,a,h,i,i,o][l],a:n}},oo=function(t){return{h:to(t.h),s:Ja(t.s,0,100),l:Ja(t.l,0,100),a:Ja(t.a)}},ho=function(t){return{h:Qa(t.h),s:Qa(t.s),l:Qa(t.l),a:Qa(t.a,3)}},lo=function(t){return ao((s=(e=t).s,{h:e.h,s:(s*=((i=e.l)<50?i:100-i)/100)>0?2*s/(i+s)*100:0,v:i+s,a:e.a}));var e,s,i},co=function(t){return{h:(e=ro(t)).h,s:(n=(200-(s=e.s))*(i=e.v)/100)>0&&n<200?s*i/100/(n<=100?n:200-n)*100:0,l:n/2,a:e.a};var e,s,i,n},uo=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,po=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,fo=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,mo=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,go={string:[[function(t){var e=io.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:4===t.length?Qa(parseInt(t[3]+t[3],16)/255,2):1}:6===t.length||8===t.length?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8===t.length?Qa(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=fo.exec(t)||mo.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:eo({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:void 0===e[7]?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=uo.exec(t)||po.exec(t);if(!e)return null;var s,i,n=oo({h:(s=e[1],i=e[2],void 0===i&&(i="deg"),Number(s)*(Ka[i]||1)),s:Number(e[3]),l:Number(e[4]),a:void 0===e[5]?1:Number(e[5])/(e[6]?100:1)});return lo(n)},"hsl"]],object:[[function(t){var e=t.r,s=t.g,i=t.b,n=t.a,r=void 0===n?1:n;return Za(e)&&Za(s)&&Za(i)?eo({r:Number(e),g:Number(s),b:Number(i),a:Number(r)}):null},"rgb"],[function(t){var e=t.h,s=t.s,i=t.l,n=t.a,r=void 0===n?1:n;if(!Za(e)||!Za(s)||!Za(i))return null;var a=oo({h:Number(e),s:Number(s),l:Number(i),a:Number(r)});return lo(a)},"hsl"],[function(t){var e=t.h,s=t.s,i=t.v,n=t.a,r=void 0===n?1:n;if(!Za(e)||!Za(s)||!Za(i))return null;var a,o=(a={h:Number(e),s:Number(s),v:Number(i),a:Number(r)},{h:to(a.h),s:Ja(a.s,0,100),v:Ja(a.v,0,100),a:Ja(a.a)});return ao(o)},"hsv"]]},yo=function(t,e){for(var s=0;s<e.length;s++){var i=e[s][0](t);if(i)return[i,e[s][1]]}return[null,void 0]},xo=function(t){return"string"==typeof t?yo(t.trim(),go.string):"object"==typeof t&&null!==t?yo(t,go.object):[null,void 0]},vo=function(t,e){var s=co(t);return{h:s.h,s:Ja(s.s+100*e,0,100),l:s.l,a:s.a}},_o=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},bo=function(t,e){var s=co(t);return{h:s.h,s:s.s,l:Ja(s.l+100*e,0,100),a:s.a}},wo=function(){function t(t){this.parsed=xo(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return null!==this.parsed},t.prototype.brightness=function(){return Qa(_o(this.rgba),2)},t.prototype.isDark=function(){return _o(this.rgba)<.5},t.prototype.isLight=function(){return _o(this.rgba)>=.5},t.prototype.toHex=function(){return e=(t=so(this.rgba)).r,s=t.g,i=t.b,r=(n=t.a)<1?no(Qa(255*n)):"","#"+no(e)+no(s)+no(i)+r;var t,e,s,i,n,r},t.prototype.toRgb=function(){return so(this.rgba)},t.prototype.toRgbString=function(){return e=(t=so(this.rgba)).r,s=t.g,i=t.b,(n=t.a)<1?"rgba("+e+", "+s+", "+i+", "+n+")":"rgb("+e+", "+s+", "+i+")";var t,e,s,i,n},t.prototype.toHsl=function(){return ho(co(this.rgba))},t.prototype.toHslString=function(){return e=(t=ho(co(this.rgba))).h,s=t.s,i=t.l,(n=t.a)<1?"hsla("+e+", "+s+"%, "+i+"%, "+n+")":"hsl("+e+", "+s+"%, "+i+"%)";var t,e,s,i,n},t.prototype.toHsv=function(){return t=ro(this.rgba),{h:Qa(t.h),s:Qa(t.s),v:Qa(t.v),a:Qa(t.a,3)};var t},t.prototype.invert=function(){return Eo({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},t.prototype.saturate=function(t){return void 0===t&&(t=.1),Eo(vo(this.rgba,t))},t.prototype.desaturate=function(t){return void 0===t&&(t=.1),Eo(vo(this.rgba,-t))},t.prototype.grayscale=function(){return Eo(vo(this.rgba,-1))},t.prototype.lighten=function(t){return void 0===t&&(t=.1),Eo(bo(this.rgba,t))},t.prototype.darken=function(t){return void 0===t&&(t=.1),Eo(bo(this.rgba,-t))},t.prototype.rotate=function(t){return void 0===t&&(t=15),this.hue(this.hue()+t)},t.prototype.alpha=function(t){return"number"==typeof t?Eo({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Qa(this.rgba.a,3);var e},t.prototype.hue=function(t){var e=co(this.rgba);return"number"==typeof t?Eo({h:t,s:e.s,l:e.l,a:e.a}):Qa(e.h)},t.prototype.isEqual=function(t){return this.toHex()===Eo(t).toHex()},t}(),Eo=function(t){return t instanceof wo?t:new wo(t)},So=[];qa=[function(t,e){var s={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var n in s)i[s[n]]=n;var r={};t.prototype.toName=function(e){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var n,a,o=i[this.toHex()];if(o)return o;if(null==e?void 0:e.closest){var h=this.toRgb(),l=1/0,c="black";if(!r.length)for(var u in s)r[u]=new t(s[u]).toRgb();for(var d in s){var p=(n=h,a=r[d],Math.pow(n.r-a.r,2)+Math.pow(n.g-a.g,2)+Math.pow(n.b-a.b,2));p<l&&(l=p,c=d)}return c}},e.string.push([function(e){var i=e.toLowerCase(),n="transparent"===i?"#0000":s[i];return n?new t(n).toRgb():null},"name"])}],qa.forEach((function(t){So.indexOf(t)<0&&(t(wo,go),So.push(t))}));const To=class{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof To)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(null===t)throw new Error("Cannot set PIXI.Color#value to null");null!==this._value&&this.isSourceEqual(this._value,t)||(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return"string"==typeof t||"number"==typeof t||t instanceof Number||null===t?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):"object"==typeof t&&null!==t?l({},t):t}isSourceEqual(t,e){const s=typeof t;if(s!==typeof e)return!1;if("number"===s||"string"===s||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length===e.length&&t.every(((t,s)=>t===e[s]));if(null!==t&&null!==e){const s=Object.keys(t),i=Object.keys(e);return s.length===i.length&&s.every((s=>t[s]===e[s]))}return t===e}toRgba(){const[t,e,s,i]=this._components;return{r:t,g:e,b:s,a:i}}toRgb(){const[t,e,s]=this._components;return{r:t,g:e,b:s}}toRgbaString(){const[t,e,s]=this.toUint8RgbArray();return`rgba(${t},${e},${s},${this.alpha})`}toUint8RgbArray(t){const[e,s,i]=this._components;return(t=null!=t?t:[])[0]=Math.round(255*e),t[1]=Math.round(255*s),t[2]=Math.round(255*i),t}toRgbArray(t){t=null!=t?t:[];const[e,s,i]=this._components;return t[0]=e,t[1]=s,t[2]=i,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(65280&t)+((255&t)<<16)}multiply(t){const[e,s,i,n]=To.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=s,this._components[2]*=i,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(1===t)return(255<<24)+this._int;if(0===t)return e?0:this._int;let s=this._int>>16&255,i=this._int>>8&255,n=255&this._int;return e&&(s=s*t+.5|0,i=i*t+.5|0,n=n*t+.5|0),(255*t<<24)+(s<<16)+(i<<8)+n}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,s,i]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(s*t)/t,this._components[2]=Math.round(i*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=null!=t?t:[];const[e,s,i,n]=this._components;return t[0]=e,t[1]=s,t[2]=i,t[3]=n,t}normalize(t){let e,s,i,n;if(("number"==typeof t||t instanceof Number)&&t>=0&&t<=16777215){e=(t>>16&255)/255,s=(t>>8&255)/255,i=(255&t)/255,n=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,s,i,n=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,s,i,n=255]=t,e/=255,s/=255,i/=255,n/=255;else if("string"==typeof t||"object"==typeof t){if("string"==typeof t){const e=To.HEX_PATTERN.exec(t);e&&(t=`#${e[2]}`)}const r=Eo(t);r.isValid()&&(({r:e,g:s,b:i,a:n}=r.rgba),e/=255,s/=255,i/=255)}if(void 0===e)throw new Error(`Unable to convert color ${t}`);this._components[0]=e,this._components[1]=s,this._components[2]=i,this._components[3]=n,this.refreshInt()}refreshInt(){this._clamp(this._components);const[t,e,s]=this._components;this._int=(255*t<<16)+(255*e<<8)+(255*s|0)}_clamp(t,e=0,s=1){return"number"==typeof t?Math.min(Math.max(t,e),s):(t.forEach(((i,n)=>{t[n]=Math.min(Math.max(i,e),s)})),t)}};let Ao=To;function Co(t,e=[]){return za("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),Ao.shared.setValue(t).toRgbArray(e)}function Mo(t){return za("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Ao.shared.setValue(t).toNumber()}Ao.shared=new To,Ao.temp=new To,Ao.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;const Io=function(){const t=[],e=[];for(let i=0;i<32;i++)t[i]=i,e[i]=i;t[cr.NORMAL_NPM]=cr.NORMAL,t[cr.ADD_NPM]=cr.ADD,t[cr.SCREEN_NPM]=cr.SCREEN,e[cr.NORMAL]=cr.NORMAL_NPM,e[cr.ADD]=cr.ADD_NPM,e[cr.SCREEN]=cr.SCREEN_NPM;const s=[];return s.push(e),s.push(t),s}();function Po(t,e){return Io[e?1:0][t]}function Ro(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}function ko(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function Do(t){return!(t&t-1||!t)}function Fo(t){let e=(t>65535?1:0)<<4,s=((t>>>=e)>255?1:0)<<3;return e|=s,s=((t>>>=s)>15?1:0)<<2,e|=s,s=((t>>>=s)>3?1:0)<<1,e|=s,e|(t>>>=s)>>1}function Oo(t,e,s){const i=t.length;let n;if(e>=i||0===s)return;const r=i-(s=e+s>i?i-e:s);for(n=e;n<r;++n)t[n]=t[n+s];t.length=r}function No(t){return 0===t?0:t<0?-1:1}let Bo=0;function Lo(){return++Bo}const Vo=class{constructor(t,e,s,i){this.left=t,this.top=e,this.right=s,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let $o=Vo;$o.EMPTY=new Vo(0,0,0,0);const Uo={},Xo=Object.create(null),Yo=Object.create(null);class Wo{constructor(t,e,s){this._canvas=Ar.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=s||Ar.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function jo(t,e,s){for(let i=0,n=4*s*e;i<e;++i,n+=4)if(0!==t[n+3])return!1;return!0}function Go(t,e,s,i,n){const r=4*e;for(let a=i,o=i*r+4*s;a<=n;++a,o+=r)if(0!==t[o+3])return!1;return!0}function zo(t){const e=function(t){const{width:e,height:s}=t,i=t.getContext("2d",{willReadFrequently:!0});if(null===i)throw new TypeError("Failed to get canvas 2D context");const n=i.getImageData(0,0,e,s).data;let r=0,a=0,o=e-1,h=s-1;for(;a<s&&jo(n,e,a);)++a;if(a===s)return $o.EMPTY;for(;jo(n,e,h);)--h;for(;Go(n,e,r,a,h);)++r;for(;Go(n,e,o,a,h);)--o;return++o,++h,new $o(r,a,o,h)}(t),{width:s,height:i}=e;let n=null;if(!e.isEmpty()){const r=t.getContext("2d");if(null===r)throw new TypeError("Failed to get canvas 2D context");n=r.getImageData(e.left,e.top,s,i)}return{width:s,height:i,data:n}}let Ho;function qo(t,e=1){var s;const i=null==(s=Ar.RETINA_PREFIX)?void 0:s.exec(t);return i?parseFloat(i[1]):e}var Ko=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))(Ko||{});const Zo=t=>{if("function"==typeof t||"object"==typeof t&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");const e="object"!=typeof t.extension?{type:t.extension}:t.extension;t=c(l({},e),{ref:t})}if("object"!=typeof t)throw new Error("Invalid extension type");return"string"==typeof(t=l({},t)).type&&(t.type=[t.type]),t},Qo=(t,e)=>{var s;return null!=(s=Zo(t).priority)?s:e},Jo={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(Zo).forEach((t=>{t.type.forEach((e=>{var s,i;return null==(i=(s=this._removeHandlers)[e])?void 0:i.call(s,t)}))})),this},add(...t){return t.map(Zo).forEach((t=>{t.type.forEach((e=>{const s=this._addHandlers,i=this._queue;s[e]?s[e](t):(i[e]=i[e]||[],i[e].push(t))}))})),this},handle(t,e,s){const i=this._addHandlers,n=this._removeHandlers;if(i[t]||n[t])throw new Error(`Extension type ${t} already has a handler`);i[t]=e,n[t]=s;const r=this._queue;return r[t]&&(r[t].forEach((t=>e(t))),delete r[t]),this},handleByMap(t,e){return this.handle(t,(t=>{e[t.name]=t.ref}),(t=>{delete e[t.name]}))},handleByList(t,e,s=-1){return this.handle(t,(t=>{e.includes(t.ref)||(e.push(t.ref),e.sort(((t,e)=>Qo(e,s)-Qo(t,s))))}),(t=>{const s=e.indexOf(t.ref);-1!==s&&e.splice(s,1)}))}};class th{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const eh=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function sh(t){let e="";for(let s=0;s<t;++s)s>0&&(e+="\nelse "),s<t-1&&(e+=`if(test == ${s}.0){}`);return e}class ih{constructor(){this.data=0,this.blendMode=cr.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==cr.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new ih;return t.depthTest=!1,t.blend=!0,t}}const nh=[];function rh(t,e){if(!t)return null;let s="";if("string"==typeof t){const e=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);e&&(s=e[1].toLowerCase())}for(let i=nh.length-1;i>=0;--i){const n=nh[i];if(n.test&&n.test(t,s))return new n(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class ah{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,s,i,n,r,a,o){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:l}=this;this._aliasCount++;for(let c=0,u=l.length;c<u;c++)l[c][h](t,e,s,i,n,r,a,o);return l===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(ah.prototype,{dispatch:{value:ah.prototype.emit},run:{value:ah.prototype.emit}});class oh{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new ah("setRealSize"),this.onUpdate=new ah("update"),this.onError=new ah("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,s){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class hh extends oh{constructor(t,e){const{width:s,height:i}=e||{};if(!s||!i)throw new Error("BufferResource width or height invalid");super(s,i),this.data=t}upload(t,e,s){const i=t.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===vr.UNPACK);const n=e.realWidth,r=e.realHeight;return s.width===n&&s.height===r?i.texSubImage2D(e.target,0,0,0,n,r,e.format,s.type,this.data):(s.width=n,s.height=r,i.texImage2D(e.target,0,s.internalFormat,n,r,0,e.format,s.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const lh={scaleMode:gr.NEAREST,format:dr.RGBA,alphaMode:vr.NPM},ch=class extends x{constructor(t=null,e=null){super(),e=Object.assign({},ch.defaultOptions,e);const{alphaMode:s,mipmap:i,anisotropicLevel:n,scaleMode:r,width:a,height:o,wrapMode:h,format:l,type:c,target:u,resolution:d,resourceOptions:p}=e;!t||t instanceof oh||((t=rh(t,p)).internal=!0),this.resolution=d||Ar.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((o||0)*this.resolution)/this.resolution,this._mipmap=i,this.anisotropicLevel=n,this._wrapMode=h,this._scaleMode=r,this.format=l,this.type=c,this.target=u,this.alphaMode=s,this.uid=Lo(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&o>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let s;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,s=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,s=!0),s&&this.dirtyStyleId++,this}setSize(t,e,s){return s=s||this.resolution,this.setRealSize(t*s,e*s,s)}setRealSize(t,e,s){return this.resolution=s||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Do(this.realWidth)&&Do(this.realHeight)}setResolution(t){const e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Yo[this.cacheId],delete Xo[this.cacheId],this.cacheId=null),this.dispose(),ch.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,s=Ar.STRICT_TEXTURE_CACHE){const i="string"==typeof t;let n=null;if(i)n=t;else{if(!t._pixiId){const s=(null==e?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${s}_${Lo()}`}n=t._pixiId}let r=Yo[n];if(i&&s&&!r)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return r||(r=new ch(t,e),r.cacheId=n,ch.addToCache(r,n)),r}static fromBuffer(t,e,s,i){t=t||new Float32Array(e*s*4);const n=new hh(t,{width:e,height:s}),r=t instanceof Float32Array?fr.FLOAT:fr.UNSIGNED_BYTE;return new ch(n,Object.assign({},lh,{type:r},i))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Yo[e]&&Yo[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),Yo[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=Yo[t];if(e){const s=e.textureCacheIds.indexOf(t);return s>-1&&e.textureCacheIds.splice(s,1),delete Yo[t],e}}else if(null==t?void 0:t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete Yo[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};let uh=ch;uh.defaultOptions={mipmap:xr.POW2,anisotropicLevel:0,scaleMode:gr.LINEAR,wrapMode:yr.CLAMP,alphaMode:vr.UNPACK,target:pr.TEXTURE_2D,format:dr.RGBA,type:fr.UNSIGNED_BYTE},uh._globalBatch=0;class dh{constructor(){this.texArray=null,this.blend=0,this.type=ur.TRIANGLES,this.start=0,this.size=0,this.data=null}}let ph=0;class fh{constructor(t,e=!0,s=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=s,this.static=e,this.id=ph++,this.disposeRunner=new ah("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Tr.ELEMENT_ARRAY_BUFFER:Tr.ARRAY_BUFFER}get index(){return this.type===Tr.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new fh(t)}}class mh{constructor(t,e=0,s=!1,i=fr.FLOAT,n,r,a,o=1){this.buffer=t,this.size=e,this.normalized=s,this.type=i,this.stride=n,this.start=r,this.instance=a,this.divisor=o}destroy(){this.buffer=null}static from(t,e,s,i,n){return new mh(t,e,s,i,n)}}const gh={Float32Array,Uint32Array,Int32Array,Uint8Array};const yh={5126:4,5123:2,5121:1};let xh=0;const vh={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class _h{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=xh++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new ah("disposeGeometry"),this.refCount=0}addAttribute(t,e,s=0,i=!1,n,r,a,o=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof fh||(e instanceof Array&&(e=new Float32Array(e)),e=new fh(e));const h=t.split("|");if(h.length>1){for(let t=0;t<h.length;t++)this.addAttribute(h[t],e,s,i,n);return this}let l=this.buffers.indexOf(e);return-1===l&&(this.buffers.push(e),l=this.buffers.length-1),this.attributes[t]=new mh(l,s,i,n,r,a,o),this.instanced=this.instanced||o,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof fh||(t instanceof Array&&(t=new Uint16Array(t)),t=new fh(t)),t.type=Tr.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const t=[],e=[],s=new fh;let i;for(i in this.attributes){const s=this.attributes[i],n=this.buffers[s.buffer];t.push(n.data),e.push(s.size*yh[s.type]/4),s.buffer=0}for(s.data=function(t,e){let s=0,i=0;const n={};for(let h=0;h<t.length;h++)i+=e[h],s+=t[h].length;const r=new ArrayBuffer(4*s);let a=null,o=0;for(let h=0;h<t.length;h++){const s=e[h],l=t[h],c=Ro(l);n[c]||(n[c]=new gh[c](r)),a=n[c];for(let t=0;t<l.length;t++)a[(t/s|0)*i+o+t%s]=l[t];o+=s}return new Float32Array(r)}(t,e),i=0;i<this.buffers.length;i++)this.buffers[i]!==this.indexBuffer&&this.buffers[i].destroy();return this.buffers=[s],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new _h;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new fh(this.buffers[e].data.slice(0));for(const e in this.attributes){const s=this.attributes[e];t.attributes[e]=new mh(s.buffer,s.size,s.normalized,s.type,s.stride,s.start,s.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Tr.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new _h,s=[],i=[],n=[];let r;for(let a=0;a<t.length;a++){r=t[a];for(let t=0;t<r.buffers.length;t++)i[t]=i[t]||0,i[t]+=r.buffers[t].data.length,n[t]=0}for(let a=0;a<r.buffers.length;a++)s[a]=new(vh[Ro(r.buffers[a].data)])(i[a]),e.buffers[a]=new fh(s[a]);for(let a=0;a<t.length;a++){r=t[a];for(let t=0;t<r.buffers.length;t++)s[t].set(r.buffers[t].data,n[t]),n[t]+=r.buffers[t].data.length}if(e.attributes=r.attributes,r.indexBuffer){e.indexBuffer=e.buffers[r.buffers.indexOf(r.indexBuffer)],e.indexBuffer.type=Tr.ELEMENT_ARRAY_BUFFER;let s=0,i=0,n=0,a=0;for(let t=0;t<r.buffers.length;t++)if(r.buffers[t]!==r.indexBuffer){a=t;break}for(const t in r.attributes){const e=r.attributes[t];(0|e.buffer)===a&&(i+=e.size*yh[e.type]/4)}for(let r=0;r<t.length;r++){const o=t[r].indexBuffer.data;for(let t=0;t<o.length;t++)e.indexBuffer.data[t+n]+=s;s+=t[r].buffers[a].data.length/i,n+=o.length}}return e}}class bh extends _h{constructor(t=!1){super(),this._buffer=new fh(null,t,!1),this._indexBuffer=new fh(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,fr.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,fr.FLOAT).addAttribute("aColor",this._buffer,4,!0,fr.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,fr.FLOAT).addIndex(this._indexBuffer)}}const wh=2*Math.PI,Eh=180/Math.PI,Sh=Math.PI/180;var Th=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))(Th||{});class Ah{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Ah(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const Ch=[new Ah,new Ah,new Ah,new Ah];let Mh=class t{constructor(t=0,e=0,s=0,i=0){this.x=Number(t),this.y=Number(e),this.width=Number(s),this.height=Number(i),this.type=Th.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new t(0,0,0,0)}clone(){return new t(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)}intersects(t,e){if(!e){const e=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=e)return!1;const s=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>s}const s=this.left,i=this.right,n=this.top,r=this.bottom;if(i<=s||r<=n)return!1;const a=Ch[0].set(t.left,t.top),o=Ch[1].set(t.left,t.bottom),h=Ch[2].set(t.right,t.top),l=Ch[3].set(t.right,t.bottom);if(h.x<=a.x||o.y<=a.y)return!1;const c=Math.sign(e.a*e.d-e.b*e.c);if(0===c)return!1;if(e.apply(a,a),e.apply(o,o),e.apply(h,h),e.apply(l,l),Math.max(a.x,o.x,h.x,l.x)<=s||Math.min(a.x,o.x,h.x,l.x)>=i||Math.max(a.y,o.y,h.y,l.y)<=n||Math.min(a.y,o.y,h.y,l.y)>=r)return!1;const u=c*(o.y-a.y),d=c*(a.x-o.x),p=u*s+d*n,f=u*i+d*n,m=u*s+d*r,g=u*i+d*r;if(Math.max(p,f,m,g)<=u*a.x+d*a.y||Math.min(p,f,m,g)>=u*l.x+d*l.y)return!1;const y=c*(a.y-h.y),x=c*(h.x-a.x),v=y*s+x*n,_=y*i+x*n,b=y*s+x*r,w=y*i+x*r;return!(Math.max(v,_,b,w)<=y*a.x+x*a.y||Math.min(v,_,b,w)>=y*l.x+x*l.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),s=Math.min(this.x+this.width,t.x+t.width),i=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(s-e,0),this.y=i,this.height=Math.max(n-i,0),this}ceil(t=1,e=.001){const s=Math.ceil((this.x+this.width-e)*t)/t,i=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=s-this.x,this.height=i-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),s=Math.max(this.x+this.width,t.x+t.width),i=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=s-e,this.y=i,this.height=n-i,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}};class Ih{constructor(t=0,e=0,s=0){this.x=t,this.y=e,this.radius=s,this.type=Th.CIRC}clone(){return new Ih(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const s=this.radius*this.radius;let i=this.x-t,n=this.y-e;return i*=i,n*=n,i+n<=s}getBounds(){return new Mh(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Ph{constructor(t=0,e=0,s=0,i=0){this.x=t,this.y=e,this.width=s,this.height=i,this.type=Th.ELIP}clone(){return new Ph(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let s=(t-this.x)/this.width,i=(e-this.y)/this.height;return s*=s,i*=i,s+i<=1}getBounds(){return new Mh(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Rh{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let s=0,i=e.length;s<i;s++)t.push(e[s].x,e[s].y);e=t}this.points=e,this.type=Th.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new Rh(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let s=!1;const i=this.points.length/2;for(let n=0,r=i-1;n<i;r=n++){const i=this.points[2*n],a=this.points[2*n+1],o=this.points[2*r],h=this.points[2*r+1];a>e!=h>e&&t<(e-a)/(h-a)*(o-i)+i&&(s=!s)}return s}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce(((t,e)=>`${t}, ${e}`),"")}]`}}class kh{constructor(t=0,e=0,s=0,i=0,n=20){this.x=t,this.y=e,this.width=s,this.height=i,this.radius=n,this.type=Th.RREC}clone(){return new kh(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const s=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+s&&e<=this.y+this.height-s||t>=this.x+s&&t<=this.x+this.width-s)return!0;let i=t-(this.x+s),n=e-(this.y+s);const r=s*s;if(i*i+n*n<=r)return!0;if(i=t-(this.x+this.width-s),i*i+n*n<=r)return!0;if(n=e-(this.y+this.height-s),i*i+n*n<=r)return!0;if(i=t-(this.x+s),i*i+n*n<=r)return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class Dh{constructor(t=1,e=0,s=0,i=1,n=0,r=0){this.array=null,this.a=t,this.b=e,this.c=s,this.d=i,this.tx=n,this.ty=r}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,s,i,n,r){return this.a=t,this.b=e,this.c=s,this.d=i,this.tx=n,this.ty=r,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const s=e||this.array;return t?(s[0]=this.a,s[1]=this.b,s[2]=0,s[3]=this.c,s[4]=this.d,s[5]=0,s[6]=this.tx,s[7]=this.ty,s[8]=1):(s[0]=this.a,s[1]=this.c,s[2]=this.tx,s[3]=this.b,s[4]=this.d,s[5]=this.ty,s[6]=0,s[7]=0,s[8]=1),s}apply(t,e){e=e||new Ah;const s=t.x,i=t.y;return e.x=this.a*s+this.c*i+this.tx,e.y=this.b*s+this.d*i+this.ty,e}applyInverse(t,e){e=e||new Ah;const s=1/(this.a*this.d+this.c*-this.b),i=t.x,n=t.y;return e.x=this.d*s*i+-this.c*s*n+(this.ty*this.c-this.tx*this.d)*s,e.y=this.a*s*n+-this.b*s*i+(-this.ty*this.a+this.tx*this.b)*s,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),s=Math.sin(t),i=this.a,n=this.c,r=this.tx;return this.a=i*e-this.b*s,this.b=i*s+this.b*e,this.c=n*e-this.d*s,this.d=n*s+this.d*e,this.tx=r*e-this.ty*s,this.ty=r*s+this.ty*e,this}append(t){const e=this.a,s=this.b,i=this.c,n=this.d;return this.a=t.a*e+t.b*i,this.b=t.a*s+t.b*n,this.c=t.c*e+t.d*i,this.d=t.c*s+t.d*n,this.tx=t.tx*e+t.ty*i+this.tx,this.ty=t.tx*s+t.ty*n+this.ty,this}setTransform(t,e,s,i,n,r,a,o,h){return this.a=Math.cos(a+h)*n,this.b=Math.sin(a+h)*n,this.c=-Math.sin(a-o)*r,this.d=Math.cos(a-o)*r,this.tx=t-(s*this.a+i*this.c),this.ty=e-(s*this.b+i*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const e=this.a,s=this.c;this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,s=this.b,i=this.c,n=this.d,r=t.pivot,a=-Math.atan2(-i,n),o=Math.atan2(s,e),h=Math.abs(a+o);return h<1e-5||Math.abs(wh-h)<1e-5?(t.rotation=o,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=o),t.scale.x=Math.sqrt(e*e+s*s),t.scale.y=Math.sqrt(i*i+n*n),t.position.x=this.tx+(r.x*e+r.y*i),t.position.y=this.ty+(r.x*s+r.y*n),t}invert(){const t=this.a,e=this.b,s=this.c,i=this.d,n=this.tx,r=t*i-e*s;return this.a=i/r,this.b=-e/r,this.c=-s/r,this.d=t/r,this.tx=(s*this.ty-i*n)/r,this.ty=-(t*this.ty-e*n)/r,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Dh;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new Dh}static get TEMP_MATRIX(){return new Dh}}const Fh=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Oh=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Nh=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Bh=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Lh=[],Vh=[],$h=Math.sign;!function(){for(let t=0;t<16;t++){const e=[];Lh.push(e);for(let s=0;s<16;s++){const i=$h(Fh[t]*Fh[s]+Nh[t]*Oh[s]),n=$h(Oh[t]*Fh[s]+Bh[t]*Oh[s]),r=$h(Fh[t]*Nh[s]+Nh[t]*Bh[s]),a=$h(Oh[t]*Nh[s]+Bh[t]*Bh[s]);for(let t=0;t<16;t++)if(Fh[t]===i&&Oh[t]===n&&Nh[t]===r&&Bh[t]===a){e.push(t);break}}}for(let t=0;t<16;t++){const e=new Dh;e.set(Fh[t],Oh[t],Nh[t],Bh[t],0,0),Vh.push(e)}}();const Uh={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>Fh[t],uY:t=>Oh[t],vX:t=>Nh[t],vY:t=>Bh[t],inv:t=>8&t?15&t:7&-t,add:(t,e)=>Lh[t][e],sub:(t,e)=>Lh[t][Uh.inv(e)],rotate180:t=>4^t,isVertical:t=>2==(3&t),byDirection:(t,e)=>2*Math.abs(t)<=Math.abs(e)?e>=0?Uh.S:Uh.N:2*Math.abs(e)<=Math.abs(t)?t>0?Uh.E:Uh.W:e>0?t>0?Uh.SE:Uh.SW:t>0?Uh.NE:Uh.NW,matrixAppendRotationInv:(t,e,s=0,i=0)=>{const n=Vh[Uh.inv(e)];n.tx=s,n.ty=i,t.append(n)}};class Xh{constructor(t,e,s=0,i=0){this._x=s,this._y=i,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new Xh(t,e,this._x,this._y)}set(t=0,e=t){return this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const Yh=class{constructor(){this.worldTransform=new Dh,this.localTransform=new Dh,this.position=new Xh(this.onChange,this,0,0),this.scale=new Xh(this.onChange,this,1,1),this.pivot=new Xh(this.onChange,this,0,0),this.skew=new Xh(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){const s=t.worldTransform,i=this.worldTransform;i.a=e.a*s.a+e.b*s.c,i.b=e.a*s.b+e.b*s.d,i.c=e.c*s.a+e.d*s.c,i.d=e.c*s.b+e.d*s.d,i.tx=e.tx*s.a+e.ty*s.c+s.tx,i.ty=e.tx*s.b+e.ty*s.d+s.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}};let Wh=Yh;Wh.IDENTITY=new Yh;function jh(t,e,s){const i=t.createShader(e);return t.shaderSource(i,s),t.compileShader(i),i}function Gh(t){const e=new Array(t);for(let s=0;s<e.length;s++)e[s]=!1;return e}function zh(t,e){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return Gh(2*e);case"bvec3":return Gh(3*e);case"bvec4":return Gh(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Hh=[{test:t=>"float"===t.type&&1===t.size&&!t.isArray,code:t=>`\n            if(uv["${t}"] !== ud["${t}"].value)\n            {\n                ud["${t}"].value = uv["${t}"]\n                gl.uniform1f(ud["${t}"].location, uv["${t}"])\n            }\n            `},{test:(t,e)=>!("sampler2D"!==t.type&&"samplerCube"!==t.type&&"sampler2DArray"!==t.type||1!==t.size||t.isArray||null!=e&&void 0===e.castToBaseTexture),code:t=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${t}"], t);\n\n            if(ud["${t}"].value !== t)\n            {\n                ud["${t}"].value = t;\n                gl.uniform1i(ud["${t}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(t,e)=>"mat3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.a,code:t=>`\n            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));\n            `,codeUbo:t=>`\n                var ${t}_matrix = uv.${t}.toArray(true);\n\n                data[offset] = ${t}_matrix[0];\n                data[offset+1] = ${t}_matrix[1];\n                data[offset+2] = ${t}_matrix[2];\n        \n                data[offset + 4] = ${t}_matrix[3];\n                data[offset + 5] = ${t}_matrix[4];\n                data[offset + 6] = ${t}_matrix[5];\n        \n                data[offset + 8] = ${t}_matrix[6];\n                data[offset + 9] = ${t}_matrix[7];\n                data[offset + 10] = ${t}_matrix[8];\n            `},{test:(t,e)=>"vec2"===t.type&&1===t.size&&!t.isArray&&void 0!==e.x,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${t}"].location, v.x, v.y);\n                }`,codeUbo:t=>`\n                v = uv.${t};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:t=>"vec2"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);\n                }\n            `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.width,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(t,e)=>"vec3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:t=>"vec4"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])\n                }`}],qh={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},Kh={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};const Zh={};let Qh,Jh=Zh;function tl(){if(!Qh){Qh=wr.MEDIUM;const t=function(){if(Jh===Zh||(null==Jh?void 0:Jh.isContextLost())){const t=Ar.ADAPTER.createCanvas();let e;Ar.PREFER_ENV>=or.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),Jh=e}return Jh}();if(t&&t.getShaderPrecisionFormat){const e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);Qh=e.precision?wr.HIGH:wr.MEDIUM}}return Qh}function el(t,e){const s=t.getShaderSource(e).split("\n").map(((t,e)=>`${e}: ${t}`)),i=t.getShaderInfoLog(e),n=i.split("\n"),r={},a=n.map((t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((t=>!(!t||r[t])&&(r[t]=!0,!0))),o=[""];a.forEach((t=>{s[t-1]=`%c${s[t-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const h=s.join("\n");o[0]=h,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}const sl={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function il(t){return sl[t]}let nl=null;const rl={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function al(t,e){if(!nl){const e=Object.keys(rl);nl={};for(let s=0;s<e.length;++s){const i=e[s];nl[t[i]]=rl[i]}}return nl[e]}function ol(t,e,s){if("precision"!==t.substring(0,9)){let i=e;return e===wr.HIGH&&s!==wr.HIGH&&(i=wr.MEDIUM),`precision ${i} float;\n${t}`}return s!==wr.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}let hl;let ll=0;const cl={},ul=class{constructor(t,e,s="pixi-shader",i={}){this.extra={},this.id=ll++,this.vertexSrc=t||ul.defaultVertexSrc,this.fragmentSrc=e||ul.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=i,"#version"!==this.vertexSrc.substring(0,8)&&(s=s.replace(/\s+/g,"-"),cl[s]?(cl[s]++,s+=`-${cl[s]}`):cl[s]=1,this.vertexSrc=`#define SHADER_NAME ${s}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${s}\n${this.fragmentSrc}`,this.vertexSrc=ol(this.vertexSrc,ul.defaultVertexPrecision,wr.HIGH),this.fragmentSrc=ol(this.fragmentSrc,ul.defaultFragmentPrecision,tl())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(t,e,s){const i=t+e;let n=Uo[i];return n||(Uo[i]=n=new ul(t,e,s)),n}};let dl=ul;dl.defaultVertexPrecision=wr.HIGH,dl.defaultFragmentPrecision=Wr.apple.device?wr.HIGH:wr.MEDIUM;let pl=0;class fl{constructor(t,e,s){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=pl++,this.static=!!e,this.ubo=!!s,t instanceof fh?(this.buffer=t,this.buffer.type=Tr.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new fh(new Float32Array(1)),this.buffer.type=Tr.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,s){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new fl(e,s)}static from(t,e,s){return new fl(t,e,s)}static uboFrom(t,e){return new fl(t,null==e||e,!0)}}class ml{constructor(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof fl?e:new fl(e):new fl({}),this.disposeRunner=new ah("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const s in e.uniforms){const i=e.uniforms[s];if(i.group&&this.checkUniformExists(t,i))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,s){const i=dl.from(t,e);return new ml(i,s)}}class gl{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const e=new Int32Array(t);for(let i=0;i<t;i++)e[i]=i;this.defaultGroupCache[t]=fl.from({uSamplers:e},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${t}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new dl(this.vertexSrc,s)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new Dh,default:this.defaultGroupCache[t]};return new ml(this.programCache[t],e)}generateSampleSrc(t){let e="";e+="\n",e+="\n";for(let s=0;s<t;s++)s>0&&(e+="\nelse "),s<t-1&&(e+=`if(vTextureId < ${s}.5)`),e+="\n{",e+=`\n\tcolor = texture2D(uSamplers[${s}], vTextureCoord);`,e+="\n}";return e+="\n",e+="\n",e}}class yl{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class xl{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}const vl=class extends xl{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=bh,this.vertexSize=6,this.state=ih.for2d(),this.size=4*vl.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){var t;return this._defaultMaxTextures=null!=(t=this._defaultMaxTextures)?t:function(t){let e=!0;const s=Ar.ADAPTER.getNavigator();if(Wr.tablet||Wr.phone){if(Wr.apple.device){const t=s.userAgent.match(/OS (\d+)_(\d+)?/);t&&parseInt(t[1],10)<11&&(e=!1)}if(Wr.android.device){const t=s.userAgent.match(/Android\s([0-9.]*)/);t&&parseInt(t[1],10)<7&&(e=!1)}}return e?t:4}(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){var t;return this._canUploadSameBuffer=null!=(t=this._canUploadSameBuffer)?t:!Wr.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return za("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:t=vl.defaultVertexSrc,fragment:e=vl.defaultFragmentTemplate}={}){this.shaderGenerator=new gl(t,e)}contextChange(){const t=this.renderer.gl;Ar.PREFER_ENV===or.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),vl.defaultMaxTextures),this.maxTextures=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const s=e.createShader(e.FRAGMENT_SHADER);for(;;){const i=eh.replace(/%forloop%/gi,sh(t));if(e.shaderSource(s,i),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS))break;t=t/2|0}return t}(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=vl,s=this.size/4,i=Math.floor(s/this.maxTextures)+1;for(;t.length<s;)t.push(new dh);for(;e.length<i;)e.push(new yl);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,s=vl._textureArrayPool,i=this.renderer.batch,n=this._tempBoundTextures,r=this.renderer.textureGC.count;let a=++uh._globalBatch,o=0,h=s[0],l=0;i.copyBoundTextures(n,e);for(let c=0;c<this._bufferSize;++c){const u=t[c];t[c]=null,u._batchEnabled!==a&&(h.count>=e&&(i.boundArray(h,n,a,e),this.buildDrawCalls(h,l,c),l=c,h=s[++o],++a),u._batchEnabled=a,u.touched=r,h.elements[h.count++]=u)}h.count>0&&(i.boundArray(h,n,a,e),this.buildDrawCalls(h,l,this._bufferSize),++o,++a);for(let c=0;c<n.length;c++)n[c]=null;uh._globalBatch=a}buildDrawCalls(t,e,s){const{_bufferedElements:i,_attributeBuffer:n,_indexBuffer:r,vertexSize:a}=this,o=vl._drawCallPool;let h=this._dcIndex,l=this._aIndex,c=this._iIndex,u=o[h];u.start=this._iIndex,u.texArray=t;for(let d=e;d<s;++d){const s=i[d],p=s._texture.baseTexture,f=Io[p.alphaMode?1:0][s.blendMode];i[d]=null,e<d&&u.blend!==f&&(u.size=c-u.start,e=d,u=o[++h],u.texArray=t,u.start=c),this.packInterleavedGeometry(s,n,r,l,c),l+=s.vertexData.length/2*a,c+=s.indices.length,u.blend=f}e<s&&(u.size=c-u.start,++h),this._dcIndex=h,this._aIndex=l,this._iIndex=c}bindAndClearTexArray(t){const e=this.renderer.texture;for(let s=0;s<t.count;s++)e.bind(t.elements[s],t.ids[s]),t.elements[s]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:s}=this;vl.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(s),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(s),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:s}=this.renderer,i=vl._drawCallPool;let n=null;for(let r=0;r<t;r++){const{texArray:t,type:a,size:o,start:h,blend:l}=i[r];n!==t&&(n=t,this.bindAndClearTexArray(t)),this.state.blendMode=l,s.set(this.state),e.drawElements(a,o,e.UNSIGNED_SHORT,2*h)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),vl.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=ko(Math.ceil(t/8)),s=Fo(e),i=8*e;this._aBuffers.length<=s&&(this._iBuffers.length=s+1);let n=this._aBuffers[i];return n||(this._aBuffers[i]=n=new th(i*this.vertexSize*4)),n}getIndexBuffer(t){const e=ko(Math.ceil(t/12)),s=Fo(e),i=12*e;this._iBuffers.length<=s&&(this._iBuffers.length=s+1);let n=this._iBuffers[s];return n||(this._iBuffers[s]=n=new Uint16Array(i)),n}packInterleavedGeometry(t,e,s,i,n){const{uint32View:r,float32View:a}=e,o=i/this.vertexSize,h=t.uvs,l=t.indices,c=t.vertexData,u=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),p=Ao.shared.setValue(t._tintRGB).toPremultiplied(d,t._texture.baseTexture.alphaMode>0);for(let f=0;f<c.length;f+=2)a[i++]=c[f],a[i++]=c[f+1],a[i++]=h[f],a[i++]=h[f+1],r[i++]=p,a[i++]=u;for(let f=0;f<l.length;f++)s[n++]=o+l[f]}};let _l=vl;_l.defaultBatchSize=4096,_l.extension={name:"batch",type:Ko.RendererPlugin},_l._drawCallPool=[],_l._textureArrayPool=[],Jo.add(_l);const bl=class extends ml{constructor(t,e,s){super(dl.from(t||bl.defaultVertexSrc,e||bl.defaultFragmentSrc),s),this.padding=0,this.resolution=bl.defaultResolution,this.multisample=bl.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new ih}apply(t,e,s,i,n){t.applyFilter(this,e,s,i)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};let wl=bl;wl.defaultResolution=1,wl.defaultMultisample=Sr.NONE;class El{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Ao(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:s,backgroundAlpha:i}=t,n=null!=s?s:e;void 0!==n&&(this.color=n),this.alpha=i}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}El.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},El.extension={type:[Ko.RendererSystem,Ko.CanvasRendererSystem],name:"background"},Jo.add(El);class Sl{constructor(t){this.renderer=t,this.emptyRenderer=new xl(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:s}=this.renderer.texture;for(let i=e-1;i>=0;--i)t[i]=s[i]||null,t[i]&&(t[i]._batchLocation=i)}boundArray(t,e,s,i){const{elements:n,ids:r,count:a}=t;let o=0;for(let h=0;h<a;h++){const t=n[h],a=t._batchLocation;if(a>=0&&a<i&&e[a]===t)r[h]=a;else for(;o<i;){const i=e[o];if(!i||i._batchEnabled!==s||i._batchLocation!==o){r[h]=o,t._batchLocation=o,e[o]=t;break}o++}}}destroy(){this.renderer=null}}Sl.extension={type:Ko.RendererSystem,name:"batch"},Jo.add(Sl);let Tl=0;class Al{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Tl++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,s=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:s,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Tl++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;void 0!==e.addEventListener&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let s;if(Ar.PREFER_ENV>=or.WEBGL2&&(s=t.getContext("webgl2",e)),s)this.webGLVersion=2;else if(this.webGLVersion=1,s=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!s)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=s,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout((()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()}),0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,void 0!==t.removeEventListener&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),s="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;s&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const i=s||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=i,i||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Al.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Al.extension={type:Ko.RendererSystem,name:"context"},Jo.add(Al);class Cl extends hh{upload(t,e,s){const i=t.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===vr.UNPACK);const n=e.realWidth,r=e.realHeight;return s.width===n&&s.height===r?i.texSubImage2D(e.target,0,0,0,n,r,e.format,s.type,this.data):(s.width=n,s.height=r,i.texImage2D(e.target,0,s.internalFormat,n,r,0,e.format,s.type,this.data)),!0}}class Ml{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new ah("disposeFramebuffer"),this.multisample=Sr.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new uh(null,{scaleMode:gr.NEAREST,resolution:1,mipmap:xr.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new uh(new Cl(null,{width:this.width,height:this.height}),{scaleMode:gr.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:xr.OFF,format:dr.DEPTH_COMPONENT,type:fr.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let s=0;s<this.colorTextures.length;s++){const i=this.colorTextures[s],n=i.resolution;i.setSize(t/n,e/n)}if(this.depthTexture){const s=this.depthTexture.resolution;this.depthTexture.setSize(t/s,e/s)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Il extends uh{constructor(t={}){if("number"==typeof t){t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}}t.width=t.width||100,t.height=t.height||100,null!=t.multisample||(t.multisample=Sr.NONE),super(null,t),this.mipmap=xr.OFF,this.valid=!0,this._clear=new Ao([0,0,0,0]),this.framebuffer=new Ml(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Pl extends oh{constructor(t){const e=t;super(e.naturalWidth||e.videoWidth||e.width,e.naturalHeight||e.videoHeight||e.height),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,s){void 0!==s||e.startsWith("data:")?!1!==s&&(t.crossOrigin="string"==typeof s?s:"anonymous"):t.crossOrigin=function(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location,Ho||(Ho=document.createElement("a")),Ho.href=t;const s=Xa.parse(Ho.href),i=!s.port&&""===e.port||s.port===e.port;return s.hostname===e.hostname&&i&&s.protocol===e.protocol?"":"anonymous"}(e)}upload(t,e,s,i){const n=t.gl,r=e.realWidth,a=e.realHeight;if(i=i||this.source,"undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement){if(!i.complete||0===i.naturalWidth)return!1}else if("undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement&&i.readyState<=1&&0===i.buffered.length)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===vr.UNPACK),this.noSubImage||e.target!==n.TEXTURE_2D||s.width!==r||s.height!==a?(s.width=r,s.height=a,n.texImage2D(e.target,0,s.internalFormat,e.format,s.type,i)):n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.format,s.type,i),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,s=t.naturalHeight||t.videoHeight||t.height;this.resize(e,s),super.update()}dispose(){this.source=null}}class Rl extends Pl{constructor(t,e){var s;if(e=e||{},"string"==typeof t){const s=new Image;Pl.crossOrigin(s,t,e.crossorigin),s.src=t,t=s}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(null!=(s=e.createBitmap)?s:Ar.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.bitmap=null,this._load=null,!1!==e.autoLoad&&this.load()}load(t){return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise(((t,e)=>{const s=this.source;this.url=s.src;const i=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.resize(s.width,s.height),this._load=null,this.createBitmap?t(this.process()):t(this))};s.complete&&s.src?i():(s.onload=i,s.onerror=t=>{e(t),this.onError.emit(t)})}))),this._load}process(){const t=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,s=!t.crossOrigin||"anonymous"===t.crossOrigin;return this._process=fetch(t.src,{mode:s?"cors":"no-cors"}).then((t=>t.blob())).then((s=>e(s,0,0,t.width,t.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===vr.UNPACK?"premultiply":"none"}))).then((t=>this.destroyed?Promise.reject():(this.bitmap=t,this.update(),this._process=null,Promise.resolve(this)))),this._process}upload(t,e,s){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,s);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,s,this.bitmap),!this.preserveBitmap){let t=!0;const i=e._glTextures;for(const n in i){const r=i[n];if(r!==s&&r.dirtyId!==e.dirtyId){t=!1;break}}t&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return"undefined"!=typeof HTMLImageElement&&("string"==typeof t||t instanceof HTMLImageElement)}}class kl{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,s){const i=e.width,n=e.height;if(s){const e=t.width/2/i,r=t.height/2/n,a=t.x/i+e,o=t.y/n+r;s=Uh.add(s,Uh.NW),this.x0=a+e*Uh.uX(s),this.y0=o+r*Uh.uY(s),s=Uh.add(s,2),this.x1=a+e*Uh.uX(s),this.y1=o+r*Uh.uY(s),s=Uh.add(s,2),this.x2=a+e*Uh.uX(s),this.y2=o+r*Uh.uY(s),s=Uh.add(s,2),this.x3=a+e*Uh.uX(s),this.y3=o+r*Uh.uY(s)}else this.x0=t.x/i,this.y0=t.y/n,this.x1=(t.x+t.width)/i,this.y1=t.y/n,this.x2=(t.x+t.width)/i,this.y2=(t.y+t.height)/n,this.x3=t.x/i,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const Dl=new kl;function Fl(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}class Ol extends x{constructor(t,e,s,i,n,r,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Mh(0,0,1,1)),t instanceof Ol&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=i,this.valid=!1,this._uvs=Dl,this.uvMatrix=null,this.orig=s||e,this._rotate=Number(n||0),!0===n)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=r?new Ah(r.x,r.y):new Ah(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:t}=this.baseTexture;(null==t?void 0:t.url)&&Xo[t.url]&&Ol.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Ol.removeFromCache(this),this.textureCacheIds=null}clone(){var t;const e=this._frame.clone(),s=this._frame===this.orig?e:this.orig.clone(),i=new Ol(this.baseTexture,!this.noFrame&&e,s,null==(t=this.trim)?void 0:t.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=e),i}updateUvs(){this._uvs===Dl&&(this._uvs=new kl),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},s=Ar.STRICT_TEXTURE_CACHE){const i="string"==typeof t;let n=null;if(i)n=t;else if(t instanceof uh){if(!t.cacheId){const s=(null==e?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${s}-${Lo()}`,uh.addToCache(t,t.cacheId)}n=t.cacheId}else{if(!t._pixiId){const s=(null==e?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${s}_${Lo()}`}n=t._pixiId}let r=Xo[n];if(i&&s&&!r)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return r||t instanceof uh?!r&&t instanceof uh&&(r=new Ol(t),Ol.addToCache(r,n)):(e.resolution||(e.resolution=qo(t)),r=new Ol(new uh(t,e)),r.baseTexture.cacheId=n,uh.addToCache(r.baseTexture,n),Ol.addToCache(r,n)),r}static fromURL(t,e){const s=Object.assign({autoLoad:!1},null==e?void 0:e.resourceOptions),i=Ol.from(t,Object.assign({resourceOptions:s},e),!1),n=i.baseTexture.resource;return i.baseTexture.valid?Promise.resolve(i):n.load().then((()=>Promise.resolve(i)))}static fromBuffer(t,e,s,i){return new Ol(uh.fromBuffer(t,e,s,i))}static fromLoader(t,e,s,i){const n=new uh(t,Object.assign({scaleMode:uh.defaultOptions.scaleMode,resolution:qo(e)},i)),{resource:r}=n;r instanceof Rl&&(r.url=e);const a=new Ol(n);return s||(s=e),uh.addToCache(a.baseTexture,s),Ol.addToCache(a,s),s!==e&&(uh.addToCache(a.baseTexture,e),Ol.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise((t=>{a.baseTexture.once("loaded",(()=>t(a)))}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Xo[e]&&Xo[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Xo[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=Xo[t];if(e){const s=e.textureCacheIds.indexOf(t);return s>-1&&e.textureCacheIds.splice(s,1),delete Xo[t],e}}else if(null==t?void 0:t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Xo[t.textureCacheIds[e]]===t&&delete Xo[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:s,width:i,height:n}=t,r=e+i>this.baseTexture.width,a=s+n>this.baseTexture.height;if(r||a){const t=r&&a?"and":"or",o=`X: ${e} + ${i} = ${e+i} > ${this.baseTexture.width}`,h=`Y: ${s} + ${n} = ${s+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${o} ${t} ${h}`)}this.valid=i&&n&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Ol._EMPTY||(Ol._EMPTY=new Ol(new uh),Fl(Ol._EMPTY),Fl(Ol._EMPTY.baseTexture)),Ol._EMPTY}static get WHITE(){if(!Ol._WHITE){const t=Ar.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Ol._WHITE=new Ol(uh.from(t)),Fl(Ol._WHITE),Fl(Ol._WHITE.baseTexture)}return Ol._WHITE}}class Nl extends Ol{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,s=!0){const i=this.baseTexture.resolution,n=Math.round(t*i)/i,r=Math.round(e*i)/i;this.valid=n>0&&r>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=r,s&&this.baseTexture.resize(n,r),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Nl(new Il(t))}}class Bl{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,s=Sr.NONE){const i=new Il(Object.assign({width:t,height:e,resolution:1,multisample:s},this.textureOptions));return new Nl(i)}getOptimalTexture(t,e,s=1,i=Sr.NONE){let n;t=Math.ceil(t*s-1e-6),e=Math.ceil(e*s-1e-6),this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight?n=i>1?-i:-1:(n=((65535&(t=ko(t)))<<16|65535&(e=ko(e)))>>>0,i>1&&(n+=4294967296*i)),this.texturePool[n]||(this.texturePool[n]=[]);let r=this.texturePool[n].pop();return r||(r=this.createTexture(t,e,i)),r.filterPoolKey=n,r.setResolution(s),r}getFilterTexture(t,e,s){const i=this.getOptimalTexture(t.width,t.height,e||t.resolution,s||Sr.NONE);return i.filterFrame=t.filterFrame,i}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=!1!==t)for(const e in this.texturePool){const t=this.texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0)}this.texturePool={}}setScreenSize(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){this.enableFullScreen=t.width>0&&t.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Bl.SCREEN_KEY=-1;class Ll extends _h{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Vl extends _h{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new fh(this.vertices),this.uvBuffer=new fh(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let s=0,i=0;return this.uvs[0]=s,this.uvs[1]=i,this.uvs[2]=s+e.width/t.width,this.uvs[3]=i,this.uvs[4]=s+e.width/t.width,this.uvs[5]=i+e.height/t.height,this.uvs[6]=s,this.uvs[7]=i+e.height/t.height,s=e.x,i=e.y,this.vertices[0]=s,this.vertices[1]=i,this.vertices[2]=s+e.width,this.vertices[3]=i,this.vertices[4]=s+e.width,this.vertices[5]=i+e.height,this.vertices[6]=s,this.vertices[7]=i+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class $l{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Sr.NONE,this.sourceFrame=new Mh,this.destinationFrame=new Mh,this.bindingSourceFrame=new Mh,this.bindingDestinationFrame=new Mh,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Ul=[new Ah,new Ah,new Ah,new Ah],Xl=new Dh;class Yl{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Bl,this.statePool=[],this.quad=new Ll,this.quadUv=new Vl,this.tempRect=new Mh,this.activeState={},this.globalUniforms=new fl({outputFrame:new Mh,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){var s,i;const n=this.renderer,r=this.defaultFilterStack,a=this.statePool.pop()||new $l,o=this.renderer.renderTexture;let h=e[0].resolution,l=e[0].multisample,c=e[0].padding,u=e[0].autoFit,d=null==(s=e[0].legacy)||s;for(let m=1;m<e.length;m++){const t=e[m];h=Math.min(h,t.resolution),l=Math.min(l,t.multisample),c=this.useMaxPadding?Math.max(c,t.padding):c+t.padding,u=u&&t.autoFit,d=d||null==(i=t.legacy)||i}1===r.length&&(this.defaultFilterStack[0].renderTexture=o.current),r.push(a),a.resolution=h,a.multisample=l,a.legacy=d,a.target=t,a.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),a.sourceFrame.pad(c);const p=this.tempRect.copyFrom(o.sourceFrame);n.projection.transform&&this.transformAABB(Xl.copyFrom(n.projection.transform).invert(),p),u?(a.sourceFrame.fit(p),(a.sourceFrame.width<=0||a.sourceFrame.height<=0)&&(a.sourceFrame.width=0,a.sourceFrame.height=0)):a.sourceFrame.intersects(p)||(a.sourceFrame.width=0,a.sourceFrame.height=0),this.roundFrame(a.sourceFrame,o.current?o.current.resolution:n.resolution,o.sourceFrame,o.destinationFrame,n.projection.transform),a.renderTexture=this.getOptimalFilterTexture(a.sourceFrame.width,a.sourceFrame.height,h,l),a.filters=e,a.destinationFrame.width=a.renderTexture.width,a.destinationFrame.height=a.renderTexture.height;const f=this.tempRect;f.x=0,f.y=0,f.width=a.sourceFrame.width,f.height=a.sourceFrame.height,a.renderTexture.filterFrame=a.sourceFrame,a.bindingSourceFrame.copyFrom(o.sourceFrame),a.bindingDestinationFrame.copyFrom(o.destinationFrame),a.transform=n.projection.transform,n.projection.transform=null,o.bind(a.renderTexture,a.sourceFrame,f),n.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),s=e.filters;this.activeState=e;const i=this.globalUniforms.uniforms;i.outputFrame=e.sourceFrame,i.resolution=e.resolution;const n=i.inputSize,r=i.inputPixel,a=i.inputClamp;if(n[0]=e.destinationFrame.width,n[1]=e.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],r[0]=Math.round(n[0]*e.resolution),r[1]=Math.round(n[1]*e.resolution),r[2]=1/r[0],r[3]=1/r[1],a[0]=.5*r[2],a[1]=.5*r[3],a[2]=e.sourceFrame.width*n[2]-.5*r[2],a[3]=e.sourceFrame.height*n[3]-.5*r[3],e.legacy){const t=i.filterArea;t[0]=e.destinationFrame.width,t[1]=e.destinationFrame.height,t[2]=e.sourceFrame.x,t[3]=e.sourceFrame.y,i.filterClamp=i.inputClamp}this.globalUniforms.update();const o=t[t.length-1];if(this.renderer.framebuffer.blit(),1===s.length)s[0].apply(this,e.renderTexture,o.renderTexture,_r.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let t=e.renderTexture,i=this.getOptimalFilterTexture(t.width,t.height,e.resolution);i.filterFrame=t.filterFrame;let n=0;for(n=0;n<s.length-1;++n){1===n&&e.multisample>1&&(i=this.getOptimalFilterTexture(t.width,t.height,e.resolution),i.filterFrame=t.filterFrame),s[n].apply(this,t,i,_r.CLEAR,e);const r=t;t=i,i=r}s[n].apply(this,t,o.renderTexture,_r.BLEND,e),n>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(t),this.returnFilterTexture(i)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=_r.CLEAR){const{renderTexture:s,state:i}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,null==t?void 0:t.filterFrame){const e=this.tempRect;e.x=0,e.y=0,e.width=t.filterFrame.width,e.height=t.filterFrame.height,s.bind(t,t.filterFrame,e)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?s.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=1&i.stateId||this.forceClear;(e===_r.CLEAR||e===_r.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,s,i){const n=this.renderer;n.state.set(t.state),this.bindAndClear(s,i),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(ur.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(ur.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:s,destinationFrame:i}=this.activeState,{orig:n}=e._texture,r=t.set(i.width,0,0,i.height,s.x,s.y),a=e.worldTransform.copyTo(Dh.TEMP_MATRIX);return a.invert(),r.prepend(a),r.scale(1/n.width,1/n.height),r.translate(e.anchor.x,e.anchor.y),r}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,s=1,i=Sr.NONE){return this.texturePool.getOptimalTexture(t,e,s,i)}getFilterTexture(t,e,s){if("number"==typeof t){const s=t;t=e,e=s}t=t||this.activeState.renderTexture;const i=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,s||Sr.NONE);return i.filterFrame=t.filterFrame,i}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const s=Ul[0],i=Ul[1],n=Ul[2],r=Ul[3];s.set(e.left,e.top),i.set(e.left,e.bottom),n.set(e.right,e.top),r.set(e.right,e.bottom),t.apply(s,s),t.apply(i,i),t.apply(n,n),t.apply(r,r);const a=Math.min(s.x,i.x,n.x,r.x),o=Math.min(s.y,i.y,n.y,r.y),h=Math.max(s.x,i.x,n.x,r.x),l=Math.max(s.y,i.y,n.y,r.y);e.x=a,e.y=o,e.width=h-a,e.height=l-o}roundFrame(t,e,s,i,n){if(!(t.width<=0||t.height<=0||s.width<=0||s.height<=0)){if(n){const{a:t,b:e,c:s,d:i}=n;if((Math.abs(e)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(i)>1e-4))return}(n=n?Xl.copyFrom(n):Xl.identity()).translate(-s.x,-s.y).scale(i.width/s.width,i.height/s.height).translate(i.x,i.y),this.transformAABB(n,t),t.ceil(e),this.transformAABB(n.invert(),t)}}}Yl.extension={type:Ko.RendererSystem,name:"filter"},Jo.add(Yl);class Wl{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Sr.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const jl=new Mh;class Gl{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Ml(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Mh,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let e=this.renderer.context.extensions.drawBuffers,s=this.renderer.context.extensions.depthTexture;Ar.PREFER_ENV===or.WEBGL_LEGACY&&(e=null,s=null),e?t.drawBuffers=t=>e.drawBuffersWEBGL(t):(this.hasMRT=!1,t.drawBuffers=()=>{}),s||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,s=0){const{gl:i}=this;if(t){const n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,i.bindFramebuffer(i.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==s&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=s),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,s)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let e=0;e<t.colorTextures.length;e++){const s=t.colorTextures[e];this.renderer.texture.unbind(s.parentTextureArray||s)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const t=e.width>>s,i=e.height>>s,n=t/e.width;this.setViewport(e.x*n,e.y*n,t,i)}else{const e=t.width>>s,i=t.height>>s;this.setViewport(0,0,e,i)}}else this.current&&(this.current=null,i.bindFramebuffer(i.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,s,i){const n=this.viewport;t=Math.round(t),e=Math.round(e),s=Math.round(s),i=Math.round(i),n.width===s&&n.height===i&&n.x===t&&n.y===e||(n.x=t,n.y=e,n.width=s,n.height=i,this.gl.viewport(t,e,s,i))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,s,i,n=lr.COLOR|lr.DEPTH){const{gl:r}=this;r.clearColor(t,e,s,i),r.clear(n)}initFramebuffer(t){const{gl:e}=this,s=new Wl(e.createFramebuffer());return s.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=s,this.managedFramebuffers.push(t),t.disposeRunner.add(this),s}resizeFramebuffer(t){const{gl:e}=this,s=t.glFramebuffers[this.CONTEXT_UID];s.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,s.stencil),s.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,s.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const i=t.colorTextures;let n=i.length;e.drawBuffers||(n=Math.min(n,1));for(let r=0;r<n;r++){const n=i[r],a=n.parentTextureArray||n;this.renderer.texture.bind(a,0),0===r&&s.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,s.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,s.multisample,a._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:s}=this,i=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures;let r=n.length;s.drawBuffers||(r=Math.min(r,1)),i.multisample>1&&this.canMultisampleFramebuffer(t)?i.msaaBuffer=i.msaaBuffer||s.createRenderbuffer():i.msaaBuffer&&(s.deleteRenderbuffer(i.msaaBuffer),i.msaaBuffer=null,i.blitFramebuffer&&(i.blitFramebuffer.dispose(),i.blitFramebuffer=null));const a=[];for(let o=0;o<r;o++){const r=n[o],h=r.parentTextureArray||r;this.renderer.texture.bind(h,0),0===o&&i.msaaBuffer?(s.bindRenderbuffer(s.RENDERBUFFER,i.msaaBuffer),s.renderbufferStorageMultisample(s.RENDERBUFFER,i.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,i.msaaBuffer)):(s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+o,r.target,h._glTextures[this.CONTEXT_UID].texture,e),a.push(s.COLOR_ATTACHMENT0+o))}if(a.length>1&&s.drawBuffers(a),t.depthTexture){if(this.writeDepthTexture){const i=t.depthTexture;this.renderer.texture.bind(i,0),s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,i._glTextures[this.CONTEXT_UID].texture,e)}}!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture?i.stencil&&(s.deleteRenderbuffer(i.stencil),i.stencil=null):(i.stencil=i.stencil||s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,i.stencil),i.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,i.multisample,s.DEPTH24_STENCIL8,t.width,t.height):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,t.width,t.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,i.stencil))}canMultisampleFramebuffer(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let s=Sr.NONE;if(t<=1||null===e)return s;for(let i=0;i<e.length;i++)if(e[i]<=t){s=e[i];break}return 1===s&&(s=Sr.NONE),s}blit(t,e,s){const{current:i,renderer:n,gl:r,CONTEXT_UID:a}=this;if(2!==n.context.webGLVersion)return;if(!i)return;const o=i.glFramebuffers[a];if(!o)return;if(!t){if(!o.msaaBuffer)return;const e=i.colorTextures[0];if(!e)return;o.blitFramebuffer||(o.blitFramebuffer=new Ml(i.width,i.height),o.blitFramebuffer.addColorTexture(0,e)),(t=o.blitFramebuffer).colorTextures[0]!==e&&(t.colorTextures[0]=e,t.dirtyId++,t.dirtyFormat++),t.width===i.width&&t.height===i.height||(t.width=i.width,t.height=i.height,t.dirtyId++,t.dirtySize++)}e||((e=jl).width=i.width,e.height=i.height),s||(s=e);const h=e.width===s.width&&e.height===s.height;this.bind(t),r.bindFramebuffer(r.READ_FRAMEBUFFER,o.framebuffer),r.blitFramebuffer(e.left,e.top,e.right,e.bottom,s.left,s.top,s.right,s.bottom,r.COLOR_BUFFER_BIT,h?r.NEAREST:r.LINEAR),r.bindFramebuffer(r.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const s=t.glFramebuffers[this.CONTEXT_UID],i=this.gl;if(!s)return;delete t.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(i.deleteFramebuffer(s.framebuffer),s.msaaBuffer&&i.deleteRenderbuffer(s.msaaBuffer),s.stencil&&i.deleteRenderbuffer(s.stencil)),s.blitFramebuffer&&this.disposeFramebuffer(s.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let s=0;s<e.length;s++)this.disposeFramebuffer(e[s],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const s=t.width,i=t.height,n=this.gl,r=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,r),e.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,e.multisample,n.DEPTH24_STENCIL8,s,i):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,s,i),e.stencil=r,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,r)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Mh}destroy(){this.renderer=null}}Gl.extension={type:Ko.RendererSystem,name:"framebuffer"},Jo.add(Gl);const zl={5126:4,5123:2,5121:1};class Hl{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){let e=this.renderer.context.extensions.vertexArrayObject;Ar.PREFER_ENV===or.WEBGL_LEGACY&&(e=null),e?(t.createVertexArray=()=>e.createVertexArrayOES(),t.bindVertexArray=t=>e.bindVertexArrayOES(t),t.deleteVertexArray=t=>e.deleteVertexArrayOES(t)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(2!==e.webGLVersion){const e=t.getExtension("ANGLE_instanced_arrays");e?(t.vertexAttribDivisor=(t,s)=>e.vertexAttribDivisorANGLE(t,s),t.drawElementsInstanced=(t,s,i,n,r)=>e.drawElementsInstancedANGLE(t,s,i,n,r),t.drawArraysInstanced=(t,s,i,n)=>e.drawArraysInstancedANGLE(t,s,i,n)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:s}=this;let i=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;i||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=i={},n=!0);const r=i[e.program.id]||this.initGeometryVao(t,e,n);this._activeGeometry=t,this._activeVao!==r&&(this._activeVao=r,this.hasVao?s.bindVertexArray(r):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let s=0;s<t.buffers.length;s++){const i=t.buffers[s];e.update(i)}}checkCompatibility(t,e){const s=t.attributes,i=e.attributeData;for(const n in i)if(!s[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(t,e){const s=t.attributes,i=e.attributeData,n=["g",t.id];for(const r in s)i[r]&&n.push(r,i[r].location);return n.join("-")}initGeometryVao(t,e,s=!0){const i=this.gl,n=this.CONTEXT_UID,r=this.renderer.buffer,a=e.program;a.glPrograms[n]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);const o=this.getSignature(t,a),h=t.glVertexArrayObjects[this.CONTEXT_UID];let l=h[o];if(l)return h[a.id]=l,l;const c=t.buffers,u=t.attributes,d={},p={};for(const f in c)d[f]=0,p[f]=0;for(const f in u)!u[f].size&&a.attributeData[f]?u[f].size=a.attributeData[f].size:u[f].size||console.warn(`PIXI Geometry attribute '${f}' size cannot be determined (likely the bound shader does not have the attribute)`),d[u[f].buffer]+=u[f].size*zl[u[f].type];for(const f in u){const t=u[f],e=t.size;void 0===t.stride&&(d[t.buffer]===e*zl[t.type]?t.stride=0:t.stride=d[t.buffer]),void 0===t.start&&(t.start=p[t.buffer],p[t.buffer]+=e*zl[t.type])}l=i.createVertexArray(),i.bindVertexArray(l);for(let f=0;f<c.length;f++){const t=c[f];r.bind(t),s&&t._glBuffers[n].refCount++}return this.activateVao(t,a),h[a.id]=l,h[o]=l,i.bindVertexArray(null),r.unbind(Tr.ARRAY_BUFFER),l}disposeGeometry(t,e){var s;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,r=t.buffers,a=null==(s=this.renderer)?void 0:s.buffer;if(t.disposeRunner.remove(this),i){if(a)for(let t=0;t<r.length;t++){const s=r[t]._glBuffers[this.CONTEXT_UID];s&&(s.refCount--,0!==s.refCount||e||a.dispose(r[t],e))}if(!e)for(const t in i)if("g"===t[0]){const e=i[t];this._activeVao===e&&this.unbind(),n.deleteVertexArray(e)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let s=0;s<e.length;s++)this.disposeGeometry(this.managedGeometries[e[s]],t)}activateVao(t,e){const s=this.gl,i=this.CONTEXT_UID,n=this.renderer.buffer,r=t.buffers,a=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);let o=null;for(const h in a){const t=a[h],l=r[t.buffer],c=l._glBuffers[i];if(e.attributeData[h]){o!==c&&(n.bind(l),o=c);const i=e.attributeData[h].location;if(s.enableVertexAttribArray(i),s.vertexAttribPointer(i,t.size,t.type||s.FLOAT,t.normalized,t.stride,t.start),t.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");s.vertexAttribDivisor(i,t.divisor)}}}}draw(t,e,s,i){const{gl:n}=this,r=this._activeGeometry;if(r.indexBuffer){const a=r.indexBuffer.data.BYTES_PER_ELEMENT,o=2===a?n.UNSIGNED_SHORT:n.UNSIGNED_INT;2===a||4===a&&this.canUseUInt32ElementIndex?r.instanced?n.drawElementsInstanced(t,e||r.indexBuffer.data.length,o,(s||0)*a,i||1):n.drawElements(t,e||r.indexBuffer.data.length,o,(s||0)*a):console.warn("unsupported index buffer type: uint32")}else r.instanced?n.drawArraysInstanced(t,s,e||r.getSize(),i||1):n.drawArrays(t,s,e||r.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Hl.extension={type:Ko.RendererSystem,name:"geometry"},Jo.add(Hl);const ql=new Dh;class Kl{constructor(t,e){this._texture=t,this.mapCoord=new Dh,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){void 0===e&&(e=t);const s=this.mapCoord;for(let i=0;i<t.length;i+=2){const n=t[i],r=t[i+1];e[i]=n*s.a+r*s.c+s.tx,e[i+1]=n*s.b+r*s.d+s.ty}return e}update(t){const e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const s=e._uvs;this.mapCoord.set(s.x1-s.x0,s.y1-s.y0,s.x3-s.x0,s.y3-s.y0,s.x0,s.y0);const i=e.orig,n=e.trim;n&&(ql.set(i.width/n.width,0,0,i.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(ql));const r=e.baseTexture,a=this.uClampFrame,o=this.clampMargin/r.resolution,h=this.clampOffset;return a[0]=(e._frame.x+o+h)/r.width,a[1]=(e._frame.y+o+h)/r.height,a[2]=(e._frame.x+e._frame.width-o+h)/r.width,a[3]=(e._frame.y+e._frame.height-o+h)/r.height,this.uClampOffset[0]=h/r.realWidth,this.uClampOffset[1]=h/r.realHeight,this.isSimple=e._frame.width===r.width&&e._frame.height===r.height&&0===e.rotate,!0}}class Zl extends wl{constructor(t,e,s){let i=null;"string"!=typeof t&&void 0===e&&void 0===s&&(i=t,t=void 0,e=void 0,s=void 0),super(t||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",e||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",s),this.maskSprite=i,this.maskMatrix=new Dh}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,s,i){const n=this._maskSprite,r=n._texture;r.valid&&(r.uvMatrix||(r.uvMatrix=new Kl(r,0)),r.uvMatrix.update(),this.uniforms.npmAlpha=r.baseTexture.alphaMode?0:1,this.uniforms.mask=r,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(r.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=r.uvMatrix.uClampFrame,t.applyFilter(this,e,s,i))}}class Ql{constructor(t=null){this.type=Er.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=wl.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Er.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Jl{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let s=e;if(!s.isMaskData){const t=this.maskDataPool.pop()||new Ql;t.pooled=!0,t.maskObject=e,s=t}const i=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(s.copyCountersOrReset(i),s._colorMask=i?i._colorMask:15,s.autoDetect&&this.detect(s),s._target=t,s.type!==Er.SPRITE&&this.maskStack.push(s),s.enabled)switch(s.type){case Er.SCISSOR:this.renderer.scissor.push(s);break;case Er.STENCIL:this.renderer.stencil.push(s);break;case Er.SPRITE:s.copyCountersOrReset(null),this.pushSpriteMask(s);break;case Er.COLOR:this.pushColorMask(s)}s.type===Er.SPRITE&&this.maskStack.push(s)}pop(t){const e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case Er.SCISSOR:this.renderer.scissor.pop(e);break;case Er.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case Er.SPRITE:this.popSpriteMask(e);break;case Er.COLOR:this.popColorMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){const t=this.maskStack[this.maskStack.length-1];t.type===Er.SPRITE&&t._filters&&(t._filters[0].maskSprite=t.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=Er.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=Er.SCISSOR:t.type=Er.STENCIL:t.type=Er.COLOR}pushSpriteMask(t){var e,s;const{maskObject:i}=t,n=t._target;let r=t._filters;r||(r=this.alphaMaskPool[this.alphaMaskIndex],r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new Zl]));const a=this.renderer,o=a.renderTexture;let h,l;if(o.current){const s=o.current;h=t.resolution||s.resolution,l=null!=(e=t.multisample)?e:s.multisample}else h=t.resolution||a.resolution,l=null!=(s=t.multisample)?s:a.multisample;r[0].resolution=h,r[0].multisample=l,r[0].maskSprite=i;const c=n.filterArea;n.filterArea=i.getBounds(!0),a.filter.push(n,r),n.filterArea=c,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,s=t._colorMask=e&t.colorMask;s!==e&&this.renderer.gl.colorMask(0!=(1&s),0!=(2&s),0!=(4&s),0!=(8&s))}popColorMask(t){const e=t._colorMask,s=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;s!==e&&this.renderer.gl.colorMask(0!=(1&s),0!=(2&s),0!=(4&s),0!=(8&s))}destroy(){this.renderer=null}}Jl.extension={type:Ko.RendererSystem,name:"mask"},Jo.add(Jl);class tc{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,s=this.getStackLength();this.maskStack=t;const i=this.getStackLength();i!==s&&(0===i?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const ec=new Dh,sc=[],ic=class extends tc{constructor(t){super(t),this.glConst=Ar.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){var e;if(t._scissorRectLocal)return;const s=t._scissorRect,{maskObject:i}=t,{renderer:n}=this,r=n.renderTexture,a=i.getBounds(!0,null!=(e=sc.pop())?e:new Mh);this.roundFrameToPixels(a,r.current?r.current.resolution:n.resolution,r.sourceFrame,r.destinationFrame,n.projection.transform),s&&a.fit(s),t._scissorRectLocal=a}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:s,c:i,d:n}=t;return(Math.abs(s)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(n)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect())return!1;if(ic.isMatrixRotated(e.worldTransform))return!1;if(ic.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const s=t._scissorRectLocal;return s.width>0&&s.height>0}roundFrameToPixels(t,e,s,i,n){ic.isMatrixRotated(n)||((n=n?ec.copyFrom(n):ec.identity()).translate(-s.x,-s.y).scale(i.width/s.width,i.height/s.height).translate(i.x,i.y),this.renderer.filter.transformAABB(n,t),t.fit(i),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&sc.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;e=this.renderer.renderTexture.current?t.y:this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};let nc=ic;nc.extension={type:Ko.RendererSystem,name:"scissor"},Jo.add(nc);class rc extends tc{constructor(t){super(t),this.glConst=Ar.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:s}=this.renderer,i=t._stencilCounter;0===i&&(this.renderer.framebuffer.forceStencil(),s.clearStencil(0),s.clear(s.STENCIL_BUFFER_BIT),s.enable(s.STENCIL_TEST)),t._stencilCounter++;const n=t._colorMask;0!==n&&(t._colorMask=0,s.colorMask(!1,!1,!1,!1)),s.stencilFunc(s.EQUAL,i,4294967295),s.stencilOp(s.KEEP,s.KEEP,s.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==n&&(t._colorMask=n,s.colorMask(0!=(1&n),0!=(2&n),0!=(4&n),0!=(8&n))),this._useCurrent()}pop(t){const e=this.renderer.gl;if(0===this.getStackLength())e.disable(e.STENCIL_TEST);else{const s=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,i=s?s._colorMask:15;0!==i&&(s._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==i&&(s._colorMask=i,e.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}rc.extension={type:Ko.RendererSystem,name:"stencil"},Jo.add(rc);class ac{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(za("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract)},prepare:{enumerable:!1,get:()=>(za("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare)},interaction:{enumerable:!1,get:()=>(za("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events)}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}ac.extension={type:[Ko.RendererSystem,Ko.CanvasRendererSystem],name:"_plugin"},Jo.add(ac);class oc{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Dh,this.transform=null}update(t,e,s,i){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,s,i),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(t,e,s,i){const n=this.projectionMatrix,r=i?-1:1;n.identity(),n.a=1/e.width*2,n.d=r*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-r-e.y*n.d}setTransform(t){}destroy(){this.renderer=null}}oc.extension={type:Ko.RendererSystem,name:"projection"},Jo.add(oc);const hc=new Wh;class lc{constructor(t){this.renderer=t,this._tempMatrix=new Dh}generateTexture(t,e){const s=e||{},{region:i}=s,n=u(s,["region"]),r=i||t.getLocalBounds(null,!0);0===r.width&&(r.width=1),0===r.height&&(r.height=1);const a=Nl.create(l({width:r.width,height:r.height},n));this._tempMatrix.tx=-r.x,this._tempMatrix.ty=-r.y;const o=t.transform;return t.transform=hc,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=o,a}destroy(){}}lc.extension={type:[Ko.RendererSystem,Ko.CanvasRendererSystem],name:"textureGenerator"},Jo.add(lc);const cc=new Mh,uc=new Mh;class dc{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Mh,this.destinationFrame=new Mh,this.viewportFrame=new Mh}contextChange(){var t;const e=null==(t=this.renderer)?void 0:t.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(t=null,e,s){const i=this.renderer;let n,r,a;this.current=t,t?(n=t.baseTexture,a=n.resolution,e||(cc.width=t.frame.width,cc.height=t.frame.height,e=cc),s||(uc.x=t.frame.x,uc.y=t.frame.y,uc.width=e.width,uc.height=e.height,s=uc),r=n.framebuffer):(a=i.resolution,e||(cc.width=i._view.screen.width,cc.height=i._view.screen.height,e=cc),s||((s=cc).width=e.width,s.height=e.height));const o=this.viewportFrame;o.x=s.x*a,o.y=s.y*a,o.width=s.width*a,o.height=s.height*a,t||(o.y=i.view.height-(o.y+o.height)),o.ceil(),this.renderer.framebuffer.bind(r,o),this.renderer.projection.update(s,e,a,!r),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(s)}clear(t,e){const s=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,i=Ao.shared.setValue(t||s);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&i.premultiply(i.alpha);const n=this.destinationFrame,r=this.current?this.current.baseTexture:this.renderer._view.screen,a=n.width!==r.width||n.height!==r.height;if(a){let{x:t,y:e,width:s,height:i}=this.viewportFrame;t=Math.round(t),e=Math.round(e),s=Math.round(s),i=Math.round(i),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(t,e,s,i)}this.renderer.framebuffer.clear(i.red,i.green,i.blue,i.alpha,e),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}dc.extension={type:Ko.RendererSystem,name:"renderTexture"},Jo.add(dc);class pc{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function fc(t,e){var s;const i=jh(t,t.VERTEX_SHADER,e.vertexSrc),n=jh(t,t.FRAGMENT_SHADER,e.fragmentSrc),r=t.createProgram();t.attachShader(r,i),t.attachShader(r,n);const a=null==(s=e.extra)?void 0:s.transformFeedbackVaryings;if(a&&("function"!=typeof t.transformFeedbackVaryings?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):t.transformFeedbackVaryings(r,a.names,"separate"===a.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS)||function(t,e,s,i){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(s,t.COMPILE_STATUS)||el(t,s),t.getShaderParameter(i,t.COMPILE_STATUS)||el(t,i),console.error("PixiJS Error: Could not initialize shader."),""!==t.getProgramInfoLog(e)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}(t,r,i,n),e.attributeData=function(t,e){const s={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){const i=e.getActiveAttrib(t,n);if(i.name.startsWith("gl_"))continue;const r=al(e,i.type),a={type:r,name:i.name,size:il(r),location:e.getAttribLocation(t,i.name)};s[i.name]=a}return s}(r,t),e.uniformData=function(t,e){const s={},i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let n=0;n<i;n++){const i=e.getActiveUniform(t,n),r=i.name.replace(/\[.*?\]$/,""),a=!!i.name.match(/\[.*?\]$/),o=al(e,i.type);s[r]={name:r,index:n,type:o,size:i.size,isArray:a,value:zh(o,i.size)}}return s}(r,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const s=Object.keys(e.attributeData);s.sort(((t,e)=>t>e?1:-1));for(let i=0;i<s.length;i++)e.attributeData[s[i]].location=i,t.bindAttribLocation(r,i,s[i]);t.linkProgram(r)}t.deleteShader(i),t.deleteShader(n);const o={};for(const h in e.uniformData){const s=e.uniformData[h];o[h]={location:t.getUniformLocation(r,h),value:zh(s.type,s.size)}}return new pc(r,o)}function mc(t,e,s,i,n){s.buffer.update(n)}const gc={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},yc={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function xc(t,e){if(!t.autoManage)return{size:0,syncFunc:mc};const s=function(t,e){const s=[];for(const i in t)e[i]&&s.push(e[i]);return s.sort(((t,e)=>t.index-e.index)),s}(t.uniforms,e),{uboElements:i,size:n}=function(t){const e=t.map((t=>({data:t,offset:0,dataLen:0,dirty:0})));let s=0,i=0,n=0;for(let r=0;r<e.length;r++){const t=e[r];if(s=yc[t.data.type],t.data.size>1&&(s=Math.max(s,16)*t.data.size),t.dataLen=s,i%s!=0&&i<16){const t=i%s%16;i+=t,n+=t}i+s>16?(n=16*Math.ceil(n/16),t.offset=n,n+=s,i=s):(t.offset=n,i+=s,n+=s)}return n=16*Math.ceil(n/16),{uboElements:e,size:n}}(s),r=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let a=0;a<i.length;a++){const e=i[a],s=t.uniforms[e.data.name],n=e.data.name;let o=!1;for(let t=0;t<Hh.length;t++){const i=Hh[t];if(i.codeUbo&&i.test(e.data,s)){r.push(`offset = ${e.offset/4};`,Hh[t].codeUbo(e.data.name,s)),o=!0;break}}if(!o)if(e.data.size>1){const t=il(e.data.type),s=Math.max(yc[e.data.type]/16,1),i=t/s,a=(4-i%4)%4;r.push(`\n                cv = ud.${n}.value;\n                v = uv.${n};\n                offset = ${e.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${e.data.size*s}; i++)\n                {\n                    for(var j = 0; j < ${i}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${a};\n                }\n\n                `)}else{const t=gc[e.data.type];r.push(`\n                cv = ud.${n}.value;\n                v = uv.${n};\n                offset = ${e.offset/4};\n                ${t};\n                `)}}return r.push("\n       renderer.buffer.update(buffer);\n    "),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",r.join("\n"))}}let vc=0;const _c={textureCount:0,uboCount:0};class bc{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=vc++}systemCheck(){if(!function(){if("boolean"==typeof hl)return hl;try{const t=new Function("param1","param2","param3","return param1[param2] === param3;");hl=!0===t({a:"b"},"a","b")}catch(Zf){hl=!1}return hl}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const s=t.program,i=s.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==s&&(this.program=s,this.gl.useProgram(i.program)),e||(_c.textureCount=0,_c.uboCount=0,this.syncUniformGroup(t.uniformGroup,_c)),i}setUniforms(t){const e=this.shader.program,s=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(s.uniformData,t,this.renderer)}syncUniformGroup(t,e){const s=this.getGlProgram();t.static&&t.dirtyId===s.uniformDirtyGroups[t.id]||(s.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,s,e))}syncUniforms(t,e,s){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,s)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function(t,e){var s;const i=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const n in t.uniforms){const r=e[n];if(!r){(null==(s=t.uniforms[n])?void 0:s.group)&&(t.uniforms[n].ubo?i.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');\n                    `):i.push(`\n                        renderer.shader.syncUniformGroup(uv.${n}, syncData);\n                    `));continue}const a=t.uniforms[n];let o=!1;for(let t=0;t<Hh.length;t++)if(Hh[t].test(r,a)){i.push(Hh[t].code(n,a)),o=!0;break}if(!o){const t=(1!==r.size||r.isArray?Kh:qh)[r.type].replace("location",`ud["${n}"].location`);i.push(`\n            cu = ud["${n}"];\n            cv = cu.value;\n            v = uv["${n}"];\n            ${t};`)}}return new Function("ud","uv","renderer","syncData",i.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const s=this.getGlProgram();if(!t.static||0!==t.dirtyId||!s.uniformGroups[t.id]){t.dirtyId=0;const i=s.uniformGroups[t.id]||this.createSyncBufferGroup(t,s,e);t.buffer.update(),i(s.uniformData,t.uniforms,this.renderer,_c,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,s.uniformBufferBindings[e])}createSyncBufferGroup(t,e,s){const{gl:i}=this.renderer;this.renderer.buffer.bind(t.buffer);const n=this.gl.getUniformBlockIndex(e.program,s);e.uniformBufferBindings[s]=this.shader.uniformBindCount,i.uniformBlockBinding(e.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const r=this.getSignature(t,this.shader.program.uniformData,"ubo");let a=this._uboCache[r];if(a||(a=this._uboCache[r]=xc(t,this.shader.program.uniformData)),t.autoManage){const e=new Float32Array(a.size/4);t.buffer.update(e)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,s){const i=t.uniforms,n=[`${s}-`];for(const r in i)n.push(r),e[r]&&n.push(e[r].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,s=t.program,i=fc(e,s);return s.glPrograms[this.renderer.CONTEXT_UID]=i,i}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}bc.extension={type:Ko.RendererSystem,name:"shader"},Jo.add(bc);class wc{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.2.4 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}wc.defaultOptions={hello:!1},wc.extension={type:[Ko.RendererSystem,Ko.CanvasRendererSystem],name:"startup"},Jo.add(wc);const Ec=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=cr.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new ih,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=function(t,e=[]){return e[cr.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[cr.ADD]=[t.ONE,t.ONE],e[cr.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[cr.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[cr.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[cr.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[cr.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[cr.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[cr.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[cr.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[cr.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[cr.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[cr.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[cr.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[cr.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[cr.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[cr.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[cr.NONE]=[0,0],e[cr.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[cr.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[cr.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[cr.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[cr.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[cr.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[cr.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[cr.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[cr.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[cr.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[cr.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[cr.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,s=0;for(;e;)1&e&&this.map[s].call(this,!!(t.data&1<<s)),e>>=1,s++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(Ec.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(Ec.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],s=this.gl;2===e.length?s.blendFunc(e[0],e[1]):s.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,s.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,s.blendEquationSeparate(s.FUNC_ADD,s.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const s=this.checks.indexOf(t);e&&-1===s?this.checks.push(t):e||-1===s||this.checks.splice(s,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};let Sc=Ec;Sc.extension={type:Ko.RendererSystem,name:"state"},Jo.add(Sc);class Tc extends x{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){var e;this.addRunners(...t.runners);const s=(null!=(e=t.priority)?e:[]).filter((e=>t.systems[e])),i=[...s,...Object.keys(t.systems).filter((t=>!s.includes(t)))];for(const n of i)this.addSystem(t.systems[n],n)}addRunners(...t){t.forEach((t=>{this.runners[t]=new ah(t)}))}addSystem(t,e){const s=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=s,this._systemsHash[e]=s;for(const i in this.runners)this.runners[i].add(s);return this}emitWithCustomOptions(t,e){const s=Object.keys(this._systemsHash);t.items.forEach((i=>{const n=s.find((t=>this._systemsHash[t]===i));i[t.name](e[n])}))}destroy(){Object.values(this.runners).forEach((t=>{t.destroy()})),this._systemsHash={}}}const Ac=class{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Ac.defaultMaxIdle,this.checkCountMax=Ac.defaultCheckCountMax,this.mode=Ac.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==br.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let s=!1;for(let i=0;i<e.length;i++){const n=e[i];!n.framebuffer&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[i]=null,s=!0)}if(s){let t=0;for(let s=0;s<e.length;s++)null!==e[s]&&(e[t++]=e[s]);e.length=t}}unload(t){const e=this.renderer.texture,s=t._texture;s&&!s.framebuffer&&e.destroyTexture(s);for(let i=t.children.length-1;i>=0;i--)this.unload(t.children[i])}destroy(){this.renderer=null}};let Cc=Ac;Cc.defaultMode=br.AUTO,Cc.defaultMaxIdle=3600,Cc.defaultCheckCountMax=600,Cc.extension={type:Ko.RendererSystem,name:"textureGC"},Jo.add(Cc);class Mc{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=fr.UNSIGNED_BYTE,this.internalFormat=dr.RGBA,this.samplerType=0}}class Ic{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new uh,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[fr.UNSIGNED_BYTE]:{[dr.RGBA]:t.RGBA8,[dr.RGB]:t.RGB8,[dr.RG]:t.RG8,[dr.RED]:t.R8,[dr.RGBA_INTEGER]:t.RGBA8UI,[dr.RGB_INTEGER]:t.RGB8UI,[dr.RG_INTEGER]:t.RG8UI,[dr.RED_INTEGER]:t.R8UI,[dr.ALPHA]:t.ALPHA,[dr.LUMINANCE]:t.LUMINANCE,[dr.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[fr.BYTE]:{[dr.RGBA]:t.RGBA8_SNORM,[dr.RGB]:t.RGB8_SNORM,[dr.RG]:t.RG8_SNORM,[dr.RED]:t.R8_SNORM,[dr.RGBA_INTEGER]:t.RGBA8I,[dr.RGB_INTEGER]:t.RGB8I,[dr.RG_INTEGER]:t.RG8I,[dr.RED_INTEGER]:t.R8I},[fr.UNSIGNED_SHORT]:{[dr.RGBA_INTEGER]:t.RGBA16UI,[dr.RGB_INTEGER]:t.RGB16UI,[dr.RG_INTEGER]:t.RG16UI,[dr.RED_INTEGER]:t.R16UI,[dr.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[fr.SHORT]:{[dr.RGBA_INTEGER]:t.RGBA16I,[dr.RGB_INTEGER]:t.RGB16I,[dr.RG_INTEGER]:t.RG16I,[dr.RED_INTEGER]:t.R16I},[fr.UNSIGNED_INT]:{[dr.RGBA_INTEGER]:t.RGBA32UI,[dr.RGB_INTEGER]:t.RGB32UI,[dr.RG_INTEGER]:t.RG32UI,[dr.RED_INTEGER]:t.R32UI,[dr.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[fr.INT]:{[dr.RGBA_INTEGER]:t.RGBA32I,[dr.RGB_INTEGER]:t.RGB32I,[dr.RG_INTEGER]:t.RG32I,[dr.RED_INTEGER]:t.R32I},[fr.FLOAT]:{[dr.RGBA]:t.RGBA32F,[dr.RGB]:t.RGB32F,[dr.RG]:t.RG32F,[dr.RED]:t.R32F,[dr.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[fr.HALF_FLOAT]:{[dr.RGBA]:t.RGBA16F,[dr.RGB]:t.RGB16F,[dr.RG]:t.RG16F,[dr.RED]:t.R16F},[fr.UNSIGNED_SHORT_5_6_5]:{[dr.RGB]:t.RGB565},[fr.UNSIGNED_SHORT_4_4_4_4]:{[dr.RGBA]:t.RGBA4},[fr.UNSIGNED_SHORT_5_5_5_1]:{[dr.RGBA]:t.RGB5_A1},[fr.UNSIGNED_INT_2_10_10_10_REV]:{[dr.RGBA]:t.RGB10_A2,[dr.RGBA_INTEGER]:t.RGB10_A2UI},[fr.UNSIGNED_INT_10F_11F_11F_REV]:{[dr.RGB]:t.R11F_G11F_B10F},[fr.UNSIGNED_INT_5_9_9_9_REV]:{[dr.RGB]:t.RGB9_E5},[fr.UNSIGNED_INT_24_8]:{[dr.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[fr.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[dr.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:{[fr.UNSIGNED_BYTE]:{[dr.RGBA]:t.RGBA,[dr.RGB]:t.RGB,[dr.ALPHA]:t.ALPHA,[dr.LUMINANCE]:t.LUMINANCE,[dr.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[fr.UNSIGNED_SHORT_5_6_5]:{[dr.RGB]:t.RGB},[fr.UNSIGNED_SHORT_4_4_4_4]:{[dr.RGBA]:t.RGBA},[fr.UNSIGNED_SHORT_5_5_5_1]:{[dr.RGBA]:t.RGBA}},e}(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let i=0;i<e;i++)this.boundTextures[i]=null;this.emptyTextures={};const s=new Mc(t.createTexture());t.bindTexture(t.TEXTURE_2D,s.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=s,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Mc(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let i=0;i<6;i++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let i=0;i<this.boundTextures.length;i++)this.bind(null,i)}bind(t,e=0){const{gl:s}=this;if((null==(t=null==t?void 0:t.castToBaseTexture())?void 0:t.valid)&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const i=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,s.activeTexture(s.TEXTURE0+e)),s.bindTexture(t.target,i.texture)),i.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,s.activeTexture(s.TEXTURE0+e)),this.updateTexture(t)):i.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,s.activeTexture(s.TEXTURE0+e)),s.bindTexture(s.TEXTURE_2D,this.emptyTextures[s.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:s}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let t=0;t<s.length;t++)s[t]===this.unknownTexture&&this.bind(null,t)}for(let i=0;i<s.length;i++)s[i]===t&&(this.currentLocation!==i&&(e.activeTexture(e.TEXTURE0+i),this.currentLocation=i),e.bindTexture(t.target,this.emptyTextures[t.target].texture),s[i]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:s,CONTEXT_UID:i}=this;if(s)for(let n=t-1;n>=0;--n){const t=e[n];if(t){t._glTextures[i].samplerType!==mr.FLOAT&&this.renderer.texture.unbind(t)}}}initTexture(t){const e=new Mc(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var s,i;e.internalFormat=null!=(i=null==(s=this.internalFormats[t.type])?void 0:s[t.format])?i:t.format,2===this.webGLVersion&&t.type===fr.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var e;const s=t._glTextures[this.CONTEXT_UID];if(!s)return;const i=this.renderer;if(this.initTextureType(t,s),null==(e=t.resource)?void 0:e.upload(i,t,s))s.samplerType!==mr.FLOAT&&(this.hasIntegerTextures=!0);else{const e=t.realWidth,n=t.realHeight,r=i.gl;(s.width!==e||s.height!==n||s.dirtyId<0)&&(s.width=e,s.height=n,r.texImage2D(t.target,0,s.internalFormat,e,n,0,t.format,s.type,null))}t.dirtyStyleId!==s.dirtyStyleId&&this.updateTextureStyle(t),s.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:s}=this;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),s.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const e=this.managedTextures.indexOf(t);-1!==e&&Oo(this.managedTextures,e,1)}}updateTextureStyle(t){var e;const s=t._glTextures[this.CONTEXT_UID];s&&(t.mipmap!==xr.POW2&&2===this.webGLVersion||t.isPowerOfTwo?s.mipmap=t.mipmap>=1:s.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?s.wrapMode=t.wrapMode:s.wrapMode=yr.CLAMP,(null==(e=t.resource)?void 0:e.style(this.renderer,t,s))||this.setStyle(t,s),s.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const s=this.gl;if(e.mipmap&&t.mipmap!==xr.ON_MANUAL&&s.generateMipmap(t.target),s.texParameteri(t.target,s.TEXTURE_WRAP_S,e.wrapMode),s.texParameteri(t.target,s.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){s.texParameteri(t.target,s.TEXTURE_MIN_FILTER,t.scaleMode===gr.LINEAR?s.LINEAR_MIPMAP_LINEAR:s.NEAREST_MIPMAP_NEAREST);const e=this.renderer.context.extensions.anisotropicFiltering;if(e&&t.anisotropicLevel>0&&t.scaleMode===gr.LINEAR){const i=Math.min(t.anisotropicLevel,s.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT));s.texParameterf(t.target,e.TEXTURE_MAX_ANISOTROPY_EXT,i)}}else s.texParameteri(t.target,s.TEXTURE_MIN_FILTER,t.scaleMode===gr.LINEAR?s.LINEAR:s.NEAREST);s.texParameteri(t.target,s.TEXTURE_MAG_FILTER,t.scaleMode===gr.LINEAR?s.LINEAR:s.NEAREST)}destroy(){this.renderer=null}}Ic.extension={type:Ko.RendererSystem,name:"texture"},Jo.add(Ic);class Pc{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:s}=this,i=t._glTransformFeedbacks[s]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,i)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:s,renderer:i}=this;e&&i.shader.bind(e),s.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:s,CONTEXT_UID:i}=this,n=e.createTransformFeedback();t._glTransformFeedbacks[i]=n,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n);for(let r=0;r<t.buffers.length;r++){const n=t.buffers[r];n&&(s.buffer.update(n),n._glBuffers[i].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,r,n._glBuffers[i].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),n}disposeTransformFeedback(t,e){const s=t._glTransformFeedbacks[this.CONTEXT_UID],i=this.gl;t.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let r=0;r<t.buffers.length;r++){const s=t.buffers[r];if(!s)continue;const i=s._glBuffers[this.CONTEXT_UID];i&&(i.refCount--,0!==i.refCount||e||n.dispose(s,e))}s&&(e||i.deleteTransformFeedback(s),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Pc.extension={type:Ko.RendererSystem,name:"transformFeedback"},Jo.add(Pc);class Rc{constructor(t){this.renderer=t}init(t){this.screen=new Mh(0,0,t.width,t.height),this.element=t.view||Ar.ADAPTER.createCanvas(),this.resolution=t.resolution||Ar.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const s=this.element.width/this.resolution,i=this.element.height/this.resolution;this.screen.width=s,this.screen.height=i,this.autoDensity&&(this.element.style.width=`${s}px`,this.element.style.height=`${i}px`),this.renderer.emit("resize",s,i),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&(null==(e=this.element.parentNode)||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}Rc.defaultOptions={width:800,height:600,resolution:Ar.RESOLUTION,autoDensity:!1},Rc.extension={type:[Ko.RendererSystem,Ko.CanvasRendererSystem],name:"_view"},Jo.add(Rc),Ar.PREFER_ENV=or.WEBGL2,Ar.STRICT_TEXTURE_CACHE=!1,Ar.RENDER_OPTIONS=l(l(l(l({},Al.defaultOptions),El.defaultOptions),Rc.defaultOptions),wc.defaultOptions),Object.defineProperties(Ar,{WRAP_MODE:{get:()=>uh.defaultOptions.wrapMode,set(t){za("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),uh.defaultOptions.wrapMode=t}},SCALE_MODE:{get:()=>uh.defaultOptions.scaleMode,set(t){za("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),uh.defaultOptions.scaleMode=t}},MIPMAP_TEXTURES:{get:()=>uh.defaultOptions.mipmap,set(t){za("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),uh.defaultOptions.mipmap=t}},ANISOTROPIC_LEVEL:{get:()=>uh.defaultOptions.anisotropicLevel,set(t){za("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),uh.defaultOptions.anisotropicLevel=t}},FILTER_RESOLUTION:{get:()=>(za("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),wl.defaultResolution),set(t){wl.defaultResolution=t}},FILTER_MULTISAMPLE:{get:()=>(za("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),wl.defaultMultisample),set(t){wl.defaultMultisample=t}},SPRITE_MAX_TEXTURES:{get:()=>_l.defaultMaxTextures,set(t){za("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),_l.defaultMaxTextures=t}},SPRITE_BATCH_SIZE:{get:()=>_l.defaultBatchSize,set(t){za("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),_l.defaultBatchSize=t}},CAN_UPLOAD_SAME_BUFFER:{get:()=>_l.canUploadSameBuffer,set(t){za("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),_l.canUploadSameBuffer=t}},GC_MODE:{get:()=>Cc.defaultMode,set(t){za("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Cc.defaultMode=t}},GC_MAX_IDLE:{get:()=>Cc.defaultMaxIdle,set(t){za("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Cc.defaultMaxIdle=t}},GC_MAX_CHECK_COUNT:{get:()=>Cc.defaultCheckCountMax,set(t){za("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Cc.defaultCheckCountMax=t}},PRECISION_VERTEX:{get:()=>dl.defaultVertexPrecision,set(t){za("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),dl.defaultVertexPrecision=t}},PRECISION_FRAGMENT:{get:()=>dl.defaultFragmentPrecision,set(t){za("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),dl.defaultFragmentPrecision=t}}});var kc=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(kc||{});class Dc{constructor(t,e=null,s=0,i=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=s,this.once=i}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Fc=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Dc(null,null,1/0),this.deltaMS=1/Fc.targetFPMS,this.elapsedMS=1/Fc.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,s=kc.NORMAL){return this._addListener(new Dc(t,e,s))}addOnce(t,e,s=kc.NORMAL){return this._addListener(new Dc(t,e,s,!0))}_addListener(t){let e=this._head.next,s=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(s);break}s=e,e=e.next}t.previous||t.connect(s)}else t.connect(s);return this._startIfPossible(),this}remove(t,e){let s=this._head.next;for(;s;)s=s.match(t,e)?s.destroy():s.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const e=t-this._lastFrame|0;if(e<this._minElapsedMS)return;this._lastFrame=t-e%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Fc.targetFPMS;const s=this._head;let i=s.next;for(;i;)i=i.emit(this.deltaTime);s.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),s=Math.min(Math.max(0,e)/1e3,Fc.targetFPMS);this._maxElapsedMS=1/s}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(0===t)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Fc._shared){const t=Fc._shared=new Fc;t.autoStart=!0,t._protected=!0}return Fc._shared}static get system(){if(!Fc._system){const t=Fc._system=new Fc;t.autoStart=!0,t._protected=!0}return Fc._system}};let Oc=Fc;Oc.targetFPMS=.06,Object.defineProperties(Ar,{TARGET_FPMS:{get:()=>Oc.targetFPMS,set(t){za("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Oc.targetFPMS=t}}});class Nc{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,kc.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Oc.shared:new Oc,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Nc.extension=Ko.Application,Jo.add(Nc);const Bc=[];Jo.handleByList(Ko.Renderer,Bc);const Lc="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class Vc{constructor(t){this.renderer=t}contextChange(t){let e;if(1===this.renderer.context.webGLVersion){const s=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,s)}else{const s=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,s)}e>=Sr.HIGH?this.multisample=Sr.HIGH:e>=Sr.MEDIUM?this.multisample=Sr.MEDIUM:e>=Sr.LOW?this.multisample=Sr.LOW:this.multisample=Sr.NONE}destroy(){}}Vc.extension={type:Ko.RendererSystem,name:"_multisample"},Jo.add(Vc);class $c{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Uc{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:s}=this,i=t._glBuffers[s]||this.createGLBuffer(t);e.bindBuffer(t.type,i.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:s,CONTEXT_UID:i}=this;if(this.boundBufferBases[e]!==t){const n=t._glBuffers[i]||this.createGLBuffer(t);this.boundBufferBases[e]=t,s.bindBufferBase(s.UNIFORM_BUFFER,e,n.buffer)}}bindBufferRange(t,e,s){const{gl:i,CONTEXT_UID:n}=this;s=s||0;const r=t._glBuffers[n]||this.createGLBuffer(t);i.bindBufferRange(i.UNIFORM_BUFFER,e||0,r.buffer,256*s,256)}update(t){const{gl:e,CONTEXT_UID:s}=this,i=t._glBuffers[s]||this.createGLBuffer(t);if(t._updateID!==i.updateID)if(i.updateID=t._updateID,e.bindBuffer(t.type,i.buffer),i.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const s=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;i.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,s)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const s=t._glBuffers[this.CONTEXT_UID],i=this.gl;t.disposeRunner.remove(this),s&&(e||i.deleteBuffer(s.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let s=0;s<e.length;s++)this.dispose(this.managedBuffers[e[s]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:s}=this;return t._glBuffers[e]=new $c(s.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Uc.extension={type:Ko.RendererSystem,name:"buffer"},Jo.add(Uc);class Xc{constructor(t){this.renderer=t}render(t,e){const s=this.renderer;let i,n,r,a;if(e&&(i=e.renderTexture,n=e.clear,r=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!i,s.runners.prerender.emit(),s.emit("prerender"),s.projection.transform=r,!s.context.isLost){if(i||(this.lastObjectRendered=t),!a){const e=t.enableTempParent();t.updateTransform(),t.disableTempParent(e)}s.renderTexture.bind(i),s.batch.currentRenderer.start(),(null!=n?n:s.background.clearBeforeRender)&&s.renderTexture.clear(),t.render(s),s.batch.currentRenderer.flush(),i&&(e.blit&&s.framebuffer.blit(),i.baseTexture.update()),s.runners.postrender.emit(),s.projection.transform=null,s.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Xc.extension={type:Ko.RendererSystem,name:"objectRenderer"},Jo.add(Xc);const Yc=class extends Tc{constructor(t){super(),this.type=hr.WEBGL,t=Object.assign({},Ar.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new fl({projectionMatrix:new Dh},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Yc.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(za("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&"notMultiplied"!==t.useContextAlpha,t.backgroundAlpha=!1===t.useContextAlpha?1:t.backgroundAlpha),this._plugin.rendererPlugins=Yc.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return!(null==t?void 0:t.forceCanvas)&&(void 0===Ha&&(Ha=function(){var t;const e={stencil:!0,failIfMajorPerformanceCaveat:Ar.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Ar.ADAPTER.getWebGLRenderingContext())return!1;const s=Ar.ADAPTER.createCanvas();let i=s.getContext("webgl",e)||s.getContext("experimental-webgl",e);const n=!!(null==(t=null==i?void 0:i.getContextAttributes())?void 0:t.stencil);if(i){const t=i.getExtension("WEBGL_lose_context");t&&t.loseContext()}return i=null,n}catch(Zf){return!1}}()),Ha)}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return za("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return za("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return za("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return za("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){za("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return za("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){za("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return za("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};let Wc=Yc;Wc.extension={type:Ko.Renderer,priority:1},Wc.__plugins={},Wc.__systems={},Jo.handleByMap(Ko.RendererPlugin,Wc.__plugins),Jo.handleByMap(Ko.RendererSystem,Wc.__systems),Jo.add(Wc);class jc extends oh{constructor(t,e){const{width:s,height:i}=e||{};super(s,i),this.items=[],this.itemDirtyIds=[];for(let n=0;n<t;n++){const t=new uh;this.items.push(t),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let s=0;s<this.length;s++)t[s]&&(t[s].castToBaseTexture?this.addBaseTextureAt(t[s].castToBaseTexture(),s):t[s]instanceof oh?this.addResourceAt(t[s],s):this.addResourceAt(rh(t[s],e),s))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map((t=>t.resource)).filter((t=>t)).map((t=>t.load()));return this._load=Promise.all(t).then((()=>{const{realWidth:t,realHeight:e}=this.items[0];return this.resize(t,e),Promise.resolve(this)})),this._load}}const Gc=class extends jc{constructor(t,e){const{width:s,height:i,autoLoad:n,linkBaseTexture:r}=e||{};if(t&&t.length!==Gc.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:s,height:i});for(let a=0;a<Gc.SIDES;a++)this.items[a].target=pr.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=!1!==r,t&&this.initFromArray(t,e),!1!==n&&this.load()}bind(t){super.bind(t),t.target=pr.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,s){if(void 0===s&&(s=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=pr.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,s){const i=this.itemDirtyIds;for(let n=0;n<Gc.SIDES;n++){const r=this.items[n];(i[n]<r.dirtyId||s.dirtyId<e.dirtyId)&&(r.valid&&r.resource?(r.resource.upload(t,r,s),i[n]=r.dirtyId):i[n]<-1&&(t.gl.texImage2D(r.target,0,s.internalFormat,e.realWidth,e.realHeight,0,e.format,s.type,null),i[n]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===Gc.SIDES}};let zc=Gc;zc.SIDES=6;class Hc extends Pl{constructor(t,e){var s;let i,n;e=e||{},"string"==typeof t?(i=Hc.EMPTY,n=t):(i=t,n=null),super(i),this.url=n,this.crossOrigin=null==(s=e.crossOrigin)||s,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise(((t,e)=>p(this,null,(function*(){if(null!==this.url)try{const e=yield Ar.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const s=yield e.blob();if(this.destroyed)return;const i=yield createImageBitmap(s,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===vr.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=i,this.update(),t(this)}catch(Zf){if(this.destroyed)return;e(Zf),this.onError.emit(Zf)}else t(this)}))))),this._load}upload(t,e,s){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),super.upload(t,e,s)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&"undefined"!=typeof ImageBitmap&&("string"==typeof t||t instanceof ImageBitmap)}static get EMPTY(){var t;return Hc._EMPTY=null!=(t=Hc._EMPTY)?t:Ar.ADAPTER.createCanvas(0,0),Hc._EMPTY}}const qc=class extends Pl{constructor(t,e){e=e||{},super(Ar.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((t=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),t(this)},qc.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}))),this._load}_loadSvg(){const t=new Image;Pl.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,s=t.height;if(!e||!s)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let i=e*this.scale,n=s*this.scale;(this._overrideWidth||this._overrideHeight)&&(i=this._overrideWidth||this._overrideHeight/s*e,n=this._overrideHeight||this._overrideWidth/e*s),i=Math.round(i),n=Math.round(n);const r=this.source;r.width=i,r.height=n,r._pixiId=`canvas_${Lo()}`,r.getContext("2d").drawImage(t,0,0,e,s,0,0,i,n),this._resolve(),this._resolve=null}}static getSize(t){const e=qc.SVG_SIZE.exec(t),s={};return e&&(s[e[1]]=Math.round(parseFloat(e[3])),s[e[5]]=Math.round(parseFloat(e[7]))),s}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return"svg"===e||"string"==typeof t&&t.startsWith("data:image/svg+xml")||"string"==typeof t&&qc.SVG_XML.test(t)}};let Kc=qc;Kc.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Kc.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const Zc=class extends Pl{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const s=document.createElement("video");s.setAttribute("preload","auto"),s.setAttribute("webkit-playsinline",""),s.setAttribute("playsinline",""),"string"==typeof t&&(t=[t]);const i=t[0].src||t[0];Pl.crossOrigin(s,i,e.crossorigin);for(let e=0;e<t.length;++e){const i=document.createElement("source");let{src:n,mime:r}=t[e];n=n||t[e];const a=n.split("?").shift().toLowerCase(),o=a.slice(a.lastIndexOf(".")+1);r=r||Zc.MIME_TYPES[o]||`video/${o}`,i.src=n,i.type=r,s.appendChild(i)}t=s}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==e.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==e.autoLoad&&this.load()}update(t=0){if(!this.destroyed){const t=Oc.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e=>{this.valid?e(this):(this._resolve=e,t.load())})),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Oc.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Oc.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._isConnectedToTicker&&(Oc.shared.remove(this.update,this),this._isConnectedToTicker=!1);const t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Oc.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Oc.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t)}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Zc.TYPES.includes(e)}};let Qc=Zc;Qc.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Qc.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},nh.push(Hc,Rl,class extends Pl{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return!!(e&&t instanceof e)||globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}},Qc,Kc,hh,zc,class extends jc{constructor(t,e){const{width:s,height:i}=e||{};let n,r;Array.isArray(t)?(n=t,r=t.length):r=t,super(r,{width:s,height:i}),n&&this.initFromArray(n,e)}addBaseTextureAt(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this}bind(t){super.bind(t),t.target=pr.TEXTURE_2D_ARRAY}upload(t,e,s){const{length:i,itemDirtyIds:n,items:r}=this,{gl:a}=t;s.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,s.internalFormat,this._width,this._height,i,0,e.format,s.type,null);for(let o=0;o<i;o++){const t=r[o];n[o]<t.dirtyId&&(n[o]=t.dirtyId,t.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,o,t.resource.width,t.resource.height,1,e.format,s.type,t.resource.source))}return!0}});class Jc{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Mh.EMPTY:((t=t||new Mh(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:s,b:i,c:n,d:r,tx:a,ty:o}=t,h=s*e.x+n*e.y+a,l=i*e.x+r*e.y+o;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,l),this.maxY=Math.max(this.maxY,l)}addQuad(t){let e=this.minX,s=this.minY,i=this.maxX,n=this.maxY,r=t[0],a=t[1];e=r<e?r:e,s=a<s?a:s,i=r>i?r:i,n=a>n?a:n,r=t[2],a=t[3],e=r<e?r:e,s=a<s?a:s,i=r>i?r:i,n=a>n?a:n,r=t[4],a=t[5],e=r<e?r:e,s=a<s?a:s,i=r>i?r:i,n=a>n?a:n,r=t[6],a=t[7],e=r<e?r:e,s=a<s?a:s,i=r>i?r:i,n=a>n?a:n,this.minX=e,this.minY=s,this.maxX=i,this.maxY=n}addFrame(t,e,s,i,n){this.addFrameMatrix(t.worldTransform,e,s,i,n)}addFrameMatrix(t,e,s,i,n){const r=t.a,a=t.b,o=t.c,h=t.d,l=t.tx,c=t.ty;let u=this.minX,d=this.minY,p=this.maxX,f=this.maxY,m=r*e+o*s+l,g=a*e+h*s+c;u=m<u?m:u,d=g<d?g:d,p=m>p?m:p,f=g>f?g:f,m=r*i+o*s+l,g=a*i+h*s+c,u=m<u?m:u,d=g<d?g:d,p=m>p?m:p,f=g>f?g:f,m=r*e+o*n+l,g=a*e+h*n+c,u=m<u?m:u,d=g<d?g:d,p=m>p?m:p,f=g>f?g:f,m=r*i+o*n+l,g=a*i+h*n+c,u=m<u?m:u,d=g<d?g:d,p=m>p?m:p,f=g>f?g:f,this.minX=u,this.minY=d,this.maxX=p,this.maxY=f}addVertexData(t,e,s){let i=this.minX,n=this.minY,r=this.maxX,a=this.maxY;for(let o=e;o<s;o+=2){const e=t[o],s=t[o+1];i=e<i?e:i,n=s<n?s:n,r=e>r?e:r,a=s>a?s:a}this.minX=i,this.minY=n,this.maxX=r,this.maxY=a}addVertices(t,e,s,i){this.addVerticesMatrix(t.worldTransform,e,s,i)}addVerticesMatrix(t,e,s,i,n=0,r=n){const a=t.a,o=t.b,h=t.c,l=t.d,c=t.tx,u=t.ty;let d=this.minX,p=this.minY,f=this.maxX,m=this.maxY;for(let g=s;g<i;g+=2){const t=e[g],s=e[g+1],i=a*t+h*s+c,y=l*s+o*t+u;d=Math.min(d,i-n),f=Math.max(f,i+n),p=Math.min(p,y-r),m=Math.max(m,y+r)}this.minX=d,this.minY=p,this.maxX=f,this.maxY=m}addBounds(t){const e=this.minX,s=this.minY,i=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<s?t.minY:s,this.maxX=t.maxX>i?t.maxX:i,this.maxY=t.maxY>n?t.maxY:n}addBoundsMask(t,e){const s=t.minX>e.minX?t.minX:e.minX,i=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,r=t.maxY<e.maxY?t.maxY:e.maxY;if(s<=n&&i<=r){const t=this.minX,e=this.minY,a=this.maxX,o=this.maxY;this.minX=s<t?s:t,this.minY=i<e?i:e,this.maxX=n>a?n:a,this.maxY=r>o?r:o}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const s=t.minX>e.x?t.minX:e.x,i=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,r=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(s<=n&&i<=r){const t=this.minX,e=this.minY,a=this.maxX,o=this.maxY;this.minX=s<t?s:t,this.minY=i<e?i:e,this.maxX=n>a?n:a,this.maxY=r>o?r:o}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,s,i,n,r){t-=n,e-=r,s+=n,i+=r,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>s?this.maxX:s,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>i?this.maxY:i}}class tu extends x{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Wh,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Jc,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let s=0;s<e.length;++s){const i=e[s];Object.defineProperty(tu.prototype,i,Object.getOwnPropertyDescriptor(t,i))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Mh),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Mh),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Jc);const e=this.transform,s=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const i=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const r=this.getBounds(!1,t);return this.parent=s,this.transform=e,this._bounds=i,this._bounds.updateID+=this._boundsID-n,r}toGlobal(t,e,s=!1){return s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,s,i){return e&&(t=e.toGlobal(t,s,i)),i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,s)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;null==(t=this.parent)||t.removeChild(this)}setTransform(t=0,e=0,s=1,i=1,n=0,r=0,a=0,o=0,h=0){return this.position.x=t,this.position.y=e,this.scale.x=s||1,this.scale.y=i||1,this.rotation=n,this.skew.x=r,this.skew.y=a,this.pivot.x=o,this.pivot.y=h,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new eu),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Eh}set angle(t){this.transform.rotation=t*Sh}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,0===t._maskRefCount&&(t.renderable=!0,t.isMask=!1))}if(this._mask=t,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(0===t._maskRefCount&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class eu extends tu{constructor(){super(...arguments),this.sortDirty=null}}tu.prototype.displayObjectUpdateTransform=tu.prototype.updateTransform;const su=new Dh;function iu(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}const nu=class extends tu{constructor(){super(),this.children=[],this.sortableChildren=nu.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const s=this.getChildIndex(t),i=this.getChildIndex(e);this.children[s]=e,this.children[i]=t,this.onChildrenChange(s<i?s:i)}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const s=this.getChildIndex(t);Oo(this.children,s,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],s=this.children.indexOf(e);if(-1===s)return null;e.parent=null,e.transform._parentID=-1,Oo(this.children,s,1),this._boundsID++,this.onChildrenChange(s),e.emit("removed",this),this.emit("childRemoved",e,this,s)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Oo(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const s=t,i=e-s;let n;if(i>0&&i<=e){n=this.children.splice(s,i);for(let t=0;t<n.length;++t)n[t].parent=null,n[t].transform&&(n[t].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let t=0;t<n.length;++t)n[t].emit("removed",this),this.emit("childRemoved",n[t],this,t);return n}if(0===i&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,s=this.children.length;e<s;++e){const s=this.children[e];s._lastSortedIndex=e,t||0===s.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(iu),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){const t=e._mask.isMaskData?e._mask.maskObject:e._mask;t?(t.calculateBounds(),this._bounds.addBoundsMask(e._bounds,t._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const s=super.getLocalBounds(t);if(!e)for(let i=0,n=this.children.length;i<n;++i){const t=this.children[i];t.visible&&t.updateTransform()}return s}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let s,i;this.cullArea?(s=this.cullArea,i=this.worldTransform):this._render!==nu.prototype._render&&(s=this.getBounds(!0));const n=t.projection.transform;if(n&&(i?(i=su.copyFrom(i),i.prepend(n)):i=n),s&&e.intersects(s,i))this._render(t);else if(this.cullArea)return;for(let r=0,a=this.children.length;r<a;++r){const e=this.children[r],s=e.cullable;e.cullable=s||!this.cullArea,e.render(t),e.cullable=s}}render(t){var e;if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||(null==(e=this.filters)?void 0:e.length))this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,s=this.children.length;e<s;++e)this.children[e].render(t)}}renderAdvanced(t){var e,s,i;const n=this.filters,r=this._mask;if(n){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let t=0;t<n.length;t++)n[t].enabled&&this._enabledFilters.push(n[t])}const a=n&&(null==(e=this._enabledFilters)?void 0:e.length)||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==Er.NONE));if(a&&t.batch.flush(),n&&(null==(s=this._enabledFilters)?void 0:s.length)&&t.filter.push(this,this._enabledFilters),r&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,s=this.children.length;e<s;++e)this.children[e].render(t)}a&&t.batch.flush(),r&&t.mask.pop(this),n&&(null==(i=this._enabledFilters)?void 0:i.length)&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e="boolean"==typeof t?t:null==t?void 0:t.children,s=this.removeChildren(0,this.children.length);if(e)for(let i=0;i<s.length;++i)s[i].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}};let ru=nu;ru.defaultSortableChildren=!1,ru.prototype.containerUpdateTransform=ru.prototype.updateTransform,Object.defineProperties(Ar,{SORTABLE_CHILDREN:{get:()=>ru.defaultSortableChildren,set(t){za("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),ru.defaultSortableChildren=t}}});const au=new Ah,ou=new Uint16Array([0,1,2,0,2,3]);class hu extends ru{constructor(t){super(),this._anchor=new Xh(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Ao(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=cr.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Ol.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=ou,this.pluginName="batch",this.isSprite=!0,this._roundPixels=Ar.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=No(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=No(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,s=e.a,i=e.b,n=e.c,r=e.d,a=e.tx,o=e.ty,h=this.vertexData,l=t.trim,c=t.orig,u=this._anchor;let d=0,p=0,f=0,m=0;if(l?(p=l.x-u._x*c.width,d=p+l.width,m=l.y-u._y*c.height,f=m+l.height):(p=-u._x*c.width,d=p+c.width,m=-u._y*c.height,f=m+c.height),h[0]=s*p+n*m+a,h[1]=r*m+i*p+o,h[2]=s*d+n*m+a,h[3]=r*m+i*d+o,h[4]=s*d+n*f+a,h[5]=r*f+i*d+o,h[6]=s*p+n*f+a,h[7]=r*f+i*p+o,this._roundPixels){const t=Ar.RESOLUTION;for(let e=0;e<h.length;++e)h[e]=Math.round(h[e]*t)/t}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,s=t.orig,i=this._anchor,n=this.transform.worldTransform,r=n.a,a=n.b,o=n.c,h=n.d,l=n.tx,c=n.ty,u=-i._x*s.width,d=u+s.width,p=-i._y*s.height,f=p+s.height;e[0]=r*u+o*p+l,e[1]=h*p+a*u+c,e[2]=r*d+o*p+l,e[3]=h*p+a*d+c,e[4]=r*d+o*f+l,e[5]=h*f+a*d+c,e[6]=r*u+o*f+l,e[7]=h*f+a*u+c}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return 0===this.children.length?(this._localBounds||(this._localBounds=new Jc),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Mh),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,au);const e=this._texture.orig.width,s=this._texture.orig.height,i=-e*this.anchor.x;let n=0;return au.x>=i&&au.x<i+e&&(n=-s*this.anchor.y,au.y>=n&&au.y<n+s)}destroy(t){super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null;if("boolean"==typeof t?t:null==t?void 0:t.texture){const e="boolean"==typeof t?t:null==t?void 0:t.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const s=t instanceof Ol?t:Ol.from(t,e);return new hu(s)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=No(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=No(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Ol.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const lu=new Dh;tu.prototype._cacheAsBitmap=!1,tu.prototype._cacheData=null,tu.prototype._cacheAsBitmapResolution=null,tu.prototype._cacheAsBitmapMultisample=null;class cu{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(tu.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(t){if(this._cacheAsBitmap===t)return;let e;this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new cu),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}),tu.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},tu.prototype._initCachedDisplayObject=function(t){var e,s,i;if(null==(e=this._cacheData)?void 0:e.sprite)return;const n=this.alpha;this.alpha=1,t.batch.flush();const r=this.getLocalBounds(null,!0).clone();if(null==(s=this.filters)?void 0:s.length){const t=this.filters[0].padding;r.pad(t)}r.ceil(Ar.RESOLUTION);const a=t.renderTexture.current,o=t.renderTexture.sourceFrame.clone(),h=t.renderTexture.destinationFrame.clone(),l=t.projection.transform,c=Nl.create({width:r.width,height:r.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:null!=(i=this.cacheAsBitmapMultisample)?i:t.multisample}),u=`cacheAsBitmap_${Lo()}`;this._cacheData.textureCacheId=u,uh.addToCache(c.baseTexture,u),Ol.addToCache(c,u);const d=this.transform.localTransform.copyTo(lu).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:c,clear:!0,transform:d,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=l,t.renderTexture.bind(a,o,h),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=n;const p=new hu(c);p.transform.worldTransform=this.transform.worldTransform,p.anchor.x=-r.x/r.width,p.anchor.y=-r.y/r.height,p.alpha=n,p._bounds=this._bounds,this._cacheData.sprite=p,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=p.containsPoint.bind(p)},tu.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},tu.prototype._initCachedDisplayObjectCanvas=function(t){var e;if(null==(e=this._cacheData)?void 0:e.sprite)return;const s=this.getLocalBounds(null,!0),i=this.alpha;this.alpha=1;const n=t.canvasContext.activeContext,r=t._projTransform;s.ceil(Ar.RESOLUTION);const a=Nl.create({width:s.width,height:s.height}),o=`cacheAsBitmap_${Lo()}`;this._cacheData.textureCacheId=o,uh.addToCache(a.baseTexture,o),Ol.addToCache(a,o);const h=lu;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=s.x,h.ty-=s.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:a,clear:!0,transform:h,skipUpdateTransform:!1}),t.canvasContext.activeContext=n,t._projTransform=r,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const l=new hu(a);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-s.x/s.width,l.anchor.y=-s.y/s.height,l.alpha=i,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)},tu.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},tu.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},tu.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,uh.removeFromCache(this._cacheData.textureCacheId),Ol.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},tu.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},tu.prototype.name=null,ru.prototype.getChildByName=function(t,e){for(let s=0,i=this.children.length;s<i;s++)if(this.children[s].name===t)return this.children[s];if(e)for(let s=0,i=this.children.length;s<i;s++){const e=this.children[s];if(!e.getChildByName)continue;const i=e.getChildByName(t,!0);if(i)return i}return null},tu.prototype.getGlobalPosition=function(t=new Ah,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};const uu={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},du=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");const pu="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }";class fu extends wl{constructor(t,e=8,s=4,i=wl.defaultResolution,n=5){const r=function(t,e){const s=Math.ceil(t/2);let i,n=pu,r="";i=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let a=0;a<t;a++){let t=i.replace("%index%",a.toString());t=t.replace("%sampleIndex%",a-(s-1)+".0"),r+=t,r+="\n"}return n=n.replace("%blur%",r),n=n.replace("%size%",t.toString()),n}(n,t),a=function(t){const e=uu[t],s=e.length;let i,n=du,r="";for(let a=0;a<t;a++){let n="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",a.toString());i=a,a>=s&&(i=t-a-1),n=n.replace("%value%",e[i].toString()),r+=n,r+="\n"}return n=n.replace("%blur%",r),n=n.replace("%size%",t.toString()),n}(n);super(r,a),this.horizontal=t,this.resolution=i,this._quality=0,this.quality=s,this.blur=e}apply(t,e,s,i){if(s?this.horizontal?this.uniforms.strength=1/s.width*(s.width/e.width):this.uniforms.strength=1/s.height*(s.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,s,i);else{const n=t.getFilterTexture(),r=t.renderer;let a=e,o=n;this.state.blend=!1,t.applyFilter(this,a,o,_r.CLEAR);for(let e=1;e<this.passes-1;e++){t.bindAndClear(a,_r.BLIT),this.uniforms.uSampler=o;const e=o;o=a,a=e,r.shader.bind(this),r.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,o,s,i),t.returnFilterTexture(n)}}get blur(){return this.strength}set blur(t){this.padding=1+2*Math.abs(t),this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class mu extends wl{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Lc,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",t),this.alpha=1}_loadMatrix(t,e=!1){let s=t;e&&(this._multiply(s,this.uniforms.m,t),s=this._colorMatrix(s)),this.uniforms.m=s}_multiply(t,e,s){return t[0]=e[0]*s[0]+e[1]*s[5]+e[2]*s[10]+e[3]*s[15],t[1]=e[0]*s[1]+e[1]*s[6]+e[2]*s[11]+e[3]*s[16],t[2]=e[0]*s[2]+e[1]*s[7]+e[2]*s[12]+e[3]*s[17],t[3]=e[0]*s[3]+e[1]*s[8]+e[2]*s[13]+e[3]*s[18],t[4]=e[0]*s[4]+e[1]*s[9]+e[2]*s[14]+e[3]*s[19]+e[4],t[5]=e[5]*s[0]+e[6]*s[5]+e[7]*s[10]+e[8]*s[15],t[6]=e[5]*s[1]+e[6]*s[6]+e[7]*s[11]+e[8]*s[16],t[7]=e[5]*s[2]+e[6]*s[7]+e[7]*s[12]+e[8]*s[17],t[8]=e[5]*s[3]+e[6]*s[8]+e[7]*s[13]+e[8]*s[18],t[9]=e[5]*s[4]+e[6]*s[9]+e[7]*s[14]+e[8]*s[19]+e[9],t[10]=e[10]*s[0]+e[11]*s[5]+e[12]*s[10]+e[13]*s[15],t[11]=e[10]*s[1]+e[11]*s[6]+e[12]*s[11]+e[13]*s[16],t[12]=e[10]*s[2]+e[11]*s[7]+e[12]*s[12]+e[13]*s[17],t[13]=e[10]*s[3]+e[11]*s[8]+e[12]*s[13]+e[13]*s[18],t[14]=e[10]*s[4]+e[11]*s[9]+e[12]*s[14]+e[13]*s[19]+e[14],t[15]=e[15]*s[0]+e[16]*s[5]+e[17]*s[10]+e[18]*s[15],t[16]=e[15]*s[1]+e[16]*s[6]+e[17]*s[11]+e[18]*s[16],t[17]=e[15]*s[2]+e[16]*s[7]+e[17]*s[12]+e[18]*s[17],t[18]=e[15]*s[3]+e[16]*s[8]+e[17]*s[13]+e[18]*s[18],t[19]=e[15]*s[4]+e[16]*s[9]+e[17]*s[14]+e[18]*s[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const s=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(s,e)}tint(t,e){const[s,i,n]=Ao.shared.setValue(t).toArray(),r=[s,0,0,0,0,0,i,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(r,e)}greyscale(t,e){const s=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(s,e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const s=Math.cos(t),i=Math.sin(t),n=1/3,r=(0,Math.sqrt)(n),a=[s+(1-s)*n,n*(1-s)-r*i,n*(1-s)+r*i,0,0,n*(1-s)+r*i,s+n*(1-s),n*(1-s)-r*i,0,0,n*(1-s)-r*i,n*(1-s)+r*i,s+n*(1-s),0,0,0,0,0,1,0];this._loadMatrix(a,e)}contrast(t,e){const s=(t||0)+1,i=-.5*(s-1),n=[s,0,0,0,i,0,s,0,0,i,0,0,s,0,i,0,0,0,1,0];this._loadMatrix(n,e)}saturate(t=0,e){const s=2*t/3+1,i=-.5*(s-1),n=[s,i,i,0,0,i,s,i,0,0,i,i,s,0,0,0,0,0,1,0];this._loadMatrix(n,e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,s,i,n){t=t||.2,e=e||.15,s=s||16770432,i=i||3375104;const r=Ao.shared,[a,o,h]=r.setValue(s).toArray(),[l,c,u]=r.setValue(i).toArray(),d=[.3,.59,.11,0,0,a,o,h,t,0,l,c,u,e,0,a-l,o-c,h-u,0,0];this._loadMatrix(d,n)}night(t,e){const s=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(s,e)}predator(t,e){const s=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(s,e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}mu.prototype.grayscale=mu.prototype.greyscale;const gu={AlphaFilter:class extends wl{constructor(t=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}},BlurFilter:class extends wl{constructor(t=8,e=4,s=wl.defaultResolution,i=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new fu(!0,t,e,s,i),this.blurYFilter=new fu(!1,t,e,s,i),this.resolution=s,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,s,i){const n=Math.abs(this.blurXFilter.strength),r=Math.abs(this.blurYFilter.strength);if(n&&r){const n=t.getFilterTexture();this.blurXFilter.apply(t,e,n,_r.CLEAR),this.blurYFilter.apply(t,n,s,i),t.returnFilterTexture(n)}else r?this.blurYFilter.apply(t,e,s,i):this.blurXFilter.apply(t,e,s,i)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}},BlurFilterPass:fu,ColorMatrixFilter:mu,DisplacementFilter:class extends wl{constructor(t,e){const s=new Dh;t.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:t._texture,filterMatrix:s,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=s,null==e&&(e=20),this.scale=new Ah(e,e)}apply(t,e,s,i){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const n=this.maskSprite.worldTransform,r=Math.sqrt(n.a*n.a+n.b*n.b),a=Math.sqrt(n.c*n.c+n.d*n.d);0!==r&&0!==a&&(this.uniforms.rotation[0]=n.a/r,this.uniforms.rotation[1]=n.b/r,this.uniforms.rotation[2]=n.c/a,this.uniforms.rotation[3]=n.d/a),t.applyFilter(this,e,s,i)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}},FXAAFilter:class extends wl{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}},NoiseFilter:class extends wl{constructor(t=.5,e=Math.random()){super(Lc,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}};Object.entries(gu).forEach((([t,e])=>{Object.defineProperty(gu,t,{get:()=>(za("7.1.0",`filters.${t} has moved to ${t}`),e)})}));const yu=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){!this.tickerAdded&&this.domElement&&(Oc.system.add(this.tickerUpdate,this,kc.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Oc.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===t.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())}};class xu{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=xu.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Ah,this.page=new Ah,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,s){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,s,i,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class vu extends xu{constructor(){super(...arguments),this.client=new Ah,this.movement=new Ah,this.offset=new Ah,this.global=new Ah,this.screen=new Ah}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,s){return t.worldTransform.applyInverse(s||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,s,i,n,r,a,o,h,l,c,u,d,p,f){throw new Error("Method not implemented.")}}class _u extends vu{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class bu extends vu{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}bu.DOM_DELTA_PIXEL=0,bu.DOM_DELTA_LINE=1,bu.DOM_DELTA_PAGE=2;const wu=new Ah,Eu=new Ah;class Su{constructor(t){this.dispatch=new x,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let s=0,i=e.length;s<i;s++)e[s].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){yu.pauseUpdate=!0;const s=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,wu.set(t,e),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(t,e){if(!t.target)return;const s=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let i=0,n=s.length-1;i<n;i++)if(t.currentTarget=s[i],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let i=s.length-2;i>=0;i--)if(t.currentTarget=s[i],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,s=this._allInteractiveElements){if(0===s.length)return;t.eventPhase=t.BUBBLING_PHASE;const i=Array.isArray(e)?e:[e];for(let n=s.length-1;n>=0;n--)i.forEach((e=>{t.currentTarget=s[n],this.notifyTarget(t,e)}))}propagationPath(t){const e=[t];for(let s=0;s<2048&&t!==this.rootTarget;s++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,s,i,n,r=!1){let a=!1;if(this._interactivePrune(t))return null;if("dynamic"!==t.eventMode&&"dynamic"!==e||(yu.pauseUpdate=!1),t.interactiveChildren&&t.children){const o=t.children;for(let h=o.length-1;h>=0;h--){const l=o[h],c=this.hitTestMoveRecursive(l,this._isInteractive(e)?e:l.eventMode,s,i,n,r||n(t,s));if(c){if(c.length>0&&!c[c.length-1].parent)continue;const e=t.isInteractive();(c.length>0||e)&&(e&&this._allInteractiveElements.push(t),c.push(t)),0===this._hitElements.length&&(this._hitElements=c),a=!0}}}const o=this._isInteractive(e),h=t.isInteractive();return h&&h&&this._allInteractiveElements.push(t),r||this._hitElements.length>0?null:a?this._hitElements:o&&!n(t,s)&&i(t,s)?h?[t]:[]:null}hitTestRecursive(t,e,s,i,n){if(this._interactivePrune(t)||n(t,s))return null;if("dynamic"!==t.eventMode&&"dynamic"!==e||(yu.pauseUpdate=!1),t.interactiveChildren&&t.children){const r=t.children;for(let a=r.length-1;a>=0;a--){const o=r[a],h=this.hitTestRecursive(o,this._isInteractive(e)?e:o.eventMode,s,i,n);if(h){if(h.length>0&&!h[h.length-1].parent)continue;const e=t.isInteractive();return(h.length>0||e)&&h.push(t),h}}}const r=this._isInteractive(e),a=t.isInteractive();return r&&i(t,s)?a?[t]:[]:null}_isInteractive(t){return"static"===t||"dynamic"===t}_interactivePrune(t){return!(t&&!t.isMask&&t.visible&&t.renderable)||("none"===t.eventMode||("passive"===t.eventMode&&!t.interactiveChildren||!!t.isMask))}hitPruneFn(t,e){var s;if(t.hitArea&&(t.worldTransform.applyInverse(e,Eu),!t.hitArea.contains(Eu.x,Eu.y)))return!0;if(t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;if(i&&!(null==(s=i.containsPoint)?void 0:s.call(i,e)))return!0}return!1}hitTestFn(t,e){return"passive"!==t.eventMode&&(!!t.hitArea||!!t.containsPoint&&t.containsPoint(e))}notifyTarget(t,e){var s,i;const n=`on${e=null!=e?e:t.type}`;null==(i=(s=t.currentTarget)[n])||i.call(s,t);const r=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,r),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof _u))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)this.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.dispatchEvent(e,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var e,s,i;if(!(t instanceof _u))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const n=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const r="mouse"===n.pointerType||"pen"===n.pointerType,a=this.trackingData(t.pointerId),o=this.findMountedTarget(a.overTargets);if((null==(e=a.overTargets)?void 0:e.length)>0&&o!==n.target){const e="mousemove"===t.type?"mouseout":"pointerout",s=this.createPointerEvent(t,e,o);if(this.dispatchEvent(s,"pointerout"),r&&this.dispatchEvent(s,"mouseout"),!n.composedPath().includes(o)){const e=this.createPointerEvent(t,"pointerleave",o);for(e.eventPhase=e.AT_TARGET;e.target&&!n.composedPath().includes(e.target);)e.currentTarget=e.target,this.notifyTarget(e),r&&this.notifyTarget(e,"mouseleave"),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(s)}if(o!==n.target){const e="mousemove"===t.type?"mouseover":"pointerover",s=this.clonePointerEvent(n,e);this.dispatchEvent(s,"pointerover"),r&&this.dispatchEvent(s,"mouseover");let i=null==o?void 0:o.parent;for(;i&&i!==this.rootTarget.parent&&i!==n.target;)i=i.parent;if(!i||i===this.rootTarget.parent){const t=this.clonePointerEvent(n,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==o&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),r&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(s)}const h=[],l=null==(s=this.enableGlobalMoveEvents)||s;this.moveOnAll?h.push("pointermove"):this.dispatchEvent(n,"pointermove"),l&&h.push("globalpointermove"),"touch"===n.pointerType&&(this.moveOnAll?h.splice(1,0,"touchmove"):this.dispatchEvent(n,"touchmove"),l&&h.push("globaltouchmove")),r&&(this.moveOnAll?h.splice(1,0,"mousemove"):this.dispatchEvent(n,"mousemove"),l&&h.push("globalmousemove"),this.cursor=null==(i=n.target)?void 0:i.cursor),h.length>0&&this.all(n,h),this._allInteractiveElements.length=0,this._hitElements.length=0,a.overTargets=n.composedPath(),this.freeEvent(n)}mapPointerOver(t){var e;if(!(t instanceof _u))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const s=this.trackingData(t.pointerId),i=this.createPointerEvent(t),n="mouse"===i.pointerType||"pen"===i.pointerType;this.dispatchEvent(i,"pointerover"),n&&this.dispatchEvent(i,"mouseover"),"mouse"===i.pointerType&&(this.cursor=null==(e=i.target)?void 0:e.cursor);const r=this.clonePointerEvent(i,"pointerenter");for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),n&&this.notifyTarget(r,"mouseenter"),r.target=r.target.parent;s.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(r)}mapPointerOut(t){if(!(t instanceof _u))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId);if(e.overTargets){const s="mouse"===t.pointerType||"pen"===t.pointerType,i=this.findMountedTarget(e.overTargets),n=this.createPointerEvent(t,"pointerout",i);this.dispatchEvent(n),s&&this.dispatchEvent(n,"mouseout");const r=this.createPointerEvent(t,"pointerleave",i);for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),s&&this.notifyTarget(r,"mouseleave"),r.target=r.target.parent;e.overTargets=null,this.freeEvent(n),this.freeEvent(r)}this.cursor=null}mapPointerUp(t){if(!(t instanceof _u))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=performance.now(),s=this.createPointerEvent(t);if(this.dispatchEvent(s,"pointerup"),"touch"===s.pointerType)this.dispatchEvent(s,"touchend");else if("mouse"===s.pointerType||"pen"===s.pointerType){const t=2===s.button;this.dispatchEvent(s,t?"rightup":"mouseup")}const i=this.trackingData(t.pointerId),n=this.findMountedTarget(i.pressTargetsByButton[t.button]);let r=n;if(n&&!s.composedPath().includes(n)){let e=n;for(;e&&!s.composedPath().includes(e);){if(s.currentTarget=e,this.notifyTarget(s,"pointerupoutside"),"touch"===s.pointerType)this.notifyTarget(s,"touchendoutside");else if("mouse"===s.pointerType||"pen"===s.pointerType){const t=2===s.button;this.notifyTarget(s,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete i.pressTargetsByButton[t.button],r=e}if(r){const n=this.clonePointerEvent(s,"click");n.target=r,n.path=null,i.clicksByButton[t.button]||(i.clicksByButton[t.button]={clickCount:0,target:n.target,timeStamp:e});const a=i.clicksByButton[t.button];if(a.target===n.target&&e-a.timeStamp<200?++a.clickCount:a.clickCount=1,a.target=n.target,a.timeStamp=e,n.detail=a.clickCount,"mouse"===n.pointerType){const t=2===n.button;this.dispatchEvent(n,t?"rightclick":"click")}else"touch"===n.pointerType&&this.dispatchEvent(n,"tap");this.dispatchEvent(n,"pointertap"),this.freeEvent(n)}this.freeEvent(s)}mapPointerUpOutside(t){if(!(t instanceof _u))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),s=this.findMountedTarget(e.pressTargetsByButton[t.button]),i=this.createPointerEvent(t);if(s){let n=s;for(;n;)i.currentTarget=n,this.notifyTarget(i,"pointerupoutside"),"touch"===i.pointerType?this.notifyTarget(i,"touchendoutside"):"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.notifyTarget(i,2===i.button?"rightupoutside":"mouseupoutside"),n=n.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(i)}mapWheel(t){if(!(t instanceof bu))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let s=1;s<t.length&&t[s].parent===e;s++)e=t[s];return e}createPointerEvent(t,e,s){var i;const n=this.allocateEvent(_u);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=null!=(i=null!=s?s:this.hitTest(n.global.x,n.global.y))?i:this._hitElements[0],"string"==typeof e&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(bu);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const s=this.allocateEvent(_u);return s.nativeEvent=t.nativeEvent,s.originalEvent=t.originalEvent,this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.target=t.target,s.path=t.composedPath().slice(),s.type=null!=e?e:s.type,s}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof _u&&e instanceof _u&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof vu&&e instanceof vu&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const s=t.currentTarget._events[e];if(s&&t.currentTarget.isInteractive())if("fn"in s)s.once&&t.currentTarget.removeListener(e,s.fn,void 0,!0),s.fn.call(s.context,t);else for(let i=0,n=s.length;i<n&&!t.propagationImmediatelyStopped;i++)s[i].once&&t.currentTarget.removeListener(e,s[i].fn,void 0,!0),s[i].fn.call(s[i].context,t)}}const Tu={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Au=class{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new Su(null),yu.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new _u(null),this.rootWheelEvent=new bu(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy(l({},Au.defaultEventFeatures),{set:(t,e,s)=>("globalMove"===e&&(this.rootBoundary.enableGlobalMoveEvents=s),t[e]=s,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){var e,s;const{view:i,resolution:n}=this.renderer;this.setTargetElement(i),this.resolution=n,Au._defaultEventMode=null!=(e=t.eventMode)?e:"auto",Object.assign(this.features,null!=(s=t.eventFeatures)?s:{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const s=this.cursorStyles[t];if(s)switch(typeof s){case"string":e&&(this.domElement.style.cursor=s);break;case"function":s(t);break;case"object":e&&Object.assign(this.domElement.style,s)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);if(this.autoPreventDefault&&e[0].isNormalized){(t.cancelable||!("cancelable"in t))&&t.preventDefault()}for(let s=0,i=e.length;s<i;s++){const t=e[s],i=this.bootstrapEvent(this.rootPointerEvent,t);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;yu.pointerMoved();const e=this.normalizeToPointerData(t);for(let s=0,i=e.length;s<i;s++){const t=this.bootstrapEvent(this.rootPointerEvent,e[s]);this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const s=e!==this.domElement?"outside":"",i=this.normalizeToPointerData(t);for(let n=0,r=i.length;n<r;n++){const t=this.bootstrapEvent(this.rootPointerEvent,i[n]);t.type+=s,this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let s=0,i=e.length;s<i;s++){const t=this.bootstrapEvent(this.rootPointerEvent,e[s]);this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,yu.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;yu.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;yu.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,s){let i;i=this.domElement.parentElement?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const n=1/this.resolution;t.x=(e-i.left)*(this.domElement.width/i.width)*n,t.y=(s-i.top)*(this.domElement.height/i.height)*n}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let s=0,i=t.changedTouches.length;s<i;s++){const i=t.changedTouches[s];void 0===i.button&&(i.button=0),void 0===i.buttons&&(i.buttons=1),void 0===i.isPrimary&&(i.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===i.width&&(i.width=i.radiusX||1),void 0===i.height&&(i.height=i.radiusY||1),void 0===i.tiltX&&(i.tiltX=0),void 0===i.tiltY&&(i.tiltY=0),void 0===i.pointerType&&(i.pointerType="touch"),void 0===i.pointerId&&(i.pointerId=i.identifier||0),void 0===i.pressure&&(i.pressure=i.force||.5),void 0===i.twist&&(i.twist=0),void 0===i.tangentialPressure&&(i.tangentialPressure=0),void 0===i.layerX&&(i.layerX=i.offsetX=i.clientX),void 0===i.layerY&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,i.type=t.type,e.push(i)}else if(globalThis.MouseEvent&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof globalThis.PointerEvent))e.push(t);else{const s=t;void 0===s.isPrimary&&(s.isPrimary=!0),void 0===s.width&&(s.width=1),void 0===s.height&&(s.height=1),void 0===s.tiltX&&(s.tiltX=0),void 0===s.tiltY&&(s.tiltY=0),void 0===s.pointerType&&(s.pointerType="mouse"),void 0===s.pointerId&&(s.pointerId=1),void 0===s.pressure&&(s.pressure=.5),void 0===s.twist&&(s.twist=0),void 0===s.tangentialPressure&&(s.tangentialPressure=0),s.isNormalized=!0,e.push(s)}return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=Tu[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};let Cu=Au;function Mu(t){return"dynamic"===t||"static"===t}Cu.extension={name:"events",type:[Ko.RendererSystem,Ko.CanvasRendererSystem]},Cu.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0},Jo.add(Cu);const Iu={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){var t;return null!=(t=this._internalInteractive)?t:Mu(Cu.defaultEventMode)},set interactive(t){za("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=t,this.eventMode=t?"static":"auto"},_internalEventMode:void 0,get eventMode(){var t;return null!=(t=this._internalEventMode)?t:Cu.defaultEventMode},set eventMode(t){this._internalInteractive=Mu(t),this._internalEventMode=t},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(t,e,s){const i="function"==typeof e?void 0:e;t="boolean"==typeof s&&s||"object"==typeof s&&s.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.on(t,e,i)},removeEventListener(t,e,s){const i="function"==typeof e?void 0:e;t="boolean"==typeof s&&s||"object"==typeof s&&s.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.off(t,e,i)},dispatchEvent(t){if(!(t instanceof xu))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};tu.mixin(Iu);tu.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class Pu{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Wr.tablet||Wr.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()})),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),null==(t=this.renderer.view.parentNode)||t.appendChild(this.div))}deactivate(){var t;this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),null==(t=this.div.parentNode)||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let s=0;s<e.length;s++)this.updateAccessibleObjects(e[s])}update(){const t=performance.now();if(Wr.android.device&&t<this.androidUpdateCount)return;if(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen)return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:s,width:i,height:n}=this.renderer.view.getBoundingClientRect(),{width:r,height:a,resolution:o}=this.renderer,h=i/r*o,l=n/a*o;let c=this.div;c.style.left=`${e}px`,c.style.top=`${s}px`,c.style.width=`${r}px`,c.style.height=`${a}px`;for(let u=0;u<this.children.length;u++){const t=this.children[u];if(t.renderId!==this.renderId)t._accessibleActive=!1,Oo(this.children,u,1),this.div.removeChild(t._accessibleDiv),this.pool.push(t._accessibleDiv),t._accessibleDiv=null,u--;else{c=t._accessibleDiv;let e=t.hitArea;const s=t.worldTransform;t.hitArea?(c.style.left=(s.tx+e.x*s.a)*h+"px",c.style.top=(s.ty+e.y*s.d)*l+"px",c.style.width=e.width*s.a*h+"px",c.style.height=e.height*s.d*l+"px"):(e=t.getBounds(),this.capHitArea(e),c.style.left=e.x*h+"px",c.style.top=e.y*l+"px",c.style.width=e.width*h+"px",c.style.height=e.height*l+"px",c.title!==t.accessibleTitle&&null!==t.accessibleTitle&&(c.title=t.accessibleTitle),c.getAttribute("aria-label")!==t.accessibleHint&&null!==t.accessibleHint&&c.setAttribute("aria-label",t.accessibleHint)),t.accessibleTitle===c.title&&t.tabIndex===c.tabIndex||(c.title=t.accessibleTitle,c.tabIndex=t.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:s}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>s&&(t.height=s-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:s}=t.target,i=this.renderer.events.rootBoundary,n=Object.assign(new xu(i),{target:s});i.rootTarget=this.renderer.lastObjectRendered,e.forEach((t=>i.dispatchEvent(n,t)))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9===t.keyCode&&this.activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Pu.extension={name:"accessibility",type:[Ko.RendererPlugin,Ko.CanvasRendererPlugin]},Jo.add(Pu);const Ru=class{constructor(t){this.stage=new ru,t=Object.assign({forceCanvas:!1},t),this.renderer=function(t){for(const e of Bc)if(e.test(t))return new e(t);throw new Error("Unable to auto-detect a suitable renderer.")}(t),Ru._plugins.forEach((e=>{e.init.call(this,t)}))}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(t,e){const s=Ru._plugins.slice(0);s.reverse(),s.forEach((t=>{t.destroy.call(this)})),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};let ku=Ru;ku._plugins=[],Jo.handleByList(Ko.Application,ku._plugins);class Du{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this.cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:s,clientHeight:i}=this._resizeTo;t=s,e=i}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Du.extension=Ko.Application,Jo.add(Du);const Fu={loader:Ko.LoadParser,resolver:Ko.ResolveParser,cache:Ko.CacheParser,detection:Ko.DetectionParser};Jo.handle(Ko.Asset,(t=>{const e=t.ref;Object.entries(Fu).filter((([t])=>!!e[t])).forEach((([t,s])=>{var i;return Jo.add(Object.assign(e[t],{extension:null!=(i=e[t].extension)?i:s}))}))}),(t=>{const e=t.ref;Object.keys(Fu).filter((t=>!!e[t])).forEach((t=>Jo.remove(e[t])))}));class Ou{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach((t=>{this._assetList.push(t)})),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}_next(){return p(this,null,(function*(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let s=0;s<e;s++)t.push(this._assetList.pop());yield this._loader.load(t),this._isLoading=!1,this._next()}}))}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Nu(t,e){if(Array.isArray(e)){for(const s of e)if(t.startsWith(`data:${s}`))return!0;return!1}return t.startsWith(`data:${e}`)}function Bu(t,e){const s=t.split("?")[0],i=ja.extname(s).toLowerCase();return Array.isArray(e)?e.includes(i):i===e}const Lu=(t,e)=>(Array.isArray(t)||(t=[t]),e?t.map((t=>"string"==typeof t?e(t):t)):t),Vu=(t,e)=>{const s=e.split("?")[1];return s&&(t+=`?${s}`),t};function $u(t,e,s,i,n){const r=e[s];for(let a=0;a<r.length;a++){const o=r[a];s<e.length-1?$u(t.replace(i[s],o),e,s+1,i,n):n.push(t.replace(i[s],o))}}function Uu(t){const e=t.match(/\{(.*?)\}/g),s=[];if(e){const i=[];e.forEach((t=>{const e=t.substring(1,t.length-1).split(",");i.push(e)})),$u(t,i,0,e,s)}else s.push(t);return s}const Xu=t=>!Array.isArray(t);const Yu=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const s=Lu(t);let i;for(let a=0;a<this.parsers.length;a++){const t=this.parsers[a];if(t.test(e)){i=t.getCacheableAssets(s,e);break}}i||(i={},s.forEach((t=>{i[t]=e})));const n=Object.keys(i),r={cacheKeys:n,keys:s};if(s.forEach((t=>{this._cacheMap.set(t,r)})),n.forEach((t=>{this._cache.has(t)&&this._cache.get(t)!==e&&console.warn("[Cache] already has key:",t),this._cache.set(t,i[t])})),e instanceof Ol){const t=e;s.forEach((e=>{t.baseTexture!==Ol.EMPTY.baseTexture&&uh.addToCache(t.baseTexture,e),Ol.addToCache(t,e)}))}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t))return void console.warn(`[Assets] Asset id ${t} was not found in the Cache`);const e=this._cacheMap.get(t);e.cacheKeys.forEach((t=>{this._cache.delete(t)})),e.keys.forEach((t=>{this._cacheMap.delete(t)}))}get parsers(){return this._parsers}};class Wu{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,s)=>(this._parsersValidated=!1,t[e]=s,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const s={promise:null,parser:null};return s.promise=(()=>p(this,null,(function*(){var i,n;let r=null,a=null;if(e.loadParser&&(a=this._parserHash[e.loadParser],a||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!a){for(let s=0;s<this.parsers.length;s++){const n=this.parsers[s];if(n.load&&(null==(i=n.test)?void 0:i.call(n,t,e,this))){a=n;break}}if(!a)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}r=yield a.load(t,e,this),s.parser=a;for(let t=0;t<this.parsers.length;t++){const i=this.parsers[t];i.parse&&i.parse&&(yield null==(n=i.testParse)?void 0:n.call(i,r,e,this))&&(r=(yield i.parse(r,e,this))||r,s.parser=i)}return r})))(),s}load(t,e){return p(this,null,(function*(){this._parsersValidated||this._validateParsers();let s=0;const i={},n=Xu(t),r=Lu(t,(t=>({src:t}))),a=r.length,o=r.map((t=>p(this,null,(function*(){const n=ja.toAbsolute(t.src);if(!i[t.src])try{this.promiseCache[n]||(this.promiseCache[n]=this._getLoadPromiseAndParser(n,t)),i[t.src]=yield this.promiseCache[n].promise,e&&e(++s/a)}catch(Zf){throw delete this.promiseCache[n],delete i[t.src],new Error(`[Loader.load] Failed to load ${n}.\n${Zf}`)}}))));return yield Promise.all(o),n?i[r[0].src]:i}))}unload(t){return p(this,null,(function*(){const e=Lu(t,(t=>({src:t}))).map((t=>p(this,null,(function*(){var e,s;const i=ja.toAbsolute(t.src),n=this.promiseCache[i];if(n){const r=yield n.promise;null==(s=null==(e=n.parser)?void 0:e.unload)||s.call(e,r,t,this),delete this.promiseCache[i]}}))));yield Promise.all(e)}))}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter((t=>t.name)).reduce(((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),c(l({},t),{[e.name]:e}))),{})}}var ju=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(ju||{});const Gu={extension:{type:Ko.LoadParser,priority:ju.Low},name:"loadJson",test:t=>Nu(t,"application/json")||Bu(t,".json"),load(t){return p(this,null,(function*(){const e=yield Ar.ADAPTER.fetch(t);return yield e.json()}))}};Jo.add(Gu);const zu={name:"loadTxt",extension:{type:Ko.LoadParser,priority:ju.Low},test:t=>Nu(t,"text/plain")||Bu(t,".txt"),load(t){return p(this,null,(function*(){const e=yield Ar.ADAPTER.fetch(t);return yield e.text()}))}};Jo.add(zu);const Hu=["normal","bold","100","200","300","400","500","600","700","800","900"],qu=[".ttf",".otf",".woff",".woff2"],Ku=["font/ttf","font/otf","font/woff","font/woff2"],Zu=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;const Qu={extension:{type:Ko.LoadParser,priority:ju.Low},name:"loadWebFont",test:t=>Nu(t,Ku)||Bu(t,qu),load(t,e){return p(this,null,(function*(){var s,i,n,r,a,o;const h=Ar.ADAPTER.getFontFaceSet();if(h){const u=[],d=null!=(i=null==(s=e.data)?void 0:s.family)?i:function(t){const e=ja.extname(t),s=ja.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map((t=>t.charAt(0).toUpperCase()+t.slice(1)));let i=s.length>0;for(const r of s)if(!r.match(Zu)){i=!1;break}let n=s.join(" ");return i||(n=`"${n.replace(/[\\"]/g,"\\$&")}"`),n}(t),p=null!=(a=null==(r=null==(n=e.data)?void 0:n.weights)?void 0:r.filter((t=>Hu.includes(t))))?a:["normal"],f=null!=(o=e.data)?o:{};for(let e=0;e<p.length;e++){const s=p[e],i=new FontFace(d,`url(${encodeURI(t)})`,c(l({},f),{weight:s}));yield i.load(),h.add(i),u.push(i)}return 1===u.length?u[0]:u}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null}))},unload(t){(Array.isArray(t)?t:[t]).forEach((t=>Ar.ADAPTER.getFontFaceSet().delete(t)))}};Jo.add(Qu);let Ju,td=0;const ed={id:"checkImageBitmap",code:"\n    async function checkImageBitmap()\n    {\n        try\n        {\n            if (typeof createImageBitmap !== 'function') return false;\n\n            const response = await fetch('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=');\n            const imageBlob =  await response.blob();\n            const imageBitmap = await createImageBitmap(imageBlob);\n\n            return imageBitmap.width === 1 && imageBitmap.height === 1;\n        }\n        catch (e)\n        {\n            return false;\n        }\n    }\n    checkImageBitmap().then((result) => { self.postMessage(result); });\n    "},sd={id:"loadImageBitmap",code:"\n    async function loadImageBitmap(url)\n    {\n        const response = await fetch(url);\n\n        if (!response.ok)\n        {\n            throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: `\n                + `${response.status} ${response.statusText}`);\n        }\n\n        const imageBlob =  await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n\n        return imageBitmap;\n    }\n    self.onmessage = async (event) =>\n    {\n        try\n        {\n            const imageBitmap = await loadImageBitmap(event.data.data[0]);\n\n            self.postMessage({\n                data: imageBitmap,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            }, [imageBitmap]);\n        }\n        catch(e)\n        {\n            self.postMessage({\n                error: e,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            });\n        }\n    };"};let id;const nd=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((t=>{const e=URL.createObjectURL(new Blob([ed.code],{type:"application/javascript"})),s=new Worker(e);s.addEventListener("message",(i=>{s.terminate(),URL.revokeObjectURL(e),t(i.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}_initWorkers(){return p(this,null,(function*(){this._initialized||(this._initialized=!0)}))}getWorker(){void 0===Ju&&(Ju=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Ju&&(id||(id=URL.createObjectURL(new Blob([sd.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(id),t.addEventListener("message",(t=>{this.complete(t.data),this.returnWorker(t.target),this.next()}))),t}returnWorker(t){this.workerPool.push(t)}complete(t){void 0!==t.error?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}_run(t,e){return p(this,null,(function*(){yield this._initWorkers();const s=new Promise(((s,i)=>{this.queue.push({id:t,arguments:e,resolve:s,reject:i})}));return this.next(),s}))}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),s=e.id;this.resolveHash[td]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:td++,id:s})}};function rd(t,e,s){const i=new Ol(t);return i.baseTexture.on("dispose",(()=>{delete e.promiseCache[s]})),i}const ad=[".jpeg",".jpg",".png",".webp",".avif"],od=["image/jpeg","image/png","image/webp","image/avif"];const hd={name:"loadTextures",extension:{type:Ko.LoadParser,priority:ju.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:t=>Nu(t,od)||Bu(t,ad),load(t,e,s){return p(this,null,(function*(){let i=null;i=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&(yield nd.isImageBitmapSupported())?yield nd.loadImageBitmap(t):yield function(t){return p(this,null,(function*(){const e=yield Ar.ADAPTER.fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);const s=yield e.blob();return yield createImageBitmap(s)}))}(t):yield new Promise((e=>{i=new Image,i.crossOrigin=this.config.crossOrigin,i.src=t,i.complete?e(i):i.onload=()=>{e(i)}}));const n=new uh(i,l({resolution:qo(t)},e.data));return n.resource.src=t,rd(n,s,t)}))},unload(t){t.destroy(!0)}};Jo.add(hd);const ld={extension:{type:Ko.LoadParser,priority:ju.High},name:"loadSVG",test:t=>Nu(t,"image/svg+xml")||Bu(t,".svg"),testParse(t){return p(this,null,(function*(){return Kc.test(t)}))},parse(t,e,s){return p(this,null,(function*(){var i;const n=new Kc(t,null==(i=null==e?void 0:e.data)?void 0:i.resourceOptions);yield n.load();const r=new uh(n,l({resolution:qo(t)},null==e?void 0:e.data));r.resource.src=t;return rd(r,s,t)}))},load(t,e){return p(this,null,(function*(){return(yield Ar.ADAPTER.fetch(t)).text()}))},unload:hd.unload};Jo.add(ld);class cd{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){var e,s,i;if(this._bundleIdConnector=null!=(e=t.connector)?e:this._bundleIdConnector,this._createBundleAssetId=null!=(s=t.createBundleAssetId)?s:this._createBundleAssetId,this._extractAssetIdFromBundle=null!=(i=t.extractAssetIdFromBundle)?i:this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach((t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))})),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if("string"==typeof t)this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach((t=>{this.addBundle(t.name,t.assets)}))}addBundle(t,e){const s=[];Array.isArray(e)?e.forEach((e=>{if("string"==typeof e.name){const i=this._createBundleAssetId(t,e.name);s.push(i),this.add([e.name,i],e.srcs,e.data)}else{const i=e.name.map((e=>this._createBundleAssetId(t,e)));i.forEach((t=>{s.push(t)})),this.add([...e.name,...i],e.srcs)}})):Object.keys(e).forEach((i=>{s.push(this._createBundleAssetId(t,i)),this.add([i,this._createBundleAssetId(t,i)],e[i])})),this._bundles[t]=s}add(t,e,s){const i=Lu(t);i.forEach((t=>{this.hasKey(t)&&console.warn(`[Resolver] already has key: ${t} overwriting`)})),Array.isArray(e)||(e="string"==typeof e?Uu(e):[e]);const n=e.map((t=>{var e;let n=t;if("string"==typeof t){let e=!1;for(let s=0;s<this._parsers.length;s++){const i=this._parsers[s];if(i.test(t)){n=i.parse(t),e=!0;break}}e||(n={src:t})}return n.format||(n.format=n.src.split(".").pop()),n.alias||(n.alias=i),(this._basePath||this._rootPath)&&(n.src=ja.toAbsolute(n.src,this._basePath,this._rootPath)),n.src=this._appendDefaultSearchParams(n.src),n.data=null!=(e=n.data)?e:s,n}));i.forEach((t=>{this._assetMap[t]=n}))}resolveBundle(t){const e=Xu(t);t=Lu(t);const s={};return t.forEach((t=>{const e=this._bundles[t];if(e){const i=this.resolve(e),n={};for(const e in i){const s=i[e];n[this._extractAssetIdFromBundle(t,e)]=s}s[t]=n}})),e?s[t[0]]:s}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const t={};for(const s in e)t[s]=e[s].src;return t}return e.src}resolve(t){const e=Xu(t);t=Lu(t);const s={};return t.forEach((t=>{var e;if(!this._resolverHash[t])if(this._assetMap[t]){let s=this._assetMap[t];const i=this._getPreferredOrder(s),n=s[0];null==i||i.priority.forEach((t=>{i.params[t].forEach((e=>{const i=s.filter((s=>!!s[t]&&s[t]===e));i.length&&(s=i)}))})),this._resolverHash[t]=null!=(e=s[0])?e:n}else{let e=t;(this._basePath||this._rootPath)&&(e=ja.toAbsolute(e,this._basePath,this._rootPath)),e=this._appendDefaultSearchParams(e),this._resolverHash[t]={src:e}}s[t]=this._resolverHash[t]})),e?s[t[0]]:s}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const e=t[0],s=this._preferredOrder.find((t=>t.params.format.includes(e.format)));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;return`${t}${/\?/.test(t)?"&":"?"}${this._defaultSearchParams}`}}class ud{constructor(){this._detections=[],this._initialized=!1,this.resolver=new cd,this.loader=new Wu,this.cache=Yu,this._backgroundLoader=new Ou(this.loader),this._backgroundLoader.active=!0,this.reset()}init(){return p(this,arguments,(function*(t={}){var e,s,i,n;if(this._initialized)return void console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let e=t.manifest;"string"==typeof e&&(e=yield this.load(e)),this.resolver.addManifest(e)}const r=null!=(s=null==(e=t.texturePreference)?void 0:e.resolution)?s:1,a="number"==typeof r?[r]:r;let o=[];if(null==(i=t.texturePreference)?void 0:i.format){const e=null==(n=t.texturePreference)?void 0:n.format;o="string"==typeof e?[e]:e;for(const t of this._detections)(yield t.test())||(o=yield t.remove(o))}else for(const h of this._detections)(yield h.test())&&(o=yield h.add(o));this.resolver.prefer({params:{format:o,resolution:a}}),t.preferences&&this.setPreferences(t.preferences)}))}add(t,e,s){this.resolver.add(t,e,s)}load(t,e){return p(this,null,(function*(){this._initialized||(yield this.init());const s=Xu(t),i=Lu(t).map((t=>"string"!=typeof t?(this.resolver.add(t.src,t),t.src):(this.resolver.hasKey(t)||this.resolver.add(t,t),t))),n=this.resolver.resolve(i),r=yield this._mapLoadToResolve(n,e);return s?r[i[0]]:r}))}addBundle(t,e){this.resolver.addBundle(t,e)}loadBundle(t,e){return p(this,null,(function*(){this._initialized||(yield this.init());let s=!1;"string"==typeof t&&(s=!0,t=[t]);const i=this.resolver.resolveBundle(t),n={},r=Object.keys(i);let a=0,o=0;const h=()=>{null==e||e(++a/o)},l=r.map((t=>{const e=i[t];return o+=Object.keys(e).length,this._mapLoadToResolve(e,h).then((e=>{n[t]=e}))}));return yield Promise.all(l),s?n[t[0]]:n}))}backgroundLoad(t){return p(this,null,(function*(){this._initialized||(yield this.init()),"string"==typeof t&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}))}backgroundLoadBundle(t){return p(this,null,(function*(){this._initialized||(yield this.init()),"string"==typeof t&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach((t=>{this._backgroundLoader.add(Object.values(t))}))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return Yu.get(t);const e={};for(let s=0;s<t.length;s++)e[s]=Yu.get(t[s]);return e}_mapLoadToResolve(t,e){return p(this,null,(function*(){const s=Object.values(t),i=Object.keys(t);this._backgroundLoader.active=!1;const n=yield this.loader.load(s,e);this._backgroundLoader.active=!0;const r={};return s.forEach(((t,e)=>{const s=n[t.src],a=[t.src];t.alias&&a.push(...t.alias),r[i[e]]=s,Yu.set(a,s)})),r}))}unload(t){return p(this,null,(function*(){this._initialized||(yield this.init());const e=Lu(t).map((t=>"string"!=typeof t?t.src:t)),s=this.resolver.resolve(e);yield this._unloadFromResolved(s)}))}unloadBundle(t){return p(this,null,(function*(){this._initialized||(yield this.init()),t=Lu(t);const e=this.resolver.resolveBundle(t),s=Object.keys(e).map((t=>this._unloadFromResolved(e[t])));yield Promise.all(s)}))}_unloadFromResolved(t){return p(this,null,(function*(){const e=Object.values(t);e.forEach((t=>{Yu.remove(t.src)})),yield this.loader.unload(e)}))}get detections(){return this._detections}get preferWorkers(){return hd.config.preferWorkers}set preferWorkers(t){za("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach((e=>{e.config&&Object.keys(e.config).filter((e=>e in t)).forEach((s=>{e.config[s]=t[s]}))}))}}const dd=new ud;Jo.handleByList(Ko.LoadParser,dd.loader.parsers).handleByList(Ko.ResolveParser,dd.resolver.parsers).handleByList(Ko.CacheParser,dd.cache.parsers).handleByList(Ko.DetectionParser,dd.detections);const pd={extension:Ko.CacheParser,test:t=>Array.isArray(t)&&t.every((t=>t instanceof Ol)),getCacheableAssets:(t,e)=>{const s={};return t.forEach((t=>{e.forEach(((e,i)=>{s[t+(0===i?"":i+1)]=e}))})),s}};Jo.add(pd);const fd={extension:{type:Ko.DetectionParser,priority:1},test:()=>p(void 0,null,(function*(){if(!globalThis.createImageBitmap)return!1;const t=yield Ar.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))})),add:t=>p(void 0,null,(function*(){return[...t,"avif"]})),remove:t=>p(void 0,null,(function*(){return t.filter((t=>"avif"!==t))}))};Jo.add(fd);const md={extension:{type:Ko.DetectionParser,priority:0},test:()=>p(void 0,null,(function*(){if(!globalThis.createImageBitmap)return!1;const t=yield Ar.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))})),add:t=>p(void 0,null,(function*(){return[...t,"webp"]})),remove:t=>p(void 0,null,(function*(){return t.filter((t=>"webp"!==t))}))};Jo.add(md);const gd=["png","jpg","jpeg"],yd={extension:{type:Ko.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:t=>p(void 0,null,(function*(){return[...t,...gd]})),remove:t=>p(void 0,null,(function*(){return t.filter((t=>!gd.includes(t)))}))};Jo.add(yd);const xd={extension:Ko.ResolveParser,test:hd.test,parse:t=>{var e,s;return{resolution:parseFloat(null!=(s=null==(e=Ar.RETINA_PREFIX.exec(t))?void 0:e[1])?s:"1"),format:t.split(".").pop(),src:t}}};Jo.add(xd);var vd=(t=>(t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t))(vd||{});const _d={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let bd,wd;function Ed(){wd={s3tc:bd.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:bd.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:bd.getExtension("WEBGL_compressed_texture_etc"),etc1:bd.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:bd.getExtension("WEBGL_compressed_texture_pvrtc")||bd.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:bd.getExtension("WEBGL_compressed_texture_atc"),astc:bd.getExtension("WEBGL_compressed_texture_astc")}}const Sd={extension:{type:Ko.DetectionParser,priority:2},test:()=>p(void 0,null,(function*(){const t=Ar.ADAPTER.createCanvas().getContext("webgl");return t?(bd=t,!0):(console.warn("WebGL not available for compressed textures."),!1)})),add:t=>p(void 0,null,(function*(){wd||Ed();const e=[];for(const t in wd){wd[t]&&e.push(t)}return[...e,...t]})),remove:t=>p(void 0,null,(function*(){return wd||Ed(),t.filter((t=>!(t in wd)))}))};Jo.add(Sd);class Td extends hh{constructor(t,e={width:1,height:1,autoLoad:!0}){let s,i;"string"==typeof t?(s=t,i=new Uint8Array):(s=null,i=t),super(i,e),this.origin=s,this.buffer=i?new th(i):null,this._load=null,this.loaded=!1,null!==this.origin&&!1!==e.autoLoad&&this.load(),null===this.origin&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load||(this._load=fetch(this.origin).then((t=>t.blob())).then((t=>t.arrayBuffer())).then((t=>(this.data=new Uint32Array(t),this.buffer=new th(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)))),this._load}}class Ad extends Td{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=Ad._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||Ad._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,s){const i=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let n=0,r=this.levels;n<r;n++){const{levelID:t,levelWidth:e,levelHeight:s,levelBuffer:r}=this._levelBuffers[n];i.compressedTexImage2D(i.TEXTURE_2D,t,this.format,e,s,0,r)}return!0}onBlobLoaded(){this._levelBuffers=Ad._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,s,i,n,r,a){const o=new Array(s);let h=t.byteOffset,l=r,c=a,u=l+i-1&~(i-1),d=c+n-1&~(n-1),p=u*d*_d[e];for(let f=0;f<s;f++)o[f]={levelID:f,levelWidth:s>1?l:u,levelHeight:s>1?c:d,levelBuffer:new Uint8Array(t.buffer,h,p)},h+=p,l=l>>1||1,c=c>>1||1,u=l+i-1&~(i-1),d=c+n-1&~(n-1),p=u*d*_d[e];return o}}const Cd=4,Md=124,Id=32,Pd=20,Rd=542327876,kd={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},Dd={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},Fd={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},Od=1,Nd=2,Bd=4,Ld=64,Vd=512,$d=131072,Ud=808540228,Xd=4,Yd={827611204:vd.COMPRESSED_RGBA_S3TC_DXT1_EXT,861165636:vd.COMPRESSED_RGBA_S3TC_DXT3_EXT,894720068:vd.COMPRESSED_RGBA_S3TC_DXT5_EXT},Wd={70:vd.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:vd.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:vd.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:vd.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:vd.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:vd.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:vd.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:vd.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:vd.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};const jd=[171,75,84,88,32,49,49,187,13,10,26,10],Gd=67305985,zd={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Hd=64,qd={[fr.UNSIGNED_BYTE]:1,[fr.UNSIGNED_SHORT]:2,[fr.INT]:4,[fr.UNSIGNED_INT]:4,[fr.FLOAT]:4,[fr.HALF_FLOAT]:8},Kd={[dr.RGBA]:4,[dr.RGB]:3,[dr.RG]:2,[dr.RED]:1,[dr.LUMINANCE]:1,[dr.LUMINANCE_ALPHA]:2,[dr.ALPHA]:1},Zd={[fr.UNSIGNED_SHORT_4_4_4_4]:2,[fr.UNSIGNED_SHORT_5_5_5_1]:2,[fr.UNSIGNED_SHORT_5_6_5]:2};function Qd(t,e,s=!1){const i=new DataView(e);if(!function(t,e){for(let s=0;s<jd.length;s++)if(e.getUint8(s)!==jd[s])return console.error(`${t} is not a valid *.ktx file!`),!1;return!0}(t,i))return null;const n=i.getUint32(zd.ENDIANNESS,!0)===Gd,r=i.getUint32(zd.GL_TYPE,n),a=i.getUint32(zd.GL_FORMAT,n),o=i.getUint32(zd.GL_INTERNAL_FORMAT,n),h=i.getUint32(zd.PIXEL_WIDTH,n),l=i.getUint32(zd.PIXEL_HEIGHT,n)||1,c=i.getUint32(zd.PIXEL_DEPTH,n)||1,u=i.getUint32(zd.NUMBER_OF_ARRAY_ELEMENTS,n)||1,d=i.getUint32(zd.NUMBER_OF_FACES,n),p=i.getUint32(zd.NUMBER_OF_MIPMAP_LEVELS,n),f=i.getUint32(zd.BYTES_OF_KEY_VALUE_DATA,n);if(0===l||1!==c)throw new Error("Only 2D textures are supported");if(1!==d)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==u)throw new Error("WebGL does not support array textures");const m=h+3&-4,g=l+3&-4,y=new Array(u);let x,v=h*l;if(0===r&&(v=m*g),x=0!==r?qd[r]?qd[r]*Kd[a]:Zd[r]:_d[o],void 0===x)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const _=s?function(t,e,s){const i=new Map;let n=0;for(;n<e;){const r=t.getUint32(Hd+n,s),a=Hd+n+4,o=3-(r+3)%4;if(0===r||r>e-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<r&&0!==t.getUint8(a+h);h++);if(-1===h){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=(new TextDecoder).decode(new Uint8Array(t.buffer,a,h)),c=new DataView(t.buffer,a+h+1,r-h-1);i.set(l,c),n+=4+r+o}return i}(i,f,n):null;let b=v*x,w=h,E=l,S=m,T=g,A=Hd+f;for(let C=0;C<p;C++){const t=i.getUint32(A,n);let s=A+4;for(let i=0;i<u;i++){let t=y[i];t||(t=y[i]=new Array(p)),t[C]={levelID:C,levelWidth:p>1||0!==r?w:S,levelHeight:p>1||0!==r?E:T,levelBuffer:new Uint8Array(e,s,b)},s+=b}A+=t+4,A=A%4!=0?A+4-A%4:A,w=w>>1||1,E=E>>1||1,S=w+4-1&-4,T=E+4-1&-4,b=S*T*x}return 0!==r?{uncompressed:y.map((t=>{let e=t[0].levelBuffer,s=!1;return r===fr.FLOAT?e=new Float32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4):r===fr.UNSIGNED_INT?(s=!0,e=new Uint32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)):r===fr.INT&&(s=!0,e=new Int32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)),{resource:new hh(e,{width:t[0].levelWidth,height:t[0].levelHeight}),type:r,format:s?Jd(a):a}})),kvData:_}:{compressed:y.map((t=>new Ad(null,{format:o,width:h,height:l,levels:p,levelBuffers:t}))),kvData:_}}function Jd(t){switch(t){case dr.RGBA:return dr.RGBA_INTEGER;case dr.RGB:return dr.RGB_INTEGER;case dr.RG:return dr.RG_INTEGER;case dr.RED:return dr.RED_INTEGER;default:return t}}const tp={extension:{type:Ko.LoadParser,priority:ju.High},name:"loadDDS",test:t=>Bu(t,".dds"),load(t,e,s){return p(this,null,(function*(){const i=yield Ar.ADAPTER.fetch(t),n=function(t){const e=new Uint32Array(t);if(e[0]!==Rd)throw new Error("Invalid DDS file magic word");const s=new Uint32Array(t,0,Md/Uint32Array.BYTES_PER_ELEMENT),i=s[kd.HEIGHT],n=s[kd.WIDTH],r=s[kd.MIPMAP_COUNT],a=new Uint32Array(t,kd.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,Id/Uint32Array.BYTES_PER_ELEMENT),o=a[Od];if(o&Bd){const s=a[Dd.FOURCC];if(s!==Ud){const e=Yd[s],a=new Uint8Array(t,Cd+Md);return[new Ad(a,{format:e,width:n,height:i,levels:r})]}const o=Cd+Md,h=new Uint32Array(e.buffer,o,Pd/Uint32Array.BYTES_PER_ELEMENT),l=h[Fd.DXGI_FORMAT],c=h[Fd.RESOURCE_DIMENSION],u=h[Fd.MISC_FLAG],d=h[Fd.ARRAY_SIZE],p=Wd[l];if(void 0===p)throw new Error(`DDSParser cannot parse texture data with DXGI format ${l}`);if(u===Xd)throw new Error("DDSParser does not support cubemap textures");if(6===c)throw new Error("DDSParser does not supported 3D texture data");const f=new Array,m=Cd+Md+Pd;if(1===d)f.push(new Uint8Array(t,m));else{const e=_d[p];let s=0,a=n,o=i;for(let t=0;t<r;t++)s+=Math.max(1,a+3&-4)*Math.max(1,o+3&-4)*e,a>>>=1,o>>>=1;let h=m;for(let i=0;i<d;i++)f.push(new Uint8Array(t,h,s)),h+=s}return f.map((t=>new Ad(t,{format:p,width:n,height:i,levels:r})))}if(o&Ld)throw new Error("DDSParser does not support uncompressed texture data.");if(o&Vd)throw new Error("DDSParser does not supported YUV uncompressed texture data.");if(o&$d)throw new Error("DDSParser does not support single-channel (lumninance) texture data!");if(o&Nd)throw new Error("DDSParser does not support single-channel (alpha) texture data!");throw new Error("DDSParser failed to load a texture file due to an unknown reason!")}(yield i.arrayBuffer()),r=n.map((i=>rd(new uh(i,l({mipmap:xr.OFF,alphaMode:vr.NO_PREMULTIPLIED_ALPHA,resolution:qo(t)},e.data)),s,t)));return 1===r.length?r[0]:r}))},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};Jo.add(tp);const ep={extension:{type:Ko.LoadParser,priority:ju.High},name:"loadKTX",test:t=>Bu(t,".ktx"),load(t,e,s){return p(this,null,(function*(){const i=yield Ar.ADAPTER.fetch(t),n=yield i.arrayBuffer(),{compressed:r,uncompressed:a,kvData:o}=Qd(t,n),h=null!=r?r:a,c=l({mipmap:xr.OFF,alphaMode:vr.NO_PREMULTIPLIED_ALPHA,resolution:qo(t)},e.data),u=h.map((e=>{h===a&&Object.assign(c,{type:e.type,format:e.format});const i=new uh(e,c);return i.ktxKeyValueData=o,rd(i,s,t)}));return 1===u.length?u[0]:u}))},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};Jo.add(ep);const sp={extension:Ko.ResolveParser,test:t=>{const e=t.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(e)},parse:t=>{var e,s,i,n;if("ktx"===t.split("?")[0].split(".").pop()){const i=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(i.some((e=>t.endsWith(e))))return{resolution:parseFloat(null!=(s=null==(e=Ar.RETINA_PREFIX.exec(t))?void 0:e[1])?s:"1"),format:i.find((e=>t.endsWith(e))),src:t}}return{resolution:parseFloat(null!=(n=null==(i=Ar.RETINA_PREFIX.exec(t))?void 0:i[1])?n:"1"),format:t.split(".").pop(),src:t}}};Jo.add(sp);const ip=new Mh,np=class{constructor(t){this.renderer=t}image(t,e,s){return p(this,null,(function*(){const i=new Image;return i.src=yield this.base64(t,e,s),i}))}base64(t,e,s){return p(this,null,(function*(){const i=this.canvas(t);if(void 0!==i.toBlob)return new Promise(((t,n)=>{i.toBlob((e=>{if(!e)return void n(new Error("ICanvas.toBlob failed!"));const s=new FileReader;s.onload=()=>t(s.result),s.onerror=n,s.readAsDataURL(e)}),e,s)}));if(void 0!==i.toDataURL)return i.toDataURL(e,s);if(void 0!==i.convertToBlob){const t=yield i.convertToBlob({type:e,quality:s});return new Promise(((e,s)=>{const i=new FileReader;i.onload=()=>e(i.result),i.onerror=s,i.readAsDataURL(t)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}))}canvas(t,e){const{pixels:s,width:i,height:n,flipY:r}=this._rawPixels(t,e);r&&np._flipY(s,i,n),np._unpremultiplyAlpha(s);const a=new Wo(i,n,1),o=new ImageData(new Uint8ClampedArray(s.buffer),i,n);return a.context.putImageData(o,0,0),a.canvas}pixels(t,e){const{pixels:s,width:i,height:n,flipY:r}=this._rawPixels(t,e);return r&&np._flipY(s,i,n),np._unpremultiplyAlpha(s),s}_rawPixels(t,e){const s=this.renderer;if(!s)throw new Error("The Extract has already been destroyed");let i,n,r=!1,a=!1;if(t&&(t instanceof Nl?n=t:(n=s.generateTexture(t,{resolution:s.resolution,multisample:s.multisample}),a=!0)),n){if(i=n.baseTexture.resolution,e=null!=e?e:n.frame,r=!1,!a){s.renderTexture.bind(n);const t=n.framebuffer.glFramebuffers[s.CONTEXT_UID];t.blitFramebuffer&&s.framebuffer.bind(t.blitFramebuffer)}}else i=s.resolution,e||((e=ip).width=s.width/i,e.height=s.height/i),r=!0,s.renderTexture.bind();const o=Math.round(e.width*i),h=Math.round(e.height*i),l=new Uint8Array(4*o*h),c=s.gl;return c.readPixels(Math.round(e.x*i),Math.round(e.y*i),o,h,c.RGBA,c.UNSIGNED_BYTE,l),a&&(null==n||n.destroy(!0)),{pixels:l,width:o,height:h,flipY:r}}destroy(){this.renderer=null}static _flipY(t,e,s){const i=e<<2,n=s>>1,r=new Uint8Array(i);for(let a=0;a<n;a++){const e=a*i,n=(s-a-1)*i;r.set(t.subarray(e,e+i)),t.copyWithin(e,n,n+i),t.set(r,n)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let s=0;s<e;s+=4){const e=t[s+3];if(0!==e){const i=255.001/e;t[s]=t[s]*i+.5,t[s+1]=t[s+1]*i+.5,t[s+2]=t[s+2]*i+.5}}}};let rp=np;rp.extension={name:"extract",type:Ko.RendererSystem},Jo.add(rp);const ap={build(t){const e=t.points;let s,i,n,r,a,o;if(t.type===Th.CIRC){const e=t.shape;s=e.x,i=e.y,a=o=e.radius,n=r=0}else if(t.type===Th.ELIP){const e=t.shape;s=e.x,i=e.y,a=e.width,o=e.height,n=r=0}else{const e=t.shape,h=e.width/2,l=e.height/2;s=e.x+h,i=e.y+l,a=o=Math.max(0,Math.min(e.radius,Math.min(h,l))),n=h-a,r=l-o}if(!(a>=0&&o>=0&&n>=0&&r>=0))return void(e.length=0);const h=Math.ceil(2.3*Math.sqrt(a+o)),l=8*h+(n?4:0)+(r?4:0);if(e.length=l,0===l)return;if(0===h)return e.length=8,e[0]=e[6]=s+n,e[1]=e[3]=i+r,e[2]=e[4]=s-n,void(e[5]=e[7]=i-r);let c=0,u=4*h+(n?2:0)+2,d=u,p=l;{const t=n+a,o=r,h=s+t,l=s-t,f=i+o;if(e[c++]=h,e[c++]=f,e[--u]=f,e[--u]=l,r){const t=i-o;e[d++]=l,e[d++]=t,e[--p]=t,e[--p]=h}}for(let f=1;f<h;f++){const t=Math.PI/2*(f/h),l=n+Math.cos(t)*a,m=r+Math.sin(t)*o,g=s+l,y=s-l,x=i+m,v=i-m;e[c++]=g,e[c++]=x,e[--u]=x,e[--u]=y,e[d++]=y,e[d++]=v,e[--p]=v,e[--p]=g}{const t=r+o,a=s+n,h=s-n,l=i+t,u=i-t;e[c++]=a,e[c++]=l,e[--p]=u,e[--p]=a,n&&(e[c++]=h,e[c++]=l,e[--p]=u,e[--p]=h)}},triangulate(t,e){const s=t.points,i=e.points,n=e.indices;if(0===s.length)return;let r=i.length/2;const a=r;let o,h;if(t.type!==Th.RREC){const e=t.shape;o=e.x,h=e.y}else{const e=t.shape;o=e.x+e.width/2,h=e.y+e.height/2}const l=t.matrix;i.push(t.matrix?l.a*o+l.c*h+l.tx:o,t.matrix?l.b*o+l.d*h+l.ty:h),r++,i.push(s[0],s[1]);for(let c=2;c<s.length;c+=2)i.push(s[c],s[c+1]),n.push(r++,a,r);n.push(a+1,a,r)}};function op(t,e=!1){const s=t.length;if(s<6)return;let i=0;for(let n=0,r=t[s-2],a=t[s-1];n<s;n+=2){const e=t[n],s=t[n+1];i+=(e-r)*(s+a),r=e,a=s}if(!e&&i>0||e&&i<=0){const e=s/2;for(let i=e+e%2;i<s;i+=2){const e=s-i-2,n=s-i-1,r=i,a=i+1;[t[e],t[r]]=[t[r],t[e]],[t[n],t[a]]=[t[a],t[n]]}}}const hp={build(t){t.points=t.shape.points.slice()},triangulate(t,e){let s=t.points;const i=t.holes,n=e.points,r=e.indices;if(s.length>=6){op(s,!1);const t=[];for(let n=0;n<i.length;n++){const e=i[n];op(e.points,!0),t.push(s.length/2),s=s.concat(e.points)}const e=jr(s,t,2);if(!e)return;const a=n.length/2;for(let s=0;s<e.length;s+=3)r.push(e[s]+a),r.push(e[s+1]+a),r.push(e[s+2]+a);for(let i=0;i<s.length;i++)n.push(s[i])}}},lp={build(t){const e=t.shape,s=e.x,i=e.y,n=e.width,r=e.height,a=t.points;a.length=0,n>=0&&r>=0&&a.push(s,i,s+n,i,s+n,i+r,s,i+r)},triangulate(t,e){const s=t.points,i=e.points;if(0===s.length)return;const n=i.length/2;i.push(s[0],s[1],s[2],s[3],s[6],s[7],s[4],s[5]),e.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},cp={build(t){ap.build(t)},triangulate(t,e){ap.triangulate(t,e)}};var up=(t=>(t.MITER="miter",t.BEVEL="bevel",t.ROUND="round",t))(up||{}),dp=(t=>(t.BUTT="butt",t.ROUND="round",t.SQUARE="square",t))(dp||{});const pp={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(t,e=20){if(!this.adaptive||!t||isNaN(t))return e;let s=Math.ceil(t/this.maxLength);return s<this.minSegments?s=this.minSegments:s>this.maxSegments&&(s=this.maxSegments),s}};class fp{static curveTo(t,e,s,i,n,r){const a=r[r.length-2],o=r[r.length-1]-e,h=a-t,l=i-e,c=s-t,u=Math.abs(o*c-h*l);if(u<1e-8||0===n)return r[r.length-2]===t&&r[r.length-1]===e||r.push(t,e),null;const d=o*o+h*h,p=l*l+c*c,f=o*l+h*c,m=n*Math.sqrt(d)/u,g=n*Math.sqrt(p)/u,y=m*f/d,x=g*f/p,v=m*c+g*h,_=m*l+g*o,b=h*(g+y),w=o*(g+y),E=c*(m+x),S=l*(m+x);return{cx:v+t,cy:_+e,radius:n,startAngle:Math.atan2(w-_,b-v),endAngle:Math.atan2(S-_,E-v),anticlockwise:h*l>c*o}}static arc(t,e,s,i,n,r,a,o,h){const l=a-r,c=pp._segmentsCount(Math.abs(l)*n,40*Math.ceil(Math.abs(l)/wh)),u=l/(2*c),d=2*u,p=Math.cos(u),f=Math.sin(u),m=c-1,g=m%1/m;for(let y=0;y<=m;++y){const t=u+r+d*(y+g*y),e=Math.cos(t),a=-Math.sin(t);h.push((p*e+f*a)*n+s,(p*-a+f*e)*n+i)}}}class mp{constructor(){this.reset()}begin(t,e,s){this.reset(),this.style=t,this.start=e,this.attribStart=s}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class gp{static curveLength(t,e,s,i,n,r,a,o){let h=0,l=0,c=0,u=0,d=0,p=0,f=0,m=0,g=0,y=0,x=0,v=t,_=e;for(let b=1;b<=10;++b)l=b/10,c=l*l,u=c*l,d=1-l,p=d*d,f=p*d,m=f*t+3*p*l*s+3*d*c*n+u*a,g=f*e+3*p*l*i+3*d*c*r+u*o,y=v-m,x=_-g,v=m,_=g,h+=Math.sqrt(y*y+x*x);return h}static curveTo(t,e,s,i,n,r,a){const o=a[a.length-2],h=a[a.length-1];a.length-=2;const l=pp._segmentsCount(gp.curveLength(o,h,t,e,s,i,n,r));let c=0,u=0,d=0,p=0,f=0;a.push(o,h);for(let m=1,g=0;m<=l;++m)g=m/l,c=1-g,u=c*c,d=u*c,p=g*g,f=p*g,a.push(d*o+3*u*g*t+3*c*p*s+f*n,d*h+3*u*g*e+3*c*p*i+f*r)}}function yp(t,e,s,i,n,r,a,o){let h,l;a?(h=i,l=-s):(h=-i,l=s);const c=t-s*n+h,u=e-i*n+l,d=t+s*r+h,p=e+i*r+l;return o.push(c,u,d,p),2}function xp(t,e,s,i,n,r,a,o){const h=s-t,l=i-e;let c=Math.atan2(h,l),u=Math.atan2(n-t,r-e);o&&c<u?c+=2*Math.PI:!o&&c>u&&(u+=2*Math.PI);let d=c;const p=u-c,f=Math.abs(p),m=Math.sqrt(h*h+l*l),g=1+(15*f*Math.sqrt(m)/Math.PI>>0),y=p/g;if(d+=y,o){a.push(t,e,s,i);for(let s=1,i=d;s<g;s++,i+=y)a.push(t,e,t+Math.sin(i)*m,e+Math.cos(i)*m);a.push(t,e,n,r)}else{a.push(s,i,t,e);for(let s=1,i=d;s<g;s++,i+=y)a.push(t+Math.sin(i)*m,e+Math.cos(i)*m,t,e);a.push(n,r,t,e)}return 2*g}function vp(t,e){t.lineStyle.native?function(t,e){let s=0;const i=t.shape,n=t.points||i.points,r=i.type!==Th.POLY||i.closeStroke;if(0===n.length)return;const a=e.points,o=e.indices,h=n.length/2,l=a.length/2;let c=l;for(a.push(n[0],n[1]),s=1;s<h;s++)a.push(n[2*s],n[2*s+1]),o.push(c,c+1),c++;r&&o.push(c,l)}(t,e):function(t,e){const s=t.shape;let i=t.points||s.points.slice();const n=e.closePointEps;if(0===i.length)return;const r=t.lineStyle,a=new Ah(i[0],i[1]),o=new Ah(i[i.length-2],i[i.length-1]),h=s.type!==Th.POLY||s.closeStroke,l=Math.abs(a.x-o.x)<n&&Math.abs(a.y-o.y)<n;if(h){i=i.slice(),l&&(i.pop(),i.pop(),o.set(i[i.length-2],i[i.length-1]));const t=.5*(a.x+o.x),e=.5*(o.y+a.y);i.unshift(t,e),i.push(t,e)}const c=e.points,u=i.length/2;let d=i.length;const p=c.length/2,f=r.width/2,m=f*f,g=r.miterLimit*r.miterLimit;let y=i[0],x=i[1],v=i[2],_=i[3],b=0,w=0,E=-(x-_),S=y-v,T=0,A=0,C=Math.sqrt(E*E+S*S);E/=C,S/=C,E*=f,S*=f;const M=r.alignment,I=2*(1-M),P=2*M;h||(r.cap===dp.ROUND?d+=xp(y-E*(I-P)*.5,x-S*(I-P)*.5,y-E*I,x-S*I,y+E*P,x+S*P,c,!0)+2:r.cap===dp.SQUARE&&(d+=yp(y,x,E,S,I,P,!0,c))),c.push(y-E*I,x-S*I,y+E*P,x+S*P);for(let D=1;D<u-1;++D){y=i[2*(D-1)],x=i[2*(D-1)+1],v=i[2*D],_=i[2*D+1],b=i[2*(D+1)],w=i[2*(D+1)+1],E=-(x-_),S=y-v,C=Math.sqrt(E*E+S*S),E/=C,S/=C,E*=f,S*=f,T=-(_-w),A=v-b,C=Math.sqrt(T*T+A*A),T/=C,A/=C,T*=f,A*=f;const t=v-y,e=x-_,s=v-b,n=w-_,a=t*s+e*n,o=e*s-n*t,h=o<0;if(Math.abs(o)<.001*Math.abs(a)){c.push(v-E*I,_-S*I,v+E*P,_+S*P),a>=0&&(r.join===up.ROUND?d+=xp(v,_,v-E*I,_-S*I,v-T*I,_-A*I,c,!1)+4:d+=2,c.push(v-T*P,_-A*P,v+T*I,_+A*I));continue}const l=(-E+y)*(-S+_)-(-E+v)*(-S+x),u=(-T+b)*(-A+_)-(-T+v)*(-A+w),p=(t*u-s*l)/o,M=(n*l-e*u)/o,R=(p-v)*(p-v)+(M-_)*(M-_),k=v+(p-v)*I,F=_+(M-_)*I,O=v-(p-v)*P,N=_-(M-_)*P,B=h?I:P,L=R<=Math.min(t*t+e*e,s*s+n*n)+B*B*m;let V=r.join;if(V===up.MITER&&R/m>g&&(V=up.BEVEL),L)switch(V){case up.MITER:c.push(k,F,O,N);break;case up.BEVEL:h?c.push(k,F,v+E*P,_+S*P,k,F,v+T*P,_+A*P):c.push(v-E*I,_-S*I,O,N,v-T*I,_-A*I,O,N),d+=2;break;case up.ROUND:h?(c.push(k,F,v+E*P,_+S*P),d+=xp(v,_,v+E*P,_+S*P,v+T*P,_+A*P,c,!0)+4,c.push(k,F,v+T*P,_+A*P)):(c.push(v-E*I,_-S*I,O,N),d+=xp(v,_,v-E*I,_-S*I,v-T*I,_-A*I,c,!1)+4,c.push(v-T*I,_-A*I,O,N))}else{switch(c.push(v-E*I,_-S*I,v+E*P,_+S*P),V){case up.MITER:h?c.push(O,N,O,N):c.push(k,F,k,F),d+=2;break;case up.ROUND:d+=h?xp(v,_,v+E*P,_+S*P,v+T*P,_+A*P,c,!0)+2:xp(v,_,v-E*I,_-S*I,v-T*I,_-A*I,c,!1)+2}c.push(v-T*I,_-A*I,v+T*P,_+A*P),d+=2}}y=i[2*(u-2)],x=i[2*(u-2)+1],v=i[2*(u-1)],_=i[2*(u-1)+1],E=-(x-_),S=y-v,C=Math.sqrt(E*E+S*S),E/=C,S/=C,E*=f,S*=f,c.push(v-E*I,_-S*I,v+E*P,_+S*P),h||(r.cap===dp.ROUND?d+=xp(v-E*(I-P)*.5,_-S*(I-P)*.5,v-E*I,_-S*I,v+E*P,_+S*P,c,!1)+2:r.cap===dp.SQUARE&&(d+=yp(v,_,E,S,I,P,!1,c)));const R=e.indices,k=pp.epsilon*pp.epsilon;for(let D=p;D<d+p-2;++D)y=c[2*D],x=c[2*D+1],v=c[2*(D+1)],_=c[2*(D+1)+1],b=c[2*(D+2)],w=c[2*(D+2)+1],Math.abs(y*(_-w)+v*(w-x)+b*(x-_))<k||R.push(D,D+1,D+2)}(t,e)}class _p{static curveLength(t,e,s,i,n,r){const a=t-2*s+n,o=e-2*i+r,h=2*s-2*t,l=2*i-2*e,c=4*(a*a+o*o),u=4*(a*h+o*l),d=h*h+l*l,p=2*Math.sqrt(c+u+d),f=Math.sqrt(c),m=2*c*f,g=2*Math.sqrt(d),y=u/f;return(m*p+f*u*(p-g)+(4*d*c-u*u)*Math.log((2*f+y+p)/(y+g)))/(4*m)}static curveTo(t,e,s,i,n){const r=n[n.length-2],a=n[n.length-1],o=pp._segmentsCount(_p.curveLength(r,a,t,e,s,i));let h=0,l=0;for(let c=1;c<=o;++c){const u=c/o;h=r+(t-r)*u,l=a+(e-a)*u,n.push(h+(t+(s-t)*u-h)*u,l+(e+(i-e)*u-l)*u)}}}const bp={[Th.POLY]:hp,[Th.CIRC]:ap,[Th.ELIP]:ap,[Th.RECT]:lp,[Th.RREC]:cp},wp=[],Ep=[];class Sp{constructor(t,e=null,s=null,i=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=s,this.fillStyle=e,this.matrix=i,this.type=t.type}clone(){return new Sp(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Tp=new Ah,Ap=class extends bh{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Jc,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Ep.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),wp.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,s=null,i=null){const n=new Sp(t,e,s,i);return this.graphicsData.push(n),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const s=new Sp(t,null,null,e),i=this.graphicsData[this.graphicsData.length-1];return s.lineStyle=i.lineStyle,i.holes.push(s),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let s=0;s<e.length;++s){const i=e[s];if(i.fillStyle.visible&&(i.shape&&(i.matrix?i.matrix.applyInverse(t,Tp):Tp.copyFrom(t),i.shape.contains(Tp.x,Tp.y)))){let t=!1;if(i.holes)for(let e=0;e<i.holes.length;e++){if(i.holes[e].shape.contains(Tp.x,Tp.y)){t=!0;break}}if(!t)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let s=null,i=null;this.batches.length>0&&(s=this.batches[this.batches.length-1],i=s.style);for(let o=this.shapeIndex;o<e.length;o++){this.shapeIndex++;const n=e[o],r=n.fillStyle,a=n.lineStyle;bp[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix),(r.visible||a.visible)&&this.processHoles(n.holes);for(let e=0;e<2;e++){const o=0===e?r:a;if(!o.visible)continue;const h=o.texture.baseTexture,l=this.indices.length,c=this.points.length/2;h.wrapMode=yr.REPEAT,0===e?this.processFill(n):this.processLine(n);const u=this.points.length/2-c;0!==u&&(s&&!this._compareStyles(i,o)&&(s.end(l,c),s=null),s||(s=wp.pop()||new mp,s.begin(o,l,c),this.batches.push(s),i=o),this.addUvs(this.points,t,o.texture,c,u,o.matrix))}}const n=this.indices.length,r=this.points.length/2;if(s&&s.end(n,r),0===this.batches.length)return void(this.batchable=!0);const a=r>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e)&&(t.texture.baseTexture===e.texture.baseTexture&&(t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native))}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const e=this.graphicsData[t],s=e.fillStyle,i=e.lineStyle;if(s&&!s.texture.baseTexture.valid)return!1;if(i&&!i.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,s=t.length;e<s;e++){const s=t[e];for(let t=0;t<s.size;t++){const e=s.start+t;this.indicesUint16[e]=this.indicesUint16[e]-s.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*Ap.BATCHABLE_SIZE}buildDrawCalls(){let t=++uh._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),Ep.push(this.drawCalls[c]);this.drawCalls.length=0;const e=this.colors,s=this.textureIds;let i=Ep.pop();i||(i=new dh,i.texArray=new yl),i.texArray.count=0,i.start=0,i.size=0,i.type=ur.TRIANGLES;let n=0,r=null,a=0,o=!1,h=ur.TRIANGLES,l=0;this.drawCalls.push(i);for(let c=0;c<this.batches.length;c++){const u=this.batches[c],d=8,p=u.style,f=p.texture.baseTexture;o!==!!p.native&&(o=!!p.native,h=o?ur.LINES:ur.TRIANGLES,r=null,n=d,t++),r!==f&&(r=f,f._batchEnabled!==t&&(n===d&&(t++,n=0,i.size>0&&(i=Ep.pop(),i||(i=new dh,i.texArray=new yl),this.drawCalls.push(i)),i.start=l,i.size=0,i.texArray.count=0,i.type=h),f.touched=1,f._batchEnabled=t,f._batchLocation=n,f.wrapMode=yr.REPEAT,i.texArray.elements[i.texArray.count++]=f,n++)),i.size+=u.size,l+=u.size,a=f._batchLocation,this.addColors(e,p.color,p.alpha,u.attribSize,u.attribStart),this.addTextureIds(s,a,u.attribSize,u.attribStart)}uh._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,s=this.colors,i=this.textureIds,n=new ArrayBuffer(3*t.length*4),r=new Float32Array(n),a=new Uint32Array(n);let o=0;for(let h=0;h<t.length/2;h++)r[o++]=t[2*h],r[o++]=t[2*h+1],r[o++]=e[2*h],r[o++]=e[2*h+1],a[o++]=s[h],r[o++]=i[h];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(t){if(t.holes.length)hp.triangulate(t,this);else{bp[t.type].triangulate(t,this)}}processLine(t){vp(t,this);for(let e=0;e<t.holes.length;e++)vp(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const s=t[e];bp[s.type].build(s),s.matrix&&this.transformPoints(s.points,s.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let s=0;s<t.length/2;s++){const i=t[2*s],n=t[2*s+1];t[2*s]=e.a*i+e.c*n+e.tx,t[2*s+1]=e.b*i+e.d*n+e.ty}}addColors(t,e,s,i,n=0){const r=Ao.shared.setValue(e).toLittleEndianNumber(),a=Ao.shared.setValue(r).toPremultiplied(s);t.length=Math.max(t.length,n+i);for(let o=0;o<i;o++)t[n+o]=a}addTextureIds(t,e,s,i=0){t.length=Math.max(t.length,i+s);for(let n=0;n<s;n++)t[i+n]=e}addUvs(t,e,s,i,n,r=null){let a=0;const o=e.length,h=s.frame;for(;a<n;){let s=t[2*(i+a)],n=t[2*(i+a)+1];if(r){const t=r.a*s+r.c*n+r.tx;n=r.b*s+r.d*n+r.ty,s=t}a++,e.push(s/h.width,n/h.height)}const l=s.baseTexture;(h.width<l.width||h.height<l.height)&&this.adjustUvs(e,s,o,n)}adjustUvs(t,e,s,i){const n=e.baseTexture,r=1e-6,a=s+2*i,o=e.frame,h=o.width/n.width,l=o.height/n.height;let c=o.x/o.width,u=o.y/o.height,d=Math.floor(t[s]+r),p=Math.floor(t[s+1]+r);for(let f=s+2;f<a;f+=2)d=Math.min(d,Math.floor(t[f]+r)),p=Math.min(p,Math.floor(t[f+1]+r));c-=d,u-=p;for(let f=s;f<a;f+=2)t[f]=(t[f]+c)*h,t[f+1]=(t[f+1]+u)*l}};let Cp=Ap;Cp.BATCHABLE_SIZE=100;class Mp{constructor(){this.color=16777215,this.alpha=1,this.texture=Ol.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Mp;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Ol.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Ip extends Mp{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=dp.BUTT,this.join=up.MITER,this.miterLimit=10}clone(){const t=new Ip;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const Pp={},Rp=class extends ru{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Mp,this._lineStyle=new Ip,this._matrix=null,this._holeMode=!1,this.state=ih.for2d(),this._geometry=t||new Cp,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Ao(16777215),this.blendMode=cr.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Rp(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,s,i=.5,n=!1){return"number"==typeof t&&(t={width:t,color:e,alpha:s,alignment:i,native:n}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:Ol.WHITE,color:(null==t?void 0:t.texture)?16777215:0,matrix:null,alignment:.5,native:!1,cap:dp.BUTT,join:up.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const s=t.width>0&&t.alpha>0;return s?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:s},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Rh,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Rh,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const s=this.currentPath.points,i=s[s.length-2],n=s[s.length-1];return i===t&&n===e||s.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,s,i){this._initCurve();const n=this.currentPath.points;return 0===n.length&&this.moveTo(0,0),_p.curveTo(t,e,s,i,n),this}bezierCurveTo(t,e,s,i,n,r){return this._initCurve(),gp.curveTo(t,e,s,i,n,r,this.currentPath.points),this}arcTo(t,e,s,i,n){this._initCurve(t,e);const r=this.currentPath.points,a=fp.curveTo(t,e,s,i,n,r);if(a){const{cx:t,cy:e,radius:s,startAngle:i,endAngle:n,anticlockwise:r}=a;this.arc(t,e,s,i,n,r)}return this}arc(t,e,s,i,n,r=!1){if(i===n)return this;!r&&n<=i?n+=wh:r&&i<=n&&(i+=wh);if(0===n-i)return this;const a=t+Math.cos(i)*s,o=e+Math.sin(i)*s,h=this._geometry.closePointEps;let l=this.currentPath?this.currentPath.points:null;if(l){const t=Math.abs(l[l.length-2]-a),e=Math.abs(l[l.length-1]-o);t<h&&e<h||l.push(a,o)}else this.moveTo(a,o),l=this.currentPath.points;return fp.arc(a,o,t,e,s,i,n,r,l),this}beginFill(t=0,e){return this.beginTextureFill({texture:Ol.WHITE,color:t,alpha:e})}normalizeColor(t){var e;const s=Ao.shared.setValue(null!=(e=t.color)?e:0);t.color=s.toNumber(),null!=t.alpha||(t.alpha=s.alpha)}beginTextureFill(t){const e={texture:Ol.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const s=t.alpha>0;return s?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:s},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,s,i){return this.drawShape(new Mh(t,e,s,i))}drawRoundedRect(t,e,s,i,n){return this.drawShape(new kh(t,e,s,i,n))}drawCircle(t,e,s){return this.drawShape(new Ih(t,e,s))}drawEllipse(t,e,s,i){return this.drawShape(new Ph(t,e,s,i))}drawPolygon(...t){let e,s=!0;const i=t[0];i.points?(s=i.closeStroke,e=i.points):e=Array.isArray(t[0])?t[0]:t;const n=new Rh(e);return n.closeStroke=s,this.drawShape(n),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==Th.RECT||t[0].matrix||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,s=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=s,this.vertexData=new Float32Array(t.points);for(let i=0;i<s;i++){const s=t.batches[i],n=s.style.color,r=new Float32Array(this.vertexData.buffer,4*s.attribStart*2,2*s.attribSize),a=new Float32Array(t.uvsFloat32.buffer,4*s.attribStart*2,2*s.attribSize),o={vertexData:r,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*s.start,s.size),uvs:a,_batchRGB:Ao.shared.setValue(n).toRgbArray(),_tintRGB:n,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[i]=o}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,s=this.batches.length;e<s;e++){const s=this.batches[e];s.worldAlpha=this.worldAlpha*s.alpha,t.plugins[this.pluginName].render(s)}}}_renderDirect(t){const e=this._resolveDirectShader(t),s=this._geometry,i=this.worldAlpha,n=e.uniforms,r=s.drawCalls;n.translationMatrix=this.transform.worldTransform,Ao.shared.setValue(this._tintColor).premultiply(i).toArray(n.tint),t.shader.bind(e),t.geometry.bind(s,e),t.state.set(this.state);for(let a=0,o=r.length;a<o;a++)this._renderDrawCallDirect(t,s.drawCalls[a])}_renderDrawCallDirect(t,e){const{texArray:s,type:i,size:n,start:r}=e,a=s.count;for(let o=0;o<a;o++)t.texture.bind(s.elements[o],o);t.geometry.draw(i,n,r)}_resolveDirectShader(t){let e=this.shader;const s=this.pluginName;if(!e){if(!Pp[s]){const{maxTextures:e}=t.plugins[s],i=new Int32Array(e);for(let t=0;t<e;t++)i[t]=t;const n={tint:new Float32Array([1,1,1,1]),translationMatrix:new Dh,default:fl.from({uSamplers:i},!0)},r=t.plugins[s]._shader.program;Pp[s]=new ml(r,n)}e=Pp[s]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:s,maxX:i,maxY:n}=t.bounds;this._bounds.addFrame(this.transform,e,s,i,n)}containsPoint(t){return this.worldTransform.applyInverse(t,Rp._TEMP_POINT),this._geometry.containsPoint(Rp._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=Ao.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,s=e.a,i=e.b,n=e.c,r=e.d,a=e.tx,o=e.ty,h=this._geometry.points,l=this.vertexData;let c=0;for(let u=0;u<h.length;u+=2){const t=h[u],e=h[u+1];l[c++]=s*t+n*e+a,l[c++]=r*e+i*t+o}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};let kp=Rp;kp.curves=pp,kp._TEMP_POINT=new Ah;class Dp{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const Fp=new Ah,Op=new Rh,Np=class extends ru{constructor(t,e,s,i=ur.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=s||ih.for2d(),this.drawMode=i,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=Ar.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===ur.TRIANGLES&&e.length<2*Np.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,s=this.shader;s.uvMatrix&&(s.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=s._tintRGB,this._texture=s.texture;const i=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[i]),t.plugins[i].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,s=t._updateID;if(s===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const i=this.transform.worldTransform,n=i.a,r=i.b,a=i.c,o=i.d,h=i.tx,l=i.ty,c=this.vertexData;for(let u=0;u<c.length/2;u++){const t=e[2*u],s=e[2*u+1];c[2*u]=n*t+a*s+h,c[2*u+1]=r*t+o*s+l}if(this._roundPixels){const t=Ar.RESOLUTION;for(let e=0;e<c.length;++e)c[e]=Math.round(c[e]*t)/t}this.vertexDirty=s}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new Dp(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,Fp);const e=this.geometry.getBuffer("aVertexPosition").data,s=Op.points,i=this.geometry.getIndex().data,n=i.length,r=4===this.drawMode?3:1;for(let a=0;a+2<n;a+=r){const t=2*i[a],n=2*i[a+1],r=2*i[a+2];if(s[0]=e[t],s[1]=e[t+1],s[2]=e[n],s[3]=e[n+1],s[4]=e[r],s[5]=e[r+1],Op.contains(Fp.x,Fp.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let Bp=Np;Bp.BATCHABLE_SIZE=100;class Lp extends _h{constructor(t,e,s){super();const i=new fh(t),n=new fh(e,!0),r=new fh(s,!0,!0);this.addAttribute("aVertexPosition",i,2,!1,fr.FLOAT).addAttribute("aTextureCoord",n,2,!1,fr.FLOAT).addIndex(r),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class Vp extends ml{constructor(t,e){const s={uSampler:t,alpha:1,uTextureMatrix:Dh.IDENTITY,uColor:new Float32Array([1,1,1,1])};(e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e)).uniforms&&Object.assign(s,e.uniforms),super(e.program||dl.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),s),this._colorDirty=!1,this.uvMatrix=new Kl(t),this.batchable=void 0===e.program,this.pluginName=e.pluginName,this._tintColor=new Ao(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;Ao.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class $p extends Bp{constructor(t=Ol.EMPTY,e,s,i,n){const r=new Lp(e,s,i);r.getBuffer("aVertexPosition").static=!1;super(r,new Vp(t),null,n),this.autoUpdate=!0}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}_render(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),super._render(t)}}class Up extends ru{constructor(t=1500,e,s=16384,i=!1){super();s>16384&&(s=16384),this._properties=[!1,!0,!1,!1,!1],this._maxSize=t,this._batchSize=s,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=cr.NORMAL,this.autoResize=i,this.roundPixels=!0,this.baseTexture=null,this.setProperties(e),this._tintColor=new Ao(0),this.tintRgb=new Float32Array(3),this.tint=16777215}setProperties(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintColor.toRgbArray(this.tintRgb)}render(t){this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",(()=>this.onChildrenChange(0)))),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))}onChildrenChange(t){const e=Math.floor(t/this._batchSize);for(;this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID}dispose(){if(this._buffers){for(let t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}}destroy(t){super.destroy(t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}}class Xp{constructor(t,e,s){this.geometry=new _h,this.indexBuffer=null,this.size=s,this.dynamicProperties=[],this.staticProperties=[];for(let i=0;i<t.length;++i){let s=t[i];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||fr.FLOAT,offset:s.offset},e[i]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new fh(function(t,e=null){const s=6*t;if((e=e||new Uint16Array(s)).length!==s)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${s}`);for(let i=0,n=0;i<s;i+=6,n+=4)e[i+0]=n+0,e[i+1]=n+1,e[i+2]=n+2,e[i+3]=n+0,e[i+4]=n+2,e[i+5]=n+3;return e}(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let r=0;r<this.dynamicProperties.length;++r){const t=this.dynamicProperties[r];t.offset=e,e+=t.size,this.dynamicStride+=t.size}const s=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(s),this.dynamicDataUint32=new Uint32Array(s),this.dynamicBuffer=new fh(this.dynamicData,!1,!1);let i=0;this.staticStride=0;for(let r=0;r<this.staticProperties.length;++r){const t=this.staticProperties[r];t.offset=i,i+=t.size,this.staticStride+=t.size}const n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new fh(this.staticData,!0,!1);for(let r=0;r<this.dynamicProperties.length;++r){const e=this.dynamicProperties[r];t.addAttribute(e.attributeName,this.dynamicBuffer,0,e.type===fr.UNSIGNED_BYTE,e.type,4*this.dynamicStride,4*e.offset)}for(let r=0;r<this.staticProperties.length;++r){const e=this.staticProperties[r];t.addAttribute(e.attributeName,this.staticBuffer,0,e.type===fr.UNSIGNED_BYTE,e.type,4*this.staticStride,4*e.offset)}}uploadDynamic(t,e,s){for(let i=0;i<this.dynamicProperties.length;i++){const n=this.dynamicProperties[i];n.uploadFunction(t,e,s,n.type===fr.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,s){for(let i=0;i<this.staticProperties.length;i++){const n=this.staticProperties[i];n.uploadFunction(t,e,s,n.type===fr.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class Yp extends xl{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new Dh,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:fr.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=ml.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=ih.for2d()}render(t){const e=t.children,s=t._maxSize,i=t._batchSize,n=this.renderer;let r=e.length;if(0===r)return;r>s&&!t.autoResize&&(r=s);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));const o=e[0]._texture.baseTexture,h=o.alphaMode>0;this.state.blendMode=Po(t.blendMode,h),n.state.set(this.state);const l=n.gl,c=t.worldTransform.copyTo(this.tempMatrix);c.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=Ao.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=o,this.renderer.shader.bind(this.shader);let u=!1;for(let d=0,p=0;d<r;d+=i,p+=1){let s=r-d;s>i&&(s=i),p>=a.length&&a.push(this._generateOneMoreBuffer(t));const o=a[p];o.uploadDynamic(e,d,s);const h=t._bufferUpdateIDs[p]||0;u=u||o._updateID<h,u&&(o._updateID=t._updateID,o.uploadStatic(e,d,s)),n.geometry.bind(o.geometry),l.drawElements(l.TRIANGLES,6*s,l.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],s=t._maxSize,i=t._batchSize,n=t._properties;for(let r=0;r<s;r+=i)e.push(new Xp(this.properties,n,i));return e}_generateOneMoreBuffer(t){const e=t._batchSize,s=t._properties;return new Xp(this.properties,s,e)}uploadVertices(t,e,s,i,n,r){let a=0,o=0,h=0,l=0;for(let c=0;c<s;++c){const s=t[e+c],u=s._texture,d=s.scale.x,p=s.scale.y,f=u.trim,m=u.orig;f?(o=f.x-s.anchor.x*m.width,a=o+f.width,l=f.y-s.anchor.y*m.height,h=l+f.height):(a=m.width*(1-s.anchor.x),o=m.width*-s.anchor.x,h=m.height*(1-s.anchor.y),l=m.height*-s.anchor.y),i[r]=o*d,i[r+1]=l*p,i[r+n]=a*d,i[r+n+1]=l*p,i[r+2*n]=a*d,i[r+2*n+1]=h*p,i[r+3*n]=o*d,i[r+3*n+1]=h*p,r+=4*n}}uploadPosition(t,e,s,i,n,r){for(let a=0;a<s;a++){const s=t[e+a].position;i[r]=s.x,i[r+1]=s.y,i[r+n]=s.x,i[r+n+1]=s.y,i[r+2*n]=s.x,i[r+2*n+1]=s.y,i[r+3*n]=s.x,i[r+3*n+1]=s.y,r+=4*n}}uploadRotation(t,e,s,i,n,r){for(let a=0;a<s;a++){const s=t[e+a].rotation;i[r]=s,i[r+n]=s,i[r+2*n]=s,i[r+3*n]=s,r+=4*n}}uploadUvs(t,e,s,i,n,r){for(let a=0;a<s;++a){const s=t[e+a]._texture._uvs;s?(i[r]=s.x0,i[r+1]=s.y0,i[r+n]=s.x1,i[r+n+1]=s.y1,i[r+2*n]=s.x2,i[r+2*n+1]=s.y2,i[r+3*n]=s.x3,i[r+3*n+1]=s.y3,r+=4*n):(i[r]=0,i[r+1]=0,i[r+n]=0,i[r+n+1]=0,i[r+2*n]=0,i[r+2*n+1]=0,i[r+3*n]=0,i[r+3*n+1]=0,r+=4*n)}}uploadTint(t,e,s,i,n,r){for(let a=0;a<s;++a){const s=t[e+a],o=Ao.shared.setValue(s._tintRGB).toPremultiplied(s.alpha,s.texture.baseTexture.alphaMode>0);i[r]=o,i[r+n]=o,i[r+2*n]=o,i[r+3*n]=o,r+=4*n}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Yp.extension={name:"particle",type:Ko.RendererPlugin},Jo.add(Yp);var Wp=(t=>(t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",t))(Wp||{});const jp={willReadFrequently:!0},Gp=class{static get experimentalLetterSpacingSupported(){let t=Gp._experimentalLetterSpacingSupported;if(void 0!==t){const e=Ar.ADAPTER.getCanvasRenderingContext2D().prototype;t=Gp._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,s,i,n,r,a,o,h){this.text=t,this.style=e,this.width=s,this.height=i,this.lines=n,this.lineWidths=r,this.lineHeight=a,this.maxLineWidth=o,this.fontProperties=h}static measureText(t,e,s,i=Gp._canvas){s=null==s?e.wordWrap:s;const n=e.toFontString(),r=Gp.measureFont(n);0===r.fontSize&&(r.fontSize=e.fontSize,r.ascent=e.fontSize);const a=i.getContext("2d",jp);a.font=n;const o=(s?Gp.wordWrap(t,e,i):t).split(/(?:\r\n|\r|\n)/),h=new Array(o.length);let l=0;for(let p=0;p<o.length;p++){const t=Gp._measureText(o[p],e.letterSpacing,a);h[p]=t,l=Math.max(l,t)}let c=l+e.strokeThickness;e.dropShadow&&(c+=e.dropShadowDistance);const u=e.lineHeight||r.fontSize+e.strokeThickness;let d=Math.max(u,r.fontSize+2*e.strokeThickness)+(o.length-1)*(u+e.leading);return e.dropShadow&&(d+=e.dropShadowDistance),new Gp(t,e,c,d,o,h,u+e.leading,l,r)}static _measureText(t,e,s){let i=!1;Gp.experimentalLetterSpacingSupported&&(Gp.experimentalLetterSpacing?(s.letterSpacing=`${e}px`,s.textLetterSpacing=`${e}px`,i=!0):(s.letterSpacing="0px",s.textLetterSpacing="0px"));let n=s.measureText(t).width;return n>0&&(i?n-=e:n+=(Gp.graphemeSegmenter(t).length-1)*e),n}static wordWrap(t,e,s=Gp._canvas){const i=s.getContext("2d",jp);let n=0,r="",a="";const o=Object.create(null),{letterSpacing:h,whiteSpace:l}=e,c=Gp.collapseSpaces(l),u=Gp.collapseNewlines(l);let d=!c;const p=e.wordWrapWidth+h,f=Gp.tokenize(t);for(let m=0;m<f.length;m++){let t=f[m];if(Gp.isNewline(t)){if(!u){a+=Gp.addLine(r),d=!c,r="",n=0;continue}t=" "}if(c){const e=Gp.isBreakingSpace(t),s=Gp.isBreakingSpace(r[r.length-1]);if(e&&s)continue}const s=Gp.getFromCache(t,h,o,i);if(s>p)if(""!==r&&(a+=Gp.addLine(r),r="",n=0),Gp.canBreakWords(t,e.breakWords)){const s=Gp.wordWrapSplit(t);for(let l=0;l<s.length;l++){let c=s[l],u=c,f=1;for(;s[l+f];){const i=s[l+f];if(Gp.canBreakChars(u,i,t,l,e.breakWords))break;c+=i,u=i,f++}l+=f-1;const m=Gp.getFromCache(c,h,o,i);m+n>p&&(a+=Gp.addLine(r),d=!1,r="",n=0),r+=c,n+=m}}else{r.length>0&&(a+=Gp.addLine(r),r="",n=0);const e=m===f.length-1;a+=Gp.addLine(t,!e),d=!1,r="",n=0}else s+n>p&&(d=!1,a+=Gp.addLine(r),r="",n=0),(r.length>0||!Gp.isBreakingSpace(t)||d)&&(r+=t,n+=s)}return a+=Gp.addLine(r,!1),a}static addLine(t,e=!0){return t=Gp.trimRight(t),t=e?`${t}\n`:t}static getFromCache(t,e,s,i){let n=s[t];return"number"!=typeof n&&(n=Gp._measureText(t,e,i)+e,s[t]=n),n}static collapseSpaces(t){return"normal"===t||"pre-line"===t}static collapseNewlines(t){return"normal"===t}static trimRight(t){if("string"!=typeof t)return"";for(let e=t.length-1;e>=0;e--){const s=t[e];if(!Gp.isBreakingSpace(s))break;t=t.slice(0,-1)}return t}static isNewline(t){return"string"==typeof t&&Gp._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return"string"==typeof t&&Gp._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let s="";if("string"!=typeof t)return e;for(let i=0;i<t.length;i++){const n=t[i],r=t[i+1];Gp.isBreakingSpace(n,r)||Gp.isNewline(n)?(""!==s&&(e.push(s),s=""),e.push(n)):s+=n}return""!==s&&e.push(s),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,s,i,n){return!0}static wordWrapSplit(t){return Gp.graphemeSegmenter(t)}static measureFont(t){if(Gp._fonts[t])return Gp._fonts[t];const e={ascent:0,descent:0,fontSize:0},s=Gp._canvas,i=Gp._context;i.font=t;const n=Gp.METRICS_STRING+Gp.BASELINE_SYMBOL,r=Math.ceil(i.measureText(n).width);let a=Math.ceil(i.measureText(Gp.BASELINE_SYMBOL).width);const o=Math.ceil(Gp.HEIGHT_MULTIPLIER*a);if(a=a*Gp.BASELINE_MULTIPLIER|0,0===r||0===o)return Gp._fonts[t]=e,e;s.width=r,s.height=o,i.fillStyle="#f00",i.fillRect(0,0,r,o),i.font=t,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(n,0,a);const h=i.getImageData(0,0,r,o).data,l=h.length,c=4*r;let u=0,d=0,p=!1;for(u=0;u<a;++u){for(let t=0;t<c;t+=4)if(255!==h[d+t]){p=!0;break}if(p)break;d+=c}for(e.ascent=a-u,d=l-c,p=!1,u=o;u>a;--u){for(let t=0;t<c;t+=4)if(255!==h[d+t]){p=!0;break}if(p)break;d-=c}return e.descent=u-a,e.fontSize=e.ascent+e.descent,Gp._fonts[t]=e,e}static clearMetrics(t=""){t?delete Gp._fonts[t]:Gp._fonts={}}static get _canvas(){if(!Gp.__canvas){let e;try{const t=new OffscreenCanvas(0,0),s=t.getContext("2d",jp);if(null==s?void 0:s.measureText)return Gp.__canvas=t,t;e=Ar.ADAPTER.createCanvas()}catch(t){e=Ar.ADAPTER.createCanvas()}e.width=e.height=10,Gp.__canvas=e}return Gp.__canvas}static get _context(){return Gp.__context||(Gp.__context=Gp._canvas.getContext("2d",jp)),Gp.__context}};let zp=Gp;zp.METRICS_STRING="|ÉqÅ",zp.BASELINE_SYMBOL="M",zp.BASELINE_MULTIPLIER=1.4,zp.HEIGHT_MULTIPLIER=2,zp.graphemeSegmenter=(()=>{if("function"==typeof(null==Intl?void 0:Intl.Segmenter)){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map((t=>t.segment))}return t=>[...t]})(),zp.experimentalLetterSpacing=!1,zp._fonts={},zp._newlines=[10,13],zp._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const Hp=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],qp=class{constructor(t){this.styleID=0,this.reset(),Qp(this,t,t)}clone(){const t={};return Qp(t,this,qp.defaultStyle),new qp(t)}reset(){Qp(this,qp.defaultStyle,qp.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=Zp(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=Zp(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=Zp(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let s=e.length-1;s>=0;s--){let t=e[s].trim();/([\"\'])[^\'\"]+\1/.test(t)||Hp.includes(t)||(t=`"${t}"`),e[s]=t}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};let Kp=qp;function Zp(t){const e=Ao.shared;return Array.isArray(t)?t.map((t=>e.setValue(t).toHex())):e.setValue(t).toHex()}function Qp(t,e,s){for(const i in s)Array.isArray(e[i])?t[i]=e[i].slice():t[i]=e[i]}Kp.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Wp.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};const Jp={texture:!0,children:!1,baseTexture:!0},tf=class extends hu{constructor(t,e,s){var i;let n=!1;s||(s=Ar.ADAPTER.createCanvas(),n=!0),s.width=3,s.height=3;const r=Ol.from(s);r.orig=new Mh,r.trim=new Mh,super(r),this._ownCanvas=n,this.canvas=s,this.context=s.getContext("2d",{willReadFrequently:!0}),this._resolution=null!=(i=tf.defaultResolution)?i:Ar.RESOLUTION,this._autoResolution=tf.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return zp.experimentalLetterSpacing}static set experimentalLetterSpacing(t){za("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),zp.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const s=this.context,i=zp.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=i.width,r=i.height,a=i.lines,o=i.lineHeight,h=i.lineWidths,l=i.maxLineWidth,c=i.fontProperties;let u,d;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,r)+2*e.padding)*this._resolution),s.scale(this._resolution,this._resolution),s.clearRect(0,0,this.canvas.width,this.canvas.height),s.font=this._font,s.lineWidth=e.strokeThickness,s.textBaseline=e.textBaseline,s.lineJoin=e.lineJoin,s.miterLimit=e.miterLimit;const p=e.dropShadow?2:1;for(let f=0;f<p;++f){const t=e.dropShadow&&0===f,n=t?Math.ceil(Math.max(1,r)+2*e.padding):0,p=n*this._resolution;if(t){s.fillStyle="black",s.strokeStyle="black";const t=e.dropShadowColor,i=e.dropShadowBlur*this._resolution,n=e.dropShadowDistance*this._resolution;s.shadowColor=Ao.shared.setValue(t).setAlpha(e.dropShadowAlpha).toRgbaString(),s.shadowBlur=i,s.shadowOffsetX=Math.cos(e.dropShadowAngle)*n,s.shadowOffsetY=Math.sin(e.dropShadowAngle)*n+p}else s.fillStyle=this._generateFillStyle(e,a,i),s.strokeStyle=e.stroke,s.shadowColor="black",s.shadowBlur=0,s.shadowOffsetX=0,s.shadowOffsetY=0;let m=(o-c.fontSize)/2;o-c.fontSize<0&&(m=0);for(let s=0;s<a.length;s++)u=e.strokeThickness/2,d=e.strokeThickness/2+s*o+c.ascent+m,"right"===e.align?u+=l-h[s]:"center"===e.align&&(u+=(l-h[s])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(a[s],u+e.padding,d+e.padding-n,!0),e.fill&&this.drawLetterSpacing(a[s],u+e.padding,d+e.padding-n)}this.updateTexture()}drawLetterSpacing(t,e,s,i=!1){const n=this._style.letterSpacing;let r=!1;if(zp.experimentalLetterSpacingSupported&&(zp.experimentalLetterSpacing?(this.context.letterSpacing=`${n}px`,this.context.textLetterSpacing=`${n}px`,r=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===n||r)return void(i?this.context.strokeText(t,e,s):this.context.fillText(t,e,s));let a=e;const o=zp.graphemeSegmenter(t);let h=this.context.measureText(t).width,l=0;for(let c=0;c<o.length;++c){const t=o[c];i?this.context.strokeText(t,a,s):this.context.fillText(t,a,s);let e="";for(let s=c+1;s<o.length;++s)e+=o[s];l=this.context.measureText(e).width,a+=h-l+n,h=l}}updateTexture(){const t=this.canvas;if(this._style.trim){const e=zo(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}const e=this._texture,s=this._style,i=s.trim?0:s.padding,n=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-i,e.trim.y=-i,e.orig.width=e._frame.width-2*i,e.orig.height=e._frame.height-2*i,this._onTextureUpdate(),n.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),-1===this._textureID&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,s){const i=t.fill;if(!Array.isArray(i))return i;if(1===i.length)return i[0];let n;const r=t.dropShadow?t.dropShadowDistance:0,a=t.padding||0,o=this.canvas.width/this._resolution-r-2*a,h=this.canvas.height/this._resolution-r-2*a,l=i.slice(),c=t.fillGradientStops.slice();if(!c.length){const t=l.length+1;for(let e=1;e<t;++e)c.push(e/t)}if(l.unshift(i[0]),c.unshift(0),l.push(i[i.length-1]),c.push(1),t.fillGradientType===Wp.LINEAR_VERTICAL){n=this.context.createLinearGradient(o/2,a,o/2,h+a);const i=s.fontProperties.fontSize+t.strokeThickness;for(let t=0;t<e.length;t++){const r=s.lineHeight*(t-1)+i,a=s.lineHeight*t;let o=a;t>0&&r>a&&(o=(a+r)/2);const u=a+i,d=s.lineHeight*(t+1);let p=u;t+1<e.length&&d<u&&(p=(u+d)/2);const f=(p-o)/h;for(let t=0;t<l.length;t++){let e=0;e="number"==typeof c[t]?c[t]:t/l.length;let s=Math.min(1,Math.max(0,o/h+e*f));s=Number(s.toFixed(5)),n.addColorStop(s,l[t])}}}else{n=this.context.createLinearGradient(a,h/2,o+a,h/2);const t=l.length+1;let e=1;for(let s=0;s<l.length;s++){let i;i="number"==typeof c[s]?c[s]:e/t,n.addColorStop(i,l[s]),e++}}return n}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},Jp,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=No(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=No(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},this._style=t instanceof Kp?t:new Kp(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};let ef=tf;ef.defaultAutoResolution=!0;class sf{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function nf(t,e){var s;let i=!1;if(null==(s=null==t?void 0:t._textures)?void 0:s.length)for(let n=0;n<t._textures.length;n++)if(t._textures[n]instanceof Ol){const s=t._textures[n].baseTexture;e.includes(s)||(e.push(s),i=!0)}return i}function rf(t,e){if(t.baseTexture instanceof uh){const s=t.baseTexture;return e.includes(s)||e.push(s),!0}return!1}function af(t,e){if(t._texture&&t._texture instanceof Ol){const s=t._texture.baseTexture;return e.includes(s)||e.push(s),!0}return!1}function of(t,e){return e instanceof ef&&(e.updateText(!0),!0)}function hf(t,e){if(e instanceof Kp){const t=e.toFontString();return zp.measureFont(t),!0}return!1}function lf(t,e){if(t instanceof ef){e.includes(t.style)||e.push(t.style),e.includes(t)||e.push(t);const s=t._texture.baseTexture;return e.includes(s)||e.push(s),!0}return!1}function cf(t,e){return t instanceof Kp&&(e.includes(t)||e.push(t),!0)}const uf=class{constructor(t){this.limiter=new sf(uf.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(lf),this.registerFindHook(cf),this.registerFindHook(nf),this.registerFindHook(rf),this.registerFindHook(af),this.registerUploadHook(of),this.registerUploadHook(hf)}upload(t){return new Promise((e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Oc.system.addOnce(this.tick,this,kc.UTILITY))):e()}))}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed)for(let s=0,i=this.uploadHooks.length;s<i;s++)if(this.uploadHooks[s](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)Oc.system.addOnce(this.tick,this,kc.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,s=t.length;e<s;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,s=this.addHooks.length;e<s&&!this.addHooks[e](t,this.queue);e++);if(t instanceof ru)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&Oc.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let df=uf;function pf(t,e){return e instanceof uh&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function ff(t,e){if(!(e instanceof kp))return!1;const{geometry:s}=e;e.finishPoly(),s.updateBatches();const{batches:i}=s;for(let n=0;n<i.length;n++){const{texture:e}=i[n].style;e&&pf(t,e.baseTexture)}return s.batchable||t.geometry.bind(s,e._resolveDirectShader(t)),!0}function mf(t,e){return t instanceof kp&&(e.push(t),!0)}df.uploadsPerFrame=4,Object.defineProperties(Ar,{UPLOADS_PER_FRAME:{get:()=>df.uploadsPerFrame,set(t){za("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),df.uploadsPerFrame=t}}});class gf extends df{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(mf),this.registerUploadHook(pf),this.registerUploadHook(ff)}}gf.extension={name:"prepare",type:Ko.RendererSystem},Jo.add(gf);class yf extends hu{constructor(t,e=!0){super(t[0]instanceof Ol?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=e,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Oc.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Oc.shared.add(this.update,this,kc.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const e=this.animationSpeed*t,s=this.currentFrame;if(null!==this._durations){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=e/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];const i=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):s!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<s||this.animationSpeed<0&&this.currentFrame>s)&&this.onLoop(),this.updateTexture())}updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t){this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const e=[];for(let s=0;s<t.length;++s)e.push(Ol.from(t[s]));return new yf(e)}static fromImages(t){const e=[];for(let s=0;s<t.length;++s)e.push(Ol.from(t[s]));return new yf(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof Ol)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Oc.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Oc.shared.add(this.update,this),this._isConnectedToTicker=!0))}}var xf="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const vf=new Dh;class _f extends xl{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Vl,this.state=ih.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=ml.from(xf,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",e),this.shader=t.context.webGLVersion>1?ml.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",e):ml.from(xf,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",e)}render(t){const e=this.renderer,s=this.quad;let i=s.vertices;i[0]=i[6]=t._width*-t.anchor.x,i[1]=i[3]=t._height*-t.anchor.y,i[2]=i[4]=t._width*(1-t.anchor.x),i[5]=i[7]=t._height*(1-t.anchor.y);const n=t.uvRespectAnchor?t.anchor.x:0,r=t.uvRespectAnchor?t.anchor.y:0;i=s.uvs,i[0]=i[6]=-n,i[1]=i[3]=-r,i[2]=i[4]=1-n,i[5]=i[7]=1-r,s.invalidate();const a=t._texture,o=a.baseTexture,h=o.alphaMode>0,l=t.tileTransform.localTransform,c=t.uvMatrix;let u=o.isPowerOfTwo&&a.frame.width===o.width&&a.frame.height===o.height;u&&(o._glTextures[e.CONTEXT_UID]?u=o.wrapMode!==yr.CLAMP:o.wrapMode===yr.CLAMP&&(o.wrapMode=yr.REPEAT));const d=u?this.simpleShader:this.shader,p=a.width,f=a.height,m=t._width,g=t._height;vf.set(l.a*p/m,l.b*p/g,l.c*f/m,l.d*f/g,l.tx/m,l.ty/g),vf.invert(),u?vf.prepend(c.mapCoord):(d.uniforms.uMapCoord=c.mapCoord.toArray(!0),d.uniforms.uClampFrame=c.uClampFrame,d.uniforms.uClampOffset=c.uClampOffset),d.uniforms.uTransform=vf.toArray(!0),d.uniforms.uColor=Ao.shared.setValue(t.tint).premultiply(t.worldAlpha,h).toArray(d.uniforms.uColor),d.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),d.uniforms.uSampler=a,e.shader.bind(d),e.geometry.bind(s),this.state.blendMode=Po(t.blendMode,h),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}_f.extension={name:"tilingSprite",type:Ko.RendererPlugin},Jo.add(_f);const bf=class{constructor(t,e,s=null){this.linkedSheets=[],this._texture=t instanceof Ol?t:null,this.baseTexture=t instanceof uh?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const i=this.baseTexture.resource;this.resolution=this._updateResolution(s||(i?i.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let s=qo(t,null);return null===s&&(s=parseFloat(null!=e?e:"1")),1!==s&&this.baseTexture.setResolution(s),s}parse(){return new Promise((t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=bf.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(t){let e=t;const s=bf.BATCH_SIZE;for(;e-t<s&&e<this._frameKeys.length;){const t=this._frameKeys[e],s=this._frames[t],i=s.frame;if(i){let e=null,n=null;const r=!1!==s.trimmed&&s.sourceSize?s.sourceSize:s.frame,a=new Mh(0,0,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution);e=s.rotated?new Mh(Math.floor(i.x)/this.resolution,Math.floor(i.y)/this.resolution,Math.floor(i.h)/this.resolution,Math.floor(i.w)/this.resolution):new Mh(Math.floor(i.x)/this.resolution,Math.floor(i.y)/this.resolution,Math.floor(i.w)/this.resolution,Math.floor(i.h)/this.resolution),!1!==s.trimmed&&s.spriteSourceSize&&(n=new Mh(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(i.w)/this.resolution,Math.floor(i.h)/this.resolution)),this.textures[t]=new Ol(this.baseTexture,e,a,n,s.rotated?2:0,s.anchor,s.borders),Ol.addToCache(this.textures[t],t)}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let s=0;s<t[e].length;s++){const i=t[e][s];this.animations[e].push(this.textures[i])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*bf.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*bf.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(t=!1){var e;for(const s in this.textures)this.textures[s].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(null==(e=this._texture)||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let wf=bf;wf.BATCH_SIZE=1e3;const Ef=["jpg","png","jpeg","avif","webp"];function Sf(t,e,s){const i={};if(t.forEach((t=>{i[t]=e})),Object.keys(e.textures).forEach((t=>{i[t]=e.textures[t]})),!s){const s=ja.dirname(t[0]);e.linkedSheets.forEach(((t,n)=>{const r=Sf([`${s}/${e.data.meta.related_multi_packs[n]}`],t,!0);Object.assign(i,r)}))}return i}const Tf={extension:Ko.Asset,cache:{test:t=>t instanceof wf,getCacheableAssets:(t,e)=>Sf(t,e,!1)},resolver:{test:t=>{const e=t.split("?")[0].split("."),s=e.pop(),i=e.pop();return"json"===s&&Ef.includes(i)},parse:t=>{var e,s;const i=t.split(".");return{resolution:parseFloat(null!=(s=null==(e=Ar.RETINA_PREFIX.exec(t))?void 0:e[1])?s:"1"),format:i[i.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:Ko.LoadParser,priority:ju.Normal},testParse(t,e){return p(this,null,(function*(){return".json"===ja.extname(e.src).toLowerCase()&&!!t.frames}))},parse(t,e,s){return p(this,null,(function*(){var i,n;let r=ja.dirname(e.src);r&&r.lastIndexOf("/")!==r.length-1&&(r+="/");let a=r+t.meta.image;a=Vu(a,e.src);const o=(yield s.load([a]))[a],h=new wf(o.baseTexture,t,e.src);yield h.parse();const l=null==(i=null==t?void 0:t.meta)?void 0:i.related_multi_packs;if(Array.isArray(l)){const t=[];for(const a of l){if("string"!=typeof a)continue;let i=r+a;(null==(n=e.data)?void 0:n.ignoreMultiPack)||(i=Vu(i,e.src),t.push(s.load({src:i,data:{ignoreMultiPack:!0}})))}const i=yield Promise.all(t);h.linkedSheets=i,i.forEach((t=>{t.linkedSheets=[h].concat(h.linkedSheets.filter((e=>e!==t)))}))}return h}))},unload(t){t.destroy(!0)}}};Jo.add(Tf);class Af{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Cf{static test(t){return"string"==typeof t&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),s={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const n in e){const t=e[n].match(/^[a-z]+/gm)[0],i=e[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),r={};for(const e in i){const t=i[e].split("="),s=t[0],n=t[1].replace(/"/gm,""),a=parseFloat(n),o=isNaN(a)?n:a;r[s]=o}s[t].push(r)}const i=new Af;return s.info.forEach((t=>i.info.push({face:t.face,size:parseInt(t.size,10)}))),s.common.forEach((t=>i.common.push({lineHeight:parseInt(t.lineHeight,10)}))),s.page.forEach((t=>i.page.push({id:parseInt(t.id,10),file:t.file}))),s.char.forEach((t=>i.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)}))),s.kerning.forEach((t=>i.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)}))),s.distanceField.forEach((t=>i.distanceField.push({distanceRange:parseInt(t.distanceRange,10),fieldType:t.fieldType}))),i}}class Mf{static test(t){const e=t;return"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")}static parse(t){const e=new Af,s=t.getElementsByTagName("info"),i=t.getElementsByTagName("common"),n=t.getElementsByTagName("page"),r=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),o=t.getElementsByTagName("distanceField");for(let h=0;h<s.length;h++)e.info.push({face:s[h].getAttribute("face"),size:parseInt(s[h].getAttribute("size"),10)});for(let h=0;h<i.length;h++)e.common.push({lineHeight:parseInt(i[h].getAttribute("lineHeight"),10)});for(let h=0;h<n.length;h++)e.page.push({id:parseInt(n[h].getAttribute("id"),10)||0,file:n[h].getAttribute("file")});for(let h=0;h<r.length;h++){const t=r[h];e.char.push({id:parseInt(t.getAttribute("id"),10),page:parseInt(t.getAttribute("page"),10)||0,x:parseInt(t.getAttribute("x"),10),y:parseInt(t.getAttribute("y"),10),width:parseInt(t.getAttribute("width"),10),height:parseInt(t.getAttribute("height"),10),xoffset:parseInt(t.getAttribute("xoffset"),10),yoffset:parseInt(t.getAttribute("yoffset"),10),xadvance:parseInt(t.getAttribute("xadvance"),10)})}for(let h=0;h<a.length;h++)e.kerning.push({first:parseInt(a[h].getAttribute("first"),10),second:parseInt(a[h].getAttribute("second"),10),amount:parseInt(a[h].getAttribute("amount"),10)});for(let h=0;h<o.length;h++)e.distanceField.push({fieldType:o[h].getAttribute("fieldType"),distanceRange:parseInt(o[h].getAttribute("distanceRange"),10)});return e}}class If{static test(t){return!("string"!=typeof t||!t.includes("<font>"))&&Mf.test(Ar.ADAPTER.parseXML(t))}static parse(t){return Mf.parse(Ar.ADAPTER.parseXML(t))}}const Pf=[Cf,Mf,If];function Rf(t,e,s,i,n,r,a){const o=s.text,h=s.fontProperties;e.translate(i,n),e.scale(r,r);const l=a.strokeThickness/2,c=-a.strokeThickness/2;if(e.font=a.toFontString(),e.lineWidth=a.strokeThickness,e.textBaseline=a.textBaseline,e.lineJoin=a.lineJoin,e.miterLimit=a.miterLimit,e.fillStyle=function(t,e,s,i,n,r){const a=s.fill;if(!Array.isArray(a))return a;if(1===a.length)return a[0];let o;const h=s.dropShadow?s.dropShadowDistance:0,l=s.padding||0,c=t.width/i-h-2*l,u=t.height/i-h-2*l,d=a.slice(),p=s.fillGradientStops.slice();if(!p.length){const t=d.length+1;for(let e=1;e<t;++e)p.push(e/t)}if(d.unshift(a[0]),p.unshift(0),d.push(a[a.length-1]),p.push(1),s.fillGradientType===Wp.LINEAR_VERTICAL){o=e.createLinearGradient(c/2,l,c/2,u+l);let t=0;const i=(r.fontProperties.fontSize+s.strokeThickness)/u;for(let e=0;e<n.length;e++){const s=r.lineHeight*e;for(let e=0;e<d.length;e++){let n=0;n="number"==typeof p[e]?p[e]:e/d.length;const r=s/u+n*i;let a=Math.max(t,r);a=Math.min(a,1),o.addColorStop(a,d[e]),t=a}}}else{o=e.createLinearGradient(l,u/2,c+l,u/2);const t=d.length+1;let s=1;for(let e=0;e<d.length;e++){let i;i="number"==typeof p[e]?p[e]:s/t,o.addColorStop(i,d[e]),s++}}return o}(t,e,a,r,[o],s),e.strokeStyle=a.stroke,a.dropShadow){const t=a.dropShadowColor,s=a.dropShadowBlur*r,i=a.dropShadowDistance*r;e.shadowColor=Ao.shared.setValue(t).setAlpha(a.dropShadowAlpha).toRgbaString(),e.shadowBlur=s,e.shadowOffsetX=Math.cos(a.dropShadowAngle)*i,e.shadowOffsetY=Math.sin(a.dropShadowAngle)*i}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;a.stroke&&a.strokeThickness&&e.strokeText(o,l,c+s.lineHeight-h.descent),a.fill&&e.fillText(o,l,c+s.lineHeight-h.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function kf(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}function Df(t){return Array.from?Array.from(t):t.split("")}const Ff=class{constructor(t,e,s){var i,n;const[r]=t.info,[a]=t.common,[o]=t.page,[h]=t.distanceField,l=qo(o.file),c={};this._ownsTextures=s,this.font=r.face,this.size=r.size,this.lineHeight=a.lineHeight/l,this.chars={},this.pageTextures=c;for(let u=0;u<t.page.length;u++){const{id:s,file:i}=t.page[u];c[s]=e instanceof Array?e[u]:e[i],(null==h?void 0:h.fieldType)&&"none"!==h.fieldType&&(c[s].baseTexture.alphaMode=vr.NO_PREMULTIPLIED_ALPHA,c[s].baseTexture.mipmap=xr.OFF)}for(let u=0;u<t.char.length;u++){const{id:e,page:s}=t.char[u];let{x:i,y:n,width:r,height:a,xoffset:o,yoffset:h,xadvance:d}=t.char[u];i/=l,n/=l,r/=l,a/=l,o/=l,h/=l,d/=l;const p=new Mh(i+c[s].frame.x/l,n+c[s].frame.y/l,r,a);this.chars[e]={xOffset:o,yOffset:h,xAdvance:d,kerning:{},texture:new Ol(c[s].baseTexture,p),page:s}}for(let u=0;u<t.kerning.length;u++){let{first:e,second:s,amount:i}=t.kerning[u];e/=l,s/=l,i/=l,this.chars[s]&&(this.chars[s].kerning[e]=i)}this.distanceFieldRange=null==h?void 0:h.distanceRange,this.distanceFieldType=null!=(n=null==(i=null==h?void 0:h.fieldType)?void 0:i.toLowerCase())?n:"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,s){let i;if(t instanceof Af)i=t;else{const e=function(t){for(let e=0;e<Pf.length;e++)if(Pf[e].test(t))return Pf[e];return null}(t);if(!e)throw new Error("Unrecognized data format for font.");i=e.parse(t)}e instanceof Ol&&(e=[e]);const n=new Ff(i,e,s);return Ff.available[n.font]=n,n}static uninstall(t){const e=Ff.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete Ff.available[t]}static from(t,e,s){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const i=Object.assign({},Ff.defaultOptions,s),{chars:n,padding:r,resolution:a,textureWidth:o,textureHeight:h}=i,c=u(i,["chars","padding","resolution","textureWidth","textureHeight"]),d=function(t){"string"==typeof t&&(t=[t]);const e=[];for(let s=0,i=t.length;s<i;s++){const i=t[s];if(Array.isArray(i)){if(2!==i.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${i.length}.`);const t=i[0].charCodeAt(0),s=i[1].charCodeAt(0);if(s<t)throw new Error("[BitmapFont]: Invalid character range.");for(let i=t,n=s;i<=n;i++)e.push(String.fromCharCode(i))}else e.push(...Df(i))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(n),p=e instanceof Kp?e:new Kp(e),f=o,m=new Af;m.info[0]={face:p.fontFamily,size:p.fontSize},m.common[0]={lineHeight:p.fontSize};let g,y,x,v=0,_=0,b=0;const w=[];for(let u=0;u<d.length;u++){g||(g=Ar.ADAPTER.createCanvas(),g.width=o,g.height=h,y=g.getContext("2d"),x=new uh(g,l({resolution:a},c)),w.push(new Ol(x)),m.page.push({id:w.length-1,file:""}));const t=d[u],e=zp.measureText(t,p,!1,g),s=e.width,i=Math.ceil(e.height),n=Math.ceil(("italic"===p.fontStyle?2:1)*s);if(_>=h-i*a){if(0===_)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${p.fontFamily}', fontSize: ${p.fontSize}px, char: '${t}')`);--u,g=null,y=null,x=null,_=0,v=0,b=0;continue}if(b=Math.max(i+e.fontProperties.descent,b),n*a+v>=f){if(0===v)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${p.fontFamily}', fontSize: ${p.fontSize}px, char: '${t}')`);--u,_+=b*a,_=Math.ceil(_),v=0,b=0;continue}Rf(g,y,e,v,_,a,p);const E=kf(e.text);m.char.push({id:E,page:w.length-1,x:v/a,y:_/a,width:n,height:i,xoffset:0,yoffset:0,xadvance:s-(p.dropShadow?p.dropShadowDistance:0)-(p.stroke?p.strokeThickness:0)}),v+=(n+2*r)*a,v=Math.ceil(v)}for(let l=0,u=d.length;l<u;l++){const t=d[l];for(let e=0;e<u;e++){const s=d[e],i=y.measureText(t).width,n=y.measureText(s).width,r=y.measureText(t+s).width-(i+n);r&&m.kerning.push({first:kf(t),second:kf(s),amount:r})}}const E=new Ff(m,w,!0);return void 0!==Ff.available[t]&&Ff.uninstall(t),Ff.available[t]=E,E}};let Of=Ff;Of.ALPHA=[["a","z"],["A","Z"]," "],Of.NUMERIC=[["0","9"]],Of.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],Of.ASCII=[[" ","~"]],Of.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Ff.ALPHANUMERIC},Of.available={};const Nf=[],Bf=[],Lf=[],Vf=class extends ru{constructor(t,e={}){super();const{align:s,tint:i,maxWidth:n,letterSpacing:r,fontName:a,fontSize:o}=Object.assign({},Vf.styleDefaults,e);if(!Of.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=s,this._tintColor=new Ao(i),this._font=void 0,this._fontName=a,this._fontSize=o,this.text=t,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=r,this._anchor=new Xh((()=>{this.dirty=!0}),this,0,0),this._roundPixels=Ar.ROUND_PIXELS,this.dirty=!0,this._resolution=Ar.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var t;const e=Of.available[this._fontName],s=this.fontSize,i=s/e.size,n=new Ah,r=[],a=[],o=[],h=Df(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),l=this._maxWidth*e.size/s,c="none"===e.distanceFieldType?Nf:Bf;let u=null,d=0,p=0,f=0,m=-1,g=0,y=0,x=0,v=0;for(let A=0;A<h.length;A++){const t=h[A],s=kf(t);if(/(?:\s)/.test(t)&&(m=A,g=d,v++),"\r"===t||"\n"===t){a.push(d),o.push(-1),p=Math.max(p,d),++f,++y,n.x=0,n.y+=e.lineHeight,u=null,v=0;continue}const i=e.chars[s];if(!i)continue;u&&i.kerning[u]&&(n.x+=i.kerning[u]);const c=Lf.pop()||{texture:Ol.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Ah};c.texture=i.texture,c.line=f,c.charCode=s,c.position.x=Math.round(n.x+i.xOffset+this._letterSpacing/2),c.position.y=Math.round(n.y+i.yOffset),c.prevSpaces=v,r.push(c),d=c.position.x+Math.max(i.xAdvance-i.xOffset,i.texture.orig.width),n.x+=i.xAdvance+this._letterSpacing,x=Math.max(x,i.yOffset+i.texture.height),u=s,-1!==m&&l>0&&n.x>l&&(++y,Oo(r,1+m-y,1+A-m),A=m,m=-1,a.push(g),o.push(r.length>0?r[r.length-1].prevSpaces:0),p=Math.max(p,g),f++,n.x=0,n.y+=e.lineHeight,u=null,v=0)}const _=h[h.length-1];"\r"!==_&&"\n"!==_&&(/(?:\s)/.test(_)&&(d=g),a.push(d),p=Math.max(p,d),o.push(-1));const b=[];for(let A=0;A<=f;A++){let t=0;"right"===this._align?t=p-a[A]:"center"===this._align?t=(p-a[A])/2:"justify"===this._align&&(t=o[A]<0?0:(p-a[A])/o[A]),b.push(t)}const w=r.length,E={},S=[],T=this._activePagesMeshData;c.push(...T);for(let A=0;A<w;A++){const t=r[A].texture,s=t.baseTexture.uid;if(!E[s]){let i=c.pop();if(!i){const t=new Lp;let s,n;"none"===e.distanceFieldType?(s=new Vp(Ol.EMPTY),n=cr.NORMAL):(s=new Vp(Ol.EMPTY,{program:dl.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n"),uniforms:{uFWidth:0}}),n=cr.NORMAL_NPM);const r=new Bp(t,s);r.blendMode=n,i={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:r,vertices:null,uvs:null,indices:null}}i.index=0,i.indexCount=0,i.vertexCount=0,i.uvsCount=0,i.total=0;const{_textureCache:n}=this;n[s]=n[s]||new Ol(t.baseTexture),i.mesh.texture=n[s],i.mesh.tint=this._tintColor.value,S.push(i),E[s]=i}E[s].total++}for(let A=0;A<T.length;A++)S.includes(T[A])||this.removeChild(T[A].mesh);for(let A=0;A<S.length;A++)S[A].mesh.parent!==this&&this.addChild(S[A].mesh);this._activePagesMeshData=S;for(const A in E){const e=E[A],s=e.total;if(!((null==(t=e.indices)?void 0:t.length)>6*s)||e.vertices.length<2*Bp.BATCHABLE_SIZE)e.vertices=new Float32Array(8*s),e.uvs=new Float32Array(8*s),e.indices=new Uint16Array(6*s);else{const t=e.total,s=e.vertices;for(let e=4*t*2;e<s.length;e++)s[e]=0}e.mesh.size=6*s}for(let A=0;A<w;A++){const t=r[A];let e=t.position.x+b[t.line]*("justify"===this._align?t.prevSpaces:1);this._roundPixels&&(e=Math.round(e));const s=e*i,n=t.position.y*i,a=t.texture,o=E[a.baseTexture.uid],h=a.frame,l=a._uvs,c=o.index++;o.indices[6*c+0]=0+4*c,o.indices[6*c+1]=1+4*c,o.indices[6*c+2]=2+4*c,o.indices[6*c+3]=0+4*c,o.indices[6*c+4]=2+4*c,o.indices[6*c+5]=3+4*c,o.vertices[8*c+0]=s,o.vertices[8*c+1]=n,o.vertices[8*c+2]=s+h.width*i,o.vertices[8*c+3]=n,o.vertices[8*c+4]=s+h.width*i,o.vertices[8*c+5]=n+h.height*i,o.vertices[8*c+6]=s,o.vertices[8*c+7]=n+h.height*i,o.uvs[8*c+0]=l.x0,o.uvs[8*c+1]=l.y0,o.uvs[8*c+2]=l.x1,o.uvs[8*c+3]=l.y1,o.uvs[8*c+4]=l.x2,o.uvs[8*c+5]=l.y2,o.uvs[8*c+6]=l.x3,o.uvs[8*c+7]=l.y3}this._textWidth=p*i,this._textHeight=(n.y+e.lineHeight)*i;for(const A in E){const t=E[A];if(0!==this.anchor.x||0!==this.anchor.y){let e=0;const s=this._textWidth*this.anchor.x,i=this._textHeight*this.anchor.y;for(let n=0;n<t.total;n++)t.vertices[e++]-=s,t.vertices[e++]-=i,t.vertices[e++]-=s,t.vertices[e++]-=i,t.vertices[e++]-=s,t.vertices[e++]-=i,t.vertices[e++]-=s,t.vertices[e++]-=i}this._maxLineHeight=x*i;const e=t.mesh.geometry.getBuffer("aVertexPosition"),s=t.mesh.geometry.getBuffer("aTextureCoord"),n=t.mesh.geometry.getIndex();e.data=t.vertices,s.data=t.uvs,n.data=t.indices,e.update(),s.update(),n.update()}for(let A=0;A<r.length;A++)Lf.push(r[A]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:s,size:i}=Of.available[this._fontName];if("none"!==s){const{a:s,b:n,c:r,d:a}=this.worldTransform,o=Math.sqrt(s*s+n*n),h=Math.sqrt(r*r+a*a),l=(Math.abs(o)+Math.abs(h))/2,c=this.fontSize/i,u=t._view.resolution;for(const t of this._activePagesMeshData)t.mesh.shader.uniforms.uFWidth=l*e*c*u}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=Of.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!Of.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){var t;return null!=(t=this._fontSize)?t:Of.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,s="none"===Of.available[this._fontName].distanceFieldType?Nf:Bf;s.push(...this._activePagesMeshData);for(const i of this._activePagesMeshData)this.removeChild(i.mesh);this._activePagesMeshData=[],s.filter((t=>e[t.mesh.texture.baseTexture.uid])).forEach((t=>{t.mesh.texture=Ol.EMPTY}));for(const i in e){e[i].destroy(),delete e[i]}this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};Vf.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const $f=[".xml",".fnt"],Uf={extension:{type:Ko.LoadParser,priority:ju.Normal},name:"loadBitmapFont",test:t=>$f.includes(ja.extname(t).toLowerCase()),testParse(t){return p(this,null,(function*(){return Cf.test(t)||If.test(t)}))},parse(t,e,s){return p(this,null,(function*(){const i=Cf.test(t)?Cf.parse(t):If.parse(t),{src:n}=e,{page:r}=i,a=[];for(let t=0;t<r.length;++t){const e=r[t].file;let s=ja.join(ja.dirname(n),e);s=Vu(s,n),a.push(s)}const o=yield s.load(a),h=a.map((t=>o[t]));return Of.install(i,h,!0)}))},load(t,e){return p(this,null,(function*(){return(yield Ar.ADAPTER.fetch(t)).text()}))},unload(t){t.destroy()}};Jo.add(Uf);const Xf=class extends Kp{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new Xf(Object.keys(Xf.defaultOptions).reduce(((e,s)=>c(l({},e),{[s]:t[s]})),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach((t=>{URL.revokeObjectURL(t.src),t.refs--,0===t.refs&&(t.fontFace&&document.fonts.delete(t.fontFace),delete Xf.availableFonts[t.originalUrl])})),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:s}=Xf;if(s[t]){const e=s[t];return this._fonts.push(e),e.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return Ar.ADAPTER.fetch(t).then((t=>t.blob())).then((t=>p(this,null,(function*(){return new Promise(((e,s)=>{const i=URL.createObjectURL(t),n=new FileReader;n.onload=()=>e([i,n.result]),n.onerror=s,n.readAsDataURL(t)}))})))).then((i=>p(this,[i],(function*([i,n]){const r=Object.assign({family:ja.basename(t,ja.extname(t)),weight:"normal",style:"normal",src:i,dataSrc:n,refs:1,originalUrl:t,fontFace:null},e);s[t]=r,this._fonts.push(r),this.styleID++;const a=new FontFace(r.family,`url(${r.src})`,{weight:r.weight,style:r.style});r.fontFace=a,yield a.load(),document.fonts.add(a),yield document.fonts.ready,this.styleID++,this.fontsDirty=!0}))))}addOverride(...t){const e=t.filter((t=>!this._overrides.includes(t)));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter((t=>this._overrides.includes(t)));e.length>0&&(this._overrides=this._overrides.filter((t=>!e.includes(t))),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?["word-wrap: "+(this.breakWords?"break-all":"break-word"),`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce(((t,e)=>`${t}\n            @font-face {\n                font-family: "${e.family}";\n                src: url('${e.dataSrc}');\n                font-weight: ${e.weight};\n                font-style: ${e.style}; \n            }`),this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=Mo(t)),"number"==typeof t?(e=t,za("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Ao.shared.setValue(e).toHex()):t;var e}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,s=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),i=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(255*e|0).toString(16).padStart(2,"0"));const n=`${s}px ${i}px`;return this.dropShadowBlur>0?`text-shadow: ${n} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${n} ${t}`}reset(){Object.assign(this,Xf.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise((t=>setTimeout(t,100))):Promise.resolve()}get isSafari(){const{userAgent:t}=Ar.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};let Yf=Xf;Yf.availableFonts={},Yf.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};const Wf=class extends hu{constructor(t="",e={}){var s;super(Ol.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1,this.ownsStyle=!1;const i=new Image,n=Ol.from(i,{scaleMode:Ar.SCALE_MODE,resourceOptions:{autoLoad:!1}});n.orig=new Mh,n.trim=new Mh,this.texture=n;const r="http://www.w3.org/2000/svg",a="http://www.w3.org/1999/xhtml",o=document.createElementNS(r,"svg"),h=document.createElementNS(r,"foreignObject"),l=document.createElementNS(a,"div"),c=document.createElementNS(a,"style");h.setAttribute("width","10000"),h.setAttribute("height","10000"),h.style.overflow="hidden",o.appendChild(h),this.maxWidth=Wf.defaultMaxWidth,this.maxHeight=Wf.defaultMaxHeight,this._domElement=l,this._styleElement=c,this._svgRoot=o,this._foreignObject=h,this._foreignObject.appendChild(c),this._foreignObject.appendChild(l),this._image=i,this._loadImage=new Image,this._autoResolution=Wf.defaultAutoResolution,this._resolution=null!=(s=Wf.defaultResolution)?s:Ar.RESOLUTION,this.text=t,this.style=e}measureText(t){var e,s;const{text:i,style:n,resolution:r}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:i,style:n.toCSS(r)}),this._styleElement.textContent=n.toGlobalCSS(),document.body.appendChild(this._svgRoot);const a=this._domElement.getBoundingClientRect();this._svgRoot.remove();const o=Math.min(this.maxWidth,Math.ceil(a.width)),h=Math.min(this.maxHeight,Math.ceil(a.height));return this._svgRoot.setAttribute("width",o.toString()),this._svgRoot.setAttribute("height",h.toString()),i!==this._text&&(this._domElement.innerHTML=this._text),n!==this._style&&(Object.assign(this._domElement,{style:null==(e=this._style)?void 0:e.toCSS(r)}),this._styleElement.textContent=null==(s=this._style)?void 0:s.toGlobalCSS()),{width:o+2*n.padding,height:h+2*n.padding}}updateText(t=!0){return p(this,null,(function*(){const{style:e,_image:s,_loadImage:i}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:n,height:r}=this.measureText();s.width=i.width=Math.ceil(Math.max(1,n)),s.height=i.height=Math.ceil(Math.max(1,r)),this._loading||(this._loading=!0,yield new Promise((t=>{i.onload=()=>p(this,null,(function*(){yield e.onBeforeDraw(),this._loading=!1,s.src=i.src,i.onload=null,i.src="",this.updateTexture(),t()}));const n=(new XMLSerializer).serializeToString(this._svgRoot);i.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(n)}`})))}))}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:s,resolution:i}=this,{padding:n}=t,{baseTexture:r}=e;e.trim.width=e._frame.width=s.width/i,e.trim.height=e._frame.height=s.height/i,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-2*n,e.orig.height=e._frame.height-2*n,this._onTextureUpdate(),r.setRealSize(s.width,s.height,i),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){var e,s,i,n,r;"boolean"==typeof t&&(t={children:t}),t=Object.assign({},Wf.defaultDestroyOptions,t),super.destroy(t);const a=null;this.ownsStyle&&(null==(e=this._style)||e.cleanFonts()),this._style=a,null==(s=this._svgRoot)||s.remove(),this._svgRoot=a,null==(i=this._domElement)||i.remove(),this._domElement=a,null==(n=this._foreignObject)||n.remove(),this._foreignObject=a,null==(r=this._styleElement)||r.remove(),this._styleElement=a,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=a,this._image.src="",this._image=a}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=No(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=No(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&((t=t||{})instanceof Yf?(this.ownsStyle=!1,this._style=t):t instanceof Kp?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=Yf.from(t)):(this.ownsStyle=!0,this._style=new Yf(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(""===t||null==t?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};let jf=Wf;jf.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},jf.defaultMaxWidth=2024,jf.defaultMaxHeight=2024,jf.defaultAutoResolution=!0;let Gf=class extends wl{constructor(t=4,e=3,s=!1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",s?"\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec2 uOffset;\nuniform vec4 filterClamp;\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n\n    // Sample top left pixel\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y), filterClamp.xy, filterClamp.zw));\n\n    // Sample top right pixel\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y), filterClamp.xy, filterClamp.zw));\n\n    // Sample bottom right pixel\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y), filterClamp.xy, filterClamp.zw));\n\n    // Sample bottom left pixel\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y), filterClamp.xy, filterClamp.zw));\n\n    // Average\n    color *= 0.25;\n\n    gl_FragColor = color;\n}\n":"\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec2 uOffset;\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n\n    // Sample top left pixel\n    color += texture2D(uSampler, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y));\n\n    // Sample top right pixel\n    color += texture2D(uSampler, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y));\n\n    // Sample bottom right pixel\n    color += texture2D(uSampler, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y));\n\n    // Sample bottom left pixel\n    color += texture2D(uSampler, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y));\n\n    // Average\n    color *= 0.25;\n\n    gl_FragColor = color;\n}"),this._kernels=[],this._blur=4,this._quality=3,this.uniforms.uOffset=new Float32Array(2),this._pixelSize=new Ah,this.pixelSize=1,this._clamp=s,Array.isArray(t)?this.kernels=t:(this._blur=t,this.quality=e)}apply(t,e,s,i){const n=this._pixelSize.x/e._frame.width,r=this._pixelSize.y/e._frame.height;let a;if(1===this._quality||0===this._blur)a=this._kernels[0]+.5,this.uniforms.uOffset[0]=a*n,this.uniforms.uOffset[1]=a*r,t.applyFilter(this,e,s,i);else{const o=t.getFilterTexture();let h,l=e,c=o;const u=this._quality-1;for(let e=0;e<u;e++)a=this._kernels[e]+.5,this.uniforms.uOffset[0]=a*n,this.uniforms.uOffset[1]=a*r,t.applyFilter(this,l,c,1),h=l,l=c,c=h;a=this._kernels[u]+.5,this.uniforms.uOffset[0]=a*n,this.uniforms.uOffset[1]=a*r,t.applyFilter(this,l,s,i),t.returnFilterTexture(o)}}_updatePadding(){this.padding=Math.ceil(this._kernels.reduce(((t,e)=>t+e+.5),0))}_generateKernels(){const t=this._blur,e=this._quality,s=[t];if(t>0){let i=t;const n=t/e;for(let t=1;t<e;t++)i-=n,s.push(i)}this._kernels=s,this._updatePadding()}get kernels(){return this._kernels}set kernels(t){Array.isArray(t)&&t.length>0?(this._kernels=t,this._quality=t.length,this._blur=Math.max(...t)):(this._kernels=[0],this._quality=1)}get clamp(){return this._clamp}set pixelSize(t){"number"==typeof t?(this._pixelSize.x=t,this._pixelSize.y=t):Array.isArray(t)?(this._pixelSize.x=t[0],this._pixelSize.y=t[1]):t instanceof Ah?(this._pixelSize.x=t.x,this._pixelSize.y=t.y):(this._pixelSize.x=1,this._pixelSize.y=1)}get pixelSize(){return this._pixelSize}get quality(){return this._quality}set quality(t){this._quality=Math.max(1,Math.round(t)),this._generateKernels()}get blur(){return this._blur}set blur(t){this._blur=t,this._generateKernels()}};var zf="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}";let Hf=class extends wl{constructor(t=.5){super(zf,"\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform float threshold;\n\nvoid main() {\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    // A simple & fast algorithm for getting brightness.\n    // It's inaccuracy , but good enought for this feature.\n    float _max = max(max(color.r, color.g), color.b);\n    float _min = min(min(color.r, color.g), color.b);\n    float brightness = (_max + _min) * 0.5;\n\n    if(brightness > threshold) {\n        gl_FragColor = color;\n    } else {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n}\n"),this.threshold=t}get threshold(){return this.uniforms.threshold}set threshold(t){this.uniforms.threshold=t}};const qf=class extends wl{constructor(t){super(zf,"uniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D bloomTexture;\nuniform float bloomScale;\nuniform float brightness;\n\nvoid main() {\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    color.rgb *= brightness;\n    vec4 bloomColor = vec4(texture2D(bloomTexture, vTextureCoord).rgb, 0.0);\n    bloomColor.rgb *= bloomScale;\n    gl_FragColor = color + bloomColor;\n}\n"),this.bloomScale=1,this.brightness=1,this._resolution=Ar.FILTER_RESOLUTION,"number"==typeof t&&(t={threshold:t});const e=Object.assign(qf.defaults,t);this.bloomScale=e.bloomScale,this.brightness=e.brightness;const{kernels:s,blur:i,quality:n,pixelSize:r,resolution:a}=e;this._extractFilter=new Hf(e.threshold),this._extractFilter.resolution=a,this._blurFilter=s?new Gf(s):new Gf(i,n),this.pixelSize=r,this.resolution=a}apply(t,e,s,i,n){const r=t.getFilterTexture();this._extractFilter.apply(t,e,r,1,n);const a=t.getFilterTexture();this._blurFilter.apply(t,r,a,1),this.uniforms.bloomScale=this.bloomScale,this.uniforms.brightness=this.brightness,this.uniforms.bloomTexture=a,t.applyFilter(this,e,s,i),t.returnFilterTexture(a),t.returnFilterTexture(r)}get resolution(){return this._resolution}set resolution(t){this._resolution=t,this._extractFilter&&(this._extractFilter.resolution=t),this._blurFilter&&(this._blurFilter.resolution=t)}get threshold(){return this._extractFilter.threshold}set threshold(t){this._extractFilter.threshold=t}get kernels(){return this._blurFilter.kernels}set kernels(t){this._blurFilter.kernels=t}get blur(){return this._blurFilter.blur}set blur(t){this._blurFilter.blur=t}get quality(){return this._blurFilter.quality}set quality(t){this._blurFilter.quality=t}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(t){this._blurFilter.pixelSize=t}};qf.defaults={threshold:.5,bloomScale:1,brightness:1,kernels:null,blur:8,quality:4,pixelSize:1,resolution:Ar.FILTER_RESOLUTION};const Kf=class extends wl{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","uniform float radius;\nuniform float strength;\nuniform vec2 center;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\nuniform vec2 dimensions;\n\nvoid main()\n{\n    vec2 coord = vTextureCoord * filterArea.xy;\n    coord -= center * dimensions.xy;\n    float distance = length(coord);\n    if (distance < radius) {\n        float percent = distance / radius;\n        if (strength > 0.0) {\n            coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);\n        } else {\n            coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);\n        }\n    }\n    coord += center * dimensions.xy;\n    coord /= filterArea.xy;\n    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);\n    vec4 color = texture2D(uSampler, clampedCoord);\n    if (coord != clampedCoord) {\n        color *= max(0.0, 1.0 - length(coord - clampedCoord));\n    }\n\n    gl_FragColor = color;\n}\n"),this.uniforms.dimensions=new Float32Array(2),Object.assign(this,Kf.defaults,t)}apply(t,e,s,i){const{width:n,height:r}=e.filterFrame;this.uniforms.dimensions[0]=n,this.uniforms.dimensions[1]=r,t.applyFilter(this,e,s,i)}get radius(){return this.uniforms.radius}set radius(t){this.uniforms.radius=t}get strength(){return this.uniforms.strength}set strength(t){this.uniforms.strength=t}get center(){return this.uniforms.center}set center(t){this.uniforms.center=t}};Kf.defaults={center:[.5,.5],radius:100,strength:1};var Zf,Qf;(Qf=Qf||{}).stringify=(Zf={"visit_linear-gradient":function(t){return Zf.visit_gradient(t)},"visit_repeating-linear-gradient":function(t){return Zf.visit_gradient(t)},"visit_radial-gradient":function(t){return Zf.visit_gradient(t)},"visit_repeating-radial-gradient":function(t){return Zf.visit_gradient(t)},visit_gradient:function(t){var e=Zf.visit(t.orientation);return e&&(e+=", "),t.type+"("+e+Zf.visit(t.colorStops)+")"},visit_shape:function(t){var e=t.value,s=Zf.visit(t.at),i=Zf.visit(t.style);return i&&(e+=" "+i),s&&(e+=" at "+s),e},"visit_default-radial":function(t){var e="",s=Zf.visit(t.at);return s&&(e+=s),e},"visit_extent-keyword":function(t){var e=t.value,s=Zf.visit(t.at);return s&&(e+=" at "+s),e},"visit_position-keyword":function(t){return t.value},visit_position:function(t){return Zf.visit(t.value.x)+" "+Zf.visit(t.value.y)},"visit_%":function(t){return t.value+"%"},visit_em:function(t){return t.value+"em"},visit_px:function(t){return t.value+"px"},visit_literal:function(t){return Zf.visit_color(t.value,t)},visit_hex:function(t){return Zf.visit_color("#"+t.value,t)},visit_rgb:function(t){return Zf.visit_color("rgb("+t.value.join(", ")+")",t)},visit_rgba:function(t){return Zf.visit_color("rgba("+t.value.join(", ")+")",t)},visit_color:function(t,e){var s=t,i=Zf.visit(e.length);return i&&(s+=" "+i),s},visit_angular:function(t){return t.value+"deg"},visit_directional:function(t){return"to "+t.value},visit_array:function(t){var e="",s=t.length;return t.forEach((function(t,i){e+=Zf.visit(t),i<s-1&&(e+=", ")})),e},visit:function(t){if(!t)return"";if(t instanceof Array)return Zf.visit_array(t,"");if(t.type){var e=Zf["visit_"+t.type];if(e)return e(t);throw Error("Missing visitor visit_"+t.type)}throw Error("Invalid node.")}},function(t){return Zf.visit(t)}),(Qf=Qf||{}).parse=function(){var t={linearGradient:/^(\-(webkit|o|ms|moz)\-)?(linear\-gradient)/i,repeatingLinearGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-linear\-gradient)/i,radialGradient:/^(\-(webkit|o|ms|moz)\-)?(radial\-gradient)/i,repeatingRadialGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-radial\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/^\#([0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^rgb/i,rgbaColor:/^rgba/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/},e="";function s(t){var s=new Error(e+": "+t);throw s.source=e,s}function i(){var t=p(n);return e.length>0&&s("Invalid input not EOF"),t}function n(){return r("linear-gradient",t.linearGradient,o)||r("repeating-linear-gradient",t.repeatingLinearGradient,o)||r("radial-gradient",t.radialGradient,h)||r("repeating-radial-gradient",t.repeatingRadialGradient,h)}function r(e,i,n){return a(i,(function(i){var r=n();return r&&(v(t.comma)||s("Missing comma before color stops")),{type:e,orientation:r,colorStops:p(f)}}))}function a(e,i){var n=v(e);if(n){v(t.startCall)||s("Missing (");var r=i(n);return v(t.endCall)||s("Missing )"),r}}function o(){return x("directional",t.sideOrCorner,1)||x("angular",t.angleValue,1)}function h(){var s,i,n=l();return n&&((s=[]).push(n),i=e,v(t.comma)&&((n=l())?s.push(n):e=i)),s}function l(){var t=function(){var t=x("shape",/^(circle)/i,0);return t&&(t.style=y()||c()),t}()||function(){var t=x("shape",/^(ellipse)/i,0);return t&&(t.style=g()||c()),t}();if(t)t.at=u();else{var e=c();if(e){t=e;var s=u();s&&(t.at=s)}else{var i=d();i&&(t={type:"default-radial",at:i})}}return t}function c(){return x("extent-keyword",t.extentKeywords,1)}function u(){if(x("position",/^at/,0)){var t=d();return t||s("Missing positioning value"),t}}function d(){var t={x:g(),y:g()};if(t.x||t.y)return{type:"position",value:t}}function p(e){var i=e(),n=[];if(i)for(n.push(i);v(t.comma);)(i=e())?n.push(i):s("One extra comma");return n}function f(){var e=x("hex",t.hexColor,1)||a(t.rgbaColor,(function(){return{type:"rgba",value:p(m)}}))||a(t.rgbColor,(function(){return{type:"rgb",value:p(m)}}))||x("literal",t.literalColor,0);return e||s("Expected color definition"),e.length=g(),e}function m(){return v(t.number)[1]}function g(){return x("%",t.percentageValue,1)||x("position-keyword",t.positionKeywords,1)||y()}function y(){return x("px",t.pixelValue,1)||x("em",t.emValue,1)}function x(t,e,s){var i=v(e);if(i)return{type:t,value:i[s]}}function v(t){var s,i;return(i=/^[\n\r\t\s]+/.exec(e))&&_(i[0].length),(s=t.exec(e))&&_(s[0].length),s}function _(t){e=e.substr(t)}return function(t){return e=t.toString(),i()}}();var Jf=Qf.parse;Qf.stringify;var tm={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},em={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};var sm={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]},im={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(t){var e,s,i,n,r,a=t[0]/360,o=t[1]/100,h=t[2]/100;if(0===o)return[r=255*h,r,r];e=2*h-(s=h<.5?h*(1+o):h+o-h*o),n=[0,0,0];for(var l=0;l<3;l++)(i=a+1/3*-(l-1))<0?i++:i>1&&i--,r=6*i<1?e+6*(s-e)*i:2*i<1?s:3*i<2?e+(s-e)*(2/3-i)*6:e,n[l]=255*r;return n}};function nm(t){Array.isArray(t)&&t.raw&&(t=String.raw(...arguments));var e,s=function(t){var e,s,i=[],n=1;if("string"==typeof t)if(tm[t])i=tm[t].slice(),s="rgb";else if("transparent"===t)n=0,s="rgb",i=[0,0,0];else if(/^#[A-Fa-f0-9]+$/.test(t)){var r=t.slice(1);n=1,(h=r.length)<=4?(i=[parseInt(r[0]+r[0],16),parseInt(r[1]+r[1],16),parseInt(r[2]+r[2],16)],4===h&&(n=parseInt(r[3]+r[3],16)/255)):(i=[parseInt(r[0]+r[1],16),parseInt(r[2]+r[3],16),parseInt(r[4]+r[5],16)],8===h&&(n=parseInt(r[6]+r[7],16)/255)),i[0]||(i[0]=0),i[1]||(i[1]=0),i[2]||(i[2]=0),s="rgb"}else if(e=/^((?:rgb|hs[lvb]|hwb|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms)a?)\s*\(([^\)]*)\)/.exec(t)){var a=e[1],o="rgb"===a;s=r=a.replace(/a$/,"");var h="cmyk"===r?4:"gray"===r?1:3;i=e[2].trim().split(/\s*[,\/]\s*|\s+/).map((function(t,e){if(/%$/.test(t))return e===h?parseFloat(t)/100:"rgb"===r?255*parseFloat(t)/100:parseFloat(t);if("h"===r[e]){if(/deg$/.test(t))return parseFloat(t);if(void 0!==em[t])return em[t]}return parseFloat(t)})),a===r&&i.push(1),n=o||void 0===i[h]?1:i[h],i=i.slice(0,h)}else t.length>10&&/[0-9](?:\s|\/)/.test(t)&&(i=t.match(/([0-9]+)/g).map((function(t){return parseFloat(t)})),s=t.match(/([a-z])/gi).join("").toLowerCase());else isNaN(t)?Array.isArray(t)||t.length?(i=[t[0],t[1],t[2]],s="rgb",n=4===t.length?t[3]:1):t instanceof Object&&(null!=t.r||null!=t.red||null!=t.R?(s="rgb",i=[t.r||t.red||t.R||0,t.g||t.green||t.G||0,t.b||t.blue||t.B||0]):(s="hsl",i=[t.h||t.hue||t.H||0,t.s||t.saturation||t.S||0,t.l||t.lightness||t.L||t.b||t.brightness]),n=t.a||t.alpha||t.opacity||1,null!=t.opacity&&(n/=100)):(s="rgb",i=[t>>>16,(65280&t)>>>8,255&t]);return{space:s,values:i,alpha:n}}(t);if(!s.space)return[];const i="h"===s.space[0]?im.min:sm.min,n="h"===s.space[0]?im.max:sm.max;return(e=Array(3))[0]=Math.min(Math.max(s.values[0],i[0]),n[0]),e[1]=Math.min(Math.max(s.values[1],i[1]),n[1]),e[2]=Math.min(Math.max(s.values[2],i[2]),n[2]),"h"===s.space[0]&&(e=im.rgb(e)),e.push(Math.min(Math.max(s.alpha,0),1)),e}function rm(t){switch(typeof t){case"string":return function(t){const e=nm(t);if(!e)throw new Error(`Unable to parse color "${t}" as RGBA.`);return[e[0]/255,e[1]/255,e[2]/255,e[3]]}(t);case"number":return Co(t);default:return t}}function am(t){const e=Jf(function(t){let e=t.replace(/\s{2,}/gu," ");return e=e.replace(/;/g,""),e=e.replace(/ ,/g,","),e=e.replace(/\( /g,"("),e=e.replace(/ \)/g,")"),e.trim()}(t));if(0===e.length)throw new Error("Invalid CSS gradient.");if(1!==e.length)throw new Error("Unsupported CSS gradient (multiple gradients is not supported).");const s=e[0],i=function(t){const e={"linear-gradient":0,"radial-gradient":1};if(!(t in e))throw new Error(`Unsupported gradient type "${t}"`);return e[t]}(s.type),n=function(t){const e=function(t){const e=[];for(let n=0;n<t.length;n++){const s=t[n];let i=-1;"literal"===s.type&&s.length&&"type"in s.length&&"%"===s.length.type&&"value"in s.length&&(i=parseFloat(s.length.value)/100),e.push(i)}const s=t=>{for(let s=t;s<e.length;s++)if(-1!==e[s])return{indexDelta:s-t,offset:e[s]};return{indexDelta:e.length-1-t,offset:1}};let i=0;for(let n=0;n<e.length;n++){const t=e[n];if(-1!==t)i=t;else if(0===n)e[n]=0;else if(n+1===e.length)e[n]=1;else{const t=s(n),r=(t.offset-i)/(1+t.indexDelta);for(let s=0;s<=t.indexDelta;s++)e[n+s]=i+(s+1)*r;n+=t.indexDelta,i=e[n]}}return e.map(hm)}(t),s=[];for(let i=0;i<t.length;i++){const n=om(t[i]);s.push({offset:e[i],color:n.slice(0,3),alpha:n[3]})}return s}(s.colorStops),r=function(t){if(void 0===t)return 0;if("type"in t&&"value"in t)switch(t.type){case"angular":return parseFloat(t.value);case"directional":return function(t){const e={left:270,top:0,bottom:180,right:90,"left top":315,"top left":315,"left bottom":225,"bottom left":225,"right top":45,"top right":45,"right bottom":135,"bottom right":135};if(!(t in e))throw new Error(`Unsupported directional value "${t}"`);return e[t]}(t.value)}return 0}(s.orientation);return{type:i,stops:n,angle:r}}function om(t){return rm(function(t){switch(t.type){case"hex":return`#${t.value}`;case"literal":return t.value;default:return`${t.type}(${t.value.join(",")})`}}(t))}function hm(t){return t.toString().length>6?parseFloat(t.toString().substring(0,6)):t}sm.hsl=function(t){var e,s,i=t[0]/255,n=t[1]/255,r=t[2]/255,a=Math.min(i,n,r),o=Math.max(i,n,r),h=o-a;return o===a?e=0:i===o?e=(n-r)/h:n===o?e=2+(r-i)/h:r===o&&(e=4+(i-n)/h),(e=Math.min(60*e,360))<0&&(e+=360),s=(a+o)/2,[e,100*(o===a?0:s<=.5?h/(o+a):h/(2-o-a)),100*s]};var lm=Object.defineProperty,cm=Object.defineProperties,um=Object.getOwnPropertyDescriptors,dm=Object.getOwnPropertySymbols,pm=Object.prototype.hasOwnProperty,fm=Object.prototype.propertyIsEnumerable,mm=(t,e,s)=>e in t?lm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,gm=(t,e)=>{for(var s in e||(e={}))pm.call(e,s)&&mm(t,s,e[s]);if(dm)for(var s of dm(e))fm.call(e,s)&&mm(t,s,e[s]);return t};const ym=class extends wl{constructor(t){t&&"css"in t&&(t=((t,e)=>cm(t,um(e)))(gm({},am(t.css||"")),{alpha:t.alpha,maxColors:t.maxColors}));const e=gm(gm({},ym.defaults),t);if(!e.stops||e.stops.length<2)throw new Error("ColorGradientFilter requires at least 2 color stops.");super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n    vFilterCoord = vTextureCoord * inputSize.xy / outputFrame.zw;\n}\n","const float PI = 3.1415926538;\nconst float PI_2 = PI*2.;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\nuniform sampler2D uSampler;\n\nconst int TYPE_LINEAR = 0;\nconst int TYPE_RADIAL = 1;\nconst int TYPE_CONIC = 2;\nconst int MAX_STOPS = 32;\n\nuniform int uNumStops;\nuniform float uAlphas[3*MAX_STOPS];\nuniform vec3 uColors[MAX_STOPS];\nuniform float uOffsets[MAX_STOPS];\nuniform int uType;\nuniform float uAngle;\nuniform float uAlpha;\nuniform int uMaxColors;\n\nstruct ColorStop {\n    float offset;\n    vec3 color;\n    float alpha;\n};\n\nmat2 rotate2d(float angle){\n    return mat2(cos(angle), -sin(angle),\n    sin(angle), cos(angle));\n}\n\nfloat projectLinearPosition(vec2 pos, float angle){\n    vec2 center = vec2(0.5);\n    vec2 result = pos - center;\n    result = rotate2d(angle) * result;\n    result = result + center;\n    return clamp(result.x, 0., 1.);\n}\n\nfloat projectRadialPosition(vec2 pos) {\n    float r = distance(vFilterCoord, vec2(0.5));\n    return clamp(2.*r, 0., 1.);\n}\n\nfloat projectAnglePosition(vec2 pos, float angle) {\n    vec2 center = pos - vec2(0.5);\n    float polarAngle=atan(-center.y, center.x);\n    return mod(polarAngle + angle, PI_2) / PI_2;\n}\n\nfloat projectPosition(vec2 pos, int type, float angle) {\n    if (type == TYPE_LINEAR) {\n        return projectLinearPosition(pos, angle);\n    } else if (type == TYPE_RADIAL) {\n        return projectRadialPosition(pos);\n    } else if (type == TYPE_CONIC) {\n        return projectAnglePosition(pos, angle);\n    }\n\n    return pos.y;\n}\n\nvoid main(void) {\n    // current/original color\n    vec4 currentColor = texture2D(uSampler, vTextureCoord);\n\n    // skip calculations if gradient alpha is 0\n    if (0.0 == uAlpha) {\n        gl_FragColor = currentColor;\n        return;\n    }\n\n    // project position\n    float y = projectPosition(vFilterCoord, uType, radians(uAngle));\n\n    // check gradient bounds\n    float offsetMin = uOffsets[0];\n    float offsetMax = 0.0;\n\n    for (int i = 0; i < MAX_STOPS; i++) {\n        if (i == uNumStops-1){ // last index\n            offsetMax = uOffsets[i];\n        }\n    }\n\n    if (y  < offsetMin || y > offsetMax) {\n        gl_FragColor = currentColor;\n        return;\n    }\n\n    // limit colors\n    if (uMaxColors > 0) {\n        float stepSize = 1./float(uMaxColors);\n        float stepNumber = float(floor(y/stepSize));\n        y = stepSize * (stepNumber + 0.5);// offset by 0.5 to use color from middle of segment\n    }\n\n    // find color stops\n    ColorStop from;\n    ColorStop to;\n\n    for (int i = 0; i < MAX_STOPS; i++) {\n        if (y >= uOffsets[i]) {\n            from = ColorStop(uOffsets[i], uColors[i], uAlphas[i]);\n            to = ColorStop(uOffsets[i+1], uColors[i+1], uAlphas[i+1]);\n        }\n\n        if (i == uNumStops-1){ // last index\n            break;\n        }\n    }\n\n    // mix colors from stops\n    vec4 colorFrom = vec4(from.color * from.alpha, from.alpha);\n    vec4 colorTo = vec4(to.color * to.alpha, to.alpha);\n\n    float segmentHeight = to.offset - from.offset;\n    float relativePos = y - from.offset;// position from 0 to [segmentHeight]\n    float relativePercent = relativePos / segmentHeight;// position in percent between [from.offset] and [to.offset].\n\n    float gradientAlpha = uAlpha * currentColor.a;\n    vec4 gradientColor = mix(colorFrom, colorTo, relativePercent) * gradientAlpha;\n\n    // mix resulting color with current color\n    gl_FragColor = gradientColor + currentColor*(1.-gradientColor.a);\n}\n"),this._stops=[],this.autoFit=!1,Object.assign(this,e)}get stops(){return this._stops}set stops(t){const e=function(t){return[...t].sort(((t,e)=>t.offset-e.offset))}(t),s=new Float32Array(3*e.length);for(let i=0;i<e.length;i++){const t=rm(e[i].color),n=3*i;s[n+0]=t[0],s[n+1]=t[1],s[n+2]=t[2]}this.uniforms.uColors=s,this.uniforms.uOffsets=e.map((t=>t.offset)),this.uniforms.uAlphas=e.map((t=>t.alpha)),this.uniforms.uNumStops=e.length,this._stops=e}set type(t){this.uniforms.uType=t}get type(){return this.uniforms.uType}set angle(t){this.uniforms.uAngle=t-90}get angle(){return this.uniforms.uAngle+90}set alpha(t){this.uniforms.uAlpha=t}get alpha(){return this.uniforms.uAlpha}set maxColors(t){this.uniforms.uMaxColors=t}get maxColors(){return this.uniforms.uMaxColors}};let xm=ym;xm.LINEAR=0,xm.RADIAL=1,xm.CONIC=2,xm.defaults={type:ym.LINEAR,stops:[{offset:0,color:16711680,alpha:1},{offset:1,color:255,alpha:1}],alpha:1,angle:90,maxColors:0};let vm=class extends wl{constructor(t=0,e=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 color;\nuniform float alpha;\n\nvoid main(void) {\n    vec4 currentColor = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = vec4(mix(currentColor.rgb, color.rgb, currentColor.a * alpha), currentColor.a);\n}\n"),this._color=0,this._alpha=1,this.uniforms.color=new Float32Array(3),this.color=t,this.alpha=e}set color(t){const e=this.uniforms.color;"number"==typeof t?(Co(t,e),this._color=t):(e[0]=t[0],e[1]=t[1],e[2]=t[2],this._color=Mo(e))}get color(){return this._color}set alpha(t){this.uniforms.alpha=t,this._alpha=t}get alpha(){return this._alpha}};const _m=class extends wl{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nconst float SQRT_2 = 1.414213;\n\nconst float light = 1.0;\n\nuniform float curvature;\nuniform float lineWidth;\nuniform float lineContrast;\nuniform bool verticalLine;\nuniform float noise;\nuniform float noiseSize;\n\nuniform float vignetting;\nuniform float vignettingAlpha;\nuniform float vignettingBlur;\n\nuniform float seed;\nuniform float time;\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main(void)\n{\n    vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;\n    vec2 dir = vec2(vTextureCoord.xy * filterArea.xy / dimensions - vec2(0.5, 0.5));\n    \n    gl_FragColor = texture2D(uSampler, vTextureCoord);\n    vec3 rgb = gl_FragColor.rgb;\n\n    if (noise > 0.0 && noiseSize > 0.0)\n    {\n        pixelCoord.x = floor(pixelCoord.x / noiseSize);\n        pixelCoord.y = floor(pixelCoord.y / noiseSize);\n        float _noise = rand(pixelCoord * noiseSize * seed) - 0.5;\n        rgb += _noise * noise;\n    }\n\n    if (lineWidth > 0.0)\n    {\n        float _c = curvature > 0. ? curvature : 1.;\n        float k = curvature > 0. ?(length(dir * dir) * 0.25 * _c * _c + 0.935 * _c) : 1.;\n        vec2 uv = dir * k;\n\n        float v = (verticalLine ? uv.x * dimensions.x : uv.y * dimensions.y) * min(1.0, 2.0 / lineWidth ) / _c;\n        float j = 1. + cos(v * 1.2 - time) * 0.5 * lineContrast;\n        rgb *= j;\n        float segment = verticalLine ? mod((dir.x + .5) * dimensions.x, 4.) : mod((dir.y + .5) * dimensions.y, 4.);\n        rgb *= 0.99 + ceil(segment) * 0.015;\n    }\n\n    if (vignetting > 0.0)\n    {\n        float outter = SQRT_2 - vignetting * SQRT_2;\n        float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + vignettingBlur * SQRT_2), 0.0, 1.0);\n        rgb *= darker + (1.0 - darker) * (1.0 - vignettingAlpha);\n    }\n\n    gl_FragColor.rgb = rgb;\n}\n"),this.time=0,this.seed=0,this.uniforms.dimensions=new Float32Array(2),Object.assign(this,_m.defaults,t)}apply(t,e,s,i){const{width:n,height:r}=e.filterFrame;this.uniforms.dimensions[0]=n,this.uniforms.dimensions[1]=r,this.uniforms.seed=this.seed,this.uniforms.time=this.time,t.applyFilter(this,e,s,i)}set curvature(t){this.uniforms.curvature=t}get curvature(){return this.uniforms.curvature}set lineWidth(t){this.uniforms.lineWidth=t}get lineWidth(){return this.uniforms.lineWidth}set lineContrast(t){this.uniforms.lineContrast=t}get lineContrast(){return this.uniforms.lineContrast}set verticalLine(t){this.uniforms.verticalLine=t}get verticalLine(){return this.uniforms.verticalLine}set noise(t){this.uniforms.noise=t}get noise(){return this.uniforms.noise}set noiseSize(t){this.uniforms.noiseSize=t}get noiseSize(){return this.uniforms.noiseSize}set vignetting(t){this.uniforms.vignetting=t}get vignetting(){return this.uniforms.vignetting}set vignettingAlpha(t){this.uniforms.vignettingAlpha=t}get vignettingAlpha(){return this.uniforms.vignettingAlpha}set vignettingBlur(t){this.uniforms.vignettingBlur=t}get vignettingBlur(){return this.uniforms.vignettingBlur}};_m.defaults={curvature:1,lineWidth:1,lineContrast:.25,verticalLine:!1,noise:0,noiseSize:1,seed:0,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3,time:0};var bm=Object.defineProperty,wm=Object.getOwnPropertySymbols,Em=Object.prototype.hasOwnProperty,Sm=Object.prototype.propertyIsEnumerable,Tm=(t,e,s)=>e in t?bm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Am=(t,e)=>{for(var s in e||(e={}))Em.call(e,s)&&Tm(t,s,e[s]);if(wm)for(var s of wm(e))Sm.call(e,s)&&Tm(t,s,e[s]);return t};const Cm=class extends wl{constructor(t){super(),this.angle=45,this._distance=5,this._resolution=Ar.FILTER_RESOLUTION;const e=t?Am(Am({},Cm.defaults),t):Cm.defaults,{kernels:s,blur:i,quality:n,pixelSize:r,resolution:a}=e;this._offset=new Xh(this._updatePadding,this),this._tintFilter=new wl("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float alpha;\nuniform vec3 color;\n\nuniform vec2 shift;\nuniform vec4 inputSize;\n\nvoid main(void){\n    vec4 sample = texture2D(uSampler, vTextureCoord - shift * inputSize.zw);\n\n    // Premultiply alpha\n    sample.rgb = color.rgb * sample.a;\n\n    // alpha user alpha\n    sample *= alpha;\n\n    gl_FragColor = sample;\n}"),this._tintFilter.uniforms.color=new Float32Array(4),this._tintFilter.uniforms.shift=this._offset,this._tintFilter.resolution=a,this._blurFilter=s?new Gf(s):new Gf(i,n),this.pixelSize=r,this.resolution=a;const{shadowOnly:o,rotation:h,distance:l,offset:c,alpha:u,color:d}=e;this.shadowOnly=o,void 0!==h&&void 0!==l?(this.rotation=h,this.distance=l):this.offset=c,this.alpha=u,this.color=d}apply(t,e,s,i){const n=t.getFilterTexture();this._tintFilter.apply(t,e,n,1),this._blurFilter.apply(t,n,s,i),!0!==this.shadowOnly&&t.applyFilter(this,e,s,0),t.returnFilterTexture(n)}_updatePadding(){const t=Math.max(Math.abs(this._offset.x),Math.abs(this._offset.y));this.padding=t+2*this.blur}_updateShift(){this._tintFilter.uniforms.shift.set(this.distance*Math.cos(this.angle),this.distance*Math.sin(this.angle))}set offset(t){this._offset.copyFrom(t),this._updatePadding()}get offset(){return this._offset}get resolution(){return this._resolution}set resolution(t){this._resolution=t,this._tintFilter&&(this._tintFilter.resolution=t),this._blurFilter&&(this._blurFilter.resolution=t)}get distance(){return this._distance}set distance(t){za("5.3.0","DropShadowFilter distance is deprecated, use offset"),this._distance=t,this._updatePadding(),this._updateShift()}get rotation(){return this.angle/Sh}set rotation(t){za("5.3.0","DropShadowFilter rotation is deprecated, use offset"),this.angle=t*Sh,this._updateShift()}get alpha(){return this._tintFilter.uniforms.alpha}set alpha(t){this._tintFilter.uniforms.alpha=t}get color(){return Mo(this._tintFilter.uniforms.color)}set color(t){Co(t,this._tintFilter.uniforms.color)}get kernels(){return this._blurFilter.kernels}set kernels(t){this._blurFilter.kernels=t}get blur(){return this._blurFilter.blur}set blur(t){this._blurFilter.blur=t,this._updatePadding()}get quality(){return this._blurFilter.quality}set quality(t){this._blurFilter.quality=t}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(t){this._blurFilter.pixelSize=t}};Cm.defaults={offset:{x:4,y:4},color:0,alpha:.5,shadowOnly:!1,kernels:null,blur:2,quality:3,pixelSize:1,resolution:Ar.FILTER_RESOLUTION};const Mm=class extends wl{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","// precision highp float;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\nuniform vec2 dimensions;\nuniform float aspect;\n\nuniform sampler2D displacementMap;\nuniform float offset;\nuniform float sinDir;\nuniform float cosDir;\nuniform int fillMode;\n\nuniform float seed;\nuniform vec2 red;\nuniform vec2 green;\nuniform vec2 blue;\n\nconst int TRANSPARENT = 0;\nconst int ORIGINAL = 1;\nconst int LOOP = 2;\nconst int CLAMP = 3;\nconst int MIRROR = 4;\n\nvoid main(void)\n{\n    vec2 coord = (vTextureCoord * filterArea.xy) / dimensions;\n\n    if (coord.x > 1.0 || coord.y > 1.0) {\n        return;\n    }\n\n    float cx = coord.x - 0.5;\n    float cy = (coord.y - 0.5) * aspect;\n    float ny = (-sinDir * cx + cosDir * cy) / aspect + 0.5;\n\n    // displacementMap: repeat\n    // ny = ny > 1.0 ? ny - 1.0 : (ny < 0.0 ? 1.0 + ny : ny);\n\n    // displacementMap: mirror\n    ny = ny > 1.0 ? 2.0 - ny : (ny < 0.0 ? -ny : ny);\n\n    vec4 dc = texture2D(displacementMap, vec2(0.5, ny));\n\n    float displacement = (dc.r - dc.g) * (offset / filterArea.x);\n\n    coord = vTextureCoord + vec2(cosDir * displacement, sinDir * displacement * aspect);\n\n    if (fillMode == CLAMP) {\n        coord = clamp(coord, filterClamp.xy, filterClamp.zw);\n    } else {\n        if( coord.x > filterClamp.z ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.x -= filterClamp.z;\n            } else if (fillMode == MIRROR) {\n                coord.x = filterClamp.z * 2.0 - coord.x;\n            }\n        } else if( coord.x < filterClamp.x ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.x += filterClamp.z;\n            } else if (fillMode == MIRROR) {\n                coord.x *= -filterClamp.z;\n            }\n        }\n\n        if( coord.y > filterClamp.w ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.y -= filterClamp.w;\n            } else if (fillMode == MIRROR) {\n                coord.y = filterClamp.w * 2.0 - coord.y;\n            }\n        } else if( coord.y < filterClamp.y ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.y += filterClamp.w;\n            } else if (fillMode == MIRROR) {\n                coord.y *= -filterClamp.w;\n            }\n        }\n    }\n\n    gl_FragColor.r = texture2D(uSampler, coord + red * (1.0 - seed * 0.4) / filterArea.xy).r;\n    gl_FragColor.g = texture2D(uSampler, coord + green * (1.0 - seed * 0.3) / filterArea.xy).g;\n    gl_FragColor.b = texture2D(uSampler, coord + blue * (1.0 - seed * 0.2) / filterArea.xy).b;\n    gl_FragColor.a = texture2D(uSampler, coord).a;\n}\n"),this.offset=100,this.fillMode=Mm.TRANSPARENT,this.average=!1,this.seed=0,this.minSize=8,this.sampleSize=512,this._slices=0,this._offsets=new Float32Array(1),this._sizes=new Float32Array(1),this._direction=-1,this.uniforms.dimensions=new Float32Array(2),this._canvas=document.createElement("canvas"),this._canvas.width=4,this._canvas.height=this.sampleSize,this.texture=Ol.from(this._canvas,{scaleMode:gr.NEAREST}),Object.assign(this,Mm.defaults,t)}apply(t,e,s,i){const{width:n,height:r}=e.filterFrame;this.uniforms.dimensions[0]=n,this.uniforms.dimensions[1]=r,this.uniforms.aspect=r/n,this.uniforms.seed=this.seed,this.uniforms.offset=this.offset,this.uniforms.fillMode=this.fillMode,t.applyFilter(this,e,s,i)}_randomizeSizes(){const t=this._sizes,e=this._slices-1,s=this.sampleSize,i=Math.min(this.minSize/s,.9/this._slices);if(this.average){const s=this._slices;let n=1;for(let r=0;r<e;r++){const e=n/(s-r),a=Math.max(e*(1-.6*Math.random()),i);t[r]=a,n-=a}t[e]=n}else{let s=1;const n=Math.sqrt(1/this._slices);for(let r=0;r<e;r++){const e=Math.max(n*s*Math.random(),i);t[r]=e,s-=e}t[e]=s}this.shuffle()}shuffle(){const t=this._sizes;for(let e=this._slices-1;e>0;e--){const s=Math.random()*e>>0,i=t[e];t[e]=t[s],t[s]=i}}_randomizeOffsets(){for(let t=0;t<this._slices;t++)this._offsets[t]=Math.random()*(Math.random()<.5?-1:1)}refresh(){this._randomizeSizes(),this._randomizeOffsets(),this.redraw()}redraw(){const t=this.sampleSize,e=this.texture,s=this._canvas.getContext("2d");s.clearRect(0,0,8,t);let i,n=0;for(let r=0;r<this._slices;r++){i=Math.floor(256*this._offsets[r]);const e=this._sizes[r]*t,a=i>0?i:0,o=i<0?-i:0;s.fillStyle=`rgba(${a}, ${o}, 0, 1)`,s.fillRect(0,n>>0,t,e+1>>0),n+=e}e.baseTexture.update(),this.uniforms.displacementMap=e}set sizes(t){const e=Math.min(this._slices,t.length);for(let s=0;s<e;s++)this._sizes[s]=t[s]}get sizes(){return this._sizes}set offsets(t){const e=Math.min(this._slices,t.length);for(let s=0;s<e;s++)this._offsets[s]=t[s]}get offsets(){return this._offsets}get slices(){return this._slices}set slices(t){this._slices!==t&&(this._slices=t,this.uniforms.slices=t,this._sizes=this.uniforms.slicesWidth=new Float32Array(t),this._offsets=this.uniforms.slicesOffset=new Float32Array(t),this.refresh())}get direction(){return this._direction}set direction(t){if(this._direction===t)return;this._direction=t;const e=t*Sh;this.uniforms.sinDir=Math.sin(e),this.uniforms.cosDir=Math.cos(e)}get red(){return this.uniforms.red}set red(t){this.uniforms.red=t}get green(){return this.uniforms.green}set green(t){this.uniforms.green=t}get blue(){return this.uniforms.blue}set blue(t){this.uniforms.blue=t}destroy(){var t;null==(t=this.texture)||t.destroy(!0),this.texture=this._canvas=this.red=this.green=this.blue=this._sizes=this._offsets=null}};let Im=Mm;Im.defaults={slices:5,offset:100,direction:0,fillMode:0,average:!1,seed:0,red:[0,0],green:[0,0],blue:[0,0],minSize:8,sampleSize:512},Im.TRANSPARENT=0,Im.ORIGINAL=1,Im.LOOP=2,Im.CLAMP=3,Im.MIRROR=4;var Pm="varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nuniform float outerStrength;\nuniform float innerStrength;\n\nuniform vec4 glowColor;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\nuniform bool knockout;\nuniform float alpha;\n\nconst float PI = 3.14159265358979323846264;\n\nconst float DIST = __DIST__;\nconst float ANGLE_STEP_SIZE = min(__ANGLE_STEP_SIZE__, PI * 2.0);\nconst float ANGLE_STEP_NUM = ceil(PI * 2.0 / ANGLE_STEP_SIZE);\n\nconst float MAX_TOTAL_ALPHA = ANGLE_STEP_NUM * DIST * (DIST + 1.0) / 2.0;\n\nvoid main(void) {\n    vec2 px = vec2(1.0 / filterArea.x, 1.0 / filterArea.y);\n\n    float totalAlpha = 0.0;\n\n    vec2 direction;\n    vec2 displaced;\n    vec4 curColor;\n\n    for (float angle = 0.0; angle < PI * 2.0; angle += ANGLE_STEP_SIZE) {\n       direction = vec2(cos(angle), sin(angle)) * px;\n\n       for (float curDistance = 0.0; curDistance < DIST; curDistance++) {\n           displaced = clamp(vTextureCoord + direction * \n                   (curDistance + 1.0), filterClamp.xy, filterClamp.zw);\n\n           curColor = texture2D(uSampler, displaced);\n\n           totalAlpha += (DIST - curDistance) * curColor.a;\n       }\n    }\n    \n    curColor = texture2D(uSampler, vTextureCoord);\n\n    float alphaRatio = (totalAlpha / MAX_TOTAL_ALPHA);\n\n    float innerGlowAlpha = (1.0 - alphaRatio) * innerStrength * curColor.a;\n    float innerGlowStrength = min(1.0, innerGlowAlpha);\n    \n    vec4 innerColor = mix(curColor, glowColor, innerGlowStrength);\n\n    float outerGlowAlpha = alphaRatio * outerStrength * (1. - curColor.a);\n    float outerGlowStrength = min(1.0 - innerColor.a, outerGlowAlpha);\n\n    if (knockout) {\n      float resultAlpha = (outerGlowAlpha + innerGlowAlpha) * alpha;\n      gl_FragColor = vec4(glowColor.rgb * resultAlpha, resultAlpha);\n    }\n    else {\n      vec4 outerGlowColor = outerGlowStrength * glowColor.rgba * alpha;\n      gl_FragColor = innerColor + outerGlowColor;\n    }\n}\n";const Rm=class extends wl{constructor(t){const e=Object.assign({},Rm.defaults,t),{outerStrength:s,innerStrength:i,color:n,knockout:r,quality:a,alpha:o}=e,h=Math.round(e.distance);super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",Pm.replace(/__ANGLE_STEP_SIZE__/gi,`${(1/a/h).toFixed(7)}`).replace(/__DIST__/gi,`${h.toFixed(0)}.0`)),this.uniforms.glowColor=new Float32Array([0,0,0,1]),this.uniforms.alpha=1,Object.assign(this,{color:n,outerStrength:s,innerStrength:i,padding:h,knockout:r,alpha:o})}get color(){return Mo(this.uniforms.glowColor)}set color(t){Co(t,this.uniforms.glowColor)}get outerStrength(){return this.uniforms.outerStrength}set outerStrength(t){this.uniforms.outerStrength=t}get innerStrength(){return this.uniforms.innerStrength}set innerStrength(t){this.uniforms.innerStrength=t}get knockout(){return this.uniforms.knockout}set knockout(t){this.uniforms.knockout=t}get alpha(){return this.uniforms.alpha}set alpha(t){this.uniforms.alpha=t}};Rm.defaults={distance:10,outerStrength:4,innerStrength:0,color:16777215,quality:.1,knockout:!1,alpha:1};var km="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nuniform vec2 light;\nuniform bool parallel;\nuniform float aspect;\n\nuniform float gain;\nuniform float lacunarity;\nuniform float time;\nuniform float alpha;\n\n${perlin}\n\nvoid main(void) {\n    vec2 coord = vTextureCoord * filterArea.xy / dimensions.xy;\n\n    float d;\n\n    if (parallel) {\n        float _cos = light.x;\n        float _sin = light.y;\n        d = (_cos * coord.x) + (_sin * coord.y * aspect);\n    } else {\n        float dx = coord.x - light.x / dimensions.x;\n        float dy = (coord.y - light.y / dimensions.y) * aspect;\n        float dis = sqrt(dx * dx + dy * dy) + 0.00001;\n        d = dy / dis;\n    }\n\n    vec3 dir = vec3(d, d, 0.0);\n\n    float noise = turb(dir + vec3(time, 0.0, 62.1 + time) * 0.05, vec3(480.0, 320.0, 480.0), lacunarity, gain);\n    noise = mix(noise, 0.0, 0.3);\n    //fade vertically.\n    vec4 mist = vec4(noise, noise, noise, 1.0) * (1.0 - coord.y);\n    mist.a = 1.0;\n    // apply user alpha\n    mist *= alpha;\n\n    gl_FragColor = texture2D(uSampler, vTextureCoord) + mist;\n\n}\n";const Dm=class extends wl{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",km.replace("${perlin}","vec3 mod289(vec3 x)\n{\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 mod289(vec4 x)\n{\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 permute(vec4 x)\n{\n    return mod289(((x * 34.0) + 1.0) * x);\n}\nvec4 taylorInvSqrt(vec4 r)\n{\n    return 1.79284291400159 - 0.85373472095314 * r;\n}\nvec3 fade(vec3 t)\n{\n    return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\n}\n// Classic Perlin noise, periodic variant\nfloat pnoise(vec3 P, vec3 rep)\n{\n    vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period\n    vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period\n    Pi0 = mod289(Pi0);\n    Pi1 = mod289(Pi1);\n    vec3 Pf0 = fract(P); // Fractional part for interpolation\n    vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n    vec4 iy = vec4(Pi0.yy, Pi1.yy);\n    vec4 iz0 = Pi0.zzzz;\n    vec4 iz1 = Pi1.zzzz;\n    vec4 ixy = permute(permute(ix) + iy);\n    vec4 ixy0 = permute(ixy + iz0);\n    vec4 ixy1 = permute(ixy + iz1);\n    vec4 gx0 = ixy0 * (1.0 / 7.0);\n    vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n    gx0 = fract(gx0);\n    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n    vec4 sz0 = step(gz0, vec4(0.0));\n    gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n    gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n    vec4 gx1 = ixy1 * (1.0 / 7.0);\n    vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n    gx1 = fract(gx1);\n    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n    vec4 sz1 = step(gz1, vec4(0.0));\n    gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n    gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n    vec3 g000 = vec3(gx0.x, gy0.x, gz0.x);\n    vec3 g100 = vec3(gx0.y, gy0.y, gz0.y);\n    vec3 g010 = vec3(gx0.z, gy0.z, gz0.z);\n    vec3 g110 = vec3(gx0.w, gy0.w, gz0.w);\n    vec3 g001 = vec3(gx1.x, gy1.x, gz1.x);\n    vec3 g101 = vec3(gx1.y, gy1.y, gz1.y);\n    vec3 g011 = vec3(gx1.z, gy1.z, gz1.z);\n    vec3 g111 = vec3(gx1.w, gy1.w, gz1.w);\n    vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n    g000 *= norm0.x;\n    g010 *= norm0.y;\n    g100 *= norm0.z;\n    g110 *= norm0.w;\n    vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n    g001 *= norm1.x;\n    g011 *= norm1.y;\n    g101 *= norm1.z;\n    g111 *= norm1.w;\n    float n000 = dot(g000, Pf0);\n    float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n    float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n    float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n    float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n    float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n    float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n    float n111 = dot(g111, Pf1);\n    vec3 fade_xyz = fade(Pf0);\n    vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n    vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n    float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n    return 2.2 * n_xyz;\n}\nfloat turb(vec3 P, vec3 rep, float lacunarity, float gain)\n{\n    float sum = 0.0;\n    float sc = 1.0;\n    float totalgain = 1.0;\n    for (float i = 0.0; i < 6.0; i++)\n    {\n        sum += totalgain * pnoise(P * sc, rep);\n        sc *= lacunarity;\n        totalgain *= gain;\n    }\n    return abs(sum);\n}\n")),this.parallel=!0,this.time=0,this._angle=0,this.uniforms.dimensions=new Float32Array(2);const e=Object.assign(Dm.defaults,t);this._angleLight=new Ah,this.angle=e.angle,this.gain=e.gain,this.lacunarity=e.lacunarity,this.alpha=e.alpha,this.parallel=e.parallel,this.center=e.center,this.time=e.time}apply(t,e,s,i){const{width:n,height:r}=e.filterFrame;this.uniforms.light=this.parallel?this._angleLight:this.center,this.uniforms.parallel=this.parallel,this.uniforms.dimensions[0]=n,this.uniforms.dimensions[1]=r,this.uniforms.aspect=r/n,this.uniforms.time=this.time,this.uniforms.alpha=this.alpha,t.applyFilter(this,e,s,i)}get angle(){return this._angle}set angle(t){this._angle=t;const e=t*Sh;this._angleLight.x=Math.cos(e),this._angleLight.y=Math.sin(e)}get gain(){return this.uniforms.gain}set gain(t){this.uniforms.gain=t}get lacunarity(){return this.uniforms.lacunarity}set lacunarity(t){this.uniforms.lacunarity=t}get alpha(){return this.uniforms.alpha}set alpha(t){this.uniforms.alpha=t}};Dm.defaults={angle:30,gain:.5,lacunarity:2.5,time:0,parallel:!0,center:[0,0],alpha:1};const Fm=class extends wl{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","precision mediump float;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float uHue;\nuniform float uAlpha;\nuniform bool uColorize;\nuniform float uSaturation;\nuniform float uLightness;\n\n// https://en.wikipedia.org/wiki/Luma_(video)\nconst vec3 weight = vec3(0.299, 0.587, 0.114);\n\nfloat getWeightedAverage(vec3 rgb) {\n    return rgb.r * weight.r + rgb.g * weight.g + rgb.b * weight.b;\n}\n\n// https://gist.github.com/mairod/a75e7b44f68110e1576d77419d608786?permalink_comment_id=3195243#gistcomment-3195243\nconst vec3 k = vec3(0.57735, 0.57735, 0.57735);\n\nvec3 hueShift(vec3 color, float angle) {\n    float cosAngle = cos(angle);\n    return vec3(\n    color * cosAngle +\n    cross(k, color) * sin(angle) +\n    k * dot(k, color) * (1.0 - cosAngle)\n    );\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    vec4 result = color;\n\n    // colorize\n    if (uColorize) {\n        result.rgb = vec3(getWeightedAverage(result.rgb), 0., 0.);\n    }\n\n    // hue\n    result.rgb = hueShift(result.rgb, uHue);\n\n    // saturation\n    // https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/huesaturation.js\n    float average = (result.r + result.g + result.b) / 3.0;\n\n    if (uSaturation > 0.) {\n        result.rgb += (average - result.rgb) * (1. - 1. / (1.001 - uSaturation));\n    } else {\n        result.rgb -= (average - result.rgb) * uSaturation;\n    }\n\n    // lightness\n    result.rgb = mix(result.rgb, vec3(ceil(uLightness)) * color.a, abs(uLightness));\n\n    // alpha\n    gl_FragColor = mix(color, result, uAlpha);\n}\n"),this._hue=0;const e=Object.assign({},Fm.defaults,t);Object.assign(this,e)}get hue(){return this._hue}set hue(t){this._hue=t,this.uniforms.uHue=this._hue*(Math.PI/180)}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}get colorize(){return this.uniforms.uColorize}set colorize(t){this.uniforms.uColorize=t}get lightness(){return this.uniforms.uLightness}set lightness(t){this.uniforms.uLightness=t}get saturation(){return this.uniforms.uSaturation}set saturation(t){this.uniforms.uSaturation=t}};Fm.defaults={hue:0,saturation:0,lightness:0,colorize:!1,alpha:1};const Om=class extends wl{constructor(t,e=0){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nuniform float sepia;\nuniform float noise;\nuniform float noiseSize;\nuniform float scratch;\nuniform float scratchDensity;\nuniform float scratchWidth;\nuniform float vignetting;\nuniform float vignettingAlpha;\nuniform float vignettingBlur;\nuniform float seed;\n\nconst float SQRT_2 = 1.414213;\nconst vec3 SEPIA_RGB = vec3(112.0 / 255.0, 66.0 / 255.0, 20.0 / 255.0);\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvec3 Overlay(vec3 src, vec3 dst)\n{\n    // if (dst <= 0.5) then: 2 * src * dst\n    // if (dst > 0.5) then: 1 - 2 * (1 - dst) * (1 - src)\n    return vec3((dst.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)),\n                (dst.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)),\n                (dst.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)));\n}\n\n\nvoid main()\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord);\n    vec3 color = gl_FragColor.rgb;\n\n    if (sepia > 0.0)\n    {\n        float gray = (color.x + color.y + color.z) / 3.0;\n        vec3 grayscale = vec3(gray);\n\n        color = Overlay(SEPIA_RGB, grayscale);\n\n        color = grayscale + sepia * (color - grayscale);\n    }\n\n    vec2 coord = vTextureCoord * filterArea.xy / dimensions.xy;\n\n    if (vignetting > 0.0)\n    {\n        float outter = SQRT_2 - vignetting * SQRT_2;\n        vec2 dir = vec2(vec2(0.5, 0.5) - coord);\n        dir.y *= dimensions.y / dimensions.x;\n        float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + vignettingBlur * SQRT_2), 0.0, 1.0);\n        color.rgb *= darker + (1.0 - darker) * (1.0 - vignettingAlpha);\n    }\n\n    if (scratchDensity > seed && scratch != 0.0)\n    {\n        float phase = seed * 256.0;\n        float s = mod(floor(phase), 2.0);\n        float dist = 1.0 / scratchDensity;\n        float d = distance(coord, vec2(seed * dist, abs(s - seed * dist)));\n        if (d < seed * 0.6 + 0.4)\n        {\n            highp float period = scratchDensity * 10.0;\n\n            float xx = coord.x * period + phase;\n            float aa = abs(mod(xx, 0.5) * 4.0);\n            float bb = mod(floor(xx / 0.5), 2.0);\n            float yy = (1.0 - bb) * aa + bb * (2.0 - aa);\n\n            float kk = 2.0 * period;\n            float dw = scratchWidth / dimensions.x * (0.75 + seed);\n            float dh = dw * kk;\n\n            float tine = (yy - (2.0 - dh));\n\n            if (tine > 0.0) {\n                float _sign = sign(scratch);\n\n                tine = s * tine / period + scratch + 0.1;\n                tine = clamp(tine + 1.0, 0.5 + _sign * 0.5, 1.5 + _sign * 0.5);\n\n                color.rgb *= tine;\n            }\n        }\n    }\n\n    if (noise > 0.0 && noiseSize > 0.0)\n    {\n        vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;\n        pixelCoord.x = floor(pixelCoord.x / noiseSize);\n        pixelCoord.y = floor(pixelCoord.y / noiseSize);\n        // vec2 d = pixelCoord * noiseSize * vec2(1024.0 + seed * 512.0, 1024.0 - seed * 512.0);\n        // float _noise = snoise(d) * 0.5;\n        float _noise = rand(pixelCoord * noiseSize * seed) - 0.5;\n        color += _noise * noise;\n    }\n\n    gl_FragColor.rgb = color;\n}\n"),this.seed=0,this.uniforms.dimensions=new Float32Array(2),"number"==typeof t?(this.seed=t,t=void 0):this.seed=e,Object.assign(this,Om.defaults,t)}apply(t,e,s,i){var n,r;this.uniforms.dimensions[0]=null==(n=e.filterFrame)?void 0:n.width,this.uniforms.dimensions[1]=null==(r=e.filterFrame)?void 0:r.height,this.uniforms.seed=this.seed,t.applyFilter(this,e,s,i)}set sepia(t){this.uniforms.sepia=t}get sepia(){return this.uniforms.sepia}set noise(t){this.uniforms.noise=t}get noise(){return this.uniforms.noise}set noiseSize(t){this.uniforms.noiseSize=t}get noiseSize(){return this.uniforms.noiseSize}set scratch(t){this.uniforms.scratch=t}get scratch(){return this.uniforms.scratch}set scratchDensity(t){this.uniforms.scratchDensity=t}get scratchDensity(){return this.uniforms.scratchDensity}set scratchWidth(t){this.uniforms.scratchWidth=t}get scratchWidth(){return this.uniforms.scratchWidth}set vignetting(t){this.uniforms.vignetting=t}get vignetting(){return this.uniforms.vignetting}set vignettingAlpha(t){this.uniforms.vignettingAlpha=t}get vignettingAlpha(){return this.uniforms.vignettingAlpha}set vignettingBlur(t){this.uniforms.vignettingBlur=t}get vignettingBlur(){return this.uniforms.vignettingBlur}};Om.defaults={sepia:.3,noise:.3,noiseSize:1,scratch:.5,scratchDensity:.3,scratchWidth:1,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3};var Nm="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterClamp;\n\nuniform float uAlpha;\nuniform vec2 uThickness;\nuniform vec4 uColor;\nuniform bool uKnockout;\n\nconst float DOUBLE_PI = 2. * 3.14159265358979323846264;\nconst float ANGLE_STEP = ${angleStep};\n\nfloat outlineMaxAlphaAtPos(vec2 pos) {\n    if (uThickness.x == 0. || uThickness.y == 0.) {\n        return 0.;\n    }\n\n    vec4 displacedColor;\n    vec2 displacedPos;\n    float maxAlpha = 0.;\n\n    for (float angle = 0.; angle <= DOUBLE_PI; angle += ANGLE_STEP) {\n        displacedPos.x = vTextureCoord.x + uThickness.x * cos(angle);\n        displacedPos.y = vTextureCoord.y + uThickness.y * sin(angle);\n        displacedColor = texture2D(uSampler, clamp(displacedPos, filterClamp.xy, filterClamp.zw));\n        maxAlpha = max(maxAlpha, displacedColor.a);\n    }\n\n    return maxAlpha;\n}\n\nvoid main(void) {\n    vec4 sourceColor = texture2D(uSampler, vTextureCoord);\n    vec4 contentColor = sourceColor * float(!uKnockout);\n    float outlineAlpha = uAlpha * outlineMaxAlphaAtPos(vTextureCoord.xy) * (1.-sourceColor.a);\n    vec4 outlineColor = vec4(vec3(uColor) * outlineAlpha, outlineAlpha);\n    gl_FragColor = contentColor + outlineColor;\n}\n";const Bm=class extends wl{constructor(t=1,e=0,s=.1,i=1,n=!1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",Nm.replace(/\$\{angleStep\}/,Bm.getAngleStep(s))),this._thickness=1,this._alpha=1,this._knockout=!1,this.uniforms.uThickness=new Float32Array([0,0]),this.uniforms.uColor=new Float32Array([0,0,0,1]),this.uniforms.uAlpha=i,this.uniforms.uKnockout=n,Object.assign(this,{thickness:t,color:e,quality:s,alpha:i,knockout:n})}static getAngleStep(t){const e=Math.max(t*Bm.MAX_SAMPLES,Bm.MIN_SAMPLES);return(2*Math.PI/e).toFixed(7)}apply(t,e,s,i){this.uniforms.uThickness[0]=this._thickness/e._frame.width,this.uniforms.uThickness[1]=this._thickness/e._frame.height,this.uniforms.uAlpha=this._alpha,this.uniforms.uKnockout=this._knockout,t.applyFilter(this,e,s,i)}get alpha(){return this._alpha}set alpha(t){this._alpha=t}get color(){return Mo(this.uniforms.uColor)}set color(t){Co(t,this.uniforms.uColor)}get knockout(){return this._knockout}set knockout(t){this._knockout=t}get thickness(){return this._thickness}set thickness(t){this._thickness=t,this.padding=t}};let Lm=Bm;Lm.MIN_SAMPLES=1,Lm.MAX_SAMPLES=100;const Vm=class extends wl{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\nuniform vec2 dimensions;\n\nuniform bool mirror;\nuniform float boundary;\nuniform vec2 amplitude;\nuniform vec2 waveLength;\nuniform vec2 alpha;\nuniform float time;\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main(void)\n{\n    vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;\n    vec2 coord = pixelCoord / dimensions;\n\n    if (coord.y < boundary) {\n        gl_FragColor = texture2D(uSampler, vTextureCoord);\n        return;\n    }\n\n    float k = (coord.y - boundary) / (1. - boundary + 0.0001);\n    float areaY = boundary * dimensions.y / filterArea.y;\n    float v = areaY + areaY - vTextureCoord.y;\n    float y = mirror ? v : vTextureCoord.y;\n\n    float _amplitude = ((amplitude.y - amplitude.x) * k + amplitude.x ) / filterArea.x;\n    float _waveLength = ((waveLength.y - waveLength.x) * k + waveLength.x) / filterArea.y;\n    float _alpha = (alpha.y - alpha.x) * k + alpha.x;\n\n    float x = vTextureCoord.x + cos(v * 6.28 / _waveLength - time) * _amplitude;\n    x = clamp(x, filterClamp.x, filterClamp.z);\n\n    vec4 color = texture2D(uSampler, vec2(x, y));\n\n    gl_FragColor = color * _alpha;\n}\n"),this.time=0,this.uniforms.amplitude=new Float32Array(2),this.uniforms.waveLength=new Float32Array(2),this.uniforms.alpha=new Float32Array(2),this.uniforms.dimensions=new Float32Array(2),Object.assign(this,Vm.defaults,t)}apply(t,e,s,i){var n,r;this.uniforms.dimensions[0]=null==(n=e.filterFrame)?void 0:n.width,this.uniforms.dimensions[1]=null==(r=e.filterFrame)?void 0:r.height,this.uniforms.time=this.time,t.applyFilter(this,e,s,i)}set mirror(t){this.uniforms.mirror=t}get mirror(){return this.uniforms.mirror}set boundary(t){this.uniforms.boundary=t}get boundary(){return this.uniforms.boundary}set amplitude(t){this.uniforms.amplitude[0]=t[0],this.uniforms.amplitude[1]=t[1]}get amplitude(){return this.uniforms.amplitude}set waveLength(t){this.uniforms.waveLength[0]=t[0],this.uniforms.waveLength[1]=t[1]}get waveLength(){return this.uniforms.waveLength}set alpha(t){this.uniforms.alpha[0]=t[0],this.uniforms.alpha[1]=t[1]}get alpha(){return this.uniforms.alpha}};Vm.defaults={mirror:!0,boundary:.5,amplitude:[0,20],waveLength:[30,100],alpha:[1,1],time:0};const $m=class extends wl{constructor(t=[0,0],e,s=0){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\n\nuniform vec2 center;\n\nuniform float amplitude;\nuniform float wavelength;\n// uniform float power;\nuniform float brightness;\nuniform float speed;\nuniform float radius;\n\nuniform float time;\n\nconst float PI = 3.14159;\n\nvoid main()\n{\n    float halfWavelength = wavelength * 0.5 / filterArea.x;\n    float maxRadius = radius / filterArea.x;\n    float currentRadius = time * speed / filterArea.x;\n\n    float fade = 1.0;\n\n    if (maxRadius > 0.0) {\n        if (currentRadius > maxRadius) {\n            gl_FragColor = texture2D(uSampler, vTextureCoord);\n            return;\n        }\n        fade = 1.0 - pow(currentRadius / maxRadius, 2.0);\n    }\n\n    vec2 dir = vec2(vTextureCoord - center / filterArea.xy);\n    dir.y *= filterArea.y / filterArea.x;\n    float dist = length(dir);\n\n    if (dist <= 0.0 || dist < currentRadius - halfWavelength || dist > currentRadius + halfWavelength) {\n        gl_FragColor = texture2D(uSampler, vTextureCoord);\n        return;\n    }\n\n    vec2 diffUV = normalize(dir);\n\n    float diff = (dist - currentRadius) / halfWavelength;\n\n    float p = 1.0 - pow(abs(diff), 2.0);\n\n    // float powDiff = diff * pow(p, 2.0) * ( amplitude * fade );\n    float powDiff = 1.25 * sin(diff * PI) * p * ( amplitude * fade );\n\n    vec2 offset = diffUV * powDiff / filterArea.xy;\n\n    // Do clamp :\n    vec2 coord = vTextureCoord + offset;\n    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);\n    vec4 color = texture2D(uSampler, clampedCoord);\n    if (coord != clampedCoord) {\n        color *= max(0.0, 1.0 - length(coord - clampedCoord));\n    }\n\n    // No clamp :\n    // gl_FragColor = texture2D(uSampler, vTextureCoord + offset);\n\n    color.rgb *= 1.0 + (brightness - 1.0) * p * fade;\n\n    gl_FragColor = color;\n}\n"),this.center=t,Object.assign(this,$m.defaults,e),this.time=s}apply(t,e,s,i){this.uniforms.time=this.time,t.applyFilter(this,e,s,i)}get center(){return this.uniforms.center}set center(t){this.uniforms.center=t}get amplitude(){return this.uniforms.amplitude}set amplitude(t){this.uniforms.amplitude=t}get wavelength(){return this.uniforms.wavelength}set wavelength(t){this.uniforms.wavelength=t}get brightness(){return this.uniforms.brightness}set brightness(t){this.uniforms.brightness=t}get speed(){return this.uniforms.speed}set speed(t){this.uniforms.speed=t}get radius(){return this.uniforms.radius}set radius(t){this.uniforms.radius=t}};$m.defaults={amplitude:30,wavelength:160,brightness:1,speed:500,radius:-1};let Um=class extends wl{constructor(t){var e,s;super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float blur;\nuniform float gradientBlur;\nuniform vec2 start;\nuniform vec2 end;\nuniform vec2 delta;\nuniform vec2 texSize;\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n    vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\n    float radius = smoothstep(0.0, 1.0, abs(dot(vTextureCoord * texSize - start, normal)) / gradientBlur) * blur;\n\n    for (float t = -30.0; t <= 30.0; t++)\n    {\n        float percent = (t + offset - 0.5) / 30.0;\n        float weight = 1.0 - abs(percent);\n        vec4 sample = texture2D(uSampler, vTextureCoord + delta / texSize * percent * radius);\n        sample.rgb *= sample.a;\n        color += sample * weight;\n        total += weight;\n    }\n\n    color /= total;\n    color.rgb /= color.a + 0.00001;\n\n    gl_FragColor = color;\n}\n"),this.uniforms.blur=t.blur,this.uniforms.gradientBlur=t.gradientBlur,this.uniforms.start=null!=(e=t.start)?e:new Ah(0,window.innerHeight/2),this.uniforms.end=null!=(s=t.end)?s:new Ah(600,window.innerHeight/2),this.uniforms.delta=new Ah(30,30),this.uniforms.texSize=new Ah(window.innerWidth,window.innerHeight),this.updateDelta()}updateDelta(){this.uniforms.delta.x=0,this.uniforms.delta.y=0}get blur(){return this.uniforms.blur}set blur(t){this.uniforms.blur=t}get gradientBlur(){return this.uniforms.gradientBlur}set gradientBlur(t){this.uniforms.gradientBlur=t}get start(){return this.uniforms.start}set start(t){this.uniforms.start=t,this.updateDelta()}get end(){return this.uniforms.end}set end(t){this.uniforms.end=t,this.updateDelta()}},Xm=class extends Um{updateDelta(){const t=this.uniforms.end.x-this.uniforms.start.x,e=this.uniforms.end.y-this.uniforms.start.y,s=Math.sqrt(t*t+e*e);this.uniforms.delta.x=t/s,this.uniforms.delta.y=e/s}},Ym=class extends Um{updateDelta(){const t=this.uniforms.end.x-this.uniforms.start.x,e=this.uniforms.end.y-this.uniforms.start.y,s=Math.sqrt(t*t+e*e);this.uniforms.delta.x=-e/s,this.uniforms.delta.y=t/s}};const Wm=class extends wl{constructor(t,e,s,i){super(),"number"==typeof t&&(za("5.3.0","TiltShiftFilter constructor arguments is deprecated, use options."),t={blur:t,gradientBlur:e,start:s,end:i}),t=Object.assign({},Wm.defaults,t),this.tiltShiftXFilter=new Xm(t),this.tiltShiftYFilter=new Ym(t)}apply(t,e,s,i){const n=t.getFilterTexture();this.tiltShiftXFilter.apply(t,e,n,1),this.tiltShiftYFilter.apply(t,n,s,i),t.returnFilterTexture(n)}get blur(){return this.tiltShiftXFilter.blur}set blur(t){this.tiltShiftXFilter.blur=this.tiltShiftYFilter.blur=t}get gradientBlur(){return this.tiltShiftXFilter.gradientBlur}set gradientBlur(t){this.tiltShiftXFilter.gradientBlur=this.tiltShiftYFilter.gradientBlur=t}get start(){return this.tiltShiftXFilter.start}set start(t){this.tiltShiftXFilter.start=this.tiltShiftYFilter.start=t}get end(){return this.tiltShiftXFilter.end}set end(t){this.tiltShiftXFilter.end=this.tiltShiftYFilter.end=t}};Wm.defaults={blur:100,gradientBlur:600,start:void 0,end:void 0};const jm=class extends wl{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform vec4 filterArea;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= filterArea.xy;\n    coord += filterArea.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= filterArea.zw;\n    coord /= filterArea.xy;\n\n    return coord;\n}\n\nvec2 twist(vec2 coord)\n{\n    coord -= offset;\n\n    float dist = length(coord);\n\n    if (dist < radius)\n    {\n        float ratioDist = (radius - dist) / radius;\n        float angleMod = ratioDist * ratioDist * angle;\n        float s = sin(angleMod);\n        float c = cos(angleMod);\n        coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);\n    }\n\n    coord += offset;\n\n    return coord;\n}\n\nvoid main(void)\n{\n\n    vec2 coord = mapCoord(vTextureCoord);\n\n    coord = twist(coord);\n\n    coord = unmapCoord(coord);\n\n    gl_FragColor = texture2D(uSampler, coord );\n\n}\n"),Object.assign(this,jm.defaults,t)}get offset(){return this.uniforms.offset}set offset(t){this.uniforms.offset=t}get radius(){return this.uniforms.radius}set radius(t){this.uniforms.radius=t}get angle(){return this.uniforms.angle}set angle(t){this.uniforms.angle=t}};jm.defaults={radius:200,angle:4,padding:20,offset:new Ah};var Gm="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\n\nuniform vec2 uCenter;\nuniform float uStrength;\nuniform float uInnerRadius;\nuniform float uRadius;\n\nconst float MAX_KERNEL_SIZE = ${maxKernelSize};\n\n// author: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand(vec2 co, float seed) {\n    const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n    highp float dt = dot(co + seed, vec2(a, b)), sn = mod(dt, 3.14159);\n    return fract(sin(sn) * c + seed);\n}\n\nvoid main() {\n\n    float minGradient = uInnerRadius * 0.3;\n    float innerRadius = (uInnerRadius + minGradient * 0.5) / filterArea.x;\n\n    float gradient = uRadius * 0.3;\n    float radius = (uRadius - gradient * 0.5) / filterArea.x;\n\n    float countLimit = MAX_KERNEL_SIZE;\n\n    vec2 dir = vec2(uCenter.xy / filterArea.xy - vTextureCoord);\n    float dist = length(vec2(dir.x, dir.y * filterArea.y / filterArea.x));\n\n    float strength = uStrength;\n\n    float delta = 0.0;\n    float gap;\n    if (dist < innerRadius) {\n        delta = innerRadius - dist;\n        gap = minGradient;\n    } else if (radius >= 0.0 && dist > radius) { // radius < 0 means it's infinity\n        delta = dist - radius;\n        gap = gradient;\n    }\n\n    if (delta > 0.0) {\n        float normalCount = gap / filterArea.x;\n        delta = (normalCount - delta) / normalCount;\n        countLimit *= delta;\n        strength *= delta;\n        if (countLimit < 1.0)\n        {\n            gl_FragColor = texture2D(uSampler, vTextureCoord);\n            return;\n        }\n    }\n\n    // randomize the lookup values to hide the fixed number of samples\n    float offset = rand(vTextureCoord, 0.0);\n\n    float total = 0.0;\n    vec4 color = vec4(0.0);\n\n    dir *= strength;\n\n    for (float t = 0.0; t < MAX_KERNEL_SIZE; t++) {\n        float percent = (t + offset) / MAX_KERNEL_SIZE;\n        float weight = 4.0 * (percent - percent * percent);\n        vec2 p = vTextureCoord + dir * percent;\n        vec4 sample = texture2D(uSampler, p);\n\n        // switch to pre-multiplied alpha to correctly blur transparent images\n        // sample.rgb *= sample.a;\n\n        color += sample * weight;\n        total += weight;\n\n        if (t > countLimit){\n            break;\n        }\n    }\n\n    color /= total;\n    // switch back from pre-multiplied alpha\n    // color.rgb /= color.a + 0.00001;\n\n    gl_FragColor = color;\n}\n",zm=Object.getOwnPropertySymbols,Hm=Object.prototype.hasOwnProperty,qm=Object.prototype.propertyIsEnumerable;const Km=class extends wl{constructor(t){const e=Object.assign(Km.defaults,t),{maxKernelSize:s}=e,i=((t,e)=>{var s={};for(var i in t)Hm.call(t,i)&&e.indexOf(i)<0&&(s[i]=t[i]);if(null!=t&&zm)for(var i of zm(t))e.indexOf(i)<0&&qm.call(t,i)&&(s[i]=t[i]);return s})(e,["maxKernelSize"]);super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",Gm.replace("${maxKernelSize}",s.toFixed(1))),Object.assign(this,i)}get center(){return this.uniforms.uCenter}set center(t){this.uniforms.uCenter=t}get strength(){return this.uniforms.uStrength}set strength(t){this.uniforms.uStrength=t}get innerRadius(){return this.uniforms.uInnerRadius}set innerRadius(t){this.uniforms.uInnerRadius=t}get radius(){return this.uniforms.uRadius}set radius(t){(t<0||t===1/0)&&(t=-1),this.uniforms.uRadius=t}};Km.defaults={strength:.1,center:[0,0],innerRadius:0,radius:-1,maxKernelSize:32};var Zm=(t=>(t[t.None=0]="None",t[t.TopLeft=1]="TopLeft",t[t.TopMiddle=2]="TopMiddle",t[t.TopRight=3]="TopRight",t[t.Center=4]="Center",t[t.MiddleLeft=5]="MiddleLeft",t[t.MiddleRight=6]="MiddleRight",t[t.BottomLeft=7]="BottomLeft",t[t.BottomMiddle=8]="BottomMiddle",t[t.BottomRight=9]="BottomRight",t))(Zm||{});function Qm(t,e,s){switch(e){case 1:t.set(s.x,s.y);break;case 2:t.set(s.x+s.width/2,s.y);break;case 3:t.set(s.x+s.width,s.y);break;case 4:t.set(s.x+s.width/2,s.y+s.height/2);break;case 5:t.set(s.x,s.y+s.height/2);break;case 6:t.set(s.x+s.width,s.y+s.height/2);break;case 7:t.set(s.x,s.y+s.height);break;case 8:t.set(s.x+s.width/2,s.y+s.height);break;case 9:t.set(s.x+s.width,s.y+s.height)}}function Jm(t,e){switch(e){case 1:t.set(0);break;case 2:t.set(.5,0);break;case 3:t.set(1,0);break;case 4:t.set(.5);break;case 5:t.set(0,.5);break;case 6:t.set(1,.5);break;case 7:t.set(0,1);break;case 8:t.set(.5,1);break;case 9:t.set(1,1)}}const tg={Black:0,White:16777215,Gray:8421504,LightGray:13882323,DarkGray:6316128,Brown:7217408,Red:16711680,DarkRed:9109504,Pink:16761035,DeepPink:16716947,Orange:16753920,Gold:16766720,Yellow:16776960,LightYellow:13613654,Green:65280,DarkGreen:25600,SpringGreen:65407,Aqua:8388564,Blue:255,DarkBlue:139,SkyBlue:49151,LightBlue:8900346,Purple:8388736,Magneta:16711935},eg={e:2.718281828459045,log2e:1.4426950408889634,log10e:.4342944819032518,ln2:.6931471805599453,ln10:2.302585092994046,pi:3.141592653589793,pi2:6.283185307179586,pi1_2:1.5707963267948966,pi1_4:.7853981633974483,_1_pi:.3183098861837907,_2_pi:.6366197723675814,sqrt2:1.4142135623730951,_1_sqrt2:.7071067811865476},sg=new class{constructor(){d(this,"minLayer",-9999),d(this,"maxLayer",9999),d(this,"colorFilter")}init(){this.colorFilter=new vm}};function ig(t){const e=t,s=e===hu||hu.prototype.isPrototypeOf(e.prototype);class i extends e{constructor(){super(...arguments),d(this,"name",""),d(this,"_pivotRule",Zm.None)}get parentContainer(){return this.parent}get pivotRule(){return this._pivotRule}set pivotRule(t){if(this._pivotRule=t,this.debugBox){this._hideDebugBox();const e=this.unscaledBound;s?Jm(this.anchor,t):Qm(this.pivot,t,e),this._drawDebugBox(e)}else s?Jm(this.anchor,t):Qm(this.pivot,t,this.unscaledBound)}refreshPivotPoint(){this.pivotRule=this._pivotRule}get unscaledBound(){return this.getLocalBounds(void 0,!0)}get layer(){return this.zIndex}set layer(t){this.zIndex=t}hasParent(){return!!this.parent}get radian(){return this.rotation}set radian(t){this.rotation=t%eg.pi2}useViewStyle(t){void 0!==t.xy&&(this.x=t.xy[0],this.y=t.xy[1]),void 0!==t.s&&(Array.isArray(t.s)?(this.width=t.s[0],this.height=t.s[1]):this.scale.set(t.s)),void 0!==t.vis&&(this.visible=t.vis)}addFilter(t){null===this.filters&&(this.filters=[]),this.filters.push(t)}get debugBox(){return void 0!==this._debugBox&&this._debugBox.visible}set debugBox(t){t?this._drawDebugBox(this.unscaledBound):this._hideDebugBox()}_drawDebugBox(t){void 0===this._debugBox?(this._debugBox=new kp,this._debugBox.name="debugBox",this._debugBox.zIndex=sg.maxLayer+1,this.addChild(this._debugBox)):this._debugBox.visible=!0;const e=Object.getPrototypeOf(this).constructor._debugFillStyle,i=Object.getPrototypeOf(this).constructor._debugLineStyle;i.alignment=0;const n=s?new Mh(0,0,5,5):new Mh(this.pivot.x,this.pivot.y,5,5);this._debugBox.geometry.clear().drawShape(t,e,i).drawShape(n,i,i)}_hideDebugBox(){void 0!==this._debugBox&&(this._debugBox.visible=!1)}}return d(i,"_debugFillStyle",(()=>{const t=new Mp;return t.visible=!1,t})()),d(i,"_debugLineStyle",(()=>{const t=new Ip;return t.visible=!0,t.color=tg.Blue,t.alpha=1,t.width=2,t})()),i}function ng(t){return void 0!==t.useLocale}globalThis.doNothing=()=>{},ru.prototype.update=globalThis.doNothing;const rg={code:"",name:"",defaultFont:"",dict:{},styles:{}},ag={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.sin((1-t)*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.sin(Math.PI*(.5-t)))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){const e=1.70158;return 1===t?1:t*t*((e+1)*t-e)},Out:function(t){const e=1.70158;return 0===t?0:--t*t*((e+1)*t+e)+1},InOut:function(t){const e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-ag.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*ag.Bounce.In(2*t):.5*ag.Bounce.Out(2*t-1)+.5}},generatePow:function(t=4){return t=(t=t<Number.EPSILON?Number.EPSILON:t)>1e4?1e4:t,{In:function(e){return o(e,t)},Out:function(e){return 1-o(1-e,t)},InOut:function(e){return e<.5?o(2*e,t)/2:(1-o(2-2*e,t))/2+.5}}}},og={Linear:function(t,e){const s=t.length-1,i=s*e,n=Math.floor(i),r=og.Utils.Linear;return e<0?r(t[0],t[1],i):e>1?r(t[s],t[s-1],s-i):r(t[n],t[n+1>s?s:n+1],i-n)},Bezier:function(t,e){let s=0;const i=t.length-1,n=Math.pow,r=og.Utils.Bernstein;for(let a=0;a<=i;a++)s+=n(1-e,i-a)*n(e,a)*t[a]*r(i,a);return s},CatmullRom:function(t,e){const s=t.length-1;let i=s*e,n=Math.floor(i);const r=og.Utils.CatmullRom;return t[0]===t[s]?(e<0&&(n=Math.floor(i=s*(1+e))),r(t[(n-1+s)%s],t[n],t[(n+1)%s],t[(n+2)%s],i-n)):e<0?t[0]-(r(t[0],t[0],t[1],t[1],-i)-t[0]):e>1?t[s]-(r(t[s],t[s],t[s-1],t[s-1],i-s)-t[s]):r(t[n?n-1:0],t[n],t[s<n+1?s:n+1],t[s<n+2?s:n+2],i-n)},Utils:{Linear:function(t,e,s){return(e-t)*s+t},Bernstein:function(t,e){const s=og.Utils.Factorial;return s(t)/s(e)/s(t-e)},Factorial:function(){const t=[1];return function(e){let s=1;if(t[e])return t[e];for(let t=e;t>1;t--)s*=t;return t[e]=s,s}}(),CatmullRom:function(t,e,s,i,n){const r=.5*(s-t),a=.5*(i-e),o=n*n;return(2*e-2*s+r+a)*(n*o)+(-3*e+3*s-2*r-a)*o+r*n+e}}};class hg{constructor(t,e,s){d(this,"_name"),d(this,"_object"),d(this,"_group"),d(this,"_valuesStart",{}),d(this,"_valuesEnd",{}),d(this,"_valuesStartRepeat",{}),d(this,"_startTime",0),d(this,"_delayTime",0),d(this,"_duration",1e3),d(this,"_repeat",0),d(this,"_repeatDelayTime",0),d(this,"_isPlaying",!1),d(this,"_isPaused",!1),d(this,"_pauseStart",0),d(this,"_yoyo",!1),d(this,"_yoyoDelayTime",0),d(this,"_reversed",!1),d(this,"_easingFunction",ag.Linear.None),d(this,"_interpolationFunction",og.Linear),d(this,"_chainedTweens",[]),d(this,"_isChainStopped",!1),d(this,"_allowChainedStop",!0),d(this,"_events",{}),d(this,"_onStartCallbackFired",!1),this._name=t,this._object=e,this._group=s}get name(){return this._name}isPlaying(){return this._isPlaying}isPaused(){return this._isPaused}isReversed(){return this._reversed}getRepeat(){return this._repeat}to(t,e=1e3){return this._valuesEnd=Object.create(t),this._duration=e,this}start(t=!1,e=globalThis.pgame.TotalMS){if(this._isPlaying){if(!t)return this}else this._group&&this._group.add(this);if(this._reversed){this._reversed=!1;for(const t in this._valuesStartRepeat)this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t]}return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this}stop(t=!1){return this.stopChainedTweens(),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this.emit("stop",this._object),t&&this.emit("end",this._object),this):this}end(){return this.updateTillEnd(),this._group&&this._group.remove(this),this}endRepeat(){return this._yoyo?this._reversed?this._repeat=0:this._repeat=1:this._repeat=0,this}pause(t=globalThis.pgame.TotalMS){return this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this)),this}resume(t=globalThis.pgame.TotalMS){return this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this.start(!1,t)}group(t){return this._group=t,this}duration(t){return this._duration=t,this}delay(t){return this._delayTime=t,this}repeat(t){return this._repeat=t,this}repeatDelay(t){return this._repeatDelayTime=t,this}yoyo(t){return this._yoyo=t,this}yoyoDelay(t){return this._yoyoDelayTime=t,this}easing(t){return this._easingFunction=t,this}interpolation(t){return this._interpolationFunction=t,this}on(t,e){const s=this._events[t];return void 0===s?this._events[t]=[e]:s.push(e),this}single(t,e){const s=this._events[t];return void 0===s?this._events[t]=[e]:(s.clear(),s.push(e)),this}off(t){const e=this._events[t];return void 0!==e&&e.clear(),this}emit(t,...e){const s=this._events[t];if(void 0!==s)for(const i of s)i(...e);return this}chain(...t){return this._chainedTweens=t,this}allowChainedStop(t){return this._allowChainedStop=t,this}stopChainedTweens(){if(this._isChainStopped)return this;for(const t of this._chainedTweens)t._allowChainedStop&&t.stop();return this._isChainStopped=!0,this}endChainedTweens(){if(this._isChainStopped)return this;for(const t of this._chainedTweens)t._allowChainedStop&&t.end();return this._isChainStopped=!0,this}update(t){if(this._isPaused)return!0;if(!this._isPlaying)return!1;if(t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this.emit("start",this._object),this._onStartCallbackFired=!0);let e,s=0!==this._duration?(t-this._startTime)/this._duration:1;s>1?(e=1,this._yoyo?s%=2:s%=1):e=0;do{if(e>0||s>=1){if(!(this._repeat>0))return this._updateProperties(this._object,this._valuesStart,this._valuesEnd,1),this.emit("update",this._object,1),this._isPlaying=!1,this._handleEndPlaying();{let t=Math.min(s,1);const e=this._easingFunction(t);this._updateProperties(this._object,this._valuesStart,this._valuesEnd,e),this.emit("update",this._object,t),this._handleRepeatEnd()}}else{let t=Math.min(s,1);const e=this._easingFunction(t);this._updateProperties(this._object,this._valuesStart,this._valuesEnd,e),this.emit("update",this._object,t)}s-=1,e=0}while(s>0);return!0}_handleRepeatEnd(){for(const t in this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[t]||(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo&&this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t];return this._yoyo?this._reversed?(this._reversed=!1,this.emit("repeat",this._object,this._repeat),this._startTime+=this._duration+this._repeatDelayTime):(this._repeat--,this._reversed=!0,this.emit("yoyo",this._object,this._repeat),this._startTime+=this._duration+this._yoyoDelayTime):(this._repeat--,this.emit("repeat",this._object,this._repeat),this._startTime+=this._duration+this._repeatDelayTime),!0}_handleEndPlaying(){this.emit("end",this._object);for(const t of this._chainedTweens)t.start(!1,this._startTime+this._duration);return this._isPlaying}updateTillEnd(){return!1===this._onStartCallbackFired&&(this.emit("start",this._object),this._onStartCallbackFired=!0),this._yoyo&&!this._reversed?this._updateProperties(this._object,this._valuesEnd,this._valuesStart,1):this._updateProperties(this._object,this._valuesStart,this._valuesEnd,1),this.emit("update",this._object,1),this.emit("end",this._object),this.endChainedTweens(),this._isPlaying=!1,!1}_setupProperties(t,e,s,i){for(const n in s){const r=t[n],a=Array.isArray(r),o=a?"array":typeof r,h=!a&&Array.isArray(s[n]);if("undefined"!==o&&"function"!==o){if(h){let t=s[n];if(0===t.length)continue;t=t.map(this._handleRelativeValue.bind(this,r)),s[n]=[r].concat(t)}if("object"!==o&&!a||!r||h)e[n]=r,a||(e[n]*=1),i[n]=h?s[n].slice().reverse():e[n]||0;else{e[n]=a?[]:{};for(const t in r)e[n][t]=r[t];i[n]=a?[]:{},this._setupProperties(r,e[n],s[n],i[n])}}}}_updateProperties(t,e,s,i){for(const n in s){if(void 0===e[n])continue;const r=e[n]||0;let a=s[n];const o=Array.isArray(t[n]),h=Array.isArray(a);!o&&h?t[n]=this._interpolationFunction(a,i):"object"==typeof a&&a?this._updateProperties(t[n],r,a,i):(a=this._handleRelativeValue(r,a),"number"==typeof a&&(t[n]=r+(a-r)*i))}}_handleRelativeValue(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)}_swapEndStartRepeatValues(t){const e=this._valuesStartRepeat[t],s=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof s?this._valuesStartRepeat[t]+parseFloat(s):this._valuesEnd[t],this._valuesEnd[t]=e}}class lg{constructor(){d(this,"_twMap"),d(this,"_tweensAddedDuringUpdate")}create(t,e,s,i=1e3){return new hg(t,e,this).to(s,i)}getByName(t){var e;return null==(e=this._twMap)?void 0:e.get(t)}size(){return void 0===this._twMap?0:this._twMap.size}add(t){void 0!==this._twMap&&void 0!==this._tweensAddedDuringUpdate||(this._twMap=new Map,this._tweensAddedDuringUpdate=new Map),this._twMap.set(t.name,t),this._tweensAddedDuringUpdate.set(t.name,t)}remove(t){var e,s;null==(e=this._twMap)||e.delete(t.name),null==(s=this._tweensAddedDuringUpdate)||s.delete(t.name)}getAll(){return void 0!==this._twMap?[...this._twMap.values()]:[]}removeAll(){var t,e;null==(t=this._twMap)||t.clear(),null==(e=this._tweensAddedDuringUpdate)||e.clear()}endAll(){this.updateTillEnd()}update(t){if(void 0===this._twMap||0==this._twMap.size||void 0===this._tweensAddedDuringUpdate)return;let e=[...this._twMap.keys()];for(;e.length>0;){this._tweensAddedDuringUpdate.clear();for(const s of e){const e=this._twMap.get(s);void 0!==e&&(!1===e.update(t)&&this._twMap.delete(e.name))}e=[...this._tweensAddedDuringUpdate.keys()]}}updateTillEnd(){if(void 0===this._twMap||0==this._twMap.size||void 0===this._tweensAddedDuringUpdate)return;let t=[...this._twMap.keys()];for(;t.length>0;){this._tweensAddedDuringUpdate.clear();for(const e of t){const t=this._twMap.get(e);void 0!==t&&(t.updateTillEnd(),this._twMap.delete(t.name))}t=[...this._tweensAddedDuringUpdate.keys()]}}}class cg extends(ig(ru)){constructor(t=!1){super(),this.sortableChildren=!0,t&&(this.eventMode="passive")}setObj(t,e,s){return void 0!==e&&(t.layer=e),void 0!==s&&(t.name=s),this}addObj(t,e,s){return void 0!==e&&(t.layer=e),void 0!==s&&(t.name=s),this.addChild(t),this}removeObj(t){this.removeChild(t)}useLocale(t){for(const e of this.children)ng(e)&&e.useLocale(t)}}const ug=class extends cg{constructor(...t){super(!0),d(this,"tweens",new lg),d(this,"desz"),d(this,"sceneObjs"),d(this,"_frontChild"),d(this,"_backChild"),this.desz=new Mh,t.length>0&&this.setDesiredSize(...t),this.update=this._update}setDesiredSize(...t){0==t.length?this.getLocalBounds(this.desz,!0):(t.length>=2&&(this.desz.width=t[0],this.desz.height=t[1]),t.length>=4&&(this.desz.x=t[2],this.desz.y=t[3])),Qm(this.pivot,this._pivotRule,this.desz),this.debugBox&&this._drawDebugBox(this.desz)}get pivotRule(){return this._pivotRule}set pivotRule(t){this._pivotRule=t,Qm(this.pivot,t,this.desz),this.debugBox&&this._drawDebugBox(this.desz)}refreshPivotPoint(){}get enable(){return this.update===this._update}set enable(t){this.update=t?this._update:globalThis.doNothing}_update(t){this.tweens.update(globalThis.pgame.TotalMS);for(const e of this.children){const s=e;s.visible&&s.update(t)}}addObjWithStyle(t,e,s){this.applyObjWithStyle(t,e,s),this.addChild(t)}applyObjWithStyle(t,e,s){const i=e[t.name];void 0!==i&&t.useViewStyle(i),ng(t)&&t.useLocale(s)}sendObjToBack(t){void 0!==this._backChild&&(this._backChild.layer=sg.minLayer+1),t.layer=sg.minLayer,this._backChild=t}bringObjToFront(t){void 0!==this._frontChild&&(this._frontChild.layer=sg.maxLayer-1),t.layer=sg.maxLayer,this._frontChild=t}useViewStyle(t){super.useViewStyle(t),void 0!==t.dwh&&(this.desz.width=t.dwh[0],this.desz.height=t.dwh[1],this.setDesiredSize())}useViewStyleChildren(t){ug._viewStyleChildren(t,this.children)}static _viewStyleChildren(t,e){for(const s of e){const e=s,i=t[e.name];void 0!==i&&e.useViewStyle(i),pg(e)&&e.useViewStyleChildren(t)}}get debugBox(){return void 0!==this._debugBox&&this._debugBox.visible}set debugBox(t){t?this._drawDebugBox(this.desz):this._hideDebugBox()}};let dg=ug;function pg(t){return void 0!==t.desz}d(dg,"_debugFillStyle",(()=>{const t=new Mp;return t.visible=!0,t.color=tg.White,t.alpha=.08,t})()),d(dg,"_debugLineStyle",(()=>{const t=new Ip;return t.visible=!0,t.color=tg.Red,t.alpha=1,t.width=2.5,t})());class fg extends(ig(Up)){}const mg=/iPhone/i,gg=/iPod/i,yg=/iPad/i,xg=/\bAndroid(?:.+)Mobile\b/i,vg=/Android/i,_g=/Windows Phone/i,bg=/\bWindows(?:.+)ARM\b/i,wg=/BlackBerry/i,Eg=/BB10/i,Sg=/Opera Mini/i,Tg=/\b(CriOS|Chrome)(?:.+)Mobile/i,Ag=/Mobile(?:.+)Firefox\b/i,Cg=t=>void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1;Element.prototype.requestFullscreen=Element.prototype.requestFullscreen||Element.prototype.mozRequestFullScreen||Element.prototype.webkitRequestFullscreen||Element.prototype.msRequestFullscreen||function(){return Promise.reject(new Error("Fullscreen API is not supported"))},Document.prototype.exitFullscreen=Document.prototype.exitFullscreen||Document.prototype.mozCancelFullScreen||Document.prototype.webkitExitFullscreen||Document.prototype.msExitFullscreen||function(){return Promise.reject(new Error("Fullscreen API is not supported"))};const Mg=function(){const t=navigator;let e=t.userAgent,s=e.split("[FBAN");void 0!==s[1]&&(e=s[0]),s=e.split("Twitter"),void 0!==s[1]&&(e=s[0]);const i=t=>t.test(e),n={apple:{phone:i(mg)&&!i(_g),ipod:i(gg),tablet:!i(mg)&&(i(yg)||Cg(t))&&!i(_g),any:!1},android:{phone:!i(_g)&&i(xg),tablet:!i(_g)&&!i(xg)&&i(vg),any:!1},windows:{phone:i(_g),tablet:i(bg),any:!1},other:{blackberry:i(wg)||i(Eg),opera:i(Sg),firefox:i(Ag),chrome:i(Tg),any:!1},any:!1,phone:!1,tablet:!1};return n.apple.any=n.apple.phone||n.apple.ipod||n.apple.tablet,n.android.any=n.android.phone||n.android.tablet||i(/\bokhttp\b/i),n.windows.any=n.windows.phone||n.windows.tablet,n.other.any=n.other.blackberry||n.other.opera||n.other.firefox||n.other.chrome,n.any=n.apple.any||n.android.any||n.windows.any||n.other.any,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}();function Ig(){return Mg.any}function Pg(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||document.mozFullScreenElement)}function Rg(){document.documentElement.requestFullscreen().catch((()=>{}))}function kg(){document.exitFullscreen().catch((()=>{}))}let Dg,Fg=!0,Og=0;class Ng extends x{constructor(){super(),d(this,"_keySet",new Set)}listenKeyboard(t){t.addEventListener("keydown",(t=>{this._keySet.add(t.key),this.emit("down-any",t,this),this.emit(`down-${t.key}`,t,this)})),t.addEventListener("keyup",(t=>{this._keySet.delete(t.key),this.emit("up-any",t,this),this.emit(`up-${t.key}`,t,this)}))}isKeyDown(t){return this._keySet.has(t)}isKeyNotPressed(t){return!this._keySet.has(t)}canvasTapSnippet(t,e,s,i){const n=globalThis.pgame.stage,r=t=>{const e=t.global;i.getBounds(!0).contains(e.x,e.y)||(s(t),n.off("pointertapcapture",r),t.stopPropagation())};t.setOnClick((t=>{e(t),n.on("pointertapcapture",r)}))}}function Bg(t,e){for(const s in e)if(s in t){const i=t[s];"object"!=typeof i||Array.isArray(i)||Bg(i,e[s])}else t[s]=e[s]}function Lg(t,e){for(const s in e){const i=t[s];"object"!=typeof i||Array.isArray(i)?t[s]=e[s]:Lg(i,e[s])}}function Vg(){return Dg}Array.prototype.clear=function(){this.length=0},Array.prototype.front=function(){return this[0]},Array.prototype.back=function(){return this[this.length-1]},Array.prototype.moveToBack=function(t){let e=this[t];this.splice(t,1),this.push(e)},Array.prototype.swap=function(t,e){let s=this[t];this[t]=this[e],this[e]=s},Array.prototype.removeOnce=function(t){let e=this.indexOf(t);return e>-1&&this.splice(e,1),this},Array.prototype.union=function(t){return[...new Set([...this,...t])]},Array.prototype.intersect=function(t){return this.filter((e=>t.includes(e)))},Array.prototype.diff=function(t){return this.filter((e=>!t.includes(e)))},Array.isEqual=function(t,e){if(t.length!=e.length)return!1;for(let s of Array.range(t.length))if(t[s]!=e[s])return!1;return!0},Array.rangeFrom=function(t,e,s){return void 0===s&&(s=1),void 0===e&&(e=t,t=0),Array.from({length:(e-t)/s},((e,i)=>t+i*s))},Array.range=function(t,e,s){void 0===s&&(s=1),void 0===e&&(e=t,t=0);return function*(){for(let i=t;i!=e;i+=s)yield i}()},String.prototype.mapReplace=function(t){let e=this.toString();for(let[s,i]of t)e=e.replace(s,i);return e},String.prototype.format=function(...t){let e=this.toString();for(let s=0;s<t.length;s++)e=e.replace(`{${s}}`,t[s]);return e},Number.prototype.pad=function(t,e){return String(this).padStart(t,e)},Number.prototype.pad0=function(t){return String(this).padStart(t,"0")},Object.removeUndef=function(t){Object.keys(t).forEach((e=>void 0===t[e]&&delete t[e]))},Object.merge=function(t,e,s=!0){s?Bg(t,e):Lg(t,e)},Object.rename=function(t,e,s){const i=t[e];void 0!==i&&(delete t[e],t[s]=i)},Set.prototype.union=function(t){return new Set([...this,...t])},Set.prototype.intersect=function(t){return new Set(Array.from(this).filter((e=>t.has(e))))},Set.prototype.diff=function(t){return new Set(Array.from(this).filter((e=>!t.has(e))))},Math.randInt=function(t){return Math.floor(Math.random()*t)},Math.randPickFromProbs=function(t){let e=[];for(let i=0;i<t.length;i++)e.push([t[i],i]);e.sort(((t,e)=>t[0]-e[0]));for(let i=1;i<t.length;i++)e[i][0]+=e[i-1][0];let s=Math.random();for(let[i,n]of e)if(s<=i)return n;return-1},Math.shuffle=function(t,e){void 0===e&&(e=t.length);for(let s=0;s<e;s++)t.swap(s,Math.randInt(t.length))};let $g=0;const Ug=class extends x{constructor(t){super(),this.id=$g++,this.init(t)}set(t,e){if(void 0===this[t])throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"paused":this.paused=e;break;case"loop":this.loop=e;break;case"muted":this.muted=e}return this}get progress(){const{currentTime:t}=this._source;return t/this._duration}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}_onPlay(){this._playing=!0}_onPause(){this._playing=!1}init(t){this._playing=!1,this._duration=t.source.duration;const e=this._source=t.source.cloneNode(!1);e.src=t.parent.url,e.onplay=this._onPlay.bind(this),e.onpause=this._onPause.bind(this),t.context.on("refresh",this.refresh,this),t.context.on("refreshPaused",this.refreshPaused,this),this._media=t}_internalStop(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())}stop(){this._internalStop(),this._source&&this.emit("stop")}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh()}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(t){console.warn("HTML Audio does not support filters")}refresh(){const t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;const s=t.volume*(t.muted?0:1),i=e.volume*(e.muted?0:1),n=this._volume*(this._muted?0:1);this._source.volume=n*s*i,this._source.playbackRate=this._speed*t.speed*e.speed}refreshPaused(){const t=this._media.context,e=this._media.parent,s=this._paused||e.paused||t.paused;s!==this._pausedReal&&(this._pausedReal=s,s?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",s))}play(t){const{start:e,end:s,speed:i,loop:n,volume:r,muted:a}=t;s&&console.assert(s>e,"End time is before start time"),this._speed=i,this._volume=r,this._loop=!!n,this._muted=a,this.refresh(),this.loop&&null!==s&&(console.warn('Looping not support when specifying an "end" time'),this.loop=!1),this._start=e,this._end=s||this._duration,this._start=Math.max(0,this._start-Ug.PADDING),this._end=Math.min(this._end+Ug.PADDING,this._duration),this._source.onloadedmetadata=()=>{this._source&&(this._source.currentTime=e,this._source.onloadedmetadata=null,this.emit("progress",e,this._duration),Oc.shared.add(this._onUpdate,this))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")}_onUpdate(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()}_onComplete(){Oc.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)}destroy(){Oc.shared.remove(this._onUpdate,this),this.removeAllListeners();const t=this._source;t&&(t.onended=null,t.onplay=null,t.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)}toString(){return`[HTMLAudioInstance id=${this.id}]`}};let Xg=Ug;Xg.PADDING=.1;let Yg=class extends x{init(t){this.parent=t,this._source=t.options.source||new Audio,t.url&&(this._source.src=t.url)}create(){return new Xg(this)}get isPlayable(){return!!this._source&&4===this._source.readyState}get duration(){return this._source.duration}get context(){return this.parent.context}get filters(){return null}set filters(t){console.warn("HTML Audio does not support filters")}destroy(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)}get source(){return this._source}load(t){const e=this._source,s=this.parent;if(4===e.readyState){s.isLoaded=!0;const e=s.autoPlayStart();return void(t&&setTimeout((()=>{t(null,s,e)}),0))}if(!s.url)return void t(new Error("sound.url or sound.source must be set"));e.src=s.url;const i=()=>{a(),s.isLoaded=!0;const e=s.autoPlayStart();t&&t(null,s,e)},n=()=>{a(),t&&t(new Error("Sound loading has been aborted"))},r=()=>{a();const s=`Failed to load audio element (code: ${e.error.code})`;t?t(new Error(s)):console.error(s)},a=()=>{e.removeEventListener("canplaythrough",i),e.removeEventListener("load",i),e.removeEventListener("abort",n),e.removeEventListener("error",r)};e.addEventListener("canplaythrough",i,!1),e.addEventListener("load",i,!1),e.addEventListener("abort",n,!1),e.addEventListener("error",r,!1),e.load()}},Wg=class{static setParamValue(t,e){if(t.setValueAtTime){const s=Vg().context;t.setValueAtTime(e,s.audioContext.currentTime)}else t.value=e;return e}},jg=0,Gg=class extends x{constructor(t){super(),this.id=jg++,this._media=null,this._paused=!1,this._muted=!1,this._elapsed=0,this.init(t)}set(t,e){if(void 0===this[t])throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"muted":this.muted=e;break;case"loop":this.loop=e;break;case"paused":this.paused=e}return this}stop(){this._source&&(this._internalStop(),this.emit("stop"))}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh(),this._update(!0)}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get filters(){return this._filters}set filters(t){var e;this._filters&&(null==(e=this._filters)||e.filter((t=>t)).forEach((t=>t.disconnect())),this._filters=null,this._source.connect(this._gain)),this._filters=null!=t&&t.length?t.slice(0):null,this.refresh()}refresh(){if(!this._source)return;const t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;const s=t.volume*(t.muted?0:1),i=e.volume*(e.muted?0:1),n=this._volume*(this._muted?0:1);Wg.setParamValue(this._gain.gain,n*i*s),Wg.setParamValue(this._source.playbackRate,this._speed*e.speed*t.speed),this.applyFilters()}applyFilters(){var t;if(null!=(t=this._filters)&&t.length){this._source.disconnect();let t=this._source;this._filters.forEach((e=>{t.connect(e.destination),t=e})),t.connect(this._gain)}}refreshPaused(){const t=this._media.context,e=this._media.parent,s=this._paused||e.paused||t.paused;s!==this._pausedReal&&(this._pausedReal=s,s?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",s))}play(t){const{start:e,end:s,speed:i,loop:n,volume:r,muted:a,filters:o}=t;s&&console.assert(s>e,"End time is before start time"),this._paused=!1;const{source:h,gain:l}=this._media.nodes.cloneBufferSource();this._source=h,this._gain=l,this._speed=i,this._volume=r,this._loop=!!n,this._muted=a,this._filters=o,this.refresh();const c=this._source.buffer.duration;this._duration=c,this._end=s,this._lastUpdate=this._now(),this._elapsed=e,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=s,this._source.loopStart=e,this._source.start(0,e)):s?this._source.start(0,e,s-e):this._source.start(0,e),this.emit("start"),this._update(!0),this.enableTicker(!0)}enableTicker(t){Oc.shared.remove(this._updateListener,this),t&&Oc.shared.add(this._updateListener,this)}get progress(){return this._progress}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}destroy(){var t;this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),null==(t=this._filters)||t.forEach((t=>t.disconnect())),this._filters=null,this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1}toString(){return`[WebAudioInstance id=${this.id}]`}_now(){return this._media.context.audioContext.currentTime}_updateListener(){this._update()}_update(t=!1){if(this._source){const e=this._now(),s=e-this._lastUpdate;if(s>0||t){const t=this._source.playbackRate.value;this._elapsed+=s*t,this._lastUpdate=e;const i=this._duration;let n;if(this._source.loopStart){const t=this._source.loopEnd-this._source.loopStart;n=(this._source.loopStart+this._elapsed%t)/i}else n=this._elapsed%i/i;this._progress=n,this.emit("progress",this._progress,i)}}}init(t){this._media=t,t.context.events.on("refresh",this.refresh,this),t.context.events.on("refreshPaused",this.refreshPaused,this)}_internalStop(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null}}_onComplete(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}}this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)}},zg=class{constructor(t,e){this._output=e,this._input=t}get destination(){return this._input}get filters(){return this._filters}set filters(t){if(this._filters&&(this._filters.forEach((t=>{t&&t.disconnect()})),this._filters=null,this._input.connect(this._output)),t&&t.length){this._filters=t.slice(0),this._input.disconnect();let e=null;t.forEach((t=>{null===e?this._input.connect(t.destination):e.connect(t.destination),e=t})),e.connect(this._output)}}destroy(){this.filters=null,this._input=null,this._output=null}};const Hg=class extends zg{constructor(t){const e=t.audioContext,s=e.createBufferSource(),i=e.createGain(),n=e.createAnalyser();s.connect(n),n.connect(i),i.connect(t.destination),super(n,i),this.context=t,this.bufferSource=s,this.gain=i,this.analyser=n}get script(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(Hg.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script}destroy(){super.destroy(),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null}cloneBufferSource(){const t=this.bufferSource,e=this.context.audioContext.createBufferSource();e.buffer=t.buffer,Wg.setParamValue(e.playbackRate,t.playbackRate.value),e.loop=t.loop;const s=this.context.audioContext.createGain();return e.connect(s),s.connect(this.destination),{source:e,gain:s}}get bufferSize(){return this.script.bufferSize}};let qg=Hg;qg.BUFFER_SIZE=0;let Kg=class{init(t){this.parent=t,this._nodes=new qg(this.context),this._source=this._nodes.bufferSource,this.source=t.options.source}destroy(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null,this.source=null}create(){return new Gg(this)}get context(){return this.parent.context}get isPlayable(){return!!this._source&&!!this._source.buffer}get filters(){return this._nodes.filters}set filters(t){this._nodes.filters=t}get duration(){return console.assert(this.isPlayable,"Sound not yet playable, no duration"),this._source.buffer.duration}get buffer(){return this._source.buffer}set buffer(t){this._source.buffer=t}get nodes(){return this._nodes}load(t){this.source?this._decode(this.source,t):this.parent.url?this._loadUrl(t):t?t(new Error("sound.url or sound.source must be set")):console.error("sound.url or sound.source must be set")}_loadUrl(t){return p(this,null,(function*(){const e=this.parent.url,s=yield Ar.ADAPTER.fetch(e);this._decode(yield s.arrayBuffer(),t)}))}_decode(t,e){const s=(t,s)=>{if(t)e&&e(t);else{this.parent.isLoaded=!0,this.buffer=s;const t=this.parent.autoPlayStart();e&&e(null,this.parent,t)}};t instanceof AudioBuffer?s(null,t):this.parent.context.decode(t,s)}};var Zg=Object.defineProperty,Qg=Object.getOwnPropertySymbols,Jg=Object.prototype.hasOwnProperty,ty=Object.prototype.propertyIsEnumerable,ey=(t,e,s)=>e in t?Zg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,sy=(t,e)=>{for(var s in e||(e={}))Jg.call(e,s)&&ey(t,s,e[s]);if(Qg)for(var s of Qg(e))ty.call(e,s)&&ey(t,s,e[s]);return t};const iy=class{static from(t){let e={};"string"==typeof t?e.url=t:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?e.source=t:e=t,e=sy({autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1},e),Object.freeze(e);const s=Vg().useLegacy?new Yg:new Kg;return new iy(s,e)}constructor(t,e){this.media=t,this.options=e,this._instances=[],this._sprites={},this.media.init(this);const s=e.complete;this._autoPlayOptions=s?{complete:s}:null,this.isLoaded=!1,this.isPlaying=!1,this.autoPlay=e.autoPlay,this.singleInstance=e.singleInstance,this.preload=e.preload||this.autoPlay,this.url=e.url,this.speed=e.speed,this.volume=e.volume,this.loop=e.loop,e.sprites&&this.addSprites(e.sprites),this.preload&&this._preload(e.loaded)}get context(){return Vg().context}pause(){return this.isPlaying=!1,this.paused=!0,this}resume(){return this.isPlaying=this._instances.length>0,this.paused=!1,this}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh()}get filters(){return this.media.filters}set filters(t){this.media.filters=t}addSprites(t,e){if("object"==typeof t){const e={};for(const s in t)e[s]=this.addSprites(s,t[s]);return e}console.assert(!this._sprites[t],`Alias ${t} is already taken`);const s=new class{constructor(t,e){this.parent=t,Object.assign(this,e),this.duration=this.end-this.start,console.assert(this.duration>0,"End time must be after start time")}play(t){return this.parent.play({complete:t,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})}destroy(){this.parent=null}}(this,e);return this._sprites[t]=s,s}destroy(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null}removeSprites(t){if(t){const e=this._sprites[t];void 0!==e&&(e.destroy(),delete this._sprites[t])}else for(const e in this._sprites)this.removeSprites(e);return this}get isPlayable(){return this.isLoaded&&this.media&&this.media.isPlayable}stop(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(let t=this._instances.length-1;t>=0;t--)this._instances[t].stop();return this}play(t,e){let s;if("string"==typeof t?s={sprite:t,loop:this.loop,complete:e}:"function"==typeof t?(s={},s.complete=t):s=t,s=sy({complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1},s||{}),s.sprite){const t=s.sprite;console.assert(!!this._sprites[t],`Alias ${t} is not available`);const e=this._sprites[t];s.start=e.start+(s.start||0),s.end=e.end,s.speed=e.speed||1,s.loop=e.loop||s.loop,delete s.sprite}if(s.offset&&(s.start=s.offset),!this.isLoaded)return new Promise(((t,e)=>{this.autoPlay=!0,this._autoPlayOptions=s,this._preload(((i,n,r)=>{i?e(i):(s.loaded&&s.loaded(i,n,r),t(r))}))}));(this.singleInstance||s.singleInstance)&&this._removeInstances();const i=this._createInstance();return this._instances.push(i),this.isPlaying=!0,i.once("end",(()=>{s.complete&&s.complete(this),this._onComplete(i)})),i.once("stop",(()=>{this._onComplete(i)})),i.play(s),i}refresh(){const t=this._instances.length;for(let e=0;e<t;e++)this._instances[e].refresh()}refreshPaused(){const t=this._instances.length;for(let e=0;e<t;e++)this._instances[e].refreshPaused()}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}_preload(t){this.media.load(t)}get instances(){return this._instances}get sprites(){return this._sprites}get duration(){return this.media.duration}autoPlayStart(){let t;return this.autoPlay&&(t=this.play(this._autoPlayOptions)),t}_removeInstances(){for(let t=this._instances.length-1;t>=0;t--)this._poolInstance(this._instances[t]);this._instances.length=0}_onComplete(t){if(this._instances){const e=this._instances.indexOf(t);e>-1&&this._instances.splice(e,1),this.isPlaying=this._instances.length>0}this._poolInstance(t)}_createInstance(){if(iy._pool.length>0){const t=iy._pool.pop();return t.init(this.media),t}return this.media.create()}_poolInstance(t){t.destroy(),iy._pool.indexOf(t)<0&&iy._pool.push(t)}};let ny=iy;ny._pool=[];let ry=class extends x{constructor(){super(...arguments),this.speed=1,this.muted=!1,this.volume=1,this.paused=!1}refresh(){this.emit("refresh")}refreshPaused(){this.emit("refreshPaused")}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(t){console.warn("HTML Audio does not support filters")}get audioContext(){return console.warn("HTML Audio does not support audioContext"),null}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this.paused}destroy(){this.removeAllListeners()}};class ay extends zg{constructor(){const t=window,e=new ay.AudioContext,s=e.createDynamicsCompressor(),i=e.createAnalyser();i.connect(s),s.connect(e.destination),super(i,s),this._ctx=e,this._offlineCtx=new ay.OfflineAudioContext(1,2,t.OfflineAudioContext?Math.max(8e3,Math.min(96e3,e.sampleRate)):44100),this._unlocked=!1,this.compressor=s,this.analyser=i,this.events=new x,this.volume=1,this.speed=1,this.muted=!1,this.paused=!1,"running"!==e.state&&(this._unlock(),this._unlock=this._unlock.bind(this),document.addEventListener("mousedown",this._unlock,!0),document.addEventListener("touchstart",this._unlock,!0),document.addEventListener("touchend",this._unlock,!0))}_unlock(){this._unlocked||(this.playEmptySound(),"running"===this._ctx.state&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._unlocked=!0))}playEmptySound(){const t=this._ctx.createBufferSource();t.buffer=this._ctx.createBuffer(1,1,22050),t.connect(this._ctx.destination),t.start(0,0,0),"suspended"===t.context.state&&t.context.resume()}static get AudioContext(){const t=window;return t.AudioContext||t.webkitAudioContext||null}static get OfflineAudioContext(){const t=window;return t.OfflineAudioContext||t.webkitOfflineAudioContext||null}destroy(){super.destroy();const t=this._ctx;void 0!==t.close&&t.close(),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null}get audioContext(){return this._ctx}get offlineContext(){return this._offlineCtx}set paused(t){t&&"running"===this._ctx.state?this._ctx.suspend():!t&&"suspended"===this._ctx.state&&this._ctx.resume(),this._paused=t}get paused(){return this._paused}refresh(){this.events.emit("refresh")}refreshPaused(){this.events.emit("refreshPaused")}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this._paused}decode(t,e){const s=t=>{e(new Error((null==t?void 0:t.message)||"Unable to decode file"))},i=this._offlineCtx.decodeAudioData(t,(t=>{e(null,t)}),s);i&&i.catch(s)}}var oy=Object.defineProperty,hy=Object.getOwnPropertySymbols,ly=Object.prototype.hasOwnProperty,cy=Object.prototype.propertyIsEnumerable,uy=(t,e,s)=>e in t?oy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,dy=(t,e)=>{for(var s in e||(e={}))ly.call(e,s)&&uy(t,s,e[s]);if(hy)for(var s of hy(e))cy.call(e,s)&&uy(t,s,e[s]);return t};let py=class{constructor(){this.init()}init(){return this.supported&&(this._webAudioContext=new ay),this._htmlAudioContext=new ry,this._sounds={},this.useLegacy=!this.supported,this}get context(){return this._context}get filtersAll(){return this.useLegacy?[]:this._context.filters}set filtersAll(t){this.useLegacy||(this._context.filters=t)}get supported(){return null!==ay.AudioContext}add(t,e){if("object"==typeof t){const s={};for(const i in t){const n=this._getOptions(t[i],e);s[i]=this.add(i,n)}return s}if(console.assert(!this._sounds[t],`Sound with alias ${t} already exists.`),e instanceof ny)return this._sounds[t]=e,e;const s=this._getOptions(e),i=ny.from(s);return this._sounds[t]=i,i}_getOptions(t,e){let s;return s="string"==typeof t?{url:t}:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?{source:t}:t,s=dy(dy({},s),e||{}),s}get useLegacy(){return this._useLegacy}set useLegacy(t){this._useLegacy=t,this._context=!t&&this.supported?this._webAudioContext:this._htmlAudioContext}remove(t){return this.exists(t,!0),this._sounds[t].destroy(),delete this._sounds[t],this}get volumeAll(){return this._context.volume}set volumeAll(t){this._context.volume=t,this._context.refresh()}get speedAll(){return this._context.speed}set speedAll(t){this._context.speed=t,this._context.refresh()}togglePauseAll(){return this._context.togglePause()}pauseAll(){return this._context.paused=!0,this._context.refreshPaused(),this}resumeAll(){return this._context.paused=!1,this._context.refreshPaused(),this}toggleMuteAll(){return this._context.toggleMute()}muteAll(){return this._context.muted=!0,this._context.refresh(),this}unmuteAll(){return this._context.muted=!1,this._context.refresh(),this}removeAll(){for(const t in this._sounds)this._sounds[t].destroy(),delete this._sounds[t];return this}stopAll(){for(const t in this._sounds)this._sounds[t].stop();return this}exists(t,e=!1){const s=!!this._sounds[t];return e&&console.assert(s,`No sound matching alias '${t}'.`),s}find(t){return this.exists(t,!0),this._sounds[t]}play(t,e){return this.find(t).play(e)}stop(t){return this.find(t).stop()}pause(t){return this.find(t).pause()}resume(t){return this.find(t).resume()}volume(t,e){const s=this.find(t);return void 0!==e&&(s.volume=e),s.volume}speed(t,e){const s=this.find(t);return void 0!==e&&(s.speed=e),s.speed}duration(t){return this.find(t).duration}close(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this}};var fy={__proto__:null,HTMLAudioMedia:Yg,HTMLAudioInstance:Xg,HTMLAudioContext:ry},my=Gg;let gy=0;var yy=Object.defineProperty,xy=Object.getOwnPropertySymbols,vy=Object.prototype.hasOwnProperty,_y=Object.prototype.propertyIsEnumerable,by=(t,e,s)=>e in t?yy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,wy=(t,e)=>{for(var s in e||(e={}))vy.call(e,s)&&by(t,s,e[s]);if(xy)for(var s of xy(e))_y.call(e,s)&&by(t,s,e[s]);return t};var Ey=Object.defineProperty,Sy=Object.getOwnPropertySymbols,Ty=Object.prototype.hasOwnProperty,Ay=Object.prototype.propertyIsEnumerable,Cy=(t,e,s)=>e in t?Ey(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,My=(t,e)=>{for(var s in e||(e={}))Ty.call(e,s)&&Cy(t,s,e[s]);if(Sy)for(var s of Sy(e))Ay.call(e,s)&&Cy(t,s,e[s]);return t};const Iy=["mp3","ogg","oga","opus","mpeg","wav","m4a","aiff","wma","mid","caf"],Py={};function Ry(t){const e=My({m4a:"audio/mp4",oga:"audio/ogg",opus:'audio/ogg; codecs="opus"',caf:'audio/x-caf; codecs="opus"'},t||{}),s=document.createElement("audio"),i={},n=/^no$/;Iy.forEach((t=>{const r=s.canPlayType(`audio/${t}`).replace(n,""),a=e[t]?s.canPlayType(e[t]).replace(n,""):"";i[t]=!!r||!!a})),Object.assign(Py,i)}Ry();var ky={__proto__:null,playOnce:function(t,e){const s="alias"+gy++;return Vg().add(s,{url:t,preload:!0,autoPlay:!0,loaded:t=>{t&&(console.error(t),Vg().remove(s),e&&e(t))},complete:()=>{Vg().remove(s),e&&e(null)}}),s},get PLAY_ID(){return gy},render:function(t,e){const s=document.createElement("canvas");e=wy({width:512,height:128,fill:"black"},e||{}),s.width=e.width,s.height=e.height;const i=uh.from(s);if(!(t.media instanceof Kg))return i;const n=t.media;console.assert(!!n.buffer,"No buffer found, load first");const r=s.getContext("2d");r.fillStyle=e.fill;const a=n.buffer.getChannelData(0),o=Math.ceil(a.length/e.width),h=e.height/2;for(let l=0;l<e.width;l++){let t=1,e=-1;for(let s=0;s<o;s++){const i=a[l*o+s];i<t&&(t=i),i>e&&(e=i)}r.fillRect(l,(1+t)*h,1,Math.max(1,(e-t)*h))}return i},sineTone:function(t=200,e=1){const s=ny.from({singleInstance:!0});if(!(s.media instanceof Kg))return s;const i=s.media,n=s.context.audioContext.createBuffer(1,48e3*e,48e3),r=n.getChannelData(0);for(let a=0;a<r.length;a++){const e=t*(a/n.sampleRate)*Math.PI;r[a]=2*Math.sin(e)}return i.buffer=n,s.isLoaded=!0,s},validateFormats:Ry,supported:Py,extensions:Iy},Dy=Object.defineProperty,Fy=Object.defineProperties,Oy=Object.getOwnPropertyDescriptors,Ny=Object.getOwnPropertySymbols,By=Object.prototype.hasOwnProperty,Ly=Object.prototype.propertyIsEnumerable,Vy=(t,e,s)=>e in t?Dy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;const $y=t=>{var e,s;const i=t.src;return null!=(s=null==(e=null==t?void 0:t.alias)?void 0:e[0])?s:ja.basename(i,ja.extname(i))},Uy={extension:Ko.Asset,detection:{test:()=>p(void 0,null,(function*(){return!0})),add:t=>p(void 0,null,(function*(){return[...t,...Iy.filter((t=>Py[t]))]})),remove:t=>p(void 0,null,(function*(){return t.filter((e=>t.includes(e)))}))},loader:{extension:{type:[Ko.LoadParser],priority:ju.High},test(t){const e=ja.extname(t).slice(1);return!!Py[e]},load(t,e){return p(this,null,(function*(){const s=yield new Promise(((s,i)=>ny.from(((t,e)=>Fy(t,Oy(e)))(((t,e)=>{for(var s in e||(e={}))By.call(e,s)&&Vy(t,s,e[s]);if(Ny)for(var s of Ny(e))Ly.call(e,s)&&Vy(t,s,e[s]);return t})({},e.data),{url:t,preload:!0,loaded(t,n){var r,a;t?i(t):s(n),null==(a=null==(r=e.data)?void 0:r.loaded)||a.call(r,t,n)}}))));return Vg().add($y(e),s),s}))},unload(t,e){return p(this,null,(function*(){Vg().remove($y(e))}))}}};Jo.add(Uy);const Xy=(Yy=new py,Dg=Yy,Yy);var Yy;class Wy{constructor(t){d(this,"list"),d(this,"_volume",1),d(this,"_muted",!1),this.list=t;for(const e of this.list)e.group=this}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}refresh(){for(const t of this.list)t.refresh()}}class jy{constructor(t){d(this,"prev",null),d(this,"current",null),d(this,"list"),this.list=t;for(const e of this.list)e.mutexGroup=this,e.singleInstance=!0}}function Gy(t,e){const s=t.sound;if(t.firstPlayed){if(t.fadeIn&&(t.fadeIn.startMS=pgame.TotalMS,t.fadeIn.endMS=pgame.TotalMS+t.fadeIn.timeMS),t.fadeOut){let i=1e3*((e.end||s.duration)-e.start);t.fadeOut.startMS=pgame.TotalMS+i-t.fadeOut.timeMS,t.fadeOut.endMS=pgame.TotalMS+i,t.fadeOut.wantsTo=" ",t.fadeOut.canStop=!1}}else{t.firstPlayed=!0;const i=e.fadeIn||s.fadeIn,n=e.fadeOut||s.fadeOut;if(!i&&!n)return;if(i&&(t.fadeIn={timeMS:i,startMS:pgame.TotalMS,endMS:pgame.TotalMS+i}),n){let i=1e3*(e.end||s.duration);t.fadeOut={timeMS:n,startMS:pgame.TotalMS+i-n,endMS:pgame.TotalMS+i,wantsTo:" ",canStop:!1}}const r=e.volume,a=(e,s)=>{if(t.fadeOut&&(" "!=t.fadeOut.wantsTo||!t.loopReal)&&pgame.TotalMS>=t.fadeOut.startMS){let e=(pgame.TotalMS-t.fadeOut.startMS)/t.fadeOut.timeMS;e=Math.min(e,1),1==e?(t.fadeOut.canStop=!0,"stop"==t.fadeOut.wantsTo?t.stop():"pause"==t.fadeOut.wantsTo&&t.refreshPaused()):t.volume=(1-e)*r}else if(t.fadeIn&&(pgame.TotalMS<=t.fadeIn.endMS||t.volume<r)){let e=(pgame.TotalMS-t.fadeIn.startMS)/t.fadeIn.timeMS;e=Math.min(e,1),t.volume=e*r}};t.on("progress",a)}}function zy(t,e){const s=t.fadeOut;return!s||(s.wantsTo!=e?(s.wantsTo=e,s.startMS=pgame.TotalMS,s.endMS=Math.min(s.endMS,pgame.TotalMS+s.timeMS),!1):s.canStop)}function Hy(t){if(t.mutexGroup){if(t.mutexGroup.current){const e=t.mutexGroup.current;e.isPlaying&&(e.mutexPause?e.pause():e.stop()),t.mutexGroup.prev=e}t.mutexGroup.current=t}}const qy=my.prototype,Ky={init:qy.init,play:qy.play,stop:qy.stop,refreshPaused:qy.refreshPaused},Zy=fy.HTMLAudioInstance.prototype,Qy={init:Zy.init,play:Zy.play,stop:Zy.stop,refreshPaused:Zy.refreshPaused},Jy=ny.prototype,tx={play:Jy.play,resume:Jy.resume},ex=py.prototype;qy.init=function(t){this.firstPlayed=!1,Ky.init.call(this,t)},qy.play=function(t){Gy(this,t),Ky.play.call(this,t)},qy.stop=function(){zy(this,"stop")&&Ky.stop.call(this)},qy.refreshPaused=function(){zy(this,"pause")&&Ky.refreshPaused.call(this)},Object.defineProperties(qy,{sound:{get:function(){return this._media.parent}},loopReal:{get:function(){return this._loop||this._media.parent.loop}}}),Zy.init=function(t){this.firstPlayed=!1,Qy.init.call(this,t)},Zy.play=function(t){Gy(this,t),Qy.play.call(this,t)},Zy.stop=function(){zy(this,"stop")&&Qy.stop.call(this)},Zy.refreshPaused=function(){zy(this,"pause")&&Qy.refreshPaused.call(this)},Object.defineProperties(Zy,{sound:{get:function(){return this._media.parent}},loopReal:{get:function(){return this._loop||this._media.parent.loop}}}),Jy.play=function(t,e){return Hy(this),tx.play.call(this,t,e)},Jy.resume=function(){return Hy(this),tx.resume.call(this)},Object.defineProperties(Jy,{volume:{get:function(){return this.group?this.group.volume*this._volume:this._volume}},muted:{get:function(){var t;return(null==(t=this.group)?void 0:t.muted)||this._muted}},selfVolume:{get:function(){return this._volume}},selfMuted:{get:function(){return this._muted}}}),Xy.groups={},Xy.mutexGroups={},ex.setGroup=function(t,e){const s=Object.fromEntries(Object.entries(e).map((([t,e])=>[t,this.find(e)])));return this.groups[t]=new Wy(Object.values(s)),s},ex.setMutexGroup=function(t,e){const s="string"==typeof e[0]?e.map((t=>this.find(t))):e;return this.mutexGroups[t]=new jy(s),s};const sx=ky.supported,ix=Object.freeze(Object.defineProperty({__proto__:null,SupportedSoundExts:sx,arrToObj:function(t){const e={};for(let s of Array.range(t.length))e[s]=t[s];return e},assignPair:function(t,e){t.x=e[0],t.y=e[1]},assignPivotPoint:Qm,assignPivotPointRatio:Jm,assignPoint:function(t,e){t.x=e.x,t.y=e.y},bufferToBase64:function(t,e){return p(this,null,(function*(){const s=yield new Promise((s=>{const i=new FileReader;i.onload=()=>s(i.result),i.readAsDataURL(new Blob([t],{type:e}))}));return void 0===e?s.split(",",2)[1]:s}))},distance:function(t,e){let s=t.x-e.x,i=t.y-e.y;return Math.sqrt(s*s+i*i)},distance2:function(t,e){let s=t.x-e.x,i=t.y-e.y;return s*s+i*i},doubleTapEnterFullscreen:function(){if(Fg)return Rg(),void(Fg=!1);let t=performance.now(),e=t-Og;e<600&&e>0&&Rg(),Og=t},enterFullscreen:Rg,exitFullscreen:kg,isApple:function(){return Mg.apple.any},isContainer:pg,isFirefox:function(){return navigator.userAgent.includes("Firefox")},isFullscreen:Pg,isGraphicObject:function(t){return void 0!==t.useViewStyle},isKeyDown:function(t){var e;return!!(null==(e=pgame.interact)?void 0:e.isKeyDown(t))},isKeyNotPressed:function(t){var e;return!(null==(e=pgame.interact)?void 0:e.isKeyDown(t))},isLocalizedObject:ng,isMinimalContainer:function(t){return void 0!==t.addObj},isMobile:Ig,isMobileResult:Mg,pnt2:function(t){return{x:t,y:t}},recurseEventMode:function t(e,s){for(const i of e.children)i.eventMode=s,void 0!==i.children&&t(i,s)},shared:sg,soundAsset:Uy,toggleFullscreen:function(){Pg()?kg():Rg()},unpackPoint:function(t){return{x:t[0],y:t[1]}}},Symbol.toStringTag,{value:"Module"}));var nx,rx={};nx={get exports(){return rx},set exports(t){rx=t}},function(){function t(t,e){document.addEventListener?t.addEventListener("scroll",e,!1):t.attachEvent("scroll",e)}function e(t){this.g=document.createElement("div"),this.g.setAttribute("aria-hidden","true"),this.g.appendChild(document.createTextNode(t)),this.h=document.createElement("span"),this.i=document.createElement("span"),this.m=document.createElement("span"),this.j=document.createElement("span"),this.l=-1,this.h.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.i.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.j.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.m.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.h.appendChild(this.m),this.i.appendChild(this.j),this.g.appendChild(this.h),this.g.appendChild(this.i)}function s(t,e){t.g.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:"+e+";"}function i(t){var e=t.g.offsetWidth,s=e+100;return t.j.style.width=s+"px",t.i.scrollLeft=s,t.h.scrollLeft=t.h.scrollWidth+100,t.l!==e&&(t.l=e,!0)}function n(e,s){function n(){var t=r;i(t)&&null!==t.g.parentNode&&s(t.l)}var r=e;t(e.h,n),t(e.i,n),i(e)}function r(t,e,s){e=e||{},s=s||window,this.family=t,this.style=e.style||"normal",this.weight=e.weight||"normal",this.stretch=e.stretch||"normal",this.context=s}var a=null,o=null,h=null,l=null;function c(t){return null===l&&(l=!!t.document.fonts),l}function u(t,e){var s=t.style,i=t.weight;if(null===h){var n=document.createElement("div");try{n.style.font="condensed 100px sans-serif"}catch(r){}h=""!==n.style.font}return[s,i,h?t.stretch:"","100px",e].join(" ")}r.prototype.load=function(t,i){var r=this,h=t||"BESbswy",l=0,d=i||3e3,p=(new Date).getTime();return new Promise((function(t,i){if(c(r.context)&&!function(t){return null===o&&(c(t)&&/Apple/.test(window.navigator.vendor)?(t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))(?:\.([0-9]+))/.exec(window.navigator.userAgent),o=!!t&&603>parseInt(t[1],10)):o=!1),o}(r.context)){var f=new Promise((function(t,e){!function s(){(new Date).getTime()-p>=d?e(Error(d+"ms timeout exceeded")):r.context.document.fonts.load(u(r,'"'+r.family+'"'),h).then((function(e){1<=e.length?t():setTimeout(s,25)}),e)}()})),m=new Promise((function(t,e){l=setTimeout((function(){e(Error(d+"ms timeout exceeded"))}),d)}));Promise.race([m,f]).then((function(){clearTimeout(l),t(r)}),i)}else!function(t){document.body?t():document.addEventListener?document.addEventListener("DOMContentLoaded",(function e(){document.removeEventListener("DOMContentLoaded",e),t()})):document.attachEvent("onreadystatechange",(function e(){"interactive"!=document.readyState&&"complete"!=document.readyState||(document.detachEvent("onreadystatechange",e),t())}))}((function(){function o(){var e;(e=-1!=g&&-1!=y||-1!=g&&-1!=x||-1!=y&&-1!=x)&&((e=g!=y&&g!=x&&y!=x)||(null===a&&(e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),a=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))),e=a&&(g==v&&y==v&&x==v||g==_&&y==_&&x==_||g==b&&y==b&&x==b)),e=!e),e&&(null!==w.parentNode&&w.parentNode.removeChild(w),clearTimeout(l),t(r))}var c=new e(h),f=new e(h),m=new e(h),g=-1,y=-1,x=-1,v=-1,_=-1,b=-1,w=document.createElement("div");w.dir="ltr",s(c,u(r,"sans-serif")),s(f,u(r,"serif")),s(m,u(r,"monospace")),w.appendChild(c.g),w.appendChild(f.g),w.appendChild(m.g),r.context.document.body.appendChild(w),v=c.g.offsetWidth,_=f.g.offsetWidth,b=m.g.offsetWidth,function t(){if((new Date).getTime()-p>=d)null!==w.parentNode&&w.parentNode.removeChild(w),i(Error(d+"ms timeout exceeded"));else{var e=r.context.document.hidden;!0!==e&&void 0!==e||(g=c.g.offsetWidth,y=f.g.offsetWidth,x=m.g.offsetWidth,o()),l=setTimeout(t,50)}}(),n(c,(function(t){g=t,o()})),s(c,u(r,'"'+r.family+'",sans-serif')),n(f,(function(t){y=t,o()})),s(f,u(r,'"'+r.family+'",serif')),n(m,(function(t){x=t,o()})),s(m,u(r,'"'+r.family+'",monospace'))}))}))},nx.exports=r}();const ax=rx;function ox(t,e){const s=e.Resolution;if(void 0===s||!Array.isArray(s))throw Error("No resolution in style!");delete e.Resolution;const i={};return Object.assign(i,...Object.values(e)),{name:t,Resolution:s,list:i}}const hx={name:"",Resolution:[1,1],list:{}};ud.prototype.prepareLoading=function(t=!1){let e;this.starter={all:{n:0,nLoaded:0,fileSize:0},bundles:{},promises:[]},e=t?()=>Object.values(this.starter.bundles).reduce(((t,e)=>t+e.nLoaded/e.n*e.fileSize),0)/this.starter.all.fileSize:()=>this.starter.all.nLoaded/this.starter.all.n,this.starter.logProgress=(t,s)=>{var i;const n=(100*s).toFixed(2).padStart(6," ")+"%",r=e(),a=(100*r).toFixed(2).padStart(6," ")+"%";console.debug(`[LOADED] Total:${a}  |  ${t}:${n}`),null==(i=this.onTotalProgress)||i.call(this,r)}},ud.prototype.addCSSFont=function(t,e,s,i=9999999){let n=this.starter.bundles["CSS-Font"];void 0===n&&(n=this.starter.bundles["CSS-Font"]={n:0,nLoaded:0,fileSize:0});const r=2e5;n.n++,n.fileSize+=r,this.starter.all.n++,this.starter.all.fileSize+=r;const a=new ax(t,e);this.starter.promises.push((()=>a.load(s,i).then((()=>{n.nLoaded++,this.starter.all.nLoaded++,this.starter.logProgress("CSS-Font",n.nLoaded/n.n)}))))},ud.prototype.loadFromList=function(t){var e;null==(e=this.onPreprocessAssetList)||e.call(this,t),this.list=t,this.starter.all.fileSize+=t.fileSize;const s=(t,e)=>s=>{e.nLoaded++,this.starter.all.nLoaded++,this.starter.logProgress(t,s)},i=(t,e)=>{let i=0;"fileSize"in e&&(i=e.fileSize,delete e.fileSize);const n=Object.keys(e).length;if(0==n)return;this.starter.all.n+=n;const r=this.starter.bundles[t]={n,nLoaded:0,fileSize:i};this.addBundle(t,e),this.starter.promises.push((()=>this.loadBundle(t,s(t,r))))};return i("Image",t.img),i("Texture",t.img_atlas),i("Spine",t.spine_json),i("Sound",t.sound),i("Style",t.style.PROD),i("Localization",t.lang.PROD),console.debug("SupportedSoundExts:",JSON.stringify(sx,void 0,2)),i("Custom",t.custom),Promise.all(this.starter.promises.map((t=>t())))},ud.prototype.get_multipack_textureMap=function(t){const e={};for(const n of Object.keys(t.img)){const t=this.get(n);e[n]=t}const s=t=>{Object.assign(e,t.textures)};for(const n of Object.keys(t.img_atlas)){const t=this.get(n);if(void 0!==t){s(t);for(const e of t.linkedSheets)s(e)}}const i={};for(const n of Object.keys(t.img_atlas)){const t=this.get(n);if(void 0!==t&&void 0!==t.data.animations)for(const s in t.data.animations){const n=t.data.animations[s];i[s]=n.map((t=>e[t]))}}return[e,i]},ud.prototype.get_SpineMap=function(t){const e={};for(const s of Object.keys(t)){const t=this.get(s);e[s]=t}return e},ud.prototype.get_viewStyleMap=function(t){const e={};{const t=this.get("styleBundle");for(const[s,i]of Object.entries(t))e[s]=ox(s,i)}return e},ud.prototype.get_localeMap=function(t){const e={};{const t=this.get("langBundle");for(const[s,i]of Object.entries(t))e[s]=l({code:s},i)}return e};class lx extends(ig(hu)){constructor(t){super(void 0!==t?globalThis.pgame.getTex(t):void 0)}setTex(t){this.texture=globalThis.pgame.getTex(t)}useViewStyle(t){super.useViewStyle(t),void 0!==t.tex&&this.setTex(t.tex)}}d(lx,"_debugLineStyle",(()=>{let t=new Ip;return t.visible=!0,t.color=tg.Yellow,t.alpha=1,t.width=2,t})());class cx extends(ig(yf)){constructor(t,e=60,s=!1){super(globalThis.pgame.getSeq(t)),this.FPS=e,this.loop=s}setSeq(t){this.textures=globalThis.pgame.getSeq(t)}get FPS(){return 60*this.animationSpeed}set FPS(t){this.animationSpeed=t/60}update(t){yf.prototype.update.call(this,t)}}d(cx,"_debugLineStyle",(()=>{let t=new Ip;return t.visible=!0,t.color=tg.Orange,t.alpha=1,t.width=2,t})());class ux extends(ig(ef)){constructor(t){var e;const s=t.text,i=t.key,n=null!=(e=t.name)?e:"",r=ux.getStyleFromInitOptions(t,n);let a=!1;void 0===r.fontFamily&&(a=!0,r.fontFamily=globalThis.pgame.currLocale.defaultFont),super(s,r),d(this,"_key",""),d(this,"_args"),d(this,"_useDefaultFont"),d(this,"_fitType","None"),d(this,"fitBox",{width:1/0,height:1/0,scale:1}),this.name=n,this._useDefaultFont=a,void 0!==i&&this.setKey(i)}get text(){return super.text}set text(t){super.text=t,this.dirty&&this._fitScale()}get fitType(){return this._fitType}set fitType(t){if(this._fitType!=t){switch(this._fitType=t,t){case"None":this._fitScale=ux.prototype._fitScale;break;case"Shrink":this._fitScale=this._shrinkScale}this._fitScale()}}setFitBox(t=1/0,e=1/0,s=1){this.fitBox.width=t,this.fitBox.height=e,this.fitBox.scale=s,this._fitScale()}setTxtStyle(t){Object.assign(this.style,t)}setKey(t){this._key=t,this._args=void 0;const e=globalThis.pgame.currLocale.dict[t];void 0!==e&&(this.text=e)}setKeyFormat(t,...e){this._key=t,this._args=e;const s=globalThis.pgame.currLocale.dict[t];void 0!==s&&(this.text=s.format(...e))}useLocale(t){const e=t.dict[this._key];void 0!==e&&(void 0===this._args?this.text=e:this.text=e.format(...this._args));const s=t.styles[this.name];void 0!==s&&Object.assign(this.style,ux.getStyleFromItem(this,s))}clear(){this.text=""}_fitScale(){}_shrinkScale(){const t=this.fitBox;if(t.width==1/0&&t.height==1/0)return;const e=this.unscaledBound;let s=t.width/e.width,i=t.height/e.height,n=Math.min(t.scale,s,i);this.scale.set(n)}static getStyleFromInitOptions(t,e){var s;const i=t;delete t.text,delete t.key,delete t.name,Object.rename(t,"font","fontFamily"),Object.rename(t,"size","fontSize"),Object.rename(t,"weight","fontWeight"),Object.rename(t,"style","fontStyle"),i.fill=null!=(s=t.fill)?s:tg.White,void 0!==t.width&&(i.wordWrap=!0,i.wordWrapWidth=t.width,delete t.width);const n=globalThis.pgame.currLocale.styles[e];return void 0!==n&&(Object.rename(n,"font","fontFamily"),Object.rename(n,"size","fontSize"),Object.assign(i,n)),i}static getStyleFromItem(t,e){const s=e;return void 0!==e.font?(s.fontFamily=e.font,delete e.font):t._useDefaultFont&&(s.fontFamily=globalThis.pgame.currLocale.defaultFont),Object.rename(e,"size","fontSize"),s}static getByKey(t){let e=globalThis.pgame.currLocale.dict[t];return e||""}static getByKeyFormat(t,...e){let s=globalThis.pgame.currLocale.dict[t];return s?s.format(...e):""}}class dx{constructor(){d(this,"shape"),d(this,"_fillStyle",new Mp),d(this,"_lineStyle",new Ip),d(this,"matrix")}fill(t,e=1){return this._fillStyle.color=t,this._fillStyle.alpha=e,this._fillStyle.visible=!0,this}line(t,e,s=1){return this._lineStyle.width=t,this._lineStyle.color=e,this._lineStyle.alpha=s,this._lineStyle.visible=!0,this}reshape(...t){return this}getGraphicsData(){var t;return new Sp(this.shape.clone(),this._fillStyle.clone(),this._lineStyle.clone(),null==(t=this.matrix)?void 0:t.clone())}}class px extends dx{constructor(t,e,s=0,i=0){super(),d(this,"shape"),this.shape=new Mh(s,i,t,e)}reshape(t,e,s=0,i=0){return this.shape.width=t,this.shape.height=e,this.shape.x=s,this.shape.y=i,this}}class fx extends dx{constructor(t,e,s,i=0,n=0){super(),d(this,"shape"),this.shape=new kh(i,n,t,e,s)}reshape(t,e,s,i=0,n=0){return this.shape.width=t,this.shape.height=e,this.shape.radius=s,this.shape.x=i,this.shape.y=n,this}}class mx extends(ig(kp)){constructor(t){t instanceof Cp?super(t):(super(),void 0!==t&&this.appendDraw(t))}appendDraw(t){const e=this.geometry;if(t instanceof dx)this.geometry.graphicsData.push(t.getGraphicsData()),e.dirty++;else if(Array.isArray(t))for(const s of t)this.geometry.graphicsData.push(s.getGraphicsData()),e.dirty++;else for(const s of t.graphicsData)this.geometry.graphicsData.push(s),e.dirty++}redraw(t){this.clear().appendDraw(t)}}d(mx,"_debugLineStyle",(()=>{let t=new Ip;return t.visible=!0,t.color=tg.Green,t.alpha=1,t.width=2,t})());class gx extends cg{constructor(t){super(),d(this,"bg"),d(this,"txt"),this.bg=t}addCenteredTxt(t,e=0,s=0){console.assert(void 0===this.txt,"Duplicate text objects"),this.txt=new ux(t),this.centerTxt(e,s),this.name=this.txt.name,this._addBoth()}centerTxt(t=0,e=0){this.txt.pivotRule=Zm.Center,this.txt.position.set(this.bg.width/2+t,this.bg.height/2+e)}addTxtObj(t){console.assert(void 0===this.txt,"Duplicate text objects"),this.txt=new ux(t),this.name=this.txt.name,this._addBoth()}setText(t){this.txt.text=t}txtFitType(t){return this.txt.fitType=t,this}txtFitBox(t=1/0,e=1/0,s=1,i=!1){return i?this.txt.setFitBox(this.bg.height*e,this.bg.width*t,s):this.txt.setFitBox(this.bg.width*t,this.bg.height*e,s),this}txtStyle(t){Object.assign(this.txt.style,t)}txtKey(t){this.txt.setKey(t)}txtKeyFormat(t,...e){this.txt.setKeyFormat(t,...e)}update(t){this.bg.update(t),this.txt.update(t)}useLocale(t){this.txt.useLocale(t)}_addBoth(){this.isInteractive()&&(this.bg.eventMode=this.txt.eventMode="auto"),this.addObj(this.bg,0).addObj(this.txt,1)}}d(gx,"_debugLineStyle",(()=>{let t=new Ip;return t.visible=!0,t.color=tg.Magneta,t.alpha=1,t.width=2,t})());var yx=(t=>(t[t.Region=0]="Region",t[t.BoundingBox=1]="BoundingBox",t[t.Mesh=2]="Mesh",t[t.LinkedMesh=3]="LinkedMesh",t[t.Path=4]="Path",t[t.Point=5]="Point",t[t.Clipping=6]="Clipping",t))(yx||{});class xx{constructor(t,e=new Array,s=0,i=new DataView(t.buffer)){this.strings=e,this.index=s,this.buffer=i}readByte(){return this.buffer.getInt8(this.index++)}readUnsignedByte(){return this.buffer.getUint8(this.index++)}readShort(){const t=this.buffer.getInt16(this.index);return this.index+=2,t}readInt32(){const t=this.buffer.getInt32(this.index);return this.index+=4,t}readInt(t){let e=this.readByte(),s=127&e;return 0!=(128&e)&&(e=this.readByte(),s|=(127&e)<<7,0!=(128&e)&&(e=this.readByte(),s|=(127&e)<<14,0!=(128&e)&&(e=this.readByte(),s|=(127&e)<<21,0!=(128&e)&&(e=this.readByte(),s|=(127&e)<<28)))),t?s:s>>>1^-(1&s)}readStringRef(){const t=this.readInt(!0);return 0==t?null:this.strings[t-1]}readString(){let t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;let e="";for(let s=0;s<t;){const t=this.readUnsignedByte();switch(t>>4){case 12:case 13:e+=String.fromCharCode((31&t)<<6|63&this.readByte()),s+=2;break;case 14:e+=String.fromCharCode((15&t)<<12|(63&this.readByte())<<6|63&this.readByte()),s+=3;break;default:e+=String.fromCharCode(t),s++}}return e}readFloat(){const t=this.buffer.getFloat32(this.index);return this.index+=4,t}readBoolean(){return 0!=this.readByte()}}var vx=(t=>(t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add",t))(vx||{}),_x=(t=>(t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut",t))(_x||{}),bx=(t=>(t[t.Fixed=0]="Fixed",t[t.Percent=1]="Percent",t))(bx||{}),wx=(t=>(t[t.Tangent=0]="Tangent",t[t.Chain=1]="Chain",t[t.ChainScale=2]="ChainScale",t))(wx||{}),Ex=(t=>(t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection",t))(Ex||{});function Sx(t){switch(t.toLowerCase()){case"nearest":return Tx.Nearest;case"linear":return Tx.Linear;case"mipmap":return Tx.MipMap;case"mipmapnearestnearest":return Tx.MipMapNearestNearest;case"mipmaplinearnearest":return Tx.MipMapLinearNearest;case"mipmapnearestlinear":return Tx.MipMapNearestLinear;case"mipmaplinearlinear":return Tx.MipMapLinearLinear;default:throw new Error(`Unknown texture filter ${t}`)}}var Tx=(t=>(t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear",t))(Tx||{}),Ax=(t=>(t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat",t))(Ax||{});class Cx{constructor(){this.size=null,this.names=null,this.values=null,this.renderObject=null}get width(){const t=this.texture;return t.trim?t.trim.width:t.orig.width}get height(){const t=this.texture;return t.trim?t.trim.height:t.orig.height}get u(){return this.texture._uvs.x0}get v(){return this.texture._uvs.y0}get u2(){return this.texture._uvs.x2}get v2(){return this.texture._uvs.y2}get offsetX(){const t=this.texture;return t.trim?t.trim.x:0}get offsetY(){return this.spineOffsetY}get pixiOffsetY(){const t=this.texture;return t.trim?t.trim.y:0}get spineOffsetY(){const t=this.texture;return this.originalHeight-this.height-(t.trim?t.trim.y:0)}get originalWidth(){return this.texture.orig.width}get originalHeight(){return this.texture.orig.height}get x(){return this.texture.frame.x}get y(){return this.texture.frame.y}get rotate(){return 0!==this.texture.rotate}get degrees(){return(360-45*this.texture.rotate)%360}}class Mx{constructor(){this.x=0,this.y=0,this.width=0,this.height=0,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0,this.rotate=0,this.index=0}}class Ix{constructor(t,e,s){this.pages=new Array,this.regions=new Array,t&&this.addSpineAtlas(t,e,s)}addTexture(t,e){const s=this.pages;let i=null;for(let r=0;r<s.length;r++)if(s[r].baseTexture===e.baseTexture){i=s[r];break}if(null===i){i=new Rx,i.name="texturePage";const t=e.baseTexture;i.width=t.realWidth,i.height=t.realHeight,i.baseTexture=t,i.minFilter=i.magFilter=Tx.Nearest,i.uWrap=Ax.ClampToEdge,i.vWrap=Ax.ClampToEdge,s.push(i)}const n=new kx;return n.name=t,n.page=i,n.texture=e,n.index=-1,this.regions.push(n),n}addTextureHash(t,e){for(const s in t)t.hasOwnProperty(s)&&this.addTexture(e&&-1!==s.indexOf(".")?s.substr(0,s.lastIndexOf(".")):s,t[s])}addSpineAtlas(t,e,s){return this.load(t,e,s)}load(t,e,s){if(null==e)throw new Error("textureLoader cannot be null.");const i=new Px(t),n=new Array(4);let r=null;const a={};let o=null;a.size=()=>{r.width=parseInt(n[1]),r.height=parseInt(n[2])},a.format=()=>{},a.filter=()=>{r.minFilter=Sx(n[1]),r.magFilter=Sx(n[2])},a.repeat=()=>{-1!=n[1].indexOf("x")&&(r.uWrap=Ax.Repeat),-1!=n[1].indexOf("y")&&(r.vWrap=Ax.Repeat)},a.pma=()=>{r.pma="true"==n[1]};const h={xy:()=>{o.x=parseInt(n[1]),o.y=parseInt(n[2])},size:()=>{o.width=parseInt(n[1]),o.height=parseInt(n[2])},bounds:()=>{o.x=parseInt(n[1]),o.y=parseInt(n[2]),o.width=parseInt(n[3]),o.height=parseInt(n[4])},offset:()=>{o.offsetX=parseInt(n[1]),o.offsetY=parseInt(n[2])},orig:()=>{o.originalWidth=parseInt(n[1]),o.originalHeight=parseInt(n[2])},offsets:()=>{o.offsetX=parseInt(n[1]),o.offsetY=parseInt(n[2]),o.originalWidth=parseInt(n[3]),o.originalHeight=parseInt(n[4])},rotate:()=>{const t=n[1];let e=0;e="true"==t.toLocaleLowerCase()?6:"false"==t.toLocaleLowerCase()?0:(720-parseFloat(t))%360/45,o.rotate=e},index:()=>{o.index=parseInt(n[1])}};let l=i.readLine();for(;null!=l&&0==l.trim().length;)l=i.readLine();for(;null!=l&&0!=l.trim().length&&0!=i.readEntry(n,l);)l=i.readLine();const c=()=>{for(;;){if(null==l)return s&&s(this);if(0==l.trim().length)r=null,l=i.readLine();else{if(null===r){for(r=new Rx,r.name=l.trim();0!=i.readEntry(n,l=i.readLine());){const t=a[n[0]];t&&t()}this.pages.push(r),e(r.name,(t=>{if(null===t)return this.pages.splice(this.pages.indexOf(r),1),s&&s(null);r.baseTexture=t,r.pma&&(t.alphaMode=vr.PMA),t.valid||t.setSize(r.width,r.height),r.setFilters(),r.width&&r.height||(r.width=t.realWidth,r.height=t.realHeight,r.width&&r.height||console.log(`ERROR spine atlas page ${r.name}: meshes wont work if you dont specify size in atlas (http://www.html5gamedevs.com/topic/18888-pixi-spines-and-meshes/?p=107121)`)),c()}));break}{o=new Mx;const t=new kx;t.name=l,t.page=r;let e=null,s=null;for(;;){const t=i.readEntry(n,l=i.readLine());if(0==t)break;const r=h[n[0]];if(r)r();else{null==e&&(e=[],s=[]),e.push(n[0]);const i=[];for(let e=0;e<t;e++)i.push(parseInt(n[e+1]));s.push(i)}}0==o.originalWidth&&0==o.originalHeight&&(o.originalWidth=o.width,o.originalHeight=o.height);const a=r.baseTexture.resolution;o.x/=a,o.y/=a,o.width/=a,o.height/=a,o.originalWidth/=a,o.originalHeight/=a,o.offsetX/=a,o.offsetY/=a;const c=o.rotate%4!=0,u=new Mh(o.x,o.y,c?o.height:o.width,c?o.width:o.height),d=new Mh(0,0,o.originalWidth,o.originalHeight),p=new Mh(o.offsetX,o.originalHeight-o.height-o.offsetY,o.width,o.height);t.texture=new Ol(t.page.baseTexture,u,d,p,o.rotate),t.index=o.index,t.texture.updateUvs(),this.regions.push(t)}}}};c()}findRegion(t){for(let e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null}dispose(){for(let t=0;t<this.pages.length;t++)this.pages[t].baseTexture.dispose()}}class Px{constructor(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}readLine(){return this.index>=this.lines.length?null:this.lines[this.index++]}readEntry(t,e){if(null==e)return 0;if(0==(e=e.trim()).length)return 0;const s=e.indexOf(":");if(-1==s)return 0;t[0]=e.substr(0,s).trim();for(let i=1,n=s+1;;i++){const s=e.indexOf(",",n);if(-1==s)return t[i]=e.substr(n).trim(),i;if(t[i]=e.substr(n,s-n).trim(),n=s+1,4==i)return 4}}}class Rx{constructor(){this.minFilter=Tx.Nearest,this.magFilter=Tx.Nearest,this.uWrap=Ax.ClampToEdge,this.vWrap=Ax.ClampToEdge}setFilters(){const t=this.baseTexture,e=this.minFilter;e==Tx.Linear?t.scaleMode=gr.LINEAR:this.minFilter==Tx.Nearest?t.scaleMode=gr.NEAREST:(t.mipmap=xr.POW2,e==Tx.MipMapNearestNearest?t.scaleMode=gr.NEAREST:t.scaleMode=gr.LINEAR)}}class kx extends Cx{}class Dx{constructor(){this.array=new Array}add(t){const e=this.contains(t);return this.array[0|t]=0|t,!e}contains(t){return null!=this.array[0|t]}remove(t){this.array[0|t]=void 0}clear(){this.array.length=0}}class Fx{constructor(){this.entries={},this.size=0}add(t){const e=this.entries[t];return this.entries[t]=!0,!e&&(this.size++,!0)}addAll(t){const e=this.size;for(let s=0,i=t.length;s<i;s++)this.add(t[s]);return e!=this.size}contains(t){return this.entries[t]}clear(){this.entries={},this.size=0}}const Ox=class{constructor(t=0,e=0,s=0,i=0){this.r=t,this.g=e,this.b=s,this.a=i}set(t,e,s,i){return this.r=t,this.g=e,this.b=s,this.a=i,this.clamp()}setFromColor(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}setFromString(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=8!=t.length?1:parseInt(t.substr(6,2),16)/255,this}add(t,e,s,i){return this.r+=t,this.g+=e,this.b+=s,this.a+=i,this.clamp()}clamp(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}static rgba8888ToColor(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255}static rgb888ToColor(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255}static fromString(t){return(new Ox).setFromString(t)}};let Nx=Ox;Nx.WHITE=new Ox(1,1,1,1),Nx.RED=new Ox(1,0,0,1),Nx.GREEN=new Ox(0,1,0,1),Nx.BLUE=new Ox(0,0,1,1),Nx.MAGENTA=new Ox(1,0,1,1);const Bx=class{static clamp(t,e,s){return t<e?e:t>s?s:t}static cosDeg(t){return Math.cos(t*Bx.degRad)}static sinDeg(t){return Math.sin(t*Bx.degRad)}static signum(t){return Math.sign(t)}static toInt(t){return t>0?Math.floor(t):Math.ceil(t)}static cbrt(t){const e=Math.pow(Math.abs(t),1/3);return t<0?-e:e}static randomTriangular(t,e){return Bx.randomTriangularWith(t,e,.5*(t+e))}static randomTriangularWith(t,e,s){const i=Math.random(),n=e-t;return i<=(s-t)/n?t+Math.sqrt(i*n*(s-t)):e-Math.sqrt((1-i)*n*(e-s))}static isPowerOfTwo(t){return t&&0==(t&t-1)}};let Lx=Bx;Lx.PI=3.1415927,Lx.PI2=2*Bx.PI,Lx.radiansToDegrees=180/Bx.PI,Lx.radDeg=Bx.radiansToDegrees,Lx.degreesToRadians=Bx.PI/180,Lx.degRad=Bx.degreesToRadians;class Vx{apply(t,e,s){return t+(e-t)*this.applyInternal(s)}}class $x extends Vx{constructor(t){super(),this.power=2,this.power=t}applyInternal(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1}}class Ux extends $x{applyInternal(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1}}const Xx=class{static arrayCopy(t,e,s,i,n){for(let r=e,a=i;r<e+n;r++,a++)s[a]=t[r]}static arrayFill(t,e,s,i){for(let n=e;n<s;n++)t[n]=i}static setArraySize(t,e,s=0){const i=t.length;if(i==e)return t;if(t.length=e,i<e)for(let n=i;n<e;n++)t[n]=s;return t}static ensureArrayCapacity(t,e,s=0){return t.length>=e?t:Xx.setArraySize(t,e,s)}static newArray(t,e){const s=new Array(t);for(let i=0;i<t;i++)s[i]=e;return s}static newFloatArray(t){if(Xx.SUPPORTS_TYPED_ARRAYS)return new Float32Array(t);const e=new Array(t);for(let s=0;s<e.length;s++)e[s]=0;return e}static newShortArray(t){if(Xx.SUPPORTS_TYPED_ARRAYS)return new Int16Array(t);const e=new Array(t);for(let s=0;s<e.length;s++)e[s]=0;return e}static toFloatArray(t){return Xx.SUPPORTS_TYPED_ARRAYS?new Float32Array(t):t}static toSinglePrecision(t){return Xx.SUPPORTS_TYPED_ARRAYS?Math.fround(t):t}static webkit602BugfixHelper(t,e){}static contains(t,e,s=!0){for(let i=0;i<t.length;i++)if(t[i]==e)return!0;return!1}static enumValue(t,e){return t[e[0].toUpperCase()+e.slice(1)]}};let Yx=Xx;Yx.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array;class Wx{constructor(t){this.items=new Array,this.instantiator=t}obtain(){return this.items.length>0?this.items.pop():this.instantiator()}free(t){t.reset&&t.reset(),this.items.push(t)}freeAll(t){for(let e=0;e<t.length;e++)this.free(t[e])}clear(){this.items.length=0}}class jx{constructor(t=0,e=0){this.x=t,this.y=e}set(t,e){return this.x=t,this.y=e,this}length(){const t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}normalize(){const t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this}}class Gx{constructor(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new Wx((()=>Yx.newFloatArray(16)))}update(t,e){if(!t)throw new Error("skeleton cannot be null.");const s=this.boundingBoxes,i=this.polygons,n=this.polygonPool,r=t.slots,a=r.length;s.length=0,n.freeAll(i),i.length=0;for(let o=0;o<a;o++){const t=r[o];if(!t.bone.active)continue;const e=t.getAttachment();if(null!=e&&e.type===yx.BoundingBox){const r=e;s.push(r);let a=n.obtain();a.length!=r.worldVerticesLength&&(a=Yx.newFloatArray(r.worldVerticesLength)),i.push(a),r.computeWorldVertices(t,0,r.worldVerticesLength,a,0,2)}}e?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)}aabbCompute(){let t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY;const n=this.polygons;for(let r=0,a=n.length;r<a;r++){const a=n[r],o=a;for(let n=0,r=a.length;n<r;n+=2){const r=o[n],a=o[n+1];t=Math.min(t,r),e=Math.min(e,a),s=Math.max(s,r),i=Math.max(i,a)}}this.minX=t,this.minY=e,this.maxX=s,this.maxY=i}aabbContainsPoint(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY}aabbIntersectsSegment(t,e,s,i){const n=this.minX,r=this.minY,a=this.maxX,o=this.maxY;if(t<=n&&s<=n||e<=r&&i<=r||t>=a&&s>=a||e>=o&&i>=o)return!1;const h=(i-e)/(s-t);let l=h*(n-t)+e;if(l>r&&l<o)return!0;if(l=h*(a-t)+e,l>r&&l<o)return!0;let c=(r-e)/h+t;return c>n&&c<a||(c=(o-e)/h+t,c>n&&c<a)}aabbIntersectsSkeleton(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY}containsPoint(t,e){const s=this.polygons;for(let i=0,n=s.length;i<n;i++)if(this.containsPointPolygon(s[i],t,e))return this.boundingBoxes[i];return null}containsPointPolygon(t,e,s){const i=t,n=t.length;let r=n-2,a=!1;for(let o=0;o<n;o+=2){const t=i[o+1],n=i[r+1];if(t<s&&n>=s||n<s&&t>=s){const h=i[o];h+(s-t)/(n-t)*(i[r]-h)<e&&(a=!a)}r=o}return a}intersectsSegment(t,e,s,i){const n=this.polygons;for(let r=0,a=n.length;r<a;r++)if(this.intersectsSegmentPolygon(n[r],t,e,s,i))return this.boundingBoxes[r];return null}intersectsSegmentPolygon(t,e,s,i,n){const r=t,a=t.length,o=e-i,h=s-n,l=e*n-s*i;let c=r[a-2],u=r[a-1];for(let d=0;d<a;d+=2){const t=r[d],a=r[d+1],p=c*a-u*t,f=c-t,m=u-a,g=o*m-h*f,y=(l*f-o*p)/g;if((y>=c&&y<=t||y>=t&&y<=c)&&(y>=e&&y<=i||y>=i&&y<=e)){const t=(l*m-h*p)/g;if((t>=u&&t<=a||t>=a&&t<=u)&&(t>=s&&t<=n||t>=n&&t<=s))return!0}c=t,u=a}return!1}getPolygon(t){if(!t)throw new Error("boundingBox cannot be null.");const e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]}getWidth(){return this.maxX-this.minX}getHeight(){return this.maxY-this.minY}}const zx=0,Hx=[0,0,0];class qx extends hu{constructor(){super(...arguments),this.region=null,this.attachment=null}}class Kx extends $p{constructor(t,e,s,i,n){super(t,e,s,i,n),this.region=null,this.attachment=null}}const Zx=class extends ru{constructor(t){if(super(),!t)throw new Error("The spineData param is required.");if("string"==typeof t)throw new Error('spineData param cant be string. Please use spine.Spine.fromAtlas("YOUR_RESOURCE_NAME") from now on.');this.spineData=t,this.createSkeleton(t),this.slotContainers=[],this.tempClipContainers=[];for(let e=0,s=this.skeleton.slots.length;e<s;e++){const t=this.skeleton.slots[e],s=t.getAttachment(),i=this.newContainer();if(this.slotContainers.push(i),this.addChild(i),this.tempClipContainers.push(null),s)if(s.type===yx.Region){const e=s.name,n=this.createSprite(t,s,e);t.currentSprite=n,t.currentSpriteName=e,i.addChild(n)}else if(s.type===yx.Mesh){const e=this.createMesh(t,s);t.currentMesh=e,t.currentMeshId=s.id,t.currentMeshName=s.name,i.addChild(e)}else s.type===yx.Clipping&&(this.createGraphics(t,s),i.addChild(t.clippingContainer),i.addChild(t.currentGraphics))}this.tintRgb=new Float32Array([1,1,1]),this.autoUpdate=!0,this.visible=!0}get debug(){return this._debug}set debug(t){var e;t!=this._debug&&(null==(e=this._debug)||e.unregisterSpine(this),null==t||t.registerSpine(this),this._debug=t)}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this.updateTransform=t?Zx.prototype.autoUpdateTransform:ru.prototype.updateTransform)}get tint(){return Mo(this.tintRgb)}set tint(t){this.tintRgb=Co(t,this.tintRgb)}get delayLimit(){return(void 0!==this.localDelayLimit?this.localDelayLimit:zx)||Number.MAX_VALUE}update(t){var e;const s=this.delayLimit;if(t>s&&(t=s),this.state.update(t),this.state.apply(this.skeleton),!this.skeleton)return;this.skeleton.updateWorldTransform();const i=this.skeleton.slots,n=this.color;let r=null,a=null;n?(r=n.light,a=n.dark):r=this.tintRgb;for(let c=0,u=i.length;c<u;c++){const t=i[c],e=t.getAttachment(),s=this.slotContainers[c];if(!e){s.visible=!1;continue}let n=null;e.sequence&&e.sequence.apply(t,e);let o=e.region;const h=e.color;switch(null!=e&&e.type){case yx.Region:if(s.transform.setFromMatrix(t.bone.matrix),o=e.region,t.currentMesh&&(t.currentMesh.visible=!1,t.currentMesh=null,t.currentMeshId=void 0,t.currentMeshName=void 0),!o){t.currentSprite&&(t.currentSprite.renderable=!1);break}if(!t.currentSpriteName||t.currentSpriteName!==e.name){const i=e.name;if(t.currentSprite&&(t.currentSprite.visible=!1),t.sprites=t.sprites||{},void 0!==t.sprites[i])t.sprites[i].visible=!0;else{const n=this.createSprite(t,e,i);s.addChild(n)}t.currentSprite=t.sprites[i],t.currentSpriteName=i}t.currentSprite.renderable=!0,t.hackRegion||this.setSpriteRegion(e,t.currentSprite,o),t.currentSprite.color?n=t.currentSprite.color:(Hx[0]=r[0]*t.color.r*h.r,Hx[1]=r[1]*t.color.g*h.g,Hx[2]=r[2]*t.color.b*h.b,t.currentSprite.tint=Mo(Hx)),t.currentSprite.blendMode=t.blendMode;break;case yx.Mesh:if(t.currentSprite){t.currentSprite.visible=!1,t.currentSprite=null,t.currentSpriteName=void 0;const e=new Wh;e._parentID=-1,e._worldID=s.transform._worldID,s.transform=e}if(!o){t.currentMesh&&(t.currentMesh.renderable=!1);break}const i=e.id;if(void 0===t.currentMeshId||t.currentMeshId!==i){const n=i;if(t.currentMesh&&(t.currentMesh.visible=!1),t.meshes=t.meshes||{},void 0!==t.meshes[n])t.meshes[n].visible=!0;else{const i=this.createMesh(t,e);s.addChild(i)}t.currentMesh=t.meshes[n],t.currentMeshName=e.name,t.currentMeshId=n}t.currentMesh.renderable=!0,e.computeWorldVerticesOld(t,t.currentMesh.vertices),t.currentMesh.color?n=t.currentMesh.color:(Hx[0]=r[0]*t.color.r*h.r,Hx[1]=r[1]*t.color.g*h.g,Hx[2]=r[2]*t.color.b*h.b,t.currentMesh.tint=Mo(Hx)),t.currentMesh.blendMode=t.blendMode,t.hackRegion||this.setMeshRegion(e,t.currentMesh,o);break;case yx.Clipping:t.currentGraphics||(this.createGraphics(t,e),s.addChild(t.clippingContainer),s.addChild(t.currentGraphics)),this.updateGraphics(t,e),s.alpha=1,s.visible=!0;continue;default:s.visible=!1;continue}if(s.visible=!0,n){let e=t.color.r*h.r,s=t.color.g*h.g,i=t.color.b*h.b;n.setLight(r[0]*e+a[0]*(1-e),r[1]*s+a[1]*(1-s),r[2]*i+a[2]*(1-i)),t.darkColor?(e=t.darkColor.r,s=t.darkColor.g,i=t.darkColor.b):(e=0,s=0,i=0),n.setDark(r[0]*e+a[0]*(1-e),r[1]*s+a[1]*(1-s),r[2]*i+a[2]*(1-i))}s.alpha=t.color.a}const o=this.skeleton.drawOrder;let h=null,l=null;for(let c=0,u=o.length;c<u;c++){const t=i[o[c].data.index],e=this.slotContainers[o[c].data.index];if(l||null!==e.parent&&e.parent!==this&&(e.parent.removeChild(e),e.parent=this),t.currentGraphics&&t.getAttachment())l=t.clippingContainer,h=t.getAttachment(),l.children.length=0,this.children[c]=e,h.endSlot===t.data&&(h.endSlot=null);else if(l){let s=this.tempClipContainers[c];s||(s=this.tempClipContainers[c]=this.newContainer(),s.visible=!1),this.children[c]=s,e.parent=null,l.addChild(e),h.endSlot==t.data&&(l.renderable=!0,l=null,h=null)}else this.children[c]=e}null==(e=this._debug)||e.renderDebug(this)}setSpriteRegion(t,e,s){e.attachment===t&&e.region===s||(e.region=s,e.attachment=t,e.texture=s.texture,e.rotation=t.rotation*Lx.degRad,e.position.x=t.x,e.position.y=t.y,e.alpha=t.color.a,s.size?(e.scale.x=s.size.width/s.originalWidth,e.scale.y=-s.size.height/s.originalHeight):(e.scale.x=t.scaleX*t.width/s.originalWidth,e.scale.y=-t.scaleY*t.height/s.originalHeight))}setMeshRegion(t,e,s){e.attachment===t&&e.region===s||(e.region=s,e.attachment=t,e.texture=s.texture,s.texture.updateUvs(),e.uvBuffer.update(t.regionUVs))}autoUpdateTransform(){{this.lastTime=this.lastTime||Date.now();const t=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.update(t)}ru.prototype.updateTransform.call(this)}createSprite(t,e,s){let i=e.region;t.hackAttachment===e&&(i=t.hackRegion);const n=i?i.texture:null,r=this.newSprite(n);return r.anchor.set(.5),i&&this.setSpriteRegion(e,r,e.region),t.sprites=t.sprites||{},t.sprites[s]=r,r}createMesh(t,e){let s=e.region;t.hackAttachment===e&&(s=t.hackRegion,t.hackAttachment=null,t.hackRegion=null);const i=this.newMesh(s?s.texture:null,new Float32Array(e.regionUVs.length),e.regionUVs,new Uint16Array(e.triangles),ur.TRIANGLES);return void 0!==i._canvasPadding&&(i._canvasPadding=1.5),i.alpha=e.color.a,i.region=e.region,s&&this.setMeshRegion(e,i,s),t.meshes=t.meshes||{},t.meshes[e.id]=i,i}createGraphics(t,e){const s=this.newGraphics(),i=new Rh([]);return s.clear(),s.beginFill(16777215,1),s.drawPolygon(i),s.renderable=!1,t.currentGraphics=s,t.clippingContainer=this.newContainer(),t.clippingContainer.mask=t.currentGraphics,s}updateGraphics(t,e){const s=t.currentGraphics.geometry,i=s.graphicsData[0].shape.points,n=e.worldVerticesLength;i.length=n,e.computeWorldVertices(t,0,n,i,0,2),s.invalidate()}hackTextureBySlotIndex(t,e=null,s=null){const i=this.skeleton.slots[t];if(!i)return!1;const n=i.getAttachment();let r=n.region;return e?(r=new Cx,r.texture=e,r.size=s,i.hackRegion=r,i.hackAttachment=n):(i.hackRegion=null,i.hackAttachment=null),i.currentSprite?this.setSpriteRegion(n,i.currentSprite,r):i.currentMesh&&this.setMeshRegion(n,i.currentMesh,r),!0}hackTextureBySlotName(t,e=null,s=null){const i=this.skeleton.findSlotIndex(t);return-1!=i&&this.hackTextureBySlotIndex(i,e,s)}hackTextureAttachment(t,e,s,i=null){const n=this.skeleton.findSlotIndex(t),r=this.skeleton.getAttachmentByName(t,e);r.region.texture=s;const a=this.skeleton.slots[n];if(!a)return!1;const o=a.getAttachment();if(e===o.name){let t=r.region;return s?(t=new Cx,t.texture=s,t.size=i,a.hackRegion=t,a.hackAttachment=o):(a.hackRegion=null,a.hackAttachment=null),a.currentSprite&&a.currentSprite.region!=t?(this.setSpriteRegion(o,a.currentSprite,t),a.currentSprite.region=t):a.currentMesh&&a.currentMesh.region!=t&&this.setMeshRegion(o,a.currentMesh,t),!0}return!1}newContainer(){return new ru}newSprite(t){return new qx(t)}newGraphics(){return new kp}newMesh(t,e,s,i,n){return new Kx(t,e,s,i,n)}transformHack(){return 1}hackAttachmentGroups(t,e,s){if(!t)return;const i=[],n=[];for(let r=0,a=this.skeleton.slots.length;r<a;r++){const a=this.skeleton.slots[r],o=a.currentSpriteName||a.currentMeshName||"",h=a.currentSprite||a.currentMesh;o.endsWith(t)?(h.parentGroup=e,n.push(h)):s&&h&&(h.parentGroup=s,i.push(h))}return[i,n]}destroy(t){this.debug=null;for(let e=0,s=this.skeleton.slots.length;e<s;e++){const s=this.skeleton.slots[e];for(const e in s.meshes)s.meshes[e].destroy(t);s.meshes=null;for(const e in s.sprites)s.sprites[e].destroy(t);s.sprites=null}for(let e=0,s=this.slotContainers.length;e<s;e++)this.slotContainers[e].destroy(t);this.spineData=null,this.skeleton=null,this.slotContainers=null,this.stateData=null,this.state=null,this.tempClipContainers=null,super.destroy(t)}};let Qx=Zx;Qx.clippingPolygon=[],Object.defineProperty(Qx.prototype,"visible",{get(){return this._visible},set(t){t!==this._visible&&(this._visible=t,t&&(this.lastTime=0))}});class Jx{constructor(){this.registeredSpines=new Map,this.drawDebug=!0,this.drawMeshHull=!0,this.drawMeshTriangles=!0,this.drawBones=!0,this.drawPaths=!0,this.drawBoundingBoxes=!0,this.drawClipping=!0,this.drawRegionAttachments=!0,this.lineWidth=1,this.regionAttachmentsColor=30975,this.meshHullColor=30975,this.meshTrianglesColor=16763904,this.clippingPolygonColor=16711935,this.boundingBoxesRectColor=65280,this.boundingBoxesPolygonColor=65280,this.boundingBoxesCircleColor=65280,this.pathsCurveColor=16711680,this.pathsLineColor=16711935,this.skeletonXYColor=16711680,this.bonesColor=61132}registerSpine(t){this.registeredSpines.has(t)&&console.warn("SpineDebugRenderer.registerSpine() - this spine is already registered!",t);const e={parentDebugContainer:new ru,bones:new ru,skeletonXY:new kp,regionAttachmentsShape:new kp,meshTrianglesLine:new kp,meshHullLine:new kp,clippingPolygon:new kp,boundingBoxesRect:new kp,boundingBoxesCircle:new kp,boundingBoxesPolygon:new kp,pathsCurve:new kp,pathsLine:new kp};e.parentDebugContainer.addChild(e.bones),e.parentDebugContainer.addChild(e.skeletonXY),e.parentDebugContainer.addChild(e.regionAttachmentsShape),e.parentDebugContainer.addChild(e.meshTrianglesLine),e.parentDebugContainer.addChild(e.meshHullLine),e.parentDebugContainer.addChild(e.clippingPolygon),e.parentDebugContainer.addChild(e.boundingBoxesRect),e.parentDebugContainer.addChild(e.boundingBoxesCircle),e.parentDebugContainer.addChild(e.boundingBoxesPolygon),e.parentDebugContainer.addChild(e.pathsCurve),e.parentDebugContainer.addChild(e.pathsLine),t.addChild(e.parentDebugContainer),this.registeredSpines.set(t,e)}renderDebug(t){this.registeredSpines.has(t)||this.registerSpine(t);const e=this.registeredSpines.get(t);e.skeletonXY.clear(),e.regionAttachmentsShape.clear(),e.meshTrianglesLine.clear(),e.meshHullLine.clear(),e.clippingPolygon.clear(),e.boundingBoxesRect.clear(),e.boundingBoxesCircle.clear(),e.boundingBoxesPolygon.clear(),e.pathsCurve.clear(),e.pathsLine.clear();for(let n=e.bones.children.length;n>0;n--)e.bones.children[n-1].destroy({children:!0,texture:!0,baseTexture:!0});const s=t.scale.x||t.scale.y||1,i=this.lineWidth/s;this.drawBones&&this.drawBonesFunc(t,e,i,s),this.drawPaths&&this.drawPathsFunc(t,e,i),this.drawBoundingBoxes&&this.drawBoundingBoxesFunc(t,e,i),this.drawClipping&&this.drawClippingFunc(t,e,i),(this.drawMeshHull||this.drawMeshTriangles)&&this.drawMeshHullAndMeshTriangles(t,e,i),this.drawRegionAttachments&&this.drawRegionAttachmentsFunc(t,e,i)}drawBonesFunc(t,e,s,i){const n=t.skeleton,r=n.x,a=n.y,o=n.bones;e.skeletonXY.lineStyle(s,this.skeletonXYColor,1);for(let l=0,c=o.length;l<c;l++){const t=o[l],n=t.data.length,h=r+t.matrix.tx,c=a+t.matrix.ty,u=r+n*t.matrix.a+t.matrix.tx,d=a+n*t.matrix.b+t.matrix.ty;if("root"===t.data.name||null===t.data.parent)continue;const p=Math.abs(h-u),f=Math.abs(c-d),m=Math.pow(p,2),g=f,y=Math.pow(f,2),x=Math.sqrt(m+y),v=Math.pow(x,2),_=Math.PI/180,b=Math.acos((v+y-m)/(2*g*x))||0;if(0===x)continue;const w=new kp;e.bones.addChild(w);const E=x/50/i;w.beginFill(this.bonesColor,1),w.drawPolygon(0,0,0-E,x-3*E,0,x-E,0+E,x-3*E),w.endFill(),w.x=h,w.y=c,w.pivot.y=x;let S=0;h<u&&c<d?S=180*_-b:h>u&&c<d?S=180*_+b:h>u&&c>d?S=-b:h<u&&c>d?S=b:c===d&&h<u?S=90*_:c===d&&h>u?S=-90*_:h===u&&c<d?S=180*_:h===u&&c>d&&(S=0),w.rotation=S,w.lineStyle(s+E/2.4,this.bonesColor,1),w.beginFill(0,.6),w.drawCircle(0,x,1.2*E),w.endFill()}const h=3*s;e.skeletonXY.moveTo(r-h,a-h),e.skeletonXY.lineTo(r+h,a+h),e.skeletonXY.moveTo(r+h,a-h),e.skeletonXY.lineTo(r-h,a+h)}drawRegionAttachmentsFunc(t,e,s){const i=t.skeleton.slots;e.regionAttachmentsShape.lineStyle(s,this.regionAttachmentsColor,1);for(let n=0,r=i.length;n<r;n++){const t=i[n],s=t.getAttachment();if(null==s||s.type!==yx.Region)continue;const r=s,a=new Float32Array(8);r.updateOffset&&r.updateOffset(),r.computeWorldVertices(t,a,0,2),e.regionAttachmentsShape.drawPolygon(Array.from(a.slice(0,8)))}}drawMeshHullAndMeshTriangles(t,e,s){const i=t.skeleton.slots;e.meshHullLine.lineStyle(s,this.meshHullColor,1),e.meshTrianglesLine.lineStyle(s,this.meshTrianglesColor,1);for(let n=0,r=i.length;n<r;n++){const t=i[n];if(!t.bone.active)continue;const s=t.getAttachment();if(null==s||s.type!==yx.Mesh)continue;const r=s,a=new Float32Array(r.worldVerticesLength),o=r.triangles;let h=r.hullLength;if(r.computeWorldVertices(t,0,r.worldVerticesLength,a,0,2),this.drawMeshTriangles)for(let i=0,n=o.length;i<n;i+=3){const t=2*o[i],s=2*o[i+1],n=2*o[i+2];e.meshTrianglesLine.moveTo(a[t],a[t+1]),e.meshTrianglesLine.lineTo(a[s],a[s+1]),e.meshTrianglesLine.lineTo(a[n],a[n+1])}if(this.drawMeshHull&&h>0){h=2*(h>>1);let t=a[h-2],s=a[h-1];for(let i=0,n=h;i<n;i+=2){const n=a[i],r=a[i+1];e.meshHullLine.moveTo(n,r),e.meshHullLine.lineTo(t,s),t=n,s=r}}}}drawClippingFunc(t,e,s){const i=t.skeleton.slots;e.clippingPolygon.lineStyle(s,this.clippingPolygonColor,1);for(let n=0,r=i.length;n<r;n++){const t=i[n];if(!t.bone.active)continue;const s=t.getAttachment();if(null==s||s.type!==yx.Clipping)continue;const r=s,a=r.worldVerticesLength,o=new Float32Array(a);r.computeWorldVertices(t,0,a,o,0,2),e.clippingPolygon.drawPolygon(Array.from(o))}}drawBoundingBoxesFunc(t,e,s){e.boundingBoxesRect.lineStyle(s,this.boundingBoxesRectColor,5);const i=new Gx;i.update(t.skeleton,!0),e.boundingBoxesRect.drawRect(i.minX,i.minY,i.getWidth(),i.getHeight());const n=i.polygons,r=(t,i,n)=>{if(e.boundingBoxesPolygon.lineStyle(s,this.boundingBoxesPolygonColor,1),e.boundingBoxesPolygon.beginFill(this.boundingBoxesPolygonColor,.1),n<3)throw new Error("Polygon must contain at least 3 vertices");const r=[],a=2*s;for(let s=0,o=t.length;s<o;s+=2){const i=t[s],n=t[s+1];e.boundingBoxesCircle.lineStyle(0),e.boundingBoxesCircle.beginFill(this.boundingBoxesCircleColor),e.boundingBoxesCircle.drawCircle(i,n,a),e.boundingBoxesCircle.endFill(),r.push(i,n)}e.boundingBoxesPolygon.drawPolygon(r),e.boundingBoxesPolygon.endFill()};for(let a=0,o=n.length;a<o;a++){const t=n[a];r(t,0,t.length)}}drawPathsFunc(t,e,s){const i=t.skeleton.slots;e.pathsCurve.lineStyle(s,this.pathsCurveColor,1),e.pathsLine.lineStyle(s,this.pathsLineColor,1);for(let n=0,r=i.length;n<r;n++){const t=i[n];if(!t.bone.active)continue;const s=t.getAttachment();if(null==s||s.type!==yx.Path)continue;const r=s;let a=r.worldVerticesLength;const o=new Float32Array(a);r.computeWorldVertices(t,0,a,o,0,2);let h=o[2],l=o[3],c=0,u=0;if(r.closed){const t=o[0],s=o[1],i=o[a-2],n=o[a-1];c=o[a-4],u=o[a-3],e.pathsCurve.moveTo(h,l),e.pathsCurve.bezierCurveTo(t,s,i,n,c,u),e.pathsLine.moveTo(h,l),e.pathsLine.lineTo(t,s),e.pathsLine.moveTo(c,u),e.pathsLine.lineTo(i,n)}a-=4;for(let i=4;i<a;i+=6){const t=o[i],s=o[i+1],n=o[i+2],r=o[i+3];c=o[i+4],u=o[i+5],e.pathsCurve.moveTo(h,l),e.pathsCurve.bezierCurveTo(t,s,n,r,c,u),e.pathsLine.moveTo(h,l),e.pathsLine.lineTo(t,s),e.pathsLine.moveTo(c,u),e.pathsLine.lineTo(n,r),h=c,l=u}}}unregisterSpine(t){this.registeredSpines.has(t)||console.warn("SpineDebugRenderer.unregisterSpine() - spine is not registered, can't unregister!",t);this.registeredSpines.get(t).parentDebugContainer.destroy({baseTexture:!0,children:!0,texture:!0}),this.registeredSpines.delete(t)}}const tv={extension:Ko.Asset,loader:{extension:{type:Ko.LoadParser,priority:ju.Normal},test:t=>Bu(t,".atlas"),load(t){return p(this,null,(function*(){const e=yield Ar.ADAPTER.fetch(t);return yield e.text()}))},testParse(t,e){const s=Bu(e.src,".atlas"),i="string"==typeof t;return Promise.resolve(s&&i)},parse(t,e,s){return p(this,null,(function*(){const i=e.data;let n=ja.dirname(e.src);n&&n.lastIndexOf("/")!==n.length-1&&(n+="/");let r=null,a=null;const o=new Promise(((t,e)=>{r=t,a=e}));let h;const l=t=>{t||a("Something went terribly wrong loading a spine .atlas file\nMost likely your texture failed to load."),r(h)};if(i.image||i.images){const e=Object.assign(i.image?{default:i.image}:{},i.images);h=new Ix(t,((t,s)=>{const i=e[t]||e.default;i&&i.baseTexture?s(i.baseTexture):s(i)}),l)}else h=new Ix(t,ev(s,n,i.imageMetadata),l);return yield o}))},unload(t){t.dispose()}}},ev=(t,e,s)=>(i,n)=>p(void 0,null,(function*(){const r=ja.normalize([...e.split(ja.sep),i].join(ja.sep)),a=yield t.load({src:r,data:s});n(a.baseTexture)}));function sv(t){return t.hasOwnProperty("bones")}Jo.add(tv);class iv{constructor(){}installLoader(){const t=this,e={extension:Ko.Asset,loader:{extension:{type:Ko.LoadParser,priority:ju.Normal},test:t=>Bu(t,".skel"),load(t){return p(this,null,(function*(){const e=yield Ar.ADAPTER.fetch(t);return yield e.arrayBuffer()}))},testParse(t,e){var s;const i=Bu(e.src,".json")&&sv(t),n=Bu(e.src,".skel")&&t instanceof ArrayBuffer;const r=!1===(null==(s=e.data)?void 0:s.spineAtlas);return Promise.resolve(i&&!r||n)},parse(e,s,i){return p(this,null,(function*(){var n;const r=ja.extname(s.src).toLowerCase(),a=ja.basename(s.src,r);let o=ja.dirname(s.src);o&&o.lastIndexOf("/")!==o.length-1&&(o+="/");const h=Bu(s.src,".json")&&sv(e);let l=null,c=e;h?l=t.createJsonParser():(l=t.createBinaryParser(),c=new Uint8Array(e));const u=s.data||{},d=null!=(n=null==u?void 0:u.spineSkeletonScale)?n:null;d&&(l.scale=d);const p=u.spineAtlas;if(p&&p.pages)return t.parseData(l,p,c);const f=u.atlasRawData;if(f){let e=null,s=null;const n=new Promise(((t,i)=>{e=t,s=i})),r=new Ix(f,ev(i,o,u.imageMetadata),(t=>{t||s("Something went terribly wrong loading a spine .atlas file\nMost likely your texture failed to load."),e(r)})),a=yield n;return t.parseData(l,a,c)}let m=u.spineAtlasFile;m||(m=`${o+a}.atlas`);const g=yield i.load({src:m,data:u,alias:u.spineAtlasAlias});return t.parseData(l,g,c)}))}}};return Jo.add(e),e}}let nv=class{constructor(t){if(null==t)throw new Error("name cannot be null.");this.name=t}};const rv=class extends nv{constructor(t){super(t),this.id=(65535&rv.nextID++)<<11,this.worldVerticesLength=0,this.deformAttachment=this}computeWorldVerticesOld(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)}computeWorldVertices(t,e,s,i,n,r){s=n+(s>>1)*r;const a=t.bone.skeleton,o=t.deform;let h=this.vertices;const l=this.bones;if(null==l){o.length>0&&(h=o);const a=t.bone.matrix,l=a.tx,c=a.ty,u=a.a,d=a.c,p=a.b,f=a.d;for(let t=e,o=n;o<s;t+=2,o+=r){const e=h[t],s=h[t+1];i[o]=e*u+s*d+l,i[o+1]=e*p+s*f+c}return}let c=0,u=0;for(let p=0;p<e;p+=2){const t=l[c];c+=t+1,u+=t}const d=a.bones;if(0==o.length)for(let p=n,f=3*u;p<s;p+=r){let t=0,e=0,s=l[c++];for(s+=c;c<s;c++,f+=3){const s=d[l[c]].matrix,i=h[f],n=h[f+1],r=h[f+2];t+=(i*s.a+n*s.c+s.tx)*r,e+=(i*s.b+n*s.d+s.ty)*r}i[p]=t,i[p+1]=e}else{const t=o;for(let e=n,a=3*u,o=u<<1;e<s;e+=r){let s=0,n=0,r=l[c++];for(r+=c;c<r;c++,a+=3,o+=2){const e=d[l[c]].matrix,i=h[a]+t[o],r=h[a+1]+t[o+1],u=h[a+2];s+=(i*e.a+r*e.c+e.tx)*u,n+=(i*e.b+r*e.d+e.ty)*u}i[e]=s,i[e+1]=n}}}copyTo(t){null!=this.bones?(t.bones=new Array(this.bones.length),Yx.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,null!=this.vertices?(t.vertices=Yx.newFloatArray(this.vertices.length),Yx.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)):t.vertices=null,t.worldVerticesLength=this.worldVerticesLength,t.deformAttachment=this.deformAttachment}};let av=rv;av.nextID=0;let ov=class t extends av{constructor(t){super(t),this.type=yx.BoundingBox,this.color=new Nx(1,1,1,1)}copy(){const e=new t(this.name);return this.copyTo(e),e.color.setFromColor(this.color),e}},hv=class t extends av{constructor(t){super(t),this.type=yx.Clipping,this.color=new Nx(.2275,.2275,.8078,1)}copy(){const e=new t(this.name);return this.copyTo(e),e.endSlot=this.endSlot,e.color.setFromColor(this.color),e}},lv=class t extends av{constructor(t){super(t),this.type=yx.Mesh,this.color=new Nx(1,1,1,1),this.tempColor=new Nx(0,0,0,0)}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}copy(){if(null!=this.parentMesh)return this.newLinkedMesh();const e=new t(this.name);return e.region=this.region,e.path=this.path,e.color.setFromColor(this.color),this.copyTo(e),e.regionUVs=new Float32Array(this.regionUVs.length),Yx.arrayCopy(this.regionUVs,0,e.regionUVs,0,this.regionUVs.length),e.triangles=new Array(this.triangles.length),Yx.arrayCopy(this.triangles,0,e.triangles,0,this.triangles.length),e.hullLength=this.hullLength,null!=this.edges&&(e.edges=new Array(this.edges.length),Yx.arrayCopy(this.edges,0,e.edges,0,this.edges.length)),e.width=this.width,e.height=this.height,e}newLinkedMesh(){const e=new t(this.name);return e.region=this.region,e.path=this.path,e.color.setFromColor(this.color),e.deformAttachment=this.deformAttachment,e.setParentMesh(null!=this.parentMesh?this.parentMesh:this),e}},cv=class t extends av{constructor(t){super(t),this.type=yx.Path,this.closed=!1,this.constantSpeed=!1,this.color=new Nx(1,1,1,1)}copy(){const e=new t(this.name);return this.copyTo(e),e.lengths=new Array(this.lengths.length),Yx.arrayCopy(this.lengths,0,e.lengths,0,this.lengths.length),e.closed=closed,e.constantSpeed=this.constantSpeed,e.color.setFromColor(this.color),e}},uv=class t extends av{constructor(t){super(t),this.type=yx.Point,this.color=new Nx(.38,.94,0,1)}computeWorldPosition(t,e){const s=t.matrix;return e.x=this.x*s.a+this.y*s.c+t.worldX,e.y=this.x*s.b+this.y*s.d+t.worldY,e}computeWorldRotation(t){const e=t.matrix,s=Lx.cosDeg(this.rotation),i=Lx.sinDeg(this.rotation),n=s*e.a+i*e.c,r=s*e.b+i*e.d;return Math.atan2(r,n)*Lx.radDeg}copy(){const e=new t(this.name);return e.x=this.x,e.y=this.y,e.rotation=this.rotation,e.color.setFromColor(this.color),e}},dv=class{constructor(t,e){if(this.deform=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new Nx,this.darkColor=null==t.darkColor?null:new Nx,this.setToSetupPose(),this.blendMode=this.data.blendMode}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)}setAttachmentTime(t){this.attachmentTime=this.bone.skeleton.time-t}getAttachmentTime(){return this.bone.skeleton.time-this.attachmentTime}setToSetupPose(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))}};const pv=class extends nv{constructor(t){super(t),this.type=yx.Region,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new Nx(1,1,1,1),this.offset=Yx.newFloatArray(8),this.uvs=Yx.newFloatArray(8),this.tempColor=new Nx(1,1,1,1)}updateOffset(){const t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,s=-this.width/2*this.scaleX+this.region.offsetX*t,i=-this.height/2*this.scaleY+this.region.offsetY*e,n=s+this.region.width*t,r=i+this.region.height*e,a=this.rotation*Math.PI/180,o=Math.cos(a),h=Math.sin(a),l=s*o+this.x,c=s*h,u=i*o+this.y,d=i*h,p=n*o+this.x,f=n*h,m=r*o+this.y,g=r*h,y=this.offset;y[pv.OX1]=l-d,y[pv.OY1]=u+c,y[pv.OX2]=l-g,y[pv.OY2]=m+c,y[pv.OX3]=p-g,y[pv.OY3]=m+f,y[pv.OX4]=p-d,y[pv.OY4]=u+f}setRegion(t){this.region=t;const e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}computeWorldVertices(t,e,s,i){const n=this.offset,r=t instanceof dv?t.bone.matrix:t.matrix,a=r.tx,o=r.ty,h=r.a,l=r.c,c=r.b,u=r.d;let d=0,p=0;d=n[pv.OX1],p=n[pv.OY1],e[s]=d*h+p*l+a,e[s+1]=d*c+p*u+o,s+=i,d=n[pv.OX2],p=n[pv.OY2],e[s]=d*h+p*l+a,e[s+1]=d*c+p*u+o,s+=i,d=n[pv.OX3],p=n[pv.OY3],e[s]=d*h+p*l+a,e[s+1]=d*c+p*u+o,s+=i,d=n[pv.OX4],p=n[pv.OY4],e[s]=d*h+p*l+a,e[s+1]=d*c+p*u+o}copy(){const t=new pv(this.name);return t.region=this.region,t.rendererObject=this.rendererObject,t.path=this.path,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,Yx.arrayCopy(this.uvs,0,t.uvs,0,8),Yx.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t}};let fv=pv;fv.OX1=0,fv.OY1=1,fv.OX2=2,fv.OY2=3,fv.OX3=4,fv.OY3=5,fv.OX4=6,fv.OY4=7,fv.X1=0,fv.Y1=1,fv.C1R=2,fv.C1G=3,fv.C1B=4,fv.C1A=5,fv.U1=6,fv.V1=7,fv.X2=8,fv.Y2=9,fv.C2R=10,fv.C2G=11,fv.C2B=12,fv.C2A=13,fv.U2=14,fv.V2=15,fv.X3=16,fv.Y3=17,fv.C3R=18,fv.C3G=19,fv.C3B=20,fv.C3A=21,fv.U3=22,fv.V3=23,fv.X4=24,fv.Y4=25,fv.C4R=26,fv.C4G=27,fv.C4B=28,fv.C4A=29,fv.U4=30,fv.V4=31;const mv=class{constructor(t){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t}begin(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY}transform(t,e,s,i){const n=this.angle*Lx.degreesToRadians,r=t.x-this.worldX,a=t.y-this.worldY,o=Math.sqrt(r*r+a*a);if(o<this.radius){const e=mv.interpolation.apply(0,n,(this.radius-o)/this.radius),s=Math.cos(e),i=Math.sin(e);t.x=s*r-i*a+this.worldX,t.y=i*r+s*a+this.worldY}}end(){}};let gv=mv;gv.interpolation=new Ux(2);let yv=class{constructor(t,e,s){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.timelineIds=[];for(let i=0;i<e.length;i++)this.timelineIds[e[i].getPropertyId()]=!0;this.duration=s}hasTimeline(t){return 1==this.timelineIds[t]}apply(t,e,s,i,n,r,a,o){if(null==t)throw new Error("skeleton cannot be null.");i&&0!=this.duration&&(s%=this.duration,e>0&&(e%=this.duration));const h=this.timelines;for(let l=0,c=h.length;l<c;l++)h[l].apply(t,e,s,n,r,a,o)}static binarySearch(t,e,s=1){let i=0,n=t.length/s-2;if(0==n)return s;let r=n>>>1;for(;;){if(t[(r+1)*s]<=e?i=r+1:n=r,i==n)return(i+1)*s;r=i+n>>>1}}static linearSearch(t,e,s){for(let i=0,n=t.length-s;i<=n;i+=s)if(t[i]>e)return i;return-1}};var xv=(t=>(t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor",t))(xv||{});const vv=class{constructor(t){if(t<=0)throw new Error(`frameCount must be > 0: ${t}`);this.curves=Yx.newFloatArray((t-1)*vv.BEZIER_SIZE)}getFrameCount(){return this.curves.length/vv.BEZIER_SIZE+1}setLinear(t){this.curves[t*vv.BEZIER_SIZE]=vv.LINEAR}setStepped(t){this.curves[t*vv.BEZIER_SIZE]=vv.STEPPED}getCurveType(t){const e=t*vv.BEZIER_SIZE;if(e==this.curves.length)return vv.LINEAR;const s=this.curves[e];return s==vv.LINEAR?vv.LINEAR:s==vv.STEPPED?vv.STEPPED:vv.BEZIER}setCurve(t,e,s,i,n){const r=.03*(2*-e+i),a=.03*(2*-s+n),o=.006*(3*(e-i)+1),h=.006*(3*(s-n)+1);let l=2*r+o,c=2*a+h,u=.3*e+r+.16666667*o,d=.3*s+a+.16666667*h,p=t*vv.BEZIER_SIZE;const f=this.curves;f[p++]=vv.BEZIER;let m=u,g=d;for(let y=p+vv.BEZIER_SIZE-1;p<y;p+=2)f[p]=m,f[p+1]=g,u+=l,d+=c,l+=o,c+=h,m+=u,g+=d}getCurvePercent(t,e){e=Lx.clamp(e,0,1);const s=this.curves;let i=t*vv.BEZIER_SIZE;const n=s[i];if(n==vv.LINEAR)return e;if(n==vv.STEPPED)return 0;i++;let r=0;for(let o=i,h=i+vv.BEZIER_SIZE-1;i<h;i+=2)if(r=s[i],r>=e){let t,n;return i==o?(t=0,n=0):(t=s[i-2],n=s[i-1]),n+(s[i+1]-n)*(e-t)/(r-t)}const a=s[i-1];return a+(1-a)*(e-r)/(1-r)}};let _v=vv;_v.LINEAR=0,_v.STEPPED=1,_v.BEZIER=2,_v.BEZIER_SIZE=19;const bv=class extends _v{constructor(t){super(t),this.frames=Yx.newFloatArray(t<<1)}getPropertyId(){return 0+this.boneIndex}setFrame(t,e,s){t<<=1,this.frames[t]=e,this.frames[t+bv.ROTATION]=s}apply(t,e,s,i,n,r,a){const o=this.frames,h=t.bones[this.boneIndex];if(!h.active)return;if(s<o[0]){switch(r){case vx.setup:return void(h.rotation=h.data.rotation);case vx.first:const t=h.data.rotation-h.rotation;h.rotation+=(t-360*(16384-(16384.499999999996-t/360|0)))*n}return}if(s>=o[o.length-bv.ENTRIES]){let t=o[o.length+bv.PREV_ROTATION];switch(r){case vx.setup:h.rotation=h.data.rotation+t*n;break;case vx.first:case vx.replace:t+=h.data.rotation-h.rotation,t-=360*(16384-(16384.499999999996-t/360|0));case vx.add:h.rotation+=t*n}return}const l=yv.binarySearch(o,s,bv.ENTRIES),c=o[l+bv.PREV_ROTATION],u=o[l],d=this.getCurvePercent((l>>1)-1,1-(s-u)/(o[l+bv.PREV_TIME]-u));let p=o[l+bv.ROTATION]-c;switch(p=c+(p-360*(16384-(16384.499999999996-p/360|0)))*d,r){case vx.setup:h.rotation=h.data.rotation+(p-360*(16384-(16384.499999999996-p/360|0)))*n;break;case vx.first:case vx.replace:p+=h.data.rotation-h.rotation;case vx.add:h.rotation+=(p-360*(16384-(16384.499999999996-p/360|0)))*n}}};let wv=bv;wv.ENTRIES=2,wv.PREV_TIME=-2,wv.PREV_ROTATION=-1,wv.ROTATION=1;const Ev=class extends _v{constructor(t){super(t),this.frames=Yx.newFloatArray(t*Ev.ENTRIES)}getPropertyId(){return(1<<24)+this.boneIndex}setFrame(t,e,s,i){t*=Ev.ENTRIES,this.frames[t]=e,this.frames[t+Ev.X]=s,this.frames[t+Ev.Y]=i}apply(t,e,s,i,n,r,a){const o=this.frames,h=t.bones[this.boneIndex];if(!h.active)return;if(s<o[0]){switch(r){case vx.setup:return h.x=h.data.x,void(h.y=h.data.y);case vx.first:h.x+=(h.data.x-h.x)*n,h.y+=(h.data.y-h.y)*n}return}let l=0,c=0;if(s>=o[o.length-Ev.ENTRIES])l=o[o.length+Ev.PREV_X],c=o[o.length+Ev.PREV_Y];else{const t=yv.binarySearch(o,s,Ev.ENTRIES);l=o[t+Ev.PREV_X],c=o[t+Ev.PREV_Y];const e=o[t],i=this.getCurvePercent(t/Ev.ENTRIES-1,1-(s-e)/(o[t+Ev.PREV_TIME]-e));l+=(o[t+Ev.X]-l)*i,c+=(o[t+Ev.Y]-c)*i}switch(r){case vx.setup:h.x=h.data.x+l*n,h.y=h.data.y+c*n;break;case vx.first:case vx.replace:h.x+=(h.data.x+l-h.x)*n,h.y+=(h.data.y+c-h.y)*n;break;case vx.add:h.x+=l*n,h.y+=c*n}}};let Sv=Ev;Sv.ENTRIES=3,Sv.PREV_TIME=-3,Sv.PREV_X=-2,Sv.PREV_Y=-1,Sv.X=1,Sv.Y=2;let Tv=class t extends Sv{constructor(t){super(t)}getPropertyId(){return(2<<24)+this.boneIndex}apply(e,s,i,n,r,a,o){const h=this.frames,l=e.bones[this.boneIndex];if(!l.active)return;if(i<h[0]){switch(a){case vx.setup:return l.scaleX=l.data.scaleX,void(l.scaleY=l.data.scaleY);case vx.first:l.scaleX+=(l.data.scaleX-l.scaleX)*r,l.scaleY+=(l.data.scaleY-l.scaleY)*r}return}let c=0,u=0;if(i>=h[h.length-t.ENTRIES])c=h[h.length+t.PREV_X]*l.data.scaleX,u=h[h.length+t.PREV_Y]*l.data.scaleY;else{const e=yv.binarySearch(h,i,t.ENTRIES);c=h[e+t.PREV_X],u=h[e+t.PREV_Y];const s=h[e],n=this.getCurvePercent(e/t.ENTRIES-1,1-(i-s)/(h[e+t.PREV_TIME]-s));c=(c+(h[e+t.X]-c)*n)*l.data.scaleX,u=(u+(h[e+t.Y]-u)*n)*l.data.scaleY}if(1==r)a==vx.add?(l.scaleX+=c-l.data.scaleX,l.scaleY+=u-l.data.scaleY):(l.scaleX=c,l.scaleY=u);else{let t=0,e=0;if(o==_x.mixOut)switch(a){case vx.setup:t=l.data.scaleX,e=l.data.scaleY,l.scaleX=t+(Math.abs(c)*Lx.signum(t)-t)*r,l.scaleY=e+(Math.abs(u)*Lx.signum(e)-e)*r;break;case vx.first:case vx.replace:t=l.scaleX,e=l.scaleY,l.scaleX=t+(Math.abs(c)*Lx.signum(t)-t)*r,l.scaleY=e+(Math.abs(u)*Lx.signum(e)-e)*r;break;case vx.add:t=l.scaleX,e=l.scaleY,l.scaleX=t+(Math.abs(c)*Lx.signum(t)-l.data.scaleX)*r,l.scaleY=e+(Math.abs(u)*Lx.signum(e)-l.data.scaleY)*r}else switch(a){case vx.setup:t=Math.abs(l.data.scaleX)*Lx.signum(c),e=Math.abs(l.data.scaleY)*Lx.signum(u),l.scaleX=t+(c-t)*r,l.scaleY=e+(u-e)*r;break;case vx.first:case vx.replace:t=Math.abs(l.scaleX)*Lx.signum(c),e=Math.abs(l.scaleY)*Lx.signum(u),l.scaleX=t+(c-t)*r,l.scaleY=e+(u-e)*r;break;case vx.add:t=Lx.signum(c),e=Lx.signum(u),l.scaleX=Math.abs(l.scaleX)*t+(c-Math.abs(l.data.scaleX)*t)*r,l.scaleY=Math.abs(l.scaleY)*e+(u-Math.abs(l.data.scaleY)*e)*r}}}},Av=class t extends Sv{constructor(t){super(t)}getPropertyId(){return(3<<24)+this.boneIndex}apply(e,s,i,n,r,a,o){const h=this.frames,l=e.bones[this.boneIndex];if(!l.active)return;if(i<h[0]){switch(a){case vx.setup:return l.shearX=l.data.shearX,void(l.shearY=l.data.shearY);case vx.first:l.shearX+=(l.data.shearX-l.shearX)*r,l.shearY+=(l.data.shearY-l.shearY)*r}return}let c=0,u=0;if(i>=h[h.length-t.ENTRIES])c=h[h.length+t.PREV_X],u=h[h.length+t.PREV_Y];else{const e=yv.binarySearch(h,i,t.ENTRIES);c=h[e+t.PREV_X],u=h[e+t.PREV_Y];const s=h[e],n=this.getCurvePercent(e/t.ENTRIES-1,1-(i-s)/(h[e+t.PREV_TIME]-s));c+=(h[e+t.X]-c)*n,u+=(h[e+t.Y]-u)*n}switch(a){case vx.setup:l.shearX=l.data.shearX+c*r,l.shearY=l.data.shearY+u*r;break;case vx.first:case vx.replace:l.shearX+=(l.data.shearX+c-l.shearX)*r,l.shearY+=(l.data.shearY+u-l.shearY)*r;break;case vx.add:l.shearX+=c*r,l.shearY+=u*r}}};const Cv=class extends _v{constructor(t){super(t),this.frames=Yx.newFloatArray(t*Cv.ENTRIES)}getPropertyId(){return(5<<24)+this.slotIndex}setFrame(t,e,s,i,n,r){t*=Cv.ENTRIES,this.frames[t]=e,this.frames[t+Cv.R]=s,this.frames[t+Cv.G]=i,this.frames[t+Cv.B]=n,this.frames[t+Cv.A]=r}apply(t,e,s,i,n,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=this.frames;if(s<h[0]){switch(r){case vx.setup:return void o.color.setFromColor(o.data.color);case vx.first:const t=o.color,e=o.data.color;t.add((e.r-t.r)*n,(e.g-t.g)*n,(e.b-t.b)*n,(e.a-t.a)*n)}return}let l=0,c=0,u=0,d=0;if(s>=h[h.length-Cv.ENTRIES]){const t=h.length;l=h[t+Cv.PREV_R],c=h[t+Cv.PREV_G],u=h[t+Cv.PREV_B],d=h[t+Cv.PREV_A]}else{const t=yv.binarySearch(h,s,Cv.ENTRIES);l=h[t+Cv.PREV_R],c=h[t+Cv.PREV_G],u=h[t+Cv.PREV_B],d=h[t+Cv.PREV_A];const e=h[t],i=this.getCurvePercent(t/Cv.ENTRIES-1,1-(s-e)/(h[t+Cv.PREV_TIME]-e));l+=(h[t+Cv.R]-l)*i,c+=(h[t+Cv.G]-c)*i,u+=(h[t+Cv.B]-u)*i,d+=(h[t+Cv.A]-d)*i}if(1==n)o.color.set(l,c,u,d);else{const t=o.color;r==vx.setup&&t.setFromColor(o.data.color),t.add((l-t.r)*n,(c-t.g)*n,(u-t.b)*n,(d-t.a)*n)}}};let Mv=Cv;Mv.ENTRIES=5,Mv.PREV_TIME=-5,Mv.PREV_R=-4,Mv.PREV_G=-3,Mv.PREV_B=-2,Mv.PREV_A=-1,Mv.R=1,Mv.G=2,Mv.B=3,Mv.A=4;const Iv=class extends _v{constructor(t){super(t),this.frames=Yx.newFloatArray(t*Iv.ENTRIES)}getPropertyId(){return(14<<24)+this.slotIndex}setFrame(t,e,s,i,n,r,a,o,h){t*=Iv.ENTRIES,this.frames[t]=e,this.frames[t+Iv.R]=s,this.frames[t+Iv.G]=i,this.frames[t+Iv.B]=n,this.frames[t+Iv.A]=r,this.frames[t+Iv.R2]=a,this.frames[t+Iv.G2]=o,this.frames[t+Iv.B2]=h}apply(t,e,s,i,n,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=this.frames;if(s<h[0]){switch(r){case vx.setup:return o.color.setFromColor(o.data.color),void o.darkColor.setFromColor(o.data.darkColor);case vx.first:const t=o.color,e=o.darkColor,s=o.data.color,i=o.data.darkColor;t.add((s.r-t.r)*n,(s.g-t.g)*n,(s.b-t.b)*n,(s.a-t.a)*n),e.add((i.r-e.r)*n,(i.g-e.g)*n,(i.b-e.b)*n,0)}return}let l=0,c=0,u=0,d=0,p=0,f=0,m=0;if(s>=h[h.length-Iv.ENTRIES]){const t=h.length;l=h[t+Iv.PREV_R],c=h[t+Iv.PREV_G],u=h[t+Iv.PREV_B],d=h[t+Iv.PREV_A],p=h[t+Iv.PREV_R2],f=h[t+Iv.PREV_G2],m=h[t+Iv.PREV_B2]}else{const t=yv.binarySearch(h,s,Iv.ENTRIES);l=h[t+Iv.PREV_R],c=h[t+Iv.PREV_G],u=h[t+Iv.PREV_B],d=h[t+Iv.PREV_A],p=h[t+Iv.PREV_R2],f=h[t+Iv.PREV_G2],m=h[t+Iv.PREV_B2];const e=h[t],i=this.getCurvePercent(t/Iv.ENTRIES-1,1-(s-e)/(h[t+Iv.PREV_TIME]-e));l+=(h[t+Iv.R]-l)*i,c+=(h[t+Iv.G]-c)*i,u+=(h[t+Iv.B]-u)*i,d+=(h[t+Iv.A]-d)*i,p+=(h[t+Iv.R2]-p)*i,f+=(h[t+Iv.G2]-f)*i,m+=(h[t+Iv.B2]-m)*i}if(1==n)o.color.set(l,c,u,d),o.darkColor.set(p,f,m,1);else{const t=o.color,e=o.darkColor;r==vx.setup&&(t.setFromColor(o.data.color),e.setFromColor(o.data.darkColor)),t.add((l-t.r)*n,(c-t.g)*n,(u-t.b)*n,(d-t.a)*n),e.add((p-e.r)*n,(f-e.g)*n,(m-e.b)*n,0)}}};let Pv=Iv;Pv.ENTRIES=8,Pv.PREV_TIME=-8,Pv.PREV_R=-7,Pv.PREV_G=-6,Pv.PREV_B=-5,Pv.PREV_A=-4,Pv.PREV_R2=-3,Pv.PREV_G2=-2,Pv.PREV_B2=-1,Pv.R=1,Pv.G=2,Pv.B=3,Pv.A=4,Pv.R2=5,Pv.G2=6,Pv.B2=7;let Rv=class{constructor(t){this.frames=Yx.newFloatArray(t),this.attachmentNames=new Array(t)}getPropertyId(){return(4<<24)+this.slotIndex}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.attachmentNames[t]=s}apply(t,e,s,i,n,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;if(a==_x.mixOut)return void(r==vx.setup&&this.setAttachment(t,o,o.data.attachmentName));const h=this.frames;if(s<h[0])return void(r!=vx.setup&&r!=vx.first||this.setAttachment(t,o,o.data.attachmentName));let l=0;l=s>=h[h.length-1]?h.length-1:yv.binarySearch(h,s,1)-1;const c=this.attachmentNames[l];t.slots[this.slotIndex].setAttachment(null==c?null:t.getAttachment(this.slotIndex,c))}setAttachment(t,e,s){e.setAttachment(null==s?null:t.getAttachment(this.slotIndex,s))}},kv=null,Dv=class extends _v{constructor(t){super(t),this.frames=Yx.newFloatArray(t),this.frameVertices=new Array(t),null==kv&&(kv=Yx.newFloatArray(64))}getPropertyId(){return(6<<27)+Number(this.attachment.id)+this.slotIndex}setFrame(t,e,s){this.frames[t]=e,this.frameVertices[t]=s}apply(t,e,s,i,n,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=o.getAttachment();if(!(h instanceof av)||h.deformAttachment!=this.attachment)return;const l=o.deform;0==l.length&&(r=vx.setup);const c=this.frameVertices,u=c[0].length,d=this.frames;if(s<d[0]){const t=h;switch(r){case vx.setup:return void(l.length=0);case vx.first:if(1==n){l.length=0;break}const e=Yx.setArraySize(l,u);if(null==t.bones){const s=t.vertices;for(let t=0;t<u;t++)e[t]+=(s[t]-e[t])*n}else{n=1-n;for(let t=0;t<u;t++)e[t]*=n}}return}const p=Yx.setArraySize(l,u);if(s>=d[d.length-1]){const t=c[d.length-1];if(1==n)if(r==vx.add){const e=h;if(null==e.bones){const s=e.vertices;for(let e=0;e<u;e++)p[e]+=t[e]-s[e]}else for(let s=0;s<u;s++)p[s]+=t[s]}else Yx.arrayCopy(t,0,p,0,u);else switch(r){case vx.setup:{const e=h;if(null==e.bones){const s=e.vertices;for(let e=0;e<u;e++){const i=s[e];p[e]=i+(t[e]-i)*n}}else for(let s=0;s<u;s++)p[s]=t[s]*n;break}case vx.first:case vx.replace:for(let s=0;s<u;s++)p[s]+=(t[s]-p[s])*n;break;case vx.add:const e=h;if(null==e.bones){const s=e.vertices;for(let e=0;e<u;e++)p[e]+=(t[e]-s[e])*n}else for(let s=0;s<u;s++)p[s]+=t[s]*n}return}const f=yv.binarySearch(d,s),m=c[f-1],g=c[f],y=d[f],x=this.getCurvePercent(f-1,1-(s-y)/(d[f-1]-y));if(1==n)if(r==vx.add){const t=h;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const s=m[t];p[t]+=s+(g[t]-s)*x-e[t]}}else for(let e=0;e<u;e++){const t=m[e];p[e]+=t+(g[e]-t)*x}}else for(let v=0;v<u;v++){const t=m[v];p[v]=t+(g[v]-t)*x}else switch(r){case vx.setup:{const t=h;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const s=m[t],i=e[t];p[t]=i+(s+(g[t]-s)*x-i)*n}}else for(let e=0;e<u;e++){const t=m[e];p[e]=(t+(g[e]-t)*x)*n}break}case vx.first:case vx.replace:for(let e=0;e<u;e++){const t=m[e];p[e]+=(t+(g[e]-t)*x-p[e])*n}break;case vx.add:const t=h;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const s=m[t];p[t]+=(s+(g[t]-s)*x-e[t])*n}}else for(let e=0;e<u;e++){const t=m[e];p[e]+=(t+(g[e]-t)*x)*n}}}},Fv=class{constructor(t){this.frames=Yx.newFloatArray(t),this.events=new Array(t)}getPropertyId(){return 7<<24}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,s,i,n,r,a){if(null==i)return;const o=this.frames,h=this.frames.length;if(e>s)this.apply(t,e,Number.MAX_VALUE,i,n,r,a),e=-1;else if(e>=o[h-1])return;if(s<o[0])return;let l=0;if(e<o[0])l=0;else{l=yv.binarySearch(o,e);const t=o[l];for(;l>0&&o[l-1]==t;)l--}for(;l<h&&s>=o[l];l++)i.push(this.events[l])}},Ov=class{constructor(t){this.frames=Yx.newFloatArray(t),this.drawOrders=new Array(t)}getPropertyId(){return 8<<24}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.drawOrders[t]=s}apply(t,e,s,i,n,r,a){const o=t.drawOrder,h=t.slots;if(a==_x.mixOut&&r==vx.setup)return void Yx.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);const l=this.frames;if(s<l[0])return void(r!=vx.setup&&r!=vx.first||Yx.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));let c=0;c=s>=l[l.length-1]?l.length-1:yv.binarySearch(l,s)-1;const u=this.drawOrders[c];if(null==u)Yx.arrayCopy(h,0,o,0,h.length);else for(let d=0,p=u.length;d<p;d++)o[d]=h[u[d]]}};const Nv=class extends _v{constructor(t){super(t),this.frames=Yx.newFloatArray(t*Nv.ENTRIES)}getPropertyId(){return(9<<24)+this.ikConstraintIndex}setFrame(t,e,s,i,n,r,a){t*=Nv.ENTRIES,this.frames[t]=e,this.frames[t+Nv.MIX]=s,this.frames[t+Nv.SOFTNESS]=i,this.frames[t+Nv.BEND_DIRECTION]=n,this.frames[t+Nv.COMPRESS]=r?1:0,this.frames[t+Nv.STRETCH]=a?1:0}apply(t,e,s,i,n,r,a){const o=this.frames,h=t.ikConstraints[this.ikConstraintIndex];if(!h.active)return;if(s<o[0]){switch(r){case vx.setup:return h.mix=h.data.mix,h.softness=h.data.softness,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,void(h.stretch=h.data.stretch);case vx.first:h.mix+=(h.data.mix-h.mix)*n,h.softness+=(h.data.softness-h.softness)*n,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch}return}if(s>=o[o.length-Nv.ENTRIES])return void(r==vx.setup?(h.mix=h.data.mix+(o[o.length+Nv.PREV_MIX]-h.data.mix)*n,h.softness=h.data.softness+(o[o.length+Nv.PREV_SOFTNESS]-h.data.softness)*n,a==_x.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=o[o.length+Nv.PREV_BEND_DIRECTION],h.compress=0!=o[o.length+Nv.PREV_COMPRESS],h.stretch=0!=o[o.length+Nv.PREV_STRETCH])):(h.mix+=(o[o.length+Nv.PREV_MIX]-h.mix)*n,h.softness+=(o[o.length+Nv.PREV_SOFTNESS]-h.softness)*n,a==_x.mixIn&&(h.bendDirection=o[o.length+Nv.PREV_BEND_DIRECTION],h.compress=0!=o[o.length+Nv.PREV_COMPRESS],h.stretch=0!=o[o.length+Nv.PREV_STRETCH])));const l=yv.binarySearch(o,s,Nv.ENTRIES),c=o[l+Nv.PREV_MIX],u=o[l+Nv.PREV_SOFTNESS],d=o[l],p=this.getCurvePercent(l/Nv.ENTRIES-1,1-(s-d)/(o[l+Nv.PREV_TIME]-d));r==vx.setup?(h.mix=h.data.mix+(c+(o[l+Nv.MIX]-c)*p-h.data.mix)*n,h.softness=h.data.softness+(u+(o[l+Nv.SOFTNESS]-u)*p-h.data.softness)*n,a==_x.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=o[l+Nv.PREV_BEND_DIRECTION],h.compress=0!=o[l+Nv.PREV_COMPRESS],h.stretch=0!=o[l+Nv.PREV_STRETCH])):(h.mix+=(c+(o[l+Nv.MIX]-c)*p-h.mix)*n,h.softness+=(u+(o[l+Nv.SOFTNESS]-u)*p-h.softness)*n,a==_x.mixIn&&(h.bendDirection=o[l+Nv.PREV_BEND_DIRECTION],h.compress=0!=o[l+Nv.PREV_COMPRESS],h.stretch=0!=o[l+Nv.PREV_STRETCH]))}};let Bv=Nv;Bv.ENTRIES=6,Bv.PREV_TIME=-6,Bv.PREV_MIX=-5,Bv.PREV_SOFTNESS=-4,Bv.PREV_BEND_DIRECTION=-3,Bv.PREV_COMPRESS=-2,Bv.PREV_STRETCH=-1,Bv.MIX=1,Bv.SOFTNESS=2,Bv.BEND_DIRECTION=3,Bv.COMPRESS=4,Bv.STRETCH=5;const Lv=class extends _v{constructor(t){super(t),this.frames=Yx.newFloatArray(t*Lv.ENTRIES)}getPropertyId(){return(10<<24)+this.transformConstraintIndex}setFrame(t,e,s,i,n,r){t*=Lv.ENTRIES,this.frames[t]=e,this.frames[t+Lv.ROTATE]=s,this.frames[t+Lv.TRANSLATE]=i,this.frames[t+Lv.SCALE]=n,this.frames[t+Lv.SHEAR]=r}apply(t,e,s,i,n,r,a){const o=this.frames,h=t.transformConstraints[this.transformConstraintIndex];if(!h.active)return;if(s<o[0]){const t=h.data;switch(r){case vx.setup:return h.rotateMix=t.rotateMix,h.translateMix=t.translateMix,h.scaleMix=t.scaleMix,void(h.shearMix=t.shearMix);case vx.first:h.rotateMix+=(t.rotateMix-h.rotateMix)*n,h.translateMix+=(t.translateMix-h.translateMix)*n,h.scaleMix+=(t.scaleMix-h.scaleMix)*n,h.shearMix+=(t.shearMix-h.shearMix)*n}return}let l=0,c=0,u=0,d=0;if(s>=o[o.length-Lv.ENTRIES]){const t=o.length;l=o[t+Lv.PREV_ROTATE],c=o[t+Lv.PREV_TRANSLATE],u=o[t+Lv.PREV_SCALE],d=o[t+Lv.PREV_SHEAR]}else{const t=yv.binarySearch(o,s,Lv.ENTRIES);l=o[t+Lv.PREV_ROTATE],c=o[t+Lv.PREV_TRANSLATE],u=o[t+Lv.PREV_SCALE],d=o[t+Lv.PREV_SHEAR];const e=o[t],i=this.getCurvePercent(t/Lv.ENTRIES-1,1-(s-e)/(o[t+Lv.PREV_TIME]-e));l+=(o[t+Lv.ROTATE]-l)*i,c+=(o[t+Lv.TRANSLATE]-c)*i,u+=(o[t+Lv.SCALE]-u)*i,d+=(o[t+Lv.SHEAR]-d)*i}if(r==vx.setup){const t=h.data;h.rotateMix=t.rotateMix+(l-t.rotateMix)*n,h.translateMix=t.translateMix+(c-t.translateMix)*n,h.scaleMix=t.scaleMix+(u-t.scaleMix)*n,h.shearMix=t.shearMix+(d-t.shearMix)*n}else h.rotateMix+=(l-h.rotateMix)*n,h.translateMix+=(c-h.translateMix)*n,h.scaleMix+=(u-h.scaleMix)*n,h.shearMix+=(d-h.shearMix)*n}};let Vv=Lv;Vv.ENTRIES=5,Vv.PREV_TIME=-5,Vv.PREV_ROTATE=-4,Vv.PREV_TRANSLATE=-3,Vv.PREV_SCALE=-2,Vv.PREV_SHEAR=-1,Vv.ROTATE=1,Vv.TRANSLATE=2,Vv.SCALE=3,Vv.SHEAR=4;const $v=class extends _v{constructor(t){super(t),this.frames=Yx.newFloatArray(t*$v.ENTRIES)}getPropertyId(){return(11<<24)+this.pathConstraintIndex}setFrame(t,e,s){t*=$v.ENTRIES,this.frames[t]=e,this.frames[t+$v.VALUE]=s}apply(t,e,s,i,n,r,a){const o=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(!h.active)return;if(s<o[0]){switch(r){case vx.setup:return void(h.position=h.data.position);case vx.first:h.position+=(h.data.position-h.position)*n}return}let l=0;if(s>=o[o.length-$v.ENTRIES])l=o[o.length+$v.PREV_VALUE];else{const t=yv.binarySearch(o,s,$v.ENTRIES);l=o[t+$v.PREV_VALUE];const e=o[t],i=this.getCurvePercent(t/$v.ENTRIES-1,1-(s-e)/(o[t+$v.PREV_TIME]-e));l+=(o[t+$v.VALUE]-l)*i}r==vx.setup?h.position=h.data.position+(l-h.data.position)*n:h.position+=(l-h.position)*n}};let Uv=$v;Uv.ENTRIES=2,Uv.PREV_TIME=-2,Uv.PREV_VALUE=-1,Uv.VALUE=1;let Xv=class t extends Uv{constructor(t){super(t)}getPropertyId(){return(12<<24)+this.pathConstraintIndex}apply(e,s,i,n,r,a,o){const h=this.frames,l=e.pathConstraints[this.pathConstraintIndex];if(!l.active)return;if(i<h[0]){switch(a){case vx.setup:return void(l.spacing=l.data.spacing);case vx.first:l.spacing+=(l.data.spacing-l.spacing)*r}return}let c=0;if(i>=h[h.length-t.ENTRIES])c=h[h.length+t.PREV_VALUE];else{const e=yv.binarySearch(h,i,t.ENTRIES);c=h[e+t.PREV_VALUE];const s=h[e],n=this.getCurvePercent(e/t.ENTRIES-1,1-(i-s)/(h[e+t.PREV_TIME]-s));c+=(h[e+t.VALUE]-c)*n}a==vx.setup?l.spacing=l.data.spacing+(c-l.data.spacing)*r:l.spacing+=(c-l.spacing)*r}};const Yv=class extends _v{constructor(t){super(t),this.frames=Yx.newFloatArray(t*Yv.ENTRIES)}getPropertyId(){return(13<<24)+this.pathConstraintIndex}setFrame(t,e,s,i){t*=Yv.ENTRIES,this.frames[t]=e,this.frames[t+Yv.ROTATE]=s,this.frames[t+Yv.TRANSLATE]=i}apply(t,e,s,i,n,r,a){const o=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(!h.active)return;if(s<o[0]){switch(r){case vx.setup:return h.rotateMix=h.data.rotateMix,void(h.translateMix=h.data.translateMix);case vx.first:h.rotateMix+=(h.data.rotateMix-h.rotateMix)*n,h.translateMix+=(h.data.translateMix-h.translateMix)*n}return}let l=0,c=0;if(s>=o[o.length-Yv.ENTRIES])l=o[o.length+Yv.PREV_ROTATE],c=o[o.length+Yv.PREV_TRANSLATE];else{const t=yv.binarySearch(o,s,Yv.ENTRIES);l=o[t+Yv.PREV_ROTATE],c=o[t+Yv.PREV_TRANSLATE];const e=o[t],i=this.getCurvePercent(t/Yv.ENTRIES-1,1-(s-e)/(o[t+Yv.PREV_TIME]-e));l+=(o[t+Yv.ROTATE]-l)*i,c+=(o[t+Yv.TRANSLATE]-c)*i}r==vx.setup?(h.rotateMix=h.data.rotateMix+(l-h.data.rotateMix)*n,h.translateMix=h.data.translateMix+(c-h.data.translateMix)*n):(h.rotateMix+=(l-h.rotateMix)*n,h.translateMix+=(c-h.translateMix)*n)}};let Wv=Yv;Wv.ENTRIES=3,Wv.PREV_TIME=-3,Wv.PREV_ROTATE=-2,Wv.PREV_TRANSLATE=-1,Wv.ROTATE=1,Wv.TRANSLATE=2;const jv=class{constructor(t){this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new Kv(this),this.propertyIDs=new Dx,this.animationsChanged=!1,this.trackEntryPool=new Wx((()=>new Hv)),this.data=t}update(t){t*=this.timeScale;const e=this.tracks;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(null==i)continue;i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast;let n=t*i.timeScale;if(i.delay>0){if(i.delay-=n,i.delay>0)continue;n=-i.delay,i.delay=0}let r=i.next;if(null!=r){const e=i.trackLast-r.delay;if(e>=0){for(r.delay=0,r.trackTime+=0==i.timeScale?0:(e/i.timeScale+t)*r.timeScale,i.trackTime+=n,this.setCurrent(s,r,!0);null!=r.mixingFrom;)r.mixTime+=t,r=r.mixingFrom;continue}}else if(i.trackLast>=i.trackEnd&&null==i.mixingFrom){e[s]=null,this.queue.end(i),this.disposeNext(i);continue}if(null!=i.mixingFrom&&this.updateMixingFrom(i,t)){let t=i.mixingFrom;for(i.mixingFrom=null,null!=t&&(t.mixingTo=null);null!=t;)this.queue.end(t),t=t.mixingFrom}i.trackTime+=n}this.queue.drain()}updateMixingFrom(t,e){const s=t.mixingFrom;if(null==s)return!0;const i=this.updateMixingFrom(s,e);return s.animationLast=s.nextAnimationLast,s.trackLast=s.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=s.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=s.mixingFrom,null!=s.mixingFrom&&(s.mixingFrom.mixingTo=t),t.interruptAlpha=s.interruptAlpha,this.queue.end(s)),i):(s.trackTime+=e*s.timeScale,t.mixTime+=e,!1)}apply(t){if(null==t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();const e=this.events,s=this.tracks;let i=!1;for(let a=0,o=s.length;a<o;a++){const n=s[a];if(null==n||n.delay>0)continue;i=!0;const r=0==a?vx.first:n.mixBlend;let o=n.alpha;null!=n.mixingFrom?o*=this.applyMixingFrom(n,t,r):n.trackTime>=n.trackEnd&&null==n.next&&(o=0);const h=n.animationLast,l=n.getAnimationTime(),c=n.animation.timelines.length,u=n.animation.timelines;if(0==a&&1==o||r==vx.add)for(let s=0;s<c;s++){const i=u[s];i instanceof Rv?this.applyAttachmentTimeline(i,t,l,r,!0):i.apply(t,h,l,e,o,r,_x.mixIn)}else{const s=n.timelineMode,i=0==n.timelinesRotation.length;i&&Yx.setArraySize(n.timelinesRotation,c<<1,null);const a=n.timelinesRotation;for(let n=0;n<c;n++){const c=u[n],d=s[n]==jv.SUBSEQUENT?r:vx.setup;c instanceof wv?this.applyRotateTimeline(c,t,l,o,d,a,n<<1,i):c instanceof Rv?this.applyAttachmentTimeline(c,t,l,r,!0):c.apply(t,h,l,e,o,d,_x.mixIn)}}this.queueEvents(n,l),e.length=0,n.nextAnimationLast=l,n.nextTrackLast=n.trackTime}const n=this.unkeyedState+jv.SETUP,r=t.slots;for(let a=0,o=t.slots.length;a<o;a++){const e=r[a];if(e.attachmentState==n){const s=e.data.attachmentName;e.setAttachment(null==s?null:t.getAttachment(e.data.index,s))}}return this.unkeyedState+=2,this.queue.drain(),i}applyMixingFrom(t,e,s){const i=t.mixingFrom;null!=i.mixingFrom&&this.applyMixingFrom(i,e,s);let n=0;0==t.mixDuration?(n=1,s==vx.first&&(s=vx.setup)):(n=t.mixTime/t.mixDuration,n>1&&(n=1),s!=vx.first&&(s=i.mixBlend));const r=n<i.eventThreshold?this.events:null,a=n<i.attachmentThreshold,o=n<i.drawOrderThreshold,h=i.animationLast,l=i.getAnimationTime(),c=i.animation.timelines.length,u=i.animation.timelines,d=i.alpha*t.interruptAlpha,p=d*(1-n);if(s==vx.add)for(let f=0;f<c;f++)u[f].apply(e,h,l,r,p,s,_x.mixOut);else{const t=i.timelineMode,n=i.timelineHoldMix,f=0==i.timelinesRotation.length;f&&Yx.setArraySize(i.timelinesRotation,c<<1,null);const m=i.timelinesRotation;i.totalAlpha=0;for(let g=0;g<c;g++){const c=u[g];let y,x=_x.mixOut,v=0;switch(t[g]){case jv.SUBSEQUENT:if(!o&&c instanceof Ov)continue;y=s,v=p;break;case jv.FIRST:y=vx.setup,v=p;break;case jv.HOLD_SUBSEQUENT:y=s,v=d;break;case jv.HOLD_FIRST:y=vx.setup,v=d;break;default:y=vx.setup;const t=n[g];v=d*Math.max(0,1-t.mixTime/t.mixDuration)}i.totalAlpha+=v,c instanceof wv?this.applyRotateTimeline(c,e,l,v,y,m,g<<1,f):c instanceof Rv?this.applyAttachmentTimeline(c,e,l,y,a):(o&&c instanceof Ov&&y==vx.setup&&(x=_x.mixIn),c.apply(e,h,l,r,v,y,x))}}return t.mixDuration>0&&this.queueEvents(i,l),this.events.length=0,i.nextAnimationLast=l,i.nextTrackLast=i.trackTime,n}applyAttachmentTimeline(t,e,s,i,n){const r=e.slots[t.slotIndex];if(!r.bone.active)return;const a=t.frames;if(s<a[0])i!=vx.setup&&i!=vx.first||this.setAttachment(e,r,r.data.attachmentName,n);else{let i;i=s>=a[a.length-1]?a.length-1:yv.binarySearch(a,s)-1,this.setAttachment(e,r,t.attachmentNames[i],n)}r.attachmentState<=this.unkeyedState&&(r.attachmentState=this.unkeyedState+jv.SETUP)}setAttachment(t,e,s,i){e.setAttachment(null==s?null:t.getAttachment(e.data.index,s)),i&&(e.attachmentState=this.unkeyedState+jv.CURRENT)}applyRotateTimeline(t,e,s,i,n,r,a,o){if(o&&(r[a]=0),1==i)return void t.apply(e,0,s,null,1,n,_x.mixIn);const h=t,l=h.frames,c=e.bones[h.boneIndex];if(!c.active)return;let u=0,d=0;if(s<l[0])switch(n){case vx.setup:c.rotation=c.data.rotation;default:return;case vx.first:u=c.rotation,d=c.data.rotation}else if(u=n==vx.setup?c.data.rotation:c.rotation,s>=l[l.length-wv.ENTRIES])d=c.data.rotation+l[l.length+wv.PREV_ROTATION];else{const t=yv.binarySearch(l,s,wv.ENTRIES),e=l[t+wv.PREV_ROTATION],i=l[t],n=h.getCurvePercent((t>>1)-1,1-(s-i)/(l[t+wv.PREV_TIME]-i));d=l[t+wv.ROTATION]-e,d-=360*(16384-(16384.499999999996-d/360|0)),d=e+d*n+c.data.rotation,d-=360*(16384-(16384.499999999996-d/360|0))}let p=0,f=d-u;if(f-=360*(16384-(16384.499999999996-f/360|0)),0==f)p=r[a];else{let t=0,e=0;o?(t=0,e=f):(t=r[a],e=r[a+1]);const s=f>0;let i=t>=0;Lx.signum(e)!=Lx.signum(f)&&Math.abs(e)<=90&&(Math.abs(t)>180&&(t+=360*Lx.signum(t)),i=s),p=f+t-t%360,i!=s&&(p+=360*Lx.signum(t)),r[a]=p}r[a+1]=f,u+=p*i,c.rotation=u-360*(16384-(16384.499999999996-u/360|0))}queueEvents(t,e){const s=t.animationStart,i=t.animationEnd,n=i-s,r=t.trackLast%n,a=this.events;let o=0;const h=a.length;for(;o<h;o++){const e=a[o];if(e.time<r)break;e.time>i||this.queue.event(t,e)}let l=!1;for(l=t.loop?0==n||r>t.trackTime%n:e>=i&&t.animationLast<i,l&&this.queue.complete(t);o<h;o++){a[o].time<s||this.queue.event(t,a[o])}}clearTracks(){const t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,s=this.tracks.length;e<s;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;const e=this.tracks[t];if(null==e)return;this.queue.end(e),this.disposeNext(e);let s=e;for(;;){const t=s.mixingFrom;if(null==t)break;this.queue.end(t),s.mixingFrom=null,s.mixingTo=null,s=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,s){const i=this.expandToIndex(t);this.tracks[t]=e,null!=i&&(s&&this.queue.interrupt(i),e.mixingFrom=i,i.mixingTo=e,e.mixTime=0,null!=i.mixingFrom&&i.mixDuration>0&&(e.interruptAlpha*=Math.min(1,i.mixTime/i.mixDuration)),i.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,s){const i=this.data.skeletonData.findAnimation(e);if(null==i)throw new Error(`Animation not found: ${e}`);return this.setAnimationWith(t,i,s)}setAnimationWith(t,e,s){if(null==e)throw new Error("animation cannot be null.");let i=!0,n=this.expandToIndex(t);null!=n&&(-1==n.nextTrackLast?(this.tracks[t]=n.mixingFrom,this.queue.interrupt(n),this.queue.end(n),this.disposeNext(n),n=n.mixingFrom,i=!1):this.disposeNext(n));const r=this.trackEntry(t,e,s,n);return this.setCurrent(t,r,i),this.queue.drain(),r}addAnimation(t,e,s,i){const n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error(`Animation not found: ${e}`);return this.addAnimationWith(t,n,s,i)}addAnimationWith(t,e,s,i){if(null==e)throw new Error("animation cannot be null.");let n=this.expandToIndex(t);if(null!=n)for(;null!=n.next;)n=n.next;const r=this.trackEntry(t,e,s,n);if(null==n)this.setCurrent(t,r,!0),this.queue.drain();else if(n.next=r,i<=0){const t=n.animationEnd-n.animationStart;0!=t?(n.loop?i+=t*(1+(n.trackTime/t|0)):i+=Math.max(t,n.trackTime),i-=this.data.getMix(n.animation,e)):i=n.trackTime}return r.delay=i,r}setEmptyAnimation(t,e){const s=this.setAnimationWith(t,jv.emptyAnimation,!1);return s.mixDuration=e,s.trackEnd=e,s}addEmptyAnimation(t,e,s){s<=0&&(s-=e);const i=this.addAnimationWith(t,jv.emptyAnimation,!1,s);return i.mixDuration=e,i.trackEnd=e,i}setEmptyAnimations(t){const e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let s=0,i=this.tracks.length;s<i;s++){const e=this.tracks[s];null!=e&&this.setEmptyAnimation(e.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(Yx.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,s,i){const n=this.trackEntryPool.obtain();return n.trackIndex=t,n.animation=e,n.loop=s,n.holdPrevious=!1,n.eventThreshold=0,n.attachmentThreshold=0,n.drawOrderThreshold=0,n.animationStart=0,n.animationEnd=e.duration,n.animationLast=-1,n.nextAnimationLast=-1,n.delay=0,n.trackTime=0,n.trackLast=-1,n.nextTrackLast=-1,n.trackEnd=Number.MAX_VALUE,n.timeScale=1,n.alpha=1,n.interruptAlpha=1,n.mixTime=0,n.mixDuration=null==i?0:this.data.getMix(i.animation,e),n.mixBlend=vx.replace,n}disposeNext(t){let e=t.next;for(;null!=e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();for(let t=0,e=this.tracks.length;t<e;t++){let e=this.tracks[t];if(null!=e){for(;null!=e.mixingFrom;)e=e.mixingFrom;do{null!=e.mixingFrom&&e.mixBlend==vx.add||this.computeHold(e),e=e.mixingTo}while(null!=e)}}}computeHold(t){const e=t.mixingTo,s=t.animation.timelines,i=t.animation.timelines.length,n=Yx.setArraySize(t.timelineMode,i);t.timelineHoldMix.length=0;const r=Yx.setArraySize(t.timelineHoldMix,i),a=this.propertyIDs;if(null!=e&&e.holdPrevious)for(let o=0;o<i;o++)n[o]=a.add(s[o].getPropertyId())?jv.HOLD_FIRST:jv.HOLD_SUBSEQUENT;else t:for(let o=0;o<i;o++){const i=s[o],h=i.getPropertyId();if(a.add(h))if(null==e||i instanceof Rv||i instanceof Ov||i instanceof Fv||!e.animation.hasTimeline(h))n[o]=jv.FIRST;else{for(let s=e.mixingTo;null!=s;s=s.mixingTo)if(!s.animation.hasTimeline(h)){if(t.mixDuration>0){n[o]=jv.HOLD_MIX,r[o]=s;continue t}break}n[o]=jv.HOLD_FIRST}else n[o]=jv.SUBSEQUENT}}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){const e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}setAnimationByName(t,e,s){jv.deprecatedWarning1||(jv.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")),this.setAnimation(t,e,s)}addAnimationByName(t,e,s,i){jv.deprecatedWarning2||(jv.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")),this.addAnimation(t,e,s,i)}hasAnimation(t){return null!==this.data.skeletonData.findAnimation(t)}hasAnimationByName(t){return jv.deprecatedWarning3||(jv.deprecatedWarning3=!0,console.warn("Spine Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")),this.hasAnimation(t)}};let Gv=jv;Gv.emptyAnimation=new yv("<empty>",[],0),Gv.SUBSEQUENT=0,Gv.FIRST=1,Gv.HOLD_SUBSEQUENT=2,Gv.HOLD_FIRST=3,Gv.HOLD_MIX=4,Gv.SETUP=1,Gv.CURRENT=2,Gv.deprecatedWarning1=!1,Gv.deprecatedWarning2=!1,Gv.deprecatedWarning3=!1;const zv=class{constructor(){this.mixBlend=vx.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){const t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}get time(){return zv.deprecatedWarning1||(zv.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime}set time(t){zv.deprecatedWarning1||(zv.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime=t}get endTime(){return zv.deprecatedWarning2||(zv.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime}set endTime(t){zv.deprecatedWarning2||(zv.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime=t}loopsCount(){return Math.floor(this.trackTime/this.trackEnd)}};let Hv=zv;Hv.deprecatedWarning1=!1,Hv.deprecatedWarning2=!1;const qv=class{constructor(t){this.objects=[],this.drainDisabled=!1,this.animState=t}start(t){this.objects.push(Zv.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(Zv.interrupt),this.objects.push(t)}end(t){this.objects.push(Zv.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(Zv.dispose),this.objects.push(t)}complete(t){this.objects.push(Zv.complete),this.objects.push(t)}event(t,e){this.objects.push(Zv.event),this.objects.push(t),this.objects.push(e)}deprecateStuff(){return qv.deprecatedWarning1||(qv.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: onComplete, onStart, onEnd, onEvent art deprecated, please use listeners from now on. 'state.addListener({ complete: function(track, event) { } })'")),!0}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;const t=this.objects,e=this.animState.listeners;for(let s=0;s<t.length;s+=2){const i=t[s],n=t[s+1];switch(i){case Zv.start:null!=n.listener&&n.listener.start&&n.listener.start(n);for(let t=0;t<e.length;t++)e[t].start&&e[t].start(n);n.onStart&&this.deprecateStuff()&&n.onStart(n.trackIndex),this.animState.onStart&&this.deprecateStuff()&&this.deprecateStuff&&this.animState.onStart(n.trackIndex);break;case Zv.interrupt:null!=n.listener&&n.listener.interrupt&&n.listener.interrupt(n);for(let t=0;t<e.length;t++)e[t].interrupt&&e[t].interrupt(n);break;case Zv.end:null!=n.listener&&n.listener.end&&n.listener.end(n);for(let t=0;t<e.length;t++)e[t].end&&e[t].end(n);n.onEnd&&this.deprecateStuff()&&n.onEnd(n.trackIndex),this.animState.onEnd&&this.deprecateStuff()&&this.animState.onEnd(n.trackIndex);case Zv.dispose:null!=n.listener&&n.listener.dispose&&n.listener.dispose(n);for(let t=0;t<e.length;t++)e[t].dispose&&e[t].dispose(n);this.animState.trackEntryPool.free(n);break;case Zv.complete:null!=n.listener&&n.listener.complete&&n.listener.complete(n);for(let t=0;t<e.length;t++)e[t].complete&&e[t].complete(n);const i=Lx.toInt(n.loopsCount());n.onComplete&&this.deprecateStuff()&&n.onComplete(n.trackIndex,i),this.animState.onComplete&&this.deprecateStuff()&&this.animState.onComplete(n.trackIndex,i);break;case Zv.event:const r=t[2+s++];null!=n.listener&&n.listener.event&&n.listener.event(n,r);for(let t=0;t<e.length;t++)e[t].event&&e[t].event(n,r);n.onEvent&&this.deprecateStuff()&&n.onEvent(n.trackIndex,r),this.animState.onEvent&&this.deprecateStuff()&&this.animState.onEvent(n.trackIndex,r)}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}};let Kv=qv;Kv.deprecatedWarning1=!1;var Zv=(t=>(t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event",t))(Zv||{});const Qv=class{constructor(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,s){const i=this.skeletonData.findAnimation(t);if(null==i)throw new Error(`Animation not found: ${t}`);const n=this.skeletonData.findAnimation(e);if(null==n)throw new Error(`Animation not found: ${e}`);this.setMixWith(i,n,s)}setMixByName(t,e,s){Qv.deprecatedWarning1||(Qv.deprecatedWarning1=!0,console.warn("Deprecation Warning: AnimationStateData.setMixByName is deprecated, please use setMix from now on.")),this.setMix(t,e,s)}setMixWith(t,e,s){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");const i=`${t.name}.${e.name}`;this.animationToMixTime[i]=s}getMix(t,e){const s=`${t.name}.${e.name}`,i=this.animationToMixTime[s];return void 0===i?this.defaultMix:i}};let Jv=Qv;Jv.deprecatedWarning1=!1;let t_=class{constructor(t){this.atlas=t}newRegionAttachment(t,e,s){const i=this.atlas.findRegion(s);if(null==i)throw new Error(`Region not found in atlas: ${s} (region attachment: ${e})`);const n=new fv(e);return n.region=i,n}newMeshAttachment(t,e,s){const i=this.atlas.findRegion(s);if(null==i)throw new Error(`Region not found in atlas: ${s} (mesh attachment: ${e})`);const n=new lv(e);return n.region=i,n}newBoundingBoxAttachment(t,e){return new ov(e)}newPathAttachment(t,e){return new cv(e)}newPointAttachment(t,e){return new uv(e)}newClippingAttachment(t,e){return new hv(e)}},e_=class{constructor(t,e,s){if(this.matrix=new Dh,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.sorted=!1,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=s,this.setToSetupPose()}get worldX(){return this.matrix.tx}get worldY(){return this.matrix.ty}isActive(){return this.active}update(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,s,i,n,r,a){this.ax=t,this.ay=e,this.arotation=s,this.ascaleX=i,this.ascaleY=n,this.ashearX=r,this.ashearY=a,this.appliedValid=!0;const o=this.parent,h=this.matrix,l=this.skeleton.scaleX,c=-this.skeleton.scaleY;if(null==o){const o=this.skeleton,u=s+90+a;return h.a=Lx.cosDeg(s+r)*i*l,h.c=Lx.cosDeg(u)*n*l,h.b=Lx.sinDeg(s+r)*i*c,h.d=Lx.sinDeg(u)*n*c,h.tx=t*l+o.x,void(h.ty=e*c+o.y)}let u=o.matrix.a,d=o.matrix.c,p=o.matrix.b,f=o.matrix.d;switch(h.tx=u*t+d*e+o.matrix.tx,h.ty=p*t+f*e+o.matrix.ty,this.data.transformMode){case Ex.Normal:{const t=s+90+a,e=Lx.cosDeg(s+r)*i,o=Lx.cosDeg(t)*n,l=Lx.sinDeg(s+r)*i,c=Lx.sinDeg(t)*n;return h.a=u*e+d*l,h.c=u*o+d*c,h.b=p*e+f*l,void(h.d=p*o+f*c)}case Ex.OnlyTranslation:{const t=s+90+a;h.a=Lx.cosDeg(s+r)*i,h.c=Lx.cosDeg(t)*n,h.b=Lx.sinDeg(s+r)*i,h.d=Lx.sinDeg(t)*n;break}case Ex.NoRotationOrReflection:{let t=u*u+p*p,e=0;t>1e-4?(t=Math.abs(u*f-d*p)/t,u/=this.skeleton.scaleX,p/=this.skeleton.scaleY,d=p*t,f=u*t,e=Math.atan2(p,u)*Lx.radDeg):(u=0,p=0,e=90-Math.atan2(f,d)*Lx.radDeg);const o=s+r-e,l=s+a-e+90,c=Lx.cosDeg(o)*i,m=Lx.cosDeg(l)*n,g=Lx.sinDeg(o)*i,y=Lx.sinDeg(l)*n;h.a=u*c-d*g,h.c=u*m-d*y,h.b=p*c+f*g,h.d=p*m+f*y;break}case Ex.NoScale:case Ex.NoScaleOrReflection:{const t=Lx.cosDeg(s),e=Lx.sinDeg(s);let o=(u*t+d*e)/l,m=(p*t+f*e)/c,g=Math.sqrt(o*o+m*m);g>1e-5&&(g=1/g),o*=g,m*=g,g=Math.sqrt(o*o+m*m),this.data.transformMode==Ex.NoScale&&u*f-d*p<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY>0)&&(g=-g);const y=Math.PI/2+Math.atan2(m,o),x=Math.cos(y)*g,v=Math.sin(y)*g,_=Lx.cosDeg(r)*i,b=Lx.cosDeg(90+a)*n,w=Lx.sinDeg(r)*i,E=Lx.sinDeg(90+a)*n;h.a=o*_+x*w,h.c=o*b+x*E,h.b=m*_+v*w,h.d=m*b+v*E;break}}h.a*=l,h.c*=l,h.b*=c,h.d*=c}setToSetupPose(){const t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.matrix.b,this.matrix.a)*Lx.radDeg}getWorldRotationY(){return Math.atan2(this.matrix.d,this.matrix.c)*Lx.radDeg}getWorldScaleX(){const t=this.matrix;return Math.sqrt(t.a*t.a+t.c*t.c)}getWorldScaleY(){const t=this.matrix;return Math.sqrt(t.b*t.b+t.d*t.d)}updateAppliedTransform(){this.appliedValid=!0;const t=this.parent,e=this.matrix;if(null==t)return this.ax=e.tx,this.ay=e.ty,this.arotation=Math.atan2(e.b,e.a)*Lx.radDeg,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*Lx.radDeg);const s=t.matrix,i=1/(s.a*s.d-s.b*s.c),n=e.tx-s.tx,r=e.ty-s.ty;this.ax=n*s.d*i-r*s.c*i,this.ay=r*s.a*i-n*s.b*i;const a=i*s.d,o=i*s.a,h=i*s.c,l=i*s.b,c=a*e.a-h*e.b,u=a*e.c-h*e.d,d=o*e.b-l*e.a,p=o*e.d-l*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(c*c+d*d),this.ascaleX>1e-4){const t=c*p-u*d;this.ascaleY=t/this.ascaleX,this.ashearY=Math.atan2(c*u+d*p,t)*Lx.radDeg,this.arotation=Math.atan2(d,c)*Lx.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(u*u+p*p),this.ashearY=0,this.arotation=90-Math.atan2(p,u)*Lx.radDeg}worldToLocal(t){const e=this.matrix,s=e.a,i=e.c,n=e.b,r=e.d,a=1/(s*r-i*n),o=t.x-e.tx,h=t.y-e.ty;return t.x=o*r*a-h*i*a,t.y=h*s*a-o*n*a,t}localToWorld(t){const e=this.matrix,s=t.x,i=t.y;return t.x=s*e.a+i*e.c+e.tx,t.y=s*e.b+i*e.d+e.ty,t}worldToLocalRotation(t){const e=Lx.sinDeg(t),s=Lx.cosDeg(t),i=this.matrix;return Math.atan2(i.a*e-i.b*s,i.d*s-i.c*e)*Lx.radDeg}localToWorldRotation(t){const e=Lx.sinDeg(t),s=Lx.cosDeg(t),i=this.matrix;return Math.atan2(s*i.b+e*i.d,s*i.a+e*i.c)*Lx.radDeg}rotateWorld(t){const e=this.matrix,s=e.a,i=e.c,n=e.b,r=e.d,a=Lx.cosDeg(t),o=Lx.sinDeg(t);e.a=a*s-o*n,e.c=a*i-o*r,e.b=o*s+a*n,e.d=o*i+a*r,this.appliedValid=!1}},s_=class{constructor(t,e,s){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=Ex.Normal,this.skinRequired=!1,this.color=new Nx,t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=s}},i_=class{constructor(t,e,s){this.name=t,this.order=e,this.skinRequired=s}},n_=class{constructor(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e}},r_=class{constructor(t){this.name=t}},a_=class{constructor(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let s=0;s<t.bones.length;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findBone(t.target.name)}isActive(){return this.active}apply(){this.update()}update(){const t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}}apply1(t,e,s,i,n,r,a){t.appliedValid||t.updateAppliedTransform();const o=t.parent.matrix,h=o.a;let l=o.c;const c=o.b;let u=o.d,d=-t.ashearX-t.arotation,p=0,f=0;switch(t.data.transformMode){case Ex.OnlyTranslation:p=e-t.worldX,f=s-t.worldY;break;case Ex.NoRotationOrReflection:const i=Math.abs(h*u-l*c)/(h*h+c*c),n=h/t.skeleton.scaleX,r=c/t.skeleton.scaleY;l=-r*i*t.skeleton.scaleX,u=n*i*t.skeleton.scaleY,d+=Math.atan2(r,n)*Lx.radDeg;default:const a=e-o.tx,m=s-o.ty,g=h*u-l*c;p=(a*u-m*l)/g-t.ax,f=(m*h-a*c)/g-t.ay}d+=Math.atan2(f,p)*Lx.radDeg,t.ascaleX<0&&(d+=180),d>180?d-=360:d<-180&&(d+=360);let m=t.ascaleX,g=t.ascaleY;if(i||n){switch(t.data.transformMode){case Ex.NoScale:case Ex.NoScaleOrReflection:p=e-t.worldX,f=s-t.worldY}const o=t.data.length*m,h=Math.sqrt(p*p+f*f);if(i&&h<o||n&&h>o&&o>1e-4){const t=(h/o-1)*a+1;m*=t,r&&(g*=t)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+d*a,m,g,t.ashearX,t.ashearY)}apply2(t,e,s,i,n,r,a,o){if(0==o)return void e.updateWorldTransform();t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();const h=t.ax,l=t.ay;let c=t.ascaleX,u=c,d=t.ascaleY,p=e.ascaleX;const f=t.matrix;let m=0,g=0,y=0;c<0?(c=-c,m=180,y=-1):(m=0,y=1),d<0&&(d=-d,y=-y),p<0?(p=-p,g=180):g=0;const x=e.ax;let v=0,_=0,b=0,w=f.a,E=f.c,S=f.b,T=f.d;const A=Math.abs(c-d)<=1e-4;A?(v=e.ay,_=w*x+E*v+f.tx,b=S*x+T*v+f.ty):(v=0,_=w*x+f.tx,b=S*x+f.ty);const C=t.parent.matrix;w=C.a,E=C.c,S=C.b,T=C.d;const M=1/(w*T-E*S);let I=_-C.tx,P=b-C.ty;const R=(I*T-P*E)*M-h,k=(P*w-I*S)*M-l,D=Math.sqrt(R*R+k*k);let F,O,N=e.data.length*p;if(D<1e-4)return this.apply1(t,s,i,!1,r,!1,o),void e.updateWorldTransformWith(x,v,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);I=s-C.tx,P=i-C.ty;let B=(I*T-P*E)*M-h,L=(P*w-I*S)*M-l,V=B*B+L*L;if(0!=a){a*=c*(p+1)/2;const t=Math.sqrt(V),e=t-D-N*c+a;if(e>0){let s=Math.min(1,e/(2*a))-1;s=(e-a*(1-s*s))/t,B-=s*B,L-=s*L,V=B*B+L*L}}t:if(A){N*=c;let t=(V-D*D-N*N)/(2*D*N);t<-1?t=-1:t>1&&(t=1,r&&(u*=(Math.sqrt(V)/(D+N)-1)*o+1)),O=Math.acos(t)*n,w=D+N*t,E=N*Math.sin(O),F=Math.atan2(L*w-B*E,B*w+L*E)}else{w=c*N,E=d*N;const t=w*w,e=E*E,s=Math.atan2(L,B);S=e*D*D+t*V-t*e;const i=-2*e*D,r=e-t;if(T=i*i-4*r*S,T>=0){let t=Math.sqrt(T);i<0&&(t=-t),t=-(i+t)/2;const e=t/r,a=S/t,o=Math.abs(e)<Math.abs(a)?e:a;if(o*o<=V){P=Math.sqrt(V-o*o)*n,F=s-Math.atan2(P,o),O=Math.atan2(P/d,(o-D)/c);break t}}let a=Lx.PI,o=D-w,h=o*o,l=0,u=0,p=D+w,f=p*p,m=0;S=-w*D/(t-e),S>=-1&&S<=1&&(S=Math.acos(S),I=w*Math.cos(S)+D,P=E*Math.sin(S),T=I*I+P*P,T<h&&(a=S,h=T,o=I,l=P),T>f&&(u=S,f=T,p=I,m=P)),V<=(h+f)/2?(F=s-Math.atan2(l*n,o),O=a*n):(F=s-Math.atan2(m*n,p),O=u*n)}const $=Math.atan2(v,x)*y;let U=t.arotation;F=(F-$)*Lx.radDeg+m-U,F>180?F-=360:F<-180&&(F+=360),t.updateWorldTransformWith(h,l,U+F*o,u,t.ascaleY,0,0),U=e.arotation,O=((O+$)*Lx.radDeg-e.ashearX)*y+g-U,O>180?O-=360:O<-180&&(O+=360),e.updateWorldTransformWith(x,v,U+O*o,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}},o_=class extends i_{constructor(t){super(t,0,!1),this.bones=new Array,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.softness=0}},h_=class extends i_{constructor(t){super(t,0,!1),this.bones=new Array}};var l_=(t=>(t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent",t))(l_||{});const c_=class{constructor(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let s=0,i=t.bones.length;s<i;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}isActive(){return this.active}apply(){this.update()}update(){const t=this.target.getAttachment();if(!(t instanceof cv))return;const e=this.rotateMix,s=this.translateMix,i=e>0;if(!(s>0)&&!i)return;const n=this.data,r=n.spacingMode,a=r==l_.Length,o=n.rotateMode,h=o==wx.Tangent,l=o==wx.ChainScale,c=this.bones.length,u=h?c:c+1,d=this.bones,p=Yx.setArraySize(this.spaces,u);let f=null;const m=this.spacing;if(l||a){l&&(f=Yx.setArraySize(this.lengths,c));for(let t=0,e=u-1;t<e;){const e=d[t],s=e.data.length;if(s<c_.epsilon)l&&(f[t]=0),p[++t]=0;else{const i=s*e.matrix.a,n=s*e.matrix.b,r=Math.sqrt(i*i+n*n);l&&(f[t]=r),p[++t]=(a?s+m:m)*r/s}}}else for(let b=1;b<u;b++)p[b]=m;const g=this.computeWorldPositions(t,u,h,n.positionMode==bx.Percent,r==l_.Percent);let y=g[0],x=g[1],v=n.offsetRotation,_=!1;if(0==v)_=o==wx.Chain;else{_=!1;const t=this.target.bone.matrix;v*=t.a*t.d-t.b*t.c>0?Lx.degRad:-Lx.degRad}for(let b=0,w=3;b<c;b++,w+=3){const t=d[b],n=t.matrix;n.tx+=(y-n.tx)*s,n.ty+=(x-n.ty)*s;const r=g[w],a=g[w+1],o=r-y,c=a-x;if(l){const t=f[b];if(0!=t){const s=(Math.sqrt(o*o+c*c)/t-1)*e+1;n.a*=s,n.b*=s}}if(y=r,x=a,i){const s=n.a,i=n.c,r=n.b,a=n.d;let l=0,u=0,d=0;if(h&&(l=h?g[w-1]:0==p[b+1]?g[w+2]:Math.atan2(c,o)),l-=Math.atan2(r,s),_){u=Math.cos(l),d=Math.sin(l);const i=t.data.length;y+=(i*(u*s-d*r)-o)*e,x+=(i*(d*s+u*r)-c)*e}else l+=v;l>Lx.PI?l-=Lx.PI2:l<-Lx.PI&&(l+=Lx.PI2),l*=e,u=Math.cos(l),d=Math.sin(l),n.a=u*s-d*r,n.c=u*i-d*a,n.b=d*s+u*r,n.d=d*i+u*a}t.appliedValid=!1}}computeWorldPositions(t,e,s,i,n){const r=this.target;let a=this.position;const o=this.spaces,h=Yx.setArraySize(this.positions,3*e+2);let l=null;const c=t.closed;let u=t.worldVerticesLength,d=u/6,p=c_.NONE;if(!t.constantSpeed){const f=t.lengths;d-=c?1:2;const m=f[d];if(i&&(a*=m),n)for(let t=0;t<e;t++)o[t]*=m;l=Yx.setArraySize(this.world,8);for(let i=0,n=0,g=0;i<e;i++,n+=3){const e=o[i];a+=e;let y=a;if(c)y%=m,y<0&&(y+=m),g=0;else{if(y<0){p!=c_.BEFORE&&(p=c_.BEFORE,t.computeWorldVertices(r,2,4,l,0,2)),this.addBeforePosition(y,l,0,h,n);continue}if(y>m){p!=c_.AFTER&&(p=c_.AFTER,t.computeWorldVertices(r,u-6,4,l,0,2)),this.addAfterPosition(y-m,l,0,h,n);continue}}for(;;g++){const t=f[g];if(!(y>t)){if(0==g)y/=t;else{const e=f[g-1];y=(y-e)/(t-e)}break}}g!=p&&(p=g,c&&g==d?(t.computeWorldVertices(r,u-4,4,l,0,2),t.computeWorldVertices(r,0,4,l,4,2)):t.computeWorldVertices(r,6*g+2,8,l,0,2)),this.addCurvePosition(y,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],h,n,s||i>0&&0==e)}return h}c?(u+=2,l=Yx.setArraySize(this.world,u),t.computeWorldVertices(r,2,u-4,l,0,2),t.computeWorldVertices(r,0,2,l,u-4,2),l[u-2]=l[0],l[u-1]=l[1]):(d--,u-=4,l=Yx.setArraySize(this.world,u),t.computeWorldVertices(r,2,u,l,0,2));const f=Yx.setArraySize(this.curves,d);let m=0,g=l[0],y=l[1],x=0,v=0,_=0,b=0,w=0,E=0,S=0,T=0,A=0,C=0,M=0,I=0,P=0,R=0;for(let F=0,O=2;F<d;F++,O+=6)x=l[O],v=l[O+1],_=l[O+2],b=l[O+3],w=l[O+4],E=l[O+5],S=.1875*(g-2*x+_),T=.1875*(y-2*v+b),A=.09375*(3*(x-_)-g+w),C=.09375*(3*(v-b)-y+E),M=2*S+A,I=2*T+C,P=.75*(x-g)+S+.16666667*A,R=.75*(v-y)+T+.16666667*C,m+=Math.sqrt(P*P+R*R),P+=M,R+=I,M+=A,I+=C,m+=Math.sqrt(P*P+R*R),P+=M,R+=I,m+=Math.sqrt(P*P+R*R),P+=M+A,R+=I+C,m+=Math.sqrt(P*P+R*R),f[F]=m,g=w,y=E;if(i&&(a*=m),n)for(let F=0;F<e;F++)o[F]*=m;const k=this.segments;let D=0;for(let F=0,O=0,N=0,B=0;F<e;F++,O+=3){const t=o[F];a+=t;let e=a;if(c)e%=m,e<0&&(e+=m),N=0;else{if(e<0){this.addBeforePosition(e,l,0,h,O);continue}if(e>m){this.addAfterPosition(e-m,l,u-4,h,O);continue}}for(;;N++){const t=f[N];if(!(e>t)){if(0==N)e/=t;else{const s=f[N-1];e=(e-s)/(t-s)}break}}if(N!=p){p=N;let t=6*N;for(g=l[t],y=l[t+1],x=l[t+2],v=l[t+3],_=l[t+4],b=l[t+5],w=l[t+6],E=l[t+7],S=.03*(g-2*x+_),T=.03*(y-2*v+b),A=.006*(3*(x-_)-g+w),C=.006*(3*(v-b)-y+E),M=2*S+A,I=2*T+C,P=.3*(x-g)+S+.16666667*A,R=.3*(v-y)+T+.16666667*C,D=Math.sqrt(P*P+R*R),k[0]=D,t=1;t<8;t++)P+=M,R+=I,M+=A,I+=C,D+=Math.sqrt(P*P+R*R),k[t]=D;P+=M,R+=I,D+=Math.sqrt(P*P+R*R),k[8]=D,P+=M+A,R+=I+C,D+=Math.sqrt(P*P+R*R),k[9]=D,B=0}for(e*=D;;B++){const t=k[B];if(!(e>t)){if(0==B)e/=t;else{const s=k[B-1];e=B+(e-s)/(t-s)}break}}this.addCurvePosition(.1*e,g,y,x,v,_,b,w,E,h,O,s||F>0&&0==t)}return h}addBeforePosition(t,e,s,i,n){const r=e[s],a=e[s+1],o=e[s+2]-r,h=e[s+3]-a,l=Math.atan2(h,o);i[n]=r+t*Math.cos(l),i[n+1]=a+t*Math.sin(l),i[n+2]=l}addAfterPosition(t,e,s,i,n){const r=e[s+2],a=e[s+3],o=r-e[s],h=a-e[s+1],l=Math.atan2(h,o);i[n]=r+t*Math.cos(l),i[n+1]=a+t*Math.sin(l),i[n+2]=l}addCurvePosition(t,e,s,i,n,r,a,o,h,l,c,u){(0==t||isNaN(t))&&(t=1e-4);const d=t*t,p=d*t,f=1-t,m=f*f,g=m*f,y=f*t,x=3*y,v=f*x,_=x*t,b=e*g+i*v+r*_+o*p,w=s*g+n*v+a*_+h*p;l[c]=b,l[c+1]=w,u&&(l[c+2]=Math.atan2(w-(s*m+n*y*2+a*d),b-(e*m+i*y*2+r*d)))}};let u_=c_;u_.NONE=-1,u_.BEFORE=-2,u_.AFTER=-3,u_.epsilon=1e-5;let d_=class{constructor(t,e){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new jx,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array;for(let s=0;s<t.bones.length;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findBone(t.target.name)}isActive(){return this.active}apply(){this.update()}update(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()}applyAbsoluteWorld(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,i=this.shearMix,n=this.target,r=n.matrix,a=r.a,o=r.c,h=r.b,l=r.d,c=a*l-o*h>0?Lx.degRad:-Lx.degRad,u=this.data.offsetRotation*c,d=this.data.offsetShearY*c,p=this.bones;for(let f=0,m=p.length;f<m;f++){const r=p[f];let c=!1;const m=r.matrix;if(0!=t){const e=m.a,s=m.c,i=m.b,n=m.d;let r=Math.atan2(h,a)-Math.atan2(i,e)+u;r>Lx.PI?r-=Lx.PI2:r<-Lx.PI&&(r+=Lx.PI2),r*=t;const o=Math.cos(r),l=Math.sin(r);m.a=o*e-l*i,m.c=o*s-l*n,m.b=l*e+o*i,m.d=l*s+o*n,c=!0}if(0!=e){const t=this.temp;n.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=(t.x-m.tx)*e,m.ty+=(t.y-m.ty)*e,c=!0}if(s>0){let t=Math.sqrt(m.a*m.a+m.b*m.b),e=Math.sqrt(a*a+h*h);t>1e-5&&(t=(t+(e-t+this.data.offsetScaleX)*s)/t),m.a*=t,m.b*=t,t=Math.sqrt(m.c*m.c+m.d*m.d),e=Math.sqrt(o*o+l*l),t>1e-5&&(t=(t+(e-t+this.data.offsetScaleY)*s)/t),m.c*=t,m.d*=t,c=!0}if(i>0){const t=m.c,e=m.d,s=Math.atan2(e,t);let n=Math.atan2(l,o)-Math.atan2(h,a)-(s-Math.atan2(m.b,m.a));n>Lx.PI?n-=Lx.PI2:n<-Lx.PI&&(n+=Lx.PI2),n=s+(n+d)*i;const r=Math.sqrt(t*t+e*e);m.c=Math.cos(n)*r,m.d=Math.sin(n)*r,c=!0}c&&(r.appliedValid=!1)}}applyRelativeWorld(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,i=this.shearMix,n=this.target,r=n.matrix,a=r.a,o=r.c,h=r.b,l=r.d,c=a*l-o*h>0?Lx.degRad:-Lx.degRad,u=this.data.offsetRotation*c,d=this.data.offsetShearY*c,p=this.bones;for(let f=0,m=p.length;f<m;f++){const r=p[f];let c=!1;const m=r.matrix;if(0!=t){const e=m.a,s=m.c,i=m.b,n=m.d;let r=Math.atan2(h,a)+u;r>Lx.PI?r-=Lx.PI2:r<-Lx.PI&&(r+=Lx.PI2),r*=t;const o=Math.cos(r),l=Math.sin(r);m.a=o*e-l*i,m.c=o*s-l*n,m.b=l*e+o*i,m.d=l*s+o*n,c=!0}if(0!=e){const t=this.temp;n.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=t.x*e,m.ty+=t.y*e,c=!0}if(s>0){let t=(Math.sqrt(a*a+h*h)-1+this.data.offsetScaleX)*s+1;m.a*=t,m.b*=t,t=(Math.sqrt(o*o+l*l)-1+this.data.offsetScaleY)*s+1,m.c*=t,m.d*=t,c=!0}if(i>0){let t=Math.atan2(l,o)-Math.atan2(h,a);t>Lx.PI?t-=Lx.PI2:t<-Lx.PI&&(t+=Lx.PI2);const e=m.c,s=m.d;t=Math.atan2(s,e)+(t-Lx.PI/2+d)*i;const n=Math.sqrt(e*e+s*s);m.c=Math.cos(t)*n,m.d=Math.sin(t)*n,c=!0}c&&(r.appliedValid=!1)}}applyAbsoluteLocal(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,i=this.shearMix,n=this.target;n.appliedValid||n.updateAppliedTransform();const r=this.bones;for(let a=0,o=r.length;a<o;a++){const o=r[a];o.appliedValid||o.updateAppliedTransform();let h=o.arotation;if(0!=t){let e=n.arotation-h+this.data.offsetRotation;e-=360*(16384-(16384.499999999996-e/360|0)),h+=e*t}let l=o.ax,c=o.ay;0!=e&&(l+=(n.ax-l+this.data.offsetX)*e,c+=(n.ay-c+this.data.offsetY)*e);let u=o.ascaleX,d=o.ascaleY;s>0&&(u>1e-5&&(u=(u+(n.ascaleX-u+this.data.offsetScaleX)*s)/u),d>1e-5&&(d=(d+(n.ascaleY-d+this.data.offsetScaleY)*s)/d));const p=o.ashearY;if(i>0){let t=n.ashearY-p+this.data.offsetShearY;t-=360*(16384-(16384.499999999996-t/360|0)),o.shearY+=t*i}o.updateWorldTransformWith(l,c,h,u,d,o.ashearX,p)}}applyRelativeLocal(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,i=this.shearMix,n=this.target;n.appliedValid||n.updateAppliedTransform();const r=this.bones;for(let a=0,o=r.length;a<o;a++){const o=r[a];o.appliedValid||o.updateAppliedTransform();let h=o.arotation;0!=t&&(h+=(n.arotation+this.data.offsetRotation)*t);let l=o.ax,c=o.ay;0!=e&&(l+=(n.ax+this.data.offsetX)*e,c+=(n.ay+this.data.offsetY)*e);let u=o.ascaleX,d=o.ascaleY;s>0&&(u>1e-5&&(u*=(n.ascaleX-1+this.data.offsetScaleX)*s+1),d>1e-5&&(d*=(n.ascaleY-1+this.data.offsetScaleY)*s+1));let p=o.ashearY;i>0&&(p+=(n.ashearY+this.data.offsetShearY)*i),o.updateWorldTransformWith(l,c,h,u,d,o.ashearX,p)}}};const p_=class{constructor(t){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){const s=t.bones[e];let i;if(null==s.parent)i=new e_(s,this,null);else{const t=this.bones[s.parent.index];i=new e_(s,this,t),t.children.push(i)}this.bones.push(i)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){const s=t.slots[e],i=this.bones[s.boneData.index],n=new dv(s,i);this.slots.push(n),this.drawOrder.push(n)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){const s=t.ikConstraints[e];this.ikConstraints.push(new a_(s,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){const s=t.transformConstraints[e];this.transformConstraints.push(new d_(s,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){const s=t.pathConstraints[e];this.pathConstraints.push(new u_(s,this))}this.color=new Nx(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0,this.updateCacheReset.length=0;const t=this.bones;for(let h=0,l=t.length;h<l;h++){const e=t[h];e.sorted=e.data.skinRequired,e.active=!e.sorted}if(null!=this.skin){const t=this.skin.bones;for(let e=0,s=this.skin.bones.length;e<s;e++){let s=this.bones[t[e].index];do{s.sorted=!1,s.active=!0,s=s.parent}while(null!=s)}}const e=this.ikConstraints,s=this.transformConstraints,i=this.pathConstraints,n=e.length,r=s.length,a=i.length,o=n+r+a;t:for(let h=0;h<o;h++){for(let t=0;t<n;t++){const s=e[t];if(s.data.order==h){this.sortIkConstraint(s);continue t}}for(let t=0;t<r;t++){const e=s[t];if(e.data.order==h){this.sortTransformConstraint(e);continue t}}for(let t=0;t<a;t++){const e=i[t];if(e.data.order==h){this.sortPathConstraint(e);continue t}}}for(let h=0,l=t.length;h<l;h++)this.sortBone(t[h])}sortIkConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&Yx.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target;this.sortBone(e);const s=t.bones,i=s[0];if(this.sortBone(i),s.length>1){const t=s[s.length-1];this._updateCache.indexOf(t)>-1||this.updateCacheReset.push(t)}this._updateCache.push(t),this.sortReset(i.children),s[s.length-1].sorted=!0}sortPathConstraint(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||null!=this.skin&&Yx.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target,s=e.data.index,i=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,s,i),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,s,i);for(let o=0,h=this.data.skins.length;o<h;o++)this.sortPathConstraintAttachment(this.data.skins[o],s,i);const n=e.getAttachment();n instanceof cv&&this.sortPathConstraintAttachmentWith(n,i);const r=t.bones,a=r.length;for(let o=0;o<a;o++)this.sortBone(r[o]);this._updateCache.push(t);for(let o=0;o<a;o++)this.sortReset(r[o].children);for(let o=0;o<a;o++)r[o].sorted=!0}sortTransformConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&Yx.contains(this.skin.constraints,t.data,!0)),!t.active)return;this.sortBone(t.target);const e=t.bones,s=e.length;if(t.data.local)for(let i=0;i<s;i++){const t=e[i];this.sortBone(t.parent),this._updateCache.indexOf(t)>-1||this.updateCacheReset.push(t)}else for(let i=0;i<s;i++)this.sortBone(e[i]);this._updateCache.push(t);for(let i=0;i<s;i++)this.sortReset(e[i].children);for(let i=0;i<s;i++)e[i].sorted=!0}sortPathConstraintAttachment(t,e,s){const i=t.attachments[e];if(i)for(const n in i)this.sortPathConstraintAttachmentWith(i[n],s)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof cv))return;const s=t.bones;if(null==s)this.sortBone(e);else{const t=this.bones;let e=0;for(;e<s.length;){const i=s[e++];for(let n=e+i;e<n;e++){const i=s[e];this.sortBone(t[i])}}}}sortBone(t){if(t.sorted)return;const e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,s=t.length;e<s;e++){const s=t[e];s.active&&(s.sorted&&this.sortReset(s.children),s.sorted=!1)}}updateWorldTransform(){const t=this.updateCacheReset;for(let s=0,i=t.length;s<i;s++){const e=t[s];e.ax=e.x,e.ay=e.y,e.arotation=e.rotation,e.ascaleX=e.scaleX,e.ascaleY=e.scaleY,e.ashearX=e.shearX,e.ashearY=e.shearY,e.appliedValid=!0}const e=this._updateCache;for(let s=0,i=e.length;s<i;s++)e[s].update()}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){const t=this.bones;for(let n=0,r=t.length;n<r;n++)t[n].setToSetupPose();const e=this.ikConstraints;for(let n=0,r=e.length;n<r;n++){const t=e[n];t.mix=t.data.mix,t.softness=t.data.softness,t.bendDirection=t.data.bendDirection,t.compress=t.data.compress,t.stretch=t.data.stretch}const s=this.transformConstraints;for(let n=0,r=s.length;n<r;n++){const t=s[n],e=t.data;t.rotateMix=e.rotateMix,t.translateMix=e.translateMix,t.scaleMix=e.scaleMix,t.shearMix=e.shearMix}const i=this.pathConstraints;for(let n=0,r=i.length;n<r;n++){const t=i[n],e=t.data;t.position=e.position,t.spacing=e.spacing,t.rotateMix=e.rotateMix,t.translateMix=e.translateMix}}setSlotsToSetupPose(){const t=this.slots;Yx.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,s=t.length;e<s;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.data.name==t)return i}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,i=e.length;s<i;s++)if(e[s].data.name==t)return s;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.data.name==t)return i}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,i=e.length;s<i;s++)if(e[s].data.name==t)return s;return-1}setSkinByName(t){const e=this.data.findSkin(t);if(null==e)throw new Error(`Skin not found: ${t}`);this.setSkin(e)}setSkin(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else{const e=this.slots;for(let s=0,i=e.length;s<i;s++){const i=e[s],n=i.data.attachmentName;if(null!=n){const e=t.getAttachment(s,n);null!=e&&i.setAttachment(e)}}}this.skin=t,this.updateCache()}}getAttachmentByName(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)}getAttachment(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){const s=this.skin.getAttachment(t,e);if(null!=s)return s}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(null==t)throw new Error("slotName cannot be null.");const s=this.slots;for(let i=0,n=s.length;i<n;i++){const n=s[i];if(n.data.name==t){let s=null;if(null!=e&&(s=this.getAttachment(i,e),null==s))throw new Error(`Attachment not found: ${e}, for slot: ${t}`);return void n.setAttachment(s)}}throw new Error(`Slot not found: ${t}`)}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.data.name==t)return i}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.data.name==t)return i}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.data.name==t)return i}return null}getBounds(t,e,s=new Array(2)){if(null==t)throw new Error("offset cannot be null.");if(null==e)throw new Error("size cannot be null.");const i=this.drawOrder;let n=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let h=0,l=i.length;h<l;h++){const t=i[h];if(!t.bone.active)continue;let e=0,l=null;const c=t.getAttachment();if(c instanceof fv)e=8,l=Yx.setArraySize(s,e,0),c.computeWorldVertices(t.bone,l,0,2);else if(c instanceof lv){const i=c;e=i.worldVerticesLength,l=Yx.setArraySize(s,e,0),i.computeWorldVertices(t,0,e,l,0,2)}if(null!=l)for(let s=0,i=l.length;s<i;s+=2){const t=l[s],e=l[s+1];n=Math.min(n,t),r=Math.min(r,e),a=Math.max(a,t),o=Math.max(o,e)}}t.set(n,r),e.set(a-n,o-r)}update(t){this.time+=t}get flipX(){return-1==this.scaleX}set flipX(t){p_.deprecatedWarning1||(p_.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleX=t?1:-1}get flipY(){return-1==this.scaleY}set flipY(t){p_.deprecatedWarning1||(p_.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleY=t?1:-1}};let f_=p_;f_.deprecatedWarning1=!1;let m_=class{constructor(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,i=e.length;s<i;s++)if(e[s].name==t)return s;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,i=e.length;s<i;s++)if(e[s].name==t)return s;return-1}findSkin(t){if(null==t)throw new Error("skinName cannot be null.");const e=this.skins;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findEvent(t){if(null==t)throw new Error("eventDataName cannot be null.");const e=this.events;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findAnimation(t){if(null==t)throw new Error("animationName cannot be null.");const e=this.animations;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findPathConstraintIndex(t){if(null==t)throw new Error("pathConstraintName cannot be null.");const e=this.pathConstraints;for(let s=0,i=e.length;s<i;s++)if(e[s].name==t)return s;return-1}},g_=class{constructor(t,e,s){if(this.color=new Nx(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");if(null==s)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=s}},y_=class extends i_{constructor(t){super(t,0,!1),this.bones=new Array,this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1}},x_=class{constructor(t,e,s){this.slotIndex=t,this.name=e,this.attachment=s}},v_=class{constructor(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==t)throw new Error("name cannot be null.");this.name=t}setAttachment(t,e,s){if(null==s)throw new Error("attachment cannot be null.");const i=this.attachments;t>=i.length&&(i.length=t+1),i[t]||(i[t]={}),i[t][e]=s}addSkin(t){for(let s=0;s<t.bones.length;s++){const e=t.bones[s];let i=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==e){i=!0;break}i||this.bones.push(e)}for(let s=0;s<t.constraints.length;s++){const e=t.constraints[s];let i=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==e){i=!0;break}i||this.constraints.push(e)}const e=t.getAttachments();for(let s=0;s<e.length;s++){const t=e[s];this.setAttachment(t.slotIndex,t.name,t.attachment)}}copySkin(t){for(let s=0;s<t.bones.length;s++){const e=t.bones[s];let i=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==e){i=!0;break}i||this.bones.push(e)}for(let s=0;s<t.constraints.length;s++){const e=t.constraints[s];let i=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==e){i=!0;break}i||this.constraints.push(e)}const e=t.getAttachments();for(let s=0;s<e.length;s++){const t=e[s];null!=t.attachment&&(t.attachment instanceof lv?(t.attachment=t.attachment.newLinkedMesh(),this.setAttachment(t.slotIndex,t.name,t.attachment)):(t.attachment=t.attachment.copy(),this.setAttachment(t.slotIndex,t.name,t.attachment)))}}getAttachment(t,e){const s=this.attachments[t];return s?s[e]:null}removeAttachment(t,e){const s=this.attachments[t];s&&(s[e]=null)}getAttachments(){const t=new Array;for(let e=0;e<this.attachments.length;e++){const s=this.attachments[e];if(s)for(const i in s){const n=s[i];n&&t.push(new x_(e,i,n))}}return t}getAttachmentsForSlot(t,e){const s=this.attachments[t];if(s)for(const i in s){const n=s[i];n&&e.push(new x_(t,i,n))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(t,e){let s=0;for(let i=0;i<t.slots.length;i++){const n=t.slots[i],r=n.getAttachment();if(r&&s<e.attachments.length){const t=e.attachments[s];for(const e in t){if(r==t[e]){const t=this.getAttachment(s,e);null!=t&&n.setAttachment(t);break}}}s++}}};const __=class{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const e=this.scale,s=new m_;s.name="";const i=new xx(t);if(s.hash=i.readString(),s.version=i.readString(),"3.8.75"===s.version){const t="Unsupported skeleton data, 3.8.75 is deprecated, please export with a newer version of Spine.";console.error(t)}s.x=i.readFloat(),s.y=i.readFloat(),s.width=i.readFloat(),s.height=i.readFloat();const n=i.readBoolean();n&&(s.fps=i.readFloat(),s.imagesPath=i.readString(),s.audioPath=i.readString());let r=0;r=i.readInt(!0);for(let o=0;o<r;o++)i.strings.push(i.readString());r=i.readInt(!0);for(let o=0;o<r;o++){const t=i.readString(),r=0==o?null:s.bones[i.readInt(!0)],a=new s_(o,t,r);a.rotation=i.readFloat(),a.x=i.readFloat()*e,a.y=i.readFloat()*e,a.scaleX=i.readFloat(),a.scaleY=i.readFloat(),a.shearX=i.readFloat(),a.shearY=i.readFloat(),a.length=i.readFloat()*e,a.transformMode=__.TransformModeValues[i.readInt(!0)],a.skinRequired=i.readBoolean(),n&&Nx.rgba8888ToColor(a.color,i.readInt32()),s.bones.push(a)}r=i.readInt(!0);for(let o=0;o<r;o++){const t=i.readString(),e=s.bones[i.readInt(!0)],n=new g_(o,t,e);Nx.rgba8888ToColor(n.color,i.readInt32());const r=i.readInt32();-1!=r&&Nx.rgb888ToColor(n.darkColor=new Nx,r),n.attachmentName=i.readStringRef(),n.blendMode=__.BlendModeValues[i.readInt(!0)],s.slots.push(n)}r=i.readInt(!0);for(let o,h=0;h<r;h++){const t=new o_(i.readString());t.order=i.readInt(!0),t.skinRequired=i.readBoolean(),o=i.readInt(!0);for(let e=0;e<o;e++)t.bones.push(s.bones[i.readInt(!0)]);t.target=s.bones[i.readInt(!0)],t.mix=i.readFloat(),t.softness=i.readFloat()*e,t.bendDirection=i.readByte(),t.compress=i.readBoolean(),t.stretch=i.readBoolean(),t.uniform=i.readBoolean(),s.ikConstraints.push(t)}r=i.readInt(!0);for(let o,h=0;h<r;h++){const t=new y_(i.readString());t.order=i.readInt(!0),t.skinRequired=i.readBoolean(),o=i.readInt(!0);for(let e=0;e<o;e++)t.bones.push(s.bones[i.readInt(!0)]);t.target=s.bones[i.readInt(!0)],t.local=i.readBoolean(),t.relative=i.readBoolean(),t.offsetRotation=i.readFloat(),t.offsetX=i.readFloat()*e,t.offsetY=i.readFloat()*e,t.offsetScaleX=i.readFloat(),t.offsetScaleY=i.readFloat(),t.offsetShearY=i.readFloat(),t.rotateMix=i.readFloat(),t.translateMix=i.readFloat(),t.scaleMix=i.readFloat(),t.shearMix=i.readFloat(),s.transformConstraints.push(t)}r=i.readInt(!0);for(let o,h=0;h<r;h++){const t=new h_(i.readString());t.order=i.readInt(!0),t.skinRequired=i.readBoolean(),o=i.readInt(!0);for(let e=0;e<o;e++)t.bones.push(s.bones[i.readInt(!0)]);t.target=s.slots[i.readInt(!0)],t.positionMode=__.PositionModeValues[i.readInt(!0)],t.spacingMode=__.SpacingModeValues[i.readInt(!0)],t.rotateMode=__.RotateModeValues[i.readInt(!0)],t.offsetRotation=i.readFloat(),t.position=i.readFloat(),t.positionMode==bx.Fixed&&(t.position*=e),t.spacing=i.readFloat(),t.spacingMode!=l_.Length&&t.spacingMode!=l_.Fixed||(t.spacing*=e),t.rotateMix=i.readFloat(),t.translateMix=i.readFloat(),s.pathConstraints.push(t)}const a=this.readSkin(i,s,!0,n);null!=a&&(s.defaultSkin=a,s.skins.push(a));{let t=s.skins.length;for(Yx.setArraySize(s.skins,r=t+i.readInt(!0));t<r;t++)s.skins[t]=this.readSkin(i,s,!1,n)}r=this.linkedMeshes.length;for(let o=0;o<r;o++){const t=this.linkedMeshes[o],e=null==t.skin?s.defaultSkin:s.findSkin(t.skin);if(null==e)throw new Error(`Skin not found: ${t.skin}`);const i=e.getAttachment(t.slotIndex,t.parent);if(null==i)throw new Error(`Parent mesh not found: ${t.parent}`);t.mesh.deformAttachment=t.inheritDeform?i:t.mesh,t.mesh.setParentMesh(i)}this.linkedMeshes.length=0,r=i.readInt(!0);for(let o=0;o<r;o++){const t=new r_(i.readStringRef());t.intValue=i.readInt(!1),t.floatValue=i.readFloat(),t.stringValue=i.readString(),t.audioPath=i.readString(),null!=t.audioPath&&(t.volume=i.readFloat(),t.balance=i.readFloat()),s.events.push(t)}r=i.readInt(!0);for(let o=0;o<r;o++)s.animations.push(this.readAnimation(i,i.readString(),s));return s}readSkin(t,e,s,i){let n=null,r=0;if(s){if(r=t.readInt(!0),0==r)return null;n=new v_("default")}else{n=new v_(t.readStringRef()),n.bones.length=t.readInt(!0);for(let s=0,i=n.bones.length;s<i;s++)n.bones[s]=e.bones[t.readInt(!0)];for(let s=0,i=t.readInt(!0);s<i;s++)n.constraints.push(e.ikConstraints[t.readInt(!0)]);for(let s=0,i=t.readInt(!0);s<i;s++)n.constraints.push(e.transformConstraints[t.readInt(!0)]);for(let s=0,i=t.readInt(!0);s<i;s++)n.constraints.push(e.pathConstraints[t.readInt(!0)]);r=t.readInt(!0)}for(let a=0;a<r;a++){const s=t.readInt(!0);for(let r=0,a=t.readInt(!0);r<a;r++){const r=t.readStringRef(),a=this.readAttachment(t,e,n,s,r,i);null!=a&&n.setAttachment(s,r,a)}}return n}readAttachment(t,e,s,i,n,r){const a=this.scale;let o=t.readStringRef();null==o&&(o=n);const h=t.readByte();switch(__.AttachmentTypeValues[h]){case yx.Region:{let e=t.readStringRef();const i=t.readFloat(),n=t.readFloat(),r=t.readFloat(),h=t.readFloat(),l=t.readFloat(),c=t.readFloat(),u=t.readFloat(),d=t.readInt32();null==e&&(e=o);const p=this.attachmentLoader.newRegionAttachment(s,o,e);return null==p?null:(p.path=e,p.x=n*a,p.y=r*a,p.scaleX=h,p.scaleY=l,p.rotation=i,p.width=c*a,p.height=u*a,Nx.rgba8888ToColor(p.color,d),p)}case yx.BoundingBox:{const e=t.readInt(!0),i=this.readVertices(t,e),n=r?t.readInt32():0,a=this.attachmentLoader.newBoundingBoxAttachment(s,o);return null==a?null:(a.worldVerticesLength=e<<1,a.vertices=i.vertices,a.bones=i.bones,r&&Nx.rgba8888ToColor(a.color,n),a)}case yx.Mesh:{let e=t.readStringRef();const i=t.readInt32(),n=t.readInt(!0),h=this.readFloatArray(t,n<<1,1),l=this.readShortArray(t),c=this.readVertices(t,n),u=t.readInt(!0);let d=null,p=0,f=0;r&&(d=this.readShortArray(t),p=t.readFloat(),f=t.readFloat()),null==e&&(e=o);const m=this.attachmentLoader.newMeshAttachment(s,o,e);return null==m?null:(m.path=e,Nx.rgba8888ToColor(m.color,i),m.bones=c.bones,m.vertices=c.vertices,m.worldVerticesLength=n<<1,m.triangles=l,m.regionUVs=new Float32Array(h),m.hullLength=u<<1,r&&(m.edges=d,m.width=p*a,m.height=f*a),m)}case yx.LinkedMesh:{let e=t.readStringRef();const n=t.readInt32(),h=t.readStringRef(),l=t.readStringRef(),c=t.readBoolean();let u=0,d=0;r&&(u=t.readFloat(),d=t.readFloat()),null==e&&(e=o);const p=this.attachmentLoader.newMeshAttachment(s,o,e);return null==p?null:(p.path=e,Nx.rgba8888ToColor(p.color,n),r&&(p.width=u*a,p.height=d*a),this.linkedMeshes.push(new w_(p,h,i,l,c)),p)}case yx.Path:{const e=t.readBoolean(),i=t.readBoolean(),n=t.readInt(!0),h=this.readVertices(t,n),l=Yx.newArray(n/3,0);for(let s=0,r=l.length;s<r;s++)l[s]=t.readFloat()*a;const c=r?t.readInt32():0,u=this.attachmentLoader.newPathAttachment(s,o);return null==u?null:(u.closed=e,u.constantSpeed=i,u.worldVerticesLength=n<<1,u.vertices=h.vertices,u.bones=h.bones,u.lengths=l,r&&Nx.rgba8888ToColor(u.color,c),u)}case yx.Point:{const e=t.readFloat(),i=t.readFloat(),n=t.readFloat(),h=r?t.readInt32():0,l=this.attachmentLoader.newPointAttachment(s,o);return null==l?null:(l.x=i*a,l.y=n*a,l.rotation=e,r&&Nx.rgba8888ToColor(l.color,h),l)}case yx.Clipping:{const i=t.readInt(!0),n=t.readInt(!0),a=this.readVertices(t,n),h=r?t.readInt32():0,l=this.attachmentLoader.newClippingAttachment(s,o);return null==l?null:(l.endSlot=e.slots[i],l.worldVerticesLength=n<<1,l.vertices=a.vertices,l.bones=a.bones,r&&Nx.rgba8888ToColor(l.color,h),l)}}return null}readVertices(t,e){const s=e<<1,i=new E_,n=this.scale;if(!t.readBoolean())return i.vertices=this.readFloatArray(t,s,n),i;const r=new Array,a=new Array;for(let o=0;o<e;o++){const e=t.readInt(!0);a.push(e);for(let s=0;s<e;s++)a.push(t.readInt(!0)),r.push(t.readFloat()*n),r.push(t.readFloat()*n),r.push(t.readFloat())}return i.vertices=Yx.toFloatArray(r),i.bones=a,i}readFloatArray(t,e,s){const i=new Array(e);if(1==s)for(let n=0;n<e;n++)i[n]=t.readFloat();else for(let n=0;n<e;n++)i[n]=t.readFloat()*s;return i}readShortArray(t){const e=t.readInt(!0),s=new Array(e);for(let i=0;i<e;i++)s[i]=t.readShort();return s}readAnimation(t,e,s){const i=new Array,n=this.scale;let r=0;const a=new Nx,o=new Nx;for(let c=0,u=t.readInt(!0);c<u;c++){const e=t.readInt(!0);for(let s=0,n=t.readInt(!0);s<n;s++){const s=t.readByte(),n=t.readInt(!0);switch(s){case __.SLOT_ATTACHMENT:{const s=new Rv(n);s.slotIndex=e;for(let e=0;e<n;e++)s.setFrame(e,t.readFloat(),t.readStringRef());i.push(s),r=Math.max(r,s.frames[n-1]);break}case __.SLOT_COLOR:{const s=new Mv(n);s.slotIndex=e;for(let e=0;e<n;e++){const i=t.readFloat();Nx.rgba8888ToColor(a,t.readInt32()),s.setFrame(e,i,a.r,a.g,a.b,a.a),e<n-1&&this.readCurve(t,e,s)}i.push(s),r=Math.max(r,s.frames[(n-1)*Mv.ENTRIES]);break}case __.SLOT_TWO_COLOR:{const s=new Pv(n);s.slotIndex=e;for(let e=0;e<n;e++){const i=t.readFloat();Nx.rgba8888ToColor(a,t.readInt32()),Nx.rgb888ToColor(o,t.readInt32()),s.setFrame(e,i,a.r,a.g,a.b,a.a,o.r,o.g,o.b),e<n-1&&this.readCurve(t,e,s)}i.push(s),r=Math.max(r,s.frames[(n-1)*Pv.ENTRIES]);break}}}}for(let c=0,u=t.readInt(!0);c<u;c++){const e=t.readInt(!0);for(let s=0,a=t.readInt(!0);s<a;s++){const s=t.readByte(),a=t.readInt(!0);switch(s){case __.BONE_ROTATE:{const s=new wv(a);s.boneIndex=e;for(let e=0;e<a;e++)s.setFrame(e,t.readFloat(),t.readFloat()),e<a-1&&this.readCurve(t,e,s);i.push(s),r=Math.max(r,s.frames[(a-1)*wv.ENTRIES]);break}case __.BONE_TRANSLATE:case __.BONE_SCALE:case __.BONE_SHEAR:{let o,h=1;s==__.BONE_SCALE?o=new Tv(a):s==__.BONE_SHEAR?o=new Av(a):(o=new Sv(a),h=n),o.boneIndex=e;for(let e=0;e<a;e++)o.setFrame(e,t.readFloat(),t.readFloat()*h,t.readFloat()*h),e<a-1&&this.readCurve(t,e,o);i.push(o),r=Math.max(r,o.frames[(a-1)*Sv.ENTRIES]);break}}}}for(let c=0,u=t.readInt(!0);c<u;c++){const e=t.readInt(!0),s=t.readInt(!0),a=new Bv(s);a.ikConstraintIndex=e;for(let i=0;i<s;i++)a.setFrame(i,t.readFloat(),t.readFloat(),t.readFloat()*n,t.readByte(),t.readBoolean(),t.readBoolean()),i<s-1&&this.readCurve(t,i,a);i.push(a),r=Math.max(r,a.frames[(s-1)*Bv.ENTRIES])}for(let c=0,u=t.readInt(!0);c<u;c++){const e=t.readInt(!0),s=t.readInt(!0),n=new Vv(s);n.transformConstraintIndex=e;for(let i=0;i<s;i++)n.setFrame(i,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()),i<s-1&&this.readCurve(t,i,n);i.push(n),r=Math.max(r,n.frames[(s-1)*Vv.ENTRIES])}for(let c=0,u=t.readInt(!0);c<u;c++){const e=t.readInt(!0),a=s.pathConstraints[e];for(let s=0,o=t.readInt(!0);s<o;s++){const s=t.readByte(),o=t.readInt(!0);switch(s){case __.PATH_POSITION:case __.PATH_SPACING:{let h,l=1;s==__.PATH_SPACING?(h=new Xv(o),a.spacingMode!=l_.Length&&a.spacingMode!=l_.Fixed||(l=n)):(h=new Uv(o),a.positionMode==bx.Fixed&&(l=n)),h.pathConstraintIndex=e;for(let e=0;e<o;e++)h.setFrame(e,t.readFloat(),t.readFloat()*l),e<o-1&&this.readCurve(t,e,h);i.push(h),r=Math.max(r,h.frames[(o-1)*Uv.ENTRIES]);break}case __.PATH_MIX:{const s=new Wv(o);s.pathConstraintIndex=e;for(let e=0;e<o;e++)s.setFrame(e,t.readFloat(),t.readFloat(),t.readFloat()),e<o-1&&this.readCurve(t,e,s);i.push(s),r=Math.max(r,s.frames[(o-1)*Wv.ENTRIES]);break}}}}for(let c=0,u=t.readInt(!0);c<u;c++){const e=s.skins[t.readInt(!0)];for(let s=0,a=t.readInt(!0);s<a;s++){const s=t.readInt(!0);for(let a=0,o=t.readInt(!0);a<o;a++){const a=e.getAttachment(s,t.readStringRef()),o=null!=a.bones,h=a.vertices,l=o?h.length/3*2:h.length,c=t.readInt(!0),u=new Dv(c);u.slotIndex=s,u.attachment=a;for(let e=0;e<c;e++){const s=t.readFloat();let i,r=t.readInt(!0);if(0==r)i=o?Yx.newFloatArray(l):h;else{i=Yx.newFloatArray(l);const e=t.readInt(!0);if(r+=e,1==n)for(let s=e;s<r;s++)i[s]=t.readFloat();else for(let s=e;s<r;s++)i[s]=t.readFloat()*n;if(!o)for(let t=0,s=i.length;t<s;t++)i[t]+=h[t]}u.setFrame(e,s,i),e<c-1&&this.readCurve(t,e,u)}i.push(u),r=Math.max(r,u.frames[c-1])}}}const h=t.readInt(!0);if(h>0){const e=new Ov(h),n=s.slots.length;for(let s=0;s<h;s++){const i=t.readFloat(),r=t.readInt(!0),a=Yx.newArray(n,0);for(let t=n-1;t>=0;t--)a[t]=-1;const o=Yx.newArray(n-r,0);let h=0,l=0;for(let e=0;e<r;e++){const e=t.readInt(!0);for(;h!=e;)o[l++]=h++;a[h+t.readInt(!0)]=h++}for(;h<n;)o[l++]=h++;for(let t=n-1;t>=0;t--)-1==a[t]&&(a[t]=o[--l]);e.setFrame(s,i,a)}i.push(e),r=Math.max(r,e.frames[h-1])}const l=t.readInt(!0);if(l>0){const e=new Fv(l);for(let i=0;i<l;i++){const n=t.readFloat(),r=s.events[t.readInt(!0)],a=new n_(n,r);a.intValue=t.readInt(!1),a.floatValue=t.readFloat(),a.stringValue=t.readBoolean()?t.readString():r.stringValue,null!=a.data.audioPath&&(a.volume=t.readFloat(),a.balance=t.readFloat()),e.setFrame(i,a)}i.push(e),r=Math.max(r,e.frames[l-1])}return new yv(e,i,r)}readCurve(t,e,s){switch(t.readByte()){case __.CURVE_STEPPED:s.setStepped(e);break;case __.CURVE_BEZIER:this.setCurve(s,e,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat())}}setCurve(t,e,s,i,n,r){t.setCurve(e,s,i,n,r)}};let b_=__;b_.AttachmentTypeValues=[0,1,2,3,4,5,6],b_.TransformModeValues=[Ex.Normal,Ex.OnlyTranslation,Ex.NoRotationOrReflection,Ex.NoScale,Ex.NoScaleOrReflection],b_.PositionModeValues=[bx.Fixed,bx.Percent],b_.SpacingModeValues=[l_.Length,l_.Fixed,l_.Percent],b_.RotateModeValues=[wx.Tangent,wx.Chain,wx.ChainScale],b_.BlendModeValues=[cr.NORMAL,cr.ADD,cr.MULTIPLY,cr.SCREEN],b_.BONE_ROTATE=0,b_.BONE_TRANSLATE=1,b_.BONE_SCALE=2,b_.BONE_SHEAR=3,b_.SLOT_ATTACHMENT=0,b_.SLOT_COLOR=1,b_.SLOT_TWO_COLOR=2,b_.PATH_POSITION=0,b_.PATH_SPACING=1,b_.PATH_MIX=2,b_.CURVE_LINEAR=0,b_.CURVE_STEPPED=1,b_.CURVE_BEZIER=2;let w_=class{constructor(t,e,s,i,n){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=i,this.inheritDeform=n}},E_=class{constructor(t=null,e=null){this.bones=t,this.vertices=e}},S_=class t{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(e){const s=this.scale,i=new m_,n="string"==typeof e?JSON.parse(e):e,r=n.skeleton;if(null!=r){if(i.hash=r.hash,i.version=r.spine,"3.8"!==i.version.substr(0,3)){const t=`Spine 3.8 loader cant load version ${r.spine}. Please configure your pixi-spine bundle`;console.error(t)}if("3.8.75"===i.version){const t="Unsupported skeleton data, 3.8.75 is deprecated, please export with a newer version of Spine.";console.error(t)}i.x=r.x,i.y=r.y,i.width=r.width,i.height=r.height,i.fps=r.fps,i.imagesPath=r.images}if(n.bones)for(let a=0;a<n.bones.length;a++){const e=n.bones[a];let r=null;const o=this.getValue(e,"parent",null);if(null!=o&&(r=i.findBone(o),null==r))throw new Error(`Parent bone not found: ${o}`);const h=new s_(i.bones.length,e.name,r);h.length=this.getValue(e,"length",0)*s,h.x=this.getValue(e,"x",0)*s,h.y=this.getValue(e,"y",0)*s,h.rotation=this.getValue(e,"rotation",0),h.scaleX=this.getValue(e,"scaleX",1),h.scaleY=this.getValue(e,"scaleY",1),h.shearX=this.getValue(e,"shearX",0),h.shearY=this.getValue(e,"shearY",0),h.transformMode=t.transformModeFromString(this.getValue(e,"transform","normal")),h.skinRequired=this.getValue(e,"skin",!1),i.bones.push(h)}if(n.slots)for(let a=0;a<n.slots.length;a++){const e=n.slots[a],s=e.name,r=e.bone,o=i.findBone(r);if(null==o)throw new Error(`Slot bone not found: ${r}`);const h=new g_(i.slots.length,s,o),l=this.getValue(e,"color",null);null!=l&&h.color.setFromString(l);const c=this.getValue(e,"dark",null);null!=c&&(h.darkColor=new Nx(1,1,1,1),h.darkColor.setFromString(c)),h.attachmentName=this.getValue(e,"attachment",null),h.blendMode=t.blendModeFromString(this.getValue(e,"blend","normal")),i.slots.push(h)}if(n.ik)for(let t=0;t<n.ik.length;t++){const e=n.ik[t],r=new o_(e.name);r.order=this.getValue(e,"order",0),r.skinRequired=this.getValue(e,"skin",!1);for(let t=0;t<e.bones.length;t++){const s=e.bones[t],n=i.findBone(s);if(null==n)throw new Error(`IK bone not found: ${s}`);r.bones.push(n)}const a=e.target;if(r.target=i.findBone(a),null==r.target)throw new Error(`IK target bone not found: ${a}`);r.mix=this.getValue(e,"mix",1),r.softness=this.getValue(e,"softness",0)*s,r.bendDirection=this.getValue(e,"bendPositive",!0)?1:-1,r.compress=this.getValue(e,"compress",!1),r.stretch=this.getValue(e,"stretch",!1),r.uniform=this.getValue(e,"uniform",!1),i.ikConstraints.push(r)}if(n.transform)for(let t=0;t<n.transform.length;t++){const e=n.transform[t],r=new y_(e.name);r.order=this.getValue(e,"order",0),r.skinRequired=this.getValue(e,"skin",!1);for(let t=0;t<e.bones.length;t++){const s=e.bones[t],n=i.findBone(s);if(null==n)throw new Error(`Transform constraint bone not found: ${s}`);r.bones.push(n)}const a=e.target;if(r.target=i.findBone(a),null==r.target)throw new Error(`Transform constraint target bone not found: ${a}`);r.local=this.getValue(e,"local",!1),r.relative=this.getValue(e,"relative",!1),r.offsetRotation=this.getValue(e,"rotation",0),r.offsetX=this.getValue(e,"x",0)*s,r.offsetY=this.getValue(e,"y",0)*s,r.offsetScaleX=this.getValue(e,"scaleX",0),r.offsetScaleY=this.getValue(e,"scaleY",0),r.offsetShearY=this.getValue(e,"shearY",0),r.rotateMix=this.getValue(e,"rotateMix",1),r.translateMix=this.getValue(e,"translateMix",1),r.scaleMix=this.getValue(e,"scaleMix",1),r.shearMix=this.getValue(e,"shearMix",1),i.transformConstraints.push(r)}if(n.path)for(let a=0;a<n.path.length;a++){const e=n.path[a],r=new h_(e.name);r.order=this.getValue(e,"order",0),r.skinRequired=this.getValue(e,"skin",!1);for(let t=0;t<e.bones.length;t++){const s=e.bones[t],n=i.findBone(s);if(null==n)throw new Error(`Transform constraint bone not found: ${s}`);r.bones.push(n)}const o=e.target;if(r.target=i.findSlot(o),null==r.target)throw new Error(`Path target slot not found: ${o}`);r.positionMode=t.positionModeFromString(this.getValue(e,"positionMode","percent")),r.spacingMode=t.spacingModeFromString(this.getValue(e,"spacingMode","length")),r.rotateMode=t.rotateModeFromString(this.getValue(e,"rotateMode","tangent")),r.offsetRotation=this.getValue(e,"rotation",0),r.position=this.getValue(e,"position",0),r.positionMode==bx.Fixed&&(r.position*=s),r.spacing=this.getValue(e,"spacing",0),r.spacingMode!=l_.Length&&r.spacingMode!=l_.Fixed||(r.spacing*=s),r.rotateMix=this.getValue(e,"rotateMix",1),r.translateMix=this.getValue(e,"translateMix",1),i.pathConstraints.push(r)}if(n.skins)for(let t=0;t<n.skins.length;t++){const e=n.skins[t],s=new v_(e.name);if(e.bones)for(let n=0;n<e.bones.length;n++){const r=i.findBone(e.bones[n]);if(null==r)throw new Error(`Skin bone not found: ${e.bones[t]}`);s.bones.push(r)}if(e.ik)for(let n=0;n<e.ik.length;n++){const r=i.findIkConstraint(e.ik[n]);if(null==r)throw new Error(`Skin IK constraint not found: ${e.ik[t]}`);s.constraints.push(r)}if(e.transform)for(let n=0;n<e.transform.length;n++){const r=i.findTransformConstraint(e.transform[n]);if(null==r)throw new Error(`Skin transform constraint not found: ${e.transform[t]}`);s.constraints.push(r)}if(e.path)for(let n=0;n<e.path.length;n++){const r=i.findPathConstraint(e.path[n]);if(null==r)throw new Error(`Skin path constraint not found: ${e.path[t]}`);s.constraints.push(r)}for(const t in e.attachments){const n=i.findSlot(t);if(null==n)throw new Error(`Slot not found: ${t}`);const r=e.attachments[t];for(const t in r){const e=this.readAttachment(r[t],s,n.index,t,i);null!=e&&s.setAttachment(n.index,t,e)}}i.skins.push(s),"default"==s.name&&(i.defaultSkin=s)}for(let t=0,a=this.linkedMeshes.length;t<a;t++){const e=this.linkedMeshes[t],s=null==e.skin?i.defaultSkin:i.findSkin(e.skin);if(null==s)throw new Error(`Skin not found: ${e.skin}`);const n=s.getAttachment(e.slotIndex,e.parent);if(null==n)throw new Error(`Parent mesh not found: ${e.parent}`);e.mesh.deformAttachment=e.inheritDeform?n:e.mesh,e.mesh.setParentMesh(n)}if(this.linkedMeshes.length=0,n.events)for(const t in n.events){const e=n.events[t],s=new r_(t);s.intValue=this.getValue(e,"int",0),s.floatValue=this.getValue(e,"float",0),s.stringValue=this.getValue(e,"string",""),s.audioPath=this.getValue(e,"audio",null),null!=s.audioPath&&(s.volume=this.getValue(e,"volume",1),s.balance=this.getValue(e,"balance",0)),i.events.push(s)}if(n.animations)for(const t in n.animations){const e=n.animations[t];this.readAnimation(e,t,i)}return i}readAttachment(t,e,s,i,n){const r=this.scale;i=this.getValue(t,"name",i);switch(this.getValue(t,"type","region")){case"region":{const s=this.getValue(t,"path",i),n=this.attachmentLoader.newRegionAttachment(e,i,s);if(null==n)return null;n.path=s,n.x=this.getValue(t,"x",0)*r,n.y=this.getValue(t,"y",0)*r,n.scaleX=this.getValue(t,"scaleX",1),n.scaleY=this.getValue(t,"scaleY",1),n.rotation=this.getValue(t,"rotation",0),n.width=t.width*r,n.height=t.height*r;const a=this.getValue(t,"color",null);return null!=a&&n.color.setFromString(a),n}case"boundingbox":{const s=this.attachmentLoader.newBoundingBoxAttachment(e,i);if(null==s)return null;this.readVertices(t,s,t.vertexCount<<1);const n=this.getValue(t,"color",null);return null!=n&&s.color.setFromString(n),s}case"mesh":case"linkedmesh":{const n=this.getValue(t,"path",i),a=this.attachmentLoader.newMeshAttachment(e,i,n);if(null==a)return null;a.path=n;const o=this.getValue(t,"color",null);null!=o&&a.color.setFromString(o),a.width=this.getValue(t,"width",0)*r,a.height=this.getValue(t,"height",0)*r;const h=this.getValue(t,"parent",null);if(null!=h)return this.linkedMeshes.push(new T_(a,this.getValue(t,"skin",null),s,h,this.getValue(t,"deform",!0))),a;const l=t.uvs;return this.readVertices(t,a,l.length),a.triangles=t.triangles,a.regionUVs=new Float32Array(l),a.edges=this.getValue(t,"edges",null),a.hullLength=2*this.getValue(t,"hull",0),a}case"path":{const s=this.attachmentLoader.newPathAttachment(e,i);if(null==s)return null;s.closed=this.getValue(t,"closed",!1),s.constantSpeed=this.getValue(t,"constantSpeed",!0);const n=t.vertexCount;this.readVertices(t,s,n<<1);const a=Yx.newArray(n/3,0);for(let e=0;e<t.lengths.length;e++)a[e]=t.lengths[e]*r;s.lengths=a;const o=this.getValue(t,"color",null);return null!=o&&s.color.setFromString(o),s}case"point":{const s=this.attachmentLoader.newPointAttachment(e,i);if(null==s)return null;s.x=this.getValue(t,"x",0)*r,s.y=this.getValue(t,"y",0)*r,s.rotation=this.getValue(t,"rotation",0);const n=this.getValue(t,"color",null);return null!=n&&s.color.setFromString(n),s}case"clipping":{const s=this.attachmentLoader.newClippingAttachment(e,i);if(null==s)return null;const r=this.getValue(t,"end",null);if(null!=r){const t=n.findSlot(r);if(null==t)throw new Error(`Clipping end slot not found: ${r}`);s.endSlot=t}const a=t.vertexCount;this.readVertices(t,s,a<<1);const o=this.getValue(t,"color",null);return null!=o&&s.color.setFromString(o),s}}return null}readVertices(t,e,s){const i=this.scale;e.worldVerticesLength=s;const n=t.vertices;if(s==n.length){const t=Yx.toFloatArray(n);if(1!=i)for(let e=0,s=n.length;e<s;e++)t[e]*=i;return void(e.vertices=t)}const r=new Array,a=new Array;for(let o=0,h=n.length;o<h;){const t=n[o++];a.push(t);for(let e=o+4*t;o<e;o+=4)a.push(n[o]),r.push(n[o+1]*i),r.push(n[o+2]*i),r.push(n[o+3])}e.bones=a,e.vertices=Yx.toFloatArray(r)}readAnimation(t,e,s){const i=this.scale,n=new Array;let r=0;if(t.slots)for(const o in t.slots){const e=t.slots[o],i=s.findSlotIndex(o);if(-1==i)throw new Error(`Slot not found: ${o}`);for(const t in e){const s=e[t];if("attachment"==t){const t=new Rv(s.length);t.slotIndex=i;let e=0;for(let i=0;i<s.length;i++){const n=s[i];t.setFrame(e++,this.getValue(n,"time",0),n.name)}n.push(t),r=Math.max(r,t.frames[t.getFrameCount()-1])}else if("color"==t){const t=new Mv(s.length);t.slotIndex=i;let e=0;for(let i=0;i<s.length;i++){const n=s[i],r=new Nx;r.setFromString(n.color||"ffffffff"),t.setFrame(e,this.getValue(n,"time",0),r.r,r.g,r.b,r.a),this.readCurve(n,t,e),e++}n.push(t),r=Math.max(r,t.frames[(t.getFrameCount()-1)*Mv.ENTRIES])}else{if("twoColor"!=t)throw new Error(`Invalid timeline type for a slot: ${t} (${o})`);{const t=new Pv(s.length);t.slotIndex=i;let e=0;for(let i=0;i<s.length;i++){const n=s[i],r=new Nx,a=new Nx;r.setFromString(n.light),a.setFromString(n.dark),t.setFrame(e,this.getValue(n,"time",0),r.r,r.g,r.b,r.a,a.r,a.g,a.b),this.readCurve(n,t,e),e++}n.push(t),r=Math.max(r,t.frames[(t.getFrameCount()-1)*Pv.ENTRIES])}}}}if(t.bones)for(const o in t.bones){const e=t.bones[o],a=s.findBoneIndex(o);if(-1==a)throw new Error(`Bone not found: ${o}`);for(const t in e){const s=e[t];if("rotate"===t){const t=new wv(s.length);t.boneIndex=a;let e=0;for(let i=0;i<s.length;i++){const n=s[i];t.setFrame(e,this.getValue(n,"time",0),this.getValue(n,"angle",0)),this.readCurve(n,t,e),e++}n.push(t),r=Math.max(r,t.frames[(t.getFrameCount()-1)*wv.ENTRIES])}else{if("translate"!==t&&"scale"!==t&&"shear"!==t)throw new Error(`Invalid timeline type for a bone: ${t} (${o})`);{let e=null,o=1,h=0;"scale"===t?(e=new Tv(s.length),h=1):"shear"===t?e=new Av(s.length):(e=new Sv(s.length),o=i),e.boneIndex=a;let l=0;for(let t=0;t<s.length;t++){const i=s[t],n=this.getValue(i,"x",h),r=this.getValue(i,"y",h);e.setFrame(l,this.getValue(i,"time",0),n*o,r*o),this.readCurve(i,e,l),l++}n.push(e),r=Math.max(r,e.frames[(e.getFrameCount()-1)*Sv.ENTRIES])}}}}if(t.ik)for(const o in t.ik){const e=t.ik[o],a=s.findIkConstraint(o),h=new Bv(e.length);h.ikConstraintIndex=s.ikConstraints.indexOf(a);let l=0;for(let t=0;t<e.length;t++){const s=e[t];h.setFrame(l,this.getValue(s,"time",0),this.getValue(s,"mix",1),this.getValue(s,"softness",0)*i,this.getValue(s,"bendPositive",!0)?1:-1,this.getValue(s,"compress",!1),this.getValue(s,"stretch",!1)),this.readCurve(s,h,l),l++}n.push(h),r=Math.max(r,h.frames[(h.getFrameCount()-1)*Bv.ENTRIES])}if(t.transform)for(const o in t.transform){const e=t.transform[o],i=s.findTransformConstraint(o),a=new Vv(e.length);a.transformConstraintIndex=s.transformConstraints.indexOf(i);let h=0;for(let t=0;t<e.length;t++){const s=e[t];a.setFrame(h,this.getValue(s,"time",0),this.getValue(s,"rotateMix",1),this.getValue(s,"translateMix",1),this.getValue(s,"scaleMix",1),this.getValue(s,"shearMix",1)),this.readCurve(s,a,h),h++}n.push(a),r=Math.max(r,a.frames[(a.getFrameCount()-1)*Vv.ENTRIES])}if(t.path)for(const o in t.path){const e=t.path[o],a=s.findPathConstraintIndex(o);if(-1==a)throw new Error(`Path constraint not found: ${o}`);const h=s.pathConstraints[a];for(const t in e){const s=e[t];if("position"===t||"spacing"===t){let e=null,o=1;"spacing"===t?(e=new Xv(s.length),h.spacingMode!=l_.Length&&h.spacingMode!=l_.Fixed||(o=i)):(e=new Uv(s.length),h.positionMode==bx.Fixed&&(o=i)),e.pathConstraintIndex=a;let l=0;for(let i=0;i<s.length;i++){const n=s[i];e.setFrame(l,this.getValue(n,"time",0),this.getValue(n,t,0)*o),this.readCurve(n,e,l),l++}n.push(e),r=Math.max(r,e.frames[(e.getFrameCount()-1)*Uv.ENTRIES])}else if("mix"===t){const t=new Wv(s.length);t.pathConstraintIndex=a;let e=0;for(let i=0;i<s.length;i++){const n=s[i];t.setFrame(e,this.getValue(n,"time",0),this.getValue(n,"rotateMix",1),this.getValue(n,"translateMix",1)),this.readCurve(n,t,e),e++}n.push(t),r=Math.max(r,t.frames[(t.getFrameCount()-1)*Wv.ENTRIES])}}}if(t.deform)for(const o in t.deform){const e=t.deform[o],a=s.findSkin(o);if(null!=a)for(const t in e){const o=e[t],h=s.findSlotIndex(t);if(-1==h)throw new Error(`Slot not found: ${o.name}`);for(const t in o){const e=o[t],s=a.getAttachment(h,t);if(null==s)throw new Error(`Deform attachment not found: ${e.name}`);const l=null!=s.bones,c=s.vertices,u=l?c.length/3*2:c.length,d=new Dv(e.length);d.slotIndex=h,d.attachment=s;let p=0;for(let t=0;t<e.length;t++){const s=e[t];let n;const r=this.getValue(s,"vertices",null);if(null==r)n=l?Yx.newFloatArray(u):c;else{n=Yx.newFloatArray(u);const t=this.getValue(s,"offset",0);if(Yx.arrayCopy(r,0,n,t,r.length),1!=i)for(let e=t,s=e+r.length;e<s;e++)n[e]*=i;if(!l)for(let e=0;e<u;e++)n[e]+=c[e]}d.setFrame(p,this.getValue(s,"time",0),n),this.readCurve(s,d,p),p++}n.push(d),r=Math.max(r,d.frames[d.getFrameCount()-1])}}}let a=t.drawOrder;if(null==a&&(a=t.draworder),null!=a){const t=new Ov(a.length),e=s.slots.length;let i=0;for(let n=0;n<a.length;n++){const r=a[n];let o=null;const h=this.getValue(r,"offsets",null);if(null!=h){o=Yx.newArray(e,-1);const t=Yx.newArray(e-h.length,0);let i=0,n=0;for(let e=0;e<h.length;e++){const r=h[e],a=s.findSlotIndex(r.slot);if(-1==a)throw new Error(`Slot not found: ${r.slot}`);for(;i!=a;)t[n++]=i++;o[i+r.offset]=i++}for(;i<e;)t[n++]=i++;for(let s=e-1;s>=0;s--)-1==o[s]&&(o[s]=t[--n])}t.setFrame(i++,this.getValue(r,"time",0),o)}n.push(t),r=Math.max(r,t.frames[t.getFrameCount()-1])}if(t.events){const e=new Fv(t.events.length);let i=0;for(let n=0;n<t.events.length;n++){const r=t.events[n],a=s.findEvent(r.name);if(null==a)throw new Error(`Event not found: ${r.name}`);const o=new n_(Yx.toSinglePrecision(this.getValue(r,"time",0)),a);o.intValue=this.getValue(r,"int",a.intValue),o.floatValue=this.getValue(r,"float",a.floatValue),o.stringValue=this.getValue(r,"string",a.stringValue),null!=o.data.audioPath&&(o.volume=this.getValue(r,"volume",1),o.balance=this.getValue(r,"balance",0)),e.setFrame(i++,o)}n.push(e),r=Math.max(r,e.frames[e.getFrameCount()-1])}if(isNaN(r))throw new Error("Error while parsing animation, duration is NaN");s.animations.push(new yv(e,n,r))}readCurve(t,e,s){if(t.hasOwnProperty("curve"))if("stepped"===t.curve)e.setStepped(s);else{const i=t.curve;e.setCurve(s,i,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1))}}getValue(t,e,s){return void 0!==t[e]?t[e]:s}static blendModeFromString(t){if("normal"==(t=t.toLowerCase()))return cr.NORMAL;if("additive"==t)return cr.ADD;if("multiply"==t)return cr.MULTIPLY;if("screen"==t)return cr.SCREEN;throw new Error(`Unknown blend mode: ${t}`)}static positionModeFromString(t){if("fixed"==(t=t.toLowerCase()))return bx.Fixed;if("percent"==t)return bx.Percent;throw new Error(`Unknown position mode: ${t}`)}static spacingModeFromString(t){if("length"==(t=t.toLowerCase()))return l_.Length;if("fixed"==t)return l_.Fixed;if("percent"==t)return l_.Percent;throw new Error(`Unknown position mode: ${t}`)}static rotateModeFromString(t){if("tangent"==(t=t.toLowerCase()))return wx.Tangent;if("chain"==t)return wx.Chain;if("chainscale"==t)return wx.ChainScale;throw new Error(`Unknown rotate mode: ${t}`)}static transformModeFromString(t){if("normal"==(t=t.toLowerCase()))return Ex.Normal;if("onlytranslation"==t)return Ex.OnlyTranslation;if("norotationorreflection"==t)return Ex.NoRotationOrReflection;if("noscale"==t)return Ex.NoScale;if("noscaleorreflection"==t)return Ex.NoScaleOrReflection;throw new Error(`Unknown transform mode: ${t}`)}},T_=class{constructor(t,e,s,i,n){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=i,this.inheritDeform=n}};const A_=Object.freeze(Object.defineProperty({__proto__:null,Animation:yv,AnimationState:Gv,AnimationStateAdapter:class{start(t){}interrupt(t){}end(t){}dispose(t){}complete(t){}event(t,e){}},AnimationStateData:Jv,AtlasAttachmentLoader:t_,Attachment:nv,AttachmentTimeline:Rv,Bone:e_,BoneData:s_,BoundingBoxAttachment:ov,ClippingAttachment:hv,ColorTimeline:Mv,ConstraintData:i_,CurveTimeline:_v,DeformTimeline:Dv,DrawOrderTimeline:Ov,Event:n_,EventData:r_,EventQueue:Kv,EventTimeline:Fv,EventType:Zv,IkConstraint:a_,IkConstraintData:o_,IkConstraintTimeline:Bv,JitterEffect:class{constructor(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}begin(t){}transform(t,e,s,i){t.x+=Lx.randomTriangular(-this.jitterX,this.jitterY),t.y+=Lx.randomTriangular(-this.jitterX,this.jitterY)}end(){}},MeshAttachment:lv,PathAttachment:cv,PathConstraint:u_,PathConstraintData:h_,PathConstraintMixTimeline:Wv,PathConstraintPositionTimeline:Uv,PathConstraintSpacingTimeline:Xv,PointAttachment:uv,RegionAttachment:fv,RotateTimeline:wv,ScaleTimeline:Tv,ShearTimeline:Av,Skeleton:f_,SkeletonBinary:b_,SkeletonBounds:class extends Gx{},SkeletonData:m_,SkeletonJson:S_,Skin:v_,SkinEntry:x_,Slot:dv,SlotData:g_,SpacingMode:l_,Spine:class extends Qx{createSkeleton(t){this.skeleton=new f_(t),this.skeleton.updateWorldTransform(),this.stateData=new Jv(t),this.state=new Gv(this.stateData)}},SwirlEffect:gv,TimelineType:xv,TrackEntry:Hv,TransformConstraint:d_,TransformConstraintData:y_,TransformConstraintTimeline:Vv,TranslateTimeline:Sv,TwoColorTimeline:Pv,VertexAttachment:av},Symbol.toStringTag,{value:"Module"}));let C_=class{constructor(t){if(null==t)throw new Error("name cannot be null.");this.name=t}};const M_=class extends C_{constructor(t){super(t),this.id=(65535&M_.nextID++)<<11,this.worldVerticesLength=0}computeWorldVerticesOld(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)}computeWorldVertices(t,e,s,i,n,r){s=n+(s>>1)*r;const a=t.bone.skeleton,o=t.attachmentVertices;let h=this.vertices;const l=this.bones;if(null==l){o.length>0&&(h=o);const a=t.bone.matrix,l=a.tx,c=a.ty,u=a.a,d=a.c,p=a.b,f=a.d;for(let t=e,o=n;o<s;t+=2,o+=r){const e=h[t],s=h[t+1];i[o]=e*u+s*d+l,i[o+1]=e*p+s*f+c}return}let c=0,u=0;for(let p=0;p<e;p+=2){const t=l[c];c+=t+1,u+=t}const d=a.bones;if(0==o.length)for(let p=n,f=3*u;p<s;p+=r){let t=0,e=0,s=l[c++];for(s+=c;c<s;c++,f+=3){const s=d[l[c]].matrix,i=h[f],n=h[f+1],r=h[f+2];t+=(i*s.a+n*s.c+s.tx)*r,e+=(i*s.b+n*s.d+s.ty)*r}i[p]=t,i[p+1]=e}else{const t=o;for(let e=n,a=3*u,o=u<<1;e<s;e+=r){let s=0,n=0,r=l[c++];for(r+=c;c<r;c++,a+=3,o+=2){const e=d[l[c]].matrix,i=h[a]+t[o],r=h[a+1]+t[o+1],u=h[a+2];s+=(i*e.a+r*e.c+e.tx)*u,n+=(i*e.b+r*e.d+e.ty)*u}i[e]=s,i[e+1]=n}}}applyDeform(t){return this==t}};let I_=M_;I_.nextID=0;let P_=class extends I_{constructor(t){super(t),this.type=yx.BoundingBox,this.color=new Nx(1,1,1,1)}},R_=class extends I_{constructor(t){super(t),this.type=yx.Clipping,this.color=new Nx(.2275,.2275,.8078,1)}},k_=class extends I_{constructor(t){super(t),this.type=yx.Mesh,this.color=new Nx(1,1,1,1),this.inheritDeform=!1,this.tempColor=new Nx(0,0,0,0)}applyDeform(t){return this==t||this.inheritDeform&&this.parentMesh==t}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}},D_=class extends I_{constructor(t){super(t),this.type=yx.Path,this.closed=!1,this.constantSpeed=!1,this.color=new Nx(1,1,1,1)}},F_=class extends I_{constructor(t){super(t),this.type=yx.Point,this.color=new Nx(.38,.94,0,1)}computeWorldPosition(t,e){const s=t.matrix;return e.x=this.x*s.a+this.y*s.c+t.worldX,e.y=this.x*s.b+this.y*s.d+t.worldY,e}computeWorldRotation(t){const e=t.matrix,s=Lx.cosDeg(this.rotation),i=Lx.sinDeg(this.rotation),n=s*e.a+i*e.c,r=s*e.b+i*e.d;return Math.atan2(r,n)*Lx.radDeg}},O_=class{constructor(t,e){if(this.attachmentVertices=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new Nx,this.darkColor=null==t.darkColor?null:new Nx,this.setToSetupPose(),this.blendMode=this.data.blendMode}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0)}setAttachmentTime(t){this.attachmentTime=this.bone.skeleton.time-t}getAttachmentTime(){return this.bone.skeleton.time-this.attachmentTime}setToSetupPose(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))}};const N_=class extends C_{constructor(t){super(t),this.type=yx.Region,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new Nx(1,1,1,1),this.offset=Yx.newFloatArray(8),this.uvs=Yx.newFloatArray(8),this.tempColor=new Nx(1,1,1,1)}updateOffset(){const t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,s=-this.width/2*this.scaleX+this.region.offsetX*t,i=-this.height/2*this.scaleY+this.region.offsetY*e,n=s+this.region.width*t,r=i+this.region.height*e,a=this.rotation*Math.PI/180,o=Math.cos(a),h=Math.sin(a),l=s*o+this.x,c=s*h,u=i*o+this.y,d=i*h,p=n*o+this.x,f=n*h,m=r*o+this.y,g=r*h,y=this.offset;y[N_.OX1]=l-d,y[N_.OY1]=u+c,y[N_.OX2]=l-g,y[N_.OY2]=m+c,y[N_.OX3]=p-g,y[N_.OY3]=m+f,y[N_.OX4]=p-d,y[N_.OY4]=u+f}setRegion(t){this.region=t;const e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}computeWorldVertices(t,e,s,i){const n=this.offset,r=t instanceof O_?t.bone.matrix:t.matrix,a=r.tx,o=r.ty,h=r.a,l=r.c,c=r.b,u=r.d;let d=0,p=0;d=n[N_.OX1],p=n[N_.OY1],e[s]=d*h+p*l+a,e[s+1]=d*c+p*u+o,s+=i,d=n[N_.OX2],p=n[N_.OY2],e[s]=d*h+p*l+a,e[s+1]=d*c+p*u+o,s+=i,d=n[N_.OX3],p=n[N_.OY3],e[s]=d*h+p*l+a,e[s+1]=d*c+p*u+o,s+=i,d=n[N_.OX4],p=n[N_.OY4],e[s]=d*h+p*l+a,e[s+1]=d*c+p*u+o}};let B_=N_;B_.OX1=0,B_.OY1=1,B_.OX2=2,B_.OY2=3,B_.OX3=4,B_.OY3=5,B_.OX4=6,B_.OY4=7,B_.X1=0,B_.Y1=1,B_.C1R=2,B_.C1G=3,B_.C1B=4,B_.C1A=5,B_.U1=6,B_.V1=7,B_.X2=8,B_.Y2=9,B_.C2R=10,B_.C2G=11,B_.C2B=12,B_.C2A=13,B_.U2=14,B_.V2=15,B_.X3=16,B_.Y3=17,B_.C3R=18,B_.C3G=19,B_.C3B=20,B_.C3A=21,B_.U3=22,B_.V3=23,B_.X4=24,B_.Y4=25,B_.C4R=26,B_.C4G=27,B_.C4B=28,B_.C4A=29,B_.U4=30,B_.V4=31;const L_=class{constructor(t){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t}begin(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY}transform(t,e,s,i){const n=this.angle*Lx.degreesToRadians,r=t.x-this.worldX,a=t.y-this.worldY,o=Math.sqrt(r*r+a*a);if(o<this.radius){const e=L_.interpolation.apply(0,n,(this.radius-o)/this.radius),s=Math.cos(e),i=Math.sin(e);t.x=s*r-i*a+this.worldX,t.y=i*r+s*a+this.worldY}}end(){}};let V_=L_;V_.interpolation=new Ux(2);let $_=class{constructor(t,e,s){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.duration=s}apply(t,e,s,i,n,r,a,o){if(null==t)throw new Error("skeleton cannot be null.");i&&0!=this.duration&&(s%=this.duration,e>0&&(e%=this.duration));const h=this.timelines;for(let l=0,c=h.length;l<c;l++)h[l].apply(t,e,s,n,r,a,o)}static binarySearch(t,e,s=1){let i=0,n=t.length/s-2;if(0==n)return s;let r=n>>>1;for(;;){if(t[(r+1)*s]<=e?i=r+1:n=r,i==n)return(i+1)*s;r=i+n>>>1}}static linearSearch(t,e,s){for(let i=0,n=t.length-s;i<=n;i+=s)if(t[i]>e)return i;return-1}};var U_=(t=>(t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor",t))(U_||{});const X_=class{constructor(t){if(t<=0)throw new Error(`frameCount must be > 0: ${t}`);this.curves=Yx.newFloatArray((t-1)*X_.BEZIER_SIZE)}getFrameCount(){return this.curves.length/X_.BEZIER_SIZE+1}setLinear(t){this.curves[t*X_.BEZIER_SIZE]=X_.LINEAR}setStepped(t){this.curves[t*X_.BEZIER_SIZE]=X_.STEPPED}getCurveType(t){const e=t*X_.BEZIER_SIZE;if(e==this.curves.length)return X_.LINEAR;const s=this.curves[e];return s==X_.LINEAR?X_.LINEAR:s==X_.STEPPED?X_.STEPPED:X_.BEZIER}setCurve(t,e,s,i,n){const r=.03*(2*-e+i),a=.03*(2*-s+n),o=.006*(3*(e-i)+1),h=.006*(3*(s-n)+1);let l=2*r+o,c=2*a+h,u=.3*e+r+.16666667*o,d=.3*s+a+.16666667*h,p=t*X_.BEZIER_SIZE;const f=this.curves;f[p++]=X_.BEZIER;let m=u,g=d;for(let y=p+X_.BEZIER_SIZE-1;p<y;p+=2)f[p]=m,f[p+1]=g,u+=l,d+=c,l+=o,c+=h,m+=u,g+=d}getCurvePercent(t,e){e=Lx.clamp(e,0,1);const s=this.curves;let i=t*X_.BEZIER_SIZE;const n=s[i];if(n==X_.LINEAR)return e;if(n==X_.STEPPED)return 0;i++;let r=0;for(let o=i,h=i+X_.BEZIER_SIZE-1;i<h;i+=2)if(r=s[i],r>=e){let t,n;return i==o?(t=0,n=0):(t=s[i-2],n=s[i-1]),n+(s[i+1]-n)*(e-t)/(r-t)}const a=s[i-1];return a+(1-a)*(e-r)/(1-r)}};let Y_=X_;Y_.LINEAR=0,Y_.STEPPED=1,Y_.BEZIER=2,Y_.BEZIER_SIZE=19;const W_=class extends Y_{constructor(t){super(t),this.frames=Yx.newFloatArray(t<<1)}getPropertyId(){return 0+this.boneIndex}setFrame(t,e,s){t<<=1,this.frames[t]=e,this.frames[t+W_.ROTATION]=s}apply(t,e,s,i,n,r,a){const o=this.frames,h=t.bones[this.boneIndex];if(s<o[0]){switch(r){case vx.setup:return void(h.rotation=h.data.rotation);case vx.first:const t=h.data.rotation-h.rotation;h.rotation+=(t-360*(16384-(16384.499999999996-t/360|0)))*n}return}if(s>=o[o.length-W_.ENTRIES]){let t=o[o.length+W_.PREV_ROTATION];switch(r){case vx.setup:h.rotation=h.data.rotation+t*n;break;case vx.first:case vx.replace:t+=h.data.rotation-h.rotation,t-=360*(16384-(16384.499999999996-t/360|0));case vx.add:h.rotation+=t*n}return}const l=$_.binarySearch(o,s,W_.ENTRIES),c=o[l+W_.PREV_ROTATION],u=o[l],d=this.getCurvePercent((l>>1)-1,1-(s-u)/(o[l+W_.PREV_TIME]-u));let p=o[l+W_.ROTATION]-c;switch(p=c+(p-360*(16384-(16384.499999999996-p/360|0)))*d,r){case vx.setup:h.rotation=h.data.rotation+(p-360*(16384-(16384.499999999996-p/360|0)))*n;break;case vx.first:case vx.replace:p+=h.data.rotation-h.rotation;case vx.add:h.rotation+=(p-360*(16384-(16384.499999999996-p/360|0)))*n}}};let j_=W_;j_.ENTRIES=2,j_.PREV_TIME=-2,j_.PREV_ROTATION=-1,j_.ROTATION=1;const G_=class extends Y_{constructor(t){super(t),this.frames=Yx.newFloatArray(t*G_.ENTRIES)}getPropertyId(){return(1<<24)+this.boneIndex}setFrame(t,e,s,i){t*=G_.ENTRIES,this.frames[t]=e,this.frames[t+G_.X]=s,this.frames[t+G_.Y]=i}apply(t,e,s,i,n,r,a){const o=this.frames,h=t.bones[this.boneIndex];if(s<o[0]){switch(r){case vx.setup:return h.x=h.data.x,void(h.y=h.data.y);case vx.first:h.x+=(h.data.x-h.x)*n,h.y+=(h.data.y-h.y)*n}return}let l=0,c=0;if(s>=o[o.length-G_.ENTRIES])l=o[o.length+G_.PREV_X],c=o[o.length+G_.PREV_Y];else{const t=$_.binarySearch(o,s,G_.ENTRIES);l=o[t+G_.PREV_X],c=o[t+G_.PREV_Y];const e=o[t],i=this.getCurvePercent(t/G_.ENTRIES-1,1-(s-e)/(o[t+G_.PREV_TIME]-e));l+=(o[t+G_.X]-l)*i,c+=(o[t+G_.Y]-c)*i}switch(r){case vx.setup:h.x=h.data.x+l*n,h.y=h.data.y+c*n;break;case vx.first:case vx.replace:h.x+=(h.data.x+l-h.x)*n,h.y+=(h.data.y+c-h.y)*n;break;case vx.add:h.x+=l*n,h.y+=c*n}}};let z_=G_;z_.ENTRIES=3,z_.PREV_TIME=-3,z_.PREV_X=-2,z_.PREV_Y=-1,z_.X=1,z_.Y=2;let H_=class t extends z_{constructor(t){super(t)}getPropertyId(){return(2<<24)+this.boneIndex}apply(e,s,i,n,r,a,o){const h=this.frames,l=e.bones[this.boneIndex];if(i<h[0]){switch(a){case vx.setup:return l.scaleX=l.data.scaleX,void(l.scaleY=l.data.scaleY);case vx.first:l.scaleX+=(l.data.scaleX-l.scaleX)*r,l.scaleY+=(l.data.scaleY-l.scaleY)*r}return}let c=0,u=0;if(i>=h[h.length-t.ENTRIES])c=h[h.length+t.PREV_X]*l.data.scaleX,u=h[h.length+t.PREV_Y]*l.data.scaleY;else{const e=$_.binarySearch(h,i,t.ENTRIES);c=h[e+t.PREV_X],u=h[e+t.PREV_Y];const s=h[e],n=this.getCurvePercent(e/t.ENTRIES-1,1-(i-s)/(h[e+t.PREV_TIME]-s));c=(c+(h[e+t.X]-c)*n)*l.data.scaleX,u=(u+(h[e+t.Y]-u)*n)*l.data.scaleY}if(1==r)a==vx.add?(l.scaleX+=c-l.data.scaleX,l.scaleY+=u-l.data.scaleY):(l.scaleX=c,l.scaleY=u);else{let t=0,e=0;if(o==_x.mixOut)switch(a){case vx.setup:t=l.data.scaleX,e=l.data.scaleY,l.scaleX=t+(Math.abs(c)*Lx.signum(t)-t)*r,l.scaleY=e+(Math.abs(u)*Lx.signum(e)-e)*r;break;case vx.first:case vx.replace:t=l.scaleX,e=l.scaleY,l.scaleX=t+(Math.abs(c)*Lx.signum(t)-t)*r,l.scaleY=e+(Math.abs(u)*Lx.signum(e)-e)*r;break;case vx.add:t=l.scaleX,e=l.scaleY,l.scaleX=t+(Math.abs(c)*Lx.signum(t)-l.data.scaleX)*r,l.scaleY=e+(Math.abs(u)*Lx.signum(e)-l.data.scaleY)*r}else switch(a){case vx.setup:t=Math.abs(l.data.scaleX)*Lx.signum(c),e=Math.abs(l.data.scaleY)*Lx.signum(u),l.scaleX=t+(c-t)*r,l.scaleY=e+(u-e)*r;break;case vx.first:case vx.replace:t=Math.abs(l.scaleX)*Lx.signum(c),e=Math.abs(l.scaleY)*Lx.signum(u),l.scaleX=t+(c-t)*r,l.scaleY=e+(u-e)*r;break;case vx.add:t=Lx.signum(c),e=Lx.signum(u),l.scaleX=Math.abs(l.scaleX)*t+(c-Math.abs(l.data.scaleX)*t)*r,l.scaleY=Math.abs(l.scaleY)*e+(u-Math.abs(l.data.scaleY)*e)*r}}}},q_=class t extends z_{constructor(t){super(t)}getPropertyId(){return(3<<24)+this.boneIndex}apply(e,s,i,n,r,a,o){const h=this.frames,l=e.bones[this.boneIndex];if(i<h[0]){switch(a){case vx.setup:return l.shearX=l.data.shearX,void(l.shearY=l.data.shearY);case vx.first:l.shearX+=(l.data.shearX-l.shearX)*r,l.shearY+=(l.data.shearY-l.shearY)*r}return}let c=0,u=0;if(i>=h[h.length-t.ENTRIES])c=h[h.length+t.PREV_X],u=h[h.length+t.PREV_Y];else{const e=$_.binarySearch(h,i,t.ENTRIES);c=h[e+t.PREV_X],u=h[e+t.PREV_Y];const s=h[e],n=this.getCurvePercent(e/t.ENTRIES-1,1-(i-s)/(h[e+t.PREV_TIME]-s));c+=(h[e+t.X]-c)*n,u+=(h[e+t.Y]-u)*n}switch(a){case vx.setup:l.shearX=l.data.shearX+c*r,l.shearY=l.data.shearY+u*r;break;case vx.first:case vx.replace:l.shearX+=(l.data.shearX+c-l.shearX)*r,l.shearY+=(l.data.shearY+u-l.shearY)*r;break;case vx.add:l.shearX+=c*r,l.shearY+=u*r}}};const K_=class extends Y_{constructor(t){super(t),this.frames=Yx.newFloatArray(t*K_.ENTRIES)}getPropertyId(){return(5<<24)+this.slotIndex}setFrame(t,e,s,i,n,r){t*=K_.ENTRIES,this.frames[t]=e,this.frames[t+K_.R]=s,this.frames[t+K_.G]=i,this.frames[t+K_.B]=n,this.frames[t+K_.A]=r}apply(t,e,s,i,n,r,a){const o=t.slots[this.slotIndex],h=this.frames;if(s<h[0]){switch(r){case vx.setup:return void o.color.setFromColor(o.data.color);case vx.first:const t=o.color,e=o.data.color;t.add((e.r-t.r)*n,(e.g-t.g)*n,(e.b-t.b)*n,(e.a-t.a)*n)}return}let l=0,c=0,u=0,d=0;if(s>=h[h.length-K_.ENTRIES]){const t=h.length;l=h[t+K_.PREV_R],c=h[t+K_.PREV_G],u=h[t+K_.PREV_B],d=h[t+K_.PREV_A]}else{const t=$_.binarySearch(h,s,K_.ENTRIES);l=h[t+K_.PREV_R],c=h[t+K_.PREV_G],u=h[t+K_.PREV_B],d=h[t+K_.PREV_A];const e=h[t],i=this.getCurvePercent(t/K_.ENTRIES-1,1-(s-e)/(h[t+K_.PREV_TIME]-e));l+=(h[t+K_.R]-l)*i,c+=(h[t+K_.G]-c)*i,u+=(h[t+K_.B]-u)*i,d+=(h[t+K_.A]-d)*i}if(1==n)o.color.set(l,c,u,d);else{const t=o.color;r==vx.setup&&t.setFromColor(o.data.color),t.add((l-t.r)*n,(c-t.g)*n,(u-t.b)*n,(d-t.a)*n)}}};let Z_=K_;Z_.ENTRIES=5,Z_.PREV_TIME=-5,Z_.PREV_R=-4,Z_.PREV_G=-3,Z_.PREV_B=-2,Z_.PREV_A=-1,Z_.R=1,Z_.G=2,Z_.B=3,Z_.A=4;const Q_=class extends Y_{constructor(t){super(t),this.frames=Yx.newFloatArray(t*Q_.ENTRIES)}getPropertyId(){return(14<<24)+this.slotIndex}setFrame(t,e,s,i,n,r,a,o,h){t*=Q_.ENTRIES,this.frames[t]=e,this.frames[t+Q_.R]=s,this.frames[t+Q_.G]=i,this.frames[t+Q_.B]=n,this.frames[t+Q_.A]=r,this.frames[t+Q_.R2]=a,this.frames[t+Q_.G2]=o,this.frames[t+Q_.B2]=h}apply(t,e,s,i,n,r,a){const o=t.slots[this.slotIndex],h=this.frames;if(s<h[0]){switch(r){case vx.setup:return o.color.setFromColor(o.data.color),void o.darkColor.setFromColor(o.data.darkColor);case vx.first:const t=o.color,e=o.darkColor,s=o.data.color,i=o.data.darkColor;t.add((s.r-t.r)*n,(s.g-t.g)*n,(s.b-t.b)*n,(s.a-t.a)*n),e.add((i.r-e.r)*n,(i.g-e.g)*n,(i.b-e.b)*n,0)}return}let l=0,c=0,u=0,d=0,p=0,f=0,m=0;if(s>=h[h.length-Q_.ENTRIES]){const t=h.length;l=h[t+Q_.PREV_R],c=h[t+Q_.PREV_G],u=h[t+Q_.PREV_B],d=h[t+Q_.PREV_A],p=h[t+Q_.PREV_R2],f=h[t+Q_.PREV_G2],m=h[t+Q_.PREV_B2]}else{const t=$_.binarySearch(h,s,Q_.ENTRIES);l=h[t+Q_.PREV_R],c=h[t+Q_.PREV_G],u=h[t+Q_.PREV_B],d=h[t+Q_.PREV_A],p=h[t+Q_.PREV_R2],f=h[t+Q_.PREV_G2],m=h[t+Q_.PREV_B2];const e=h[t],i=this.getCurvePercent(t/Q_.ENTRIES-1,1-(s-e)/(h[t+Q_.PREV_TIME]-e));l+=(h[t+Q_.R]-l)*i,c+=(h[t+Q_.G]-c)*i,u+=(h[t+Q_.B]-u)*i,d+=(h[t+Q_.A]-d)*i,p+=(h[t+Q_.R2]-p)*i,f+=(h[t+Q_.G2]-f)*i,m+=(h[t+Q_.B2]-m)*i}if(1==n)o.color.set(l,c,u,d),o.darkColor.set(p,f,m,1);else{const t=o.color,e=o.darkColor;r==vx.setup&&(t.setFromColor(o.data.color),e.setFromColor(o.data.darkColor)),t.add((l-t.r)*n,(c-t.g)*n,(u-t.b)*n,(d-t.a)*n),e.add((p-e.r)*n,(f-e.g)*n,(m-e.b)*n,0)}}};let J_=Q_;J_.ENTRIES=8,J_.PREV_TIME=-8,J_.PREV_R=-7,J_.PREV_G=-6,J_.PREV_B=-5,J_.PREV_A=-4,J_.PREV_R2=-3,J_.PREV_G2=-2,J_.PREV_B2=-1,J_.R=1,J_.G=2,J_.B=3,J_.A=4,J_.R2=5,J_.G2=6,J_.B2=7;let tb=class{constructor(t){this.frames=Yx.newFloatArray(t),this.attachmentNames=new Array(t)}getPropertyId(){return(4<<24)+this.slotIndex}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.attachmentNames[t]=s}apply(t,e,s,i,n,r,a){const o=t.slots[this.slotIndex];if(a==_x.mixOut&&r==vx.setup){const e=o.data.attachmentName;return void o.setAttachment(null==e?null:t.getAttachment(this.slotIndex,e))}const h=this.frames;if(s<h[0]){if(r==vx.setup||r==vx.first){const e=o.data.attachmentName;o.setAttachment(null==e?null:t.getAttachment(this.slotIndex,e))}return}let l=0;l=s>=h[h.length-1]?h.length-1:$_.binarySearch(h,s,1)-1;const c=this.attachmentNames[l];t.slots[this.slotIndex].setAttachment(null==c?null:t.getAttachment(this.slotIndex,c))}},eb=null,sb=class extends Y_{constructor(t){super(t),this.frames=Yx.newFloatArray(t),this.frameVertices=new Array(t),null==eb&&(eb=Yx.newFloatArray(64))}getPropertyId(){return(6<<27)+Number(this.attachment.id)+this.slotIndex}setFrame(t,e,s){this.frames[t]=e,this.frameVertices[t]=s}apply(t,e,s,i,n,r,a){const o=t.slots[this.slotIndex],h=o.getAttachment();if(!(h instanceof I_&&h.applyDeform(this.attachment)))return;const l=o.attachmentVertices;0==l.length&&(r=vx.setup);const c=this.frameVertices,u=c[0].length,d=this.frames;if(s<d[0]){const t=h;switch(r){case vx.setup:return void(l.length=0);case vx.first:if(1==n){l.length=0;break}const e=Yx.setArraySize(l,u);if(null==t.bones){const s=t.vertices;for(let t=0;t<u;t++)e[t]+=(s[t]-e[t])*n}else{n=1-n;for(let t=0;t<u;t++)e[t]*=n}}return}const p=Yx.setArraySize(l,u);if(s>=d[d.length-1]){const t=c[d.length-1];if(1==n)if(r==vx.add){const e=h;if(null==e.bones){const s=e.vertices;for(let e=0;e<u;e++)p[e]+=t[e]-s[e]}else for(let s=0;s<u;s++)p[s]+=t[s]}else Yx.arrayCopy(t,0,p,0,u);else switch(r){case vx.setup:{const e=h;if(null==e.bones){const s=e.vertices;for(let e=0;e<u;e++){const i=s[e];p[e]=i+(t[e]-i)*n}}else for(let s=0;s<u;s++)p[s]=t[s]*n;break}case vx.first:case vx.replace:for(let s=0;s<u;s++)p[s]+=(t[s]-p[s])*n;case vx.add:const e=h;if(null==e.bones){const s=e.vertices;for(let e=0;e<u;e++)p[e]+=(t[e]-s[e])*n}else for(let s=0;s<u;s++)p[s]+=t[s]*n}return}const f=$_.binarySearch(d,s),m=c[f-1],g=c[f],y=d[f],x=this.getCurvePercent(f-1,1-(s-y)/(d[f-1]-y));if(1==n)if(r==vx.add){const t=h;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const s=m[t];p[t]+=s+(g[t]-s)*x-e[t]}}else for(let e=0;e<u;e++){const t=m[e];p[e]+=t+(g[e]-t)*x}}else for(let v=0;v<u;v++){const t=m[v];p[v]=t+(g[v]-t)*x}else switch(r){case vx.setup:{const t=h;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const s=m[t],i=e[t];p[t]=i+(s+(g[t]-s)*x-i)*n}}else for(let e=0;e<u;e++){const t=m[e];p[e]=(t+(g[e]-t)*x)*n}break}case vx.first:case vx.replace:for(let e=0;e<u;e++){const t=m[e];p[e]+=(t+(g[e]-t)*x-p[e])*n}break;case vx.add:const t=h;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const s=m[t];p[t]+=(s+(g[t]-s)*x-e[t])*n}}else for(let e=0;e<u;e++){const t=m[e];p[e]+=(t+(g[e]-t)*x)*n}}}},ib=class{constructor(t){this.frames=Yx.newFloatArray(t),this.events=new Array(t)}getPropertyId(){return 7<<24}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,s,i,n,r,a){if(null==i)return;const o=this.frames,h=this.frames.length;if(e>s)this.apply(t,e,Number.MAX_VALUE,i,n,r,a),e=-1;else if(e>=o[h-1])return;if(s<o[0])return;let l=0;if(e<o[0])l=0;else{l=$_.binarySearch(o,e);const t=o[l];for(;l>0&&o[l-1]==t;)l--}for(;l<h&&s>=o[l];l++)i.push(this.events[l])}},nb=class{constructor(t){this.frames=Yx.newFloatArray(t),this.drawOrders=new Array(t)}getPropertyId(){return 8<<24}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.drawOrders[t]=s}apply(t,e,s,i,n,r,a){const o=t.drawOrder,h=t.slots;if(a==_x.mixOut&&r==vx.setup)return void Yx.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);const l=this.frames;if(s<l[0])return void(r!=vx.setup&&r!=vx.first||Yx.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));let c=0;c=s>=l[l.length-1]?l.length-1:$_.binarySearch(l,s)-1;const u=this.drawOrders[c];if(null==u)Yx.arrayCopy(h,0,o,0,h.length);else for(let d=0,p=u.length;d<p;d++)o[d]=h[u[d]]}};const rb=class extends Y_{constructor(t){super(t),this.frames=Yx.newFloatArray(t*rb.ENTRIES)}getPropertyId(){return(9<<24)+this.ikConstraintIndex}setFrame(t,e,s,i,n,r){t*=rb.ENTRIES,this.frames[t]=e,this.frames[t+rb.MIX]=s,this.frames[t+rb.BEND_DIRECTION]=i,this.frames[t+rb.COMPRESS]=n?1:0,this.frames[t+rb.STRETCH]=r?1:0}apply(t,e,s,i,n,r,a){const o=this.frames,h=t.ikConstraints[this.ikConstraintIndex];if(s<o[0]){switch(r){case vx.setup:return h.mix=h.data.mix,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,void(h.stretch=h.data.stretch);case vx.first:h.mix+=(h.data.mix-h.mix)*n,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch}return}if(s>=o[o.length-rb.ENTRIES])return void(r==vx.setup?(h.mix=h.data.mix+(o[o.length+rb.PREV_MIX]-h.data.mix)*n,a==_x.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=o[o.length+rb.PREV_BEND_DIRECTION],h.compress=0!=o[o.length+rb.PREV_COMPRESS],h.stretch=0!=o[o.length+rb.PREV_STRETCH])):(h.mix+=(o[o.length+rb.PREV_MIX]-h.mix)*n,a==_x.mixIn&&(h.bendDirection=o[o.length+rb.PREV_BEND_DIRECTION],h.compress=0!=o[o.length+rb.PREV_COMPRESS],h.stretch=0!=o[o.length+rb.PREV_STRETCH])));const l=$_.binarySearch(o,s,rb.ENTRIES),c=o[l+rb.PREV_MIX],u=o[l],d=this.getCurvePercent(l/rb.ENTRIES-1,1-(s-u)/(o[l+rb.PREV_TIME]-u));r==vx.setup?(h.mix=h.data.mix+(c+(o[l+rb.MIX]-c)*d-h.data.mix)*n,a==_x.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=o[l+rb.PREV_BEND_DIRECTION],h.compress=0!=o[l+rb.PREV_COMPRESS],h.stretch=0!=o[l+rb.PREV_STRETCH])):(h.mix+=(c+(o[l+rb.MIX]-c)*d-h.mix)*n,a==_x.mixIn&&(h.bendDirection=o[l+rb.PREV_BEND_DIRECTION],h.compress=0!=o[l+rb.PREV_COMPRESS],h.stretch=0!=o[l+rb.PREV_STRETCH]))}};let ab=rb;ab.ENTRIES=5,ab.PREV_TIME=-5,ab.PREV_MIX=-4,ab.PREV_BEND_DIRECTION=-3,ab.PREV_COMPRESS=-2,ab.PREV_STRETCH=-1,ab.MIX=1,ab.BEND_DIRECTION=2,ab.COMPRESS=3,ab.STRETCH=4;const ob=class extends Y_{constructor(t){super(t),this.frames=Yx.newFloatArray(t*ob.ENTRIES)}getPropertyId(){return(10<<24)+this.transformConstraintIndex}setFrame(t,e,s,i,n,r){t*=ob.ENTRIES,this.frames[t]=e,this.frames[t+ob.ROTATE]=s,this.frames[t+ob.TRANSLATE]=i,this.frames[t+ob.SCALE]=n,this.frames[t+ob.SHEAR]=r}apply(t,e,s,i,n,r,a){const o=this.frames,h=t.transformConstraints[this.transformConstraintIndex];if(s<o[0]){const t=h.data;switch(r){case vx.setup:return h.rotateMix=t.rotateMix,h.translateMix=t.translateMix,h.scaleMix=t.scaleMix,void(h.shearMix=t.shearMix);case vx.first:h.rotateMix+=(t.rotateMix-h.rotateMix)*n,h.translateMix+=(t.translateMix-h.translateMix)*n,h.scaleMix+=(t.scaleMix-h.scaleMix)*n,h.shearMix+=(t.shearMix-h.shearMix)*n}return}let l=0,c=0,u=0,d=0;if(s>=o[o.length-ob.ENTRIES]){const t=o.length;l=o[t+ob.PREV_ROTATE],c=o[t+ob.PREV_TRANSLATE],u=o[t+ob.PREV_SCALE],d=o[t+ob.PREV_SHEAR]}else{const t=$_.binarySearch(o,s,ob.ENTRIES);l=o[t+ob.PREV_ROTATE],c=o[t+ob.PREV_TRANSLATE],u=o[t+ob.PREV_SCALE],d=o[t+ob.PREV_SHEAR];const e=o[t],i=this.getCurvePercent(t/ob.ENTRIES-1,1-(s-e)/(o[t+ob.PREV_TIME]-e));l+=(o[t+ob.ROTATE]-l)*i,c+=(o[t+ob.TRANSLATE]-c)*i,u+=(o[t+ob.SCALE]-u)*i,d+=(o[t+ob.SHEAR]-d)*i}if(r==vx.setup){const t=h.data;h.rotateMix=t.rotateMix+(l-t.rotateMix)*n,h.translateMix=t.translateMix+(c-t.translateMix)*n,h.scaleMix=t.scaleMix+(u-t.scaleMix)*n,h.shearMix=t.shearMix+(d-t.shearMix)*n}else h.rotateMix+=(l-h.rotateMix)*n,h.translateMix+=(c-h.translateMix)*n,h.scaleMix+=(u-h.scaleMix)*n,h.shearMix+=(d-h.shearMix)*n}};let hb=ob;hb.ENTRIES=5,hb.PREV_TIME=-5,hb.PREV_ROTATE=-4,hb.PREV_TRANSLATE=-3,hb.PREV_SCALE=-2,hb.PREV_SHEAR=-1,hb.ROTATE=1,hb.TRANSLATE=2,hb.SCALE=3,hb.SHEAR=4;const lb=class extends Y_{constructor(t){super(t),this.frames=Yx.newFloatArray(t*lb.ENTRIES)}getPropertyId(){return(11<<24)+this.pathConstraintIndex}setFrame(t,e,s){t*=lb.ENTRIES,this.frames[t]=e,this.frames[t+lb.VALUE]=s}apply(t,e,s,i,n,r,a){const o=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(s<o[0]){switch(r){case vx.setup:return void(h.position=h.data.position);case vx.first:h.position+=(h.data.position-h.position)*n}return}let l=0;if(s>=o[o.length-lb.ENTRIES])l=o[o.length+lb.PREV_VALUE];else{const t=$_.binarySearch(o,s,lb.ENTRIES);l=o[t+lb.PREV_VALUE];const e=o[t],i=this.getCurvePercent(t/lb.ENTRIES-1,1-(s-e)/(o[t+lb.PREV_TIME]-e));l+=(o[t+lb.VALUE]-l)*i}r==vx.setup?h.position=h.data.position+(l-h.data.position)*n:h.position+=(l-h.position)*n}};let cb=lb;cb.ENTRIES=2,cb.PREV_TIME=-2,cb.PREV_VALUE=-1,cb.VALUE=1;let ub=class t extends cb{constructor(t){super(t)}getPropertyId(){return(12<<24)+this.pathConstraintIndex}apply(e,s,i,n,r,a,o){const h=this.frames,l=e.pathConstraints[this.pathConstraintIndex];if(i<h[0]){switch(a){case vx.setup:return void(l.spacing=l.data.spacing);case vx.first:l.spacing+=(l.data.spacing-l.spacing)*r}return}let c=0;if(i>=h[h.length-t.ENTRIES])c=h[h.length+t.PREV_VALUE];else{const e=$_.binarySearch(h,i,t.ENTRIES);c=h[e+t.PREV_VALUE];const s=h[e],n=this.getCurvePercent(e/t.ENTRIES-1,1-(i-s)/(h[e+t.PREV_TIME]-s));c+=(h[e+t.VALUE]-c)*n}a==vx.setup?l.spacing=l.data.spacing+(c-l.data.spacing)*r:l.spacing+=(c-l.spacing)*r}};const db=class extends Y_{constructor(t){super(t),this.frames=Yx.newFloatArray(t*db.ENTRIES)}getPropertyId(){return(13<<24)+this.pathConstraintIndex}setFrame(t,e,s,i){t*=db.ENTRIES,this.frames[t]=e,this.frames[t+db.ROTATE]=s,this.frames[t+db.TRANSLATE]=i}apply(t,e,s,i,n,r,a){const o=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(s<o[0]){switch(r){case vx.setup:return h.rotateMix=h.data.rotateMix,void(h.translateMix=h.data.translateMix);case vx.first:h.rotateMix+=(h.data.rotateMix-h.rotateMix)*n,h.translateMix+=(h.data.translateMix-h.translateMix)*n}return}let l=0,c=0;if(s>=o[o.length-db.ENTRIES])l=o[o.length+db.PREV_ROTATE],c=o[o.length+db.PREV_TRANSLATE];else{const t=$_.binarySearch(o,s,db.ENTRIES);l=o[t+db.PREV_ROTATE],c=o[t+db.PREV_TRANSLATE];const e=o[t],i=this.getCurvePercent(t/db.ENTRIES-1,1-(s-e)/(o[t+db.PREV_TIME]-e));l+=(o[t+db.ROTATE]-l)*i,c+=(o[t+db.TRANSLATE]-c)*i}r==vx.setup?(h.rotateMix=h.data.rotateMix+(l-h.data.rotateMix)*n,h.translateMix=h.data.translateMix+(c-h.data.translateMix)*n):(h.rotateMix+=(l-h.rotateMix)*n,h.translateMix+=(c-h.translateMix)*n)}};let pb=db;pb.ENTRIES=3,pb.PREV_TIME=-3,pb.PREV_ROTATE=-2,pb.PREV_TRANSLATE=-1,pb.ROTATE=1,pb.TRANSLATE=2;const fb=class{constructor(t){this.tracks=new Array,this.events=new Array,this.listeners=new Array,this.queue=new vb(this),this.propertyIDs=new Dx,this.animationsChanged=!1,this.timeScale=1,this.trackEntryPool=new Wx((()=>new yb)),this.data=t}update(t){t*=this.timeScale;const e=this.tracks;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(null==i)continue;i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast;let n=t*i.timeScale;if(i.delay>0){if(i.delay-=n,i.delay>0)continue;n=-i.delay,i.delay=0}let r=i.next;if(null!=r){const e=i.trackLast-r.delay;if(e>=0){for(r.delay=0,r.trackTime=0==i.timeScale?0:(e/i.timeScale+t)*r.timeScale,i.trackTime+=n,this.setCurrent(s,r,!0);null!=r.mixingFrom;)r.mixTime+=t,r=r.mixingFrom;continue}}else if(i.trackLast>=i.trackEnd&&null==i.mixingFrom){e[s]=null,this.queue.end(i),this.disposeNext(i);continue}if(null!=i.mixingFrom&&this.updateMixingFrom(i,t)){let t=i.mixingFrom;for(i.mixingFrom=null,null!=t&&(t.mixingTo=null);null!=t;)this.queue.end(t),t=t.mixingFrom}i.trackTime+=n}this.queue.drain()}updateMixingFrom(t,e){const s=t.mixingFrom;if(null==s)return!0;const i=this.updateMixingFrom(s,e);return s.animationLast=s.nextAnimationLast,s.trackLast=s.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=s.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=s.mixingFrom,null!=s.mixingFrom&&(s.mixingFrom.mixingTo=t),t.interruptAlpha=s.interruptAlpha,this.queue.end(s)),i):(s.trackTime+=e*s.timeScale,t.mixTime+=e,!1)}apply(t){if(null==t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();const e=this.events,s=this.tracks;let i=!1;for(let n=0,r=s.length;n<r;n++){const r=s[n];if(null==r||r.delay>0)continue;i=!0;const a=0==n?vx.first:r.mixBlend;let o=r.alpha;null!=r.mixingFrom?o*=this.applyMixingFrom(r,t,a):r.trackTime>=r.trackEnd&&null==r.next&&(o=0);const h=r.animationLast,l=r.getAnimationTime(),c=r.animation.timelines.length,u=r.animation.timelines;if(0==n&&1==o||a==vx.add)for(let s=0;s<c;s++)u[s].apply(t,h,l,e,o,a,_x.mixIn);else{const s=r.timelineMode,i=0==r.timelinesRotation.length;i&&Yx.setArraySize(r.timelinesRotation,c<<1,null);const n=r.timelinesRotation;for(let r=0;r<c;r++){const c=u[r],d=s[r]==fb.SUBSEQUENT?a:vx.setup;c instanceof j_?this.applyRotateTimeline(c,t,l,o,d,n,r<<1,i):c.apply(t,h,l,e,o,d,_x.mixIn)}}this.queueEvents(r,l),e.length=0,r.nextAnimationLast=l,r.nextTrackLast=r.trackTime}return this.queue.drain(),i}applyMixingFrom(t,e,s){const i=t.mixingFrom;null!=i.mixingFrom&&this.applyMixingFrom(i,e,s);let n=0;0==t.mixDuration?(n=1,s==vx.first&&(s=vx.setup)):(n=t.mixTime/t.mixDuration,n>1&&(n=1),s!=vx.first&&(s=i.mixBlend));const r=n<i.eventThreshold?this.events:null,a=n<i.attachmentThreshold,o=n<i.drawOrderThreshold,h=i.animationLast,l=i.getAnimationTime(),c=i.animation.timelines.length,u=i.animation.timelines,d=i.alpha*t.interruptAlpha,p=d*(1-n);if(s==vx.add)for(let f=0;f<c;f++)u[f].apply(e,h,l,r,p,s,_x.mixOut);else{const t=i.timelineMode,n=i.timelineHoldMix,f=0==i.timelinesRotation.length;f&&Yx.setArraySize(i.timelinesRotation,c<<1,null);const m=i.timelinesRotation;i.totalAlpha=0;for(let g=0;g<c;g++){const c=u[g];let y,x=_x.mixOut,v=0;switch(t[g]){case fb.SUBSEQUENT:if(!a&&c instanceof tb)continue;if(!o&&c instanceof nb)continue;y=s,v=p;break;case fb.FIRST:y=vx.setup,v=p;break;case fb.HOLD:y=vx.setup,v=d;break;default:y=vx.setup;const t=n[g];v=d*Math.max(0,1-t.mixTime/t.mixDuration)}i.totalAlpha+=v,c instanceof j_?this.applyRotateTimeline(c,e,l,v,y,m,g<<1,f):(y==vx.setup&&(c instanceof tb?a&&(x=_x.mixOut):c instanceof nb&&o&&(x=_x.mixOut)),c.apply(e,h,l,r,v,y,x))}}return t.mixDuration>0&&this.queueEvents(i,l),this.events.length=0,i.nextAnimationLast=l,i.nextTrackLast=i.trackTime,n}applyRotateTimeline(t,e,s,i,n,r,a,o){if(o&&(r[a]=0),1==i)return void t.apply(e,0,s,null,1,n,_x.mixIn);const h=t,l=h.frames,c=e.bones[h.boneIndex];let u=0,d=0;if(s<l[0])switch(n){case vx.setup:c.rotation=c.data.rotation;default:return;case vx.first:u=c.rotation,d=c.data.rotation}else if(u=n==vx.setup?c.data.rotation:c.rotation,s>=l[l.length-j_.ENTRIES])d=c.data.rotation+l[l.length+j_.PREV_ROTATION];else{const t=$_.binarySearch(l,s,j_.ENTRIES),e=l[t+j_.PREV_ROTATION],i=l[t],n=h.getCurvePercent((t>>1)-1,1-(s-i)/(l[t+j_.PREV_TIME]-i));d=l[t+j_.ROTATION]-e,d-=360*(16384-(16384.499999999996-d/360|0)),d=e+d*n+c.data.rotation,d-=360*(16384-(16384.499999999996-d/360|0))}let p=0,f=d-u;if(f-=360*(16384-(16384.499999999996-f/360|0)),0==f)p=r[a];else{let t=0,e=0;o?(t=0,e=f):(t=r[a],e=r[a+1]);const s=f>0;let i=t>=0;Lx.signum(e)!=Lx.signum(f)&&Math.abs(e)<=90&&(Math.abs(t)>180&&(t+=360*Lx.signum(t)),i=s),p=f+t-t%360,i!=s&&(p+=360*Lx.signum(t)),r[a]=p}r[a+1]=f,u+=p*i,c.rotation=u-360*(16384-(16384.499999999996-u/360|0))}queueEvents(t,e){const s=t.animationStart,i=t.animationEnd,n=i-s,r=t.trackLast%n,a=this.events;let o=0;const h=a.length;for(;o<h;o++){const e=a[o];if(e.time<r)break;e.time>i||this.queue.event(t,e)}let l=!1;for(l=t.loop?0==n||r>t.trackTime%n:e>=i&&t.animationLast<i,l&&this.queue.complete(t);o<h;o++){a[o].time<s||this.queue.event(t,a[o])}}clearTracks(){const t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,s=this.tracks.length;e<s;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;const e=this.tracks[t];if(null==e)return;this.queue.end(e),this.disposeNext(e);let s=e;for(;;){const t=s.mixingFrom;if(null==t)break;this.queue.end(t),s.mixingFrom=null,s.mixingTo=null,s=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,s){const i=this.expandToIndex(t);this.tracks[t]=e,null!=i&&(s&&this.queue.interrupt(i),e.mixingFrom=i,i.mixingTo=e,e.mixTime=0,null!=i.mixingFrom&&i.mixDuration>0&&(e.interruptAlpha*=Math.min(1,i.mixTime/i.mixDuration)),i.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,s){const i=this.data.skeletonData.findAnimation(e);if(null==i)throw new Error(`Animation not found: ${e}`);return this.setAnimationWith(t,i,s)}setAnimationWith(t,e,s){if(null==e)throw new Error("animation cannot be null.");let i=!0,n=this.expandToIndex(t);null!=n&&(-1==n.nextTrackLast?(this.tracks[t]=n.mixingFrom,this.queue.interrupt(n),this.queue.end(n),this.disposeNext(n),n=n.mixingFrom,i=!1):this.disposeNext(n));const r=this.trackEntry(t,e,s,n);return this.setCurrent(t,r,i),this.queue.drain(),r}addAnimation(t,e,s,i){const n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error(`Animation not found: ${e}`);return this.addAnimationWith(t,n,s,i)}addAnimationWith(t,e,s,i){if(null==e)throw new Error("animation cannot be null.");let n=this.expandToIndex(t);if(null!=n)for(;null!=n.next;)n=n.next;const r=this.trackEntry(t,e,s,n);if(null==n)this.setCurrent(t,r,!0),this.queue.drain();else if(n.next=r,i<=0){const t=n.animationEnd-n.animationStart;0!=t?(n.loop?i+=t*(1+(n.trackTime/t|0)):i+=Math.max(t,n.trackTime),i-=this.data.getMix(n.animation,e)):i=n.trackTime}return r.delay=i,r}setEmptyAnimation(t,e){const s=this.setAnimationWith(t,fb.emptyAnimation,!1);return s.mixDuration=e,s.trackEnd=e,s}addEmptyAnimation(t,e,s){s<=0&&(s-=e);const i=this.addAnimationWith(t,fb.emptyAnimation,!1,s);return i.mixDuration=e,i.trackEnd=e,i}setEmptyAnimations(t){const e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let s=0,i=this.tracks.length;s<i;s++){const e=this.tracks[s];null!=e&&this.setEmptyAnimation(e.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(Yx.ensureArrayCapacity(this.tracks,t-this.tracks.length+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,s,i){const n=this.trackEntryPool.obtain();return n.trackIndex=t,n.animation=e,n.loop=s,n.holdPrevious=!1,n.eventThreshold=0,n.attachmentThreshold=0,n.drawOrderThreshold=0,n.animationStart=0,n.animationEnd=e.duration,n.animationLast=-1,n.nextAnimationLast=-1,n.delay=0,n.trackTime=0,n.trackLast=-1,n.nextTrackLast=-1,n.trackEnd=Number.MAX_VALUE,n.timeScale=1,n.alpha=1,n.interruptAlpha=1,n.mixTime=0,n.mixDuration=null==i?0:this.data.getMix(i.animation,e),n}disposeNext(t){let e=t.next;for(;null!=e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();for(let t=0,e=this.tracks.length;t<e;t++){let e=this.tracks[t];if(null!=e){for(;null!=e.mixingFrom;)e=e.mixingFrom;do{null!=e.mixingFrom&&e.mixBlend==vx.add||this.setTimelineModes(e),e=e.mixingTo}while(null!=e)}}}setTimelineModes(t){const e=t.mixingTo,s=t.animation.timelines,i=t.animation.timelines.length,n=Yx.setArraySize(t.timelineMode,i);t.timelineHoldMix.length=0;const r=Yx.setArraySize(t.timelineHoldMix,i),a=this.propertyIDs;if(null!=e&&e.holdPrevious)for(let o=0;o<i;o++)a.add(s[o].getPropertyId()),n[o]=fb.HOLD;else t:for(let o=0;o<i;o++){const i=s[o].getPropertyId();if(a.add(i))if(null!=e&&this.hasTimeline(e,i)){for(let s=e.mixingTo;null!=s;s=s.mixingTo)if(!this.hasTimeline(s,i)){if(t.mixDuration>0){n[o]=fb.HOLD_MIX,r[o]=s;continue t}break}n[o]=fb.HOLD}else n[o]=fb.FIRST;else n[o]=fb.SUBSEQUENT}}hasTimeline(t,e){const s=t.animation.timelines;for(let i=0,n=s.length;i<n;i++)if(s[i].getPropertyId()==e)return!0;return!1}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){const e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}setAnimationByName(t,e,s){fb.deprecatedWarning1||(fb.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")),this.setAnimation(t,e,s)}addAnimationByName(t,e,s,i){fb.deprecatedWarning2||(fb.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")),this.addAnimation(t,e,s,i)}hasAnimation(t){return null!==this.data.skeletonData.findAnimation(t)}hasAnimationByName(t){return fb.deprecatedWarning3||(fb.deprecatedWarning3=!0,console.warn("Spine Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")),this.hasAnimation(t)}};let mb=fb;mb.emptyAnimation=new $_("<empty>",[],0),mb.SUBSEQUENT=0,mb.FIRST=1,mb.HOLD=2,mb.HOLD_MIX=3,mb.deprecatedWarning1=!1,mb.deprecatedWarning2=!1,mb.deprecatedWarning3=!1;const gb=class{constructor(){this.mixBlend=vx.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){const t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}get time(){return gb.deprecatedWarning1||(gb.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime}set time(t){gb.deprecatedWarning1||(gb.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime=t}get endTime(){return gb.deprecatedWarning2||(gb.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime}set endTime(t){gb.deprecatedWarning2||(gb.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime=t}loopsCount(){return Math.floor(this.trackTime/this.trackEnd)}};let yb=gb;yb.deprecatedWarning1=!1,yb.deprecatedWarning2=!1;const xb=class{constructor(t){this.objects=[],this.drainDisabled=!1,this.animState=t}start(t){this.objects.push(_b.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(_b.interrupt),this.objects.push(t)}end(t){this.objects.push(_b.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(_b.dispose),this.objects.push(t)}complete(t){this.objects.push(_b.complete),this.objects.push(t)}event(t,e){this.objects.push(_b.event),this.objects.push(t),this.objects.push(e)}deprecateStuff(){return xb.deprecatedWarning1||(xb.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: onComplete, onStart, onEnd, onEvent art deprecated, please use listeners from now on. 'state.addListener({ complete: function(track, event) { } })'")),!0}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;const t=this.objects,e=this.animState.listeners;for(let s=0;s<t.length;s+=2){const i=t[s],n=t[s+1];switch(i){case _b.start:null!=n.listener&&n.listener.start&&n.listener.start(n);for(let t=0;t<e.length;t++)e[t].start&&e[t].start(n);n.onStart&&this.deprecateStuff()&&n.onStart(n.trackIndex),this.animState.onStart&&this.deprecateStuff()&&this.deprecateStuff&&this.animState.onStart(n.trackIndex);break;case _b.interrupt:null!=n.listener&&n.listener.interrupt&&n.listener.interrupt(n);for(let t=0;t<e.length;t++)e[t].interrupt&&e[t].interrupt(n);break;case _b.end:null!=n.listener&&n.listener.end&&n.listener.end(n);for(let t=0;t<e.length;t++)e[t].end&&e[t].end(n);n.onEnd&&this.deprecateStuff()&&n.onEnd(n.trackIndex),this.animState.onEnd&&this.deprecateStuff()&&this.animState.onEnd(n.trackIndex);case _b.dispose:null!=n.listener&&n.listener.dispose&&n.listener.dispose(n);for(let t=0;t<e.length;t++)e[t].dispose&&e[t].dispose(n);this.animState.trackEntryPool.free(n);break;case _b.complete:null!=n.listener&&n.listener.complete&&n.listener.complete(n);for(let t=0;t<e.length;t++)e[t].complete&&e[t].complete(n);const i=Lx.toInt(n.loopsCount());n.onComplete&&this.deprecateStuff()&&n.onComplete(n.trackIndex,i),this.animState.onComplete&&this.deprecateStuff()&&this.animState.onComplete(n.trackIndex,i);break;case _b.event:const r=t[2+s++];null!=n.listener&&n.listener.event&&n.listener.event(n,r);for(let t=0;t<e.length;t++)e[t].event&&e[t].event(n,r);n.onEvent&&this.deprecateStuff()&&n.onEvent(n.trackIndex,r),this.animState.onEvent&&this.deprecateStuff()&&this.animState.onEvent(n.trackIndex,r)}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}};let vb=xb;vb.deprecatedWarning1=!1;var _b=(t=>(t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event",t))(_b||{});const bb=class{constructor(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,s){const i=this.skeletonData.findAnimation(t);if(null==i)throw new Error(`Animation not found: ${t}`);const n=this.skeletonData.findAnimation(e);if(null==n)throw new Error(`Animation not found: ${e}`);this.setMixWith(i,n,s)}setMixByName(t,e,s){bb.deprecatedWarning1||(bb.deprecatedWarning1=!0,console.warn("Deprecation Warning: AnimationStateData.setMixByName is deprecated, please use setMix from now on.")),this.setMix(t,e,s)}setMixWith(t,e,s){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");const i=`${t.name}.${e.name}`;this.animationToMixTime[i]=s}getMix(t,e){const s=`${t.name}.${e.name}`,i=this.animationToMixTime[s];return void 0===i?this.defaultMix:i}};let wb=bb;wb.deprecatedWarning1=!1;let Eb=class{constructor(t){this.atlas=t}newRegionAttachment(t,e,s){const i=this.atlas.findRegion(s);if(null==i)throw new Error(`Region not found in atlas: ${s} (region attachment: ${e})`);const n=new B_(e);return n.region=i,n}newMeshAttachment(t,e,s){const i=this.atlas.findRegion(s);if(null==i)throw new Error(`Region not found in atlas: ${s} (mesh attachment: ${e})`);const n=new k_(e);return n.region=i,n}newBoundingBoxAttachment(t,e){return new P_(e)}newPathAttachment(t,e){return new D_(e)}newPointAttachment(t,e){return new F_(e)}newClippingAttachment(t,e){return new R_(e)}},Sb=class{constructor(t,e,s){if(this.matrix=new Dh,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.sorted=!1,this.active=!0,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=s,this.setToSetupPose()}get worldX(){return this.matrix.tx}get worldY(){return this.matrix.ty}update(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,s,i,n,r,a){this.ax=t,this.ay=e,this.arotation=s,this.ascaleX=i,this.ascaleY=n,this.ashearX=r,this.ashearY=a,this.appliedValid=!0;const o=this.parent,h=this.matrix,l=this.skeleton.scaleX,c=-this.skeleton.scaleY;if(null==o){const o=this.skeleton,u=s+90+a;return h.a=Lx.cosDeg(s+r)*i*l,h.c=Lx.cosDeg(u)*n*l,h.b=Lx.sinDeg(s+r)*i*c,h.d=Lx.sinDeg(u)*n*c,h.tx=t*l+o.x,void(h.ty=e*c+o.y)}let u=o.matrix.a,d=o.matrix.c,p=o.matrix.b,f=o.matrix.d;switch(h.tx=u*t+d*e+o.matrix.tx,h.ty=p*t+f*e+o.matrix.ty,this.data.transformMode){case Ex.Normal:{const t=s+90+a,e=Lx.cosDeg(s+r)*i,o=Lx.cosDeg(t)*n,l=Lx.sinDeg(s+r)*i,c=Lx.sinDeg(t)*n;return h.a=u*e+d*l,h.c=u*o+d*c,h.b=p*e+f*l,void(h.d=p*o+f*c)}case Ex.OnlyTranslation:{const t=s+90+a;h.a=Lx.cosDeg(s+r)*i,h.c=Lx.cosDeg(t)*n,h.b=Lx.sinDeg(s+r)*i,h.d=Lx.sinDeg(t)*n;break}case Ex.NoRotationOrReflection:{let t=u*u+p*p,e=0;t>1e-4?(t=Math.abs(u*f-d*p)/t,d=p*t,f=u*t,e=Math.atan2(p,u)*Lx.radDeg):(u=0,p=0,e=90-Math.atan2(f,d)*Lx.radDeg);const o=s+r-e,l=s+a-e+90,c=Lx.cosDeg(o)*i,m=Lx.cosDeg(l)*n,g=Lx.sinDeg(o)*i,y=Lx.sinDeg(l)*n;h.a=u*c-d*g,h.c=u*m-d*y,h.b=p*c+f*g,h.d=p*m+f*y;break}case Ex.NoScale:case Ex.NoScaleOrReflection:{const t=Lx.cosDeg(s),e=Lx.sinDeg(s);let o=(u*t+d*e)/l,m=(p*t+f*e)/c,g=Math.sqrt(o*o+m*m);g>1e-5&&(g=1/g),o*=g,m*=g,g=Math.sqrt(o*o+m*m),this.data.transformMode==Ex.NoScale&&u*f-d*p<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY>0)&&(g=-g);const y=Math.PI/2+Math.atan2(m,o),x=Math.cos(y)*g,v=Math.sin(y)*g,_=Lx.cosDeg(r)*i,b=Lx.cosDeg(90+a)*n,w=Lx.sinDeg(r)*i,E=Lx.sinDeg(90+a)*n;h.a=o*_+x*w,h.c=o*b+x*E,h.b=m*_+v*w,h.d=m*b+v*E;break}}h.a*=l,h.c*=l,h.b*=c,h.d*=c}setToSetupPose(){const t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.matrix.b,this.matrix.a)*Lx.radDeg}getWorldRotationY(){return Math.atan2(this.matrix.d,this.matrix.c)*Lx.radDeg}getWorldScaleX(){const t=this.matrix;return Math.sqrt(t.a*t.a+t.c*t.c)}getWorldScaleY(){const t=this.matrix;return Math.sqrt(t.b*t.b+t.d*t.d)}updateAppliedTransform(){this.appliedValid=!0;const t=this.parent,e=this.matrix;if(null==t)return this.ax=e.tx,this.ay=e.ty,this.arotation=Math.atan2(e.b,e.a)*Lx.radDeg,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*Lx.radDeg);const s=t.matrix,i=1/(s.a*s.d-s.b*s.c),n=e.tx-s.tx,r=e.ty-s.ty;this.ax=n*s.d*i-r*s.c*i,this.ay=r*s.a*i-n*s.b*i;const a=i*s.d,o=i*s.a,h=i*s.c,l=i*s.b,c=a*e.a-h*e.b,u=a*e.c-h*e.d,d=o*e.b-l*e.a,p=o*e.d-l*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(c*c+d*d),this.ascaleX>1e-4){const t=c*p-u*d;this.ascaleY=t/this.ascaleX,this.ashearY=Math.atan2(c*u+d*p,t)*Lx.radDeg,this.arotation=Math.atan2(d,c)*Lx.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(u*u+p*p),this.ashearY=0,this.arotation=90-Math.atan2(p,u)*Lx.radDeg}worldToLocal(t){const e=this.matrix,s=e.a,i=e.c,n=e.b,r=e.d,a=1/(s*r-i*n),o=t.x-e.tx,h=t.y-e.ty;return t.x=o*r*a-h*i*a,t.y=h*s*a-o*n*a,t}localToWorld(t){const e=this.matrix,s=t.x,i=t.y;return t.x=s*e.a+i*e.c+e.tx,t.y=s*e.b+i*e.d+e.ty,t}worldToLocalRotation(t){const e=Lx.sinDeg(t),s=Lx.cosDeg(t),i=this.matrix;return Math.atan2(i.a*e-i.b*s,i.d*s-i.c*e)*Lx.radDeg}localToWorldRotation(t){const e=Lx.sinDeg(t),s=Lx.cosDeg(t),i=this.matrix;return Math.atan2(s*i.b+e*i.d,s*i.a+e*i.c)*Lx.radDeg}rotateWorld(t){const e=this.matrix,s=e.a,i=e.c,n=e.b,r=e.d,a=Lx.cosDeg(t),o=Lx.sinDeg(t);e.a=a*s-o*n,e.c=a*i-o*r,e.b=o*s+a*n,e.d=o*i+a*r,this.appliedValid=!1}},Tb=class{constructor(t,e,s){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=Ex.Normal,t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=s}},Ab=class{constructor(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e}},Cb=class{constructor(t){this.name=t}},Mb=class{constructor(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let s=0;s<t.bones.length;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findBone(t.target.name)}getOrder(){return this.data.order}apply(){this.update()}update(){const t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.mix)}}apply1(t,e,s,i,n,r,a){t.appliedValid||t.updateAppliedTransform();const o=t.parent.matrix,h=1/(o.a*o.d-o.b*o.c),l=e-o.tx,c=s-o.ty,u=(l*o.d-c*o.c)*h-t.ax,d=(c*o.a-l*o.b)*h-t.ay;let p=Math.atan2(d,u)*Lx.radDeg-t.ashearX-t.arotation;t.ascaleX<0&&(p+=180),p>180?p-=360:p<-180&&(p+=360);let f=t.ascaleX,m=t.ascaleY;if(i||n){const e=t.data.length*f,s=Math.sqrt(u*u+d*d);if(i&&s<e||n&&s>e&&e>1e-4){const t=(s/e-1)*a+1;f*=t,r&&(m*=t)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+p*a,f,m,t.ashearX,t.ashearY)}apply2(t,e,s,i,n,r,a){if(0==a)return void e.updateWorldTransform();t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();const o=t.ax,h=t.ay;let l=t.ascaleX,c=l,u=t.ascaleY,d=e.ascaleX;const p=t.matrix;let f=0,m=0,g=0;l<0?(l=-l,f=180,g=-1):(f=0,g=1),u<0&&(u=-u,g=-g),d<0?(d=-d,m=180):m=0;const y=e.ax;let x=0,v=0,_=0,b=p.a,w=p.c,E=p.b,S=p.d;const T=Math.abs(l-u)<=1e-4;T?(x=e.ay,v=b*y+w*x+p.tx,_=E*y+S*x+p.ty):(x=0,v=b*y+p.tx,_=E*y+p.ty);const A=t.parent.matrix;b=A.a,w=A.c,E=A.b,S=A.d;const C=1/(b*S-w*E);let M=s-A.tx,I=i-A.ty;const P=(M*S-I*w)*C-o,R=(I*b-M*E)*C-h,k=P*P+R*R;M=v-A.tx,I=_-A.ty;const D=(M*S-I*w)*C-o,F=(I*b-M*E)*C-h,O=Math.sqrt(D*D+F*F);let N=e.data.length*d,B=0,L=0;t:if(T){N*=l;let t=(k-O*O-N*N)/(2*O*N);t<-1?t=-1:t>1&&(t=1,r&&O+N>1e-4&&(c*=(Math.sqrt(k)/(O+N)-1)*a+1)),L=Math.acos(t)*n,b=O+N*t,w=N*Math.sin(L),B=Math.atan2(R*b-P*w,P*b+R*w)}else{b=l*N,w=u*N;const t=b*b,e=w*w,s=Math.atan2(R,P);E=e*O*O+t*k-t*e;const i=-2*e*O,r=e-t;if(S=i*i-4*r*E,S>=0){let t=Math.sqrt(S);i<0&&(t=-t),t=-(i+t)/2;const e=t/r,a=E/t,o=Math.abs(e)<Math.abs(a)?e:a;if(o*o<=k){I=Math.sqrt(k-o*o)*n,B=s-Math.atan2(I,o),L=Math.atan2(I/u,(o-O)/l);break t}}let a=Lx.PI,o=O-b,h=o*o,c=0,d=0,p=O+b,f=p*p,m=0;E=-b*O/(t-e),E>=-1&&E<=1&&(E=Math.acos(E),M=b*Math.cos(E)+O,I=w*Math.sin(E),S=M*M+I*I,S<h&&(a=E,h=S,o=M,c=I),S>f&&(d=E,f=S,p=M,m=I)),k<=(h+f)/2?(B=s-Math.atan2(c*n,o),L=a*n):(B=s-Math.atan2(m*n,p),L=d*n)}const V=Math.atan2(x,y)*g;let $=t.arotation;B=(B-V)*Lx.radDeg+f-$,B>180?B-=360:B<-180&&(B+=360),t.updateWorldTransformWith(o,h,$+B*a,c,t.ascaleY,0,0),$=e.arotation,L=((L+V)*Lx.radDeg-e.ashearX)*g+m-$,L>180?L-=360:L<-180&&(L+=360),e.updateWorldTransformWith(y,x,$+L*a,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}},Ib=class{constructor(t){this.order=0,this.bones=new Array,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.name=t}},Pb=class{constructor(t){this.order=0,this.bones=new Array,this.name=t}};var Rb=(t=>(t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent",t))(Rb||{});const kb=class{constructor(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let s=0,i=t.bones.length;s<i;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}apply(){this.update()}update(){const t=this.target.getAttachment();if(!(t instanceof D_))return;const e=this.rotateMix,s=this.translateMix,i=e>0;if(!(s>0)&&!i)return;const n=this.data,r=n.spacingMode,a=r==Rb.Length,o=n.rotateMode,h=o==wx.Tangent,l=o==wx.ChainScale,c=this.bones.length,u=h?c:c+1,d=this.bones,p=Yx.setArraySize(this.spaces,u);let f=null;const m=this.spacing;if(l||a){l&&(f=Yx.setArraySize(this.lengths,c));for(let t=0,e=u-1;t<e;){const e=d[t],s=e.data.length;if(s<kb.epsilon)l&&(f[t]=0),p[++t]=0;else{const i=s*e.matrix.a,n=s*e.matrix.b,r=Math.sqrt(i*i+n*n);l&&(f[t]=r),p[++t]=(a?s+m:m)*r/s}}}else for(let b=1;b<u;b++)p[b]=m;const g=this.computeWorldPositions(t,u,h,n.positionMode==bx.Percent,r==Rb.Percent);let y=g[0],x=g[1],v=n.offsetRotation,_=!1;if(0==v)_=o==wx.Chain;else{_=!1;const t=this.target.bone.matrix;v*=t.a*t.d-t.b*t.c>0?Lx.degRad:-Lx.degRad}for(let b=0,w=3;b<c;b++,w+=3){const t=d[b],n=t.matrix;n.tx+=(y-n.tx)*s,n.ty+=(x-n.ty)*s;const r=g[w],a=g[w+1],o=r-y,c=a-x;if(l){const t=f[b];if(0!=t){const s=(Math.sqrt(o*o+c*c)/t-1)*e+1;n.a*=s,n.b*=s}}if(y=r,x=a,i){const s=n.a,i=n.c,r=n.b,a=n.d;let l=0,u=0,d=0;if(h&&(l=h?g[w-1]:0==p[b+1]?g[w+2]:Math.atan2(c,o)),l-=Math.atan2(r,s),_){u=Math.cos(l),d=Math.sin(l);const i=t.data.length;y+=(i*(u*s-d*r)-o)*e,x+=(i*(d*s+u*r)-c)*e}else l+=v;l>Lx.PI?l-=Lx.PI2:l<-Lx.PI&&(l+=Lx.PI2),l*=e,u=Math.cos(l),d=Math.sin(l),n.a=u*s-d*r,n.c=u*i-d*a,n.b=d*s+u*r,n.d=d*i+u*a}t.appliedValid=!1}}computeWorldPositions(t,e,s,i,n){const r=this.target;let a=this.position;const o=this.spaces,h=Yx.setArraySize(this.positions,3*e+2);let l=null;const c=t.closed;let u=t.worldVerticesLength,d=u/6,p=kb.NONE;if(!t.constantSpeed){const f=t.lengths;d-=c?1:2;const m=f[d];if(i&&(a*=m),n)for(let t=0;t<e;t++)o[t]*=m;l=Yx.setArraySize(this.world,8);for(let i=0,n=0,g=0;i<e;i++,n+=3){const e=o[i];a+=e;let y=a;if(c)y%=m,y<0&&(y+=m),g=0;else{if(y<0){p!=kb.BEFORE&&(p=kb.BEFORE,t.computeWorldVertices(r,2,4,l,0,2)),this.addBeforePosition(y,l,0,h,n);continue}if(y>m){p!=kb.AFTER&&(p=kb.AFTER,t.computeWorldVertices(r,u-6,4,l,0,2)),this.addAfterPosition(y-m,l,0,h,n);continue}}for(;;g++){const t=f[g];if(!(y>t)){if(0==g)y/=t;else{const e=f[g-1];y=(y-e)/(t-e)}break}}g!=p&&(p=g,c&&g==d?(t.computeWorldVertices(r,u-4,4,l,0,2),t.computeWorldVertices(r,0,4,l,4,2)):t.computeWorldVertices(r,6*g+2,8,l,0,2)),this.addCurvePosition(y,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],h,n,s||i>0&&0==e)}return h}c?(u+=2,l=Yx.setArraySize(this.world,u),t.computeWorldVertices(r,2,u-4,l,0,2),t.computeWorldVertices(r,0,2,l,u-4,2),l[u-2]=l[0],l[u-1]=l[1]):(d--,u-=4,l=Yx.setArraySize(this.world,u),t.computeWorldVertices(r,2,u,l,0,2));const f=Yx.setArraySize(this.curves,d);let m=0,g=l[0],y=l[1],x=0,v=0,_=0,b=0,w=0,E=0,S=0,T=0,A=0,C=0,M=0,I=0,P=0,R=0;for(let F=0,O=2;F<d;F++,O+=6)x=l[O],v=l[O+1],_=l[O+2],b=l[O+3],w=l[O+4],E=l[O+5],S=.1875*(g-2*x+_),T=.1875*(y-2*v+b),A=.09375*(3*(x-_)-g+w),C=.09375*(3*(v-b)-y+E),M=2*S+A,I=2*T+C,P=.75*(x-g)+S+.16666667*A,R=.75*(v-y)+T+.16666667*C,m+=Math.sqrt(P*P+R*R),P+=M,R+=I,M+=A,I+=C,m+=Math.sqrt(P*P+R*R),P+=M,R+=I,m+=Math.sqrt(P*P+R*R),P+=M+A,R+=I+C,m+=Math.sqrt(P*P+R*R),f[F]=m,g=w,y=E;if(i&&(a*=m),n)for(let F=0;F<e;F++)o[F]*=m;const k=this.segments;let D=0;for(let F=0,O=0,N=0,B=0;F<e;F++,O+=3){const t=o[F];a+=t;let e=a;if(c)e%=m,e<0&&(e+=m),N=0;else{if(e<0){this.addBeforePosition(e,l,0,h,O);continue}if(e>m){this.addAfterPosition(e-m,l,u-4,h,O);continue}}for(;;N++){const t=f[N];if(!(e>t)){if(0==N)e/=t;else{const s=f[N-1];e=(e-s)/(t-s)}break}}if(N!=p){p=N;let t=6*N;for(g=l[t],y=l[t+1],x=l[t+2],v=l[t+3],_=l[t+4],b=l[t+5],w=l[t+6],E=l[t+7],S=.03*(g-2*x+_),T=.03*(y-2*v+b),A=.006*(3*(x-_)-g+w),C=.006*(3*(v-b)-y+E),M=2*S+A,I=2*T+C,P=.3*(x-g)+S+.16666667*A,R=.3*(v-y)+T+.16666667*C,D=Math.sqrt(P*P+R*R),k[0]=D,t=1;t<8;t++)P+=M,R+=I,M+=A,I+=C,D+=Math.sqrt(P*P+R*R),k[t]=D;P+=M,R+=I,D+=Math.sqrt(P*P+R*R),k[8]=D,P+=M+A,R+=I+C,D+=Math.sqrt(P*P+R*R),k[9]=D,B=0}for(e*=D;;B++){const t=k[B];if(!(e>t)){if(0==B)e/=t;else{const s=k[B-1];e=B+(e-s)/(t-s)}break}}this.addCurvePosition(.1*e,g,y,x,v,_,b,w,E,h,O,s||F>0&&0==t)}return h}addBeforePosition(t,e,s,i,n){const r=e[s],a=e[s+1],o=e[s+2]-r,h=e[s+3]-a,l=Math.atan2(h,o);i[n]=r+t*Math.cos(l),i[n+1]=a+t*Math.sin(l),i[n+2]=l}addAfterPosition(t,e,s,i,n){const r=e[s+2],a=e[s+3],o=r-e[s],h=a-e[s+1],l=Math.atan2(h,o);i[n]=r+t*Math.cos(l),i[n+1]=a+t*Math.sin(l),i[n+2]=l}addCurvePosition(t,e,s,i,n,r,a,o,h,l,c,u){(0==t||isNaN(t))&&(t=1e-4);const d=t*t,p=d*t,f=1-t,m=f*f,g=m*f,y=f*t,x=3*y,v=f*x,_=x*t,b=e*g+i*v+r*_+o*p,w=s*g+n*v+a*_+h*p;l[c]=b,l[c+1]=w,u&&(l[c+2]=Math.atan2(w-(s*m+n*y*2+a*d),b-(e*m+i*y*2+r*d)))}getOrder(){return this.data.order}};let Db=kb;Db.NONE=-1,Db.BEFORE=-2,Db.AFTER=-3,Db.epsilon=1e-5;let Fb=class{constructor(t,e){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new jx,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array;for(let s=0;s<t.bones.length;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findBone(t.target.name)}apply(){this.update()}update(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()}applyAbsoluteWorld(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,i=this.shearMix,n=this.target,r=n.matrix,a=r.a,o=r.c,h=r.b,l=r.d,c=a*l-o*h>0?Lx.degRad:-Lx.degRad,u=this.data.offsetRotation*c,d=this.data.offsetShearY*c,p=this.bones;for(let f=0,m=p.length;f<m;f++){const r=p[f];let c=!1;const m=r.matrix;if(0!=t){const e=m.a,s=m.c,i=m.b,n=m.d;let r=Math.atan2(h,a)-Math.atan2(i,e)+u;r>Lx.PI?r-=Lx.PI2:r<-Lx.PI&&(r+=Lx.PI2),r*=t;const o=Math.cos(r),l=Math.sin(r);m.a=o*e-l*i,m.c=o*s-l*n,m.b=l*e+o*i,m.d=l*s+o*n,c=!0}if(0!=e){const t=this.temp;n.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=(t.x-m.tx)*e,m.ty+=(t.y-m.ty)*e,c=!0}if(s>0){let t=Math.sqrt(m.a*m.a+m.b*m.b),e=Math.sqrt(a*a+h*h);t>1e-5&&(t=(t+(e-t+this.data.offsetScaleX)*s)/t),m.a*=t,m.b*=t,t=Math.sqrt(m.c*m.c+m.d*m.d),e=Math.sqrt(o*o+l*l),t>1e-5&&(t=(t+(e-t+this.data.offsetScaleY)*s)/t),m.c*=t,m.d*=t,c=!0}if(i>0){const t=m.c,e=m.d,s=Math.atan2(e,t);let n=Math.atan2(l,o)-Math.atan2(h,a)-(s-Math.atan2(m.b,m.a));n>Lx.PI?n-=Lx.PI2:n<-Lx.PI&&(n+=Lx.PI2),n=s+(n+d)*i;const r=Math.sqrt(t*t+e*e);m.c=Math.cos(n)*r,m.d=Math.sin(n)*r,c=!0}c&&(r.appliedValid=!1)}}applyRelativeWorld(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,i=this.shearMix,n=this.target,r=n.matrix,a=r.a,o=r.c,h=r.b,l=r.d,c=a*l-o*h>0?Lx.degRad:-Lx.degRad,u=this.data.offsetRotation*c,d=this.data.offsetShearY*c,p=this.bones;for(let f=0,m=p.length;f<m;f++){const r=p[f];let c=!1;const m=r.matrix;if(0!=t){const e=m.a,s=m.c,i=m.b,n=m.d;let r=Math.atan2(h,a)+u;r>Lx.PI?r-=Lx.PI2:r<-Lx.PI&&(r+=Lx.PI2),r*=t;const o=Math.cos(r),l=Math.sin(r);m.a=o*e-l*i,m.c=o*s-l*n,m.b=l*e+o*i,m.d=l*s+o*n,c=!0}if(0!=e){const t=this.temp;n.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=t.x*e,m.ty+=t.y*e,c=!0}if(s>0){let t=(Math.sqrt(a*a+h*h)-1+this.data.offsetScaleX)*s+1;m.a*=t,m.b*=t,t=(Math.sqrt(o*o+l*l)-1+this.data.offsetScaleY)*s+1,m.c*=t,m.d*=t,c=!0}if(i>0){let t=Math.atan2(l,o)-Math.atan2(h,a);t>Lx.PI?t-=Lx.PI2:t<-Lx.PI&&(t+=Lx.PI2);const e=m.c,s=m.d;t=Math.atan2(s,e)+(t-Lx.PI/2+d)*i;const n=Math.sqrt(e*e+s*s);m.c=Math.cos(t)*n,m.d=Math.sin(t)*n,c=!0}c&&(r.appliedValid=!1)}}applyAbsoluteLocal(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,i=this.shearMix,n=this.target;n.appliedValid||n.updateAppliedTransform();const r=this.bones;for(let a=0,o=r.length;a<o;a++){const o=r[a];o.appliedValid||o.updateAppliedTransform();let h=o.arotation;if(0!=t){let e=n.arotation-h+this.data.offsetRotation;e-=360*(16384-(16384.499999999996-e/360|0)),h+=e*t}let l=o.ax,c=o.ay;0!=e&&(l+=(n.ax-l+this.data.offsetX)*e,c+=(n.ay-c+this.data.offsetY)*e);let u=o.ascaleX,d=o.ascaleY;s>0&&(u>1e-5&&(u=(u+(n.ascaleX-u+this.data.offsetScaleX)*s)/u),d>1e-5&&(d=(d+(n.ascaleY-d+this.data.offsetScaleY)*s)/d));const p=o.ashearY;if(i>0){let t=n.ashearY-p+this.data.offsetShearY;t-=360*(16384-(16384.499999999996-t/360|0)),o.shearY+=t*i}o.updateWorldTransformWith(l,c,h,u,d,o.ashearX,p)}}applyRelativeLocal(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,i=this.shearMix,n=this.target;n.appliedValid||n.updateAppliedTransform();const r=this.bones;for(let a=0,o=r.length;a<o;a++){const o=r[a];o.appliedValid||o.updateAppliedTransform();let h=o.arotation;0!=t&&(h+=(n.arotation+this.data.offsetRotation)*t);let l=o.ax,c=o.ay;0!=e&&(l+=(n.ax+this.data.offsetX)*e,c+=(n.ay+this.data.offsetY)*e);let u=o.ascaleX,d=o.ascaleY;s>0&&(u>1e-5&&(u*=(n.ascaleX-1+this.data.offsetScaleX)*s+1),d>1e-5&&(d*=(n.ascaleY-1+this.data.offsetScaleY)*s+1));let p=o.ashearY;i>0&&(p+=(n.ashearY+this.data.offsetShearY)*i),o.updateWorldTransformWith(l,c,h,u,d,o.ashearX,p)}}getOrder(){return this.data.order}};const Ob=class{constructor(t){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){const s=t.bones[e];let i;if(null==s.parent)i=new Sb(s,this,null);else{const t=this.bones[s.parent.index];i=new Sb(s,this,t),t.children.push(i)}this.bones.push(i)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){const s=t.slots[e],i=this.bones[s.boneData.index],n=new O_(s,i);this.slots.push(n),this.drawOrder.push(n)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){const s=t.ikConstraints[e];this.ikConstraints.push(new Mb(s,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){const s=t.transformConstraints[e];this.transformConstraints.push(new Fb(s,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){const s=t.pathConstraints[e];this.pathConstraints.push(new Db(s,this))}this.color=new Nx(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0,this.updateCacheReset.length=0;const t=this.bones;for(let h=0,l=t.length;h<l;h++)t[h].sorted=!1;const e=this.ikConstraints,s=this.transformConstraints,i=this.pathConstraints,n=e.length,r=s.length,a=i.length,o=n+r+a;t:for(let h=0;h<o;h++){for(let t=0;t<n;t++){const s=e[t];if(s.data.order==h){this.sortIkConstraint(s);continue t}}for(let t=0;t<r;t++){const e=s[t];if(e.data.order==h){this.sortTransformConstraint(e);continue t}}for(let t=0;t<a;t++){const e=i[t];if(e.data.order==h){this.sortPathConstraint(e);continue t}}}for(let h=0,l=t.length;h<l;h++)this.sortBone(t[h])}sortIkConstraint(t){const e=t.target;this.sortBone(e);const s=t.bones,i=s[0];if(this.sortBone(i),s.length>1){const t=s[s.length-1];this._updateCache.indexOf(t)>-1||this.updateCacheReset.push(t)}this._updateCache.push(t),this.sortReset(i.children),s[s.length-1].sorted=!0}sortPathConstraint(t){const e=t.target,s=e.data.index,i=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,s,i),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,s,i);for(let o=0,h=this.data.skins.length;o<h;o++)this.sortPathConstraintAttachment(this.data.skins[o],s,i);const n=e.getAttachment();n instanceof D_&&this.sortPathConstraintAttachmentWith(n,i);const r=t.bones,a=r.length;for(let o=0;o<a;o++)this.sortBone(r[o]);this._updateCache.push(t);for(let o=0;o<a;o++)this.sortReset(r[o].children);for(let o=0;o<a;o++)r[o].sorted=!0}sortTransformConstraint(t){this.sortBone(t.target);const e=t.bones,s=e.length;if(t.data.local)for(let i=0;i<s;i++){const t=e[i];this.sortBone(t.parent),this._updateCache.indexOf(t)>-1||this.updateCacheReset.push(t)}else for(let i=0;i<s;i++)this.sortBone(e[i]);this._updateCache.push(t);for(let i=0;i<s;i++)this.sortReset(e[i].children);for(let i=0;i<s;i++)e[i].sorted=!0}sortPathConstraintAttachment(t,e,s){const i=t.attachments[e];if(i)for(const n in i)this.sortPathConstraintAttachmentWith(i[n],s)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof D_))return;const s=t.bones;if(null==s)this.sortBone(e);else{const t=this.bones;let e=0;for(;e<s.length;){const i=s[e++];for(let n=e+i;e<n;e++){const i=s[e];this.sortBone(t[i])}}}}sortBone(t){if(t.sorted)return;const e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,s=t.length;e<s;e++){const s=t[e];s.sorted&&this.sortReset(s.children),s.sorted=!1}}updateWorldTransform(){const t=this.updateCacheReset;for(let s=0,i=t.length;s<i;s++){const e=t[s];e.ax=e.x,e.ay=e.y,e.arotation=e.rotation,e.ascaleX=e.scaleX,e.ascaleY=e.scaleY,e.ashearX=e.shearX,e.ashearY=e.shearY,e.appliedValid=!0}const e=this._updateCache;for(let s=0,i=e.length;s<i;s++)e[s].update()}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){const t=this.bones;for(let n=0,r=t.length;n<r;n++)t[n].setToSetupPose();const e=this.ikConstraints;for(let n=0,r=e.length;n<r;n++){const t=e[n];t.bendDirection=t.data.bendDirection,t.mix=t.data.mix}const s=this.transformConstraints;for(let n=0,r=s.length;n<r;n++){const t=s[n],e=t.data;t.rotateMix=e.rotateMix,t.translateMix=e.translateMix,t.scaleMix=e.scaleMix,t.shearMix=e.shearMix}const i=this.pathConstraints;for(let n=0,r=i.length;n<r;n++){const t=i[n],e=t.data;t.position=e.position,t.spacing=e.spacing,t.rotateMix=e.rotateMix,t.translateMix=e.translateMix}}setSlotsToSetupPose(){const t=this.slots;Yx.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,s=t.length;e<s;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.data.name==t)return i}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,i=e.length;s<i;s++)if(e[s].data.name==t)return s;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.data.name==t)return i}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,i=e.length;s<i;s++)if(e[s].data.name==t)return s;return-1}setSkinByName(t){const e=this.data.findSkin(t);if(null==e)throw new Error(`Skin not found: ${t}`);this.setSkin(e)}setSkin(t){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else{const e=this.slots;for(let s=0,i=e.length;s<i;s++){const i=e[s],n=i.data.attachmentName;if(null!=n){const e=t.getAttachment(s,n);null!=e&&i.setAttachment(e)}}}this.skin=t}getAttachmentByName(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)}getAttachment(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){const s=this.skin.getAttachment(t,e);if(null!=s)return s}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(null==t)throw new Error("slotName cannot be null.");const s=this.slots;for(let i=0,n=s.length;i<n;i++){const n=s[i];if(n.data.name==t){let s=null;if(null!=e&&(s=this.getAttachment(i,e),null==s))throw new Error(`Attachment not found: ${e}, for slot: ${t}`);return void n.setAttachment(s)}}throw new Error(`Slot not found: ${t}`)}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.data.name==t)return i}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.data.name==t)return i}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.data.name==t)return i}return null}getBounds(t,e,s){if(null==t)throw new Error("offset cannot be null.");if(null==e)throw new Error("size cannot be null.");const i=this.drawOrder;let n=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let h=0,l=i.length;h<l;h++){const t=i[h];let e=0,l=null;const c=t.getAttachment();if(c instanceof B_)e=8,l=Yx.setArraySize(s,e,0),c.computeWorldVertices(t.bone,l,0,2);else if(c instanceof k_){const i=c;e=i.worldVerticesLength,l=Yx.setArraySize(s,e,0),i.computeWorldVertices(t,0,e,l,0,2)}if(null!=l)for(let s=0,i=l.length;s<i;s+=2){const t=l[s],e=l[s+1];n=Math.min(n,t),r=Math.min(r,e),a=Math.max(a,t),o=Math.max(o,e)}}t.set(n,r),e.set(a-n,o-r)}update(t){this.time+=t}get flipX(){return-1==this.scaleX}set flipX(t){Ob.deprecatedWarning1||(Ob.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleX=t?1:-1}get flipY(){return-1==this.scaleY}set flipY(t){Ob.deprecatedWarning1||(Ob.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleY=t?1:-1}};let Nb=Ob;Nb.deprecatedWarning1=!1;let Bb=class{constructor(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,i=e.length;s<i;s++)if(e[s].name==t)return s;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,i=e.length;s<i;s++)if(e[s].name==t)return s;return-1}findSkin(t){if(null==t)throw new Error("skinName cannot be null.");const e=this.skins;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findEvent(t){if(null==t)throw new Error("eventDataName cannot be null.");const e=this.events;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findAnimation(t){if(null==t)throw new Error("animationName cannot be null.");const e=this.animations;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findPathConstraintIndex(t){if(null==t)throw new Error("pathConstraintName cannot be null.");const e=this.pathConstraints;for(let s=0,i=e.length;s<i;s++)if(e[s].name==t)return s;return-1}},Lb=class{constructor(t,e,s){if(this.color=new Nx(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");if(null==s)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=s}},Vb=class{constructor(t){if(this.order=0,this.bones=new Array,this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1,null==t)throw new Error("name cannot be null.");this.name=t}},$b=class{constructor(t){if(this.attachments=new Array,null==t)throw new Error("name cannot be null.");this.name=t}addAttachment(t,e,s){if(null==s)throw new Error("attachment cannot be null.");const i=this.attachments;t>=i.length&&(i.length=t+1),i[t]||(i[t]={}),i[t][e]=s}getAttachment(t,e){const s=this.attachments[t];return s?s[e]:null}attachAll(t,e){let s=0;for(let i=0;i<t.slots.length;i++){const n=t.slots[i],r=n.getAttachment();if(r&&s<e.attachments.length){const t=e.attachments[s];for(const e in t){if(r==t[e]){const t=this.getAttachment(s,e);null!=t&&n.setAttachment(t);break}}}s++}}},Ub=class t{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(e){const s=this.scale,i=new Bb,n="string"==typeof e?JSON.parse(e):e,r=n.skeleton;if(null!=r&&(i.hash=r.hash,i.version=r.spine,i.width=r.width,i.height=r.height,i.fps=r.fps,i.imagesPath=r.images),n.bones)for(let a=0;a<n.bones.length;a++){const e=n.bones[a];let r=null;const o=this.getValue(e,"parent",null);if(null!=o&&(r=i.findBone(o),null==r))throw new Error(`Parent bone not found: ${o}`);const h=new Tb(i.bones.length,e.name,r);h.length=this.getValue(e,"length",0)*s,h.x=this.getValue(e,"x",0)*s,h.y=this.getValue(e,"y",0)*s,h.rotation=this.getValue(e,"rotation",0),h.scaleX=this.getValue(e,"scaleX",1),h.scaleY=this.getValue(e,"scaleY",1),h.shearX=this.getValue(e,"shearX",0),h.shearY=this.getValue(e,"shearY",0),h.transformMode=t.transformModeFromString(this.getValue(e,"transform","normal")),i.bones.push(h)}if(n.slots)for(let a=0;a<n.slots.length;a++){const e=n.slots[a],s=e.name,r=e.bone,o=i.findBone(r);if(null==o)throw new Error(`Slot bone not found: ${r}`);const h=new Lb(i.slots.length,s,o),l=this.getValue(e,"color",null);null!=l&&h.color.setFromString(l);const c=this.getValue(e,"dark",null);null!=c&&(h.darkColor=new Nx(1,1,1,1),h.darkColor.setFromString(c)),h.attachmentName=this.getValue(e,"attachment",null),h.blendMode=t.blendModeFromString(this.getValue(e,"blend","normal")),i.slots.push(h)}if(n.ik)for(let t=0;t<n.ik.length;t++){const e=n.ik[t],s=new Ib(e.name);s.order=this.getValue(e,"order",0);for(let t=0;t<e.bones.length;t++){const n=e.bones[t],r=i.findBone(n);if(null==r)throw new Error(`IK bone not found: ${n}`);s.bones.push(r)}const r=e.target;if(s.target=i.findBone(r),null==s.target)throw new Error(`IK target bone not found: ${r}`);s.bendDirection=this.getValue(e,"bendPositive",!0)?1:-1,s.mix=this.getValue(e,"mix",1),i.ikConstraints.push(s)}if(n.transform)for(let t=0;t<n.transform.length;t++){const e=n.transform[t],r=new Vb(e.name);r.order=this.getValue(e,"order",0);for(let t=0;t<e.bones.length;t++){const s=e.bones[t],n=i.findBone(s);if(null==n)throw new Error(`Transform constraint bone not found: ${s}`);r.bones.push(n)}const a=e.target;if(r.target=i.findBone(a),null==r.target)throw new Error(`Transform constraint target bone not found: ${a}`);r.local=this.getValue(e,"local",!1),r.relative=this.getValue(e,"relative",!1),r.offsetRotation=this.getValue(e,"rotation",0),r.offsetX=this.getValue(e,"x",0)*s,r.offsetY=this.getValue(e,"y",0)*s,r.offsetScaleX=this.getValue(e,"scaleX",0),r.offsetScaleY=this.getValue(e,"scaleY",0),r.offsetShearY=this.getValue(e,"shearY",0),r.rotateMix=this.getValue(e,"rotateMix",1),r.translateMix=this.getValue(e,"translateMix",1),r.scaleMix=this.getValue(e,"scaleMix",1),r.shearMix=this.getValue(e,"shearMix",1),i.transformConstraints.push(r)}if(n.path)for(let a=0;a<n.path.length;a++){const e=n.path[a],r=new Pb(e.name);r.order=this.getValue(e,"order",0);for(let t=0;t<e.bones.length;t++){const s=e.bones[t],n=i.findBone(s);if(null==n)throw new Error(`Transform constraint bone not found: ${s}`);r.bones.push(n)}const o=e.target;if(r.target=i.findSlot(o),null==r.target)throw new Error(`Path target slot not found: ${o}`);r.positionMode=t.positionModeFromString(this.getValue(e,"positionMode","percent")),r.spacingMode=t.spacingModeFromString(this.getValue(e,"spacingMode","length")),r.rotateMode=t.rotateModeFromString(this.getValue(e,"rotateMode","tangent")),r.offsetRotation=this.getValue(e,"rotation",0),r.position=this.getValue(e,"position",0),r.positionMode==bx.Fixed&&(r.position*=s),r.spacing=this.getValue(e,"spacing",0),r.spacingMode!=Rb.Length&&r.spacingMode!=Rb.Fixed||(r.spacing*=s),r.rotateMix=this.getValue(e,"rotateMix",1),r.translateMix=this.getValue(e,"translateMix",1),i.pathConstraints.push(r)}if(n.skins)for(const t in n.skins){const e=n.skins[t],s=new $b(t);for(const t in e){const n=i.findSlotIndex(t);if(-1==n)throw new Error(`Slot not found: ${t}`);const r=e[t];for(const t in r){const e=this.readAttachment(r[t],s,n,t,i);null!=e&&s.addAttachment(n,t,e)}}i.skins.push(s),"default"==s.name&&(i.defaultSkin=s)}for(let t=0,a=this.linkedMeshes.length;t<a;t++){const e=this.linkedMeshes[t],s=null==e.skin?i.defaultSkin:i.findSkin(e.skin);if(null==s)throw new Error(`Skin not found: ${e.skin}`);const n=s.getAttachment(e.slotIndex,e.parent);if(null==n)throw new Error(`Parent mesh not found: ${e.parent}`);e.mesh.setParentMesh(n)}if(this.linkedMeshes.length=0,n.events)for(const t in n.events){const e=n.events[t],s=new Cb(t);s.intValue=this.getValue(e,"int",0),s.floatValue=this.getValue(e,"float",0),s.stringValue=this.getValue(e,"string",""),s.audioPath=this.getValue(e,"audio",null),null!=s.audioPath&&(s.volume=this.getValue(e,"volume",1),s.balance=this.getValue(e,"balance",0)),i.events.push(s)}if(n.animations)for(const t in n.animations){const e=n.animations[t];this.readAnimation(e,t,i)}return i}readAttachment(t,e,s,i,n){const r=this.scale;i=this.getValue(t,"name",i);switch(this.getValue(t,"type","region")){case"region":{const s=this.getValue(t,"path",i),n=this.attachmentLoader.newRegionAttachment(e,i,s);if(null==n)return null;n.path=s,n.x=this.getValue(t,"x",0)*r,n.y=this.getValue(t,"y",0)*r,n.scaleX=this.getValue(t,"scaleX",1),n.scaleY=this.getValue(t,"scaleY",1),n.rotation=this.getValue(t,"rotation",0),n.width=t.width*r,n.height=t.height*r;const a=this.getValue(t,"color",null);return null!=a&&n.color.setFromString(a),n}case"boundingbox":{const s=this.attachmentLoader.newBoundingBoxAttachment(e,i);if(null==s)return null;this.readVertices(t,s,t.vertexCount<<1);const n=this.getValue(t,"color",null);return null!=n&&s.color.setFromString(n),s}case"mesh":case"linkedmesh":{const n=this.getValue(t,"path",i),r=this.attachmentLoader.newMeshAttachment(e,i,n);if(null==r)return null;r.path=n;const a=this.getValue(t,"color",null);null!=a&&r.color.setFromString(a);const o=this.getValue(t,"parent",null);if(null!=o)return r.inheritDeform=this.getValue(t,"deform",!0),this.linkedMeshes.push(new Xb(r,this.getValue(t,"skin",null),s,o)),r;const h=t.uvs;return this.readVertices(t,r,h.length),r.triangles=t.triangles,r.regionUVs=new Float32Array(h),r.hullLength=2*this.getValue(t,"hull",0),r}case"path":{const s=this.attachmentLoader.newPathAttachment(e,i);if(null==s)return null;s.closed=this.getValue(t,"closed",!1),s.constantSpeed=this.getValue(t,"constantSpeed",!0);const n=t.vertexCount;this.readVertices(t,s,n<<1);const a=Yx.newArray(n/3,0);for(let e=0;e<t.lengths.length;e++)a[e]=t.lengths[e]*r;s.lengths=a;const o=this.getValue(t,"color",null);return null!=o&&s.color.setFromString(o),s}case"point":{const s=this.attachmentLoader.newPointAttachment(e,i);if(null==s)return null;s.x=this.getValue(t,"x",0)*r,s.y=this.getValue(t,"y",0)*r,s.rotation=this.getValue(t,"rotation",0);const n=this.getValue(t,"color",null);return null!=n&&s.color.setFromString(n),s}case"clipping":{const s=this.attachmentLoader.newClippingAttachment(e,i);if(null==s)return null;const r=this.getValue(t,"end",null);if(null!=r){const t=n.findSlot(r);if(null==t)throw new Error(`Clipping end slot not found: ${r}`);s.endSlot=t}const a=t.vertexCount;this.readVertices(t,s,a<<1);const o=this.getValue(t,"color",null);return null!=o&&s.color.setFromString(o),s}}return null}readVertices(t,e,s){const i=this.scale;e.worldVerticesLength=s;const n=t.vertices;if(s==n.length){const t=Yx.toFloatArray(n);if(1!=i)for(let e=0,s=n.length;e<s;e++)t[e]*=i;return void(e.vertices=t)}const r=new Array,a=new Array;for(let o=0,h=n.length;o<h;){const t=n[o++];a.push(t);for(let e=o+4*t;o<e;o+=4)a.push(n[o]),r.push(n[o+1]*i),r.push(n[o+2]*i),r.push(n[o+3])}e.bones=a,e.vertices=Yx.toFloatArray(r)}readAnimation(t,e,s){const i=this.scale,n=new Array;let r=0;if(t.slots)for(const o in t.slots){const e=t.slots[o],i=s.findSlotIndex(o);if(-1==i)throw new Error(`Slot not found: ${o}`);for(const t in e){const s=e[t];if("attachment"==t){const t=new tb(s.length);t.slotIndex=i;let e=0;for(let i=0;i<s.length;i++){const n=s[i];t.setFrame(e++,n.time,n.name)}n.push(t),r=Math.max(r,t.frames[t.getFrameCount()-1])}else if("color"==t){const t=new Z_(s.length);t.slotIndex=i;let e=0;for(let i=0;i<s.length;i++){const n=s[i],r=new Nx;r.setFromString(n.color||"ffffffff"),t.setFrame(e,n.time,r.r,r.g,r.b,r.a),this.readCurve(n,t,e),e++}n.push(t),r=Math.max(r,t.frames[(t.getFrameCount()-1)*Z_.ENTRIES])}else{if("twoColor"!=t)throw new Error(`Invalid timeline type for a slot: ${t} (${o})`);{const t=new J_(s.length);t.slotIndex=i;let e=0;for(let i=0;i<s.length;i++){const n=s[i],r=new Nx,a=new Nx;r.setFromString(n.light),a.setFromString(n.dark),t.setFrame(e,n.time,r.r,r.g,r.b,r.a,a.r,a.g,a.b),this.readCurve(n,t,e),e++}n.push(t),r=Math.max(r,t.frames[(t.getFrameCount()-1)*J_.ENTRIES])}}}}if(t.bones)for(const o in t.bones){const e=t.bones[o],a=s.findBoneIndex(o);if(-1==a)throw new Error(`Bone not found: ${o}`);for(const t in e){const s=e[t];if("rotate"===t){const t=new j_(s.length);t.boneIndex=a;let e=0;for(let i=0;i<s.length;i++){const n=s[i];t.setFrame(e,n.time,n.angle),this.readCurve(n,t,e),e++}n.push(t),r=Math.max(r,t.frames[(t.getFrameCount()-1)*j_.ENTRIES])}else{if("translate"!==t&&"scale"!==t&&"shear"!==t)throw new Error(`Invalid timeline type for a bone: ${t} (${o})`);{let e=null,o=1;"scale"===t?e=new H_(s.length):"shear"===t?e=new q_(s.length):(e=new z_(s.length),o=i),e.boneIndex=a;let h=0;for(let t=0;t<s.length;t++){const i=s[t],n=this.getValue(i,"x",0),r=this.getValue(i,"y",0);e.setFrame(h,i.time,n*o,r*o),this.readCurve(i,e,h),h++}n.push(e),r=Math.max(r,e.frames[(e.getFrameCount()-1)*z_.ENTRIES])}}}}if(t.ik)for(const o in t.ik){const e=t.ik[o],i=s.findIkConstraint(o),a=new ab(e.length);a.ikConstraintIndex=s.ikConstraints.indexOf(i);let h=0;for(let t=0;t<e.length;t++){const s=e[t];a.setFrame(h,s.time,this.getValue(s,"mix",1),this.getValue(s,"bendPositive",!0)?1:-1,this.getValue(s,"compress",!1),this.getValue(s,"stretch",!1)),this.readCurve(s,a,h),h++}n.push(a),r=Math.max(r,a.frames[(a.getFrameCount()-1)*ab.ENTRIES])}if(t.transform)for(const o in t.transform){const e=t.transform[o],i=s.findTransformConstraint(o),a=new hb(e.length);a.transformConstraintIndex=s.transformConstraints.indexOf(i);let h=0;for(let t=0;t<e.length;t++){const s=e[t];a.setFrame(h,s.time,this.getValue(s,"rotateMix",1),this.getValue(s,"translateMix",1),this.getValue(s,"scaleMix",1),this.getValue(s,"shearMix",1)),this.readCurve(s,a,h),h++}n.push(a),r=Math.max(r,a.frames[(a.getFrameCount()-1)*hb.ENTRIES])}if(t.paths)for(const o in t.paths){const e=t.paths[o],a=s.findPathConstraintIndex(o);if(-1==a)throw new Error(`Path constraint not found: ${o}`);const h=s.pathConstraints[a];for(const t in e){const s=e[t];if("position"===t||"spacing"===t){let e=null,o=1;"spacing"===t?(e=new ub(s.length),h.spacingMode!=Rb.Length&&h.spacingMode!=Rb.Fixed||(o=i)):(e=new cb(s.length),h.positionMode==bx.Fixed&&(o=i)),e.pathConstraintIndex=a;let l=0;for(let i=0;i<s.length;i++){const n=s[i];e.setFrame(l,n.time,this.getValue(n,t,0)*o),this.readCurve(n,e,l),l++}n.push(e),r=Math.max(r,e.frames[(e.getFrameCount()-1)*cb.ENTRIES])}else if("mix"===t){const t=new pb(s.length);t.pathConstraintIndex=a;let e=0;for(let i=0;i<s.length;i++){const n=s[i];t.setFrame(e,n.time,this.getValue(n,"rotateMix",1),this.getValue(n,"translateMix",1)),this.readCurve(n,t,e),e++}n.push(t),r=Math.max(r,t.frames[(t.getFrameCount()-1)*pb.ENTRIES])}}}if(t.deform)for(const o in t.deform){const e=t.deform[o],a=s.findSkin(o);if(null!=a)for(const t in e){const o=e[t],h=s.findSlotIndex(t);if(-1==h)throw new Error(`Slot not found: ${o.name}`);for(const t in o){const e=o[t],s=a.getAttachment(h,t);if(null==s)throw new Error(`Deform attachment not found: ${e.name}`);const l=null!=s.bones,c=s.vertices,u=l?c.length/3*2:c.length,d=new sb(e.length);d.slotIndex=h,d.attachment=s;let p=0;for(let t=0;t<e.length;t++){const s=e[t];let n;const r=this.getValue(s,"vertices",null);if(null==r)n=l?Yx.newFloatArray(u):c;else{n=Yx.newFloatArray(u);const t=this.getValue(s,"offset",0);if(Yx.arrayCopy(r,0,n,t,r.length),1!=i)for(let e=t,s=e+r.length;e<s;e++)n[e]*=i;if(!l)for(let e=0;e<u;e++)n[e]+=c[e]}d.setFrame(p,s.time,n),this.readCurve(s,d,p),p++}n.push(d),r=Math.max(r,d.frames[d.getFrameCount()-1])}}}let a=t.drawOrder;if(null==a&&(a=t.draworder),null!=a){const t=new nb(a.length),e=s.slots.length;let i=0;for(let n=0;n<a.length;n++){const r=a[n];let o=null;const h=this.getValue(r,"offsets",null);if(null!=h){o=Yx.newArray(e,-1);const t=Yx.newArray(e-h.length,0);let i=0,n=0;for(let e=0;e<h.length;e++){const r=h[e],a=s.findSlotIndex(r.slot);if(-1==a)throw new Error(`Slot not found: ${r.slot}`);for(;i!=a;)t[n++]=i++;o[i+r.offset]=i++}for(;i<e;)t[n++]=i++;for(let s=e-1;s>=0;s--)-1==o[s]&&(o[s]=t[--n])}t.setFrame(i++,r.time,o)}n.push(t),r=Math.max(r,t.frames[t.getFrameCount()-1])}if(t.events){const e=new ib(t.events.length);let i=0;for(let n=0;n<t.events.length;n++){const r=t.events[n],a=s.findEvent(r.name);if(null==a)throw new Error(`Event not found: ${r.name}`);const o=new Ab(Yx.toSinglePrecision(r.time),a);o.intValue=this.getValue(r,"int",a.intValue),o.floatValue=this.getValue(r,"float",a.floatValue),o.stringValue=this.getValue(r,"string",a.stringValue),null!=o.data.audioPath&&(o.volume=this.getValue(r,"volume",1),o.balance=this.getValue(r,"balance",0)),e.setFrame(i++,o)}n.push(e),r=Math.max(r,e.frames[e.getFrameCount()-1])}if(isNaN(r))throw new Error("Error while parsing animation, duration is NaN");s.animations.push(new $_(e,n,r))}readCurve(t,e,s){if(t.curve)if("stepped"===t.curve)e.setStepped(s);else if("[object Array]"===Object.prototype.toString.call(t.curve)){const i=t.curve;e.setCurve(s,i[0],i[1],i[2],i[3])}}getValue(t,e,s){return void 0!==t[e]?t[e]:s}static blendModeFromString(t){if("normal"==(t=t.toLowerCase()))return cr.NORMAL;if("additive"==t)return cr.ADD;if("multiply"==t)return cr.MULTIPLY;if("screen"==t)return cr.SCREEN;throw new Error(`Unknown blend mode: ${t}`)}static positionModeFromString(t){if("fixed"==(t=t.toLowerCase()))return bx.Fixed;if("percent"==t)return bx.Percent;throw new Error(`Unknown position mode: ${t}`)}static spacingModeFromString(t){if("length"==(t=t.toLowerCase()))return Rb.Length;if("fixed"==t)return Rb.Fixed;if("percent"==t)return Rb.Percent;throw new Error(`Unknown position mode: ${t}`)}static rotateModeFromString(t){if("tangent"==(t=t.toLowerCase()))return wx.Tangent;if("chain"==t)return wx.Chain;if("chainscale"==t)return wx.ChainScale;throw new Error(`Unknown rotate mode: ${t}`)}static transformModeFromString(t){if("normal"==(t=t.toLowerCase()))return Ex.Normal;if("onlytranslation"==t)return Ex.OnlyTranslation;if("norotationorreflection"==t)return Ex.NoRotationOrReflection;if("noscale"==t)return Ex.NoScale;if("noscaleorreflection"==t)return Ex.NoScaleOrReflection;throw new Error(`Unknown transform mode: ${t}`)}},Xb=class{constructor(t,e,s,i){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=i}};const Yb=Object.freeze(Object.defineProperty({__proto__:null,Animation:$_,AnimationState:mb,AnimationStateAdapter2:class{start(t){}interrupt(t){}end(t){}dispose(t){}complete(t){}event(t,e){}},AnimationStateData:wb,AtlasAttachmentLoader:Eb,Attachment:C_,AttachmentTimeline:tb,Bone:Sb,BoneData:Tb,BoundingBoxAttachment:P_,ClippingAttachment:R_,ColorTimeline:Z_,CurveTimeline:Y_,DeformTimeline:sb,DrawOrderTimeline:nb,Event:Ab,EventData:Cb,EventQueue:vb,EventTimeline:ib,EventType:_b,IkConstraint:Mb,IkConstraintData:Ib,IkConstraintTimeline:ab,JitterEffect:class{constructor(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}begin(t){}transform(t,e,s,i){t.x+=Lx.randomTriangular(-this.jitterX,this.jitterY),t.y+=Lx.randomTriangular(-this.jitterX,this.jitterY)}end(){}},MeshAttachment:k_,PathAttachment:D_,PathConstraint:Db,PathConstraintData:Pb,PathConstraintMixTimeline:pb,PathConstraintPositionTimeline:cb,PathConstraintSpacingTimeline:ub,PointAttachment:F_,RegionAttachment:B_,RotateTimeline:j_,ScaleTimeline:H_,ShearTimeline:q_,Skeleton:Nb,SkeletonBounds:class extends Gx{},SkeletonData:Bb,SkeletonJson:Ub,Skin:$b,Slot:O_,SlotData:Lb,SpacingMode:Rb,Spine:class extends Qx{createSkeleton(t){this.skeleton=new Nb(t),this.skeleton.updateWorldTransform(),this.stateData=new wb(t),this.state=new mb(this.stateData)}},SwirlEffect:V_,TimelineType:U_,TrackEntry:yb,TransformConstraint:Fb,TransformConstraintData:Vb,TransformConstraintTimeline:hb,TranslateTimeline:z_,TwoColorTimeline:J_,VertexAttachment:I_},Symbol.toStringTag,{value:"Module"}));class Wb{constructor(t){if(!t)throw new Error("name cannot be null.");this.name=t}}const jb=class extends Wb{constructor(t){super(t),this.id=jb.nextID++,this.bones=null,this.vertices=[],this.worldVerticesLength=0,this.timelineAttachment=this}computeWorldVerticesOld(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)}computeWorldVertices(t,e,s,i,n,r){s=n+(s>>1)*r;const a=t.bone.skeleton,o=t.deform;let h=this.vertices;const l=this.bones;if(!l){o.length>0&&(h=o);const a=t.bone.matrix,l=a.tx,c=a.ty,u=a.a,d=a.c,p=a.b,f=a.d;for(let t=e,o=n;o<s;t+=2,o+=r){const e=h[t],s=h[t+1];i[o]=e*u+s*d+l,i[o+1]=e*p+s*f+c}return}let c=0,u=0;for(let p=0;p<e;p+=2){const t=l[c];c+=t+1,u+=t}const d=a.bones;if(0==o.length)for(let p=n,f=3*u;p<s;p+=r){let t=0,e=0,s=l[c++];for(s+=c;c<s;c++,f+=3){const s=d[l[c]].matrix,i=h[f],n=h[f+1],r=h[f+2];t+=(i*s.a+n*s.c+s.tx)*r,e+=(i*s.b+n*s.d+s.ty)*r}i[p]=t,i[p+1]=e}else{const t=o;for(let e=n,a=3*u,o=u<<1;e<s;e+=r){let s=0,n=0,r=l[c++];for(r+=c;c<r;c++,a+=3,o+=2){const e=d[l[c]].matrix,i=h[a]+t[o],r=h[a+1]+t[o+1],u=h[a+2];s+=(i*e.a+r*e.c+e.tx)*u,n+=(i*e.b+r*e.d+e.ty)*u}i[e]=s,i[e+1]=n}}}copyTo(t){this.bones?(t.bones=new Array(this.bones.length),Yx.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,this.vertices&&(t.vertices=Yx.newFloatArray(this.vertices.length),Yx.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)),t.worldVerticesLength=this.worldVerticesLength,t.timelineAttachment=this.timelineAttachment}};let Gb=jb;Gb.nextID=0;class zb extends Gb{constructor(t){super(t),this.type=yx.BoundingBox,this.color=new Nx(1,1,1,1)}copy(){const t=new zb(this.name);return this.copyTo(t),t.color.setFromColor(this.color),t}}class Hb extends Gb{constructor(t){super(t),this.type=yx.Clipping,this.endSlot=null,this.color=new Nx(.2275,.2275,.8078,1)}copy(){const t=new Hb(this.name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t}}class qb extends Gb{constructor(t,e){super(t),this.type=yx.Mesh,this.region=null,this.triangles=[],this.color=new Nx(1,1,1,1),this.width=0,this.height=0,this.hullLength=0,this.edges=[],this.parentMesh=null,this.sequence=null,this.tempColor=new Nx(0,0,0,0),this.path=e}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}copy(){if(this.parentMesh)return this.newLinkedMesh();const t=new qb(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Float32Array(this.regionUVs.length),Yx.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.triangles=new Array(this.triangles.length),Yx.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,t.sequence=null!=this.sequence?this.sequence.copy():null,this.edges&&(t.edges=new Array(this.edges.length),Yx.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t}computeWorldVertices(t,e,s,i,n,r){null!=this.sequence&&this.sequence.apply(t,this),super.computeWorldVertices(t,e,s,i,n,r)}newLinkedMesh(){const t=new qb(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),t.timelineAttachment=this.timelineAttachment,t.setParentMesh(this.parentMesh?this.parentMesh:this),t}}class Kb extends Gb{constructor(t){super(t),this.type=yx.Path,this.lengths=[],this.closed=!1,this.constantSpeed=!1,this.color=new Nx(1,1,1,1)}copy(){const t=new Kb(this.name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),Yx.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t}}class Zb extends Gb{constructor(t){super(t),this.type=yx.Point,this.x=0,this.y=0,this.rotation=0,this.color=new Nx(.38,.94,0,1)}computeWorldPosition(t,e){const s=t.matrix;return e.x=this.x*s.a+this.y*s.c+t.worldX,e.y=this.x*s.b+this.y*s.d+t.worldY,e}computeWorldRotation(t){const e=t.matrix,s=Lx.cosDeg(this.rotation),i=Lx.sinDeg(this.rotation),n=s*e.a+i*e.c,r=s*e.b+i*e.d;return Math.atan2(r,n)*Lx.radDeg}copy(){const t=new Zb(this.name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t}}const Qb=class extends Wb{constructor(t,e){super(t),this.type=yx.Region,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new Nx(1,1,1,1),this.rendererObject=null,this.region=null,this.sequence=null,this.offset=Yx.newFloatArray(8),this.uvs=Yx.newFloatArray(8),this.tempColor=new Nx(1,1,1,1),this.path=e}updateRegion(){if(!this.region)throw new Error("Region not set.");const t=this.region,e=this.width/this.region.originalWidth*this.scaleX,s=this.height/this.region.originalHeight*this.scaleY,i=-this.width/2*this.scaleX+this.region.offsetX*e,n=-this.height/2*this.scaleY+this.region.offsetY*s,r=i+this.region.width*e,a=n+this.region.height*s,o=this.rotation*Math.PI/180,h=Math.cos(o),l=Math.sin(o),c=this.x,u=this.y,d=i*h+c,p=i*l,f=n*h+u,m=n*l,g=r*h+c,y=r*l,x=a*h+u,v=a*l,_=this.offset;_[0]=d-m,_[1]=f+p,_[2]=d-v,_[3]=x+p,_[4]=g-v,_[5]=x+y,_[6]=g-m,_[7]=f+y;const b=this.uvs;90==t.degrees?(b[2]=t.u,b[3]=t.v2,b[4]=t.u,b[5]=t.v,b[6]=t.u2,b[7]=t.v,b[0]=t.u2,b[1]=t.v2):(b[0]=t.u,b[1]=t.v2,b[2]=t.u,b[3]=t.v,b[4]=t.u2,b[5]=t.v,b[6]=t.u2,b[7]=t.v2)}computeWorldVertices(t,e,s,i){null!=this.sequence&&this.sequence.apply(t,this);const n=t.bone,r=this.offset,a=n.matrix,o=a.tx,h=a.ty,l=a.a,c=a.c,u=a.b,d=a.d;let p=0,f=0;p=r[0],f=r[1],e[s]=p*l+f*c+o,e[s+1]=p*u+f*d+h,s+=i,p=r[2],f=r[3],e[s]=p*l+f*c+o,e[s+1]=p*u+f*d+h,s+=i,p=r[4],f=r[5],e[s]=p*l+f*c+o,e[s+1]=p*u+f*d+h,s+=i,p=r[6],f=r[7],e[s]=p*l+f*c+o,e[s+1]=p*u+f*d+h}copy(){const t=new Qb(this.name,this.path);return t.region=this.region,t.rendererObject=this.rendererObject,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,Yx.arrayCopy(this.uvs,0,t.uvs,0,8),Yx.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t.sequence=null!=this.sequence?this.sequence.copy():null,t}};let Jb=Qb;Jb.X1=0,Jb.Y1=1,Jb.C1R=2,Jb.C1G=3,Jb.C1B=4,Jb.C1A=5,Jb.U1=6,Jb.V1=7,Jb.X2=8,Jb.Y2=9,Jb.C2R=10,Jb.C2G=11,Jb.C2B=12,Jb.C2A=13,Jb.U2=14,Jb.V2=15,Jb.X3=16,Jb.Y3=17,Jb.C3R=18,Jb.C3G=19,Jb.C3B=20,Jb.C3A=21,Jb.U3=22,Jb.V3=23,Jb.X4=24,Jb.Y4=25,Jb.C4R=26,Jb.C4G=27,Jb.C4B=28,Jb.C4A=29,Jb.U4=30,Jb.V4=31;const tw=class{constructor(t){this.id=tw.nextID(),this.start=0,this.digits=0,this.setupIndex=0,this.regions=new Array(t)}copy(){const t=new tw(this.regions.length);return Yx.arrayCopy(this.regions,0,t.regions,0,this.regions.length),t.start=this.start,t.digits=this.digits,t.setupIndex=this.setupIndex,t}apply(t,e){let s=t.sequenceIndex;-1==s&&(s=this.setupIndex),s>=this.regions.length&&(s=this.regions.length-1);const i=this.regions[s];e.region!=i&&(e.region=i)}getPath(t,e){let s=t;const i=(this.start+e).toString();for(let n=this.digits-i.length;n>0;n--)s+="0";return s+=i,s}static nextID(){return tw._nextID++}};let ew=tw;ew._nextID=0;var sw=(t=>(t[t.hold=0]="hold",t[t.once=1]="once",t[t.loop=2]="loop",t[t.pingpong=3]="pingpong",t[t.onceReverse=4]="onceReverse",t[t.loopReverse=5]="loopReverse",t[t.pingpongReverse=6]="pingpongReverse",t))(sw||{});const iw=[0,1,2,3,4,5,6];class nw{constructor(t,e,s){if(this.timelines=[],this.timelineIds=new Fx,!t)throw new Error("name cannot be null.");this.name=t,this.setTimelines(e),this.duration=s}setTimelines(t){if(!t)throw new Error("timelines cannot be null.");this.timelines=t,this.timelineIds.clear();for(let e=0;e<t.length;e++)this.timelineIds.addAll(t[e].getPropertyIds())}hasTimeline(t){for(let e=0;e<t.length;e++)if(this.timelineIds.contains(t[e]))return!0;return!1}apply(t,e,s,i,n,r,a,o){if(!t)throw new Error("skeleton cannot be null.");i&&0!=this.duration&&(s%=this.duration,e>0&&(e%=this.duration));const h=this.timelines;for(let l=0,c=h.length;l<c;l++)h[l].apply(t,e,s,n,r,a,o)}}const rw=0,aw=1,ow=2,hw=3,lw=4,cw=5,uw=6,dw=7,pw=8,fw=9,mw=10,gw=11,yw=12,xw=13,vw=14,_w=15,bw=16,ww=17,Ew=18,Sw=19;class Tw{constructor(t,e){this.propertyIds=e,this.frames=Yx.newFloatArray(t*this.getFrameEntries())}getPropertyIds(){return this.propertyIds}getFrameEntries(){return 1}getFrameCount(){return this.frames.length/this.getFrameEntries()}getDuration(){return this.frames[this.frames.length-this.getFrameEntries()]}static search1(t,e){const s=t.length;for(let i=1;i<s;i++)if(t[i]>e)return i-1;return s-1}static search(t,e,s){const i=t.length;for(let n=s;n<i;n+=s)if(t[n]>e)return n-s;return i-s}}class Aw extends Tw{constructor(t,e,s){super(t,s),this.curves=Yx.newFloatArray(t+18*e),this.curves[t-1]=1}setLinear(t){this.curves[t]=0}setStepped(t){this.curves[t]=1}shrink(t){const e=this.getFrameCount()+18*t;if(this.curves.length>e){const t=Yx.newFloatArray(e);Yx.arrayCopy(this.curves,0,t,0,e),this.curves=t}}setBezier(t,e,s,i,n,r,a,o,h,l,c){const u=this.curves;let d=this.getFrameCount()+18*t;0==s&&(u[e]=2+d);const p=.03*(i-2*r+o),f=.03*(n-2*a+h),m=.006*(3*(r-o)-i+l),g=.006*(3*(a-h)-n+c);let y=2*p+m,x=2*f+g,v=.3*(r-i)+p+.16666667*m,_=.3*(a-n)+f+.16666667*g,b=i+v,w=n+_;for(let E=d+18;d<E;d+=2)u[d]=b,u[d+1]=w,v+=y,_+=x,y+=m,x+=g,b+=v,w+=_}getBezierValue(t,e,s,i){const n=this.curves;if(n[i]>t){const r=this.frames[e],a=this.frames[e+s];return a+(t-r)/(n[i]-r)*(n[i+1]-a)}const r=i+18;for(i+=2;i<r;i+=2)if(n[i]>=t){const e=n[i-2],s=n[i-1];return s+(t-e)/(n[i]-e)*(n[i+1]-s)}e+=this.getFrameEntries();const a=n[r-2],o=n[r-1];return o+(t-a)/(this.frames[e]-a)*(this.frames[e+s]-o)}}class Cw extends Aw{constructor(t,e,s){super(t,e,[s])}getFrameEntries(){return 2}setFrame(t,e,s){t<<=1,this.frames[t]=e,this.frames[t+1]=s}getCurveValue(t){const e=this.frames;let s=e.length-2;for(let n=2;n<=s;n+=2)if(e[n]>t){s=n-2;break}const i=this.curves[s>>1];switch(i){case 0:const i=e[s],n=e[s+1];return n+(t-i)/(e[s+2]-i)*(e[s+2+1]-n);case 1:return e[s+1]}return this.getBezierValue(t,s,1,i-2)}}class Mw extends Aw{constructor(t,e,s,i){super(t,e,[s,i])}getFrameEntries(){return 3}setFrame(t,e,s,i){t*=3,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=i}}class Iw extends Cw{constructor(t,e,s){super(t,e,`${rw}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,i,n,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(r){case vx.setup:return void(o.rotation=o.data.rotation);case vx.first:o.rotation+=(o.data.rotation-o.rotation)*n}return}let h=this.getCurveValue(s);switch(r){case vx.setup:o.rotation=o.data.rotation+h*n;break;case vx.first:case vx.replace:h+=o.data.rotation-o.rotation;case vx.add:o.rotation+=h*n}}}class Pw extends Mw{constructor(t,e,s){super(t,e,`${aw}|${s}`,`${ow}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,i,n,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;const h=this.frames;if(s<h[0]){switch(r){case vx.setup:return o.x=o.data.x,void(o.y=o.data.y);case vx.first:o.x+=(o.data.x-o.x)*n,o.y+=(o.data.y-o.y)*n}return}let l=0,c=0;const u=Tw.search(h,s,3),d=this.curves[u/3];switch(d){case 0:const t=h[u];l=h[u+1],c=h[u+2];const e=(s-t)/(h[u+3]-t);l+=(h[u+3+1]-l)*e,c+=(h[u+3+2]-c)*e;break;case 1:l=h[u+1],c=h[u+2];break;default:l=this.getBezierValue(s,u,1,d-2),c=this.getBezierValue(s,u,2,d+18-2)}switch(r){case vx.setup:o.x=o.data.x+l*n,o.y=o.data.y+c*n;break;case vx.first:case vx.replace:o.x+=(o.data.x+l-o.x)*n,o.y+=(o.data.y+c-o.y)*n;break;case vx.add:o.x+=l*n,o.y+=c*n}}}class Rw extends Cw{constructor(t,e,s){super(t,e,`${aw}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,i,n,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(r){case vx.setup:return void(o.x=o.data.x);case vx.first:o.x+=(o.data.x-o.x)*n}return}const h=this.getCurveValue(s);switch(r){case vx.setup:o.x=o.data.x+h*n;break;case vx.first:case vx.replace:o.x+=(o.data.x+h-o.x)*n;break;case vx.add:o.x+=h*n}}}class kw extends Cw{constructor(t,e,s){super(t,e,`${ow}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,i,n,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(r){case vx.setup:return void(o.y=o.data.y);case vx.first:o.y+=(o.data.y-o.y)*n}return}const h=this.getCurveValue(s);switch(r){case vx.setup:o.y=o.data.y+h*n;break;case vx.first:case vx.replace:o.y+=(o.data.y+h-o.y)*n;break;case vx.add:o.y+=h*n}}}class Dw extends Mw{constructor(t,e,s){super(t,e,`${hw}|${s}`,`${lw}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,i,n,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;const h=this.frames;if(s<h[0]){switch(r){case vx.setup:return o.scaleX=o.data.scaleX,void(o.scaleY=o.data.scaleY);case vx.first:o.scaleX+=(o.data.scaleX-o.scaleX)*n,o.scaleY+=(o.data.scaleY-o.scaleY)*n}return}let l,c;const u=Tw.search(h,s,3),d=this.curves[u/3];switch(d){case 0:const t=h[u];l=h[u+1],c=h[u+2];const e=(s-t)/(h[u+3]-t);l+=(h[u+3+1]-l)*e,c+=(h[u+3+2]-c)*e;break;case 1:l=h[u+1],c=h[u+2];break;default:l=this.getBezierValue(s,u,1,d-2),c=this.getBezierValue(s,u,2,d+18-2)}if(l*=o.data.scaleX,c*=o.data.scaleY,1==n)r==vx.add?(o.scaleX+=l-o.data.scaleX,o.scaleY+=c-o.data.scaleY):(o.scaleX=l,o.scaleY=c);else{let t=0,e=0;if(a==_x.mixOut)switch(r){case vx.setup:t=o.data.scaleX,e=o.data.scaleY,o.scaleX=t+(Math.abs(l)*Lx.signum(t)-t)*n,o.scaleY=e+(Math.abs(c)*Lx.signum(e)-e)*n;break;case vx.first:case vx.replace:t=o.scaleX,e=o.scaleY,o.scaleX=t+(Math.abs(l)*Lx.signum(t)-t)*n,o.scaleY=e+(Math.abs(c)*Lx.signum(e)-e)*n;break;case vx.add:o.scaleX+=(l-o.data.scaleX)*n,o.scaleY+=(c-o.data.scaleY)*n}else switch(r){case vx.setup:t=Math.abs(o.data.scaleX)*Lx.signum(l),e=Math.abs(o.data.scaleY)*Lx.signum(c),o.scaleX=t+(l-t)*n,o.scaleY=e+(c-e)*n;break;case vx.first:case vx.replace:t=Math.abs(o.scaleX)*Lx.signum(l),e=Math.abs(o.scaleY)*Lx.signum(c),o.scaleX=t+(l-t)*n,o.scaleY=e+(c-e)*n;break;case vx.add:o.scaleX+=(l-o.data.scaleX)*n,o.scaleY+=(c-o.data.scaleY)*n}}}}class Fw extends Cw{constructor(t,e,s){super(t,e,`${hw}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,i,n,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(r){case vx.setup:return void(o.scaleX=o.data.scaleX);case vx.first:o.scaleX+=(o.data.scaleX-o.scaleX)*n}return}const h=this.getCurveValue(s)*o.data.scaleX;if(1==n)r==vx.add?o.scaleX+=h-o.data.scaleX:o.scaleX=h;else{let t=0;if(a==_x.mixOut)switch(r){case vx.setup:t=o.data.scaleX,o.scaleX=t+(Math.abs(h)*Lx.signum(t)-t)*n;break;case vx.first:case vx.replace:t=o.scaleX,o.scaleX=t+(Math.abs(h)*Lx.signum(t)-t)*n;break;case vx.add:o.scaleX+=(h-o.data.scaleX)*n}else switch(r){case vx.setup:t=Math.abs(o.data.scaleX)*Lx.signum(h),o.scaleX=t+(h-t)*n;break;case vx.first:case vx.replace:t=Math.abs(o.scaleX)*Lx.signum(h),o.scaleX=t+(h-t)*n;break;case vx.add:o.scaleX+=(h-o.data.scaleX)*n}}}}class Ow extends Cw{constructor(t,e,s){super(t,e,`${lw}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,i,n,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(r){case vx.setup:return void(o.scaleY=o.data.scaleY);case vx.first:o.scaleY+=(o.data.scaleY-o.scaleY)*n}return}const h=this.getCurveValue(s)*o.data.scaleY;if(1==n)r==vx.add?o.scaleY+=h-o.data.scaleY:o.scaleY=h;else{let t=0;if(a==_x.mixOut)switch(r){case vx.setup:t=o.data.scaleY,o.scaleY=t+(Math.abs(h)*Lx.signum(t)-t)*n;break;case vx.first:case vx.replace:t=o.scaleY,o.scaleY=t+(Math.abs(h)*Lx.signum(t)-t)*n;break;case vx.add:o.scaleY+=(h-o.data.scaleY)*n}else switch(r){case vx.setup:t=Math.abs(o.data.scaleY)*Lx.signum(h),o.scaleY=t+(h-t)*n;break;case vx.first:case vx.replace:t=Math.abs(o.scaleY)*Lx.signum(h),o.scaleY=t+(h-t)*n;break;case vx.add:o.scaleY+=(h-o.data.scaleY)*n}}}}class Nw extends Mw{constructor(t,e,s){super(t,e,`${cw}|${s}`,`${uw}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,i,n,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;const h=this.frames;if(s<h[0]){switch(r){case vx.setup:return o.shearX=o.data.shearX,void(o.shearY=o.data.shearY);case vx.first:o.shearX+=(o.data.shearX-o.shearX)*n,o.shearY+=(o.data.shearY-o.shearY)*n}return}let l=0,c=0;const u=Tw.search(h,s,3),d=this.curves[u/3];switch(d){case 0:const t=h[u];l=h[u+1],c=h[u+2];const e=(s-t)/(h[u+3]-t);l+=(h[u+3+1]-l)*e,c+=(h[u+3+2]-c)*e;break;case 1:l=h[u+1],c=h[u+2];break;default:l=this.getBezierValue(s,u,1,d-2),c=this.getBezierValue(s,u,2,d+18-2)}switch(r){case vx.setup:o.shearX=o.data.shearX+l*n,o.shearY=o.data.shearY+c*n;break;case vx.first:case vx.replace:o.shearX+=(o.data.shearX+l-o.shearX)*n,o.shearY+=(o.data.shearY+c-o.shearY)*n;break;case vx.add:o.shearX+=l*n,o.shearY+=c*n}}}class Bw extends Cw{constructor(t,e,s){super(t,e,`${cw}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,i,n,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(r){case vx.setup:return void(o.shearX=o.data.shearX);case vx.first:o.shearX+=(o.data.shearX-o.shearX)*n}return}const h=this.getCurveValue(s);switch(r){case vx.setup:o.shearX=o.data.shearX+h*n;break;case vx.first:case vx.replace:o.shearX+=(o.data.shearX+h-o.shearX)*n;break;case vx.add:o.shearX+=h*n}}}class Lw extends Cw{constructor(t,e,s){super(t,e,`${uw}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,i,n,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(r){case vx.setup:return void(o.shearY=o.data.shearY);case vx.first:o.shearY+=(o.data.shearY-o.shearY)*n}return}const h=this.getCurveValue(s);switch(r){case vx.setup:o.shearY=o.data.shearY+h*n;break;case vx.first:case vx.replace:o.shearY+=(o.data.shearY+h-o.shearY)*n;break;case vx.add:o.shearY+=h*n}}}class Vw extends Aw{constructor(t,e,s){super(t,e,[`${dw}|${s}`,`${pw}|${s}`]),this.slotIndex=0,this.slotIndex=s}getFrameEntries(){return 5}setFrame(t,e,s,i,n,r){t*=5,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=i,this.frames[t+3]=n,this.frames[t+4]=r}apply(t,e,s,i,n,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=this.frames,l=o.color;if(s<h[0]){const t=o.data.color;switch(r){case vx.setup:return void l.setFromColor(t);case vx.first:l.add((t.r-l.r)*n,(t.g-l.g)*n,(t.b-l.b)*n,(t.a-l.a)*n)}return}let c=0,u=0,d=0,p=0;const f=Tw.search(h,s,5),m=this.curves[f/5];switch(m){case 0:const t=h[f];c=h[f+1],u=h[f+2],d=h[f+3],p=h[f+4];const e=(s-t)/(h[f+5]-t);c+=(h[f+5+1]-c)*e,u+=(h[f+5+2]-u)*e,d+=(h[f+5+3]-d)*e,p+=(h[f+5+4]-p)*e;break;case 1:c=h[f+1],u=h[f+2],d=h[f+3],p=h[f+4];break;default:c=this.getBezierValue(s,f,1,m-2),u=this.getBezierValue(s,f,2,m+18-2),d=this.getBezierValue(s,f,3,m+36-2),p=this.getBezierValue(s,f,4,m+54-2)}1==n?l.set(c,u,d,p):(r==vx.setup&&l.setFromColor(o.data.color),l.add((c-l.r)*n,(u-l.g)*n,(d-l.b)*n,(p-l.a)*n))}}class $w extends Aw{constructor(t,e,s){super(t,e,[`${dw}|${s}`]),this.slotIndex=0,this.slotIndex=s}getFrameEntries(){return 4}setFrame(t,e,s,i,n){t<<=2,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=i,this.frames[t+3]=n}apply(t,e,s,i,n,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=this.frames,l=o.color;if(s<h[0]){const t=o.data.color;switch(r){case vx.setup:return l.r=t.r,l.g=t.g,void(l.b=t.b);case vx.first:l.r+=(t.r-l.r)*n,l.g+=(t.g-l.g)*n,l.b+=(t.b-l.b)*n}return}let c=0,u=0,d=0;const p=Tw.search(h,s,4),f=this.curves[p>>2];switch(f){case 0:const t=h[p];c=h[p+1],u=h[p+2],d=h[p+3];const e=(s-t)/(h[p+4]-t);c+=(h[p+4+1]-c)*e,u+=(h[p+4+2]-u)*e,d+=(h[p+4+3]-d)*e;break;case 1:c=h[p+1],u=h[p+2],d=h[p+3];break;default:c=this.getBezierValue(s,p,1,f-2),u=this.getBezierValue(s,p,2,f+18-2),d=this.getBezierValue(s,p,3,f+36-2)}if(1==n)l.r=c,l.g=u,l.b=d;else{if(r==vx.setup){const t=o.data.color;l.r=t.r,l.g=t.g,l.b=t.b}l.r+=(c-l.r)*n,l.g+=(u-l.g)*n,l.b+=(d-l.b)*n}}}class Uw extends Cw{constructor(t,e,s){super(t,e,`${pw}|${s}`),this.slotIndex=0,this.slotIndex=s}apply(t,e,s,i,n,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=o.color;if(s<this.frames[0]){const t=o.data.color;switch(r){case vx.setup:return void(h.a=t.a);case vx.first:h.a+=(t.a-h.a)*n}return}const l=this.getCurveValue(s);1==n?h.a=l:(r==vx.setup&&(h.a=o.data.color.a),h.a+=(l-h.a)*n)}}class Xw extends Aw{constructor(t,e,s){super(t,e,[`${dw}|${s}`,`${pw}|${s}`,`${fw}|${s}`]),this.slotIndex=0,this.slotIndex=s}getFrameEntries(){return 8}setFrame(t,e,s,i,n,r,a,o,h){t<<=3,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=i,this.frames[t+3]=n,this.frames[t+4]=r,this.frames[t+5]=a,this.frames[t+6]=o,this.frames[t+7]=h}apply(t,e,s,i,n,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=this.frames,l=o.color,c=o.darkColor;if(s<h[0]){const t=o.data.color,e=o.data.darkColor;switch(r){case vx.setup:return l.setFromColor(t),c.r=e.r,c.g=e.g,void(c.b=e.b);case vx.first:l.add((t.r-l.r)*n,(t.g-l.g)*n,(t.b-l.b)*n,(t.a-l.a)*n),c.r+=(e.r-c.r)*n,c.g+=(e.g-c.g)*n,c.b+=(e.b-c.b)*n}return}let u=0,d=0,p=0,f=0,m=0,g=0,y=0;const x=Tw.search(h,s,8),v=this.curves[x>>3];switch(v){case 0:const t=h[x];u=h[x+1],d=h[x+2],p=h[x+3],f=h[x+4],m=h[x+5],g=h[x+6],y=h[x+7];const e=(s-t)/(h[x+8]-t);u+=(h[x+8+1]-u)*e,d+=(h[x+8+2]-d)*e,p+=(h[x+8+3]-p)*e,f+=(h[x+8+4]-f)*e,m+=(h[x+8+5]-m)*e,g+=(h[x+8+6]-g)*e,y+=(h[x+8+7]-y)*e;break;case 1:u=h[x+1],d=h[x+2],p=h[x+3],f=h[x+4],m=h[x+5],g=h[x+6],y=h[x+7];break;default:u=this.getBezierValue(s,x,1,v-2),d=this.getBezierValue(s,x,2,v+18-2),p=this.getBezierValue(s,x,3,v+36-2),f=this.getBezierValue(s,x,4,v+54-2),m=this.getBezierValue(s,x,5,v+72-2),g=this.getBezierValue(s,x,6,v+90-2),y=this.getBezierValue(s,x,7,v+108-2)}if(1==n)l.set(u,d,p,f),c.r=m,c.g=g,c.b=y;else{if(r==vx.setup){l.setFromColor(o.data.color);const t=o.data.darkColor;c.r=t.r,c.g=t.g,c.b=t.b}l.add((u-l.r)*n,(d-l.g)*n,(p-l.b)*n,(f-l.a)*n),c.r+=(m-c.r)*n,c.g+=(g-c.g)*n,c.b+=(y-c.b)*n}}}class Yw extends Aw{constructor(t,e,s){super(t,e,[`${dw}|${s}`,`${fw}|${s}`]),this.slotIndex=0,this.slotIndex=s}getFrameEntries(){return 7}setFrame(t,e,s,i,n,r,a,o){t*=7,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=i,this.frames[t+3]=n,this.frames[t+4]=r,this.frames[t+5]=a,this.frames[t+6]=o}apply(t,e,s,i,n,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=this.frames,l=o.color,c=o.darkColor;if(s<h[0]){const t=o.data.color,e=o.data.darkColor;switch(r){case vx.setup:return l.r=t.r,l.g=t.g,l.b=t.b,c.r=e.r,c.g=e.g,void(c.b=e.b);case vx.first:l.r+=(t.r-l.r)*n,l.g+=(t.g-l.g)*n,l.b+=(t.b-l.b)*n,c.r+=(e.r-c.r)*n,c.g+=(e.g-c.g)*n,c.b+=(e.b-c.b)*n}return}let u=0,d=0,p=0,f=0,m=0,g=0;const y=Tw.search(h,s,7),x=this.curves[y/7];switch(x){case 0:const t=h[y];u=h[y+1],d=h[y+2],p=h[y+3],f=h[y+4],m=h[y+5],g=h[y+6];const e=(s-t)/(h[y+7]-t);u+=(h[y+7+1]-u)*e,d+=(h[y+7+2]-d)*e,p+=(h[y+7+3]-p)*e,f+=(h[y+7+4]-f)*e,m+=(h[y+7+5]-m)*e,g+=(h[y+7+6]-g)*e;break;case 1:u=h[y+1],d=h[y+2],p=h[y+3],f=h[y+4],m=h[y+5],g=h[y+6];break;default:u=this.getBezierValue(s,y,1,x-2),d=this.getBezierValue(s,y,2,x+18-2),p=this.getBezierValue(s,y,3,x+36-2),f=this.getBezierValue(s,y,4,x+54-2),m=this.getBezierValue(s,y,5,x+72-2),g=this.getBezierValue(s,y,6,x+90-2)}if(1==n)l.r=u,l.g=d,l.b=p,c.r=f,c.g=m,c.b=g;else{if(r==vx.setup){const t=o.data.color,e=o.data.darkColor;l.r=t.r,l.g=t.g,l.b=t.b,c.r=e.r,c.g=e.g,c.b=e.b}l.r+=(u-l.r)*n,l.g+=(d-l.g)*n,l.b+=(p-l.b)*n,c.r+=(f-c.r)*n,c.g+=(m-c.g)*n,c.b+=(g-c.b)*n}}}class Ww extends Tw{constructor(t,e){super(t,[`${mw}|${e}`]),this.slotIndex=0,this.slotIndex=e,this.attachmentNames=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.attachmentNames[t]=s}apply(t,e,s,i,n,r,a){const o=t.slots[this.slotIndex];o.bone.active&&(a!=_x.mixOut?s<this.frames[0]?r!=vx.setup&&r!=vx.first||this.setAttachment(t,o,o.data.attachmentName):this.setAttachment(t,o,this.attachmentNames[Tw.search1(this.frames,s)]):r==vx.setup&&this.setAttachment(t,o,o.data.attachmentName))}setAttachment(t,e,s){e.setAttachment(s?t.getAttachment(this.slotIndex,s):null)}}class jw extends Aw{constructor(t,e,s,i){super(t,e,[`${gw}|${s}|${i.id}`]),this.slotIndex=0,this.slotIndex=s,this.attachment=i,this.vertices=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.vertices[t]=s}setBezier(t,e,s,i,n,r,a,o,h,l,c){const u=this.curves;let d=this.getFrameCount()+18*t;0==s&&(u[e]=2+d);const p=.03*(i-2*r+o),f=.03*h-.06*a,m=.006*(3*(r-o)-i+l),g=.018*(a-h+.33333333);let y=2*p+m,x=2*f+g,v=.3*(r-i)+p+.16666667*m,_=.3*a+f+.16666667*g,b=i+v,w=_;for(let E=d+18;d<E;d+=2)u[d]=b,u[d+1]=w,v+=y,_+=x,y+=m,x+=g,b+=v,w+=_}getCurvePercent(t,e){const s=this.curves;let i=s[e];switch(i){case 0:const s=this.frames[e];return(t-s)/(this.frames[e+this.getFrameEntries()]-s);case 1:return 0}if(i-=2,s[i]>t){const n=this.frames[e];return s[i+1]*(t-n)/(s[i]-n)}const n=i+18;for(i+=2;i<n;i+=2)if(s[i]>=t){const e=s[i-2],n=s[i-1];return n+(t-e)/(s[i]-e)*(s[i+1]-n)}const r=s[n-2],a=s[n-1];return a+(1-a)*(t-r)/(this.frames[e+this.getFrameEntries()]-r)}apply(t,e,s,i,n,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=o.getAttachment();if(!h)return;if(!(h instanceof Gb)||h.timelineAttachment!=this.attachment)return;const l=o.deform;0==l.length&&(r=vx.setup);const c=this.vertices,u=c[0].length,d=this.frames;if(s<d[0]){switch(r){case vx.setup:return void(l.length=0);case vx.first:if(1==n)return void(l.length=0);l.length=u;const t=h;if(t.bones){n=1-n;for(let t=0;t<u;t++)l[t]*=n}else{const e=t.vertices;for(let t=0;t<u;t++)l[t]+=(e[t]-l[t])*n}}return}if(l.length=u,s>=d[d.length-1]){const t=c[d.length-1];if(1==n)if(r==vx.add){const e=h;if(e.bones)for(let s=0;s<u;s++)l[s]+=t[s];else{const s=e.vertices;for(let e=0;e<u;e++)l[e]+=t[e]-s[e]}}else Yx.arrayCopy(t,0,l,0,u);else switch(r){case vx.setup:{const e=h;if(e.bones)for(let s=0;s<u;s++)l[s]=t[s]*n;else{const s=e.vertices;for(let e=0;e<u;e++){const i=s[e];l[e]=i+(t[e]-i)*n}}break}case vx.first:case vx.replace:for(let s=0;s<u;s++)l[s]+=(t[s]-l[s])*n;break;case vx.add:const e=h;if(e.bones)for(let s=0;s<u;s++)l[s]+=t[s]*n;else{const s=e.vertices;for(let e=0;e<u;e++)l[e]+=(t[e]-s[e])*n}}return}const p=Tw.search1(d,s),f=this.getCurvePercent(s,p),m=c[p],g=c[p+1];if(1==n)if(r==vx.add){const t=h;if(t.bones)for(let e=0;e<u;e++){const t=m[e];l[e]+=t+(g[e]-t)*f}else{const e=t.vertices;for(let t=0;t<u;t++){const s=m[t];l[t]+=s+(g[t]-s)*f-e[t]}}}else for(let y=0;y<u;y++){const t=m[y];l[y]=t+(g[y]-t)*f}else switch(r){case vx.setup:{const t=h;if(t.bones)for(let e=0;e<u;e++){const t=m[e];l[e]=(t+(g[e]-t)*f)*n}else{const e=t.vertices;for(let t=0;t<u;t++){const s=m[t],i=e[t];l[t]=i+(s+(g[t]-s)*f-i)*n}}break}case vx.first:case vx.replace:for(let e=0;e<u;e++){const t=m[e];l[e]+=(t+(g[e]-t)*f-l[e])*n}break;case vx.add:const t=h;if(t.bones)for(let e=0;e<u;e++){const t=m[e];l[e]+=(t+(g[e]-t)*f)*n}else{const e=t.vertices;for(let t=0;t<u;t++){const s=m[t];l[t]+=(s+(g[t]-s)*f-e[t])*n}}}}}const Gw=class extends Tw{constructor(t){super(t,Gw.propertyIds),this.events=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,s,i,n,r,a){if(!i)return;const o=this.frames,h=this.frames.length;if(e>s)this.apply(t,e,Number.MAX_VALUE,i,n,r,a),e=-1;else if(e>=o[h-1])return;if(s<o[0])return;let l=0;if(e<o[0])l=0;else{l=Tw.search1(o,e)+1;const t=o[l];for(;l>0&&o[l-1]==t;)l--}for(;l<h&&s>=o[l];l++)i.push(this.events[l])}};let zw=Gw;zw.propertyIds=[`${yw}`];const Hw=class extends Tw{constructor(t){super(t,Hw.propertyIds),this.drawOrders=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.drawOrders[t]=s}apply(t,e,s,i,n,r,a){if(a==_x.mixOut)return void(r==vx.setup&&Yx.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));if(s<this.frames[0])return void(r!=vx.setup&&r!=vx.first||Yx.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));const o=Tw.search1(this.frames,s),h=this.drawOrders[o];if(h){const e=t.drawOrder,s=t.slots;for(let t=0,i=h.length;t<i;t++)e[t]=s[h[t]]}else Yx.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)}};let qw=Hw;qw.propertyIds=[`${xw}`];class Kw extends Aw{constructor(t,e,s){super(t,e,[`${vw}|${s}`]),this.ikConstraintIndex=0,this.ikConstraintIndex=s}getFrameEntries(){return 6}setFrame(t,e,s,i,n,r,a){t*=6,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=i,this.frames[t+3]=n,this.frames[t+4]=r?1:0,this.frames[t+5]=a?1:0}apply(t,e,s,i,n,r,a){const o=t.ikConstraints[this.ikConstraintIndex];if(!o.active)return;const h=this.frames;if(s<h[0]){switch(r){case vx.setup:return o.mix=o.data.mix,o.softness=o.data.softness,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,void(o.stretch=o.data.stretch);case vx.first:o.mix+=(o.data.mix-o.mix)*n,o.softness+=(o.data.softness-o.softness)*n,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch}return}let l=0,c=0;const u=Tw.search(h,s,6),d=this.curves[u/6];switch(d){case 0:const t=h[u];l=h[u+1],c=h[u+2];const e=(s-t)/(h[u+6]-t);l+=(h[u+6+1]-l)*e,c+=(h[u+6+2]-c)*e;break;case 1:l=h[u+1],c=h[u+2];break;default:l=this.getBezierValue(s,u,1,d-2),c=this.getBezierValue(s,u,2,d+18-2)}r==vx.setup?(o.mix=o.data.mix+(l-o.data.mix)*n,o.softness=o.data.softness+(c-o.data.softness)*n,a==_x.mixOut?(o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch):(o.bendDirection=h[u+3],o.compress=0!=h[u+4],o.stretch=0!=h[u+5])):(o.mix+=(l-o.mix)*n,o.softness+=(c-o.softness)*n,a==_x.mixIn&&(o.bendDirection=h[u+3],o.compress=0!=h[u+4],o.stretch=0!=h[u+5]))}}class Zw extends Aw{constructor(t,e,s){super(t,e,[`${_w}|${s}`]),this.transformConstraintIndex=0,this.transformConstraintIndex=s}getFrameEntries(){return 7}setFrame(t,e,s,i,n,r,a,o){const h=this.frames;h[t*=7]=e,h[t+1]=s,h[t+2]=i,h[t+3]=n,h[t+4]=r,h[t+5]=a,h[t+6]=o}apply(t,e,s,i,n,r,a){const o=t.transformConstraints[this.transformConstraintIndex];if(!o.active)return;const h=this.frames;if(s<h[0]){const t=o.data;switch(r){case vx.setup:return o.mixRotate=t.mixRotate,o.mixX=t.mixX,o.mixY=t.mixY,o.mixScaleX=t.mixScaleX,o.mixScaleY=t.mixScaleY,void(o.mixShearY=t.mixShearY);case vx.first:o.mixRotate+=(t.mixRotate-o.mixRotate)*n,o.mixX+=(t.mixX-o.mixX)*n,o.mixY+=(t.mixY-o.mixY)*n,o.mixScaleX+=(t.mixScaleX-o.mixScaleX)*n,o.mixScaleY+=(t.mixScaleY-o.mixScaleY)*n,o.mixShearY+=(t.mixShearY-o.mixShearY)*n}return}let l,c,u,d,p,f;const m=Tw.search(h,s,7),g=this.curves[m/7];switch(g){case 0:const t=h[m];l=h[m+1],c=h[m+2],u=h[m+3],d=h[m+4],p=h[m+5],f=h[m+6];const e=(s-t)/(h[m+7]-t);l+=(h[m+7+1]-l)*e,c+=(h[m+7+2]-c)*e,u+=(h[m+7+3]-u)*e,d+=(h[m+7+4]-d)*e,p+=(h[m+7+5]-p)*e,f+=(h[m+7+6]-f)*e;break;case 1:l=h[m+1],c=h[m+2],u=h[m+3],d=h[m+4],p=h[m+5],f=h[m+6];break;default:l=this.getBezierValue(s,m,1,g-2),c=this.getBezierValue(s,m,2,g+18-2),u=this.getBezierValue(s,m,3,g+36-2),d=this.getBezierValue(s,m,4,g+54-2),p=this.getBezierValue(s,m,5,g+72-2),f=this.getBezierValue(s,m,6,g+90-2)}if(r==vx.setup){const t=o.data;o.mixRotate=t.mixRotate+(l-t.mixRotate)*n,o.mixX=t.mixX+(c-t.mixX)*n,o.mixY=t.mixY+(u-t.mixY)*n,o.mixScaleX=t.mixScaleX+(d-t.mixScaleX)*n,o.mixScaleY=t.mixScaleY+(p-t.mixScaleY)*n,o.mixShearY=t.mixShearY+(f-t.mixShearY)*n}else o.mixRotate+=(l-o.mixRotate)*n,o.mixX+=(c-o.mixX)*n,o.mixY+=(u-o.mixY)*n,o.mixScaleX+=(d-o.mixScaleX)*n,o.mixScaleY+=(p-o.mixScaleY)*n,o.mixShearY+=(f-o.mixShearY)*n}}class Qw extends Cw{constructor(t,e,s){super(t,e,`${bw}|${s}`),this.pathConstraintIndex=0,this.pathConstraintIndex=s}apply(t,e,s,i,n,r,a){const o=t.pathConstraints[this.pathConstraintIndex];if(!o.active)return;if(s<this.frames[0]){switch(r){case vx.setup:return void(o.position=o.data.position);case vx.first:o.position+=(o.data.position-o.position)*n}return}const h=this.getCurveValue(s);r==vx.setup?o.position=o.data.position+(h-o.data.position)*n:o.position+=(h-o.position)*n}}class Jw extends Cw{constructor(t,e,s){super(t,e,`${ww}|${s}`),this.pathConstraintIndex=0,this.pathConstraintIndex=s}apply(t,e,s,i,n,r,a){const o=t.pathConstraints[this.pathConstraintIndex];if(!o.active)return;if(s<this.frames[0]){switch(r){case vx.setup:return void(o.spacing=o.data.spacing);case vx.first:o.spacing+=(o.data.spacing-o.spacing)*n}return}const h=this.getCurveValue(s);r==vx.setup?o.spacing=o.data.spacing+(h-o.data.spacing)*n:o.spacing+=(h-o.spacing)*n}}class tE extends Aw{constructor(t,e,s){super(t,e,[`${Ew}|${s}`]),this.pathConstraintIndex=0,this.pathConstraintIndex=s}getFrameEntries(){return 4}setFrame(t,e,s,i,n){const r=this.frames;r[t<<=2]=e,r[t+1]=s,r[t+2]=i,r[t+3]=n}apply(t,e,s,i,n,r,a){const o=t.pathConstraints[this.pathConstraintIndex];if(!o.active)return;const h=this.frames;if(s<h[0]){switch(r){case vx.setup:return o.mixRotate=o.data.mixRotate,o.mixX=o.data.mixX,void(o.mixY=o.data.mixY);case vx.first:o.mixRotate+=(o.data.mixRotate-o.mixRotate)*n,o.mixX+=(o.data.mixX-o.mixX)*n,o.mixY+=(o.data.mixY-o.mixY)*n}return}let l,c,u;const d=Tw.search(h,s,4),p=this.curves[d>>2];switch(p){case 0:const t=h[d];l=h[d+1],c=h[d+2],u=h[d+3];const e=(s-t)/(h[d+4]-t);l+=(h[d+4+1]-l)*e,c+=(h[d+4+2]-c)*e,u+=(h[d+4+3]-u)*e;break;case 1:l=h[d+1],c=h[d+2],u=h[d+3];break;default:l=this.getBezierValue(s,d,1,p-2),c=this.getBezierValue(s,d,2,p+18-2),u=this.getBezierValue(s,d,3,p+36-2)}if(r==vx.setup){const t=o.data;o.mixRotate=t.mixRotate+(l-t.mixRotate)*n,o.mixX=t.mixX+(c-t.mixX)*n,o.mixY=t.mixY+(u-t.mixY)*n}else o.mixRotate+=(l-o.mixRotate)*n,o.mixX+=(c-o.mixX)*n,o.mixY+=(u-o.mixY)*n}}const eE=class extends Tw{constructor(t,e,s){super(t,[`${Sw}|${e}|${s.sequence.id}`]),this.slotIndex=e,this.attachment=s}getFrameEntries(){return eE.ENTRIES}getSlotIndex(){return this.slotIndex}getAttachment(){return this.attachment}setFrame(t,e,s,i,n){const r=this.frames;r[t*=eE.ENTRIES]=e,r[t+eE.MODE]=s|i<<4,r[t+eE.DELAY]=n}apply(t,e,s,i,n,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=o.attachment,l=this.attachment;if(!(h==l||h instanceof Gb&&h.timelineAttachment==l))return;const c=this.frames;if(s<c[0])return void(r!=vx.setup&&r!=vx.first||(o.sequenceIndex=-1));const u=Tw.search(c,s,eE.ENTRIES),d=c[u],p=c[u+eE.MODE],f=c[u+eE.DELAY];if(!this.attachment.sequence)return;let m=p>>4;const g=this.attachment.sequence.regions.length,y=iw[15&p];if(y!=sw.hold)switch(m+=(s-d)/f+1e-5|0,y){case sw.once:m=Math.min(g-1,m);break;case sw.loop:m%=g;break;case sw.pingpong:{const t=(g<<1)-2;m=0==t?0:m%t,m>=g&&(m=t-m);break}case sw.onceReverse:m=Math.max(g-1-m,0);break;case sw.loopReverse:m=g-1-m%g;break;case sw.pingpongReverse:{const t=(g<<1)-2;m=0==t?0:(m+g-1)%t,m>=g&&(m=t-m)}}o.sequenceIndex=m}};let sE=eE;sE.ENTRIES=3,sE.MODE=1,sE.DELAY=2;const iE=class{constructor(t){this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new oE(this),this.propertyIDs=new Fx,this.animationsChanged=!1,this.trackEntryPool=new Wx((()=>new aE)),this.data=t}static emptyAnimation(){return iE._emptyAnimation}update(t){t*=this.timeScale;const e=this.tracks;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(!i)continue;i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast;let n=t*i.timeScale;if(i.delay>0){if(i.delay-=n,i.delay>0)continue;n=-i.delay,i.delay=0}let r=i.next;if(r){const e=i.trackLast-r.delay;if(e>=0){for(r.delay=0,r.trackTime+=0==i.timeScale?0:(e/i.timeScale+t)*r.timeScale,i.trackTime+=n,this.setCurrent(s,r,!0);r.mixingFrom;)r.mixTime+=t,r=r.mixingFrom;continue}}else if(i.trackLast>=i.trackEnd&&!i.mixingFrom){e[s]=null,this.queue.end(i),this.clearNext(i);continue}if(i.mixingFrom&&this.updateMixingFrom(i,t)){let t=i.mixingFrom;for(i.mixingFrom=null,t&&(t.mixingTo=null);t;)this.queue.end(t),t=t.mixingFrom}i.trackTime+=n}this.queue.drain()}updateMixingFrom(t,e){const s=t.mixingFrom;if(!s)return!0;const i=this.updateMixingFrom(s,e);return s.animationLast=s.nextAnimationLast,s.trackLast=s.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=s.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=s.mixingFrom,s.mixingFrom&&(s.mixingFrom.mixingTo=t),t.interruptAlpha=s.interruptAlpha,this.queue.end(s)),i):(s.trackTime+=e*s.timeScale,t.mixTime+=e,!1)}apply(t){if(!t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();const e=this.events,s=this.tracks;let i=!1;for(let a=0,o=s.length;a<o;a++){const n=s[a];if(!n||n.delay>0)continue;i=!0;const r=0==a?vx.first:n.mixBlend;let o=n.alpha;n.mixingFrom?o*=this.applyMixingFrom(n,t,r):n.trackTime>=n.trackEnd&&!n.next&&(o=0);const h=n.animationLast,l=n.getAnimationTime();let c=l,u=e;n.reverse&&(c=n.animation.duration-c,u=null);const d=n.animation.timelines,p=d.length;if(0==a&&1==o||r==vx.add)for(let e=0;e<p;e++){const s=d[e];s instanceof Ww?this.applyAttachmentTimeline(s,t,c,r,!0):s.apply(t,h,c,u,o,r,_x.mixIn)}else{const e=n.timelineMode,s=n.shortestRotation,i=!s&&n.timelinesRotation.length!=p<<1;i&&(n.timelinesRotation.length=p<<1);for(let a=0;a<p;a++){const l=d[a],p=e[a]==lE?r:vx.setup;!s&&l instanceof Iw?this.applyRotateTimeline(l,t,c,o,p,n.timelinesRotation,a<<1,i):l instanceof Ww?this.applyAttachmentTimeline(l,t,c,r,!0):l.apply(t,h,c,u,o,p,_x.mixIn)}}this.queueEvents(n,l),e.length=0,n.nextAnimationLast=l,n.nextTrackLast=n.trackTime}const n=this.unkeyedState+fE,r=t.slots;for(let a=0,o=t.slots.length;a<o;a++){const e=r[a];if(e.attachmentState==n){const s=e.data.attachmentName;e.setAttachment(s?t.getAttachment(e.data.index,s):null)}}return this.unkeyedState+=2,this.queue.drain(),i}applyMixingFrom(t,e,s){const i=t.mixingFrom;i.mixingFrom&&this.applyMixingFrom(i,e,s);let n=0;0==t.mixDuration?(n=1,s==vx.first&&(s=vx.setup)):(n=t.mixTime/t.mixDuration,n>1&&(n=1),s!=vx.first&&(s=i.mixBlend));const r=n<i.attachmentThreshold,a=n<i.drawOrderThreshold,o=i.animation.timelines,h=o.length,l=i.alpha*t.interruptAlpha,c=l*(1-n),u=i.animationLast,d=i.getAnimationTime();let p=d,f=null;if(i.reverse?p=i.animation.duration-p:n<i.eventThreshold&&(f=this.events),s==vx.add)for(let m=0;m<h;m++)o[m].apply(e,u,p,f,c,s,_x.mixOut);else{const t=i.timelineMode,n=i.timelineHoldMix,d=i.shortestRotation,m=!d&&i.timelinesRotation.length!=h<<1;m&&(i.timelinesRotation.length=h<<1),i.totalAlpha=0;for(let g=0;g<h;g++){const h=o[g];let y,x=_x.mixOut,v=0;switch(t[g]){case lE:if(!a&&h instanceof qw)continue;y=s,v=c;break;case cE:y=vx.setup,v=c;break;case uE:y=s,v=l;break;case dE:y=vx.setup,v=l;break;default:y=vx.setup;const t=n[g];v=l*Math.max(0,1-t.mixTime/t.mixDuration)}i.totalAlpha+=v,!d&&h instanceof Iw?this.applyRotateTimeline(h,e,p,v,y,i.timelinesRotation,g<<1,m):h instanceof Ww?this.applyAttachmentTimeline(h,e,p,y,r):(a&&h instanceof qw&&y==vx.setup&&(x=_x.mixIn),h.apply(e,u,p,f,v,y,x))}}return t.mixDuration>0&&this.queueEvents(i,d),this.events.length=0,i.nextAnimationLast=d,i.nextTrackLast=i.trackTime,n}applyAttachmentTimeline(t,e,s,i,n){const r=e.slots[t.slotIndex];r.bone.active&&(s<t.frames[0]?i!=vx.setup&&i!=vx.first||this.setAttachment(e,r,r.data.attachmentName,n):this.setAttachment(e,r,t.attachmentNames[Tw.search1(t.frames,s)],n),r.attachmentState<=this.unkeyedState&&(r.attachmentState=this.unkeyedState+fE))}setAttachment(t,e,s,i){e.setAttachment(s?t.getAttachment(e.data.index,s):null),i&&(e.attachmentState=this.unkeyedState+mE)}applyRotateTimeline(t,e,s,i,n,r,a,o){if(o&&(r[a]=0),1==i)return void t.apply(e,0,s,null,1,n,_x.mixIn);const h=e.bones[t.boneIndex];if(!h.active)return;let l=0,c=0;if(s<t.frames[0])switch(n){case vx.setup:h.rotation=h.data.rotation;default:return;case vx.first:l=h.rotation,c=h.data.rotation}else l=n==vx.setup?h.data.rotation:h.rotation,c=h.data.rotation+t.getCurveValue(s);let u=0,d=c-l;if(d-=360*(16384-(16384.499999999996-d/360|0)),0==d)u=r[a];else{let t=0,e=0;o?(t=0,e=d):(t=r[a],e=r[a+1]);const s=d>0;let i=t>=0;Lx.signum(e)!=Lx.signum(d)&&Math.abs(e)<=90&&(Math.abs(t)>180&&(t+=360*Lx.signum(t)),i=s),u=d+t-t%360,i!=s&&(u+=360*Lx.signum(t)),r[a]=u}r[a+1]=d,h.rotation=l+u*i}queueEvents(t,e){const s=t.animationStart,i=t.animationEnd,n=i-s,r=t.trackLast%n,a=this.events;let o=0;const h=a.length;for(;o<h;o++){const e=a[o];if(e.time<r)break;e.time>i||this.queue.event(t,e)}let l=!1;for(l=t.loop?0==n||r>t.trackTime%n:e>=i&&t.animationLast<i,l&&this.queue.complete(t);o<h;o++){const e=a[o];e.time<s||this.queue.event(t,e)}}clearTracks(){const t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,s=this.tracks.length;e<s;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;const e=this.tracks[t];if(!e)return;this.queue.end(e),this.clearNext(e);let s=e;for(;;){const t=s.mixingFrom;if(!t)break;this.queue.end(t),s.mixingFrom=null,s.mixingTo=null,s=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,s){const i=this.expandToIndex(t);this.tracks[t]=e,e.previous=null,i&&(s&&this.queue.interrupt(i),e.mixingFrom=i,i.mixingTo=e,e.mixTime=0,i.mixingFrom&&i.mixDuration>0&&(e.interruptAlpha*=Math.min(1,i.mixTime/i.mixDuration)),i.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,s=!1){const i=this.data.skeletonData.findAnimation(e);if(!i)throw new Error(`Animation not found: ${e}`);return this.setAnimationWith(t,i,s)}setAnimationWith(t,e,s=!1){if(!e)throw new Error("animation cannot be null.");let i=!0,n=this.expandToIndex(t);n&&(-1==n.nextTrackLast?(this.tracks[t]=n.mixingFrom,this.queue.interrupt(n),this.queue.end(n),this.clearNext(n),n=n.mixingFrom,i=!1):this.clearNext(n));const r=this.trackEntry(t,e,s,n);return this.setCurrent(t,r,i),this.queue.drain(),r}addAnimation(t,e,s=!1,i=0){const n=this.data.skeletonData.findAnimation(e);if(!n)throw new Error(`Animation not found: ${e}`);return this.addAnimationWith(t,n,s,i)}addAnimationWith(t,e,s=!1,i=0){if(!e)throw new Error("animation cannot be null.");let n=this.expandToIndex(t);if(n)for(;n.next;)n=n.next;const r=this.trackEntry(t,e,s,n);return n?(n.next=r,r.previous=n,i<=0&&(i+=n.getTrackComplete()-r.mixDuration)):(this.setCurrent(t,r,!0),this.queue.drain()),r.delay=i,r}setEmptyAnimation(t,e=0){const s=this.setAnimationWith(t,iE.emptyAnimation(),!1);return s.mixDuration=e,s.trackEnd=e,s}addEmptyAnimation(t,e=0,s=0){const i=this.addAnimationWith(t,iE.emptyAnimation(),!1,s);return s<=0&&(i.delay+=i.mixDuration-e),i.mixDuration=e,i.trackEnd=e,i}setEmptyAnimations(t=0){const e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let s=0,i=this.tracks.length;s<i;s++){const e=this.tracks[s];e&&this.setEmptyAnimation(e.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(Yx.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,s,i){const n=this.trackEntryPool.obtain();return n.reset(),n.trackIndex=t,n.animation=e,n.loop=s,n.holdPrevious=!1,n.reverse=!1,n.shortestRotation=!1,n.eventThreshold=0,n.attachmentThreshold=0,n.drawOrderThreshold=0,n.animationStart=0,n.animationEnd=e.duration,n.animationLast=-1,n.nextAnimationLast=-1,n.delay=0,n.trackTime=0,n.trackLast=-1,n.nextTrackLast=-1,n.trackEnd=Number.MAX_VALUE,n.timeScale=1,n.alpha=1,n.mixTime=0,n.mixDuration=i?this.data.getMix(i.animation,e):0,n.interruptAlpha=1,n.totalAlpha=0,n.mixBlend=vx.replace,n}clearNext(t){let e=t.next;for(;e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();const t=this.tracks;for(let e=0,s=t.length;e<s;e++){let s=t[e];if(s){for(;s.mixingFrom;)s=s.mixingFrom;do{s.mixingTo&&s.mixBlend==vx.add||this.computeHold(s),s=s.mixingTo}while(s)}}}computeHold(t){const e=t.mixingTo,s=t.animation.timelines,i=t.animation.timelines.length,n=t.timelineMode;n.length=i;const r=t.timelineHoldMix;r.length=0;const a=this.propertyIDs;if(e&&e.holdPrevious)for(let o=0;o<i;o++)n[o]=a.addAll(s[o].getPropertyIds())?dE:uE;else t:for(let o=0;o<i;o++){const i=s[o],h=i.getPropertyIds();if(a.addAll(h))if(!e||i instanceof Ww||i instanceof qw||i instanceof zw||!e.animation.hasTimeline(h))n[o]=cE;else{for(let s=e.mixingTo;s;s=s.mixingTo)if(!s.animation.hasTimeline(h)){if(t.mixDuration>0){n[o]=pE,r[o]=s;continue t}break}n[o]=dE}else n[o]=lE}}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(!t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){const e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}setAnimationByName(t,e,s){iE.deprecatedWarning1||(iE.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")),this.setAnimation(t,e,s)}addAnimationByName(t,e,s,i){iE.deprecatedWarning2||(iE.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")),this.addAnimation(t,e,s,i)}hasAnimation(t){return null!==this.data.skeletonData.findAnimation(t)}hasAnimationByName(t){return iE.deprecatedWarning3||(iE.deprecatedWarning3=!0,console.warn("Spine Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")),this.hasAnimation(t)}};let nE=iE;nE._emptyAnimation=new nw("<empty>",[],0),nE.deprecatedWarning1=!1,nE.deprecatedWarning2=!1,nE.deprecatedWarning3=!1;const rE=class{constructor(){this.animation=null,this.previous=null,this.next=null,this.mixingFrom=null,this.mixingTo=null,this.listener=null,this.trackIndex=0,this.loop=!1,this.holdPrevious=!1,this.reverse=!1,this.shortestRotation=!1,this.eventThreshold=0,this.attachmentThreshold=0,this.drawOrderThreshold=0,this.animationStart=0,this.animationEnd=0,this.animationLast=0,this.nextAnimationLast=0,this.delay=0,this.trackTime=0,this.trackLast=0,this.nextTrackLast=0,this.trackEnd=0,this.timeScale=0,this.alpha=0,this.mixTime=0,this.mixDuration=0,this.interruptAlpha=0,this.totalAlpha=0,this.mixBlend=vx.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.previous=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){const t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}getTrackComplete(){const t=this.animationEnd-this.animationStart;if(0!=t){if(this.loop)return t*(1+(this.trackTime/t|0));if(this.trackTime<t)return t}return this.trackTime}get time(){return rE.deprecatedWarning1||(rE.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime}set time(t){rE.deprecatedWarning1||(rE.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime=t}get endTime(){return rE.deprecatedWarning2||(rE.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime}set endTime(t){rE.deprecatedWarning2||(rE.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime=t}loopsCount(){return Math.floor(this.trackTime/this.trackEnd)}};let aE=rE;aE.deprecatedWarning1=!1,aE.deprecatedWarning2=!1;class oE{constructor(t){this.objects=[],this.drainDisabled=!1,this.animState=t}start(t){this.objects.push(hE.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(hE.interrupt),this.objects.push(t)}end(t){this.objects.push(hE.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(hE.dispose),this.objects.push(t)}complete(t){this.objects.push(hE.complete),this.objects.push(t)}event(t,e){this.objects.push(hE.event),this.objects.push(t),this.objects.push(e)}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;const t=this.objects,e=this.animState.listeners;for(let s=0;s<t.length;s+=2){const i=t[s],n=t[s+1];switch(i){case hE.start:n.listener&&n.listener.start&&n.listener.start(n);for(let t=0;t<e.length;t++){const s=e[t];s.start&&s.start(n)}break;case hE.interrupt:n.listener&&n.listener.interrupt&&n.listener.interrupt(n);for(let t=0;t<e.length;t++){const s=e[t];s.interrupt&&s.interrupt(n)}break;case hE.end:n.listener&&n.listener.end&&n.listener.end(n);for(let t=0;t<e.length;t++){const s=e[t];s.end&&s.end(n)}case hE.dispose:n.listener&&n.listener.dispose&&n.listener.dispose(n);for(let t=0;t<e.length;t++){const s=e[t];s.dispose&&s.dispose(n)}this.animState.trackEntryPool.free(n);break;case hE.complete:n.listener&&n.listener.complete&&n.listener.complete(n);for(let t=0;t<e.length;t++){const s=e[t];s.complete&&s.complete(n)}break;case hE.event:const i=t[2+s++];n.listener&&n.listener.event&&n.listener.event(n,i);for(let t=0;t<e.length;t++){const s=e[t];s.event&&s.event(n,i)}}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}}var hE=(t=>(t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event",t))(hE||{});const lE=0,cE=1,uE=2,dE=3,pE=4,fE=1,mE=2;class gE{constructor(t){if(this.animationToMixTime={},this.defaultMix=0,!t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,s){const i=this.skeletonData.findAnimation(t);if(!i)throw new Error(`Animation not found: ${t}`);const n=this.skeletonData.findAnimation(e);if(!n)throw new Error(`Animation not found: ${e}`);this.setMixWith(i,n,s)}setMixWith(t,e,s){if(!t)throw new Error("from cannot be null.");if(!e)throw new Error("to cannot be null.");const i=`${t.name}.${e.name}`;this.animationToMixTime[i]=s}getMix(t,e){const s=`${t.name}.${e.name}`,i=this.animationToMixTime[s];return void 0===i?this.defaultMix:i}}class yE{constructor(t){this.atlas=t}loadSequence(t,e,s){const i=s.regions;for(let n=0,r=i.length;n<r;n++){const r=s.getPath(e,n),a=this.atlas.findRegion(r);if(null==a)throw new Error(`Region not found in atlas: ${r} (sequence: ${t})`);i[n]=a,i[n].renderObject=i[n]}}newRegionAttachment(t,e,s,i){const n=new Jb(e,s);if(null!=i)this.loadSequence(e,s,i);else{const t=this.atlas.findRegion(s);if(!t)throw new Error(`Region not found in atlas: ${s} (region attachment: ${e})`);t.renderObject=t,n.region=t}return n}newMeshAttachment(t,e,s,i){const n=new qb(e,s);if(null!=i)this.loadSequence(e,s,i);else{const t=this.atlas.findRegion(s);if(!t)throw new Error(`Region not found in atlas: ${s} (mesh attachment: ${e})`);t.renderObject=t,n.region=t}return n}newBoundingBoxAttachment(t,e){return new zb(e)}newPathAttachment(t,e){return new Kb(e)}newPointAttachment(t,e){return new Zb(e)}newClippingAttachment(t,e){return new Hb(e)}}class xE{constructor(t,e,s){if(this.matrix=new Dh,this.parent=null,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.sorted=!1,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=s,this.setToSetupPose()}get worldX(){return this.matrix.tx}get worldY(){return this.matrix.ty}isActive(){return this.active}update(){this.updateWorldTransformWith(this.ax,this.ay,this.arotation,this.ascaleX,this.ascaleY,this.ashearX,this.ashearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,s,i,n,r,a){this.ax=t,this.ay=e,this.arotation=s,this.ascaleX=i,this.ascaleY=n,this.ashearX=r,this.ashearY=a;const o=this.parent,h=this.matrix,l=this.skeleton.scaleX,c=-this.skeleton.scaleY;if(!o){const o=this.skeleton,u=s+90+a;return h.a=Lx.cosDeg(s+r)*i*l,h.c=Lx.cosDeg(u)*n*l,h.b=Lx.sinDeg(s+r)*i*c,h.d=Lx.sinDeg(u)*n*c,h.tx=t*l+o.x,void(h.ty=e*c+o.y)}let u=o.matrix.a,d=o.matrix.c,p=o.matrix.b,f=o.matrix.d;switch(h.tx=u*t+d*e+o.matrix.tx,h.ty=p*t+f*e+o.matrix.ty,this.data.transformMode){case Ex.Normal:{const t=s+90+a,e=Lx.cosDeg(s+r)*i,o=Lx.cosDeg(t)*n,l=Lx.sinDeg(s+r)*i,c=Lx.sinDeg(t)*n;return h.a=u*e+d*l,h.c=u*o+d*c,h.b=p*e+f*l,void(h.d=p*o+f*c)}case Ex.OnlyTranslation:{const t=s+90+a;h.a=Lx.cosDeg(s+r)*i,h.c=Lx.cosDeg(t)*n,h.b=Lx.sinDeg(s+r)*i,h.d=Lx.sinDeg(t)*n;break}case Ex.NoRotationOrReflection:{let t=u*u+p*p,e=0;t>1e-4?(t=Math.abs(u*f-d*p)/t,u/=l,p/=c,d=p*t,f=u*t,e=Math.atan2(p,u)*Lx.radDeg):(u=0,p=0,e=90-Math.atan2(f,d)*Lx.radDeg);const o=s+r-e,m=s+a-e+90,g=Lx.cosDeg(o)*i,y=Lx.cosDeg(m)*n,x=Lx.sinDeg(o)*i,v=Lx.sinDeg(m)*n;h.a=u*g-d*x,h.c=u*y-d*v,h.b=p*g+f*x,h.d=p*y+f*v;break}case Ex.NoScale:case Ex.NoScaleOrReflection:{const t=Lx.cosDeg(s),e=Lx.sinDeg(s);let o=(u*t+d*e)/l,m=(p*t+f*e)/c,g=Math.sqrt(o*o+m*m);g>1e-5&&(g=1/g),o*=g,m*=g,g=Math.sqrt(o*o+m*m),this.data.transformMode==Ex.NoScale&&u*f-d*p<0!=(l<0!=c<0)&&(g=-g);const y=Math.PI/2+Math.atan2(m,o),x=Math.cos(y)*g,v=Math.sin(y)*g,_=Lx.cosDeg(r)*i,b=Lx.cosDeg(90+a)*n,w=Lx.sinDeg(r)*i,E=Lx.sinDeg(90+a)*n;h.a=o*_+x*w,h.c=o*b+x*E,h.b=m*_+v*w,h.d=m*b+v*E;break}}h.a*=l,h.c*=l,h.b*=c,h.d*=c}setToSetupPose(){const t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.matrix.b,this.matrix.a)*Lx.radDeg}getWorldRotationY(){return Math.atan2(this.matrix.d,this.matrix.c)*Lx.radDeg}getWorldScaleX(){const t=this.matrix;return Math.sqrt(t.a*t.a+t.b*t.b)}getWorldScaleY(){const t=this.matrix;return Math.sqrt(t.c*t.c+t.d*t.d)}updateAppliedTransform(){const t=this.parent,e=this.matrix;if(!t)return this.ax=e.tx-this.skeleton.x,this.ay=e.ty-this.skeleton.y,this.arotation=Math.atan2(e.b,e.a)*Lx.radDeg,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*Lx.radDeg);const s=t.matrix,i=1/(s.a*s.d-s.b*s.c),n=e.tx-s.tx,r=e.ty-s.ty;this.ax=n*s.d*i-r*s.c*i,this.ay=r*s.a*i-n*s.b*i;const a=i*s.d,o=i*s.a,h=i*s.c,l=i*s.b,c=a*e.a-h*e.b,u=a*e.c-h*e.d,d=o*e.b-l*e.a,p=o*e.d-l*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(c*c+d*d),this.ascaleX>1e-4){const t=c*p-u*d;this.ascaleY=t/this.ascaleX,this.ashearY=Math.atan2(c*u+d*p,t)*Lx.radDeg,this.arotation=Math.atan2(d,c)*Lx.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(u*u+p*p),this.ashearY=0,this.arotation=90-Math.atan2(p,u)*Lx.radDeg}worldToLocal(t){const e=this.matrix,s=e.a,i=e.c,n=e.b,r=e.d,a=1/(s*r-i*n),o=t.x-e.tx,h=t.y-e.ty;return t.x=o*r*a-h*i*a,t.y=h*s*a-o*n*a,t}localToWorld(t){const e=this.matrix,s=t.x,i=t.y;return t.x=s*e.a+i*e.c+e.tx,t.y=s*e.b+i*e.d+e.ty,t}worldToLocalRotation(t){const e=Lx.sinDeg(t),s=Lx.cosDeg(t),i=this.matrix;return Math.atan2(i.a*e-i.b*s,i.d*s-i.c*e)*Lx.radDeg}localToWorldRotation(t){t-=this.rotation-this.shearX;const e=Lx.sinDeg(t),s=Lx.cosDeg(t),i=this.matrix;return Math.atan2(s*i.b+e*i.d,s*i.a+e*i.c)*Lx.radDeg}rotateWorld(t){const e=this.matrix,s=e.a,i=e.c,n=e.b,r=e.d,a=Lx.cosDeg(t),o=Lx.sinDeg(t);e.a=a*s-o*n,e.c=a*i-o*r,e.b=o*s+a*n,e.d=o*i+a*r}}class vE{constructor(t,e,s){if(this.index=0,this.parent=null,this.length=0,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=Ex.Normal,this.skinRequired=!1,this.color=new Nx,t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=s}}class _E{constructor(t,e,s){this.name=t,this.order=e,this.skinRequired=s}}let bE=class{constructor(t,e){if(this.intValue=0,this.floatValue=0,this.stringValue=null,this.time=0,this.volume=0,this.balance=0,!e)throw new Error("data cannot be null.");this.time=t,this.data=e}};class wE{constructor(t){this.intValue=0,this.floatValue=0,this.stringValue=null,this.audioPath=null,this.volume=0,this.balance=0,this.name=t}}class EE{constructor(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let i=0;i<t.bones.length;i++){const s=e.findBone(t.bones[i].name);if(!s)throw new Error(`Couldn't find bone ${t.bones[i].name}`);this.bones.push(s)}const s=e.findBone(t.target.name);if(!s)throw new Error(`Couldn't find bone ${t.target.name}`);this.target=s}isActive(){return this.active}update(){if(0==this.mix)return;const t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.data.uniform,this.softness,this.mix)}}apply1(t,e,s,i,n,r,a){const o=t.parent.matrix;if(!o)throw new Error("IK bone must have parent.");const h=o.a;let l=o.c;const c=o.b;let u=o.d,d=-t.ashearX-t.arotation,p=0,f=0;const m=t.skeleton.scaleX,g=-t.skeleton.scaleY;switch(t.data.transformMode){case Ex.OnlyTranslation:p=e-t.worldX,f=s-t.worldY,f=-f;break;case Ex.NoRotationOrReflection:const i=Math.abs(h*u-l*c)/(h*h+c*c),n=h/m,r=c/g;l=-r*i*m,u=n*i*g,d+=Math.atan2(r,n)*Lx.radDeg;default:const a=e-o.tx,y=s-o.ty,x=h*u-l*c;p=(a*u-y*l)/x-t.ax,f=(y*h-a*c)/x-t.ay}d+=Math.atan2(f,p)*Lx.radDeg,t.ascaleX<0&&(d+=180),d>180?d-=360:d<-180&&(d+=360);let y=t.ascaleX,x=t.ascaleY;if(i||n){switch(t.data.transformMode){case Ex.NoScale:case Ex.NoScaleOrReflection:p=e-t.worldX,f=s-t.worldY}const o=t.data.length*y,h=Math.sqrt(p*p+f*f);if(i&&h<o||n&&h>o&&o>1e-4){const t=(h/o-1)*a+1;y*=t,r&&(x*=t)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+d*a,y,x,t.ashearX,t.ashearY)}apply2(t,e,s,i,n,r,a,o,h){const l=t.ax,c=t.ay;let u=t.ascaleX,d=t.ascaleY,p=u,f=d,m=e.ascaleX;const g=t.matrix;let y=0,x=0,v=0;u<0?(u=-u,y=180,v=-1):(y=0,v=1),d<0&&(d=-d,v=-v),m<0?(m=-m,x=180):x=0;const _=e.ax;let b=0,w=0,E=0,S=g.a,T=g.c,A=g.b,C=g.d;const M=Math.abs(u-d)<=1e-4;!M||r?(b=0,w=S*_+g.tx,E=A*_+g.ty):(b=e.ay,w=S*_+T*b+g.tx,E=A*_+C*b+g.ty);const I=t.parent.matrix;if(!I)throw new Error("IK parent must itself have a parent.");S=I.a,T=I.c,A=I.b,C=I.d;const P=1/(S*C-T*A);let R=w-I.tx,k=E-I.ty;const D=(R*C-k*T)*P-l,F=(k*S-R*A)*P-c,O=Math.sqrt(D*D+F*F);let N,B,L=e.data.length*m;if(O<1e-4)return this.apply1(t,s,i,!1,r,!1,h),void e.updateWorldTransformWith(_,b,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);R=s-I.tx,k=i-I.ty;let V=(R*C-k*T)*P-l,$=(k*S-R*A)*P-c,U=V*V+$*$;if(0!=o){o*=u*(m+1)*.5;const t=Math.sqrt(U),e=t-O-L*u+o;if(e>0){let s=Math.min(1,e/(2*o))-1;s=(e-o*(1-s*s))/t,V-=s*V,$-=s*$,U=V*V+$*$}}t:if(M){L*=u;let t=(U-O*O-L*L)/(2*O*L);t<-1?(t=-1,B=Math.PI*n):t>1?(t=1,B=0,r&&(S=(Math.sqrt(U)/(O+L)-1)*h+1,p*=S,a&&(f*=S))):B=Math.acos(t)*n,S=O+L*t,T=L*Math.sin(B),N=Math.atan2($*S-V*T,V*S+$*T)}else{S=u*L,T=d*L;const t=S*S,e=T*T,s=Math.atan2($,V);A=e*O*O+t*U-t*e;const i=-2*e*O,r=e-t;if(C=i*i-4*r*A,C>=0){let t=Math.sqrt(C);i<0&&(t=-t),t=.5*-(i+t);const e=t/r,a=A/t,o=Math.abs(e)<Math.abs(a)?e:a;if(o*o<=U){k=Math.sqrt(U-o*o)*n,N=s-Math.atan2(k,o),B=Math.atan2(k/d,(o-O)/u);break t}}let a=Lx.PI,o=O-S,h=o*o,l=0,c=0,p=O+S,f=p*p,m=0;A=-S*O/(t-e),A>=-1&&A<=1&&(A=Math.acos(A),R=S*Math.cos(A)+O,k=T*Math.sin(A),C=R*R+k*k,C<h&&(a=A,h=C,o=R,l=k),C>f&&(c=A,f=C,p=R,m=k)),U<=.5*(h+f)?(N=s-Math.atan2(l*n,o),B=a*n):(N=s-Math.atan2(m*n,p),B=c*n)}const X=Math.atan2(b,_)*v;let Y=t.arotation;N=(N-X)*Lx.radDeg+y-Y,N>180?N-=360:N<-180&&(N+=360),t.updateWorldTransformWith(l,c,Y+N*h,p,f,0,0),Y=e.arotation,B=((B+X)*Lx.radDeg-e.ashearX)*v+x-Y,B>180?B-=360:B<-180&&(B+=360),e.updateWorldTransformWith(_,b,Y+B*h,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}}class SE extends _E{constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.softness=0}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}}class TE extends _E{constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.positionMode=bx.Fixed,this.spacingMode=AE.Fixed,this.rotateMode=wx.Chain,this.offsetRotation=0,this.position=0,this.spacing=0,this.mixRotate=0,this.mixX=0,this.mixY=0}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("SlotData not set.")}}var AE=(t=>(t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent",t[t.Proportional=3]="Proportional",t))(AE||{});const CE=class{constructor(t,e){if(this.position=0,this.spacing=0,this.mixRotate=0,this.mixX=0,this.mixY=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let i=0,n=t.bones.length;i<n;i++){const s=e.findBone(t.bones[i].name);if(!s)throw new Error(`Couldn't find bone ${t.bones[i].name}.`);this.bones.push(s)}const s=e.findSlot(t.target.name);if(!s)throw new Error(`Couldn't find target bone ${t.target.name}`);this.target=s,this.position=t.position,this.spacing=t.spacing,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY}isActive(){return this.active}update(){const t=this.target.getAttachment();if(!(t instanceof Kb))return;const e=this.mixRotate,s=this.mixX,i=this.mixY;if(0==e&&0==s&&0==i)return;const n=this.data,r=n.rotateMode==wx.Tangent,a=n.rotateMode==wx.ChainScale,o=this.bones,h=o.length,l=r?h:h+1,c=Yx.setArraySize(this.spaces,l),u=a?this.lengths=Yx.setArraySize(this.lengths,h):[],d=this.spacing;switch(n.spacingMode){case AE.Percent:if(a)for(let s=0,i=l-1;s<i;s++){const t=o[s],e=t.data.length;if(e<CE.epsilon)u[s]=0;else{const i=e*t.matrix.a,n=e*t.matrix.b;u[s]=Math.sqrt(i*i+n*n)}}Yx.arrayFill(c,1,l,d);break;case AE.Proportional:let t=0;for(let s=0,i=l-1;s<i;){const e=o[s],i=e.data.length;if(i<CE.epsilon)a&&(u[s]=0),c[++s]=d;else{const n=i*e.matrix.a,r=i*e.matrix.b,o=Math.sqrt(n*n+r*r);a&&(u[s]=o),c[++s]=o,t+=o}}if(t>0){t=l/t*d;for(let e=1;e<l;e++)c[e]*=t}break;default:const e=n.spacingMode==AE.Length;for(let s=0,i=l-1;s<i;){const t=o[s],i=t.data.length;if(i<CE.epsilon)a&&(u[s]=0),c[++s]=d;else{const n=i*t.matrix.a,r=i*t.matrix.b,o=Math.sqrt(n*n+r*r);a&&(u[s]=o),c[++s]=(e?i+d:d)*o/i}}}const p=this.computeWorldPositions(t,l,r);let f=p[0],m=p[1],g=n.offsetRotation,y=!1;if(0==g)y=n.rotateMode==wx.Chain;else{y=!1;const t=this.target.bone.matrix;g*=t.a*t.d-t.b*t.c>0?Lx.degRad:-Lx.degRad}for(let x=0,v=3;x<h;x++,v+=3){const t=o[x],n=t.matrix;n.tx+=(f-n.tx)*s,n.ty+=(m-n.ty)*i;const h=p[v],l=p[v+1],d=h-f,_=l-m;if(a){const t=u[x];if(0!=t){const s=(Math.sqrt(d*d+_*_)/t-1)*e+1;n.a*=s,n.b*=s}}if(f=h,m=l,e>0){const s=n.a,i=n.c,a=n.b,o=n.d;let h=0,l=0,u=0;if(h=r?p[v-1]:0==c[x+1]?p[v+2]:Math.atan2(_,d),h-=Math.atan2(a,s),y){l=Math.cos(h),u=Math.sin(h);const i=t.data.length;f+=(i*(l*s-u*a)-d)*e,m+=(i*(u*s+l*a)-_)*e}else h+=g;h>Lx.PI?h-=Lx.PI2:h<-Lx.PI&&(h+=Lx.PI2),h*=e,l=Math.cos(h),u=Math.sin(h),n.a=l*s-u*a,n.c=l*i-u*o,n.b=u*s+l*a,n.d=u*i+l*o}t.updateAppliedTransform()}}computeWorldPositions(t,e,s){const i=this.target;let n=this.position;const r=this.spaces,a=Yx.setArraySize(this.positions,3*e+2);let o=this.world;const h=t.closed;let l=t.worldVerticesLength,c=l/6,u=CE.NONE;if(!t.constantSpeed){const d=t.lengths;c-=h?1:2;const p=d[c];let f;switch(this.data.positionMode==bx.Percent&&(n*=p),this.data.spacingMode){case AE.Percent:f=p;break;case AE.Proportional:f=p/e;break;default:f=1}o=Yx.setArraySize(this.world,8);for(let m=0,g=0,y=0;m<e;m++,g+=3){const e=r[m]*f;n+=e;let x=n;if(h)x%=p,x<0&&(x+=p),y=0;else{if(x<0){u!=CE.BEFORE&&(u=CE.BEFORE,t.computeWorldVertices(i,2,4,o,0,2)),this.addBeforePosition(x,o,0,a,g);continue}if(x>p){u!=CE.AFTER&&(u=CE.AFTER,t.computeWorldVertices(i,l-6,4,o,0,2)),this.addAfterPosition(x-p,o,0,a,g);continue}}for(;;y++){const t=d[y];if(!(x>t)){if(0==y)x/=t;else{const e=d[y-1];x=(x-e)/(t-e)}break}}y!=u&&(u=y,h&&y==c?(t.computeWorldVertices(i,l-4,4,o,0,2),t.computeWorldVertices(i,0,4,o,4,2)):t.computeWorldVertices(i,6*y+2,8,o,0,2)),this.addCurvePosition(x,o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],a,g,s||m>0&&0==e)}return a}h?(l+=2,o=Yx.setArraySize(this.world,l),t.computeWorldVertices(i,2,l-4,o,0,2),t.computeWorldVertices(i,0,2,o,l-4,2),o[l-2]=o[0],o[l-1]=o[1]):(c--,l-=4,o=Yx.setArraySize(this.world,l),t.computeWorldVertices(i,2,l,o,0,2));const d=Yx.setArraySize(this.curves,c);let p,f=0,m=o[0],g=o[1],y=0,x=0,v=0,_=0,b=0,w=0,E=0,S=0,T=0,A=0,C=0,M=0,I=0,P=0;for(let D=0,F=2;D<c;D++,F+=6)y=o[F],x=o[F+1],v=o[F+2],_=o[F+3],b=o[F+4],w=o[F+5],E=.1875*(m-2*y+v),S=.1875*(g-2*x+_),T=.09375*(3*(y-v)-m+b),A=.09375*(3*(x-_)-g+w),C=2*E+T,M=2*S+A,I=.75*(y-m)+E+.16666667*T,P=.75*(x-g)+S+.16666667*A,f+=Math.sqrt(I*I+P*P),I+=C,P+=M,C+=T,M+=A,f+=Math.sqrt(I*I+P*P),I+=C,P+=M,f+=Math.sqrt(I*I+P*P),I+=C+T,P+=M+A,f+=Math.sqrt(I*I+P*P),d[D]=f,m=b,g=w;switch(this.data.positionMode==bx.Percent&&(n*=f),this.data.spacingMode){case AE.Percent:p=f;break;case AE.Proportional:p=f/e;break;default:p=1}const R=this.segments;let k=0;for(let D=0,F=0,O=0,N=0;D<e;D++,F+=3){const t=r[D]*p;n+=t;let e=n;if(h)e%=f,e<0&&(e+=f),O=0;else{if(e<0){this.addBeforePosition(e,o,0,a,F);continue}if(e>f){this.addAfterPosition(e-f,o,l-4,a,F);continue}}for(;;O++){const t=d[O];if(!(e>t)){if(0==O)e/=t;else{const s=d[O-1];e=(e-s)/(t-s)}break}}if(O!=u){u=O;let t=6*O;for(m=o[t],g=o[t+1],y=o[t+2],x=o[t+3],v=o[t+4],_=o[t+5],b=o[t+6],w=o[t+7],E=.03*(m-2*y+v),S=.03*(g-2*x+_),T=.006*(3*(y-v)-m+b),A=.006*(3*(x-_)-g+w),C=2*E+T,M=2*S+A,I=.3*(y-m)+E+.16666667*T,P=.3*(x-g)+S+.16666667*A,k=Math.sqrt(I*I+P*P),R[0]=k,t=1;t<8;t++)I+=C,P+=M,C+=T,M+=A,k+=Math.sqrt(I*I+P*P),R[t]=k;I+=C,P+=M,k+=Math.sqrt(I*I+P*P),R[8]=k,I+=C+T,P+=M+A,k+=Math.sqrt(I*I+P*P),R[9]=k,N=0}for(e*=k;;N++){const t=R[N];if(!(e>t)){if(0==N)e/=t;else{const s=R[N-1];e=N+(e-s)/(t-s)}break}}this.addCurvePosition(.1*e,m,g,y,x,v,_,b,w,a,F,s||D>0&&0==t)}return a}addBeforePosition(t,e,s,i,n){const r=e[s],a=e[s+1],o=e[s+2]-r,h=e[s+3]-a,l=Math.atan2(h,o);i[n]=r+t*Math.cos(l),i[n+1]=a+t*Math.sin(l),i[n+2]=l}addAfterPosition(t,e,s,i,n){const r=e[s+2],a=e[s+3],o=r-e[s],h=a-e[s+1],l=Math.atan2(h,o);i[n]=r+t*Math.cos(l),i[n+1]=a+t*Math.sin(l),i[n+2]=l}addCurvePosition(t,e,s,i,n,r,a,o,h,l,c,u){if(0==t||isNaN(t))return l[c]=e,l[c+1]=s,void(l[c+2]=Math.atan2(n-s,i-e));const d=t*t,p=d*t,f=1-t,m=f*f,g=m*f,y=f*t,x=3*y,v=f*x,_=x*t,b=e*g+i*v+r*_+o*p,w=s*g+n*v+a*_+h*p;l[c]=b,l[c+1]=w,u&&(l[c+2]=t<.001?Math.atan2(n-s,i-e):Math.atan2(w-(s*m+n*y*2+a*d),b-(e*m+i*y*2+r*d)))}};let ME=CE;ME.NONE=-1,ME.BEFORE=-2,ME.AFTER=-3,ME.epsilon=1e-5;class IE{constructor(t,e){if(this.darkColor=null,this.attachment=null,this.attachmentState=0,this.sequenceIndex=-1,this.deform=new Array,!t)throw new Error("data cannot be null.");if(!e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new Nx,this.darkColor=t.darkColor?new Nx:null,this.setToSetupPose(),this.blendMode=this.data.blendMode}getSkeleton(){return this.bone.skeleton}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(t instanceof Gb&&this.attachment instanceof Gb&&t.timelineAttachment==this.attachment.timelineAttachment||(this.deform.length=0),this.attachment=t,this.sequenceIndex=-1)}setToSetupPose(){this.color.setFromColor(this.data.color),this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),this.data.attachmentName?(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName))):this.attachment=null}}class PE{constructor(t,e){if(this.mixRotate=0,this.mixX=0,this.mixY=0,this.mixScaleX=0,this.mixScaleY=0,this.mixShearY=0,this.temp=new jx,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY,this.mixScaleX=t.mixScaleX,this.mixScaleY=t.mixScaleY,this.mixShearY=t.mixShearY,this.bones=new Array;for(let i=0;i<t.bones.length;i++){const s=e.findBone(t.bones[i].name);if(!s)throw new Error(`Couldn't find bone ${t.bones[i].name}.`);this.bones.push(s)}const s=e.findBone(t.target.name);if(!s)throw new Error(`Couldn't find target bone ${t.target.name}.`);this.target=s}isActive(){return this.active}update(){0==this.mixRotate&&0==this.mixX&&0==this.mixY&&0==this.mixScaleX&&0==this.mixScaleX&&0==this.mixShearY||(this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld())}applyAbsoluteWorld(){const t=this.mixRotate,e=this.mixX,s=this.mixY,i=this.mixScaleX,n=this.mixScaleY,r=this.mixShearY,a=0!=e||0!=s,o=this.target,h=o.matrix,l=h.a,c=h.c,u=h.b,d=h.d,p=l*d-c*u>0?Lx.degRad:-Lx.degRad,f=this.data.offsetRotation*p,m=this.data.offsetShearY*p,g=this.bones;for(let y=0,x=g.length;y<x;y++){const h=g[y],p=h.matrix;if(0!=t){const e=p.a,s=p.c,i=p.b,n=p.d;let r=Math.atan2(u,l)-Math.atan2(i,e)+f;r>Lx.PI?r-=Lx.PI2:r<-Lx.PI&&(r+=Lx.PI2),r*=t;const a=Math.cos(r),o=Math.sin(r);p.a=a*e-o*i,p.c=a*s-o*n,p.b=o*e+a*i,p.d=o*s+a*n}if(a){const t=this.temp;o.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),p.tx+=(t.x-p.tx)*e,p.ty+=(t.y-p.ty)*s}if(0!=i){let t=Math.sqrt(p.a*p.a+p.b*p.b);0!=t&&(t=(t+(Math.sqrt(l*l+u*u)-t+this.data.offsetScaleX)*i)/t),p.a*=t,p.b*=t}if(0!=n){let t=Math.sqrt(p.c*p.c+p.d*p.d);0!=t&&(t=(t+(Math.sqrt(c*c+d*d)-t+this.data.offsetScaleY)*n)/t),p.c*=t,p.d*=t}if(r>0){const t=p.c,e=p.d,s=Math.atan2(e,t);let i=Math.atan2(d,c)-Math.atan2(u,l)-(s-Math.atan2(p.b,p.a));i>Lx.PI?i-=Lx.PI2:i<-Lx.PI&&(i+=Lx.PI2),i=s+(i+m)*r;const n=Math.sqrt(t*t+e*e);p.c=Math.cos(i)*n,p.d=Math.sin(i)*n}h.updateAppliedTransform()}}applyRelativeWorld(){const t=this.mixRotate,e=this.mixX,s=this.mixY,i=this.mixScaleX,n=this.mixScaleY,r=this.mixShearY,a=0!=e||0!=s,o=this.target,h=o.matrix,l=h.a,c=h.c,u=h.b,d=h.d,p=l*d-c*u>0?Lx.degRad:-Lx.degRad,f=this.data.offsetRotation*p,m=this.data.offsetShearY*p,g=this.bones;for(let y=0,x=g.length;y<x;y++){const h=g[y],p=h.matrix;if(0!=t){const e=p.a,s=p.c,i=p.b,n=p.d;let r=Math.atan2(u,l)+f;r>Lx.PI?r-=Lx.PI2:r<-Lx.PI&&(r+=Lx.PI2),r*=t;const a=Math.cos(r),o=Math.sin(r);p.a=a*e-o*i,p.c=a*s-o*n,p.b=o*e+a*i,p.d=o*s+a*n}if(a){const t=this.temp;o.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),p.tx+=t.x*e,p.ty+=t.y*s}if(0!=i){const t=(Math.sqrt(l*l+u*u)-1+this.data.offsetScaleX)*i+1;p.a*=t,p.b*=t}if(0!=n){const t=(Math.sqrt(c*c+d*d)-1+this.data.offsetScaleY)*n+1;p.c*=t,p.d*=t}if(r>0){let t=Math.atan2(d,c)-Math.atan2(u,l);t>Lx.PI?t-=Lx.PI2:t<-Lx.PI&&(t+=Lx.PI2);const e=p.c,s=p.d;t=Math.atan2(s,e)+(t-Lx.PI/2+m)*r;const i=Math.sqrt(e*e+s*s);p.c=Math.cos(t)*i,p.d=Math.sin(t)*i}h.updateAppliedTransform()}}applyAbsoluteLocal(){const t=this.mixRotate,e=this.mixX,s=this.mixY,i=this.mixScaleX,n=this.mixScaleY,r=this.mixShearY,a=this.target,o=this.bones;for(let h=0,l=o.length;h<l;h++){const l=o[h];let c=l.arotation;if(0!=t){let e=a.arotation-c+this.data.offsetRotation;e-=360*(16384-(16384.499999999996-e/360|0)),c+=e*t}let u=l.ax,d=l.ay;u+=(a.ax-u+this.data.offsetX)*e,d+=(a.ay-d+this.data.offsetY)*s;let p=l.ascaleX,f=l.ascaleY;0!=i&&0!=p&&(p=(p+(a.ascaleX-p+this.data.offsetScaleX)*i)/p),0!=n&&0!=f&&(f=(f+(a.ascaleY-f+this.data.offsetScaleY)*n)/f);let m=l.ashearY;if(0!=r){let t=a.ashearY-m+this.data.offsetShearY;t-=360*(16384-(16384.499999999996-t/360|0)),m+=t*r}l.updateWorldTransformWith(u,d,c,p,f,l.ashearX,m)}}applyRelativeLocal(){const t=this.mixRotate,e=this.mixX,s=this.mixY,i=this.mixScaleX,n=this.mixScaleY,r=this.mixShearY,a=this.target,o=this.bones;for(let h=0,l=o.length;h<l;h++){const l=o[h],c=l.arotation+(a.arotation+this.data.offsetRotation)*t,u=l.ax+(a.ax+this.data.offsetX)*e,d=l.ay+(a.ay+this.data.offsetY)*s,p=l.ascaleX*((a.ascaleX-1+this.data.offsetScaleX)*i+1),f=l.ascaleY*((a.ascaleY-1+this.data.offsetScaleY)*n+1),m=l.ashearY+(a.ashearY+this.data.offsetShearY)*r;l.updateWorldTransformWith(u,d,c,p,f,l.ashearX,m)}}}const RE=class{constructor(t){if(this._updateCache=new Array,this.skin=null,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,!t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){const s=t.bones[e];let i;if(s.parent){const t=this.bones[s.parent.index];i=new xE(s,this,t),t.children.push(i)}else i=new xE(s,this,null);this.bones.push(i)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){const s=t.slots[e],i=this.bones[s.boneData.index],n=new IE(s,i);this.slots.push(n),this.drawOrder.push(n)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){const s=t.ikConstraints[e];this.ikConstraints.push(new EE(s,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){const s=t.transformConstraints[e];this.transformConstraints.push(new PE(s,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){const s=t.pathConstraints[e];this.pathConstraints.push(new ME(s,this))}this.color=new Nx(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0;const t=this.bones;for(let h=0,l=t.length;h<l;h++){const e=t[h];e.sorted=e.data.skinRequired,e.active=!e.sorted}if(this.skin){const t=this.skin.bones;for(let e=0,s=this.skin.bones.length;e<s;e++){let s=this.bones[t[e].index];do{s.sorted=!1,s.active=!0,s=s.parent}while(s)}}const e=this.ikConstraints,s=this.transformConstraints,i=this.pathConstraints,n=e.length,r=s.length,a=i.length,o=n+r+a;t:for(let h=0;h<o;h++){for(let t=0;t<n;t++){const s=e[t];if(s.data.order==h){this.sortIkConstraint(s);continue t}}for(let t=0;t<r;t++){const e=s[t];if(e.data.order==h){this.sortTransformConstraint(e);continue t}}for(let t=0;t<a;t++){const e=i[t];if(e.data.order==h){this.sortPathConstraint(e);continue t}}}for(let h=0,l=t.length;h<l;h++)this.sortBone(t[h])}sortIkConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&Yx.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target;this.sortBone(e);const s=t.bones,i=s[0];if(this.sortBone(i),1==s.length)this._updateCache.push(t),this.sortReset(i.children);else{const e=s[s.length-1];this.sortBone(e),this._updateCache.push(t),this.sortReset(i.children),e.sorted=!0}}sortPathConstraint(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||this.skin&&Yx.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target,s=e.data.index,i=e.bone;this.skin&&this.sortPathConstraintAttachment(this.skin,s,i),this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,s,i);for(let o=0,h=this.data.skins.length;o<h;o++)this.sortPathConstraintAttachment(this.data.skins[o],s,i);const n=e.getAttachment();n instanceof Kb&&this.sortPathConstraintAttachmentWith(n,i);const r=t.bones,a=r.length;for(let o=0;o<a;o++)this.sortBone(r[o]);this._updateCache.push(t);for(let o=0;o<a;o++)this.sortReset(r[o].children);for(let o=0;o<a;o++)r[o].sorted=!0}sortTransformConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&Yx.contains(this.skin.constraints,t.data,!0)),!t.active)return;this.sortBone(t.target);const e=t.bones,s=e.length;if(t.data.local)for(let i=0;i<s;i++){const t=e[i];this.sortBone(t.parent),this.sortBone(t)}else for(let i=0;i<s;i++)this.sortBone(e[i]);this._updateCache.push(t);for(let i=0;i<s;i++)this.sortReset(e[i].children);for(let i=0;i<s;i++)e[i].sorted=!0}sortPathConstraintAttachment(t,e,s){const i=t.attachments[e];if(i)for(const n in i)this.sortPathConstraintAttachmentWith(i[n],s)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof Kb))return;const s=t.bones;if(s){const t=this.bones;for(let e=0,i=s.length;e<i;){let i=s[e++];for(i+=e;e<i;)this.sortBone(t[s[e++]])}}else this.sortBone(e)}sortBone(t){if(!t)return;if(t.sorted)return;const e=t.parent;e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,s=t.length;e<s;e++){const s=t[e];s.active&&(s.sorted&&this.sortReset(s.children),s.sorted=!1)}}updateWorldTransform(){const t=this.bones;for(let s=0,i=t.length;s<i;s++){const e=t[s];e.ax=e.x,e.ay=e.y,e.arotation=e.rotation,e.ascaleX=e.scaleX,e.ascaleY=e.scaleY,e.ashearX=e.shearX,e.ashearY=e.shearY}const e=this._updateCache;for(let s=0,i=e.length;s<i;s++)e[s].update()}updateWorldTransformWith(t){const e=this.getRootBone(),s=t.matrix.a,i=t.matrix.c,n=t.matrix.b,r=t.matrix.d;e.matrix.tx=s*this.x+i*this.y+t.worldX,e.matrix.ty=n*this.x+r*this.y+t.worldY;const a=e.rotation+90+e.shearY,o=Lx.cosDeg(e.rotation+e.shearX)*e.scaleX,h=Lx.cosDeg(a)*e.scaleY,l=Lx.sinDeg(e.rotation+e.shearX)*e.scaleX,c=Lx.sinDeg(a)*e.scaleY,u=this.scaleX,d=-this.scaleY;e.matrix.a=(s*o+i*l)*u,e.matrix.c=(s*h+i*c)*u,e.matrix.b=(n*o+r*l)*d,e.matrix.d=(n*h+r*c)*d;const p=this._updateCache;for(let f=0,m=p.length;f<m;f++){const t=p[f];t!=e&&t.update()}}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){const t=this.bones;for(let n=0,r=t.length;n<r;n++)t[n].setToSetupPose();const e=this.ikConstraints;for(let n=0,r=e.length;n<r;n++){const t=e[n];t.mix=t.data.mix,t.softness=t.data.softness,t.bendDirection=t.data.bendDirection,t.compress=t.data.compress,t.stretch=t.data.stretch}const s=this.transformConstraints;for(let n=0,r=s.length;n<r;n++){const t=s[n],e=t.data;t.mixRotate=e.mixRotate,t.mixX=e.mixX,t.mixY=e.mixY,t.mixScaleX=e.mixScaleX,t.mixScaleY=e.mixScaleY,t.mixShearY=e.mixShearY}const i=this.pathConstraints;for(let n=0,r=i.length;n<r;n++){const t=i[n],e=t.data;t.position=e.position,t.spacing=e.spacing,t.mixRotate=e.mixRotate,t.mixX=e.mixX,t.mixY=e.mixY}}setSlotsToSetupPose(){const t=this.slots;Yx.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,s=t.length;e<s;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.data.name==t)return i}return null}findBoneIndex(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,i=e.length;s<i;s++)if(e[s].data.name==t)return s;return-1}findSlot(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.data.name==t)return i}return null}findSlotIndex(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,i=e.length;s<i;s++)if(e[s].data.name==t)return s;return-1}setSkinByName(t){const e=this.data.findSkin(t);if(!e)throw new Error(`Skin not found: ${t}`);this.setSkin(e)}setSkin(t){if(t!=this.skin){if(t)if(this.skin)t.attachAll(this,this.skin);else{const e=this.slots;for(let s=0,i=e.length;s<i;s++){const i=e[s],n=i.data.attachmentName;if(n){const e=t.getAttachment(s,n);e&&i.setAttachment(e)}}}this.skin=t,this.updateCache()}}getAttachmentByName(t,e){const s=this.data.findSlot(t);if(!s)throw new Error(`Can't find slot with name ${t}`);return this.getAttachment(s.index,e)}getAttachment(t,e){if(!e)throw new Error("attachmentName cannot be null.");if(this.skin){const s=this.skin.getAttachment(t,e);if(s)return s}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(!t)throw new Error("slotName cannot be null.");const s=this.slots;for(let i=0,n=s.length;i<n;i++){const n=s[i];if(n.data.name==t){let s=null;if(e&&(s=this.getAttachment(i,e),!s))throw new Error(`Attachment not found: ${e}, for slot: ${t}`);return void n.setAttachment(s)}}throw new Error(`Slot not found: ${t}`)}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.data.name==t)return i}return null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.data.name==t)return i}return null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.data.name==t)return i}return null}getBoundsRect(){const t=new jx,e=new jx;return this.getBounds(t,e),{x:t.x,y:t.y,width:e.x,height:e.y}}getBounds(t,e,s=new Array(2)){if(!t)throw new Error("offset cannot be null.");if(!e)throw new Error("size cannot be null.");const i=this.drawOrder;let n=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let h=0,l=i.length;h<l;h++){const t=i[h];if(!t.bone.active)continue;let e=0,l=null;const c=t.getAttachment();if(c instanceof Jb)e=8,l=Yx.setArraySize(s,e,0),c.computeWorldVertices(t,l,0,2);else if(c instanceof qb){const i=c;e=i.worldVerticesLength,l=Yx.setArraySize(s,e,0),i.computeWorldVertices(t,0,e,l,0,2)}if(l)for(let s=0,i=l.length;s<i;s+=2){const t=l[s],e=l[s+1];n=Math.min(n,t),r=Math.min(r,e),a=Math.max(a,t),o=Math.max(o,e)}}t.set(n,r),e.set(a-n,o-r)}get flipX(){return-1==this.scaleX}set flipX(t){RE.deprecatedWarning1||(RE.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleX=t?1:-1}get flipY(){return-1==this.scaleY}set flipY(t){RE.deprecatedWarning1||(RE.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleY=t?1:-1}};let kE=RE;kE.deprecatedWarning1=!1;class DE{constructor(){this.name=null,this.bones=new Array,this.slots=new Array,this.skins=new Array,this.defaultSkin=null,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.x=0,this.y=0,this.width=0,this.height=0,this.version=null,this.hash=null,this.fps=0,this.imagesPath=null,this.audioPath=null}findBone(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findBoneIndex(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,i=e.length;s<i;s++)if(e[s].name==t)return s;return-1}findSlot(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findSlotIndex(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,i=e.length;s<i;s++)if(e[s].name==t)return s;return-1}findSkin(t){if(!t)throw new Error("skinName cannot be null.");const e=this.skins;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findEvent(t){if(!t)throw new Error("eventDataName cannot be null.");const e=this.events;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findAnimation(t){if(!t)throw new Error("animationName cannot be null.");const e=this.animations;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let s=0,i=e.length;s<i;s++){const i=e[s];if(i.name==t)return i}return null}findPathConstraintIndex(t){if(null==t)throw new Error("pathConstraintName cannot be null.");const e=this.pathConstraints;for(let s=0,i=e.length;s<i;s++)if(e[s].name==t)return s;return-1}}class FE{constructor(t,e,s){if(this.index=0,this.color=new Nx(1,1,1,1),this.darkColor=null,this.attachmentName=null,this.blendMode=cr.NORMAL,t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");if(!s)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=s}}class OE extends _E{constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.mixRotate=0,this.mixX=0,this.mixY=0,this.mixScaleX=0,this.mixScaleY=0,this.mixShearY=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}}class NE{constructor(t,e,s){this.slotIndex=t,this.name=e,this.attachment=s}}class BE{constructor(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,!t)throw new Error("name cannot be null.");this.name=t}setAttachment(t,e,s){if(!s)throw new Error("attachment cannot be null.");const i=this.attachments;t>=i.length&&(i.length=t+1),i[t]||(i[t]={}),i[t][e]=s}addSkin(t){for(let s=0;s<t.bones.length;s++){const e=t.bones[s];let i=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==e){i=!0;break}i||this.bones.push(e)}for(let s=0;s<t.constraints.length;s++){const e=t.constraints[s];let i=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==e){i=!0;break}i||this.constraints.push(e)}const e=t.getAttachments();for(let s=0;s<e.length;s++){const t=e[s];this.setAttachment(t.slotIndex,t.name,t.attachment)}}copySkin(t){for(let s=0;s<t.bones.length;s++){const e=t.bones[s];let i=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==e){i=!0;break}i||this.bones.push(e)}for(let s=0;s<t.constraints.length;s++){const e=t.constraints[s];let i=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==e){i=!0;break}i||this.constraints.push(e)}const e=t.getAttachments();for(let s=0;s<e.length;s++){const t=e[s];t.attachment&&(t.attachment instanceof qb?(t.attachment=t.attachment.newLinkedMesh(),this.setAttachment(t.slotIndex,t.name,t.attachment)):(t.attachment=t.attachment.copy(),this.setAttachment(t.slotIndex,t.name,t.attachment)))}}getAttachment(t,e){const s=this.attachments[t];return s?s[e]:null}removeAttachment(t,e){const s=this.attachments[t];s&&delete s[e]}getAttachments(){const t=new Array;for(let e=0;e<this.attachments.length;e++){const s=this.attachments[e];if(s)for(const i in s){const n=s[i];n&&t.push(new NE(e,i,n))}}return t}getAttachmentsForSlot(t,e){const s=this.attachments[t];if(s)for(const i in s){const n=s[i];n&&e.push(new NE(t,i,n))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(t,e){let s=0;for(let i=0;i<t.slots.length;i++){const n=t.slots[i],r=n.getAttachment();if(r&&s<e.attachments.length){const t=e.attachments[s];for(const e in t){if(r==t[e]){const t=this.getAttachment(s,e);t&&n.setAttachment(t);break}}}s++}}}class LE{constructor(t){this.ver40=!1,this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const e=this.scale,s=new DE;s.name="";const i=new xx(t),n=i.readInt32(),r=i.readInt32();s.hash=0==r&&0==n?null:r.toString(16)+n.toString(16),s.version=i.readString();const a=s.version.substr(0,3);if("4.0"!==a&&"4.1"!==a){const t=`Spine 4.1 loader cant load version ${s.version}. Please configure your pixi-spine bundle`;console.error(t)}this.ver40="4.0"===a,s.x=i.readFloat(),s.y=i.readFloat(),s.width=i.readFloat(),s.height=i.readFloat();const o=i.readBoolean();o&&(s.fps=i.readFloat(),s.imagesPath=i.readString(),s.audioPath=i.readString());let h=0;h=i.readInt(!0);for(let c=0;c<h;c++){const t=i.readString();if(!t)throw new Error("String in string table must not be null.");i.strings.push(t)}h=i.readInt(!0);for(let c=0;c<h;c++){const t=i.readString();if(!t)throw new Error("Bone name must not be null.");const n=0==c?null:s.bones[i.readInt(!0)],r=new vE(c,t,n);r.rotation=i.readFloat(),r.x=i.readFloat()*e,r.y=i.readFloat()*e,r.scaleX=i.readFloat(),r.scaleY=i.readFloat(),r.shearX=i.readFloat(),r.shearY=i.readFloat(),r.length=i.readFloat()*e,r.transformMode=i.readInt(!0),r.skinRequired=i.readBoolean(),o&&Nx.rgba8888ToColor(r.color,i.readInt32()),s.bones.push(r)}h=i.readInt(!0);for(let c=0;c<h;c++){const t=i.readString();if(!t)throw new Error("Slot name must not be null.");const e=s.bones[i.readInt(!0)],n=new FE(c,t,e);Nx.rgba8888ToColor(n.color,i.readInt32());const r=i.readInt32();-1!=r&&Nx.rgb888ToColor(n.darkColor=new Nx,r),n.attachmentName=i.readStringRef(),n.blendMode=i.readInt(!0),s.slots.push(n)}h=i.readInt(!0);for(let c,u=0;u<h;u++){const t=i.readString();if(!t)throw new Error("IK constraint data name must not be null.");const n=new SE(t);n.order=i.readInt(!0),n.skinRequired=i.readBoolean(),c=i.readInt(!0);for(let e=0;e<c;e++)n.bones.push(s.bones[i.readInt(!0)]);n.target=s.bones[i.readInt(!0)],n.mix=i.readFloat(),n.softness=i.readFloat()*e,n.bendDirection=i.readByte(),n.compress=i.readBoolean(),n.stretch=i.readBoolean(),n.uniform=i.readBoolean(),s.ikConstraints.push(n)}h=i.readInt(!0);for(let c,u=0;u<h;u++){const t=i.readString();if(!t)throw new Error("Transform constraint data name must not be null.");const n=new OE(t);n.order=i.readInt(!0),n.skinRequired=i.readBoolean(),c=i.readInt(!0);for(let e=0;e<c;e++)n.bones.push(s.bones[i.readInt(!0)]);n.target=s.bones[i.readInt(!0)],n.local=i.readBoolean(),n.relative=i.readBoolean(),n.offsetRotation=i.readFloat(),n.offsetX=i.readFloat()*e,n.offsetY=i.readFloat()*e,n.offsetScaleX=i.readFloat(),n.offsetScaleY=i.readFloat(),n.offsetShearY=i.readFloat(),n.mixRotate=i.readFloat(),n.mixX=i.readFloat(),n.mixY=i.readFloat(),n.mixScaleX=i.readFloat(),n.mixScaleY=i.readFloat(),n.mixShearY=i.readFloat(),s.transformConstraints.push(n)}h=i.readInt(!0);for(let c,u=0;u<h;u++){const t=i.readString();if(!t)throw new Error("Path constraint data name must not be null.");const n=new TE(t);n.order=i.readInt(!0),n.skinRequired=i.readBoolean(),c=i.readInt(!0);for(let e=0;e<c;e++)n.bones.push(s.bones[i.readInt(!0)]);n.target=s.slots[i.readInt(!0)],n.positionMode=i.readInt(!0),n.spacingMode=i.readInt(!0),n.rotateMode=i.readInt(!0),n.offsetRotation=i.readFloat(),n.position=i.readFloat(),n.positionMode==bx.Fixed&&(n.position*=e),n.spacing=i.readFloat(),n.spacingMode!=AE.Length&&n.spacingMode!=AE.Fixed||(n.spacing*=e),n.mixRotate=i.readFloat(),n.mixX=i.readFloat(),n.mixY=i.readFloat(),s.pathConstraints.push(n)}const l=this.readSkin(i,s,!0,o);l&&(s.defaultSkin=l,s.skins.push(l));{let t=s.skins.length;for(Yx.setArraySize(s.skins,h=t+i.readInt(!0));t<h;t++){const e=this.readSkin(i,s,!1,o);if(!e)throw new Error("readSkin() should not have returned null.");s.skins[t]=e}}h=this.linkedMeshes.length;for(let c=0;c<h;c++){const t=this.linkedMeshes[c],e=t.skin?s.findSkin(t.skin):s.defaultSkin;if(!e)throw new Error("Not skin found for linked mesh.");if(!t.parent)throw new Error("Linked mesh parent must not be null");const i=e.getAttachment(t.slotIndex,t.parent);if(!i)throw new Error(`Parent mesh not found: ${t.parent}`);t.mesh.timelineAttachment=t.inheritTimeline?i:t.mesh,t.mesh.setParentMesh(i)}this.linkedMeshes.length=0,h=i.readInt(!0);for(let c=0;c<h;c++){const t=i.readStringRef();if(!t)throw new Error;const e=new wE(t);e.intValue=i.readInt(!1),e.floatValue=i.readFloat(),e.stringValue=i.readString(),e.audioPath=i.readString(),e.audioPath&&(e.volume=i.readFloat(),e.balance=i.readFloat()),s.events.push(e)}h=i.readInt(!0);for(let c=0;c<h;c++){const t=i.readString();if(!t)throw new Error("Animatio name must not be null.");s.animations.push(this.readAnimation(i,t,s))}return s}readSkin(t,e,s,i){let n=null,r=0;if(s){if(r=t.readInt(!0),0==r)return null;n=new BE("default")}else{const s=t.readStringRef();if(!s)throw new Error("Skin name must not be null.");n=new BE(s),n.bones.length=t.readInt(!0);for(let i=0,r=n.bones.length;i<r;i++)n.bones[i]=e.bones[t.readInt(!0)];for(let i=0,r=t.readInt(!0);i<r;i++)n.constraints.push(e.ikConstraints[t.readInt(!0)]);for(let i=0,r=t.readInt(!0);i<r;i++)n.constraints.push(e.transformConstraints[t.readInt(!0)]);for(let i=0,r=t.readInt(!0);i<r;i++)n.constraints.push(e.pathConstraints[t.readInt(!0)]);r=t.readInt(!0)}for(let a=0;a<r;a++){const s=t.readInt(!0);for(let r=0,a=t.readInt(!0);r<a;r++){const r=t.readStringRef();if(!r)throw new Error("Attachment name must not be null");const a=this.readAttachment(t,e,n,s,r,i);a&&n.setAttachment(s,r,a)}}return n}readAttachment(t,e,s,i,n,r){const a=this.scale;let o=t.readStringRef();switch(o||(o=n),t.readByte()){case yx.Region:{let e=t.readStringRef();const i=t.readFloat(),n=t.readFloat(),r=t.readFloat(),h=t.readFloat(),l=t.readFloat(),c=t.readFloat(),u=t.readFloat(),d=t.readInt32(),p=this.readSequence(t);e||(e=o);const f=this.attachmentLoader.newRegionAttachment(s,o,e,p);return f?(f.path=e,f.x=n*a,f.y=r*a,f.scaleX=h,f.scaleY=l,f.rotation=i,f.width=c*a,f.height=u*a,Nx.rgba8888ToColor(f.color,d),f.sequence=p,null==p&&f.updateRegion(),f):null}case yx.BoundingBox:{const e=t.readInt(!0),i=this.readVertices(t,e),n=r?t.readInt32():0,a=this.attachmentLoader.newBoundingBoxAttachment(s,o);return a?(a.worldVerticesLength=e<<1,a.vertices=i.vertices,a.bones=i.bones,r&&Nx.rgba8888ToColor(a.color,n),a):null}case yx.Mesh:{let e=t.readStringRef();const i=t.readInt32(),n=t.readInt(!0),h=this.readFloatArray(t,n<<1,1),l=this.readShortArray(t),c=this.readVertices(t,n),u=t.readInt(!0),d=this.readSequence(t);let p=[],f=0,m=0;r&&(p=this.readShortArray(t),f=t.readFloat(),m=t.readFloat()),e||(e=o);const g=this.attachmentLoader.newMeshAttachment(s,o,e,d);return g?(g.path=e,Nx.rgba8888ToColor(g.color,i),g.bones=c.bones,g.vertices=c.vertices,g.worldVerticesLength=n<<1,g.triangles=l,g.regionUVs=new Float32Array(h),g.hullLength=u<<1,g.sequence=d,r&&(g.edges=p,g.width=f*a,g.height=m*a),g):null}case yx.LinkedMesh:{let e=t.readStringRef();const n=t.readInt32(),h=t.readStringRef(),l=t.readStringRef(),c=t.readBoolean(),u=this.readSequence(t);let d=0,p=0;r&&(d=t.readFloat(),p=t.readFloat()),e||(e=o);const f=this.attachmentLoader.newMeshAttachment(s,o,e,u);return f?(f.path=e,Nx.rgba8888ToColor(f.color,n),f.sequence=u,r&&(f.width=d*a,f.height=p*a),this.linkedMeshes.push(new VE(f,h,i,l,c)),f):null}case yx.Path:{const e=t.readBoolean(),i=t.readBoolean(),n=t.readInt(!0),h=this.readVertices(t,n),l=Yx.newArray(n/3,0);for(let s=0,r=l.length;s<r;s++)l[s]=t.readFloat()*a;const c=r?t.readInt32():0,u=this.attachmentLoader.newPathAttachment(s,o);return u?(u.closed=e,u.constantSpeed=i,u.worldVerticesLength=n<<1,u.vertices=h.vertices,u.bones=h.bones,u.lengths=l,r&&Nx.rgba8888ToColor(u.color,c),u):null}case yx.Point:{const e=t.readFloat(),i=t.readFloat(),n=t.readFloat(),h=r?t.readInt32():0,l=this.attachmentLoader.newPointAttachment(s,o);return l?(l.x=i*a,l.y=n*a,l.rotation=e,r&&Nx.rgba8888ToColor(l.color,h),l):null}case yx.Clipping:{const i=t.readInt(!0),n=t.readInt(!0),a=this.readVertices(t,n),h=r?t.readInt32():0,l=this.attachmentLoader.newClippingAttachment(s,o);return l?(l.endSlot=e.slots[i],l.worldVerticesLength=n<<1,l.vertices=a.vertices,l.bones=a.bones,r&&Nx.rgba8888ToColor(l.color,h),l):null}}return null}readSequence(t){if(this.ver40||!t.readBoolean())return null;const e=new ew(t.readInt(!0));return e.start=t.readInt(!0),e.digits=t.readInt(!0),e.setupIndex=t.readInt(!0),e}readDeformTimelineType(t){return this.ver40?aS:t.readByte()}readVertices(t,e){const s=this.scale,i=e<<1,n=new $E;if(!t.readBoolean())return n.vertices=this.readFloatArray(t,i,s),n;const r=new Array,a=new Array;for(let o=0;o<e;o++){const e=t.readInt(!0);a.push(e);for(let i=0;i<e;i++)a.push(t.readInt(!0)),r.push(t.readFloat()*s),r.push(t.readFloat()*s),r.push(t.readFloat())}return n.vertices=Yx.toFloatArray(r),n.bones=a,n}readFloatArray(t,e,s){const i=new Array(e);if(1==s)for(let n=0;n<e;n++)i[n]=t.readFloat();else for(let n=0;n<e;n++)i[n]=t.readFloat()*s;return i}readShortArray(t){const e=t.readInt(!0),s=new Array(e);for(let i=0;i<e;i++)s[i]=t.readShort();return s}readAnimation(t,e,s){t.readInt(!0);const i=new Array,n=this.scale;for(let h=0,l=t.readInt(!0);h<l;h++){const e=t.readInt(!0);for(let s=0,n=t.readInt(!0);s<n;s++){const s=t.readByte(),n=t.readInt(!0),r=n-1;switch(s){case tS:{const s=new Ww(n,e);for(let e=0;e<n;e++)s.setFrame(e,t.readFloat(),t.readStringRef());i.push(s);break}case eS:{const s=t.readInt(!0),a=new Vw(n,s,e);let o=t.readFloat(),h=t.readUnsignedByte()/255,l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255;for(let e=0,i=0;a.setFrame(e,o,h,l,c,u),e!=r;e++){const s=t.readFloat(),n=t.readUnsignedByte()/255,r=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,p=t.readUnsignedByte()/255;switch(t.readByte()){case uS:a.setStepped(e);break;case dS:YE(t,a,i++,e,0,o,s,h,n,1),YE(t,a,i++,e,1,o,s,l,r,1),YE(t,a,i++,e,2,o,s,c,d,1),YE(t,a,i++,e,3,o,s,u,p,1)}o=s,h=n,l=r,c=d,u=p}i.push(a);break}case sS:{const s=t.readInt(!0),a=new $w(n,s,e);let o=t.readFloat(),h=t.readUnsignedByte()/255,l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255;for(let e=0,i=0;a.setFrame(e,o,h,l,c),e!=r;e++){const s=t.readFloat(),n=t.readUnsignedByte()/255,r=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255;switch(t.readByte()){case uS:a.setStepped(e);break;case dS:YE(t,a,i++,e,0,o,s,h,n,1),YE(t,a,i++,e,1,o,s,l,r,1),YE(t,a,i++,e,2,o,s,c,u,1)}o=s,h=n,l=r,c=u}i.push(a);break}case iS:{const s=t.readInt(!0),a=new Xw(n,s,e);let o=t.readFloat(),h=t.readUnsignedByte()/255,l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,p=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255;for(let e=0,i=0;a.setFrame(e,o,h,l,c,u,d,p,f),e!=r;e++){const s=t.readFloat(),n=t.readUnsignedByte()/255,r=t.readUnsignedByte()/255,m=t.readUnsignedByte()/255,g=t.readUnsignedByte()/255,y=t.readUnsignedByte()/255,x=t.readUnsignedByte()/255,v=t.readUnsignedByte()/255;switch(t.readByte()){case uS:a.setStepped(e);break;case dS:YE(t,a,i++,e,0,o,s,h,n,1),YE(t,a,i++,e,1,o,s,l,r,1),YE(t,a,i++,e,2,o,s,c,m,1),YE(t,a,i++,e,3,o,s,u,g,1),YE(t,a,i++,e,4,o,s,d,y,1),YE(t,a,i++,e,5,o,s,p,x,1),YE(t,a,i++,e,6,o,s,f,v,1)}o=s,h=n,l=r,c=m,u=g,d=y,p=x,f=v}i.push(a);break}case nS:{const s=t.readInt(!0),a=new Yw(n,s,e);let o=t.readFloat(),h=t.readUnsignedByte()/255,l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,p=t.readUnsignedByte()/255;for(let e=0,i=0;a.setFrame(e,o,h,l,c,u,d,p),e!=r;e++){const s=t.readFloat(),n=t.readUnsignedByte()/255,r=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255,m=t.readUnsignedByte()/255,g=t.readUnsignedByte()/255,y=t.readUnsignedByte()/255;switch(t.readByte()){case uS:a.setStepped(e);break;case dS:YE(t,a,i++,e,0,o,s,h,n,1),YE(t,a,i++,e,1,o,s,l,r,1),YE(t,a,i++,e,2,o,s,c,f,1),YE(t,a,i++,e,3,o,s,u,m,1),YE(t,a,i++,e,4,o,s,d,g,1),YE(t,a,i++,e,5,o,s,p,y,1)}o=s,h=n,l=r,c=f,u=m,d=g,p=y}i.push(a);break}case rS:{const s=new Uw(n,t.readInt(!0),e);let a=t.readFloat(),o=t.readUnsignedByte()/255;for(let e=0,i=0;s.setFrame(e,a,o),e!=r;e++){const n=t.readFloat(),r=t.readUnsignedByte()/255;switch(t.readByte()){case uS:s.setStepped(e);break;case dS:YE(t,s,i++,e,0,a,n,o,r,1)}a=n,o=r}i.push(s)}}}}for(let h=0,l=t.readInt(!0);h<l;h++){const e=t.readInt(!0);for(let s=0,r=t.readInt(!0);s<r;s++){const s=t.readByte(),r=t.readInt(!0),a=t.readInt(!0);switch(s){case WE:i.push(UE(t,new Iw(r,a,e),1));break;case jE:i.push(XE(t,new Pw(r,a,e),n));break;case GE:i.push(UE(t,new Rw(r,a,e),n));break;case zE:i.push(UE(t,new kw(r,a,e),n));break;case HE:i.push(XE(t,new Dw(r,a,e),1));break;case qE:i.push(UE(t,new Fw(r,a,e),1));break;case KE:i.push(UE(t,new Ow(r,a,e),1));break;case ZE:i.push(XE(t,new Nw(r,a,e),1));break;case QE:i.push(UE(t,new Bw(r,a,e),1));break;case JE:i.push(UE(t,new Lw(r,a,e),1))}}}for(let h=0,l=t.readInt(!0);h<l;h++){const e=t.readInt(!0),s=t.readInt(!0),r=s-1,a=new Kw(s,t.readInt(!0),e);let o=t.readFloat(),h=t.readFloat(),l=t.readFloat()*n;for(let i=0,c=0;a.setFrame(i,o,h,l,t.readByte(),t.readBoolean(),t.readBoolean()),i!=r;i++){const e=t.readFloat(),s=t.readFloat(),r=t.readFloat()*n;switch(t.readByte()){case uS:a.setStepped(i);break;case dS:YE(t,a,c++,i,0,o,e,h,s,1),YE(t,a,c++,i,1,o,e,l,r,n)}o=e,h=s,l=r}i.push(a)}for(let h=0,l=t.readInt(!0);h<l;h++){const e=t.readInt(!0),s=t.readInt(!0),n=s-1,r=new Zw(s,t.readInt(!0),e);let a=t.readFloat(),o=t.readFloat(),h=t.readFloat(),l=t.readFloat(),c=t.readFloat(),u=t.readFloat(),d=t.readFloat();for(let i=0,p=0;r.setFrame(i,a,o,h,l,c,u,d),i!=n;i++){const e=t.readFloat(),s=t.readFloat(),n=t.readFloat(),f=t.readFloat(),m=t.readFloat(),g=t.readFloat(),y=t.readFloat();switch(t.readByte()){case uS:r.setStepped(i);break;case dS:YE(t,r,p++,i,0,a,e,o,s,1),YE(t,r,p++,i,1,a,e,h,n,1),YE(t,r,p++,i,2,a,e,l,f,1),YE(t,r,p++,i,3,a,e,c,m,1),YE(t,r,p++,i,4,a,e,u,g,1),YE(t,r,p++,i,5,a,e,d,y,1)}a=e,o=s,h=n,l=f,c=m,u=g,d=y}i.push(r)}for(let h=0,l=t.readInt(!0);h<l;h++){const e=t.readInt(!0),r=s.pathConstraints[e];for(let s=0,a=t.readInt(!0);s<a;s++)switch(t.readByte()){case hS:i.push(UE(t,new Qw(t.readInt(!0),t.readInt(!0),e),r.positionMode==bx.Fixed?n:1));break;case lS:i.push(UE(t,new Jw(t.readInt(!0),t.readInt(!0),e),r.spacingMode==AE.Length||r.spacingMode==AE.Fixed?n:1));break;case cS:const s=new tE(t.readInt(!0),t.readInt(!0),e);let a=t.readFloat(),o=t.readFloat(),h=t.readFloat(),l=t.readFloat();for(let e=0,i=0,n=s.getFrameCount()-1;s.setFrame(e,a,o,h,l),e!=n;e++){const n=t.readFloat(),r=t.readFloat(),c=t.readFloat(),u=t.readFloat();switch(t.readByte()){case uS:s.setStepped(e);break;case dS:YE(t,s,i++,e,0,a,n,o,r,1),YE(t,s,i++,e,1,a,n,h,c,1),YE(t,s,i++,e,2,a,n,l,u,1)}a=n,o=r,h=c,l=u}i.push(s)}}for(let h=0,l=t.readInt(!0);h<l;h++){const e=s.skins[t.readInt(!0)];for(let s=0,r=t.readInt(!0);s<r;s++){const s=t.readInt(!0);for(let r=0,a=t.readInt(!0);r<a;r++){const r=t.readStringRef();if(!r)throw new Error("attachmentName must not be null.");const a=e.getAttachment(s,r),o=this.readDeformTimelineType(t),h=t.readInt(!0),l=h-1;switch(o){case aS:{const e=a,r=e.bones,o=e.vertices,c=r?o.length/3*2:o.length,u=t.readInt(!0),d=new jw(h,u,s,e);let p=t.readFloat();for(let s=0,i=0;;s++){let e,a=t.readInt(!0);if(0==a)e=r?Yx.newFloatArray(c):o;else{e=Yx.newFloatArray(c);const s=t.readInt(!0);if(a+=s,1==n)for(let i=s;i<a;i++)e[i]=t.readFloat();else for(let i=s;i<a;i++)e[i]=t.readFloat()*n;if(!r)for(let t=0,i=e.length;t<i;t++)e[t]+=o[t]}if(d.setFrame(s,p,e),s==l)break;const h=t.readFloat();switch(t.readByte()){case uS:d.setStepped(s);break;case dS:YE(t,d,i++,s,0,p,h,0,1,1)}p=h}i.push(d);break}case oS:{const e=new sE(h,s,a);for(let s=0;s<h;s++){const i=t.readFloat(),n=t.readInt32();e.setFrame(s,i,iw[15&n],n>>4,t.readFloat())}i.push(e);break}}}}}const r=t.readInt(!0);if(r>0){const e=new qw(r),n=s.slots.length;for(let s=0;s<r;s++){const i=t.readFloat(),r=t.readInt(!0),a=Yx.newArray(n,0);for(let t=n-1;t>=0;t--)a[t]=-1;const o=Yx.newArray(n-r,0);let h=0,l=0;for(let e=0;e<r;e++){const e=t.readInt(!0);for(;h!=e;)o[l++]=h++;a[h+t.readInt(!0)]=h++}for(;h<n;)o[l++]=h++;for(let t=n-1;t>=0;t--)-1==a[t]&&(a[t]=o[--l]);e.setFrame(s,i,a)}i.push(e)}const a=t.readInt(!0);if(a>0){const e=new zw(a);for(let i=0;i<a;i++){const n=t.readFloat(),r=s.events[t.readInt(!0)],a=new bE(n,r);a.intValue=t.readInt(!1),a.floatValue=t.readFloat(),a.stringValue=t.readBoolean()?t.readString():r.stringValue,a.data.audioPath&&(a.volume=t.readFloat(),a.balance=t.readFloat()),e.setFrame(i,a)}i.push(e)}let o=0;for(let h=0,l=i.length;h<l;h++)o=Math.max(o,i[h].getDuration());return new nw(e,i,o)}}LE.BlendModeValues=[cr.NORMAL,cr.ADD,cr.MULTIPLY,cr.SCREEN];let VE=class{constructor(t,e,s,i,n){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=i,this.inheritTimeline=n}};class $E{constructor(t=null,e=null){this.bones=t,this.vertices=e}}function UE(t,e,s){let i=t.readFloat(),n=t.readFloat()*s;for(let r=0,a=0,o=e.getFrameCount()-1;e.setFrame(r,i,n),r!=o;r++){const o=t.readFloat(),h=t.readFloat()*s;switch(t.readByte()){case uS:e.setStepped(r);break;case dS:YE(t,e,a++,r,0,i,o,n,h,s)}i=o,n=h}return e}function XE(t,e,s){let i=t.readFloat(),n=t.readFloat()*s,r=t.readFloat()*s;for(let a=0,o=0,h=e.getFrameCount()-1;e.setFrame(a,i,n,r),a!=h;a++){const h=t.readFloat(),l=t.readFloat()*s,c=t.readFloat()*s;switch(t.readByte()){case uS:e.setStepped(a);break;case dS:YE(t,e,o++,a,0,i,h,n,l,s),YE(t,e,o++,a,1,i,h,r,c,s)}i=h,n=l,r=c}return e}function YE(t,e,s,i,n,r,a,o,h,l){e.setBezier(s,i,n,r,o,t.readFloat(),t.readFloat()*l,t.readFloat(),t.readFloat()*l,a,h)}const WE=0,jE=1,GE=2,zE=3,HE=4,qE=5,KE=6,ZE=7,QE=8,JE=9,tS=0,eS=1,sS=2,iS=3,nS=4,rS=5,aS=0,oS=1,hS=0,lS=1,cS=2,uS=1,dS=2;class pS{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const e=this.scale,s=new DE,i="string"==typeof t?JSON.parse(t):t,n=i.skeleton;if(n){s.hash=n.hash,s.version=n.spine;const t=s.version.substr(0,3);if("4.0"!==t&&"4.1"!==t){const t=`Spine 4.1 loader cant load version ${n.spine}. Please configure your pixi-spine bundle`;console.error(t)}s.x=n.x,s.y=n.y,s.width=n.width,s.height=n.height,s.fps=n.fps,s.imagesPath=n.images}if(i.bones)for(let r=0;r<i.bones.length;r++){const t=i.bones[r];let n=null;const a=xS(t,"parent",null);if(null!=a&&(n=s.findBone(a),null==n))throw new Error(`Parent bone not found: ${a}`);const o=new vE(s.bones.length,t.name,n);o.length=xS(t,"length",0)*e,o.x=xS(t,"x",0)*e,o.y=xS(t,"y",0)*e,o.rotation=xS(t,"rotation",0),o.scaleX=xS(t,"scaleX",1),o.scaleY=xS(t,"scaleY",1),o.shearX=xS(t,"shearX",0),o.shearY=xS(t,"shearY",0),o.transformMode=Yx.enumValue(Ex,xS(t,"transform","Normal")),o.skinRequired=xS(t,"skin",!1);const h=xS(t,"color",null);h&&o.color.setFromString(h),s.bones.push(o)}if(i.slots)for(let r=0;r<i.slots.length;r++){const t=i.slots[r],e=s.findBone(t.bone);if(!e)throw new Error(`Couldn't find bone ${t.bone} for slot ${t.name}`);const n=new FE(s.slots.length,t.name,e),a=xS(t,"color",null);a&&n.color.setFromString(a);const o=xS(t,"dark",null);o&&(n.darkColor=Nx.fromString(o)),n.attachmentName=xS(t,"attachment",null),n.blendMode=pS.blendModeFromString(xS(t,"blend","normal")),s.slots.push(n)}if(i.ik)for(let r=0;r<i.ik.length;r++){const t=i.ik[r],n=new SE(t.name);n.order=xS(t,"order",0),n.skinRequired=xS(t,"skin",!1);for(let e=0;e<t.bones.length;e++){const i=t.bones[e],r=s.findBone(i);if(null==r)throw new Error(`IK bone not found: ${i}`);n.bones.push(r)}n.target=s.findBone(t.target),n.mix=xS(t,"mix",1),n.softness=xS(t,"softness",0)*e,n.bendDirection=xS(t,"bendPositive",!0)?1:-1,n.compress=xS(t,"compress",!1),n.stretch=xS(t,"stretch",!1),n.uniform=xS(t,"uniform",!1),s.ikConstraints.push(n)}if(i.transform)for(let r=0;r<i.transform.length;r++){const t=i.transform[r],n=new OE(t.name);n.order=xS(t,"order",0),n.skinRequired=xS(t,"skin",!1);for(let e=0;e<t.bones.length;e++){const i=t.bones[e],r=s.findBone(i);if(!r)throw new Error(`Couldn't find bone ${i} for transform constraint ${t.name}.`);n.bones.push(r)}const a=t.target,o=s.findBone(a);if(!o)throw new Error(`Couldn't find target bone ${a} for transform constraint ${t.name}.`);n.target=o,n.local=xS(t,"local",!1),n.relative=xS(t,"relative",!1),n.offsetRotation=xS(t,"rotation",0),n.offsetX=xS(t,"x",0)*e,n.offsetY=xS(t,"y",0)*e,n.offsetScaleX=xS(t,"scaleX",0),n.offsetScaleY=xS(t,"scaleY",0),n.offsetShearY=xS(t,"shearY",0),n.mixRotate=xS(t,"mixRotate",1),n.mixX=xS(t,"mixX",1),n.mixY=xS(t,"mixY",n.mixX),n.mixScaleX=xS(t,"mixScaleX",1),n.mixScaleY=xS(t,"mixScaleY",n.mixScaleX),n.mixShearY=xS(t,"mixShearY",1),s.transformConstraints.push(n)}if(i.path)for(let r=0;r<i.path.length;r++){const t=i.path[r],n=new TE(t.name);n.order=xS(t,"order",0),n.skinRequired=xS(t,"skin",!1);for(let e=0;e<t.bones.length;e++){const i=t.bones[e],r=s.findBone(i);if(!r)throw new Error(`Couldn't find bone ${i} for path constraint ${t.name}.`);n.bones.push(r)}const a=t.target,o=s.findSlot(a);if(!o)throw new Error(`Couldn't find target slot ${a} for path constraint ${t.name}.`);n.target=o,n.positionMode=Yx.enumValue(bx,xS(t,"positionMode","Percent")),n.spacingMode=Yx.enumValue(AE,xS(t,"spacingMode","Length")),n.rotateMode=Yx.enumValue(wx,xS(t,"rotateMode","Tangent")),n.offsetRotation=xS(t,"rotation",0),n.position=xS(t,"position",0),n.positionMode==bx.Fixed&&(n.position*=e),n.spacing=xS(t,"spacing",0),n.spacingMode!=AE.Length&&n.spacingMode!=AE.Fixed||(n.spacing*=e),n.mixRotate=xS(t,"mixRotate",1),n.mixX=xS(t,"mixX",1),n.mixY=xS(t,"mixY",n.mixX),s.pathConstraints.push(n)}if(i.skins)for(let r=0;r<i.skins.length;r++){const t=i.skins[r],e=new BE(t.name);if(t.bones)for(let i=0;i<t.bones.length;i++){const n=t.bones[i],r=s.findBone(n);if(!r)throw new Error(`Couldn't find bone ${n} for skin ${t.name}.`);e.bones.push(r)}if(t.ik)for(let i=0;i<t.ik.length;i++){const n=t.ik[i],r=s.findIkConstraint(n);if(!r)throw new Error(`Couldn't find IK constraint ${n} for skin ${t.name}.`);e.constraints.push(r)}if(t.transform)for(let i=0;i<t.transform.length;i++){const n=t.transform[i],r=s.findTransformConstraint(n);if(!r)throw new Error(`Couldn't find transform constraint ${n} for skin ${t.name}.`);e.constraints.push(r)}if(t.path)for(let i=0;i<t.path.length;i++){const n=t.path[i],r=s.findPathConstraint(n);if(!r)throw new Error(`Couldn't find path constraint ${n} for skin ${t.name}.`);e.constraints.push(r)}for(const i in t.attachments){const n=s.findSlot(i);if(!n)throw new Error(`Couldn't find slot ${i} for skin ${t.name}.`);const r=t.attachments[i];for(const t in r){const i=this.readAttachment(r[t],e,n.index,t,s);i&&e.setAttachment(n.index,t,i)}}s.skins.push(e),"default"==e.name&&(s.defaultSkin=e)}for(let r=0,a=this.linkedMeshes.length;r<a;r++){const t=this.linkedMeshes[r],e=t.skin?s.findSkin(t.skin):s.defaultSkin;if(!e)throw new Error(`Skin not found: ${t.skin}`);const i=e.getAttachment(t.slotIndex,t.parent);if(!i)throw new Error(`Parent mesh not found: ${t.parent}`);t.mesh.timelineAttachment=t.inheritTimeline?i:t.mesh,t.mesh.setParentMesh(i)}if(this.linkedMeshes.length=0,i.events)for(const r in i.events){const t=i.events[r],e=new wE(r);e.intValue=xS(t,"int",0),e.floatValue=xS(t,"float",0),e.stringValue=xS(t,"string",""),e.audioPath=xS(t,"audio",null),e.audioPath&&(e.volume=xS(t,"volume",1),e.balance=xS(t,"balance",0)),s.events.push(e)}if(i.animations)for(const r in i.animations){const t=i.animations[r];this.readAnimation(t,r,s)}return s}readAttachment(t,e,s,i,n){const r=this.scale;switch(i=xS(t,"name",i),xS(t,"type","region")){case"region":{const s=xS(t,"path",i),n=this.readSequence(xS(t,"sequence",null)),a=this.attachmentLoader.newRegionAttachment(e,i,s,n);if(!a)return null;a.path=s,a.x=xS(t,"x",0)*r,a.y=xS(t,"y",0)*r,a.scaleX=xS(t,"scaleX",1),a.scaleY=xS(t,"scaleY",1),a.rotation=xS(t,"rotation",0),a.width=t.width*r,a.height=t.height*r,a.sequence=n;const o=xS(t,"color",null);return o&&a.color.setFromString(o),a}case"boundingbox":{const s=this.attachmentLoader.newBoundingBoxAttachment(e,i);if(!s)return null;this.readVertices(t,s,t.vertexCount<<1);const n=xS(t,"color",null);return n&&s.color.setFromString(n),s}case"mesh":case"linkedmesh":{const n=xS(t,"path",i),a=this.readSequence(xS(t,"sequence",null)),o=this.attachmentLoader.newMeshAttachment(e,i,n,a);if(!o)return null;o.path=n;const h=xS(t,"color",null);h&&o.color.setFromString(h),o.width=xS(t,"width",0)*r,o.height=xS(t,"height",0)*r,o.sequence=a;const l=xS(t,"parent",null);if(l)return this.linkedMeshes.push(new fS(o,xS(t,"skin",null),s,l,xS(t,"timelines",!0))),o;const c=t.uvs;return this.readVertices(t,o,c.length),o.triangles=t.triangles,o.regionUVs=new Float32Array(c),o.edges=xS(t,"edges",null),o.hullLength=2*xS(t,"hull",0),o}case"path":{const s=this.attachmentLoader.newPathAttachment(e,i);if(!s)return null;s.closed=xS(t,"closed",!1),s.constantSpeed=xS(t,"constantSpeed",!0);const n=t.vertexCount;this.readVertices(t,s,n<<1);const a=Yx.newArray(n/3,0);for(let e=0;e<t.lengths.length;e++)a[e]=t.lengths[e]*r;s.lengths=a;const o=xS(t,"color",null);return o&&s.color.setFromString(o),s}case"point":{const s=this.attachmentLoader.newPointAttachment(e,i);if(!s)return null;s.x=xS(t,"x",0)*r,s.y=xS(t,"y",0)*r,s.rotation=xS(t,"rotation",0);const n=xS(t,"color",null);return n&&s.color.setFromString(n),s}case"clipping":{const s=this.attachmentLoader.newClippingAttachment(e,i);if(!s)return null;const r=xS(t,"end",null);if(null!=r){const t=n.findSlot(r);if(null==t)throw new Error(`Clipping end slot not found: ${r}`);s.endSlot=t}const a=t.vertexCount;this.readVertices(t,s,a<<1);const o=xS(t,"color",null);return o&&s.color.setFromString(o),s}}return null}readSequence(t){if(null==t)return null;const e=new ew(xS(t,"count",0));return e.start=xS(t,"start",1),e.digits=xS(t,"digits",0),e.setupIndex=xS(t,"setup",0),e}readVertices(t,e,s){const i=this.scale;e.worldVerticesLength=s;const n=t.vertices;if(s==n.length){const t=Yx.toFloatArray(n);if(1!=i)for(let e=0,s=n.length;e<s;e++)t[e]*=i;return void(e.vertices=t)}const r=new Array,a=new Array;for(let o=0,h=n.length;o<h;){const t=n[o++];a.push(t);for(let e=o+4*t;o<e;o+=4)a.push(n[o]),r.push(n[o+1]*i),r.push(n[o+2]*i),r.push(n[o+3])}e.bones=a,e.vertices=Yx.toFloatArray(r)}readAnimation(t,e,s){const i=this.scale,n=new Array;if(t.slots)for(const a in t.slots){const e=t.slots[a],i=s.findSlot(a);if(!i)throw new Error(`Slot not found: ${a}`);const r=i.index;for(const t in e){const s=e[t];if(!s)continue;const i=s.length;if("attachment"==t){const t=new Ww(i,r);for(let e=0;e<i;e++){const i=s[e];t.setFrame(e,xS(i,"time",0),xS(i,"name",null))}n.push(t)}else if("rgba"==t){const t=new Vw(i,i<<2,r);let e=s[0],a=xS(e,"time",0),o=Nx.fromString(e.color);for(let i=0,n=0;;i++){t.setFrame(i,a,o.r,o.g,o.b,o.a);const r=s[i+1];if(!r){t.shrink(n);break}const h=xS(r,"time",0),l=Nx.fromString(r.color),c=e.curve;c&&(n=yS(c,t,n,i,0,a,h,o.r,l.r,1),n=yS(c,t,n,i,1,a,h,o.g,l.g,1),n=yS(c,t,n,i,2,a,h,o.b,l.b,1),n=yS(c,t,n,i,3,a,h,o.a,l.a,1)),a=h,o=l,e=r}n.push(t)}else if("rgb"==t){const t=new $w(i,3*i,r);let e=s[0],a=xS(e,"time",0),o=Nx.fromString(e.color);for(let i=0,n=0;;i++){t.setFrame(i,a,o.r,o.g,o.b);const r=s[i+1];if(!r){t.shrink(n);break}const h=xS(r,"time",0),l=Nx.fromString(r.color),c=e.curve;c&&(n=yS(c,t,n,i,0,a,h,o.r,l.r,1),n=yS(c,t,n,i,1,a,h,o.g,l.g,1),n=yS(c,t,n,i,2,a,h,o.b,l.b,1)),a=h,o=l,e=r}n.push(t)}else if("alpha"==t)n.push(mS(s,new Uw(i,i,r),0,1));else if("rgba2"==t){const t=new Xw(i,7*i,r);let e=s[0],a=xS(e,"time",0),o=Nx.fromString(e.light),h=Nx.fromString(e.dark);for(let i=0,n=0;;i++){t.setFrame(i,a,o.r,o.g,o.b,o.a,h.r,h.g,h.b);const r=s[i+1];if(!r){t.shrink(n);break}const l=xS(r,"time",0),c=Nx.fromString(r.light),u=Nx.fromString(r.dark),d=e.curve;d&&(n=yS(d,t,n,i,0,a,l,o.r,c.r,1),n=yS(d,t,n,i,1,a,l,o.g,c.g,1),n=yS(d,t,n,i,2,a,l,o.b,c.b,1),n=yS(d,t,n,i,3,a,l,o.a,c.a,1),n=yS(d,t,n,i,4,a,l,h.r,u.r,1),n=yS(d,t,n,i,5,a,l,h.g,u.g,1),n=yS(d,t,n,i,6,a,l,h.b,u.b,1)),a=l,o=c,h=u,e=r}n.push(t)}else if("rgb2"==t){const t=new Yw(i,6*i,r);let e=s[0],a=xS(e,"time",0),o=Nx.fromString(e.light),h=Nx.fromString(e.dark);for(let i=0,n=0;;i++){t.setFrame(i,a,o.r,o.g,o.b,h.r,h.g,h.b);const r=s[i+1];if(!r){t.shrink(n);break}const l=xS(r,"time",0),c=Nx.fromString(r.light),u=Nx.fromString(r.dark),d=e.curve;d&&(n=yS(d,t,n,i,0,a,l,o.r,c.r,1),n=yS(d,t,n,i,1,a,l,o.g,c.g,1),n=yS(d,t,n,i,2,a,l,o.b,c.b,1),n=yS(d,t,n,i,3,a,l,h.r,u.r,1),n=yS(d,t,n,i,4,a,l,h.g,u.g,1),n=yS(d,t,n,i,5,a,l,h.b,u.b,1)),a=l,o=c,h=u,e=r}n.push(t)}}}if(t.bones)for(const a in t.bones){const e=t.bones[a],r=s.findBone(a);if(!r)throw new Error(`Bone not found: ${a}`);const o=r.index;for(const t in e){const s=e[t],r=s.length;if(0!=r)if("rotate"===t)n.push(mS(s,new Iw(r,r,o),0,1));else if("translate"===t){const t=new Pw(r,r<<1,o);n.push(gS(s,t,"x","y",0,i))}else if("translatex"===t){const t=new Rw(r,r,o);n.push(mS(s,t,0,i))}else if("translatey"===t){const t=new kw(r,r,o);n.push(mS(s,t,0,i))}else if("scale"===t){const t=new Dw(r,r<<1,o);n.push(gS(s,t,"x","y",1,1))}else if("scalex"===t){const t=new Fw(r,r,o);n.push(mS(s,t,1,1))}else if("scaley"===t){const t=new Ow(r,r,o);n.push(mS(s,t,1,1))}else if("shear"===t){const t=new Nw(r,r<<1,o);n.push(gS(s,t,"x","y",0,1))}else if("shearx"===t){const t=new Bw(r,r,o);n.push(mS(s,t,0,1))}else if("sheary"===t){const t=new Lw(r,r,o);n.push(mS(s,t,0,1))}}}if(t.ik)for(const a in t.ik){const e=t.ik[a];let r=e[0];if(!r)continue;const o=s.findIkConstraint(a);if(!o)throw new Error(`IK Constraint not found: ${a}`);const h=s.ikConstraints.indexOf(o),l=new Kw(e.length,e.length<<1,h);let c=xS(r,"time",0),u=xS(r,"mix",1),d=xS(r,"softness",0)*i;for(let t=0,s=0;;t++){l.setFrame(t,c,u,d,xS(r,"bendPositive",!0)?1:-1,xS(r,"compress",!1),xS(r,"stretch",!1));const n=e[t+1];if(!n){l.shrink(s);break}const a=xS(n,"time",0),o=xS(n,"mix",1),h=xS(n,"softness",0)*i,p=r.curve;p&&(s=yS(p,l,s,t,0,c,a,u,o,1),s=yS(p,l,s,t,1,c,a,d,h,i)),c=a,u=o,d=h,r=n}n.push(l)}if(t.transform)for(const a in t.transform){const e=t.transform[a];let i=e[0];if(!i)continue;const r=s.findTransformConstraint(a);if(!r)throw new Error(`Transform constraint not found: ${a}`);const o=s.transformConstraints.indexOf(r),h=new Zw(e.length,6*e.length,o);let l=xS(i,"time",0),c=xS(i,"mixRotate",1),u=xS(i,"mixX",1),d=xS(i,"mixY",u),p=xS(i,"mixScaleX",1),f=xS(i,"mixScaleY",p);const m=xS(i,"mixShearY",1);for(let t=0,s=0;;t++){h.setFrame(t,l,c,u,d,p,f,m);const n=e[t+1];if(!n){h.shrink(s);break}const r=xS(n,"time",0),a=xS(n,"mixRotate",1),o=xS(n,"mixX",1),g=xS(n,"mixY",o),y=xS(n,"mixScaleX",1),x=xS(n,"mixScaleY",y),v=xS(n,"mixShearY",1),_=i.curve;_&&(s=yS(_,h,s,t,0,l,r,c,a,1),s=yS(_,h,s,t,1,l,r,u,o,1),s=yS(_,h,s,t,2,l,r,d,g,1),s=yS(_,h,s,t,3,l,r,p,y,1),s=yS(_,h,s,t,4,l,r,f,x,1),s=yS(_,h,s,t,5,l,r,m,v,1)),l=r,c=a,u=o,d=g,p=y,f=x,p=y,i=n}n.push(h)}if(t.path)for(const a in t.path){const e=t.path[a],r=s.findPathConstraint(a);if(!r)throw new Error(`Path constraint not found: ${a}`);const o=s.pathConstraints.indexOf(r);for(const t in e){const s=e[t];let a=s[0];if(!a)continue;const h=s.length;if("position"===t){const t=new Qw(h,h,o);n.push(mS(s,t,0,r.positionMode==bx.Fixed?i:1))}else if("spacing"===t){const t=new Jw(h,h,o);n.push(mS(s,t,0,r.spacingMode==AE.Length||r.spacingMode==AE.Fixed?i:1))}else if("mix"===t){const t=new tE(h,3*h,o);let e=xS(a,"time",0),i=xS(a,"mixRotate",1),r=xS(a,"mixX",1),l=xS(a,"mixY",r);for(let n=0,o=0;;n++){t.setFrame(n,e,i,r,l);const h=s[n+1];if(!h){t.shrink(o);break}const c=xS(h,"time",0),u=xS(h,"mixRotate",1),d=xS(h,"mixX",1),p=xS(h,"mixY",d),f=a.curve;f&&(o=yS(f,t,o,n,0,e,c,i,u,1),o=yS(f,t,o,n,1,e,c,r,d,1),o=yS(f,t,o,n,2,e,c,l,p,1)),e=c,i=u,r=d,l=p,a=h}n.push(t)}}}if(t.deform){t.attachments={};for(const e in t.deform){const s=t.deform[e],i=t.attachments[e]={};for(const t in s){const e=s[t],n=i[t]={};for(const t in e)n[t]={deform:e[t]}}}}if(t.attachments)for(const a in t.attachments){const e=t.attachments[a],r=s.findSkin(a);if(null!=r)for(const t in e){const a=e[t],o=s.findSlot(t);if(!o)throw new Error(`Slot not found: ${t}`);const h=o.index;for(const t in a){const e=a[t],s=r.getAttachment(h,t);for(const t in e){const r=e[t];let a=r[0];if(a)if("deform"==t){const t=s.bones,e=s.vertices,o=t?e.length/3*2:e.length,l=new jw(r.length,r.length,h,s);let c=xS(a,"time",0);for(let s=0,n=0;;s++){let h;const u=xS(a,"vertices",null);if(u){h=Yx.newFloatArray(o);const s=xS(a,"offset",0);if(Yx.arrayCopy(u,0,h,s,u.length),1!=i)for(let t=s,e=t+u.length;t<e;t++)h[t]*=i;if(!t)for(let t=0;t<o;t++)h[t]+=e[t]}else h=t?Yx.newFloatArray(o):e;l.setFrame(s,c,h);const d=r[s+1];if(!d){l.shrink(n);break}const p=xS(d,"time",0),f=a.curve;f&&(n=yS(f,l,n,s,0,c,p,0,1,1)),c=p,a=d}n.push(l)}else if("sequence"==t){const t=new sE(r.length,h,s);let e=0;for(let s=0;s<r.length;s++){const i=xS(a,"delay",e),n=xS(a,"time",0),o=sw[xS(a,"mode","hold")],h=xS(a,"index",0);t.setFrame(s,n,o,h,i),e=i,a=r[s+1]}n.push(t)}}}}}if(t.drawOrder){const e=new qw(t.drawOrder.length),i=s.slots.length;let r=0;for(let n=0;n<t.drawOrder.length;n++,r++){const a=t.drawOrder[n];let o=null;const h=xS(a,"offsets",null);if(h){o=Yx.newArray(i,-1);const t=Yx.newArray(i-h.length,0);let e=0,n=0;for(let i=0;i<h.length;i++){const r=h[i],a=s.findSlot(r.slot);if(!a)throw new Error(`Slot not found: ${a}`);const l=a.index;for(;e!=l;)t[n++]=e++;o[e+r.offset]=e++}for(;e<i;)t[n++]=e++;for(let s=i-1;s>=0;s--)-1==o[s]&&(o[s]=t[--n])}e.setFrame(r,xS(a,"time",0),o)}n.push(e)}if(t.events){const e=new zw(t.events.length);let i=0;for(let n=0;n<t.events.length;n++,i++){const r=t.events[n],a=s.findEvent(r.name);if(!a)throw new Error(`Event not found: ${r.name}`);const o=new bE(Yx.toSinglePrecision(xS(r,"time",0)),a);o.intValue=xS(r,"int",a.intValue),o.floatValue=xS(r,"float",a.floatValue),o.stringValue=xS(r,"string",a.stringValue),o.data.audioPath&&(o.volume=xS(r,"volume",1),o.balance=xS(r,"balance",0)),e.setFrame(i,o)}n.push(e)}let r=0;for(let a=0,o=n.length;a<o;a++)r=Math.max(r,n[a].getDuration());if(isNaN(r))throw new Error("Error while parsing animation, duration is NaN");s.animations.push(new nw(e,n,r))}static blendModeFromString(t){if("normal"==(t=t.toLowerCase()))return cr.NORMAL;if("additive"==t)return cr.ADD;if("multiply"==t)return cr.MULTIPLY;if("screen"==t)return cr.SCREEN;throw new Error(`Unknown blend mode: ${t}`)}}class fS{constructor(t,e,s,i,n){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=i,this.inheritTimeline=n}}function mS(t,e,s,i){let n=t[0],r=xS(n,"time",0),a=xS(n,"value",s)*i,o=0;for(let h=0;;h++){e.setFrame(h,r,a);const l=t[h+1];if(!l)return e.shrink(o),e;const c=xS(l,"time",0),u=xS(l,"value",s)*i;n.curve&&(o=yS(n.curve,e,o,h,0,r,c,a,u,i)),r=c,a=u,n=l}}function gS(t,e,s,i,n,r){let a=t[0],o=xS(a,"time",0),h=xS(a,s,n)*r,l=xS(a,i,n)*r,c=0;for(let u=0;;u++){e.setFrame(u,o,h,l);const d=t[u+1];if(!d)return e.shrink(c),e;const p=xS(d,"time",0),f=xS(d,s,n)*r,m=xS(d,i,n)*r,g=a.curve;g&&(c=yS(g,e,c,u,0,o,p,h,f,r),c=yS(g,e,c,u,1,o,p,l,m,r)),o=p,h=f,l=m,a=d}}function yS(t,e,s,i,n,r,a,o,h,l){if("stepped"==t)return e.setStepped(i),s;const c=n<<2,u=t[c],d=t[c+1]*l,p=t[c+2],f=t[c+3]*l;return e.setBezier(s,i,n,r,o,u,d,p,f,a,h),s+1}function xS(t,e,s){return void 0!==t[e]?t[e]:s}const vS=Object.freeze(Object.defineProperty({__proto__:null,AlphaTimeline:Uw,Animation:nw,AnimationState:nE,AnimationStateAdapter:class{start(t){}interrupt(t){}end(t){}dispose(t){}complete(t){}event(t,e){}},AnimationStateData:gE,AtlasAttachmentLoader:yE,Attachment:Wb,AttachmentTimeline:Ww,Bone:xE,BoneData:vE,BoundingBoxAttachment:zb,ClippingAttachment:Hb,ConstraintData:_E,CurveTimeline:Aw,CurveTimeline1:Cw,CurveTimeline2:Mw,DeformTimeline:jw,DrawOrderTimeline:qw,Event:bE,EventData:wE,EventQueue:oE,EventTimeline:zw,EventType:hE,IkConstraint:EE,IkConstraintData:SE,IkConstraintTimeline:Kw,MeshAttachment:qb,PathAttachment:Kb,PathConstraint:ME,PathConstraintData:TE,PathConstraintMixTimeline:tE,PathConstraintPositionTimeline:Qw,PathConstraintSpacingTimeline:Jw,PointAttachment:Zb,RGB2Timeline:Yw,RGBA2Timeline:Xw,RGBATimeline:Vw,RGBTimeline:$w,RegionAttachment:Jb,RotateTimeline:Iw,ScaleTimeline:Dw,ScaleXTimeline:Fw,ScaleYTimeline:Ow,Sequence:ew,SequenceMode:sw,SequenceModeValues:iw,SequenceTimeline:sE,ShearTimeline:Nw,ShearXTimeline:Bw,ShearYTimeline:Lw,Skeleton:kE,SkeletonBinary:LE,SkeletonBounds:class extends Gx{},SkeletonData:DE,SkeletonJson:pS,Skin:BE,SkinEntry:NE,Slot:IE,SlotData:FE,SpacingMode:AE,Spine:class extends Qx{createSkeleton(t){this.skeleton=new kE(t),this.skeleton.updateWorldTransform(),this.stateData=new gE(t),this.state=new nE(this.stateData)}},Timeline:Tw,TrackEntry:aE,TransformConstraint:PE,TransformConstraintData:OE,TransformConstraintTimeline:Zw,TranslateTimeline:Pw,TranslateXTimeline:Rw,TranslateYTimeline:kw,VertexAttachment:Gb},Symbol.toStringTag,{value:"Module"}));var _S=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.VER37=37]="VER37",t[t.VER38=38]="VER38",t[t.VER40=40]="VER40",t[t.VER41=41]="VER41",t))(_S||{});function bS(t){const e=t.substr(0,3),s=Math.floor(10*Number(e)+.001);return"3.7"===e?37:"3.8"===e?38:"4.0"===e?40:"4.1"===e?41:s<37?37:0}class wS{constructor(){this.scale=1}readSkeletonData(t,e){let s=null,i=this.readVersionOldFormat(e),n=bS(i);if(n===_S.VER38&&(s=new b_(new t_(t))),i=this.readVersionNewFormat(e),n=bS(i),n!==_S.VER40&&n!==_S.VER41||(s=new LE(new yE(t))),!s){const t=`Unsupported version of spine model ${i}, please update pixi-spine`;console.error(t)}return s.scale=this.scale,s.readSkeletonData(e)}readVersionOldFormat(t){const e=new xx(t);let s;try{e.readString(),s=e.readString()}catch(Zf){s=""}return s||""}readVersionNewFormat(t){const e=new xx(t);let s;e.readInt32(),e.readInt32();try{s=e.readString()}catch(Zf){s=""}return s||""}}class ES{constructor(){this.scale=1}readSkeletonData(t,e){const s=e.skeleton.spine,i=bS(s);let n=null;if(i===_S.VER37&&(n=new Ub(new Eb(t))),i===_S.VER38&&(n=new S_(new t_(t))),i!==_S.VER40&&i!==_S.VER41||(n=new pS(new yE(t))),!n){const t=`Unsupported version of spine model ${s}, please update pixi-spine`;console.error(t)}return n.scale=this.scale,n.readSkeletonData(e)}}class SS extends Qx{createSkeleton(t){const e=bS(t.version);let s=null;if(e===_S.VER37&&(s=Yb),e===_S.VER38&&(s=A_),e!==_S.VER40&&e!==_S.VER41||(s=vS),!s){const e=`Cant detect version of spine model ${t.version}`;console.error(e)}this.skeleton=new s.Skeleton(t),this.skeleton.updateWorldTransform(),this.stateData=new s.AnimationStateData(t),this.state=new s.AnimationState(this.stateData)}}(new class extends iv{createBinaryParser(){return new wS}createJsonParser(){return new ES}parseData(t,e,s){return{spineData:t.readSkeletonData(e,s),spineAtlas:e}}}).installLoader();const TS=class extends(ig(SS)){constructor(t){super(globalThis.pgame.getSpine(t).spineData),d(this,"_pivotRule",Zm.Center),this.autoUpdate=!1,this.update=this._update}get pivotRule(){return Zm.Center}get debugBox(){return!1}get enable(){return this.update===this._update}set enable(t){this.update=t?this._update:globalThis.doNothing}_update(t){SS.prototype.update.call(this,.001*globalThis.pgame.DeltaMS)}get debug(){return super.debug}set debug(t){super.debug=t}constructDebugRenderer(t=!0){void 0!==this.debug||(this.debug=t?TS.debug:new Jx)}};d(TS,"debug",new Jx);class AS extends(function(t){const e=t;return class extends e{constructor(...t){super(...t),d(this,"isPointerDown",!1),d(this,"isPointerOver",!1),d(this,"_vbEvents",{}),this.eventMode="static",this.defaultClickEffect(tg.Black,.2).defaultHoverEffect(tg.White,.3)}getListener(t){return this._vbEvents[t]}_toggle(t,e,s){const i=this._vbEvents[e];return void 0!==i&&this.off(t,i),!0===s?void 0!==i&&this.on(t,i):!1!==s&&(this._vbEvents[e]=s,this.on(t,s)),this}toggle(t,e){return this._toggle(t,t,e)}setOnClick(t){return this._toggle("pointertap","pointertap",t)}setClickSound(t,e){if("object"==typeof t){const s=()=>t.play(e);return this._toggle("pointertap","clicksound",s)}return this._toggle("pointertap","clicksound",t)}setHoverEffect(t,e){if(Ig())return this;if("boolean"==typeof t)return this._toggle("pointerover","hovereffect",t)._toggle("pointerout","clearhover",t);return this._toggle("pointerover","hovereffect",(e=>{var s,i;this.isPointerOver=!0,this.isPointerDown?null==(i=(s=this._vbEvents).clickeffect)||i.call(s,e):t(e)}))._toggle("pointerout","clearhover",(t=>{this.isPointerOver=!1,e(t)}))}setClickEffect(t,e){if("boolean"==typeof t)return this._toggle("pointerdown","clickeffect",t)._toggle("pointerup","clearclick",t)._toggle("pointerupoutside","clearclick",t);const s=t=>{this.isPointerDown=!1,e(t)};return this._toggle("pointerdown","clickeffect",(e=>{this.isPointerDown=!0,t(e)}))._toggle("pointerup","clearclick",s)._toggle("pointerupoutside","clearclick",s)}defaultHoverEffect(t,e,s=sg.colorFilter){return void 0===this._defaultColorFilter&&(this._defaultColorFilter=s),this.setHoverEffect((()=>{var i;s.color=t,s.alpha=e,(null==(i=this.filters)?void 0:i.includes(s))||this.addFilter(s)}),(()=>{var t;null==(t=this.filters)||t.removeOnce(s)}))}defaultClickEffect(t,e,s=sg.colorFilter){return void 0===this._defaultColorFilter&&(this._defaultColorFilter=s),this.setClickEffect((()=>{var i;s.color=t,s.alpha=e,(null==(i=this.filters)?void 0:i.includes(s))||this.addFilter(s)}),(()=>{var t;null==(t=this.filters)||t.removeOnce(s)}))}clearEffect(){var t;this.isPointerDown=this.isPointerOver=!1,null==(t=this.filters)||t.removeOnce(this._defaultColorFilter)}}}(gx)){}class CS extends AS{constructor(t,e,s){super(new mx(t)),d(this,"fadeTween"),d(this,"sound"),d(this,"onStartFading"),d(this,"onFadeEnd"),this.eventMode="static",this.fadeTween=s.create("fade",this,{alpha:0}),this.addCenteredTxt(e),this.displayed=!1,this.fadeTween.on("start",(t=>{var e;null==(e=this.onStartFading)||e.call(this,t)})).on("end",(t=>{var e;this.displayed=!1,null==(e=this.onFadeEnd)||e.call(this,t)}))}get displayed(){return this.visible}set displayed(t){this.visible=t}pop(t,e){return this.displayed=!0,this.alpha=1,void 0!==this.sound&&globalThis.pgame.soundManager.play(this.sound),this.fadeTween.delay(t).duration(e)}}const MS=class extends ux{constructor(){super({font:"Arial",size:20,fill:tg.Green}),d(this,"_totalFrames",0),d(this,"_totalFPS",0),this.style.dropShadow=!0,this.style.dropShadowColor=tg.Black,this.style.dropShadowDistance=4}update(){this._totalFrames++,this._totalFPS+=globalThis.pgame.FPS,this._totalFrames>=MS.N_FRAME&&(this.text=(this._totalFPS/this._totalFrames).toFixed(0),this._totalFrames=0,this._totalFPS=0)}};let IS=MS;d(IS,"N_FRAME",5);class PS extends x{constructor(t,e,s=0,i=0,n=!1){super(),d(this,"enable"),d(this,"time"),d(this,"delay"),d(this,"repeat"),d(this,"isEnded"),d(this,"isStarted"),d(this,"preserved"),d(this,"_delayTime"),d(this,"_elapsedTime"),d(this,"_repeat"),d(this,"_timerManager"),d(this,"_next"),this.time=e,this.enable=!1,this.delay=i,this.repeat=s,this.preserved=n,this.isEnded=!1,this.isStarted=!1,this._delayTime=0,this._elapsedTime=0,this._repeat=0,this._timerManager=t,this.preserved&&t.add(this)}get timerManager(){return this._timerManager}set timerManager(t){this._timerManager!==t&&(this._timerManager.remove(this),this._timerManager=t,this.preserved&&t.add(this))}start(t=!1){return t&&this.reset(),this.enable=!0,this.preserved||this._timerManager.add(this),this}stop(t=!0){return this.isEnded=!0,this.enable=!1,t&&this.emit("end",this._elapsedTime),this}reset(){return this._elapsedTime=0,this._repeat=0,this._delayTime=0,this.isStarted=!1,this.isEnded=!1,this}remove(){return this._timerManager.remove(this),this}chain(t){return this._next=t,t.timerManager=this.timerManager,this}single(t,e,s){return this.off(t).on(t,e,s)}update(t){var e;if(this.delay>this._delayTime)this._delayTime+=t;else if(this.isStarted||(this.isStarted=!0,this.emit("start",this._elapsedTime)),this.time>this._elapsedTime){const s=this._elapsedTime+t,i=s>=this.time;if(this._elapsedTime=i?this.time:s,this.emit("update",this._elapsedTime,t),i){if(this.repeat>this._repeat)return this._repeat++,this.emit("repeat",this._elapsedTime,this._repeat),void(this._elapsedTime=0);this.stop(),null==(e=this._next)||e.start()}}}}class RS{constructor(){d(this,"_timers",[]),d(this,"_timersToDelete",[])}size(){return this._timers.length}update(t){if(this._timersToDelete.length){for(const t of this._timersToDelete)this._remove(t);this._timersToDelete.length=0}for(const e of this._timers)e.enable&&(e.update(t),e.isEnded&&!e.preserved&&this.remove(e))}add(t){(t.preserved||t.enable)&&this._timers.push(t)}stopAll(t=!1){for(const e of this._timers)e.stop(t)}remove(t){this._timersToDelete.push(t)}_remove(t){const e=this._timers.indexOf(t);e>-1&&this._timers.splice(e,1)}}const kS=class extends ku{constructor(t){if(t.resolution=Ar.RESOLUTION=window.devicePixelRatio,wl.defaultResolution=window.devicePixelRatio,t.eventMode="none",t.eventFeatures={globalMove:!!t.dragEvent},super(t),d(this,"stage",new dg),d(this,"bgRect"),d(this,"assets",dd),d(this,"soundManager",Xy),d(this,"timers"),d(this,"interact"),d(this,"desiredWidth",0),d(this,"desiredHeight",0),d(this,"desiredRatio",0),d(this,"currState"),d(this,"currStyle",hx),d(this,"currLocale",rg),d(this,"currScene",{}),d(this,"_states",{}),d(this,"_viewStyles",{"":hx}),d(this,"_locales",{"":rg}),d(this,"_scenes",{}),d(this,"_textures"),d(this,"_sequences"),d(this,"_spines"),d(this,"onGameReady",globalThis.doNothing),d(this,"_txtFPS"),sg.init(),this.timers=new RS,this.stage.name="MAIN",this.stage.eventMode="static",void 0!==t.backgroundRect){let e=!0!==t.backgroundRect?t.backgroundRect:tg.White;const s=new px(100,100).fill(e,1);this.bgRect=new mx(s),this.bgRect.alpha=0,this.bgRect.eventMode="auto",this.stage.addObj(this.bgRect),this.stage.sendObjToBack(this.bgRect)}else this.bgRect=new mx}mainLoop(t){}startLoop(){this.mainLoop=this.mainLoop.bind(this),this.ticker.add(this.mainLoop,{},kc.HIGH)}resizeAppView(t,e){}setResolution(t,e){this.desiredWidth=t,this.desiredHeight=e,this.desiredRatio=e/t,this.bgRect.width=t,this.bgRect.height=e,void 0!==this._txtFPS&&(this._txtFPS.x=t-40),this.stage.setDesiredSize(t,e)}createGlobalTimer(t,e=0,s=0,i=!1){return new PS(this.timers,t,e,s,i)}loadAssets(){return p(this,null,(function*(){const t=yield(e="assets-list.json",fetch(e).then((t=>t.json())));var e;const s=this.assets;yield s.loadFromList(t),[this._textures,this._sequences]=s.get_multipack_textureMap(t),this._spines=s.get_SpineMap(t.spine_json),Object.assign(this._viewStyles,s.get_viewStyleMap(t.style)),Object.assign(this._locales,s.get_localeMap(t.lang))}))}useCurrentViewStlye(){this.stage.useViewStyleChildren(this.currStyle.list)}useCurrentLocale(){this.stage.useLocale(this.currLocale)}state(t){return this._states[t]}setState(t){this.currState=this.state(t)}addState(...t){for(const e of t)this._states[e.name]=e}viewStyle(t){return kS.runtimeCheck(this._viewStyles,t,"style")}setViewStyle(t){this.currStyle=this.viewStyle(t)}locale(t){return kS.runtimeCheck(this._locales,t,"locale")}setLocale(t){this.currLocale=this.locale(t)}addLocale(t,e){this._locales[t]=e}scene(t){return kS.runtimeCheck(this._scenes,t,"scene")}setScene(t){this.currScene[t.rootContainer.name]=t}addScenes(...t){for(const e of t)this._scenes[e.name]=e}getTex(t){return kS.runtimeCheck(this._textures,t,"texture")}addTextures(t){Object.assign(this._textures,t)}getSeq(t){return kS.runtimeCheck(this._sequences,t,"sequence")}addSequences(t){Object.assign(this._sequences,t)}getSpine(t){return kS.runtimeCheck(this._spines,t,"spine")}addSpines(t){Object.assign(this._spines,t)}get DeltaMS(){return this.ticker.elapsedMS}get TotalMS(){return this.ticker.lastTime}get FPS(){return this.ticker.FPS}showFPS(){void 0===this._txtFPS&&(this._txtFPS=new IS,this._txtFPS.x=this.desiredWidth-40,this._txtFPS.y=0,this.stage.addObj(this._txtFPS,sg.maxLayer+1))}};let DS=kS;d(DS,"runtimeCheck",((t,e,s)=>t[e]));class FS{constructor(t){d(this,"name"),d(this,"_firstIn",!0),d(this,"_firstOut",!0),d(this,"_canExit",!1),d(this,"_nextState"),d(this,"timers"),this.name=t,this._nextState="",this.timers=new RS}enter(){}update(t){}prepareExit(){this._canExit=!0}exit(){}setNext(t){this._nextState=t}runFSM(t){return this._firstIn&&(this._firstIn=!1,this._firstOut=!0,this._canExit=!1,this._nextState="",this.enter()),globalThis.pgame.timers.update(globalThis.pgame.DeltaMS),this.timers.update(globalThis.pgame.DeltaMS),this.update(t),""!=this._nextState&&(this._firstOut&&(this._firstOut=!1,this.prepareExit()),this._canExit)?(this._firstIn=!0,this.exit(),this._nextState):""}createTimer(t,e=0,s=0,i=!1){return new PS(this.timers,t,e,s,i)}}class OS{constructor(t,e,s){this.value=t,this.time=e,this.next=null,this.isStepped=!1,this.ease=s?"function"==typeof s?s:YS(s):null}static createList(t){if("list"in t){const e=t.list;let s;const{value:i,time:n}=e[0],r=s=new OS("string"==typeof i?XS(i):i,n,t.ease);if(e.length>2||2===e.length&&e[1].value!==i)for(let t=1;t<e.length;++t){const{value:i,time:n}=e[t];s.next=new OS("string"==typeof i?XS(i):i,n),s=s.next}return r.isStepped=!!t.isStepped,r}const e=new OS("string"==typeof t.start?XS(t.start):t.start,0);return t.end!==t.start&&(e.next=new OS("string"==typeof t.end?XS(t.end):t.end,1)),e}}let NS=Ol.from;const BS=Math.PI/180;function LS(t,e){if(!t)return;const s=Math.sin(t),i=Math.cos(t),n=e.x*i-e.y*s,r=e.x*s+e.y*i;e.x=n,e.y=r}function VS(t,e,s){return t<<16|e<<8|s}function $S(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function US(t,e){t.x*=e,t.y*=e}function XS(t,e){let s;return e||(e={}),"#"===t.charAt(0)?t=t.substr(1):0===t.indexOf("0x")&&(t=t.substr(2)),8===t.length&&(s=t.substr(0,2),t=t.substr(2)),e.r=parseInt(t.substr(0,2),16),e.g=parseInt(t.substr(2,2),16),e.b=parseInt(t.substr(4,2),16),s&&(e.a=parseInt(s,16)),e}function YS(t){const e=t.length,s=1/e;return function(i){const n=e*i|0,r=(i-n*s)*e,a=t[n]||t[e-1];return a.s+r*(2*(1-r)*(a.cp-a.s)+r*(a.e-a.s))}}class WS extends hu{constructor(t){super(),this.prevChild=this.nextChild=null,this.emitter=t,this.config={},this.anchor.x=this.anchor.y=.5,this.maxLife=0,this.age=0,this.agePercent=0,this.oneOverLife=0,this.next=null,this.prev=null,this.init=this.init,this.kill=this.kill}init(t){this.maxLife=t,this.age=this.agePercent=0,this.rotation=0,this.position.x=this.position.y=0,this.scale.x=this.scale.y=1,this.tint=16777215,this.alpha=1,this.oneOverLife=1/this.maxLife,this.visible=!0}kill(){this.emitter.recycle(this)}destroy(){this.parent&&this.parent.removeChild(this),this.emitter=this.next=this.prev=null,super.destroy()}}var jS,GS;(GS=jS||(jS={}))[GS.Spawn=0]="Spawn",GS[GS.Normal=2]="Normal",GS[GS.Late=5]="Late";const zS=Oc.shared,HS=Symbol("Position particle per emitter position");class qS{constructor(t,e){this.initBehaviors=[],this.updateBehaviors=[],this.recycleBehaviors=[],this.minLifetime=0,this.maxLifetime=0,this.customEase=null,this._frequency=1,this.spawnChance=1,this.maxParticles=1e3,this.emitterLifetime=-1,this.spawnPos=new Ah,this.particlesPerWave=1,this.rotation=0,this.ownerPos=new Ah,this._prevEmitterPos=new Ah,this._prevPosIsValid=!1,this._posChanged=!1,this._parent=null,this.addAtBack=!1,this.particleCount=0,this._emit=!1,this._spawnTimer=0,this._emitterLife=-1,this._activeParticlesFirst=null,this._activeParticlesLast=null,this._poolFirst=null,this._origConfig=null,this._autoUpdate=!1,this._destroyWhenComplete=!1,this._completeCallback=null,this.parent=t,e&&this.init(e),this.recycle=this.recycle,this.update=this.update,this.rotate=this.rotate,this.updateSpawnPos=this.updateSpawnPos,this.updateOwnerPos=this.updateOwnerPos}static registerBehavior(t){qS.knownBehaviors[t.type]=t}get frequency(){return this._frequency}set frequency(t){this._frequency="number"==typeof t&&t>0?t:1}get parent(){return this._parent}set parent(t){this.cleanup(),this._parent=t}init(t){if(!t)return;this.cleanup(),this._origConfig=t,this.minLifetime=t.lifetime.min,this.maxLifetime=t.lifetime.max,t.ease?this.customEase="function"==typeof t.ease?t.ease:YS(t.ease):this.customEase=null,this.particlesPerWave=1,t.particlesPerWave&&t.particlesPerWave>1&&(this.particlesPerWave=t.particlesPerWave),this.frequency=t.frequency,this.spawnChance="number"==typeof t.spawnChance&&t.spawnChance>0?t.spawnChance:1,this.emitterLifetime=t.emitterLifetime||-1,this.maxParticles=t.maxParticles>0?t.maxParticles:1e3,this.addAtBack=!!t.addAtBack,this.rotation=0,this.ownerPos.set(0),t.pos?this.spawnPos.copyFrom(t.pos):this.spawnPos.set(0),this._prevEmitterPos.copyFrom(this.spawnPos),this._prevPosIsValid=!1,this._spawnTimer=0,this.emit=void 0===t.emit||!!t.emit,this.autoUpdate=!!t.autoUpdate;const e=t.behaviors.map((t=>{const e=qS.knownBehaviors[t.type];return e?new e(t.config):(console.error(`Unknown behavior: ${t.type}`),null)})).filter((t=>!!t));e.push(HS),e.sort(((t,e)=>t===HS?e.order===jS.Spawn?1:-1:e===HS?t.order===jS.Spawn?-1:1:t.order-e.order)),this.initBehaviors=e.slice(),this.updateBehaviors=e.filter((t=>t!==HS&&t.updateParticle)),this.recycleBehaviors=e.filter((t=>t!==HS&&t.recycleParticle))}getBehavior(t){return qS.knownBehaviors[t]&&this.initBehaviors.find((e=>e instanceof qS.knownBehaviors[t]))||null}fillPool(t){for(;t>0;--t){const t=new WS(this);t.next=this._poolFirst,this._poolFirst=t}}recycle(t,e=!1){for(let s=0;s<this.recycleBehaviors.length;++s)this.recycleBehaviors[s].recycleParticle(t,!e);t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next),t===this._activeParticlesLast&&(this._activeParticlesLast=t.prev),t===this._activeParticlesFirst&&(this._activeParticlesFirst=t.next),t.prev=null,t.next=this._poolFirst,this._poolFirst=t,t.parent&&t.parent.removeChild(t),--this.particleCount}rotate(t){if(this.rotation===t)return;const e=t-this.rotation;this.rotation=t,LS(e,this.spawnPos),this._posChanged=!0}updateSpawnPos(t,e){this._posChanged=!0,this.spawnPos.x=t,this.spawnPos.y=e}updateOwnerPos(t,e){this._posChanged=!0,this.ownerPos.x=t,this.ownerPos.y=e}resetPositionTracking(){this._prevPosIsValid=!1}get emit(){return this._emit}set emit(t){this._emit=!!t,this._emitterLife=this.emitterLifetime}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){this._autoUpdate&&!t?zS.remove(this.update,this):!this._autoUpdate&&t&&zS.add(this.update,this),this._autoUpdate=!!t}playOnceAndDestroy(t){this.autoUpdate=!0,this.emit=!0,this._destroyWhenComplete=!0,this._completeCallback=t}playOnce(t){this.emit=!0,this._completeCallback=t}update(t){if(this._autoUpdate&&(t=.001*zS.elapsedMS),!this._parent)return;for(let r,a=this._activeParticlesFirst;a;a=r)if(r=a.next,a.age+=t,a.age>a.maxLife||a.age<0)this.recycle(a);else{let e=a.age*a.oneOverLife;this.customEase&&(e=4===this.customEase.length?this.customEase(e,0,1,1):this.customEase(e)),a.agePercent=e;for(let s=0;s<this.updateBehaviors.length;++s)if(this.updateBehaviors[s].updateParticle(a,t)){this.recycle(a);break}}let e,s;this._prevPosIsValid&&(e=this._prevEmitterPos.x,s=this._prevEmitterPos.y);const i=this.ownerPos.x+this.spawnPos.x,n=this.ownerPos.y+this.spawnPos.y;if(this._emit)for(this._spawnTimer-=t<0?0:t;this._spawnTimer<=0;){if(this._emitterLife>=0&&(this._emitterLife-=this._frequency,this._emitterLife<=0)){this._spawnTimer=0,this._emitterLife=0,this.emit=!1;break}if(this.particleCount>=this.maxParticles){this._spawnTimer+=this._frequency;continue}let r,a;if(this._prevPosIsValid&&this._posChanged){const o=1+this._spawnTimer/t;r=(i-e)*o+e,a=(n-s)*o+s}else r=i,a=n;let o=null,h=null;for(let t=Math.min(this.particlesPerWave,this.maxParticles-this.particleCount),e=0;e<t;++e){if(this.spawnChance<1&&Math.random()>=this.spawnChance)continue;let t,e;(t=this.minLifetime===this.maxLifetime?this.minLifetime:Math.random()*(this.maxLifetime-this.minLifetime)+this.minLifetime,-this._spawnTimer>=t)||(this._poolFirst?(e=this._poolFirst,this._poolFirst=this._poolFirst.next,e.next=null):e=new WS(this),e.init(t),this.addAtBack?this._parent.addChildAt(e,0):this._parent.addChild(e),o?(h.next=e,e.prev=h,h=e):h=o=e,++this.particleCount)}if(o){this._activeParticlesLast?(this._activeParticlesLast.next=o,o.prev=this._activeParticlesLast,this._activeParticlesLast=h):(this._activeParticlesFirst=o,this._activeParticlesLast=h);for(let t=0;t<this.initBehaviors.length;++t){const e=this.initBehaviors[t];if(e===HS)for(let t,s=o;s;s=t){t=s.next,0!==this.rotation&&(LS(this.rotation,s.position),s.rotation+=this.rotation),s.position.x+=r,s.position.y+=a,s.age+=-this._spawnTimer;let e=s.age*s.oneOverLife;this.customEase&&(e=4===this.customEase.length?this.customEase(e,0,1,1):this.customEase(e)),s.agePercent=e}else e.initParticles(o)}for(let t,e=o;e;e=t){t=e.next;for(let t=0;t<this.updateBehaviors.length;++t)if(this.updateBehaviors[t].updateParticle(e,-this._spawnTimer)){this.recycle(e);break}}}this._spawnTimer+=this._frequency}if(this._posChanged&&(this._prevEmitterPos.x=i,this._prevEmitterPos.y=n,this._prevPosIsValid=!0,this._posChanged=!1),!this._emit&&!this._activeParticlesFirst){if(this._completeCallback){const t=this._completeCallback;this._completeCallback=null,t()}this._destroyWhenComplete&&this.destroy()}}emitNow(){const t=this.ownerPos.x+this.spawnPos.x,e=this.ownerPos.y+this.spawnPos.y;let s=null,i=null;for(let n=Math.min(this.particlesPerWave,this.maxParticles-this.particleCount),r=0;r<n;++r){if(this.spawnChance<1&&Math.random()>=this.spawnChance)continue;let t,e;this._poolFirst?(t=this._poolFirst,this._poolFirst=this._poolFirst.next,t.next=null):t=new WS(this),e=this.minLifetime===this.maxLifetime?this.minLifetime:Math.random()*(this.maxLifetime-this.minLifetime)+this.minLifetime,t.init(e),this.addAtBack?this._parent.addChildAt(t,0):this._parent.addChild(t),s?(i.next=t,t.prev=i,i=t):i=s=t,++this.particleCount}if(s){this._activeParticlesLast?(this._activeParticlesLast.next=s,s.prev=this._activeParticlesLast,this._activeParticlesLast=i):(this._activeParticlesFirst=s,this._activeParticlesLast=i);for(let i=0;i<this.initBehaviors.length;++i){const n=this.initBehaviors[i];if(n===HS)for(let i,r=s;r;r=i)i=r.next,0!==this.rotation&&(LS(this.rotation,r.position),r.rotation+=this.rotation),r.position.x+=t,r.position.y+=e;else n.initParticles(s)}}}cleanup(){let t,e;for(t=this._activeParticlesFirst;t;t=e)e=t.next,this.recycle(t,!0);this._activeParticlesFirst=this._activeParticlesLast=null,this.particleCount=0}get destroyed(){return!(this._parent&&this.initBehaviors.length)}destroy(){let t;this.autoUpdate=!1,this.cleanup();for(let e=this._poolFirst;e;e=t)t=e.next,e.destroy();this._poolFirst=this._parent=this.spawnPos=this.ownerPos=this.customEase=this._completeCallback=null,this.initBehaviors.length=this.updateBehaviors.length=this.recycleBehaviors.length=0}}qS.knownBehaviors={};class KS{constructor(t){this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h}getRandPos(t){t.x=Math.random()*this.w+this.x,t.y=Math.random()*this.h+this.y}}KS.type="rect",KS.editorConfig=null;class ZS{constructor(t){this.x=t.x||0,this.y=t.y||0,this.radius=t.radius,this.innerRadius=t.innerRadius||0,this.rotation=!!t.affectRotation}getRandPos(t){this.innerRadius!==this.radius?t.x=Math.random()*(this.radius-this.innerRadius)+this.innerRadius:t.x=this.radius,t.y=0;const e=Math.random()*Math.PI*2;this.rotation&&(t.rotation+=e),LS(e,t.position),t.position.x+=this.x,t.position.y+=this.y}}ZS.type="torus",ZS.editorConfig=null;class QS{constructor(t){this.segments=[],this.countingLengths=[],this.totalLength=0,this.init(t)}init(t){if(t&&t.length)if(Array.isArray(t[0]))for(let e=0;e<t.length;++e){const s=t[e];let i=s[0];for(let t=1;t<s.length;++t){const e=s[t];this.segments.push({p1:i,p2:e,l:0}),i=e}}else{let e=t[0];for(let s=1;s<t.length;++s){const i=t[s];this.segments.push({p1:e,p2:i,l:0}),e=i}}else this.segments.push({p1:{x:0,y:0},p2:{x:0,y:0},l:0});for(let e=0;e<this.segments.length;++e){const{p1:t,p2:s}=this.segments[e],i=Math.sqrt((s.x-t.x)*(s.x-t.x)+(s.y-t.y)*(s.y-t.y));this.segments[e].l=i,this.totalLength+=i,this.countingLengths.push(this.totalLength)}}getRandPos(t){const e=Math.random()*this.totalLength;let s,i;if(1===this.segments.length)s=this.segments[0],i=e;else for(let a=0;a<this.countingLengths.length;++a)if(e<this.countingLengths[a]){s=this.segments[a],i=0===a?e:e-this.countingLengths[a-1];break}i/=s.l||1;const{p1:n,p2:r}=s;t.x=n.x+i*(r.x-n.x),t.y=n.y+i*(r.y-n.y)}}QS.type="polygonalChain",QS.editorConfig=null;class JS{constructor(t){var e;this.order=jS.Late,this.minStart=t.minStart,this.maxStart=t.maxStart,this.accel=t.accel,this.rotate=!!t.rotate,this.maxSpeed=null!==(e=t.maxSpeed)&&void 0!==e?e:0}initParticles(t){let e=t;for(;e;){const t=Math.random()*(this.maxStart-this.minStart)+this.minStart;e.config.velocity?e.config.velocity.set(t,0):e.config.velocity=new Ah(t,0),LS(e.rotation,e.config.velocity),e=e.next}}updateParticle(t,e){const s=t.config.velocity,i=s.x,n=s.y;if(s.x+=this.accel.x*e,s.y+=this.accel.y*e,this.maxSpeed){const t=$S(s);t>this.maxSpeed&&US(s,this.maxSpeed/t)}t.x+=(i+s.x)/2*e,t.y+=(n+s.y)/2*e,this.rotate&&(t.rotation=Math.atan2(s.y,s.x))}}function tT(t){return this.ease&&(t=this.ease(t)),(this.first.next.value-this.first.value)*t+this.first.value}function eT(t){this.ease&&(t=this.ease(t));const e=this.first.value,s=this.first.next.value;return VS((s.r-e.r)*t+e.r,(s.g-e.g)*t+e.g,(s.b-e.b)*t+e.b)}function sT(t){this.ease&&(t=this.ease(t));let e=this.first,s=e.next;for(;t>s.time;)e=s,s=s.next;return t=(t-e.time)/(s.time-e.time),(s.value-e.value)*t+e.value}function iT(t){this.ease&&(t=this.ease(t));let e=this.first,s=e.next;for(;t>s.time;)e=s,s=s.next;t=(t-e.time)/(s.time-e.time);const i=e.value,n=s.value;return VS((n.r-i.r)*t+i.r,(n.g-i.g)*t+i.g,(n.b-i.b)*t+i.b)}function nT(t){this.ease&&(t=this.ease(t));let e=this.first;for(;e.next&&t>e.next.time;)e=e.next;return e.value}function rT(t){this.ease&&(t=this.ease(t));let e=this.first;for(;e.next&&t>e.next.time;)e=e.next;const s=e.value;return VS(s.r,s.g,s.b)}JS.type="moveAcceleration",JS.editorConfig=null;class aT{constructor(t=!1){this.first=null,this.isColor=!!t,this.interpolate=null,this.ease=null}reset(t){this.first=t;t.next&&t.next.time>=1?this.interpolate=this.isColor?eT:tT:t.isStepped?this.interpolate=this.isColor?rT:nT:this.interpolate=this.isColor?iT:sT,this.ease=this.first.ease}}class oT{constructor(t){this.order=jS.Normal,this.list=new aT(!1),this.list.reset(OS.createList(t.alpha))}initParticles(t){let e=t;for(;e;)e.alpha=this.list.first.value,e=e.next}updateParticle(t){t.alpha=this.list.interpolate(t.agePercent)}}oT.type="alpha",oT.editorConfig=null;class hT{constructor(t){this.order=jS.Normal,this.value=t.alpha}initParticles(t){let e=t;for(;e;)e.alpha=this.value,e=e.next}}function lT(t){const e=[];for(let s=0;s<t.length;++s){let i=t[s];if("string"==typeof i)e.push(NS(i));else if(i instanceof Ol)e.push(i);else{let t=i.count||1;for(i="string"==typeof i.texture?NS(i.texture):i.texture;t>0;--t)e.push(i)}}return e}hT.type="alphaStatic",hT.editorConfig=null;class cT{constructor(t){this.order=jS.Normal,this.anims=[];for(let e=0;e<t.anims.length;++e){const s=t.anims[e],i=lT(s.textures),n=s.framerate<0?-1:s.framerate>0?s.framerate:60,r={textures:i,duration:n>0?i.length/n:0,framerate:n,loop:n>0&&!!s.loop};this.anims.push(r)}}initParticles(t){let e=t;for(;e;){const t=Math.floor(Math.random()*this.anims.length),s=e.config.anim=this.anims[t];e.texture=s.textures[0],e.config.animElapsed=0,-1===s.framerate?(e.config.animDuration=e.maxLife,e.config.animFramerate=s.textures.length/e.maxLife):(e.config.animDuration=s.duration,e.config.animFramerate=s.framerate),e=e.next}}updateParticle(t,e){const s=t.config,i=s.anim;s.animElapsed+=e,s.animElapsed>=s.animDuration&&(s.anim.loop?s.animElapsed=s.animElapsed%s.animDuration:s.animElapsed=s.animDuration-1e-6);const n=s.animElapsed*s.animFramerate+1e-7|0;t.texture=i.textures[n]||i.textures[i.textures.length-1]||Ol.EMPTY}}cT.type="animatedRandom",cT.editorConfig=null;class uT{constructor(t){this.order=jS.Normal;const e=t.anim,s=lT(e.textures),i=e.framerate<0?-1:e.framerate>0?e.framerate:60;this.anim={textures:s,duration:i>0?s.length/i:0,framerate:i,loop:i>0&&!!e.loop}}initParticles(t){let e=t;const s=this.anim;for(;e;)e.texture=s.textures[0],e.config.animElapsed=0,-1===s.framerate?(e.config.animDuration=e.maxLife,e.config.animFramerate=s.textures.length/e.maxLife):(e.config.animDuration=s.duration,e.config.animFramerate=s.framerate),e=e.next}updateParticle(t,e){const s=this.anim,i=t.config;i.animElapsed+=e,i.animElapsed>=i.animDuration&&(s.loop?i.animElapsed=i.animElapsed%i.animDuration:i.animElapsed=i.animDuration-1e-6);const n=i.animElapsed*i.animFramerate+1e-7|0;t.texture=s.textures[n]||s.textures[s.textures.length-1]||Ol.EMPTY}}uT.type="animatedSingle",uT.editorConfig=null;class dT{constructor(t){this.order=jS.Normal,this.value=t.blendMode}initParticles(t){let e=t;for(;e;)e.blendMode=(s=this.value)?(s=s.toUpperCase().replace(/ /g,"_"),cr[s]||cr.NORMAL):cr.NORMAL,e=e.next;var s}}dT.type="blendMode",dT.editorConfig=null;class pT{constructor(t){this.order=jS.Spawn,this.spacing=t.spacing*BS,this.start=t.start*BS,this.distance=t.distance}initParticles(t){let e=0,s=t;for(;s;){let t;t=this.spacing?this.start+this.spacing*e:Math.random()*Math.PI*2,s.rotation=t,this.distance&&(s.position.x=this.distance,LS(t,s.position)),s=s.next,++e}}}pT.type="spawnBurst",pT.editorConfig=null;class fT{constructor(t){this.order=jS.Normal,this.list=new aT(!0),this.list.reset(OS.createList(t.color))}initParticles(t){let e=t;const s=this.list.first.value,i=VS(s.r,s.g,s.b);for(;e;)e.tint=i,e=e.next}updateParticle(t){t.tint=this.list.interpolate(t.agePercent)}}fT.type="color",fT.editorConfig=null;class mT{constructor(t){this.order=jS.Normal;let e=t.color;"#"===e.charAt(0)?e=e.substr(1):0===e.indexOf("0x")&&(e=e.substr(2)),this.value=parseInt(e,16)}initParticles(t){let e=t;for(;e;)e.tint=this.value,e=e.next}}mT.type="colorStatic",mT.editorConfig=null;class gT{constructor(t){this.order=jS.Normal,this.index=0,this.textures=t.textures.map((t=>"string"==typeof t?NS(t):t))}initParticles(t){let e=t;for(;e;)e.texture=this.textures[this.index],++this.index>=this.textures.length&&(this.index=0),e=e.next}}gT.type="textureOrdered",gT.editorConfig=null;const yT=new Ah,xT=["E","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2","abs","acos","acosh","asin","asinh","atan","atanh","atan2","cbrt","ceil","cos","cosh","exp","expm1","floor","fround","hypot","log","log1p","log10","log2","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh"],vT=new RegExp(["[01234567890\\.\\*\\-\\+\\/\\(\\)x ,]"].concat(xT).join("|"),"g");class _T{constructor(t){var e;if(this.order=jS.Late,t.path)if("function"==typeof t.path)this.path=t.path;else try{this.path=function(t){const e=t.match(vT);for(let s=e.length-1;s>=0;--s)xT.indexOf(e[s])>=0&&(e[s]=`Math.${e[s]}`);return t=e.join(""),new Function("x",`return ${t};`)}(t.path)}catch(Zf){this.path=null}else this.path=t=>t;this.list=new aT(!1),this.list.reset(OS.createList(t.speed)),this.minMult=null!==(e=t.minMult)&&void 0!==e?e:1}initParticles(t){let e=t;for(;e;){e.config.initRotation=e.rotation,e.config.initPosition?e.config.initPosition.copyFrom(e.position):e.config.initPosition=new Ah(e.x,e.y),e.config.movement=0;const t=Math.random()*(1-this.minMult)+this.minMult;e.config.speedMult=t,e=e.next}}updateParticle(t,e){const s=this.list.interpolate(t.agePercent)*t.config.speedMult;t.config.movement+=s*e,yT.x=t.config.movement,yT.y=this.path(yT.x),LS(t.config.initRotation,yT),t.position.x=t.config.initPosition.x+yT.x,t.position.y=t.config.initPosition.y+yT.y}}_T.type="movePath",_T.editorConfig=null;class bT{constructor(){this.order=jS.Spawn}initParticles(t){}}bT.type="spawnPoint",bT.editorConfig=null;class wT{constructor(t){this.order=jS.Normal,this.textures=t.textures.map((t=>"string"==typeof t?NS(t):t))}initParticles(t){let e=t;for(;e;){const t=Math.floor(Math.random()*this.textures.length);e.texture=this.textures[t],e=e.next}}}wT.type="textureRandom",wT.editorConfig=null;class ET{constructor(t){this.order=jS.Normal,this.minStart=t.minStart*BS,this.maxStart=t.maxStart*BS,this.minSpeed=t.minSpeed*BS,this.maxSpeed=t.maxSpeed*BS,this.accel=t.accel*BS}initParticles(t){let e=t;for(;e;)this.minStart===this.maxStart?e.rotation+=this.maxStart:e.rotation+=Math.random()*(this.maxStart-this.minStart)+this.minStart,e.config.rotSpeed=Math.random()*(this.maxSpeed-this.minSpeed)+this.minSpeed,e=e.next}updateParticle(t,e){if(this.accel){const s=t.config.rotSpeed;t.config.rotSpeed+=this.accel*e,t.rotation+=(t.config.rotSpeed+s)/2*e}else t.rotation+=t.config.rotSpeed*e}}ET.type="rotation",ET.editorConfig=null;class ST{constructor(t){this.order=jS.Normal,this.min=t.min*BS,this.max=t.max*BS}initParticles(t){let e=t;for(;e;)this.min===this.max?e.rotation+=this.max:e.rotation+=Math.random()*(this.max-this.min)+this.min,e=e.next}}ST.type="rotationStatic",ST.editorConfig=null;class TT{constructor(t){this.order=jS.Late+1,this.rotation=(t.rotation||0)*BS}initParticles(t){let e=t;for(;e;)e.rotation=this.rotation,e=e.next}}TT.type="noRotation",TT.editorConfig=null;class AT{constructor(t){var e;this.order=jS.Normal,this.list=new aT(!1),this.list.reset(OS.createList(t.scale)),this.minMult=null!==(e=t.minMult)&&void 0!==e?e:1}initParticles(t){let e=t;for(;e;){const t=Math.random()*(1-this.minMult)+this.minMult;e.config.scaleMult=t,e.scale.x=e.scale.y=this.list.first.value*t,e=e.next}}updateParticle(t){t.scale.x=t.scale.y=this.list.interpolate(t.agePercent)*t.config.scaleMult}}AT.type="scale",AT.editorConfig=null;class CT{constructor(t){this.order=jS.Normal,this.min=t.min,this.max=t.max}initParticles(t){let e=t;for(;e;){const t=Math.random()*(this.max-this.min)+this.min;e.scale.x=e.scale.y=t,e=e.next}}}CT.type="scaleStatic",CT.editorConfig=null;class MT{constructor(t){this.order=jS.Spawn;const e=MT.shapes[t.type];if(!e)throw new Error(`No shape found with type '${t.type}'`);this.shape=new e(t.data)}static registerShape(t,e){MT.shapes[e||t.type]=t}initParticles(t){let e=t;for(;e;)this.shape.getRandPos(e),e=e.next}}MT.type="spawnShape",MT.editorConfig=null,MT.shapes={},MT.registerShape(QS),MT.registerShape(KS),MT.registerShape(ZS),MT.registerShape(ZS,"circle");class IT{constructor(t){this.order=jS.Normal,this.texture="string"==typeof t.texture?NS(t.texture):t.texture}initParticles(t){let e=t;for(;e;)e.texture=this.texture,e=e.next}}IT.type="textureSingle",IT.editorConfig=null;class PT{constructor(t){var e;this.order=jS.Late,this.list=new aT(!1),this.list.reset(OS.createList(t.speed)),this.minMult=null!==(e=t.minMult)&&void 0!==e?e:1}initParticles(t){let e=t;for(;e;){const t=Math.random()*(1-this.minMult)+this.minMult;e.config.speedMult=t,e.config.velocity?e.config.velocity.set(this.list.first.value*t,0):e.config.velocity=new Ah(this.list.first.value*t,0),LS(e.rotation,e.config.velocity),e=e.next}}updateParticle(t,e){const s=this.list.interpolate(t.agePercent)*t.config.speedMult,i=t.config.velocity;!function(t){const e=1/$S(t);t.x*=e,t.y*=e}(i),US(i,s),t.x+=i.x*e,t.y+=i.y*e}}PT.type="moveSpeed",PT.editorConfig=null;class RT{constructor(t){this.order=jS.Late,this.min=t.min,this.max=t.max}initParticles(t){let e=t;for(;e;){const t=Math.random()*(this.max-this.min)+this.min;e.config.velocity?e.config.velocity.set(t,0):e.config.velocity=new Ah(t,0),LS(e.rotation,e.config.velocity),e=e.next}}updateParticle(t,e){const s=t.config.velocity;t.x+=s.x*e,t.y+=s.y*e}}RT.type="moveSpeedStatic",RT.editorConfig=null,qS.registerBehavior(JS),qS.registerBehavior(oT),qS.registerBehavior(hT),qS.registerBehavior(cT),qS.registerBehavior(uT),qS.registerBehavior(dT),qS.registerBehavior(pT),qS.registerBehavior(fT),qS.registerBehavior(mT),qS.registerBehavior(gT),qS.registerBehavior(_T),qS.registerBehavior(bT),qS.registerBehavior(wT),qS.registerBehavior(ET),qS.registerBehavior(ST),qS.registerBehavior(TT),qS.registerBehavior(AT),qS.registerBehavior(CT),qS.registerBehavior(MT),qS.registerBehavior(IT),qS.registerBehavior(PT),qS.registerBehavior(RT);var kT=Object.defineProperty,DT=(t,e,s)=>(((t,e,s)=>{e in t?kT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s})(t,"symbol"!=typeof e?e+"":e,s),s);class FT{constructor(t){DT(this,"parent"),DT(this,"paused"),this.parent=t,this.paused=!1}destroy(){}down(t){return!1}move(t){return!1}up(t){return!1}wheel(t){return!1}update(t){}resize(){}reset(){}pause(){this.paused=!0}resume(){this.paused=!1}}var OT,NT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},BT={exports:{}};OT=BT,function(){var t,e;e=function(t){return OT.exports=t},t={linear:function(t,e,s,i){return s*t/i+e},easeInQuad:function(t,e,s,i){return s*(t/=i)*t+e},easeOutQuad:function(t,e,s,i){return-s*(t/=i)*(t-2)+e},easeInOutQuad:function(t,e,s,i){return(t/=i/2)<1?s/2*t*t+e:-s/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,s,i){return s*(t/=i)*t*t+e},easeOutCubic:function(t,e,s,i){return s*((t=t/i-1)*t*t+1)+e},easeInOutCubic:function(t,e,s,i){return(t/=i/2)<1?s/2*t*t*t+e:s/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,s,i){return s*(t/=i)*t*t*t+e},easeOutQuart:function(t,e,s,i){return-s*((t=t/i-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,s,i){return(t/=i/2)<1?s/2*t*t*t*t+e:-s/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,s,i){return s*(t/=i)*t*t*t*t+e},easeOutQuint:function(t,e,s,i){return s*((t=t/i-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,s,i){return(t/=i/2)<1?s/2*t*t*t*t*t+e:s/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,s,i){return-s*Math.cos(t/i*(Math.PI/2))+s+e},easeOutSine:function(t,e,s,i){return s*Math.sin(t/i*(Math.PI/2))+e},easeInOutSine:function(t,e,s,i){return-s/2*(Math.cos(Math.PI*t/i)-1)+e},easeInExpo:function(t,e,s,i){return 0===t?e:s*Math.pow(2,10*(t/i-1))+e},easeOutExpo:function(t,e,s,i){return t===i?e+s:s*(1-Math.pow(2,-10*t/i))+e},easeInOutExpo:function(t,e,s,i){return(t/=i/2)<1?s/2*Math.pow(2,10*(t-1))+e:s/2*(2-Math.pow(2,-10*--t))+e},easeInCirc:function(t,e,s,i){return-s*(Math.sqrt(1-(t/=i)*t)-1)+e},easeOutCirc:function(t,e,s,i){return s*Math.sqrt(1-(t=t/i-1)*t)+e},easeInOutCirc:function(t,e,s,i){return(t/=i/2)<1?-s/2*(Math.sqrt(1-t*t)-1)+e:s/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(t,e,s,i){var n,r,a;return a=1.70158,0===t||(t/=i),(r=0)||(r=.3*i),(n=s)<Math.abs(s)?(n=s,a=r/4):a=r/(2*Math.PI)*Math.asin(s/n),-n*Math.pow(2,10*(t-=1))*Math.sin((t*i-a)*(2*Math.PI)/r)+e},easeOutElastic:function(t,e,s,i){var n,r,a;return a=1.70158,0===t||(t/=i),(r=0)||(r=.3*i),(n=s)<Math.abs(s)?(n=s,a=r/4):a=r/(2*Math.PI)*Math.asin(s/n),n*Math.pow(2,-10*t)*Math.sin((t*i-a)*(2*Math.PI)/r)+s+e},easeInOutElastic:function(t,e,s,i){var n,r,a;return a=1.70158,0===t||(t/=i/2),(r=0)||(r=i*(.3*1.5)),(n=s)<Math.abs(s)?(n=s,a=r/4):a=r/(2*Math.PI)*Math.asin(s/n),t<1?n*Math.pow(2,10*(t-=1))*Math.sin((t*i-a)*(2*Math.PI)/r)*-.5+e:n*Math.pow(2,-10*(t-=1))*Math.sin((t*i-a)*(2*Math.PI)/r)*.5+s+e},easeInBack:function(t,e,s,i,n){return void 0===n&&(n=1.70158),s*(t/=i)*t*((n+1)*t-n)+e},easeOutBack:function(t,e,s,i,n){return void 0===n&&(n=1.70158),s*((t=t/i-1)*t*((n+1)*t+n)+1)+e},easeInOutBack:function(t,e,s,i,n){return void 0===n&&(n=1.70158),(t/=i/2)<1?s/2*(t*t*((1+(n*=1.525))*t-n))+e:s/2*((t-=2)*t*((1+(n*=1.525))*t+n)+2)+e},easeInBounce:function(e,s,i,n){return i-t.easeOutBounce(n-e,0,i,n)+s},easeOutBounce:function(t,e,s,i){return(t/=i)<1/2.75?s*(7.5625*t*t)+e:t<2/2.75?s*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?s*(7.5625*(t-=2.25/2.75)*t+.9375)+e:s*(7.5625*(t-=2.625/2.75)*t+.984375)+e},easeInOutBounce:function(e,s,i,n){return e<n/2?.5*t.easeInBounce(2*e,0,i,n)+s:.5*t.easeOutBounce(2*e-n,0,i,n)+.5*i+s}},e(t)}.call(NT);const LT=BT.exports;function VT(t,e){return t?"function"==typeof t?t:"string"==typeof t?LT[t]:void 0:LT[e]}const $T={removeOnInterrupt:!1,ease:"linear",time:1e3};class UT extends FT{constructor(t,e={}){super(t),DT(this,"options"),DT(this,"startX"),DT(this,"startY"),DT(this,"deltaX"),DT(this,"deltaY"),DT(this,"keepCenter"),DT(this,"startWidth",null),DT(this,"startHeight",null),DT(this,"deltaWidth",null),DT(this,"deltaHeight",null),DT(this,"width",null),DT(this,"height",null),DT(this,"time",0),this.options=Object.assign({},$T,e),this.options.ease=VT(this.options.ease),this.setupPosition(),this.setupZoom(),this.time=0}setupPosition(){typeof this.options.position<"u"?(this.startX=this.parent.center.x,this.startY=this.parent.center.y,this.deltaX=this.options.position.x-this.parent.center.x,this.deltaY=this.options.position.y-this.parent.center.y,this.keepCenter=!1):this.keepCenter=!0}setupZoom(){this.width=null,this.height=null,typeof this.options.scale<"u"?this.width=this.parent.screenWidth/this.options.scale:typeof this.options.scaleX<"u"||typeof this.options.scaleY<"u"?(typeof this.options.scaleX<"u"&&(this.width=this.parent.screenWidth/this.options.scaleX),typeof this.options.scaleY<"u"&&(this.height=this.parent.screenHeight/this.options.scaleY)):(typeof this.options.width<"u"&&(this.width=this.options.width),typeof this.options.height<"u"&&(this.height=this.options.height)),null!==this.width&&(this.startWidth=this.parent.screenWidthInWorldPixels,this.deltaWidth=this.width-this.startWidth),null!==this.height&&(this.startHeight=this.parent.screenHeightInWorldPixels,this.deltaHeight=this.height-this.startHeight)}down(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("animate"),!1}complete(){this.parent.plugins.remove("animate"),null!==this.width&&this.parent.fitWidth(this.width,this.keepCenter,null===this.height),null!==this.height&&this.parent.fitHeight(this.height,this.keepCenter,null===this.width),!this.keepCenter&&this.options.position&&this.parent.moveCenter(this.options.position),this.parent.emit("animate-end",this.parent),this.options.callbackOnComplete&&this.options.callbackOnComplete(this.parent)}update(t){if(this.paused)return;this.time+=t;const e=new Ah(this.parent.scale.x,this.parent.scale.y);if(this.time>=this.options.time){const t=this.parent.width,s=this.parent.height;this.complete(),(t!==this.parent.width||s!==this.parent.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}else{const t=this.options.ease(this.time,0,1,this.options.time);if(null!==this.width){const e=this.startWidth,s=this.deltaWidth;this.parent.fitWidth(e+s*t,this.keepCenter,null===this.height)}if(null!==this.height){const e=this.startHeight,s=this.deltaHeight;this.parent.fitHeight(e+s*t,this.keepCenter,null===this.width)}if(null===this.width?this.parent.scale.x=this.parent.scale.y:null===this.height&&(this.parent.scale.y=this.parent.scale.x),!this.keepCenter){const e=this.startX,s=this.startY,i=this.deltaX,n=this.deltaY,r=new Ah(this.parent.x,this.parent.y);this.parent.moveCenter(e+i*t,s+n*t),this.parent.emit("moved",{viewport:this.parent,original:r,type:"animate"})}(this.width||this.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}}}const XT={sides:"all",friction:.5,time:150,ease:"easeInOutSine",underflow:"center",bounceBox:null};class YT extends FT{constructor(t,e={}){super(t),DT(this,"options"),DT(this,"left"),DT(this,"top"),DT(this,"right"),DT(this,"bottom"),DT(this,"underflowX"),DT(this,"underflowY"),DT(this,"ease"),DT(this,"toX"),DT(this,"toY"),this.options=Object.assign({},XT,e),this.ease=VT(this.options.ease,"easeInOutSine"),this.options.sides?"all"===this.options.sides?this.top=this.bottom=this.left=this.right=!0:"horizontal"===this.options.sides?(this.right=this.left=!0,this.top=this.bottom=!1):"vertical"===this.options.sides?(this.left=this.right=!1,this.top=this.bottom=!0):(this.top=-1!==this.options.sides.indexOf("top"),this.bottom=-1!==this.options.sides.indexOf("bottom"),this.left=-1!==this.options.sides.indexOf("left"),this.right=-1!==this.options.sides.indexOf("right")):this.left=this.top=this.right=this.bottom=!1;const s=this.options.underflow.toLowerCase();"center"===s?(this.underflowX=0,this.underflowY=0):(this.underflowX=-1!==s.indexOf("left")?-1:-1!==s.indexOf("right")?1:0,this.underflowY=-1!==s.indexOf("top")?-1:-1!==s.indexOf("bottom")?1:0),this.reset()}isActive(){return null!==this.toX||null!==this.toY}down(){return this.toX=this.toY=null,!1}up(){return this.bounce(),!1}update(t){if(!this.paused){if(this.bounce(),this.toX){const e=this.toX;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-x"}),e.time>=this.options.time?(this.parent.x=e.end,this.toX=null,this.parent.emit("bounce-x-end",this.parent)):this.parent.x=this.ease(e.time,e.start,e.delta,this.options.time)}if(this.toY){const e=this.toY;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-y"}),e.time>=this.options.time?(this.parent.y=e.end,this.toY=null,this.parent.emit("bounce-y-end",this.parent)):this.parent.y=this.ease(e.time,e.start,e.delta,this.options.time)}}}calcUnderflowX(){let t;switch(this.underflowX){case-1:t=0;break;case 1:t=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:t=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}return t}calcUnderflowY(){let t;switch(this.underflowY){case-1:t=0;break;case 1:t=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:t=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}return t}oob(){const t=this.options.bounceBox;if(t){const e=typeof t.x>"u"?0:t.x,s=typeof t.y>"u"?0:t.y,i=typeof t.width>"u"?this.parent.worldWidth:t.width,n=typeof t.height>"u"?this.parent.worldHeight:t.height;return{left:this.parent.left<e,right:this.parent.right>i,top:this.parent.top<s,bottom:this.parent.bottom>n,topLeft:new Ah(e*this.parent.scale.x,s*this.parent.scale.y),bottomRight:new Ah(i*this.parent.scale.x-this.parent.screenWidth,n*this.parent.scale.y-this.parent.screenHeight)}}return{left:this.parent.left<0,right:this.parent.right>this.parent.worldWidth,top:this.parent.top<0,bottom:this.parent.bottom>this.parent.worldHeight,topLeft:new Ah(0,0),bottomRight:new Ah(this.parent.worldWidth*this.parent.scale.x-this.parent.screenWidth,this.parent.worldHeight*this.parent.scale.y-this.parent.screenHeight)}}bounce(){var t,e;if(this.paused)return;let s,i=this.parent.plugins.get("decelerate",!0);i&&(i.x||i.y)&&(i.x&&i.percentChangeX===(null==(t=i.options)?void 0:t.friction)||i.y&&i.percentChangeY===(null==(e=i.options)?void 0:e.friction))&&(s=this.oob(),(s.left&&this.left||s.right&&this.right)&&(i.percentChangeX=this.options.friction),(s.top&&this.top||s.bottom&&this.bottom)&&(i.percentChangeY=this.options.friction));const n=this.parent.plugins.get("drag",!0)||{},r=this.parent.plugins.get("pinch",!0)||{};if(i=i||{},!(null!=n&&n.active||null!=r&&r.active||this.toX&&this.toY||i.x&&i.y)){s=s||this.oob();const t=s.topLeft,e=s.bottomRight;if(!this.toX&&!i.x){let i=null;s.left&&this.left?i=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-t.x:s.right&&this.right&&(i=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-e.x),null!==i&&this.parent.x!==i&&(this.toX={time:0,start:this.parent.x,delta:i-this.parent.x,end:i},this.parent.emit("bounce-x-start",this.parent))}if(!this.toY&&!i.y){let i=null;s.top&&this.top?i=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-t.y:s.bottom&&this.bottom&&(i=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-e.y),null!==i&&this.parent.y!==i&&(this.toY={time:0,start:this.parent.y,delta:i-this.parent.y,end:i},this.parent.emit("bounce-y-start",this.parent))}}}reset(){this.toX=this.toY=null,this.bounce()}}const WT={left:!1,right:!1,top:!1,bottom:!1,direction:null,underflow:"center"};class jT extends FT{constructor(t,e={}){super(t),DT(this,"options"),DT(this,"last"),DT(this,"noUnderflow"),DT(this,"underflowX"),DT(this,"underflowY"),this.options=Object.assign({},WT,e),this.options.direction&&(this.options.left="x"===this.options.direction||"all"===this.options.direction||null,this.options.right="x"===this.options.direction||"all"===this.options.direction||null,this.options.top="y"===this.options.direction||"all"===this.options.direction||null,this.options.bottom="y"===this.options.direction||"all"===this.options.direction||null),this.parseUnderflow(),this.last={x:null,y:null,scaleX:null,scaleY:null},this.update()}parseUnderflow(){const t=this.options.underflow.toLowerCase();"none"===t?this.noUnderflow=!0:"center"===t?(this.underflowX=this.underflowY=0,this.noUnderflow=!1):(this.underflowX=-1!==t.indexOf("left")?-1:-1!==t.indexOf("right")?1:0,this.underflowY=-1!==t.indexOf("top")?-1:-1!==t.indexOf("bottom")?1:0,this.noUnderflow=!1)}move(){return this.update(),!1}update(){if(this.paused||this.parent.x===this.last.x&&this.parent.y===this.last.y&&this.parent.scale.x===this.last.scaleX&&this.parent.scale.y===this.last.scaleY)return;const t=new Ah(this.parent.x,this.parent.y),e=this.parent.plugins.decelerate||{};if(null!==this.options.left||null!==this.options.right){let s=!1;if(!this.noUnderflow&&this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:0!==this.parent.x&&(this.parent.x=0,s=!0);break;case 1:this.parent.x!==this.parent.screenWidth-this.parent.screenWorldWidth&&(this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth,s=!0);break;default:this.parent.x!==(this.parent.screenWidth-this.parent.screenWorldWidth)/2&&(this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2,s=!0)}else null!==this.options.left&&this.parent.left<(!0===this.options.left?0:this.options.left)&&(this.parent.x=-(!0===this.options.left?0:this.options.left)*this.parent.scale.x,e.x=0,s=!0),null!==this.options.right&&this.parent.right>(!0===this.options.right?this.parent.worldWidth:this.options.right)&&(this.parent.x=-(!0===this.options.right?this.parent.worldWidth:this.options.right)*this.parent.scale.x+this.parent.screenWidth,e.x=0,s=!0);s&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-x"})}if(null!==this.options.top||null!==this.options.bottom){let s=!1;if(!this.noUnderflow&&this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:0!==this.parent.y&&(this.parent.y=0,s=!0);break;case 1:this.parent.y!==this.parent.screenHeight-this.parent.screenWorldHeight&&(this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight,s=!0);break;default:this.parent.y!==(this.parent.screenHeight-this.parent.screenWorldHeight)/2&&(this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2,s=!0)}else null!==this.options.top&&this.parent.top<(!0===this.options.top?0:this.options.top)&&(this.parent.y=-(!0===this.options.top?0:this.options.top)*this.parent.scale.y,e.y=0,s=!0),null!==this.options.bottom&&this.parent.bottom>(!0===this.options.bottom?this.parent.worldHeight:this.options.bottom)&&(this.parent.y=-(!0===this.options.bottom?this.parent.worldHeight:this.options.bottom)*this.parent.scale.y+this.parent.screenHeight,e.y=0,s=!0);s&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-y"})}this.last.x=this.parent.x,this.last.y=this.parent.y,this.last.scaleX=this.parent.scale.x,this.last.scaleY=this.parent.scale.y}reset(){this.update()}}const GT={minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,minScale:null,maxScale:null};class zT extends FT{constructor(t,e={}){super(t),DT(this,"options"),this.options=Object.assign({},GT,e),this.clamp()}resize(){this.clamp()}clamp(){if(!this.paused)if(this.options.minWidth||this.options.minHeight||this.options.maxWidth||this.options.maxHeight){let t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight;if(null!==this.options.minWidth&&t<this.options.minWidth){const s=this.parent.scale.x;this.parent.fitWidth(this.options.minWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/s,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(null!==this.options.maxWidth&&t>this.options.maxWidth){const s=this.parent.scale.x;this.parent.fitWidth(this.options.maxWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/s,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(null!==this.options.minHeight&&e<this.options.minHeight){const s=this.parent.scale.y;this.parent.fitHeight(this.options.minHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/s,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(null!==this.options.maxHeight&&e>this.options.maxHeight){const t=this.parent.scale.y;this.parent.fitHeight(this.options.maxHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/t,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}}else if(this.options.minScale||this.options.maxScale){const t={x:null,y:null},e={x:null,y:null};if("number"==typeof this.options.minScale)t.x=this.options.minScale,t.y=this.options.minScale;else if(null!==this.options.minScale){const e=this.options.minScale;t.x=typeof e.x>"u"?null:e.x,t.y=typeof e.y>"u"?null:e.y}if("number"==typeof this.options.maxScale)e.x=this.options.maxScale,e.y=this.options.maxScale;else if(null!==this.options.maxScale){const t=this.options.maxScale;e.x=typeof t.x>"u"?null:t.x,e.y=typeof t.y>"u"?null:t.y}let s=this.parent.scale.x,i=this.parent.scale.y;null!==t.x&&s<t.x&&(s=t.x),null!==e.x&&s>e.x&&(s=e.x),null!==t.y&&i<t.y&&(i=t.y),null!==e.y&&i>e.y&&(i=e.y),(s!==this.parent.scale.x||i!==this.parent.scale.y)&&(this.parent.scale.set(s,i),this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"}))}}reset(){this.clamp()}}const HT={friction:.98,bounce:.8,minSpeed:.01},qT=16;class KT extends FT{constructor(t,e={}){super(t),DT(this,"options"),DT(this,"x"),DT(this,"y"),DT(this,"percentChangeX"),DT(this,"percentChangeY"),DT(this,"saved"),DT(this,"timeSinceRelease"),this.options=Object.assign({},HT,e),this.saved=[],this.timeSinceRelease=0,this.reset(),this.parent.on("moved",(t=>this.handleMoved(t)))}down(){return this.saved=[],this.x=this.y=null,!1}isActive(){return!(!this.x&&!this.y)}move(){if(this.paused)return!1;const t=this.parent.input.count();return(1===t||t>1&&!this.parent.plugins.get("pinch",!0))&&(this.saved.push({x:this.parent.x,y:this.parent.y,time:performance.now()}),this.saved.length>60&&this.saved.splice(0,30)),!1}handleMoved(t){if(this.saved.length){const e=this.saved[this.saved.length-1];"clamp-x"===t.type&&t.original?e.x===t.original.x&&(e.x=this.parent.x):"clamp-y"===t.type&&t.original&&e.y===t.original.y&&(e.y=this.parent.y)}}up(){if(0===this.parent.input.count()&&this.saved.length){const t=performance.now();for(const e of this.saved)if(e.time>=t-100){const s=t-e.time;this.x=(this.parent.x-e.x)/s,this.y=(this.parent.y-e.y)/s,this.percentChangeX=this.percentChangeY=this.options.friction,this.timeSinceRelease=0;break}}return!1}activate(t){typeof(t=t||{}).x<"u"&&(this.x=t.x,this.percentChangeX=this.options.friction),typeof t.y<"u"&&(this.y=t.y,this.percentChangeY=this.options.friction)}update(t){if(this.paused)return;const e=this.x||this.y,s=this.timeSinceRelease,i=this.timeSinceRelease+t;if(this.x){const e=this.percentChangeX,n=Math.log(e);this.parent.x+=this.x*qT/n*(Math.pow(e,i/qT)-Math.pow(e,s/qT)),this.x*=Math.pow(this.percentChangeX,t/qT)}if(this.y){const e=this.percentChangeY,n=Math.log(e);this.parent.y+=this.y*qT/n*(Math.pow(e,i/qT)-Math.pow(e,s/qT)),this.y*=Math.pow(this.percentChangeY,t/qT)}this.timeSinceRelease+=t,this.x&&this.y?Math.abs(this.x)<this.options.minSpeed&&Math.abs(this.y)<this.options.minSpeed&&(this.x=0,this.y=0):(Math.abs(this.x||0)<this.options.minSpeed&&(this.x=0),Math.abs(this.y||0)<this.options.minSpeed&&(this.y=0)),e&&this.parent.emit("moved",{viewport:this.parent,type:"decelerate"})}reset(){this.x=this.y=null}}const ZT={direction:"all",pressDrag:!0,wheel:!0,wheelScroll:1,reverse:!1,clampWheel:!1,underflow:"center",factor:1,mouseButtons:"all",keyToPress:null,ignoreKeyToPressOnTouch:!1,lineHeight:20,wheelSwapAxes:!1};class QT extends FT{constructor(t,e={}){super(t),DT(this,"options"),DT(this,"moved"),DT(this,"reverse"),DT(this,"xDirection"),DT(this,"yDirection"),DT(this,"keyIsPressed"),DT(this,"mouse"),DT(this,"underflowX"),DT(this,"underflowY"),DT(this,"last"),DT(this,"current"),DT(this,"windowEventHandlers",[]),this.options=Object.assign({},ZT,e),this.moved=!1,this.reverse=this.options.reverse?1:-1,this.xDirection=!this.options.direction||"all"===this.options.direction||"x"===this.options.direction,this.yDirection=!this.options.direction||"all"===this.options.direction||"y"===this.options.direction,this.keyIsPressed=!1,this.parseUnderflow(),this.mouseButtons(this.options.mouseButtons),this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){this.addWindowEventHandler("keyup",(e=>{t.includes(e.code)&&(this.keyIsPressed=!1)})),this.addWindowEventHandler("keydown",(e=>{t.includes(e.code)&&(this.keyIsPressed=!0)}))}addWindowEventHandler(t,e){window.addEventListener(t,e),this.windowEventHandlers.push({event:t,handler:e})}destroy(){this.windowEventHandlers.forEach((({event:t,handler:e})=>{window.removeEventListener(t,e)}))}mouseButtons(t){this.mouse=t&&"all"!==t?[-1!==t.indexOf("left"),-1!==t.indexOf("middle"),-1!==t.indexOf("right")]:[!0,!0,!0]}parseUnderflow(){const t=this.options.underflow.toLowerCase();"center"===t?(this.underflowX=0,this.underflowY=0):(t.includes("left")?this.underflowX=-1:t.includes("right")?this.underflowX=1:this.underflowX=0,t.includes("top")?this.underflowY=-1:t.includes("bottom")?this.underflowY=1:this.underflowY=0)}checkButtons(t){const e="mouse"===t.pointerType,s=this.parent.input.count();return!(!(1===s||s>1&&!this.parent.plugins.get("pinch",!0))||e&&!this.mouse[t.button])}checkKeyPress(t){return!this.options.keyToPress||this.keyIsPressed||this.options.ignoreKeyToPressOnTouch&&"touch"===t.data.pointerType}down(t){return!(this.paused||!this.options.pressDrag)&&(this.checkButtons(t)&&this.checkKeyPress(t)?(this.last={x:t.global.x,y:t.global.y},this.current=t.pointerId,!0):(this.last=null,!1))}get active(){return this.moved}move(t){if(this.paused||!this.options.pressDrag)return!1;if(this.last&&this.current===t.data.pointerId){const e=t.global.x,s=t.global.y,i=this.parent.input.count();if(1===i||i>1&&!this.parent.plugins.get("pinch",!0)){const i=e-this.last.x,n=s-this.last.y;if(this.moved||this.xDirection&&this.parent.input.checkThreshold(i)||this.yDirection&&this.parent.input.checkThreshold(n)){const i={x:e,y:s};return this.xDirection&&(this.parent.x+=(i.x-this.last.x)*this.options.factor),this.yDirection&&(this.parent.y+=(i.y-this.last.y)*this.options.factor),this.last=i,this.moved||this.parent.emit("drag-start",{event:t,screen:new Ah(this.last.x,this.last.y),world:this.parent.toWorld(new Ah(this.last.x,this.last.y)),viewport:this.parent}),this.moved=!0,this.parent.emit("moved",{viewport:this.parent,type:"drag"}),!0}}else this.moved=!1}return!1}up(t){if(this.paused)return!1;const e=this.parent.input.touches;if(1===e.length){const t=e[0];return t.last&&(this.last={x:t.last.x,y:t.last.y},this.current=t.id),this.moved=!1,!0}if(this.last&&this.moved){const e=new Ah(this.last.x,this.last.y);return this.parent.emit("drag-end",{event:t,screen:e,world:this.parent.toWorld(e),viewport:this.parent}),this.last=null,this.moved=!1,!0}return!1}wheel(t){if(this.paused)return!1;if(this.options.wheel){const e=this.parent.plugins.get("wheel",!0);if(!e||!e.options.wheelZoom&&!t.ctrlKey){const e=t.deltaMode?this.options.lineHeight:1,s=[t.deltaX,t.deltaY],[i,n]=this.options.wheelSwapAxes?s.reverse():s;return this.xDirection&&(this.parent.x+=i*e*this.options.wheelScroll*this.reverse),this.yDirection&&(this.parent.y+=n*e*this.options.wheelScroll*this.reverse),this.options.clampWheel&&this.clamp(),this.parent.emit("wheel-scroll",this.parent),this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.options.passiveWheel||t.preventDefault(),this.parent.options.stopPropagation&&t.stopPropagation(),!0}}return!1}resume(){this.last=null,this.paused=!1}clamp(){const t=this.parent.plugins.get("decelerate",!0)||{};if("y"!==this.options.clampWheel)if(this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x=0;break;case 1:this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}else this.parent.left<0?(this.parent.x=0,t.x=0):this.parent.right>this.parent.worldWidth&&(this.parent.x=-this.parent.worldWidth*this.parent.scale.x+this.parent.screenWidth,t.x=0);if("x"!==this.options.clampWheel)if(this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y=0;break;case 1:this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}else this.parent.top<0&&(this.parent.y=0,t.y=0),this.parent.bottom>this.parent.worldHeight&&(this.parent.y=-this.parent.worldHeight*this.parent.scale.y+this.parent.screenHeight,t.y=0)}}const JT={speed:0,acceleration:null,radius:null};class tA extends FT{constructor(t,e,s={}){super(t),DT(this,"options"),DT(this,"target"),DT(this,"velocity"),this.target=e,this.options=Object.assign({},JT,s),this.velocity={x:0,y:0}}update(t){if(this.paused)return;const e=this.parent.center;let s=this.target.x,i=this.target.y;if(this.options.radius){if(!(Math.sqrt(Math.pow(this.target.y-e.y,2)+Math.pow(this.target.x-e.x,2))>this.options.radius))return;{const t=Math.atan2(this.target.y-e.y,this.target.x-e.x);s=this.target.x-Math.cos(t)*this.options.radius,i=this.target.y-Math.sin(t)*this.options.radius}}const n=s-e.x,r=i-e.y;if(n||r)if(this.options.speed)if(this.options.acceleration){const t=Math.atan2(i-e.y,s-e.x),a=Math.sqrt(Math.pow(n,2)+Math.pow(r,2));if(a){const o=(Math.pow(this.velocity.x,2)+Math.pow(this.velocity.y,2))/(2*this.options.acceleration);this.velocity=a>o?{x:Math.min(this.velocity.x+(this.options.acceleration,this.options.speed)),y:Math.min(this.velocity.y+(this.options.acceleration,this.options.speed))}:{x:Math.max(this.velocity.x-this.options.acceleration*this.options.speed,0),y:Math.max(this.velocity.y-this.options.acceleration*this.options.speed,0)};const h=Math.cos(t)*this.velocity.x,l=Math.sin(t)*this.velocity.y,c=Math.abs(h)>Math.abs(n)?s:e.x+h,u=Math.abs(l)>Math.abs(r)?i:e.y+l;this.parent.moveCenter(c,u),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}else{const t=Math.atan2(i-e.y,s-e.x),a=Math.cos(t)*this.options.speed,o=Math.sin(t)*this.options.speed,h=Math.abs(a)>Math.abs(n)?s:e.x+a,l=Math.abs(o)>Math.abs(r)?i:e.y+o;this.parent.moveCenter(h,l),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}else this.parent.moveCenter(s,i),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}const eA={radius:null,distance:null,top:null,bottom:null,left:null,right:null,speed:8,reverse:!1,noDecelerate:!1,linear:!1,allowButtons:!1};class sA extends FT{constructor(t,e={}){super(t),DT(this,"options"),DT(this,"reverse"),DT(this,"radiusSquared"),DT(this,"left"),DT(this,"top"),DT(this,"right"),DT(this,"bottom"),DT(this,"horizontal"),DT(this,"vertical"),this.options=Object.assign({},eA,e),this.reverse=this.options.reverse?1:-1,this.radiusSquared="number"==typeof this.options.radius?Math.pow(this.options.radius,2):null,this.resize()}resize(){const t=this.options.distance;null!==t?(this.left=t,this.top=t,this.right=this.parent.screenWidth-t,this.bottom=this.parent.screenHeight-t):this.options.radius||(this.left=this.options.left,this.top=this.options.top,this.right=null===this.options.right?null:this.parent.screenWidth-this.options.right,this.bottom=null===this.options.bottom?null:this.parent.screenHeight-this.options.bottom)}down(){return this.paused||this.options.allowButtons||(this.horizontal=this.vertical=null),!1}move(t){if(this.paused||"mouse"!==t.pointerType&&1!==t.pointerId||!this.options.allowButtons&&0!==t.buttons)return!1;const e=t.global.x,s=t.global.y;if(this.radiusSquared){const t=this.parent.toScreen(this.parent.center);if(Math.pow(t.x-e,2)+Math.pow(t.y-s,2)>=this.radiusSquared){const i=Math.atan2(t.y-s,t.x-e);this.options.linear?(this.horizontal=Math.round(Math.cos(i))*this.options.speed*this.reverse*.06,this.vertical=Math.round(Math.sin(i))*this.options.speed*this.reverse*.06):(this.horizontal=Math.cos(i)*this.options.speed*this.reverse*.06,this.vertical=Math.sin(i)*this.options.speed*this.reverse*.06)}else this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=0}else null!==this.left&&e<this.left?this.horizontal=Number(this.reverse)*this.options.speed*.06:null!==this.right&&e>this.right?this.horizontal=-1*this.reverse*this.options.speed*.06:(this.decelerateHorizontal(),this.horizontal=0),null!==this.top&&s<this.top?this.vertical=Number(this.reverse)*this.options.speed*.06:null!==this.bottom&&s>this.bottom?this.vertical=-1*this.reverse*this.options.speed*.06:(this.decelerateVertical(),this.vertical=0);return!1}decelerateHorizontal(){const t=this.parent.plugins.get("decelerate",!0);this.horizontal&&t&&!this.options.noDecelerate&&t.activate({x:this.horizontal*this.options.speed*this.reverse/(1e3/60)})}decelerateVertical(){const t=this.parent.plugins.get("decelerate",!0);this.vertical&&t&&!this.options.noDecelerate&&t.activate({y:this.vertical*this.options.speed*this.reverse/(1e3/60)})}up(){return this.paused||(this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=null),!1}update(){if(!this.paused&&(this.horizontal||this.vertical)){const t=this.parent.center;this.horizontal&&(t.x+=this.horizontal*this.options.speed),this.vertical&&(t.y+=this.vertical*this.options.speed),this.parent.moveCenter(t),this.parent.emit("moved",{viewport:this.parent,type:"mouse-edges"})}}}const iA={noDrag:!1,percent:1,center:null,factor:1,axis:"all"};class nA extends FT{constructor(t,e={}){super(t),DT(this,"options"),DT(this,"active",!1),DT(this,"pinching",!1),DT(this,"moved",!1),DT(this,"lastCenter"),this.options=Object.assign({},iA,e)}down(){return this.parent.input.count()>=2&&(this.active=!0,!0)}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}move(t){if(this.paused||!this.active)return!1;const e=t.global.x,s=t.global.y,i=this.parent.input.touches;if(i.length>=2){const n=i[0],r=i[1],a=n.last&&r.last?Math.sqrt(Math.pow(r.last.x-n.last.x,2)+Math.pow(r.last.y-n.last.y,2)):null;if(n.id===t.pointerId?n.last={x:e,y:s,data:t}:r.id===t.pointerId&&(r.last={x:e,y:s,data:t}),a){let t;const e=new Ah(n.last.x+(r.last.x-n.last.x)/2,n.last.y+(r.last.y-n.last.y)/2);this.options.center||(t=this.parent.toLocal(e));let s=Math.sqrt(Math.pow(r.last.x-n.last.x,2)+Math.pow(r.last.y-n.last.y,2));s=0===s?s=1e-10:s;const i=(1-a/s)*this.options.percent*(this.isAxisX()?this.parent.scale.x:this.parent.scale.y);this.isAxisX()&&(this.parent.scale.x+=i),this.isAxisY()&&(this.parent.scale.y+=i),this.parent.emit("zoomed",{viewport:this.parent,type:"pinch",center:e});const o=this.parent.plugins.get("clamp-zoom",!0);if(o&&o.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const s=this.parent.toGlobal(t);this.parent.x+=(e.x-s.x)*this.options.factor,this.parent.y+=(e.y-s.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})}!this.options.noDrag&&this.lastCenter&&(this.parent.x+=(e.x-this.lastCenter.x)*this.options.factor,this.parent.y+=(e.y-this.lastCenter.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})),this.lastCenter=e,this.moved=!0}else this.pinching||(this.parent.emit("pinch-start",this.parent),this.pinching=!0);return!0}return!1}up(){return!!(this.pinching&&this.parent.input.touches.length<=1)&&(this.active=!1,this.lastCenter=null,this.pinching=!1,this.moved=!1,this.parent.emit("pinch-end",this.parent),!0)}}const rA={topLeft:!1,friction:.8,time:1e3,ease:"easeInOutSine",interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1};class aA extends FT{constructor(t,e,s,i={}){super(t),DT(this,"options"),DT(this,"ease"),DT(this,"x"),DT(this,"y"),DT(this,"percent"),DT(this,"snapping"),DT(this,"deltaX"),DT(this,"deltaY"),DT(this,"startX"),DT(this,"startY"),this.options=Object.assign({},rA,i),this.ease=VT(i.ease,"easeInOutSine"),this.x=e,this.y=s,this.options.forceStart&&this.snapStart()}snapStart(){this.percent=0,this.snapping={time:0};const t=this.options.topLeft?this.parent.corner:this.parent.center;this.deltaX=this.x-t.x,this.deltaY=this.y-t.y,this.startX=t.x,this.startY=t.y,this.parent.emit("snap-start",this.parent)}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap"):this.options.interrupt&&(this.snapping=null),!1}up(){if(0===this.parent.input.count()){const t=this.parent.plugins.get("decelerate",!0);t&&(t.x||t.y)&&(t.percentChangeX=t.percentChangeY=this.options.friction)}return!1}update(t){if(!(this.paused||this.options.interrupt&&0!==this.parent.input.count()))if(this.snapping){const e=this.snapping;let s,i,n;e.time+=t;const r=this.startX,a=this.startY,o=this.deltaX,h=this.deltaY;if(e.time>this.options.time)s=!0,i=r+o,n=a+h;else{const t=this.ease(e.time,0,1,this.options.time);i=r+o*t,n=a+h*t}this.options.topLeft?this.parent.moveCorner(i,n):this.parent.moveCenter(i,n),this.parent.emit("moved",{viewport:this.parent,type:"snap"}),s&&(this.options.removeOnComplete&&this.parent.plugins.remove("snap"),this.parent.emit("snap-end",this.parent),this.snapping=null)}else{const t=this.options.topLeft?this.parent.corner:this.parent.center;(t.x!==this.x||t.y!==this.y)&&this.snapStart()}}}const oA={width:0,height:0,time:1e3,ease:"easeInOutSine",center:null,interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1,noMove:!1};class hA extends FT{constructor(t,e={}){super(t),DT(this,"options"),DT(this,"ease"),DT(this,"xScale"),DT(this,"yScale"),DT(this,"xIndependent"),DT(this,"yIndependent"),DT(this,"snapping"),this.options=Object.assign({},oA,e),this.ease=VT(this.options.ease),this.xIndependent=!1,this.yIndependent=!1,this.xScale=0,this.yScale=0,this.options.width>0&&(this.xScale=t.screenWidth/this.options.width,this.xIndependent=!0),this.options.height>0&&(this.yScale=t.screenHeight/this.options.height,this.yIndependent=!0),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale,0===this.options.time?(t.container.scale.x=this.xScale,t.container.scale.y=this.yScale,this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom")):e.forceStart&&this.createSnapping()}createSnapping(){const t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,s=this.parent.screenWidth/this.xScale,i=this.parent.screenHeight/this.yScale;this.snapping={time:0,startX:t,startY:e,deltaX:s-t,deltaY:i-e},this.parent.emit("snap-zoom-start",this.parent)}resize(){this.snapping=null,this.options.width>0&&(this.xScale=this.parent.screenWidth/this.options.width),this.options.height>0&&(this.yScale=this.parent.screenHeight/this.options.height),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap-zoom"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap-zoom"):this.options.interrupt&&(this.snapping=null),!1}update(t){if(this.paused||this.options.interrupt&&0!==this.parent.input.count())return;let e;if(!this.options.center&&!this.options.noMove&&(e=this.parent.center),this.snapping){if(this.snapping){const s=this.snapping;if(s.time+=t,s.time>=this.options.time)this.parent.scale.set(this.xScale,this.yScale),this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom"),this.parent.emit("snap-zoom-end",this.parent),this.snapping=null;else{const t=this.snapping,e=this.ease(t.time,t.startX,t.deltaX,this.options.time),s=this.ease(t.time,t.startY,t.deltaY,this.options.time);this.parent.scale.x=this.parent.screenWidth/e,this.parent.scale.y=this.parent.screenHeight/s}const i=this.parent.plugins.get("clamp-zoom",!0);i&&i.clamp(),this.options.noMove||(this.options.center?this.parent.moveCenter(this.options.center):this.parent.moveCenter(e))}}else(this.parent.scale.x!==this.xScale||this.parent.scale.y!==this.yScale)&&this.createSnapping()}resume(){this.snapping=null,super.resume()}}const lA={percent:.1,smooth:!1,interrupt:!0,reverse:!1,center:null,lineHeight:20,axis:"all",keyToPress:null,trackpadPinch:!1,wheelZoom:!0};class cA extends FT{constructor(t,e={}){super(t),DT(this,"options"),DT(this,"smoothing"),DT(this,"smoothingCenter"),DT(this,"smoothingCount"),DT(this,"keyIsPressed"),this.options=Object.assign({},lA,e),this.keyIsPressed=!1,this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){window.addEventListener("keydown",(e=>{t.includes(e.code)&&(this.keyIsPressed=!0)})),window.addEventListener("keyup",(e=>{t.includes(e.code)&&(this.keyIsPressed=!1)}))}checkKeyPress(){return!this.options.keyToPress||this.keyIsPressed}down(){return this.options.interrupt&&(this.smoothing=null),!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}update(){if(this.smoothing){const t=this.smoothingCenter,e=this.smoothing;let s;this.options.center||(s=this.parent.toLocal(t)),this.isAxisX()&&(this.parent.scale.x+=e.x),this.isAxisY()&&(this.parent.scale.y+=e.y),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const i=this.parent.plugins.get("clamp-zoom",!0);if(i&&i.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const e=this.parent.toGlobal(s);this.parent.x+=t.x-e.x,this.parent.y+=t.y-e.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.smoothingCount++,this.smoothingCount>=this.options.smooth&&(this.smoothing=null)}}pinch(t){if(this.paused)return;const e=this.parent.input.getPointerPosition(t),s=-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/200,i=Math.pow(2,(1+this.options.percent)*s);let n;this.options.center||(n=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=i),this.isAxisY()&&(this.parent.scale.y*=i),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const r=this.parent.plugins.get("clamp-zoom",!0);if(r&&r.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const t=this.parent.toGlobal(n);this.parent.x+=e.x-t.x,this.parent.y+=e.y-t.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}wheel(t){if(this.paused||!this.checkKeyPress())return!1;if(t.ctrlKey&&this.options.trackpadPinch)this.pinch(t);else if(this.options.wheelZoom){const e=this.parent.input.getPointerPosition(t),s=(this.options.reverse?-1:1)*-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/500,i=Math.pow(2,(1+this.options.percent)*s);if(this.options.smooth){const t={x:this.smoothing?this.smoothing.x*(this.options.smooth-this.smoothingCount):0,y:this.smoothing?this.smoothing.y*(this.options.smooth-this.smoothingCount):0};this.smoothing={x:((this.parent.scale.x+t.x)*i-this.parent.scale.x)/this.options.smooth,y:((this.parent.scale.y+t.y)*i-this.parent.scale.y)/this.options.smooth},this.smoothingCount=0,this.smoothingCenter=e}else{let t;this.options.center||(t=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=i),this.isAxisY()&&(this.parent.scale.y*=i),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const s=this.parent.plugins.get("clamp-zoom",!0);if(s&&s.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const s=this.parent.toGlobal(t);this.parent.x+=e.x-s.x,this.parent.y+=e.y-s.y}}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}return!this.parent.options.passiveWheel}}class uA{constructor(t){DT(this,"viewport"),DT(this,"clickedAvailable"),DT(this,"isMouseDown"),DT(this,"last"),DT(this,"wheelFunction"),DT(this,"touches"),this.viewport=t,this.touches=[],this.addListeners()}addListeners(){this.viewport.interactive=!0,this.viewport.forceHitArea||(this.viewport.hitArea=new Mh(0,0,this.viewport.worldWidth,this.viewport.worldHeight)),this.viewport.on("pointerdown",this.down,this),this.viewport.on("pointermove",this.move,this),this.viewport.on("pointerup",this.up,this),this.viewport.on("pointerupoutside",this.up,this),this.viewport.on("pointercancel",this.up,this),this.viewport.on("pointerout",this.up,this),this.wheelFunction=t=>this.handleWheel(t),this.viewport.options.events.domElement.addEventListener("wheel",this.wheelFunction,{passive:this.viewport.options.passiveWheel}),this.isMouseDown=!1}destroy(){this.viewport.options.events.domElement.removeEventListener("wheel",this.wheelFunction)}down(t){if(!this.viewport.pause&&this.viewport.worldVisible){if("mouse"===t.pointerType?this.isMouseDown=!0:this.get(t.pointerId)||this.touches.push({id:t.pointerId,last:null}),1===this.count()){this.last=t.global.clone();const e=this.viewport.plugins.get("decelerate",!0),s=this.viewport.plugins.get("bounce",!0);e&&e.isActive()||s&&s.isActive()?this.clickedAvailable=!1:this.clickedAvailable=!0}else this.clickedAvailable=!1;this.viewport.plugins.down(t)&&this.viewport.options.stopPropagation&&t.stopPropagation()}}clear(){this.isMouseDown=!1,this.touches=[],this.last=null}checkThreshold(t){return Math.abs(t)>=this.viewport.threshold}move(t){if(this.viewport.pause||!this.viewport.worldVisible)return;const e=this.viewport.plugins.move(t);if(this.clickedAvailable&&this.last){const e=t.global.x-this.last.x,s=t.global.y-this.last.y;(this.checkThreshold(e)||this.checkThreshold(s))&&(this.clickedAvailable=!1)}e&&this.viewport.options.stopPropagation&&t.stopPropagation()}up(t){if(this.viewport.pause||!this.viewport.worldVisible)return;"mouse"===t.pointerType&&(this.isMouseDown=!1),"mouse"!==t.pointerType&&this.remove(t.pointerId);const e=this.viewport.plugins.up(t);this.clickedAvailable&&0===this.count()&&this.last&&(this.viewport.emit("clicked",{event:t,screen:this.last,world:this.viewport.toWorld(this.last),viewport:this.viewport}),this.clickedAvailable=!1),e&&this.viewport.options.stopPropagation&&t.stopPropagation()}getPointerPosition(t){const e=new Ah;return this.viewport.options.events.mapPositionToPoint(e,t.clientX,t.clientY),e}handleWheel(t){if(this.viewport.pause||!this.viewport.worldVisible)return;const e=this.viewport.toLocal(this.getPointerPosition(t));this.viewport.left<=e.x&&e.x<=this.viewport.right&&this.viewport.top<=e.y&&e.y<=this.viewport.bottom&&this.viewport.plugins.wheel(t)&&!this.viewport.options.passiveWheel&&t.preventDefault()}pause(){this.touches=[],this.isMouseDown=!1}get(t){for(const e of this.touches)if(e.id===t)return e;return null}remove(t){for(let e=0;e<this.touches.length;e++)if(this.touches[e].id===t)return void this.touches.splice(e,1)}count(){return(this.isMouseDown?1:0)+this.touches.length}}const dA=["drag","pinch","wheel","follow","mouse-edges","decelerate","animate","bounce","snap-zoom","clamp-zoom","snap","clamp"];class pA{constructor(t){DT(this,"plugins"),DT(this,"list"),DT(this,"viewport"),this.viewport=t,this.list=[],this.plugins={}}add(t,e,s=dA.length){const i=this.plugins[t];i&&i.destroy(),this.plugins[t]=e;const n=dA.indexOf(t);-1!==n&&dA.splice(n,1),dA.splice(s,0,t),this.sort()}get(t,e){var s;return e&&null!=(s=this.plugins[t])&&s.paused?null:this.plugins[t]}update(t){for(const e of this.list)e.update(t)}resize(){for(const t of this.list)t.resize()}reset(){for(const t of this.list)t.reset()}removeAll(){this.list.forEach((t=>{t.destroy()})),this.plugins={},this.sort()}remove(t){var e;this.plugins[t]&&(null==(e=this.plugins[t])||e.destroy(),delete this.plugins[t],this.viewport.emit("plugin-remove",t),this.sort())}pause(t){var e;null==(e=this.plugins[t])||e.pause()}resume(t){var e;null==(e=this.plugins[t])||e.resume()}sort(){this.list=[];for(const t of dA)this.plugins[t]&&this.list.push(this.plugins[t])}down(t){let e=!1;for(const s of this.list)s.down(t)&&(e=!0);return e}move(t){let e=!1;for(const s of this.viewport.plugins.list)s.move(t)&&(e=!0);return e}up(t){let e=!1;for(const s of this.list)s.up(t)&&(e=!0);return e}wheel(t){let e=!1;for(const s of this.list)s.wheel(t)&&(e=!0);return e}}const fA={screenWidth:window.innerWidth,screenHeight:window.innerHeight,worldWidth:null,worldHeight:null,threshold:5,passiveWheel:!0,stopPropagation:!1,forceHitArea:null,noTicker:!1,disableOnContextMenu:!1,ticker:Oc.shared};class mA extends ru{constructor(t){super(),DT(this,"moving"),DT(this,"screenWidth"),DT(this,"screenHeight"),DT(this,"threshold"),DT(this,"input"),DT(this,"plugins"),DT(this,"zooming"),DT(this,"lastViewport"),DT(this,"options"),DT(this,"_dirty"),DT(this,"_forceHitArea"),DT(this,"_hitAreaDefault"),DT(this,"_pause"),DT(this,"tickerFunction"),DT(this,"_worldWidth"),DT(this,"_worldHeight"),DT(this,"_disableOnContextMenu",(t=>t.preventDefault())),this.options=l(l({},fA),t),this.screenWidth=this.options.screenWidth,this.screenHeight=this.options.screenHeight,this._worldWidth=this.options.worldWidth,this._worldHeight=this.options.worldHeight,this.forceHitArea=this.options.forceHitArea,this.threshold=this.options.threshold,this.options.disableOnContextMenu&&this.options.events.domElement.addEventListener("contextmenu",this._disableOnContextMenu),this.options.noTicker||(this.tickerFunction=()=>this.update(this.options.ticker.elapsedMS),this.options.ticker.add(this.tickerFunction)),this.input=new uA(this),this.plugins=new pA(this)}destroy(t){!this.options.noTicker&&this.tickerFunction&&this.options.ticker.remove(this.tickerFunction),this.options.disableOnContextMenu&&this.options.events.domElement.removeEventListener("contextmenu",this._disableOnContextMenu),this.input.destroy(),super.destroy(t)}update(t){this.pause||(this.plugins.update(t),this.lastViewport&&(this.lastViewport.x!==this.x||this.lastViewport.y!==this.y?this.moving=!0:this.moving&&(this.emit("moved-end",this),this.moving=!1),this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y?this.zooming=!0:this.zooming&&(this.emit("zoomed-end",this),this.zooming=!1)),this.forceHitArea||(this._hitAreaDefault=new Mh(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight),this.hitArea=this._hitAreaDefault),this._dirty=this._dirty||!this.lastViewport||this.lastViewport.x!==this.x||this.lastViewport.y!==this.y||this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y,this.lastViewport={x:this.x,y:this.y,scaleX:this.scale.x,scaleY:this.scale.y},this.emit("frame-end",this))}resize(t=window.innerWidth,e=window.innerHeight,s,i){this.screenWidth=t,this.screenHeight=e,typeof s<"u"&&(this._worldWidth=s),typeof i<"u"&&(this._worldHeight=i),this.plugins.resize(),this.dirty=!0}get worldWidth(){return this._worldWidth?this._worldWidth:this.width/this.scale.x}set worldWidth(t){this._worldWidth=t,this.plugins.resize()}get worldHeight(){return this._worldHeight?this._worldHeight:this.height/this.scale.y}set worldHeight(t){this._worldHeight=t,this.plugins.resize()}getVisibleBounds(){return new Mh(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight)}toWorld(t,e){return 2===arguments.length?this.toLocal(new Ah(t,e)):this.toLocal(t)}toScreen(t,e){return 2===arguments.length?this.toGlobal(new Ah(t,e)):this.toGlobal(t)}get worldScreenWidth(){return this.screenWidth/this.scale.x}get worldScreenHeight(){return this.screenHeight/this.scale.y}get screenWorldWidth(){return this.worldWidth*this.scale.x}get screenWorldHeight(){return this.worldHeight*this.scale.y}get center(){return new Ah(this.worldScreenWidth/2-this.x/this.scale.x,this.worldScreenHeight/2-this.y/this.scale.y)}set center(t){this.moveCenter(t)}moveCenter(...t){let e,s;"number"==typeof t[0]?(e=t[0],s=t[1]):(e=t[0].x,s=t[0].y);const i=(this.worldScreenWidth/2-e)*this.scale.x,n=(this.worldScreenHeight/2-s)*this.scale.y;return(this.x!==i||this.y!==n)&&(this.position.set(i,n),this.plugins.reset(),this.dirty=!0),this}get corner(){return new Ah(-this.x/this.scale.x,-this.y/this.scale.y)}set corner(t){this.moveCorner(t)}moveCorner(...t){let e,s;return 1===t.length?(e=-t[0].x*this.scale.x,s=-t[0].y*this.scale.y):(e=-t[0]*this.scale.x,s=-t[1]*this.scale.y),(e!==this.x||s!==this.y)&&(this.position.set(e,s),this.plugins.reset(),this.dirty=!0),this}get screenWidthInWorldPixels(){return this.screenWidth/this.scale.x}get screenHeightInWorldPixels(){return this.screenHeight/this.scale.y}findFitWidth(t){return this.screenWidth/t}findFitHeight(t){return this.screenHeight/t}findFit(t,e){const s=this.screenWidth/t,i=this.screenHeight/e;return Math.min(s,i)}findCover(t,e){const s=this.screenWidth/t,i=this.screenHeight/e;return Math.max(s,i)}fitWidth(t=this.worldWidth,e,s=!0,i){let n;e&&(n=this.center),this.scale.x=this.screenWidth/t,s&&(this.scale.y=this.scale.x);const r=this.plugins.get("clamp-zoom",!0);return!i&&r&&r.clamp(),e&&n&&this.moveCenter(n),this}fitHeight(t=this.worldHeight,e,s=!0,i){let n;e&&(n=this.center),this.scale.y=this.screenHeight/t,s&&(this.scale.x=this.scale.y);const r=this.plugins.get("clamp-zoom",!0);return!i&&r&&r.clamp(),e&&n&&this.moveCenter(n),this}fitWorld(t){let e;t&&(e=this.center),this.scale.x=this.screenWidth/this.worldWidth,this.scale.y=this.screenHeight/this.worldHeight,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const s=this.plugins.get("clamp-zoom",!0);return s&&s.clamp(),t&&e&&this.moveCenter(e),this}fit(t,e=this.worldWidth,s=this.worldHeight){let i;t&&(i=this.center),this.scale.x=this.screenWidth/e,this.scale.y=this.screenHeight/s,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const n=this.plugins.get("clamp-zoom",!0);return n&&n.clamp(),t&&i&&this.moveCenter(i),this}setZoom(t,e){let s;e&&(s=this.center),this.scale.set(t);const i=this.plugins.get("clamp-zoom",!0);return i&&i.clamp(),e&&s&&this.moveCenter(s),this}zoomPercent(t,e){return this.setZoom(this.scale.x+this.scale.x*t,e)}zoom(t,e){return this.fitWidth(t+this.worldScreenWidth,e),this}get scaled(){return this.scale.x}set scaled(t){this.setZoom(t,!0)}snapZoom(t){return this.plugins.add("snap-zoom",new hA(this,t)),this}OOB(){return{left:this.left<0,right:this.right>this.worldWidth,top:this.top<0,bottom:this.bottom>this.worldHeight,cornerPoint:new Ah(this.worldWidth*this.scale.x-this.screenWidth,this.worldHeight*this.scale.y-this.screenHeight)}}get right(){return-this.x/this.scale.x+this.worldScreenWidth}set right(t){this.x=-t*this.scale.x+this.screenWidth,this.plugins.reset()}get left(){return-this.x/this.scale.x}set left(t){this.x=-t*this.scale.x,this.plugins.reset()}get top(){return-this.y/this.scale.y}set top(t){this.y=-t*this.scale.y,this.plugins.reset()}get bottom(){return-this.y/this.scale.y+this.worldScreenHeight}set bottom(t){this.y=-t*this.scale.y+this.screenHeight,this.plugins.reset()}get dirty(){return!!this._dirty}set dirty(t){this._dirty=t}get forceHitArea(){return this._forceHitArea}set forceHitArea(t){t?(this._forceHitArea=t,this.hitArea=t):(this._forceHitArea=null,this.hitArea=new Mh(0,0,this.worldWidth,this.worldHeight))}drag(t){return this.plugins.add("drag",new QT(this,t)),this}clamp(t){return this.plugins.add("clamp",new jT(this,t)),this}decelerate(t){return this.plugins.add("decelerate",new KT(this,t)),this}bounce(t){return this.plugins.add("bounce",new YT(this,t)),this}pinch(t){return this.plugins.add("pinch",new nA(this,t)),this}snap(t,e,s){return this.plugins.add("snap",new aA(this,t,e,s)),this}follow(t,e){return this.plugins.add("follow",new tA(this,t,e)),this}wheel(t){return this.plugins.add("wheel",new cA(this,t)),this}animate(t){return this.plugins.add("animate",new UT(this,t)),this}clampZoom(t){return this.plugins.add("clamp-zoom",new zT(this,t)),this}mouseEdges(t){return this.plugins.add("mouse-edges",new sA(this,t)),this}get pause(){return!!this._pause}set pause(t){this._pause=t,this.lastViewport=null,this.moving=!1,this.zooming=!1,t&&this.input.pause()}ensureVisible(t,e,s,i,n){n&&(s>this.worldScreenWidth||i>this.worldScreenHeight)&&(this.fit(!0,s,i),this.emit("zoomed",{viewport:this,type:"ensureVisible"}));let r=!1;t<this.left?(this.left=t,r=!0):t+s>this.right&&(this.right=t+s,r=!0),e<this.top?(this.top=e,r=!0):e+i>this.bottom&&(this.bottom=e+i,r=!0),r&&this.emit("moved",{viewport:this,type:"ensureVisible"})}}class gA extends(ig(mA)){get parentContainer(){return this.parent}sendObjToBack(t){this.parentContainer.sendObjToBack(t)}bringObjToFront(t){this.parentContainer.bringObjToFront(t)}}function yA(){var t;let e;return null!==API.params.get("cheatRND")?e=pgame.interact.isKeyDown("p")||pgame.interact.isKeyDown("P")?API.params.get("cheatRND"):void 0:null!==API.params.get("cheat")&&(e=null==(t=pgame.data.cheatRND)?void 0:t.toString()),{state:void 0!==e?"cheatbet":"bet",bet:pgame.data.totalBet,debug:null!=e?e:"",pick:pgame.data.betColor,dice:[],isBonus:!1,bonusDice:255}}function xA(t,e){API.toggleCanvas.value?(pgame.front.popMsg.setText(e),pgame.front.popMsg.pop(t,500).start(!0)):API.showErrorMessage(e)}function vA(t,e,...s){API.toggleCanvas.value?(0==s.length?pgame.front.popMsg.txtKey(e):pgame.front.popMsg.txtKeyFormat(e,...s),pgame.front.popMsg.pop(t,500).start(!0)):0==s.length?API.showErrorMessage(ux.getByKey(e)):API.showErrorMessage(ux.getByKeyFormat(e,...s))}function _A(t){t.onSend=t=>{t.setInterval((()=>{vA(2e3,"waitResponse")}),4e3),t.setTimeout((()=>{t.setInterval((()=>{vA(2e3,"requestTimeout")}),4e3)}))},t.onRecvAny=t=>{t.clearTimeout(),t.clearInterval(),API.toggleCanvas.value||API.showErrorMessage(null)},t.onRecvInvalid=(t,e)=>{let s=`${t.name} Request received an invalid object`;console.error(s),console.log(e),API.showErrorMessage(f.global.t("message.recInvalidObj"))}}const bA={StartGame:{S:{type:"object",properties:{action:{type:"string",enum:["start"]},sessionId:{type:"string"},sessionToken:{type:"string"}},required:["action","sessionId","sessionToken"]},R:{type:"object",properties:{credits:{type:"number"},code:{type:"string",enum:["OK"]},gameData:(wA=rr).StartGame.R,config:{type:"object",properties:{bet:{anyOf:[{type:"object",properties:{type:{type:"string",enum:["list"]},list:{type:"array",items:{type:"number"}},default:{type:"number"}},required:["type","list"]},{type:"object",properties:{type:{type:"string",enum:["step"]},min:{type:"number"},max:{type:"number"},step:{type:"number"},default:{type:"number"}},required:["type","min","max","step"]}]}},required:["bet"]}},required:["credits","code","config"]}},Bet:{S:{type:"object",properties:{action:{type:"string",enum:["bet"]},sessionId:{type:"string"},sessionToken:{type:"string"},gameData:wA.Bet.S,bet:{type:"number"},type:{type:"string"}},required:["action","sessionId","sessionToken","gameData","bet"]},R:{type:"object",properties:{credits:{type:"number"},code:{type:"string",enum:["OK"]},gameData:wA.Bet.R,win:{type:"number"},casinoMessage:{type:"object",properties:{title:{type:"string"},body:{type:"string"}},required:["title","body"]}},required:["credits","code","gameData","win"]}},Step:{S:{type:"object",properties:{action:{type:"string",enum:["step"]},sessionId:{type:"string"},sessionToken:{type:"string"},gameData:wA.Step.S},required:["action","sessionId","sessionToken","gameData"]},R:{type:"object",properties:{credits:{type:"number"},code:{type:"string",enum:["OK"]},gameData:wA.Step.R,win:{type:"number"}},required:["credits","code","gameData","win"]}},UpdateBalance:{S:{type:"object",properties:{action:{type:"string",enum:["update"]},sessionId:{type:"string"},sessionToken:{type:"string"}},required:["action","sessionId","sessionToken"]},R:{type:"object",properties:{credits:{type:"number"},code:{type:"string",enum:["OK"]}},required:["credits","code"]}},Error:{type:"object",properties:{code:{type:"string"},message:{type:"string"},timestamp:{type:"string"}},required:["code"]}};var wA;class EA extends er{constructor(t){super("StartGame",bA.StartGame,bA.Error,t),d(this,"onRecvSuccess",((t,e)=>{const s=pgame.state("Loading");if(!s.isStartRequestReceived)return s.isStartRequestReceived=!0,void function(){const t=pgame.data;t.realCredits=3e5,t.setBetList(100,0,1e4),t.defaultBet=100}()})),this.onRecvError=CA,_A(this)}prepareSendData(){let t=globalThis.conn;this._data={action:"start",sessionId:t.sessionId,sessionToken:t.sessionToken}}}class SA extends er{constructor(t){super("Bet",bA.Bet,bA.Error,t),d(this,"onRecvSuccess",((t,e)=>{const s=pgame.data;pgame.ce.getDemoExtraction(s.totalBet),s.realCredits+=pgame.ce.totalwin})),this.onRecvError=CA,_A(this)}prepareSendData(){let t=globalThis.conn;this._data={action:"bet",sessionId:t.sessionId,sessionToken:t.sessionToken,bet:pgame.data.totalBet,gameData:yA()}}}class TA extends er{constructor(t){super("Step",bA.Step,bA.Error,t),d(this,"onRecvSuccess",((t,e)=>{})),this.onRecvError=CA,_A(this)}prepareSendData(){let t=globalThis.conn;this._data={action:"step",sessionId:t.sessionId,sessionToken:t.sessionToken,gameData:{}}}}class AA extends er{constructor(t){super("UpdateBalance",bA.UpdateBalance,bA.Error,t),d(this,"onRecvSuccess",((t,e)=>{})),this.onRecvError=CA,_A(this)}prepareSendData(){let t=globalThis.conn;this._data={action:"update",sessionId:t.sessionId,sessionToken:t.sessionToken}}}function CA(t,e){switch(e.code){case"StartException":if(t.nTried<=1)return t.nTotalTry=t===conn.handlers.startGame?4:3,void conn.request("startGame");if(t.nTried<t.nTotalTry)return t.state="REQUESTED",void xA(2e3,`Retrying ${t.name} request... (${t.nTried+1}/${t.nTotalTry})`);if(pgame.state("Loading").isStartRequestReceived)break;return void API.showErrorMessage(`${e.code}: ${e.message}`);case"StepException":break;case"BetException":pgame.data.restore();break;case"RoundError":return void conn.request("startGame")}xA(6e3,`${e.code}: ${e.message}`),t.state="SUCCESS","PlayRun"==pgame.currState.name&&pgame.state("PlayRun").setNext("Start")}const MA={createConnector:function(){const t=new Jn,e={startGame:new EA(t),bet:new SA(t),step:new TA(t),updateBalance:new AA(t)};return new sr(t,e)}};function IA(){let t;return t=MA.createConnector(),function(t){t.onRetry=t=>{API.showErrorMessage(f.global.t("message.websocketCannotRetry")+t)},t.onFailed=()=>{API.showErrorMessage(f.global.t("message.wesocketFail"))},t.onSendFailed=(t,e)=>{let s="onSendFailed";if("retry-limit"==e)s="cannotRetry";else if("idle"==e)return s="expireSession",vA(2e3,s),void window.setInterval((()=>vA(2e3,s)),4e3);vA(4e3,s)},t.onRecvException=(t,e)=>{let s=e;API.showErrorMessage(s.message,s.stack)}}(t),t}class PA extends FS{constructor(){globalThis.conn=IA(),super("Loading"),d(this,"isGameInitialized",!1),d(this,"isStartRequestReceived",!1)}enter(){conn.onOpen=()=>{conn.request("startGame")},conn.connect(2e4,3)}update(){this.isGameInitialized&&this.isStartRequestReceived&&this.setNext("Start")}exit(){"Start"==this._nextState&&(pgame.data.setDefaultBet(),pgame.data.syncCredits(),pgame.onGameReady(),pgame.music.Bg.play()),null!==API.params.get("cheat")&&null===API.params.get("cheatRND")&&(pgame.interact.on("down-p",(()=>API.showCheatPanel(!0))),pgame.interact.on("down-P",(()=>API.showCheatPanel(!0))))}}class RA extends FS{constructor(){super("PlayRun")}enter(){}update(){}exit(){}}class kA extends FS{constructor(){super("Showin"),d(this,"gui",pgame.gui)}enter(){}exit(){}update(){}}class DA extends FS{constructor(){super("Start"),d(this,"gui",pgame.gui)}enter(){}update(t){}exit(){this.gui.disableBetButtons(),conn.request("bet")}}class FA extends dg{constructor(){super(),d(this,"_win",0),d(this,"isFirstStart",!0),this.name="GUI",this._setBtnCallBack(),this._setBtnEffect()}get winMeter(){return this._win}set winMeter(t){this._win=Math.round(t)}creditAnim(t,e=500){return this.tweens.create("credit",pgame.data,{credits:t},e).on("start",(()=>{pgame.sound.CoinIncrement.play()})).on("end",(()=>{pgame.sound.CoinIncrement.stop()}))}winMeterAnim(t,e=500){return this.tweens.create("win",this,{winMeter:t},e).on("start",(()=>{pgame.sound.CoinIncrement.play()})).on("end",(()=>{pgame.sound.CoinIncrement.stop()}))}startClearWinAnim(t=500,e=0){const s=this.tweens.create("clear-win",this,{winMeter:0},t).delay(e),i=this.tweens.getByName("win");return void 0!==i?i.chain(s):s.start(),s}disableBetButtons(){}enableBetButtons(){}_setBtnCallBack(){}_setBtnEffect(){}useViewStyle(t){}}class OA extends dg{constructor(){super(),d(this,"popMsg"),d(this,"mysteryWinCredit",0),d(this,"shootingWild",[]),d(this,"GSMysteryWin",0),this.name="FRONT-LAYER";const t=new fx(500,200,20).fill(tg.Black,.8);this.popMsg=new CS(t,{size:32,weight:"700",width:400,align:"center"},this.tweens),this.popMsg.pivotRule=Zm.Center,this.popMsg.sound="hint",this.addObj(this.popMsg,2,"pop-up-hint")}}class NA extends FS{constructor(){super("Bonus")}}class BA extends DS{constructor(t){super({view:t,autoStart:!0,sharedTicker:!0,autoDensity:!0,antialias:!0,backgroundAlpha:0,backgroundRect:!0}),d(this,"interact",new Ng),d(this,"data"),d(this,"ce",ar),d(this,"title"),d(this,"gui"),d(this,"front"),d(this,"music"),d(this,"sound"),d(this,"vueLeftHandedMode",!1),d(this,"balanceDecreases"),d(this,"nonWinning"),d(this,"countNonWinning"),d(this,"controlCaseGS",!1),d(this,"controlCaseWild",!1),globalThis.pgame=this,this.ticker.minFPS=30,this.assets.prepareLoading(),this.assets.onPreprocessAssetList=t=>{},this.assets.addCSSFont("Mulish",void 0,"abc"),this.assets.addCSSFont("Aachen Bold",void 0,"abc"),this.data=new v,this.addState(new PA),this.setState("Loading"),this.startLoop(),this.loadAssets().then((()=>(this.initSounds(),this.interact.listenKeyboard(document),this.setLocale(API.locale.value),this.addScenes(...function(){const t=new FA;pgame.gui=t;const e=new OA;return pgame.front=e,pgame.stage.addObj(t).addObj(e),[]}()),this.addState(new DA),this.addState(new RA),this.addState(new NA),this.addState(new kA),this.setGameAPI(),window.addEventListener("message",this.updateBalanceListener.bind(this)),this.state("Loading").isGameInitialized=!0,this)))}mainLoop(t){let e=this.currState.runFSM(t);""!=e&&this.setState(e),this.stage.update(t)}detectStyleAndResize(t,e){t>=e?"landscape"!=this.currStyle.name&&this.applyLandscape():"portrait"!=this.currStyle.name&&this.applyPortrait(),this.resizeAppView(t,e)}resizeAppView(t,e){let s=t,i=e;t*this.desiredRatio<=e?i=s*this.desiredRatio:s=i/this.desiredRatio,this.renderer.resize(s,i),this.stage.scale.set(s/this.desiredWidth,i/this.desiredHeight)}prepareStyle(){this.stage.tweens.endAll();const t=this.currStyle.Resolution;this.setResolution(t[0],t[1])}applyLandscape(){this.setViewStyle("landscape"),this.prepareStyle(),this.useCurrentViewStlye(),API.isLandscape.value=!0}applyPortrait(){this.setViewStyle("portrait"),this.prepareStyle(),this.useCurrentViewStlye(),API.isLandscape.value=!1}initSounds(){var t,e;this.music=this.soundManager.setGroup("music",_),this.sound=this.soundManager.setGroup("sound",b),this.soundManager.setMutexGroup("bg",Object.values(this.music)),t=this.music,e=this.sound,t.Bg.volume=.3,t.Bg.loop=!0,t.Bg.fadeIn=t.Bg.fadeOut=1e3,t.Bg.mutexPause=!0,e.Click.volume=3.3,e.CoinIncrement.fadeOut=500,e.Hint.volume=2}setGameAPI(){m(API.locale,(t=>{this.setLocale(t),this.useCurrentLocale()})),m(API.volume,(t=>{this.soundManager.volumeAll=t}),{immediate:!0}),m([API.musicMuted,API.soundMuted],(([t,e])=>{const s=this.soundManager.groups.music,i=this.soundManager.groups.sound;s.muted=t,i.muted=e}),{immediate:!0})}updateBalanceListener(t){if(null!=t.data&&"EVO:REFRESH_BALANCE"==t.data.command&&null!=t.data.expectedBalance&&!isNaN(t.data.expectedBalance)){const e=this.gui.tweens.getByName("win");e&&e.stop(),this.data.realCredits=t.data.expectedBalance,this.data.syncCredits()}}}export{BA as MainGame,ix as vb};
