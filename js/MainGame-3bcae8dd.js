var t,e=Object.defineProperty,s=Object.defineProperties,n=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=Math.pow,h=(t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,l=(t,e)=>{for(var s in e||(e={}))r.call(e,s)&&h(t,s,e[s]);if(i)for(var s of i(e))a.call(e,s)&&h(t,s,e[s]);return t},c=(t,e)=>s(t,n(e)),u=(t,e)=>{var s={};for(var n in t)r.call(t,n)&&e.indexOf(n)<0&&(s[n]=t[n]);if(null!=t&&i)for(var n of i(t))e.indexOf(n)<0&&a.call(t,n)&&(s[n]=t[n]);return s},d=(t,e,s)=>(h(t,"symbol"!=typeof e?e+"":e,s),s),f=(t,e,s)=>new Promise(((n,i)=>{var r=t=>{try{o(s.next(t))}catch(jp){i(jp)}},a=t=>{try{o(s.throw(t))}catch(jp){i(jp)}},o=t=>t.done?n(t.value):Promise.resolve(t.value).then(r,a);o((s=s.apply(t,e)).next())}));import{w as p}from"./index-b29b6f6a.js";var m="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},g={};!function(t){var e=Object.prototype.hasOwnProperty,s="~";function n(){}function i(t,e,s){this.fn=t,this.context=e,this.once=s||!1}function r(t,e,n,r,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new i(n,r||t,a),h=s?s+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],o]:t._events[h].push(o):(t._events[h]=o,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function o(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(s=!1)),o.prototype.eventNames=function(){var t,n,i=[];if(0===this._eventsCount)return i;for(n in t=this._events)e.call(t,n)&&i.push(s?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},o.prototype.listeners=function(t){var e=s?s+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,r=n.length,a=new Array(r);i<r;i++)a[i]=n[i].fn;return a},o.prototype.listenerCount=function(t){var e=s?s+t:t,n=this._events[e];return n?n.fn?1:n.length:0},o.prototype.emit=function(t,e,n,i,r,a){var o=s?s+t:t;if(!this._events[o])return!1;var h,l,c=this._events[o],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,n),!0;case 4:return c.fn.call(c.context,e,n,i),!0;case 5:return c.fn.call(c.context,e,n,i,r),!0;case 6:return c.fn.call(c.context,e,n,i,r,a),!0}for(l=1,h=new Array(u-1);l<u;l++)h[l-1]=arguments[l];c.fn.apply(c.context,h)}else{var d,f=c.length;for(l=0;l<f;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),u){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,n);break;case 4:c[l].fn.call(c[l].context,e,n,i);break;default:if(!h)for(d=1,h=new Array(u-1);d<u;d++)h[d-1]=arguments[d];c[l].fn.apply(c[l].context,h)}}return!0},o.prototype.on=function(t,e,s){return r(this,t,e,s,!1)},o.prototype.once=function(t,e,s){return r(this,t,e,s,!0)},o.prototype.removeListener=function(t,e,n,i){var r=s?s+t:t;if(!this._events[r])return this;if(!e)return a(this,r),this;var o=this._events[r];if(o.fn)o.fn!==e||i&&!o.once||n&&o.context!==n||a(this,r);else{for(var h=0,l=[],c=o.length;h<c;h++)(o[h].fn!==e||i&&!o[h].once||n&&o[h].context!==n)&&l.push(o[h]);l.length?this._events[r]=1===l.length?l[0]:l:a(this,r)}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=s?s+t:t,this._events[e]&&a(this,e)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=s,o.EventEmitter=o,t.exports=o}({get exports(){return g},set exports(t){g=t}});class y extends g{constructor(){super(...arguments),d(this,"_realCredits",0),d(this,"_credits",0),d(this,"_backupCredits",0),d(this,"_betList",[]),d(this,"_betIndex",0),d(this,"_lastBetIndex",0),d(this,"_betColor",0),d(this,"defaultBet",0),d(this,"cheatRND"),d(this,"_nAutoplays",0),d(this,"testAutoplay")}get realCredits(){return this._realCredits}set realCredits(t){this._backupCredits=this._realCredits,this._realCredits=t}get credits(){return this._credits}set credits(t){t=Math.round(t),this._credits=t,this.emit("credit",t)}syncCredits(){this.credits=this.realCredits}restore(){this._realCredits=this._backupCredits}get totalBet(){return this._betList[this._betIndex]}get betListNum(){return this._betList.length}get betIndex(){return this._betIndex}get maxIndex(){return this._betList.length-1}get lastBetIndex(){return this._lastBetIndex}get betColor(){return this._betColor}isMinBet(){return 0==this._betIndex}isMaxBet(){return this._betIndex==this._betList.length-1}getBetAtId(t){if(t<0||t>=this.betListNum)throw new Error("Bet Index out of range!");return this._betList[t]}setBetAtId(t){this._lastBetIndex=this._betIndex,this._betIndex=t,this.emit("bet",t,this._betList[t])}setBetAtValue(t){if(!this._betList.includes(t))return void console.log("Invalid Bet Value");const e=this._betList.indexOf(t);this.setBetAtId(e)}addBetByValue(t){if(!this._betList.includes(t))return void console.log("Invalid Bet Value");const e=this._betList.indexOf(t)+this._betIndex;e>this.maxIndex?this.setBetAtId(this.maxIndex):this.setBetAtId(e)}setBetColor(t){if(t<=0||t>6)throw new Error("Bet Color Value out of range!");this._betColor=t}setBetList(t,e,s){if(Array.isArray(t))this._betList=t;else{this._betList.clear();for(let n=e;n<=s;n+=t)this._betList.push(n)}}setDefaultBet(){let t=this._betList.indexOf(this.defaultBet);t=Math.max(0,t),this.setBetAtId(t),this._lastBetIndex=t}get nAutoPlays(){return this._nAutoplays}set nAutoPlays(t){t<0&&(t=0);let e=this._nAutoplays;void 0===this.testAutoplay||this.testAutoplay(t,e)||(t=0),t!=e&&(this._nAutoplays=t,this.emit("autoplay",t,e))}}const v={Bg:"background"},x={Click:"buttonclick",CoinIncrement:"coinincrement",Hint:"hint"};var _={},b={get exports(){return _},set exports(t){_=t}},w={},E={},S={},T={},A={},C={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.regexpCode=t.getEsmExportName=t.getProperty=t.safeStringify=t.stringify=t.strConcat=t.addCodeArg=t.str=t._=t.nil=t._Code=t.Name=t.IDENTIFIER=t._CodeOrName=void 0;class e{}t._CodeOrName=e,t.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class s extends e{constructor(e){if(super(),!t.IDENTIFIER.test(e))throw new Error("CodeGen: name must be a valid identifier");this.str=e}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}t.Name=s;class n extends e{constructor(t){super(),this._items="string"==typeof t?[t]:t}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const t=this._items[0];return""===t||'""'===t}get str(){var t;return null!==(t=this._str)&&void 0!==t?t:this._str=this._items.reduce(((t,e)=>`${t}${e}`),"")}get names(){var t;return null!==(t=this._names)&&void 0!==t?t:this._names=this._items.reduce(((t,e)=>(e instanceof s&&(t[e.str]=(t[e.str]||0)+1),t)),{})}}function i(t,...e){const s=[t[0]];let i=0;for(;i<e.length;)o(s,e[i]),s.push(t[++i]);return new n(s)}t._Code=n,t.nil=new n(""),t._=i;const r=new n("+");function a(t,...e){const s=[l(t[0])];let i=0;for(;i<e.length;)s.push(r),o(s,e[i]),s.push(r,l(t[++i]));return function(t){let e=1;for(;e<t.length-1;){if(t[e]===r){const s=h(t[e-1],t[e+1]);if(void 0!==s){t.splice(e-1,3,s);continue}t[e++]="+"}e++}}(s),new n(s)}function o(t,e){var i;e instanceof n?t.push(...e._items):e instanceof s?t.push(e):t.push("number"==typeof(i=e)||"boolean"==typeof i||null===i?i:l(Array.isArray(i)?i.join(","):i))}function h(t,e){if('""'===e)return t;if('""'===t)return e;if("string"==typeof t){if(e instanceof s||'"'!==t[t.length-1])return;return"string"!=typeof e?`${t.slice(0,-1)}${e}"`:'"'===e[0]?t.slice(0,-1)+e.slice(1):void 0}return"string"!=typeof e||'"'!==e[0]||t instanceof s?void 0:`"${t}${e.slice(1)}`}function l(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}t.str=a,t.addCodeArg=o,t.strConcat=function(t,e){return e.emptyStr()?t:t.emptyStr()?e:a`${t}${e}`},t.stringify=function(t){return new n(l(t))},t.safeStringify=l,t.getProperty=function(e){return"string"==typeof e&&t.IDENTIFIER.test(e)?new n(`.${e}`):i`[${e}]`},t.getEsmExportName=function(e){if("string"==typeof e&&t.IDENTIFIER.test(e))return new n(`${e}`);throw new Error(`CodeGen: invalid export name: ${e}, use explicit $id name mapping`)},t.regexpCode=function(t){return new n(t.toString())}}(C);var M={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ValueScope=t.ValueScopeName=t.Scope=t.varKinds=t.UsedValueState=void 0;const e=C;class s extends Error{constructor(t){super(`CodeGen: "code" for ${t} not defined`),this.value=t.value}}var n,i;(i=n=t.UsedValueState||(t.UsedValueState={}))[i.Started=0]="Started",i[i.Completed=1]="Completed",t.varKinds={const:new e.Name("const"),let:new e.Name("let"),var:new e.Name("var")};class r{constructor({prefixes:t,parent:e}={}){this._names={},this._prefixes=t,this._parent=e}toName(t){return t instanceof e.Name?t:this.name(t)}name(t){return new e.Name(this._newName(t))}_newName(t){return`${t}${(this._names[t]||this._nameGroup(t)).index++}`}_nameGroup(t){var e,s;if((null===(s=null===(e=this._parent)||void 0===e?void 0:e._prefixes)||void 0===s?void 0:s.has(t))||this._prefixes&&!this._prefixes.has(t))throw new Error(`CodeGen: prefix "${t}" is not allowed in this scope`);return this._names[t]={prefix:t,index:0}}}t.Scope=r;class a extends e.Name{constructor(t,e){super(e),this.prefix=t}setValue(t,{property:s,itemIndex:n}){this.value=t,this.scopePath=e._`.${new e.Name(s)}[${n}]`}}t.ValueScopeName=a;const o=e._`\n`;t.ValueScope=class extends r{constructor(t){super(t),this._values={},this._scope=t.scope,this.opts=c(l({},t),{_n:t.lines?o:e.nil})}get(){return this._scope}name(t){return new a(t,this._newName(t))}value(t,e){var s;if(void 0===e.ref)throw new Error("CodeGen: ref must be passed in value");const n=this.toName(t),{prefix:i}=n,r=null!==(s=e.key)&&void 0!==s?s:e.ref;let a=this._values[i];if(a){const t=a.get(r);if(t)return t}else a=this._values[i]=new Map;a.set(r,n);const o=this._scope[i]||(this._scope[i]=[]),h=o.length;return o[h]=e.ref,n.setValue(e,{property:i,itemIndex:h}),n}getValue(t,e){const s=this._values[t];if(s)return s.get(e)}scopeRefs(t,s=this._values){return this._reduceValues(s,(s=>{if(void 0===s.scopePath)throw new Error(`CodeGen: name "${s}" has no value`);return e._`${t}${s.scopePath}`}))}scopeCode(t=this._values,e,s){return this._reduceValues(t,(t=>{if(void 0===t.value)throw new Error(`CodeGen: name "${t}" has no value`);return t.value.code}),e,s)}_reduceValues(i,r,a={},o){let h=e.nil;for(const l in i){const c=i[l];if(!c)continue;const u=a[l]=a[l]||new Map;c.forEach((i=>{if(u.has(i))return;u.set(i,n.Started);let a=r(i);if(a){const s=this.opts.es5?t.varKinds.var:t.varKinds.const;h=e._`${h}${s} ${i} = ${a};${this.opts._n}`}else{if(!(a=null==o?void 0:o(i)))throw new s(i);h=e._`${h}${a}${this.opts._n}`}u.set(i,n.Completed)}))}return h}}}(M),function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.or=t.and=t.not=t.CodeGen=t.operators=t.varKinds=t.ValueScopeName=t.ValueScope=t.Scope=t.Name=t.regexpCode=t.stringify=t.getProperty=t.nil=t.strConcat=t.str=t._=void 0;const e=C,s=M;var n=C;Object.defineProperty(t,"_",{enumerable:!0,get:function(){return n._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return n.str}}),Object.defineProperty(t,"strConcat",{enumerable:!0,get:function(){return n.strConcat}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return n.nil}}),Object.defineProperty(t,"getProperty",{enumerable:!0,get:function(){return n.getProperty}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return n.stringify}}),Object.defineProperty(t,"regexpCode",{enumerable:!0,get:function(){return n.regexpCode}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return n.Name}});var i=M;Object.defineProperty(t,"Scope",{enumerable:!0,get:function(){return i.Scope}}),Object.defineProperty(t,"ValueScope",{enumerable:!0,get:function(){return i.ValueScope}}),Object.defineProperty(t,"ValueScopeName",{enumerable:!0,get:function(){return i.ValueScopeName}}),Object.defineProperty(t,"varKinds",{enumerable:!0,get:function(){return i.varKinds}}),t.operators={GT:new e._Code(">"),GTE:new e._Code(">="),LT:new e._Code("<"),LTE:new e._Code("<="),EQ:new e._Code("==="),NEQ:new e._Code("!=="),NOT:new e._Code("!"),OR:new e._Code("||"),AND:new e._Code("&&"),ADD:new e._Code("+")};class r{optimizeNodes(){return this}optimizeNames(t,e){return this}}class a extends r{constructor(t,e,s){super(),this.varKind=t,this.name=e,this.rhs=s}render({es5:t,_n:e}){const n=t?s.varKinds.var:this.varKind,i=void 0===this.rhs?"":` = ${this.rhs}`;return`${n} ${this.name}${i};`+e}optimizeNames(t,e){if(t[this.name.str])return this.rhs&&(this.rhs=D(this.rhs,t,e)),this}get names(){return this.rhs instanceof e._CodeOrName?this.rhs.names:{}}}class o extends r{constructor(t,e,s){super(),this.lhs=t,this.rhs=e,this.sideEffects=s}render({_n:t}){return`${this.lhs} = ${this.rhs};`+t}optimizeNames(t,s){if(!(this.lhs instanceof e.Name)||t[this.lhs.str]||this.sideEffects)return this.rhs=D(this.rhs,t,s),this}get names(){return k(this.lhs instanceof e.Name?{}:l({},this.lhs.names),this.rhs)}}class h extends o{constructor(t,e,s,n){super(t,s,n),this.op=e}render({_n:t}){return`${this.lhs} ${this.op}= ${this.rhs};`+t}}class u extends r{constructor(t){super(),this.label=t,this.names={}}render({_n:t}){return`${this.label}:`+t}}class d extends r{constructor(t){super(),this.label=t,this.names={}}render({_n:t}){return`break${this.label?` ${this.label}`:""};`+t}}class f extends r{constructor(t){super(),this.error=t}render({_n:t}){return`throw ${this.error};`+t}get names(){return this.error.names}}class p extends r{constructor(t){super(),this.code=t}render({_n:t}){return`${this.code};`+t}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(t,e){return this.code=D(this.code,t,e),this}get names(){return this.code instanceof e._CodeOrName?this.code.names:{}}}class m extends r{constructor(t=[]){super(),this.nodes=t}render(t){return this.nodes.reduce(((e,s)=>e+s.render(t)),"")}optimizeNodes(){const{nodes:t}=this;let e=t.length;for(;e--;){const s=t[e].optimizeNodes();Array.isArray(s)?t.splice(e,1,...s):s?t[e]=s:t.splice(e,1)}return t.length>0?this:void 0}optimizeNames(t,e){const{nodes:s}=this;let n=s.length;for(;n--;){const i=s[n];i.optimizeNames(t,e)||(F(t,i.names),s.splice(n,1))}return s.length>0?this:void 0}get names(){return this.nodes.reduce(((t,e)=>R(t,e.names)),{})}}class g extends m{render(t){return"{"+t._n+super.render(t)+"}"+t._n}}class y extends m{}class v extends g{}v.kind="else";class x extends g{constructor(t,e){super(e),this.condition=t}render(t){let e=`if(${this.condition})`+super.render(t);return this.else&&(e+="else "+this.else.render(t)),e}optimizeNodes(){super.optimizeNodes();const t=this.condition;if(!0===t)return this.nodes;let e=this.else;if(e){const t=e.optimizeNodes();e=this.else=Array.isArray(t)?new v(t):t}return e?!1===t?e instanceof x?e:e.nodes:this.nodes.length?this:new x(O(t),e instanceof x?[e]:e.nodes):!1!==t&&this.nodes.length?this:void 0}optimizeNames(t,e){var s;if(this.else=null===(s=this.else)||void 0===s?void 0:s.optimizeNames(t,e),super.optimizeNames(t,e)||this.else)return this.condition=D(this.condition,t,e),this}get names(){const t=super.names;return k(t,this.condition),this.else&&R(t,this.else.names),t}}x.kind="if";class _ extends g{}_.kind="for";class b extends _{constructor(t){super(),this.iteration=t}render(t){return`for(${this.iteration})`+super.render(t)}optimizeNames(t,e){if(super.optimizeNames(t,e))return this.iteration=D(this.iteration,t,e),this}get names(){return R(super.names,this.iteration.names)}}class w extends _{constructor(t,e,s,n){super(),this.varKind=t,this.name=e,this.from=s,this.to=n}render(t){const e=t.es5?s.varKinds.var:this.varKind,{name:n,from:i,to:r}=this;return`for(${e} ${n}=${i}; ${n}<${r}; ${n}++)`+super.render(t)}get names(){const t=k(super.names,this.from);return k(t,this.to)}}class E extends _{constructor(t,e,s,n){super(),this.loop=t,this.varKind=e,this.name=s,this.iterable=n}render(t){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(t)}optimizeNames(t,e){if(super.optimizeNames(t,e))return this.iterable=D(this.iterable,t,e),this}get names(){return R(super.names,this.iterable.names)}}class S extends g{constructor(t,e,s){super(),this.name=t,this.args=e,this.async=s}render(t){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(t)}}S.kind="func";class T extends m{render(t){return"return "+super.render(t)}}T.kind="return";class A extends g{render(t){let e="try"+super.render(t);return this.catch&&(e+=this.catch.render(t)),this.finally&&(e+=this.finally.render(t)),e}optimizeNodes(){var t,e;return super.optimizeNodes(),null===(t=this.catch)||void 0===t||t.optimizeNodes(),null===(e=this.finally)||void 0===e||e.optimizeNodes(),this}optimizeNames(t,e){var s,n;return super.optimizeNames(t,e),null===(s=this.catch)||void 0===s||s.optimizeNames(t,e),null===(n=this.finally)||void 0===n||n.optimizeNames(t,e),this}get names(){const t=super.names;return this.catch&&R(t,this.catch.names),this.finally&&R(t,this.finally.names),t}}class I extends g{constructor(t){super(),this.error=t}render(t){return`catch(${this.error})`+super.render(t)}}I.kind="catch";class P extends g{render(t){return"finally"+super.render(t)}}P.kind="finally";function R(t,e){for(const s in e)t[s]=(t[s]||0)+(e[s]||0);return t}function k(t,s){return s instanceof e._CodeOrName?R(t,s.names):t}function D(t,s,n){return t instanceof e.Name?r(t):(i=t)instanceof e._Code&&i._items.some((t=>t instanceof e.Name&&1===s[t.str]&&void 0!==n[t.str]))?new e._Code(t._items.reduce(((t,s)=>(s instanceof e.Name&&(s=r(s)),s instanceof e._Code?t.push(...s._items):t.push(s),t)),[])):t;var i;function r(t){const e=n[t.str];return void 0===e||1!==s[t.str]?t:(delete s[t.str],e)}}function F(t,e){for(const s in e)t[s]=(t[s]||0)-(e[s]||0)}function O(t){return"boolean"==typeof t||"number"==typeof t||null===t?!t:e._`!${V(t)}`}t.CodeGen=class{constructor(t,e={}){this._values={},this._blockStarts=[],this._constants={},this.opts=c(l({},e),{_n:e.lines?"\n":""}),this._extScope=t,this._scope=new s.Scope({parent:t}),this._nodes=[new y]}toString(){return this._root.render(this.opts)}name(t){return this._scope.name(t)}scopeName(t){return this._extScope.name(t)}scopeValue(t,e){const s=this._extScope.value(t,e);return(this._values[s.prefix]||(this._values[s.prefix]=new Set)).add(s),s}getScopeValue(t,e){return this._extScope.getValue(t,e)}scopeRefs(t){return this._extScope.scopeRefs(t,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(t,e,s,n){const i=this._scope.toName(e);return void 0!==s&&n&&(this._constants[i.str]=s),this._leafNode(new a(t,i,s)),i}const(t,e,n){return this._def(s.varKinds.const,t,e,n)}let(t,e,n){return this._def(s.varKinds.let,t,e,n)}var(t,e,n){return this._def(s.varKinds.var,t,e,n)}assign(t,e,s){return this._leafNode(new o(t,e,s))}add(e,s){return this._leafNode(new h(e,t.operators.ADD,s))}code(t){return"function"==typeof t?t():t!==e.nil&&this._leafNode(new p(t)),this}object(...t){const s=["{"];for(const[n,i]of t)s.length>1&&s.push(","),s.push(n),(n!==i||this.opts.es5)&&(s.push(":"),(0,e.addCodeArg)(s,i));return s.push("}"),new e._Code(s)}if(t,e,s){if(this._blockNode(new x(t)),e&&s)this.code(e).else().code(s).endIf();else if(e)this.code(e).endIf();else if(s)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(t){return this._elseNode(new x(t))}else(){return this._elseNode(new v)}endIf(){return this._endBlockNode(x,v)}_for(t,e){return this._blockNode(t),e&&this.code(e).endFor(),this}for(t,e){return this._for(new b(t),e)}forRange(t,e,n,i,r=(this.opts.es5?s.varKinds.var:s.varKinds.let)){const a=this._scope.toName(t);return this._for(new w(r,a,e,n),(()=>i(a)))}forOf(t,n,i,r=s.varKinds.const){const a=this._scope.toName(t);if(this.opts.es5){const t=n instanceof e.Name?n:this.var("_arr",n);return this.forRange("_i",0,e._`${t}.length`,(s=>{this.var(a,e._`${t}[${s}]`),i(a)}))}return this._for(new E("of",r,a,n),(()=>i(a)))}forIn(t,n,i,r=(this.opts.es5?s.varKinds.var:s.varKinds.const)){if(this.opts.ownProperties)return this.forOf(t,e._`Object.keys(${n})`,i);const a=this._scope.toName(t);return this._for(new E("in",r,a,n),(()=>i(a)))}endFor(){return this._endBlockNode(_)}label(t){return this._leafNode(new u(t))}break(t){return this._leafNode(new d(t))}return(t){const e=new T;if(this._blockNode(e),this.code(t),1!==e.nodes.length)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(T)}try(t,e,s){if(!e&&!s)throw new Error('CodeGen: "try" without "catch" and "finally"');const n=new A;if(this._blockNode(n),this.code(t),e){const t=this.name("e");this._currNode=n.catch=new I(t),e(t)}return s&&(this._currNode=n.finally=new P,this.code(s)),this._endBlockNode(I,P)}throw(t){return this._leafNode(new f(t))}block(t,e){return this._blockStarts.push(this._nodes.length),t&&this.code(t).endBlock(e),this}endBlock(t){const e=this._blockStarts.pop();if(void 0===e)throw new Error("CodeGen: not in self-balancing block");const s=this._nodes.length-e;if(s<0||void 0!==t&&s!==t)throw new Error(`CodeGen: wrong number of nodes: ${s} vs ${t} expected`);return this._nodes.length=e,this}func(t,s=e.nil,n,i){return this._blockNode(new S(t,s,n)),i&&this.code(i).endFunc(),this}endFunc(){return this._endBlockNode(S)}optimize(t=1){for(;t-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(t){return this._currNode.nodes.push(t),this}_blockNode(t){this._currNode.nodes.push(t),this._nodes.push(t)}_endBlockNode(t,e){const s=this._currNode;if(s instanceof t||e&&s instanceof e)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${e?`${t.kind}/${e.kind}`:t.kind}"`)}_elseNode(t){const e=this._currNode;if(!(e instanceof x))throw new Error('CodeGen: "else" without "if"');return this._currNode=e.else=t,this}get _root(){return this._nodes[0]}get _currNode(){const t=this._nodes;return t[t.length-1]}set _currNode(t){const e=this._nodes;e[e.length-1]=t}},t.not=O;const N=L(t.operators.AND);t.and=function(...t){return t.reduce(N)};const B=L(t.operators.OR);function L(t){return(s,n)=>s===e.nil?n:n===e.nil?s:e._`${V(s)} ${t} ${V(n)}`}function V(t){return t instanceof e.Name?t:e._`(${t})`}t.or=function(...t){return t.reduce(B)}}(A);var I={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.checkStrictMode=t.getErrorPath=t.Type=t.useFunc=t.setEvaluated=t.evaluatedPropsToName=t.mergeEvaluated=t.eachItem=t.unescapeJsonPointer=t.escapeJsonPointer=t.escapeFragment=t.unescapeFragment=t.schemaRefOrVal=t.schemaHasRulesButRef=t.schemaHasRules=t.checkUnknownRules=t.alwaysValidSchema=t.toHash=void 0;const e=A,s=C;function n(t,e=t.schema){const{opts:s,self:n}=t;if(!s.strictSchema)return;if("boolean"==typeof e)return;const i=n.RULES.keywords;for(const r in e)i[r]||p(t,`unknown keyword: "${r}"`)}function i(t,e){if("boolean"==typeof t)return!t;for(const s in t)if(e[s])return!0;return!1}function r(t){return"number"==typeof t?`${t}`:t.replace(/~/g,"~0").replace(/\//g,"~1")}function a(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function o({mergeNames:t,mergeToName:s,mergeValues:n,resultToName:i}){return(r,a,o,h)=>{const l=void 0===o?a:o instanceof e.Name?(a instanceof e.Name?t(r,a,o):s(r,a,o),o):a instanceof e.Name?(s(r,o,a),a):n(a,o);return h!==e.Name||l instanceof e.Name?l:i(r,l)}}function h(t,s){if(!0===s)return t.var("props",!0);const n=t.var("props",e._`{}`);return void 0!==s&&c(t,n,s),n}function c(t,s,n){Object.keys(n).forEach((n=>t.assign(e._`${s}${(0,e.getProperty)(n)}`,!0)))}t.toHash=function(t){const e={};for(const s of t)e[s]=!0;return e},t.alwaysValidSchema=function(t,e){return"boolean"==typeof e?e:0===Object.keys(e).length||(n(t,e),!i(e,t.self.RULES.all))},t.checkUnknownRules=n,t.schemaHasRules=i,t.schemaHasRulesButRef=function(t,e){if("boolean"==typeof t)return!t;for(const s in t)if("$ref"!==s&&e.all[s])return!0;return!1},t.schemaRefOrVal=function({topSchemaRef:t,schemaPath:s},n,i,r){if(!r){if("number"==typeof n||"boolean"==typeof n)return n;if("string"==typeof n)return e._`${n}`}return e._`${t}${s}${(0,e.getProperty)(i)}`},t.unescapeFragment=function(t){return a(decodeURIComponent(t))},t.escapeFragment=function(t){return encodeURIComponent(r(t))},t.escapeJsonPointer=r,t.unescapeJsonPointer=a,t.eachItem=function(t,e){if(Array.isArray(t))for(const s of t)e(s);else e(t)},t.mergeEvaluated={props:o({mergeNames:(t,s,n)=>t.if(e._`${n} !== true && ${s} !== undefined`,(()=>{t.if(e._`${s} === true`,(()=>t.assign(n,!0)),(()=>t.assign(n,e._`${n} || {}`).code(e._`Object.assign(${n}, ${s})`)))})),mergeToName:(t,s,n)=>t.if(e._`${n} !== true`,(()=>{!0===s?t.assign(n,!0):(t.assign(n,e._`${n} || {}`),c(t,n,s))})),mergeValues:(t,e)=>!0===t||l(l({},t),e),resultToName:h}),items:o({mergeNames:(t,s,n)=>t.if(e._`${n} !== true && ${s} !== undefined`,(()=>t.assign(n,e._`${s} === true ? true : ${n} > ${s} ? ${n} : ${s}`))),mergeToName:(t,s,n)=>t.if(e._`${n} !== true`,(()=>t.assign(n,!0===s||e._`${n} > ${s} ? ${n} : ${s}`))),mergeValues:(t,e)=>!0===t||Math.max(t,e),resultToName:(t,e)=>t.var("items",e)})},t.evaluatedPropsToName=h,t.setEvaluated=c;const u={};var d,f;function p(t,e,s=t.opts.strictSchema){if(s){if(e=`strict mode: ${e}`,!0===s)throw new Error(e);t.self.logger.warn(e)}}t.useFunc=function(t,e){return t.scopeValue("func",{ref:e,code:u[e.code]||(u[e.code]=new s._Code(e.code))})},(f=d=t.Type||(t.Type={}))[f.Num=0]="Num",f[f.Str=1]="Str",t.getErrorPath=function(t,s,n){if(t instanceof e.Name){const i=s===d.Num;return n?i?e._`"[" + ${t} + "]"`:e._`"['" + ${t} + "']"`:i?e._`"/" + ${t}`:e._`"/" + ${t}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return n?(0,e.getProperty)(t).toString():"/"+r(t)},t.checkStrictMode=p}(I);var P={};Object.defineProperty(P,"__esModule",{value:!0});const R=A,k={data:new R.Name("data"),valCxt:new R.Name("valCxt"),instancePath:new R.Name("instancePath"),parentData:new R.Name("parentData"),parentDataProperty:new R.Name("parentDataProperty"),rootData:new R.Name("rootData"),dynamicAnchors:new R.Name("dynamicAnchors"),vErrors:new R.Name("vErrors"),errors:new R.Name("errors"),this:new R.Name("this"),self:new R.Name("self"),scope:new R.Name("scope"),json:new R.Name("json"),jsonPos:new R.Name("jsonPos"),jsonLen:new R.Name("jsonLen"),jsonPart:new R.Name("jsonPart")};P.default=k,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.extendErrors=t.resetErrorsCount=t.reportExtraError=t.reportError=t.keyword$DataError=t.keywordError=void 0;const e=A,s=I,n=P;function i(t,s){const i=t.const("err",s);t.if(e._`${n.default.vErrors} === null`,(()=>t.assign(n.default.vErrors,e._`[${i}]`)),e._`${n.default.vErrors}.push(${i})`),t.code(e._`${n.default.errors}++`)}function r(t,s){const{gen:n,validateName:i,schemaEnv:r}=t;r.$async?n.throw(e._`new ${t.ValidationError}(${s})`):(n.assign(e._`${i}.errors`,s),n.return(!1))}t.keywordError={message:({keyword:t})=>e.str`must pass "${t}" keyword validation`},t.keyword$DataError={message:({keyword:t,schemaType:s})=>s?e.str`"${t}" keyword must be ${s} ($data)`:e.str`"${t}" keyword is invalid ($data)`},t.reportError=function(s,n=t.keywordError,a,h){const{it:l}=s,{gen:c,compositeRule:u,allErrors:d}=l,f=o(s,n,a);(null!=h?h:u||d)?i(c,f):r(l,e._`[${f}]`)},t.reportExtraError=function(e,s=t.keywordError,a){const{it:h}=e,{gen:l,compositeRule:c,allErrors:u}=h;i(l,o(e,s,a)),c||u||r(h,n.default.vErrors)},t.resetErrorsCount=function(t,s){t.assign(n.default.errors,s),t.if(e._`${n.default.vErrors} !== null`,(()=>t.if(s,(()=>t.assign(e._`${n.default.vErrors}.length`,s)),(()=>t.assign(n.default.vErrors,null)))))},t.extendErrors=function({gen:t,keyword:s,schemaValue:i,data:r,errsCount:a,it:o}){if(void 0===a)throw new Error("ajv implementation error");const h=t.name("err");t.forRange("i",a,n.default.errors,(a=>{t.const(h,e._`${n.default.vErrors}[${a}]`),t.if(e._`${h}.instancePath === undefined`,(()=>t.assign(e._`${h}.instancePath`,(0,e.strConcat)(n.default.instancePath,o.errorPath)))),t.assign(e._`${h}.schemaPath`,e.str`${o.errSchemaPath}/${s}`),o.opts.verbose&&(t.assign(e._`${h}.schema`,i),t.assign(e._`${h}.data`,r))}))};const a={keyword:new e.Name("keyword"),schemaPath:new e.Name("schemaPath"),params:new e.Name("params"),propertyName:new e.Name("propertyName"),message:new e.Name("message"),schema:new e.Name("schema"),parentSchema:new e.Name("parentSchema")};function o(t,s,i){const{createErrors:r}=t.it;return!1===r?e._`{}`:function(t,s,i={}){const{gen:r,it:o}=t,c=[h(o,i),l(t,i)];return function(t,{params:s,message:i},r){const{keyword:o,data:h,schemaValue:l,it:c}=t,{opts:u,propertyName:d,topSchemaRef:f,schemaPath:p}=c;r.push([a.keyword,o],[a.params,"function"==typeof s?s(t):s||e._`{}`]),u.messages&&r.push([a.message,"function"==typeof i?i(t):i]);u.verbose&&r.push([a.schema,l],[a.parentSchema,e._`${f}${p}`],[n.default.data,h]);d&&r.push([a.propertyName,d])}(t,s,c),r.object(...c)}(t,s,i)}function h({errorPath:t},{instancePath:i}){const r=i?e.str`${t}${(0,s.getErrorPath)(i,s.Type.Str)}`:t;return[n.default.instancePath,(0,e.strConcat)(n.default.instancePath,r)]}function l({keyword:t,it:{errSchemaPath:n}},{schemaPath:i,parentSchema:r}){let o=r?n:e.str`${n}/${t}`;return i&&(o=e.str`${o}${(0,s.getErrorPath)(i,s.Type.Str)}`),[a.schemaPath,o]}}(T),Object.defineProperty(S,"__esModule",{value:!0}),S.boolOrEmptySchema=S.topBoolOrEmptySchema=void 0;const D=T,F=A,O=P,N={message:"boolean schema is false"};function B(t,e){const{gen:s,data:n}=t,i={gen:s,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,D.reportError)(i,N,void 0,e)}S.topBoolOrEmptySchema=function(t){const{gen:e,schema:s,validateName:n}=t;!1===s?B(t,!1):"object"==typeof s&&!0===s.$async?e.return(O.default.data):(e.assign(F._`${n}.errors`,null),e.return(!0))},S.boolOrEmptySchema=function(t,e){const{gen:s,schema:n}=t;!1===n?(s.var(e,!1),B(t)):s.var(e,!0)};var L={},V={};Object.defineProperty(V,"__esModule",{value:!0}),V.getRules=V.isJSONType=void 0;const $=new Set(["string","number","integer","boolean","null","object","array"]);V.isJSONType=function(t){return"string"==typeof t&&$.has(t)},V.getRules=function(){const t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:c(l({},t),{integer:!0,boolean:!0,null:!0}),rules:[{rules:[]},t.number,t.string,t.array,t.object],post:{rules:[]},all:{},keywords:{}}};var U={};function X(t,e){return e.rules.some((e=>Y(t,e)))}function Y(t,e){var s;return void 0!==t[e.keyword]||(null===(s=e.definition.implements)||void 0===s?void 0:s.some((e=>void 0!==t[e])))}Object.defineProperty(U,"__esModule",{value:!0}),U.shouldUseRule=U.shouldUseGroup=U.schemaHasRulesForType=void 0,U.schemaHasRulesForType=function({schema:t,self:e},s){const n=e.RULES.types[s];return n&&!0!==n&&X(t,n)},U.shouldUseGroup=X,U.shouldUseRule=Y,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.reportTypeError=t.checkDataTypes=t.checkDataType=t.coerceAndCheckDataType=t.getJSONTypes=t.getSchemaTypes=t.DataType=void 0;const e=V,s=U,n=T,i=A,r=I;var a,o;function h(t){const s=Array.isArray(t)?t:t?[t]:[];if(s.every(e.isJSONType))return s;throw new Error("type must be JSONType or JSONType[]: "+s.join(","))}(o=a=t.DataType||(t.DataType={}))[o.Correct=0]="Correct",o[o.Wrong=1]="Wrong",t.getSchemaTypes=function(t){const e=h(t.type);if(e.includes("null")){if(!1===t.nullable)throw new Error("type: null contradicts nullable: false")}else{if(!e.length&&void 0!==t.nullable)throw new Error('"nullable" cannot be used without "type"');!0===t.nullable&&e.push("null")}return e},t.getJSONTypes=h,t.coerceAndCheckDataType=function(t,e){const{gen:n,data:r,opts:o}=t,h=function(t,e){return e?t.filter((t=>l.has(t)||"array"===e&&"array"===t)):[]}(e,o.coerceTypes),c=e.length>0&&!(0===h.length&&1===e.length&&(0,s.schemaHasRulesForType)(t,e[0]));if(c){const s=u(e,r,o.strictNumbers,a.Wrong);n.if(s,(()=>{h.length?function(t,e,s){const{gen:n,data:r,opts:a}=t,o=n.let("dataType",i._`typeof ${r}`),h=n.let("coerced",i._`undefined`);"array"===a.coerceTypes&&n.if(i._`${o} == 'object' && Array.isArray(${r}) && ${r}.length == 1`,(()=>n.assign(r,i._`${r}[0]`).assign(o,i._`typeof ${r}`).if(u(e,r,a.strictNumbers),(()=>n.assign(h,r)))));n.if(i._`${h} !== undefined`);for(const i of s)(l.has(i)||"array"===i&&"array"===a.coerceTypes)&&c(i);function c(t){switch(t){case"string":return void n.elseIf(i._`${o} == "number" || ${o} == "boolean"`).assign(h,i._`"" + ${r}`).elseIf(i._`${r} === null`).assign(h,i._`""`);case"number":return void n.elseIf(i._`${o} == "boolean" || ${r} === null
              || (${o} == "string" && ${r} && ${r} == +${r})`).assign(h,i._`+${r}`);case"integer":return void n.elseIf(i._`${o} === "boolean" || ${r} === null
              || (${o} === "string" && ${r} && ${r} == +${r} && !(${r} % 1))`).assign(h,i._`+${r}`);case"boolean":return void n.elseIf(i._`${r} === "false" || ${r} === 0 || ${r} === null`).assign(h,!1).elseIf(i._`${r} === "true" || ${r} === 1`).assign(h,!0);case"null":return n.elseIf(i._`${r} === "" || ${r} === 0 || ${r} === false`),void n.assign(h,null);case"array":n.elseIf(i._`${o} === "string" || ${o} === "number"
              || ${o} === "boolean" || ${r} === null`).assign(h,i._`[${r}]`)}}n.else(),f(t),n.endIf(),n.if(i._`${h} !== undefined`,(()=>{n.assign(r,h),function({gen:t,parentData:e,parentDataProperty:s},n){t.if(i._`${e} !== undefined`,(()=>t.assign(i._`${e}[${s}]`,n)))}(t,h)}))}(t,e,h):f(t)}))}return c};const l=new Set(["string","number","integer","boolean","null"]);function c(t,e,s,n=a.Correct){const r=n===a.Correct?i.operators.EQ:i.operators.NEQ;let o;switch(t){case"null":return i._`${e} ${r} null`;case"array":o=i._`Array.isArray(${e})`;break;case"object":o=i._`${e} && typeof ${e} == "object" && !Array.isArray(${e})`;break;case"integer":o=h(i._`!(${e} % 1) && !isNaN(${e})`);break;case"number":o=h();break;default:return i._`typeof ${e} ${r} ${t}`}return n===a.Correct?o:(0,i.not)(o);function h(t=i.nil){return(0,i.and)(i._`typeof ${e} == "number"`,t,s?i._`isFinite(${e})`:i.nil)}}function u(t,e,s,n){if(1===t.length)return c(t[0],e,s,n);let a;const o=(0,r.toHash)(t);if(o.array&&o.object){const t=i._`typeof ${e} != "object"`;a=o.null?t:i._`!${e} || ${t}`,delete o.null,delete o.array,delete o.object}else a=i.nil;o.number&&delete o.integer;for(const r in o)a=(0,i.and)(a,c(r,e,s,n));return a}t.checkDataType=c,t.checkDataTypes=u;const d={message:({schema:t})=>`must be ${t}`,params:({schema:t,schemaValue:e})=>"string"==typeof t?i._`{type: ${t}}`:i._`{type: ${e}}`};function f(t){const e=function(t){const{gen:e,data:s,schema:n}=t,i=(0,r.schemaRefOrVal)(t,n,"type");return{gen:e,keyword:"type",data:s,schema:n.type,schemaCode:i,schemaValue:i,parentSchema:n,params:{},it:t}}(t);(0,n.reportError)(e,d)}t.reportTypeError=f}(L);var W={};Object.defineProperty(W,"__esModule",{value:!0}),W.assignDefaults=void 0;const j=A,z=I;function G(t,e,s){const{gen:n,compositeRule:i,data:r,opts:a}=t;if(void 0===s)return;const o=j._`${r}${(0,j.getProperty)(e)}`;if(i)return void(0,z.checkStrictMode)(t,`default is ignored for: ${o}`);let h=j._`${o} === undefined`;"empty"===a.useDefaults&&(h=j._`${h} || ${o} === null || ${o} === ""`),n.if(h,j._`${o} = ${(0,j.stringify)(s)}`)}W.assignDefaults=function(t,e){const{properties:s,items:n}=t.schema;if("object"===e&&s)for(const i in s)G(t,i,s[i].default);else"array"===e&&Array.isArray(n)&&n.forEach(((e,s)=>G(t,s,e.default)))};var H={},q={};Object.defineProperty(q,"__esModule",{value:!0}),q.validateUnion=q.validateArray=q.usePattern=q.callValidateCode=q.schemaProperties=q.allSchemaProperties=q.noPropertyInData=q.propertyInData=q.isOwnProperty=q.hasPropFunc=q.reportMissingProp=q.checkMissingProp=q.checkReportMissingProp=void 0;const K=A,Z=I,Q=P,J=I;function tt(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:K._`Object.prototype.hasOwnProperty`})}function et(t,e,s){return K._`${tt(t)}.call(${e}, ${s})`}function st(t,e,s,n){const i=K._`${e}${(0,K.getProperty)(s)} === undefined`;return n?(0,K.or)(i,(0,K.not)(et(t,e,s))):i}function nt(t){return t?Object.keys(t).filter((t=>"__proto__"!==t)):[]}q.checkReportMissingProp=function(t,e){const{gen:s,data:n,it:i}=t;s.if(st(s,n,e,i.opts.ownProperties),(()=>{t.setParams({missingProperty:K._`${e}`},!0),t.error()}))},q.checkMissingProp=function({gen:t,data:e,it:{opts:s}},n,i){return(0,K.or)(...n.map((n=>(0,K.and)(st(t,e,n,s.ownProperties),K._`${i} = ${n}`))))},q.reportMissingProp=function(t,e){t.setParams({missingProperty:e},!0),t.error()},q.hasPropFunc=tt,q.isOwnProperty=et,q.propertyInData=function(t,e,s,n){const i=K._`${e}${(0,K.getProperty)(s)} !== undefined`;return n?K._`${i} && ${et(t,e,s)}`:i},q.noPropertyInData=st,q.allSchemaProperties=nt,q.schemaProperties=function(t,e){return nt(e).filter((s=>!(0,Z.alwaysValidSchema)(t,e[s])))},q.callValidateCode=function({schemaCode:t,data:e,it:{gen:s,topSchemaRef:n,schemaPath:i,errorPath:r},it:a},o,h,l){const c=l?K._`${t}, ${e}, ${n}${i}`:e,u=[[Q.default.instancePath,(0,K.strConcat)(Q.default.instancePath,r)],[Q.default.parentData,a.parentData],[Q.default.parentDataProperty,a.parentDataProperty],[Q.default.rootData,Q.default.rootData]];a.opts.dynamicRef&&u.push([Q.default.dynamicAnchors,Q.default.dynamicAnchors]);const d=K._`${c}, ${s.object(...u)}`;return h!==K.nil?K._`${o}.call(${h}, ${d})`:K._`${o}(${d})`};const it=K._`new RegExp`;q.usePattern=function({gen:t,it:{opts:e}},s){const n=e.unicodeRegExp?"u":"",{regExp:i}=e.code,r=i(s,n);return t.scopeValue("pattern",{key:r.toString(),ref:r,code:K._`${"new RegExp"===i.code?it:(0,J.useFunc)(t,i)}(${s}, ${n})`})},q.validateArray=function(t){const{gen:e,data:s,keyword:n,it:i}=t,r=e.name("valid");if(i.allErrors){const t=e.let("valid",!0);return a((()=>e.assign(t,!1))),t}return e.var(r,!0),a((()=>e.break())),r;function a(i){const a=e.const("len",K._`${s}.length`);e.forRange("i",0,a,(s=>{t.subschema({keyword:n,dataProp:s,dataPropType:Z.Type.Num},r),e.if((0,K.not)(r),i)}))}},q.validateUnion=function(t){const{gen:e,schema:s,keyword:n,it:i}=t;if(!Array.isArray(s))throw new Error("ajv implementation error");if(s.some((t=>(0,Z.alwaysValidSchema)(i,t)))&&!i.opts.unevaluated)return;const r=e.let("valid",!1),a=e.name("_valid");e.block((()=>s.forEach(((s,i)=>{const o=t.subschema({keyword:n,schemaProp:i,compositeRule:!0},a);e.assign(r,K._`${r} || ${a}`);t.mergeValidEvaluated(o,a)||e.if((0,K.not)(r))})))),t.result(r,(()=>t.reset()),(()=>t.error(!0)))},Object.defineProperty(H,"__esModule",{value:!0}),H.validateKeywordUsage=H.validSchemaType=H.funcKeywordCode=H.macroKeywordCode=void 0;const rt=A,at=P,ot=q,ht=T;function lt(t){const{gen:e,data:s,it:n}=t;e.if(n.parentData,(()=>e.assign(s,rt._`${n.parentData}[${n.parentDataProperty}]`)))}function ct(t,e,s){if(void 0===s)throw new Error(`keyword "${e}" failed to compile`);return t.scopeValue("keyword","function"==typeof s?{ref:s}:{ref:s,code:(0,rt.stringify)(s)})}H.macroKeywordCode=function(t,e){const{gen:s,keyword:n,schema:i,parentSchema:r,it:a}=t,o=e.macro.call(a.self,i,r,a),h=ct(s,n,o);!1!==a.opts.validateSchema&&a.self.validateSchema(o,!0);const l=s.name("valid");t.subschema({schema:o,schemaPath:rt.nil,errSchemaPath:`${a.errSchemaPath}/${n}`,topSchemaRef:h,compositeRule:!0},l),t.pass(l,(()=>t.error(!0)))},H.funcKeywordCode=function(t,e){var s;const{gen:n,keyword:i,schema:r,parentSchema:a,$data:o,it:h}=t;!function({schemaEnv:t},e){if(e.async&&!t.$async)throw new Error("async keyword in sync schema")}(h,e);const l=!o&&e.compile?e.compile.call(h.self,r,a,h):e.validate,c=ct(n,i,l),u=n.let("valid");function d(s=(e.async?rt._`await `:rt.nil)){const i=h.opts.passContext?at.default.this:at.default.self,r=!("compile"in e&&!o||!1===e.schema);n.assign(u,rt._`${s}${(0,ot.callValidateCode)(t,c,i,r)}`,e.modifying)}function f(t){var s;n.if((0,rt.not)(null!==(s=e.valid)&&void 0!==s?s:u),t)}t.block$data(u,(function(){if(!1===e.errors)d(),e.modifying&&lt(t),f((()=>t.error()));else{const s=e.async?function(){const t=n.let("ruleErrs",null);return n.try((()=>d(rt._`await `)),(e=>n.assign(u,!1).if(rt._`${e} instanceof ${h.ValidationError}`,(()=>n.assign(t,rt._`${e}.errors`)),(()=>n.throw(e))))),t}():function(){const t=rt._`${c}.errors`;return n.assign(t,null),d(rt.nil),t}();e.modifying&&lt(t),f((()=>function(t,e){const{gen:s}=t;s.if(rt._`Array.isArray(${e})`,(()=>{s.assign(at.default.vErrors,rt._`${at.default.vErrors} === null ? ${e} : ${at.default.vErrors}.concat(${e})`).assign(at.default.errors,rt._`${at.default.vErrors}.length`),(0,ht.extendErrors)(t)}),(()=>t.error()))}(t,s)))}})),t.ok(null!==(s=e.valid)&&void 0!==s?s:u)},H.validSchemaType=function(t,e,s=!1){return!e.length||e.some((e=>"array"===e?Array.isArray(t):"object"===e?t&&"object"==typeof t&&!Array.isArray(t):typeof t==e||s&&void 0===t))},H.validateKeywordUsage=function({schema:t,opts:e,self:s,errSchemaPath:n},i,r){if(Array.isArray(i.keyword)?!i.keyword.includes(r):i.keyword!==r)throw new Error("ajv implementation error");const a=i.dependencies;if(null==a?void 0:a.some((e=>!Object.prototype.hasOwnProperty.call(t,e))))throw new Error(`parent schema must have dependencies of ${r}: ${a.join(",")}`);if(i.validateSchema){if(!i.validateSchema(t[r])){const t=`keyword "${r}" value is invalid at path "${n}": `+s.errorsText(i.validateSchema.errors);if("log"!==e.validateSchema)throw new Error(t);s.logger.error(t)}}};var ut={};Object.defineProperty(ut,"__esModule",{value:!0}),ut.extendSubschemaMode=ut.extendSubschemaData=ut.getSubschema=void 0;const dt=A,ft=I;ut.getSubschema=function(t,{keyword:e,schemaProp:s,schema:n,schemaPath:i,errSchemaPath:r,topSchemaRef:a}){if(void 0!==e&&void 0!==n)throw new Error('both "keyword" and "schema" passed, only one allowed');if(void 0!==e){const n=t.schema[e];return void 0===s?{schema:n,schemaPath:dt._`${t.schemaPath}${(0,dt.getProperty)(e)}`,errSchemaPath:`${t.errSchemaPath}/${e}`}:{schema:n[s],schemaPath:dt._`${t.schemaPath}${(0,dt.getProperty)(e)}${(0,dt.getProperty)(s)}`,errSchemaPath:`${t.errSchemaPath}/${e}/${(0,ft.escapeFragment)(s)}`}}if(void 0!==n){if(void 0===i||void 0===r||void 0===a)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:i,topSchemaRef:a,errSchemaPath:r}}throw new Error('either "keyword" or "schema" must be passed')},ut.extendSubschemaData=function(t,e,{dataProp:s,dataPropType:n,data:i,dataTypes:r,propertyName:a}){if(void 0!==i&&void 0!==s)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:o}=e;if(void 0!==s){const{errorPath:i,dataPathArr:r,opts:a}=e;h(o.let("data",dt._`${e.data}${(0,dt.getProperty)(s)}`,!0)),t.errorPath=dt.str`${i}${(0,ft.getErrorPath)(s,n,a.jsPropertySyntax)}`,t.parentDataProperty=dt._`${s}`,t.dataPathArr=[...r,t.parentDataProperty]}if(void 0!==i){h(i instanceof dt.Name?i:o.let("data",i,!0)),void 0!==a&&(t.propertyName=a)}function h(s){t.data=s,t.dataLevel=e.dataLevel+1,t.dataTypes=[],e.definedProperties=new Set,t.parentData=e.data,t.dataNames=[...e.dataNames,s]}r&&(t.dataTypes=r)},ut.extendSubschemaMode=function(t,{jtdDiscriminator:e,jtdMetadata:s,compositeRule:n,createErrors:i,allErrors:r}){void 0!==n&&(t.compositeRule=n),void 0!==i&&(t.createErrors=i),void 0!==r&&(t.allErrors=r),t.jtdDiscriminator=e,t.jtdMetadata=s};var pt={},mt=function t(e,s){if(e===s)return!0;if(e&&s&&"object"==typeof e&&"object"==typeof s){if(e.constructor!==s.constructor)return!1;var n,i,r;if(Array.isArray(e)){if((n=e.length)!=s.length)return!1;for(i=n;0!=i--;)if(!t(e[i],s[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===s.source&&e.flags===s.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===s.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===s.toString();if((n=(r=Object.keys(e)).length)!==Object.keys(s).length)return!1;for(i=n;0!=i--;)if(!Object.prototype.hasOwnProperty.call(s,r[i]))return!1;for(i=n;0!=i--;){var a=r[i];if(!t(e[a],s[a]))return!1}return!0}return e!=e&&s!=s},gt={},yt={get exports(){return gt},set exports(t){gt=t}}.exports=function(t,e,s){"function"==typeof e&&(s=e,e={}),vt(e,"function"==typeof(s=e.cb||s)?s:s.pre||function(){},s.post||function(){},t,"",t)};function vt(t,e,s,n,i,r,a,o,h,l){if(n&&"object"==typeof n&&!Array.isArray(n)){for(var c in e(n,i,r,a,o,h,l),n){var u=n[c];if(Array.isArray(u)){if(c in yt.arrayKeywords)for(var d=0;d<u.length;d++)vt(t,e,s,u[d],i+"/"+c+"/"+d,r,i,c,n,d)}else if(c in yt.propsKeywords){if(u&&"object"==typeof u)for(var f in u)vt(t,e,s,u[f],i+"/"+c+"/"+f.replace(/~/g,"~0").replace(/\//g,"~1"),r,i,c,n,f)}else(c in yt.keywords||t.allKeys&&!(c in yt.skipKeywords))&&vt(t,e,s,u,i+"/"+c,r,i,c,n)}s(n,i,r,a,o,h,l)}}yt.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0},yt.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},yt.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},yt.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},Object.defineProperty(pt,"__esModule",{value:!0}),pt.getSchemaRefs=pt.resolveUrl=pt.normalizeId=pt._getFullPath=pt.getFullPath=pt.inlineRef=void 0;const xt=I,_t=mt,bt=gt,wt=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);pt.inlineRef=function(t,e=!0){return"boolean"==typeof t||(!0===e?!St(t):!!e&&Tt(t)<=e)};const Et=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function St(t){for(const e in t){if(Et.has(e))return!0;const s=t[e];if(Array.isArray(s)&&s.some(St))return!0;if("object"==typeof s&&St(s))return!0}return!1}function Tt(t){let e=0;for(const s in t){if("$ref"===s)return 1/0;if(e++,!wt.has(s)&&("object"==typeof t[s]&&(0,xt.eachItem)(t[s],(t=>e+=Tt(t))),e===1/0))return 1/0}return e}function At(t,e="",s){!1!==s&&(e=It(e));const n=t.parse(e);return Ct(t,n)}function Ct(t,e){return t.serialize(e).split("#")[0]+"#"}pt.getFullPath=At,pt._getFullPath=Ct;const Mt=/#\/?$/;function It(t){return t?t.replace(Mt,""):""}pt.normalizeId=It,pt.resolveUrl=function(t,e,s){return s=It(s),t.resolve(e,s)};const Pt=/^[a-z_][-a-z0-9._]*$/i;pt.getSchemaRefs=function(t,e){if("boolean"==typeof t)return{};const{schemaId:s,uriResolver:n}=this.opts,i=It(t[s]||e),r={"":i},a=At(n,i,!1),o={},h=new Set;return bt(t,{allKeys:!0},((t,e,n,i)=>{if(void 0===i)return;const u=a+e;let d=r[i];function f(e){const s=this.opts.uriResolver.resolve;if(e=It(d?s(d,e):e),h.has(e))throw c(e);h.add(e);let n=this.refs[e];return"string"==typeof n&&(n=this.refs[n]),"object"==typeof n?l(t,n.schema,e):e!==It(u)&&("#"===e[0]?(l(t,o[e],e),o[e]=t):this.refs[e]=u),e}function p(t){if("string"==typeof t){if(!Pt.test(t))throw new Error(`invalid anchor "${t}"`);f.call(this,`#${t}`)}}"string"==typeof t[s]&&(d=f.call(this,t[s])),p.call(this,t.$anchor),p.call(this,t.$dynamicAnchor),r[e]=d})),o;function l(t,e,s){if(void 0!==e&&!_t(t,e))throw c(s)}function c(t){return new Error(`reference "${t}" resolves to more than one schema`)}},Object.defineProperty(E,"__esModule",{value:!0}),E.getData=E.KeywordCxt=E.validateFunctionCode=void 0;const Rt=S,kt=L,Dt=U,Ft=L,Ot=W,Nt=H,Bt=ut,Lt=A,Vt=P,$t=pt,Ut=I,Xt=T;function Yt({gen:t,validateName:e,schema:s,schemaEnv:n,opts:i},r){i.code.es5?t.func(e,Lt._`${Vt.default.data}, ${Vt.default.valCxt}`,n.$async,(()=>{t.code(Lt._`"use strict"; ${Wt(s,i)}`),function(t,e){t.if(Vt.default.valCxt,(()=>{t.var(Vt.default.instancePath,Lt._`${Vt.default.valCxt}.${Vt.default.instancePath}`),t.var(Vt.default.parentData,Lt._`${Vt.default.valCxt}.${Vt.default.parentData}`),t.var(Vt.default.parentDataProperty,Lt._`${Vt.default.valCxt}.${Vt.default.parentDataProperty}`),t.var(Vt.default.rootData,Lt._`${Vt.default.valCxt}.${Vt.default.rootData}`),e.dynamicRef&&t.var(Vt.default.dynamicAnchors,Lt._`${Vt.default.valCxt}.${Vt.default.dynamicAnchors}`)}),(()=>{t.var(Vt.default.instancePath,Lt._`""`),t.var(Vt.default.parentData,Lt._`undefined`),t.var(Vt.default.parentDataProperty,Lt._`undefined`),t.var(Vt.default.rootData,Vt.default.data),e.dynamicRef&&t.var(Vt.default.dynamicAnchors,Lt._`{}`)}))}(t,i),t.code(r)})):t.func(e,Lt._`${Vt.default.data}, ${function(t){return Lt._`{${Vt.default.instancePath}="", ${Vt.default.parentData}, ${Vt.default.parentDataProperty}, ${Vt.default.rootData}=${Vt.default.data}${t.dynamicRef?Lt._`, ${Vt.default.dynamicAnchors}={}`:Lt.nil}}={}`}(i)}`,n.$async,(()=>t.code(Wt(s,i)).code(r)))}function Wt(t,e){const s="object"==typeof t&&t[e.schemaId];return s&&(e.code.source||e.code.process)?Lt._`/*# sourceURL=${s} */`:Lt.nil}function jt(t,e){Gt(t)&&(Ht(t),zt(t))?function(t,e){const{schema:s,gen:n,opts:i}=t;i.$comment&&s.$comment&&Kt(t);(function(t){const e=t.schema[t.opts.schemaId];e&&(t.baseId=(0,$t.resolveUrl)(t.opts.uriResolver,t.baseId,e))})(t),function(t){if(t.schema.$async&&!t.schemaEnv.$async)throw new Error("async schema in sync schema")}(t);const r=n.const("_errs",Vt.default.errors);qt(t,r),n.var(e,Lt._`${r} === ${Vt.default.errors}`)}(t,e):(0,Rt.boolOrEmptySchema)(t,e)}function zt({schema:t,self:e}){if("boolean"==typeof t)return!t;for(const s in t)if(e.RULES.all[s])return!0;return!1}function Gt(t){return"boolean"!=typeof t.schema}function Ht(t){(0,Ut.checkUnknownRules)(t),function(t){const{schema:e,errSchemaPath:s,opts:n,self:i}=t;e.$ref&&n.ignoreKeywordsWithRef&&(0,Ut.schemaHasRulesButRef)(e,i.RULES)&&i.logger.warn(`$ref: keywords ignored in schema at path "${s}"`)}(t)}function qt(t,e){if(t.opts.jtd)return Zt(t,[],!1,e);const s=(0,kt.getSchemaTypes)(t.schema);Zt(t,s,!(0,kt.coerceAndCheckDataType)(t,s),e)}function Kt({gen:t,schemaEnv:e,schema:s,errSchemaPath:n,opts:i}){const r=s.$comment;if(!0===i.$comment)t.code(Lt._`${Vt.default.self}.logger.log(${r})`);else if("function"==typeof i.$comment){const s=Lt.str`${n}/$comment`,i=t.scopeValue("root",{ref:e.root});t.code(Lt._`${Vt.default.self}.opts.$comment(${r}, ${s}, ${i}.schema)`)}}function Zt(t,e,s,n){const{gen:i,schema:r,data:a,allErrors:o,opts:h,self:l}=t,{RULES:c}=l;function u(l){(0,Dt.shouldUseGroup)(r,l)&&(l.type?(i.if((0,Ft.checkDataType)(l.type,a,h.strictNumbers)),Qt(t,l),1===e.length&&e[0]===l.type&&s&&(i.else(),(0,Ft.reportTypeError)(t)),i.endIf()):Qt(t,l),o||i.if(Lt._`${Vt.default.errors} === ${n||0}`))}!r.$ref||!h.ignoreKeywordsWithRef&&(0,Ut.schemaHasRulesButRef)(r,c)?(h.jtd||function(t,e){if(t.schemaEnv.meta||!t.opts.strictTypes)return;(function(t,e){if(!e.length)return;if(!t.dataTypes.length)return void(t.dataTypes=e);e.forEach((e=>{te(t.dataTypes,e)||ee(t,`type "${e}" not allowed by context "${t.dataTypes.join(",")}"`)})),function(t,e){const s=[];for(const n of t.dataTypes)te(e,n)?s.push(n):e.includes("integer")&&"number"===n&&s.push("integer");t.dataTypes=s}(t,e)})(t,e),t.opts.allowUnionTypes||function(t,e){e.length>1&&(2!==e.length||!e.includes("null"))&&ee(t,"use allowUnionTypes to allow union type keyword")}(t,e);!function(t,e){const s=t.self.RULES.all;for(const n in s){const i=s[n];if("object"==typeof i&&(0,Dt.shouldUseRule)(t.schema,i)){const{type:s}=i.definition;s.length&&!s.some((t=>Jt(e,t)))&&ee(t,`missing type "${s.join(",")}" for keyword "${n}"`)}}}(t,t.dataTypes)}(t,e),i.block((()=>{for(const t of c.rules)u(t);u(c.post)}))):i.block((()=>ne(t,"$ref",c.all.$ref.definition)))}function Qt(t,e){const{gen:s,schema:n,opts:{useDefaults:i}}=t;i&&(0,Ot.assignDefaults)(t,e.type),s.block((()=>{for(const s of e.rules)(0,Dt.shouldUseRule)(n,s)&&ne(t,s.keyword,s.definition,e.type)}))}function Jt(t,e){return t.includes(e)||"number"===e&&t.includes("integer")}function te(t,e){return t.includes(e)||"integer"===e&&t.includes("number")}function ee(t,e){e+=` at "${t.schemaEnv.baseId+t.errSchemaPath}" (strictTypes)`,(0,Ut.checkStrictMode)(t,e,t.opts.strictTypes)}E.validateFunctionCode=function(t){Gt(t)&&(Ht(t),zt(t))?function(t){const{schema:e,opts:s,gen:n}=t;Yt(t,(()=>{s.$comment&&e.$comment&&Kt(t),function(t){const{schema:e,opts:s}=t;void 0!==e.default&&s.useDefaults&&s.strictSchema&&(0,Ut.checkStrictMode)(t,"default is ignored in the schema root")}(t),n.let(Vt.default.vErrors,null),n.let(Vt.default.errors,0),s.unevaluated&&function(t){const{gen:e,validateName:s}=t;t.evaluated=e.const("evaluated",Lt._`${s}.evaluated`),e.if(Lt._`${t.evaluated}.dynamicProps`,(()=>e.assign(Lt._`${t.evaluated}.props`,Lt._`undefined`))),e.if(Lt._`${t.evaluated}.dynamicItems`,(()=>e.assign(Lt._`${t.evaluated}.items`,Lt._`undefined`)))}(t),qt(t),function(t){const{gen:e,schemaEnv:s,validateName:n,ValidationError:i,opts:r}=t;s.$async?e.if(Lt._`${Vt.default.errors} === 0`,(()=>e.return(Vt.default.data)),(()=>e.throw(Lt._`new ${i}(${Vt.default.vErrors})`))):(e.assign(Lt._`${n}.errors`,Vt.default.vErrors),r.unevaluated&&function({gen:t,evaluated:e,props:s,items:n}){s instanceof Lt.Name&&t.assign(Lt._`${e}.props`,s);n instanceof Lt.Name&&t.assign(Lt._`${e}.items`,n)}(t),e.return(Lt._`${Vt.default.errors} === 0`))}(t)}))}(t):Yt(t,(()=>(0,Rt.topBoolOrEmptySchema)(t)))};class se{constructor(t,e,s){if((0,Nt.validateKeywordUsage)(t,e,s),this.gen=t.gen,this.allErrors=t.allErrors,this.keyword=s,this.data=t.data,this.schema=t.schema[s],this.$data=e.$data&&t.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,Ut.schemaRefOrVal)(t,this.schema,s,this.$data),this.schemaType=e.schemaType,this.parentSchema=t.schema,this.params={},this.it=t,this.def=e,this.$data)this.schemaCode=t.gen.const("vSchema",ae(this.$data,t));else if(this.schemaCode=this.schemaValue,!(0,Nt.validSchemaType)(this.schema,e.schemaType,e.allowUndefined))throw new Error(`${s} value must be ${JSON.stringify(e.schemaType)}`);("code"in e?e.trackErrors:!1!==e.errors)&&(this.errsCount=t.gen.const("_errs",Vt.default.errors))}result(t,e,s){this.failResult((0,Lt.not)(t),e,s)}failResult(t,e,s){this.gen.if(t),s?s():this.error(),e?(this.gen.else(),e(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(t,e){this.failResult((0,Lt.not)(t),void 0,e)}fail(t){if(void 0===t)return this.error(),void(this.allErrors||this.gen.if(!1));this.gen.if(t),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(t){if(!this.$data)return this.fail(t);const{schemaCode:e}=this;this.fail(Lt._`${e} !== undefined && (${(0,Lt.or)(this.invalid$data(),t)})`)}error(t,e,s){if(e)return this.setParams(e),this._error(t,s),void this.setParams({});this._error(t,s)}_error(t,e){(t?Xt.reportExtraError:Xt.reportError)(this,this.def.error,e)}$dataError(){(0,Xt.reportError)(this,this.def.$dataError||Xt.keyword$DataError)}reset(){if(void 0===this.errsCount)throw new Error('add "trackErrors" to keyword definition');(0,Xt.resetErrorsCount)(this.gen,this.errsCount)}ok(t){this.allErrors||this.gen.if(t)}setParams(t,e){e?Object.assign(this.params,t):this.params=t}block$data(t,e,s=Lt.nil){this.gen.block((()=>{this.check$data(t,s),e()}))}check$data(t=Lt.nil,e=Lt.nil){if(!this.$data)return;const{gen:s,schemaCode:n,schemaType:i,def:r}=this;s.if((0,Lt.or)(Lt._`${n} === undefined`,e)),t!==Lt.nil&&s.assign(t,!0),(i.length||r.validateSchema)&&(s.elseIf(this.invalid$data()),this.$dataError(),t!==Lt.nil&&s.assign(t,!1)),s.else()}invalid$data(){const{gen:t,schemaCode:e,schemaType:s,def:n,it:i}=this;return(0,Lt.or)(function(){if(s.length){if(!(e instanceof Lt.Name))throw new Error("ajv implementation error");const t=Array.isArray(s)?s:[s];return Lt._`${(0,Ft.checkDataTypes)(t,e,i.opts.strictNumbers,Ft.DataType.Wrong)}`}return Lt.nil}(),function(){if(n.validateSchema){const s=t.scopeValue("validate$data",{ref:n.validateSchema});return Lt._`!${s}(${e})`}return Lt.nil}())}subschema(t,e){const s=(0,Bt.getSubschema)(this.it,t);(0,Bt.extendSubschemaData)(s,this.it,t),(0,Bt.extendSubschemaMode)(s,t);const n=c(l(l({},this.it),s),{items:void 0,props:void 0});return jt(n,e),n}mergeEvaluated(t,e){const{it:s,gen:n}=this;s.opts.unevaluated&&(!0!==s.props&&void 0!==t.props&&(s.props=Ut.mergeEvaluated.props(n,t.props,s.props,e)),!0!==s.items&&void 0!==t.items&&(s.items=Ut.mergeEvaluated.items(n,t.items,s.items,e)))}mergeValidEvaluated(t,e){const{it:s,gen:n}=this;if(s.opts.unevaluated&&(!0!==s.props||!0!==s.items))return n.if(e,(()=>this.mergeEvaluated(t,Lt.Name))),!0}}function ne(t,e,s,n){const i=new se(t,s,e);"code"in s?s.code(i,n):i.$data&&s.validate?(0,Nt.funcKeywordCode)(i,s):"macro"in s?(0,Nt.macroKeywordCode)(i,s):(s.compile||s.validate)&&(0,Nt.funcKeywordCode)(i,s)}E.KeywordCxt=se;const ie=/^\/(?:[^~]|~0|~1)*$/,re=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function ae(t,{dataLevel:e,dataNames:s,dataPathArr:n}){let i,r;if(""===t)return Vt.default.rootData;if("/"===t[0]){if(!ie.test(t))throw new Error(`Invalid JSON-pointer: ${t}`);i=t,r=Vt.default.rootData}else{const a=re.exec(t);if(!a)throw new Error(`Invalid JSON-pointer: ${t}`);const o=+a[1];if(i=a[2],"#"===i){if(o>=e)throw new Error(h("property/index",o));return n[e-o]}if(o>e)throw new Error(h("data",o));if(r=s[e-o],!i)return r}let a=r;const o=i.split("/");for(const l of o)l&&(r=Lt._`${r}${(0,Lt.getProperty)((0,Ut.unescapeJsonPointer)(l))}`,a=Lt._`${a} && ${r}`);return a;function h(t,s){return`Cannot access ${t} ${s} levels up, current level is ${e}`}}E.getData=ae;var oe={};Object.defineProperty(oe,"__esModule",{value:!0});class he extends Error{constructor(t){super("validation failed"),this.errors=t,this.ajv=this.validation=!0}}oe.default=he;var le={};Object.defineProperty(le,"__esModule",{value:!0});const ce=pt;class ue extends Error{constructor(t,e,s,n){super(n||`can't resolve reference ${s} from id ${e}`),this.missingRef=(0,ce.resolveUrl)(t,e,s),this.missingSchema=(0,ce.normalizeId)((0,ce.getFullPath)(t,this.missingRef))}}le.default=ue;var de={};Object.defineProperty(de,"__esModule",{value:!0}),de.resolveSchema=de.getCompilingSchema=de.resolveRef=de.compileSchema=de.SchemaEnv=void 0;const fe=A,pe=oe,me=P,ge=pt,ye=I,ve=E;class xe{constructor(t){var e;let s;this.refs={},this.dynamicAnchors={},"object"==typeof t.schema&&(s=t.schema),this.schema=t.schema,this.schemaId=t.schemaId,this.root=t.root||this,this.baseId=null!==(e=t.baseId)&&void 0!==e?e:(0,ge.normalizeId)(null==s?void 0:s[t.schemaId||"$id"]),this.schemaPath=t.schemaPath,this.localRefs=t.localRefs,this.meta=t.meta,this.$async=null==s?void 0:s.$async,this.refs={}}}function _e(t){const e=we.call(this,t);if(e)return e;const s=(0,ge.getFullPath)(this.opts.uriResolver,t.root.baseId),{es5:n,lines:i}=this.opts.code,{ownProperties:r}=this.opts,a=new fe.CodeGen(this.scope,{es5:n,lines:i,ownProperties:r});let o;t.$async&&(o=a.scopeValue("Error",{ref:pe.default,code:fe._`require("ajv/dist/runtime/validation_error").default`}));const h=a.scopeName("validate");t.validateName=h;const l={gen:a,allErrors:this.opts.allErrors,data:me.default.data,parentData:me.default.parentData,parentDataProperty:me.default.parentDataProperty,dataNames:[me.default.data],dataPathArr:[fe.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:a.scopeValue("schema",!0===this.opts.code.source?{ref:t.schema,code:(0,fe.stringify)(t.schema)}:{ref:t.schema}),validateName:h,ValidationError:o,schema:t.schema,schemaEnv:t,rootId:s,baseId:t.baseId||s,schemaPath:fe.nil,errSchemaPath:t.schemaPath||(this.opts.jtd?"":"#"),errorPath:fe._`""`,opts:this.opts,self:this};let c;try{this._compilations.add(t),(0,ve.validateFunctionCode)(l),a.optimize(this.opts.code.optimize);const e=a.toString();c=`${a.scopeRefs(me.default.scope)}return ${e}`,this.opts.code.process&&(c=this.opts.code.process(c,t));const s=new Function(`${me.default.self}`,`${me.default.scope}`,c)(this,this.scope.get());if(this.scope.value(h,{ref:s}),s.errors=null,s.schema=t.schema,s.schemaEnv=t,t.$async&&(s.$async=!0),!0===this.opts.code.source&&(s.source={validateName:h,validateCode:e,scopeValues:a._values}),this.opts.unevaluated){const{props:t,items:e}=l;s.evaluated={props:t instanceof fe.Name?void 0:t,items:e instanceof fe.Name?void 0:e,dynamicProps:t instanceof fe.Name,dynamicItems:e instanceof fe.Name},s.source&&(s.source.evaluated=(0,fe.stringify)(s.evaluated))}return t.validate=s,t}catch(jp){throw delete t.validate,delete t.validateName,c&&this.logger.error("Error compiling schema, function code:",c),jp}finally{this._compilations.delete(t)}}function be(t){return(0,ge.inlineRef)(t.schema,this.opts.inlineRefs)?t.schema:t.validate?t:_e.call(this,t)}function we(t){for(const n of this._compilations)if(s=t,(e=n).schema===s.schema&&e.root===s.root&&e.baseId===s.baseId)return n;var e,s}function Ee(t,e){let s;for(;"string"==typeof(s=this.refs[e]);)e=s;return s||this.schemas[e]||Se.call(this,t,e)}function Se(t,e){const s=this.opts.uriResolver.parse(e),n=(0,ge._getFullPath)(this.opts.uriResolver,s);let i=(0,ge.getFullPath)(this.opts.uriResolver,t.baseId,void 0);if(Object.keys(t.schema).length>0&&n===i)return Ae.call(this,s,t);const r=(0,ge.normalizeId)(n),a=this.refs[r]||this.schemas[r];if("string"==typeof a){const e=Se.call(this,t,a);if("object"!=typeof(null==e?void 0:e.schema))return;return Ae.call(this,s,e)}if("object"==typeof(null==a?void 0:a.schema)){if(a.validate||_e.call(this,a),r===(0,ge.normalizeId)(e)){const{schema:e}=a,{schemaId:s}=this.opts,n=e[s];return n&&(i=(0,ge.resolveUrl)(this.opts.uriResolver,i,n)),new xe({schema:e,schemaId:s,root:t,baseId:i})}return Ae.call(this,s,a)}}de.SchemaEnv=xe,de.compileSchema=_e,de.resolveRef=function(t,e,s){var n;s=(0,ge.resolveUrl)(this.opts.uriResolver,e,s);const i=t.refs[s];if(i)return i;let r=Ee.call(this,t,s);if(void 0===r){const i=null===(n=t.localRefs)||void 0===n?void 0:n[s],{schemaId:a}=this.opts;i&&(r=new xe({schema:i,schemaId:a,root:t,baseId:e}))}return void 0!==r?t.refs[s]=be.call(this,r):void 0},de.getCompilingSchema=we,de.resolveSchema=Se;const Te=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function Ae(t,{baseId:e,schema:s,root:n}){var i;if("/"!==(null===(i=t.fragment)||void 0===i?void 0:i[0]))return;for(const o of t.fragment.slice(1).split("/")){if("boolean"==typeof s)return;const t=s[(0,ye.unescapeFragment)(o)];if(void 0===t)return;const n="object"==typeof(s=t)&&s[this.opts.schemaId];!Te.has(o)&&n&&(e=(0,ge.resolveUrl)(this.opts.uriResolver,e,n))}let r;if("boolean"!=typeof s&&s.$ref&&!(0,ye.schemaHasRulesButRef)(s,this.RULES)){const t=(0,ge.resolveUrl)(this.opts.uriResolver,e,s.$ref);r=Se.call(this,n,t)}const{schemaId:a}=this.opts;return r=r||new xe({schema:s,schemaId:a,root:n,baseId:e}),r.schema!==r.root.schema?r:void 0}const Ce={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1};var Me={},Ie={};!function(t){function e(){for(var t=arguments.length,e=Array(t),s=0;s<t;s++)e[s]=arguments[s];if(e.length>1){e[0]=e[0].slice(0,-1);for(var n=e.length-1,i=1;i<n;++i)e[i]=e[i].slice(1,-1);return e[n]=e[n].slice(1),e.join("")}return e[0]}function s(t){return"(?:"+t+")"}function n(t){return void 0===t?"undefined":null===t?"null":Object.prototype.toString.call(t).split(" ").pop().split("]").shift().toLowerCase()}function i(t){return t.toUpperCase()}function r(t){return null!=t?t instanceof Array?t:"number"!=typeof t.length||t.split||t.setInterval||t.call?[t]:Array.prototype.slice.call(t):[]}function a(t,e){var s=t;if(e)for(var n in e)s[n]=e[n];return s}function o(t){var n="[A-Za-z]",i="[0-9]",r=e(i,"[A-Fa-f]"),a=s(s("%[EFef]"+r+"%"+r+r+"%"+r+r)+"|"+s("%[89A-Fa-f]"+r+"%"+r+r)+"|"+s("%"+r+r)),o="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",h=e("[\\:\\/\\?\\#\\[\\]\\@]",o),l=t?"[\\uE000-\\uF8FF]":"[]",c=e(n,i,"[\\-\\.\\_\\~]",t?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]");s(n+e(n,i,"[\\+\\-\\.]")+"*"),s(s(a+"|"+e(c,o,"[\\:]"))+"*");var u=s(s("25[0-5]")+"|"+s("2[0-4]"+i)+"|"+s("1"+i+i)+"|"+s("0?[1-9]"+i)+"|0?0?"+i),d=s(u+"\\."+u+"\\."+u+"\\."+u),f=s(r+"{1,4}"),p=s(s(f+"\\:"+f)+"|"+d),m=s(s(f+"\\:")+"{6}"+p),g=s("\\:\\:"+s(f+"\\:")+"{5}"+p),y=s(s(f)+"?\\:\\:"+s(f+"\\:")+"{4}"+p),v=s(s(s(f+"\\:")+"{0,1}"+f)+"?\\:\\:"+s(f+"\\:")+"{3}"+p),x=s(s(s(f+"\\:")+"{0,2}"+f)+"?\\:\\:"+s(f+"\\:")+"{2}"+p),_=s(s(s(f+"\\:")+"{0,3}"+f)+"?\\:\\:"+f+"\\:"+p),b=s(s(s(f+"\\:")+"{0,4}"+f)+"?\\:\\:"+p),w=s(s(s(f+"\\:")+"{0,5}"+f)+"?\\:\\:"+f),E=s(s(s(f+"\\:")+"{0,6}"+f)+"?\\:\\:"),S=s([m,g,y,v,x,_,b,w,E].join("|")),T=s(s(c+"|"+a)+"+");s("[vV]"+r+"+\\."+e(c,o,"[\\:]")+"+"),s(s(a+"|"+e(c,o))+"*");var A=s(a+"|"+e(c,o,"[\\:\\@]"));return s(s(a+"|"+e(c,o,"[\\@]"))+"+"),s(s(A+"|"+e("[\\/\\?]",l))+"*"),{NOT_SCHEME:new RegExp(e("[^]",n,i,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(e("[^\\%\\:]",c,o),"g"),NOT_HOST:new RegExp(e("[^\\%\\[\\]\\:]",c,o),"g"),NOT_PATH:new RegExp(e("[^\\%\\/\\:\\@]",c,o),"g"),NOT_PATH_NOSCHEME:new RegExp(e("[^\\%\\/\\@]",c,o),"g"),NOT_QUERY:new RegExp(e("[^\\%]",c,o,"[\\:\\@\\/\\?]",l),"g"),NOT_FRAGMENT:new RegExp(e("[^\\%]",c,o,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(e("[^]",c,o),"g"),UNRESERVED:new RegExp(c,"g"),OTHER_CHARS:new RegExp(e("[^\\%]",c,h),"g"),PCT_ENCODED:new RegExp(a,"g"),IPV4ADDRESS:new RegExp("^("+d+")$"),IPV6ADDRESS:new RegExp("^\\[?("+S+")"+s(s("\\%25|\\%(?!"+r+"{2})")+"("+T+")")+"?\\]?$")}}var h=o(!1),l=o(!0),c=function(){function t(t,e){var s=[],n=!0,i=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done)&&(s.push(a.value),!e||s.length!==e);n=!0);}catch(h){i=!0,r=h}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}return s}return function(e,s){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,s);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(t){if(Array.isArray(t)){for(var e=0,s=Array(t.length);e<t.length;e++)s[e]=t[e];return s}return Array.from(t)},d=2147483647,f=36,p=1,m=26,g=38,y=700,v=72,x=128,_="-",b=/^xn--/,w=/[^\0-\x7E]/,E=/[\x2E\u3002\uFF0E\uFF61]/g,S={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},T=f-p,A=Math.floor,C=String.fromCharCode;function M(t){throw new RangeError(S[t])}function I(t,e){for(var s=[],n=t.length;n--;)s[n]=e(t[n]);return s}function P(t,e){var s=t.split("@"),n="";return s.length>1&&(n=s[0]+"@",t=s[1]),n+I((t=t.replace(E,".")).split("."),e).join(".")}function R(t){for(var e=[],s=0,n=t.length;s<n;){var i=t.charCodeAt(s++);if(i>=55296&&i<=56319&&s<n){var r=t.charCodeAt(s++);56320==(64512&r)?e.push(((1023&i)<<10)+(1023&r)+65536):(e.push(i),s--)}else e.push(i)}return e}var k=function(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:f},D=function(t,e){return t+22+75*(t<26)-((0!=e)<<5)},F=function(t,e,s){var n=0;for(t=s?A(t/y):t>>1,t+=A(t/e);t>T*m>>1;n+=f)t=A(t/T);return A(n+(T+1)*t/(t+g))},O=function(t){var e=[],s=t.length,n=0,i=x,r=v,a=t.lastIndexOf(_);a<0&&(a=0);for(var o=0;o<a;++o)t.charCodeAt(o)>=128&&M("not-basic"),e.push(t.charCodeAt(o));for(var h=a>0?a+1:0;h<s;){for(var l=n,c=1,u=f;;u+=f){h>=s&&M("invalid-input");var g=k(t.charCodeAt(h++));(g>=f||g>A((d-n)/c))&&M("overflow"),n+=g*c;var y=u<=r?p:u>=r+m?m:u-r;if(g<y)break;var b=f-y;c>A(d/b)&&M("overflow"),c*=b}var w=e.length+1;r=F(n-l,w,0==l),A(n/w)>d-i&&M("overflow"),i+=A(n/w),n%=w,e.splice(n++,0,i)}return String.fromCodePoint.apply(String,e)},N=function(t){var e=[],s=(t=R(t)).length,n=x,i=0,r=v,a=!0,o=!1,h=void 0;try{for(var l,c=t[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=l.value;u<128&&e.push(C(u))}}catch(z){o=!0,h=z}finally{try{!a&&c.return&&c.return()}finally{if(o)throw h}}var g=e.length,y=g;for(g&&e.push(_);y<s;){var b=d,w=!0,E=!1,S=void 0;try{for(var T,I=t[Symbol.iterator]();!(w=(T=I.next()).done);w=!0){var P=T.value;P>=n&&P<b&&(b=P)}}catch(z){E=!0,S=z}finally{try{!w&&I.return&&I.return()}finally{if(E)throw S}}var k=y+1;b-n>A((d-i)/k)&&M("overflow"),i+=(b-n)*k,n=b;var O=!0,N=!1,B=void 0;try{for(var L,V=t[Symbol.iterator]();!(O=(L=V.next()).done);O=!0){var $=L.value;if($<n&&++i>d&&M("overflow"),$==n){for(var U=i,X=f;;X+=f){var Y=X<=r?p:X>=r+m?m:X-r;if(U<Y)break;var W=U-Y,j=f-Y;e.push(C(D(Y+W%j,0))),U=A(W/j)}e.push(C(D(U,0))),r=F(i,k,y==g),i=0,++y}}}catch(z){N=!0,B=z}finally{try{!O&&V.return&&V.return()}finally{if(N)throw B}}++i,++n}return e.join("")},B=function(t){return P(t,(function(t){return b.test(t)?O(t.slice(4).toLowerCase()):t}))},L=function(t){return P(t,(function(t){return w.test(t)?"xn--"+N(t):t}))},V={version:"2.1.0",ucs2:{decode:R,encode:function(t){return String.fromCodePoint.apply(String,u(t))}},decode:O,encode:N,toASCII:L,toUnicode:B},$={};function U(t){var e=t.charCodeAt(0);return e<16?"%0"+e.toString(16).toUpperCase():e<128?"%"+e.toString(16).toUpperCase():e<2048?"%"+(e>>6|192).toString(16).toUpperCase()+"%"+(63&e|128).toString(16).toUpperCase():"%"+(e>>12|224).toString(16).toUpperCase()+"%"+(e>>6&63|128).toString(16).toUpperCase()+"%"+(63&e|128).toString(16).toUpperCase()}function X(t){for(var e="",s=0,n=t.length;s<n;){var i=parseInt(t.substr(s+1,2),16);if(i<128)e+=String.fromCharCode(i),s+=3;else if(i>=194&&i<224){if(n-s>=6){var r=parseInt(t.substr(s+4,2),16);e+=String.fromCharCode((31&i)<<6|63&r)}else e+=t.substr(s,6);s+=6}else if(i>=224){if(n-s>=9){var a=parseInt(t.substr(s+4,2),16),o=parseInt(t.substr(s+7,2),16);e+=String.fromCharCode((15&i)<<12|(63&a)<<6|63&o)}else e+=t.substr(s,9);s+=9}else e+=t.substr(s,3),s+=3}return e}function Y(t,e){function s(t){var s=X(t);return s.match(e.UNRESERVED)?s:t}return t.scheme&&(t.scheme=String(t.scheme).replace(e.PCT_ENCODED,s).toLowerCase().replace(e.NOT_SCHEME,"")),void 0!==t.userinfo&&(t.userinfo=String(t.userinfo).replace(e.PCT_ENCODED,s).replace(e.NOT_USERINFO,U).replace(e.PCT_ENCODED,i)),void 0!==t.host&&(t.host=String(t.host).replace(e.PCT_ENCODED,s).toLowerCase().replace(e.NOT_HOST,U).replace(e.PCT_ENCODED,i)),void 0!==t.path&&(t.path=String(t.path).replace(e.PCT_ENCODED,s).replace(t.scheme?e.NOT_PATH:e.NOT_PATH_NOSCHEME,U).replace(e.PCT_ENCODED,i)),void 0!==t.query&&(t.query=String(t.query).replace(e.PCT_ENCODED,s).replace(e.NOT_QUERY,U).replace(e.PCT_ENCODED,i)),void 0!==t.fragment&&(t.fragment=String(t.fragment).replace(e.PCT_ENCODED,s).replace(e.NOT_FRAGMENT,U).replace(e.PCT_ENCODED,i)),t}function W(t){return t.replace(/^0*(.*)/,"$1")||"0"}function j(t,e){var s=t.match(e.IPV4ADDRESS)||[],n=c(s,2)[1];return n?n.split(".").map(W).join("."):t}function z(t,e){var s=t.match(e.IPV6ADDRESS)||[],n=c(s,3),i=n[1],r=n[2];if(i){for(var a=i.toLowerCase().split("::").reverse(),o=c(a,2),h=o[0],l=o[1],u=l?l.split(":").map(W):[],d=h.split(":").map(W),f=e.IPV4ADDRESS.test(d[d.length-1]),p=f?7:8,m=d.length-p,g=Array(p),y=0;y<p;++y)g[y]=u[y]||d[m+y]||"";f&&(g[p-1]=j(g[p-1],e));var v=g.reduce((function(t,e,s){if(!e||"0"===e){var n=t[t.length-1];n&&n.index+n.length===s?n.length++:t.push({index:s,length:1})}return t}),[]).sort((function(t,e){return e.length-t.length}))[0],x=void 0;if(v&&v.length>1){var _=g.slice(0,v.index),b=g.slice(v.index+v.length);x=_.join(":")+"::"+b.join(":")}else x=g.join(":");return r&&(x+="%"+r),x}return t}var G=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,H=void 0==="".match(/(){0}/)[1];function q(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s={},n=!1!==e.iri?l:h;"suffix"===e.reference&&(t=(e.scheme?e.scheme+":":"")+"//"+t);var i=t.match(G);if(i){H?(s.scheme=i[1],s.userinfo=i[3],s.host=i[4],s.port=parseInt(i[5],10),s.path=i[6]||"",s.query=i[7],s.fragment=i[8],isNaN(s.port)&&(s.port=i[5])):(s.scheme=i[1]||void 0,s.userinfo=-1!==t.indexOf("@")?i[3]:void 0,s.host=-1!==t.indexOf("//")?i[4]:void 0,s.port=parseInt(i[5],10),s.path=i[6]||"",s.query=-1!==t.indexOf("?")?i[7]:void 0,s.fragment=-1!==t.indexOf("#")?i[8]:void 0,isNaN(s.port)&&(s.port=t.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?i[4]:void 0)),s.host&&(s.host=z(j(s.host,n),n)),void 0!==s.scheme||void 0!==s.userinfo||void 0!==s.host||void 0!==s.port||s.path||void 0!==s.query?void 0===s.scheme?s.reference="relative":void 0===s.fragment?s.reference="absolute":s.reference="uri":s.reference="same-document",e.reference&&"suffix"!==e.reference&&e.reference!==s.reference&&(s.error=s.error||"URI is not a "+e.reference+" reference.");var r=$[(e.scheme||s.scheme||"").toLowerCase()];if(e.unicodeSupport||r&&r.unicodeSupport)Y(s,n);else{if(s.host&&(e.domainHost||r&&r.domainHost))try{s.host=V.toASCII(s.host.replace(n.PCT_ENCODED,X).toLowerCase())}catch(jp){s.error=s.error||"Host's domain name can not be converted to ASCII via punycode: "+jp}Y(s,h)}r&&r.parse&&r.parse(s,e)}else s.error=s.error||"URI can not be parsed.";return s}function K(t,e){var s=!1!==e.iri?l:h,n=[];return void 0!==t.userinfo&&(n.push(t.userinfo),n.push("@")),void 0!==t.host&&n.push(z(j(String(t.host),s),s).replace(s.IPV6ADDRESS,(function(t,e,s){return"["+e+(s?"%25"+s:"")+"]"}))),"number"!=typeof t.port&&"string"!=typeof t.port||(n.push(":"),n.push(String(t.port))),n.length?n.join(""):void 0}var Z=/^\.\.?\//,Q=/^\/\.(\/|$)/,J=/^\/\.\.(\/|$)/,tt=/^\/?(?:.|\n)*?(?=\/|$)/;function et(t){for(var e=[];t.length;)if(t.match(Z))t=t.replace(Z,"");else if(t.match(Q))t=t.replace(Q,"/");else if(t.match(J))t=t.replace(J,"/"),e.pop();else if("."===t||".."===t)t="";else{var s=t.match(tt);if(!s)throw new Error("Unexpected dot segment condition");var n=s[0];t=t.slice(n.length),e.push(n)}return e.join("")}function st(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=e.iri?l:h,n=[],i=$[(e.scheme||t.scheme||"").toLowerCase()];if(i&&i.serialize&&i.serialize(t,e),t.host)if(s.IPV6ADDRESS.test(t.host));else if(e.domainHost||i&&i.domainHost)try{t.host=e.iri?V.toUnicode(t.host):V.toASCII(t.host.replace(s.PCT_ENCODED,X).toLowerCase())}catch(jp){t.error=t.error||"Host's domain name can not be converted to "+(e.iri?"Unicode":"ASCII")+" via punycode: "+jp}Y(t,s),"suffix"!==e.reference&&t.scheme&&(n.push(t.scheme),n.push(":"));var r=K(t,e);if(void 0!==r&&("suffix"!==e.reference&&n.push("//"),n.push(r),t.path&&"/"!==t.path.charAt(0)&&n.push("/")),void 0!==t.path){var a=t.path;e.absolutePath||i&&i.absolutePath||(a=et(a)),void 0===r&&(a=a.replace(/^\/\//,"/%2F")),n.push(a)}return void 0!==t.query&&(n.push("?"),n.push(t.query)),void 0!==t.fragment&&(n.push("#"),n.push(t.fragment)),n.join("")}function nt(t,e){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n={};return arguments[3]||(t=q(st(t,s),s),e=q(st(e,s),s)),!(s=s||{}).tolerant&&e.scheme?(n.scheme=e.scheme,n.userinfo=e.userinfo,n.host=e.host,n.port=e.port,n.path=et(e.path||""),n.query=e.query):(void 0!==e.userinfo||void 0!==e.host||void 0!==e.port?(n.userinfo=e.userinfo,n.host=e.host,n.port=e.port,n.path=et(e.path||""),n.query=e.query):(e.path?("/"===e.path.charAt(0)?n.path=et(e.path):(void 0===t.userinfo&&void 0===t.host&&void 0===t.port||t.path?t.path?n.path=t.path.slice(0,t.path.lastIndexOf("/")+1)+e.path:n.path=e.path:n.path="/"+e.path,n.path=et(n.path)),n.query=e.query):(n.path=t.path,void 0!==e.query?n.query=e.query:n.query=t.query),n.userinfo=t.userinfo,n.host=t.host,n.port=t.port),n.scheme=t.scheme),n.fragment=e.fragment,n}function it(t,e,s){var n=a({scheme:"null"},s);return st(nt(q(t,n),q(e,n),n,!0),n)}function rt(t,e){return"string"==typeof t?t=st(q(t,e),e):"object"===n(t)&&(t=q(st(t,e),e)),t}function at(t,e,s){return"string"==typeof t?t=st(q(t,s),s):"object"===n(t)&&(t=st(t,s)),"string"==typeof e?e=st(q(e,s),s):"object"===n(e)&&(e=st(e,s)),t===e}function ot(t,e){return t&&t.toString().replace(e&&e.iri?l.ESCAPE:h.ESCAPE,U)}function ht(t,e){return t&&t.toString().replace(e&&e.iri?l.PCT_ENCODED:h.PCT_ENCODED,X)}var lt={scheme:"http",domainHost:!0,parse:function(t,e){return t.host||(t.error=t.error||"HTTP URIs must have a host."),t},serialize:function(t,e){var s="https"===String(t.scheme).toLowerCase();return t.port!==(s?443:80)&&""!==t.port||(t.port=void 0),t.path||(t.path="/"),t}},ct={scheme:"https",domainHost:lt.domainHost,parse:lt.parse,serialize:lt.serialize};function ut(t){return"boolean"==typeof t.secure?t.secure:"wss"===String(t.scheme).toLowerCase()}var dt={scheme:"ws",domainHost:!0,parse:function(t,e){var s=t;return s.secure=ut(s),s.resourceName=(s.path||"/")+(s.query?"?"+s.query:""),s.path=void 0,s.query=void 0,s},serialize:function(t,e){if(t.port!==(ut(t)?443:80)&&""!==t.port||(t.port=void 0),"boolean"==typeof t.secure&&(t.scheme=t.secure?"wss":"ws",t.secure=void 0),t.resourceName){var s=t.resourceName.split("?"),n=c(s,2),i=n[0],r=n[1];t.path=i&&"/"!==i?i:void 0,t.query=r,t.resourceName=void 0}return t.fragment=void 0,t}},ft={scheme:"wss",domainHost:dt.domainHost,parse:dt.parse,serialize:dt.serialize},pt={},mt="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",gt="[0-9A-Fa-f]",yt=s(s("%[EFef]"+gt+"%"+gt+gt+"%"+gt+gt)+"|"+s("%[89A-Fa-f]"+gt+"%"+gt+gt)+"|"+s("%"+gt+gt)),vt="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",xt=e("[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",'[\\"\\\\]'),_t="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",bt=new RegExp(mt,"g"),wt=new RegExp(yt,"g"),Et=new RegExp(e("[^]",vt,"[\\.]",'[\\"]',xt),"g"),St=new RegExp(e("[^]",mt,_t),"g"),Tt=St;function At(t){var e=X(t);return e.match(bt)?e:t}var Ct={scheme:"mailto",parse:function(t,e){var s=t,n=s.to=s.path?s.path.split(","):[];if(s.path=void 0,s.query){for(var i=!1,r={},a=s.query.split("&"),o=0,h=a.length;o<h;++o){var l=a[o].split("=");switch(l[0]){case"to":for(var c=l[1].split(","),u=0,d=c.length;u<d;++u)n.push(c[u]);break;case"subject":s.subject=ht(l[1],e);break;case"body":s.body=ht(l[1],e);break;default:i=!0,r[ht(l[0],e)]=ht(l[1],e)}}i&&(s.headers=r)}s.query=void 0;for(var f=0,p=n.length;f<p;++f){var m=n[f].split("@");if(m[0]=ht(m[0]),e.unicodeSupport)m[1]=ht(m[1],e).toLowerCase();else try{m[1]=V.toASCII(ht(m[1],e).toLowerCase())}catch(jp){s.error=s.error||"Email address's domain name can not be converted to ASCII via punycode: "+jp}n[f]=m.join("@")}return s},serialize:function(t,e){var s=t,n=r(t.to);if(n){for(var a=0,o=n.length;a<o;++a){var h=String(n[a]),l=h.lastIndexOf("@"),c=h.slice(0,l).replace(wt,At).replace(wt,i).replace(Et,U),u=h.slice(l+1);try{u=e.iri?V.toUnicode(u):V.toASCII(ht(u,e).toLowerCase())}catch(jp){s.error=s.error||"Email address's domain name can not be converted to "+(e.iri?"Unicode":"ASCII")+" via punycode: "+jp}n[a]=c+"@"+u}s.path=n.join(",")}var d=t.headers=t.headers||{};t.subject&&(d.subject=t.subject),t.body&&(d.body=t.body);var f=[];for(var p in d)d[p]!==pt[p]&&f.push(p.replace(wt,At).replace(wt,i).replace(St,U)+"="+d[p].replace(wt,At).replace(wt,i).replace(Tt,U));return f.length&&(s.query=f.join("&")),s}},Mt=/^([^\:]+)\:(.*)/,It={scheme:"urn",parse:function(t,e){var s=t.path&&t.path.match(Mt),n=t;if(s){var i=e.scheme||n.scheme||"urn",r=s[1].toLowerCase(),a=s[2],o=i+":"+(e.nid||r),h=$[o];n.nid=r,n.nss=a,n.path=void 0,h&&(n=h.parse(n,e))}else n.error=n.error||"URN can not be parsed.";return n},serialize:function(t,e){var s=e.scheme||t.scheme||"urn",n=t.nid,i=s+":"+(e.nid||n),r=$[i];r&&(t=r.serialize(t,e));var a=t,o=t.nss;return a.path=(n||e.nid)+":"+o,a}},Pt=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,Rt={scheme:"urn:uuid",parse:function(t,e){var s=t;return s.uuid=s.nss,s.nss=void 0,e.tolerant||s.uuid&&s.uuid.match(Pt)||(s.error=s.error||"UUID is not valid."),s},serialize:function(t,e){var s=t;return s.nss=(t.uuid||"").toLowerCase(),s}};$[lt.scheme]=lt,$[ct.scheme]=ct,$[dt.scheme]=dt,$[ft.scheme]=ft,$[Ct.scheme]=Ct,$[It.scheme]=It,$[Rt.scheme]=Rt,t.SCHEMES=$,t.pctEncChar=U,t.pctDecChars=X,t.parse=q,t.removeDotSegments=et,t.serialize=st,t.resolveComponents=nt,t.resolve=it,t.normalize=rt,t.equal=at,t.escapeComponent=ot,t.unescapeComponent=ht,Object.defineProperty(t,"__esModule",{value:!0})}(Ie),Object.defineProperty(Me,"__esModule",{value:!0});const Pe=Ie;Pe.code='require("ajv/dist/runtime/uri").default',Me.default=Pe,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.CodeGen=t.Name=t.nil=t.stringify=t.str=t._=t.KeywordCxt=void 0;var e=E;Object.defineProperty(t,"KeywordCxt",{enumerable:!0,get:function(){return e.KeywordCxt}});var s=A;Object.defineProperty(t,"_",{enumerable:!0,get:function(){return s._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return s.str}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return s.stringify}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return s.nil}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return s.Name}}),Object.defineProperty(t,"CodeGen",{enumerable:!0,get:function(){return s.CodeGen}});const n=oe,i=le,r=V,a=de,o=A,h=pt,u=L,d=I,p=Ce,m=Me,g=(t,e)=>new RegExp(t,e);g.code="new RegExp";const y=["removeAdditional","useDefaults","coerceTypes"],v=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),x={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},_={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},b=200;class w{constructor(t={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,t=this.opts=l(l({},t),function(t){var e,s,n,i,r,a,o,h,u,d,f,p,y,v,x,_,w,E,S,T,A,C,M,I,P;const R=t.strict,k=null===(e=t.code)||void 0===e?void 0:e.optimize,D=!0===k||void 0===k?1:k||0,F=null!==(n=null===(s=t.code)||void 0===s?void 0:s.regExp)&&void 0!==n?n:g,O=null!==(i=t.uriResolver)&&void 0!==i?i:m.default;return{strictSchema:null===(a=null!==(r=t.strictSchema)&&void 0!==r?r:R)||void 0===a||a,strictNumbers:null===(h=null!==(o=t.strictNumbers)&&void 0!==o?o:R)||void 0===h||h,strictTypes:null!==(d=null!==(u=t.strictTypes)&&void 0!==u?u:R)&&void 0!==d?d:"log",strictTuples:null!==(p=null!==(f=t.strictTuples)&&void 0!==f?f:R)&&void 0!==p?p:"log",strictRequired:null!==(v=null!==(y=t.strictRequired)&&void 0!==y?y:R)&&void 0!==v&&v,code:t.code?c(l({},t.code),{optimize:D,regExp:F}):{optimize:D,regExp:F},loopRequired:null!==(x=t.loopRequired)&&void 0!==x?x:b,loopEnum:null!==(_=t.loopEnum)&&void 0!==_?_:b,meta:null===(w=t.meta)||void 0===w||w,messages:null===(E=t.messages)||void 0===E||E,inlineRefs:null===(S=t.inlineRefs)||void 0===S||S,schemaId:null!==(T=t.schemaId)&&void 0!==T?T:"$id",addUsedSchema:null===(A=t.addUsedSchema)||void 0===A||A,validateSchema:null===(C=t.validateSchema)||void 0===C||C,validateFormats:null===(M=t.validateFormats)||void 0===M||M,unicodeRegExp:null===(I=t.unicodeRegExp)||void 0===I||I,int32range:null===(P=t.int32range)||void 0===P||P,uriResolver:O}}(t));const{es5:e,lines:s}=this.opts.code;this.scope=new o.ValueScope({scope:{},prefixes:v,es5:e,lines:s}),this.logger=function(t){if(!1===t)return k;if(void 0===t)return console;if(t.log&&t.warn&&t.error)return t;throw new Error("logger must implement log, warn and error methods")}(t.logger);const n=t.validateFormats;t.validateFormats=!1,this.RULES=(0,r.getRules)(),S.call(this,x,t,"NOT SUPPORTED"),S.call(this,_,t,"DEPRECATED","warn"),this._metaOpts=R.call(this),t.formats&&M.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),t.keywords&&P.call(this,t.keywords),"object"==typeof t.meta&&this.addMetaSchema(t.meta),C.call(this),t.validateFormats=n}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:t,meta:e,schemaId:s}=this.opts;let n=p;"id"===s&&(n=l({},p),n.id=n.$id,delete n.$id),e&&t&&this.addMetaSchema(n,n[s],!1)}defaultMeta(){const{meta:t,schemaId:e}=this.opts;return this.opts.defaultMeta="object"==typeof t?t[e]||t:void 0}validate(t,e){let s;if("string"==typeof t){if(s=this.getSchema(t),!s)throw new Error(`no schema with key or ref "${t}"`)}else s=this.compile(t);const n=s(e);return"$async"in s||(this.errors=s.errors),n}compile(t,e){const s=this._addSchema(t,e);return s.validate||this._compileSchemaEnv(s)}compileAsync(t,e){if("function"!=typeof this.opts.loadSchema)throw new Error("options.loadSchema should be a function");const{loadSchema:s}=this.opts;return n.call(this,t,e);function n(t,e){return f(this,null,(function*(){yield r.call(this,t.$schema);const s=this._addSchema(t,e);return s.validate||a.call(this,s)}))}function r(t){return f(this,null,(function*(){t&&!this.getSchema(t)&&(yield n.call(this,{$ref:t},!0))}))}function a(t){return f(this,null,(function*(){try{return this._compileSchemaEnv(t)}catch(jp){if(!(jp instanceof i.default))throw jp;return o.call(this,jp),yield h.call(this,jp.missingSchema),a.call(this,t)}}))}function o({missingSchema:t,missingRef:e}){if(this.refs[t])throw new Error(`AnySchema ${t} is loaded but ${e} cannot be resolved`)}function h(t){return f(this,null,(function*(){const s=yield l.call(this,t);this.refs[t]||(yield r.call(this,s.$schema)),this.refs[t]||this.addSchema(s,t,e)}))}function l(t){return f(this,null,(function*(){const e=this._loading[t];if(e)return e;try{return yield this._loading[t]=s(t)}finally{delete this._loading[t]}}))}}addSchema(t,e,s,n=this.opts.validateSchema){if(Array.isArray(t)){for(const e of t)this.addSchema(e,void 0,s,n);return this}let i;if("object"==typeof t){const{schemaId:e}=this.opts;if(i=t[e],void 0!==i&&"string"!=typeof i)throw new Error(`schema ${e} must be string`)}return e=(0,h.normalizeId)(e||i),this._checkUnique(e),this.schemas[e]=this._addSchema(t,s,e,n,!0),this}addMetaSchema(t,e,s=this.opts.validateSchema){return this.addSchema(t,e,!0,s),this}validateSchema(t,e){if("boolean"==typeof t)return!0;let s;if(s=t.$schema,void 0!==s&&"string"!=typeof s)throw new Error("$schema must be a string");if(s=s||this.opts.defaultMeta||this.defaultMeta(),!s)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const n=this.validate(s,t);if(!n&&e){const t="schema is invalid: "+this.errorsText();if("log"!==this.opts.validateSchema)throw new Error(t);this.logger.error(t)}return n}getSchema(t){let e;for(;"string"==typeof(e=T.call(this,t));)t=e;if(void 0===e){const{schemaId:s}=this.opts,n=new a.SchemaEnv({schema:{},schemaId:s});if(e=a.resolveSchema.call(this,n,t),!e)return;this.refs[t]=e}return e.validate||this._compileSchemaEnv(e)}removeSchema(t){if(t instanceof RegExp)return this._removeAllSchemas(this.schemas,t),this._removeAllSchemas(this.refs,t),this;switch(typeof t){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const e=T.call(this,t);return"object"==typeof e&&this._cache.delete(e.schema),delete this.schemas[t],delete this.refs[t],this}case"object":{const e=t;this._cache.delete(e);let s=t[this.opts.schemaId];return s&&(s=(0,h.normalizeId)(s),delete this.schemas[s],delete this.refs[s]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(t){for(const e of t)this.addKeyword(e);return this}addKeyword(t,e){let s;if("string"==typeof t)s=t,"object"==typeof e&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),e.keyword=s);else{if("object"!=typeof t||void 0!==e)throw new Error("invalid addKeywords parameters");if(s=(e=t).keyword,Array.isArray(s)&&!s.length)throw new Error("addKeywords: keyword must be string or non-empty array")}if(F.call(this,s,e),!e)return(0,d.eachItem)(s,(t=>O.call(this,t))),this;B.call(this,e);const n=c(l({},e),{type:(0,u.getJSONTypes)(e.type),schemaType:(0,u.getJSONTypes)(e.schemaType)});return(0,d.eachItem)(s,0===n.type.length?t=>O.call(this,t,n):t=>n.type.forEach((e=>O.call(this,t,n,e)))),this}getKeyword(t){const e=this.RULES.all[t];return"object"==typeof e?e.definition:!!e}removeKeyword(t){const{RULES:e}=this;delete e.keywords[t],delete e.all[t];for(const s of e.rules){const e=s.rules.findIndex((e=>e.keyword===t));e>=0&&s.rules.splice(e,1)}return this}addFormat(t,e){return"string"==typeof e&&(e=new RegExp(e)),this.formats[t]=e,this}errorsText(t=this.errors,{separator:e=", ",dataVar:s="data"}={}){return t&&0!==t.length?t.map((t=>`${s}${t.instancePath} ${t.message}`)).reduce(((t,s)=>t+e+s)):"No errors"}$dataMetaSchema(t,e){const s=this.RULES.all;t=JSON.parse(JSON.stringify(t));for(const n of e){const e=n.split("/").slice(1);let i=t;for(const t of e)i=i[t];for(const t in s){const e=s[t];if("object"!=typeof e)continue;const{$data:n}=e.definition,r=i[t];n&&r&&(i[t]=U(r))}}return t}_removeAllSchemas(t,e){for(const s in t){const n=t[s];e&&!e.test(s)||("string"==typeof n?delete t[s]:n&&!n.meta&&(this._cache.delete(n.schema),delete t[s]))}}_addSchema(t,e,s,n=this.opts.validateSchema,i=this.opts.addUsedSchema){let r;const{schemaId:o}=this.opts;if("object"==typeof t)r=t[o];else{if(this.opts.jtd)throw new Error("schema must be object");if("boolean"!=typeof t)throw new Error("schema must be object or boolean")}let l=this._cache.get(t);if(void 0!==l)return l;s=(0,h.normalizeId)(r||s);const c=h.getSchemaRefs.call(this,t,s);return l=new a.SchemaEnv({schema:t,schemaId:o,meta:e,baseId:s,localRefs:c}),this._cache.set(l.schema,l),i&&!s.startsWith("#")&&(s&&this._checkUnique(s),this.refs[s]=l),n&&this.validateSchema(t,!0),l}_checkUnique(t){if(this.schemas[t]||this.refs[t])throw new Error(`schema with key or id "${t}" already exists`)}_compileSchemaEnv(t){if(t.meta?this._compileMetaSchema(t):a.compileSchema.call(this,t),!t.validate)throw new Error("ajv implementation error");return t.validate}_compileMetaSchema(t){const e=this.opts;this.opts=this._metaOpts;try{a.compileSchema.call(this,t)}finally{this.opts=e}}}function S(t,e,s,n="error"){for(const i in t){const r=i;r in e&&this.logger[n](`${s}: option ${i}. ${t[r]}`)}}function T(t){return t=(0,h.normalizeId)(t),this.schemas[t]||this.refs[t]}function C(){const t=this.opts.schemas;if(t)if(Array.isArray(t))this.addSchema(t);else for(const e in t)this.addSchema(t[e],e)}function M(){for(const t in this.opts.formats){const e=this.opts.formats[t];e&&this.addFormat(t,e)}}function P(t){if(Array.isArray(t))this.addVocabulary(t);else{this.logger.warn("keywords option as map is deprecated, pass array");for(const e in t){const s=t[e];s.keyword||(s.keyword=e),this.addKeyword(s)}}}function R(){const t=l({},this.opts);for(const e of y)delete t[e];return t}t.default=w,w.ValidationError=n.default,w.MissingRefError=i.default;const k={log(){},warn(){},error(){}};const D=/^[a-z_$][a-z0-9_$:-]*$/i;function F(t,e){const{RULES:s}=this;if((0,d.eachItem)(t,(t=>{if(s.keywords[t])throw new Error(`Keyword ${t} is already defined`);if(!D.test(t))throw new Error(`Keyword ${t} has invalid name`)})),e&&e.$data&&!("code"in e)&&!("validate"in e))throw new Error('$data keyword must have "code" or "validate" function')}function O(t,e,s){var n;const i=null==e?void 0:e.post;if(s&&i)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:r}=this;let a=i?r.post:r.rules.find((({type:t})=>t===s));if(a||(a={type:s,rules:[]},r.rules.push(a)),r.keywords[t]=!0,!e)return;const o={keyword:t,definition:c(l({},e),{type:(0,u.getJSONTypes)(e.type),schemaType:(0,u.getJSONTypes)(e.schemaType)})};e.before?N.call(this,a,o,e.before):a.rules.push(o),r.all[t]=o,null===(n=e.implements)||void 0===n||n.forEach((t=>this.addKeyword(t)))}function N(t,e,s){const n=t.rules.findIndex((t=>t.keyword===s));n>=0?t.rules.splice(n,0,e):(t.rules.push(e),this.logger.warn(`rule ${s} is not defined`))}function B(t){let{metaSchema:e}=t;void 0!==e&&(t.$data&&this.opts.$data&&(e=U(e)),t.validateSchema=this.compile(e,!0))}const $={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function U(t){return{anyOf:[t,$]}}}(w);var Re={},ke={},De={};Object.defineProperty(De,"__esModule",{value:!0});const Fe={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};De.default=Fe;var Oe={};Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.callRef=Oe.getValidate=void 0;const Ne=le,Be=q,Le=A,Ve=P,$e=de,Ue=I,Xe={keyword:"$ref",schemaType:"string",code(t){const{gen:e,schema:s,it:n}=t,{baseId:i,schemaEnv:r,validateName:a,opts:o,self:h}=n,{root:l}=r;if(("#"===s||"#/"===s)&&i===l.baseId)return function(){if(r===l)return We(t,a,r,r.$async);const s=e.scopeValue("root",{ref:l});return We(t,Le._`${s}.validate`,l,l.$async)}();const c=$e.resolveRef.call(h,l,i,s);if(void 0===c)throw new Ne.default(n.opts.uriResolver,i,s);return c instanceof $e.SchemaEnv?function(e){const s=Ye(t,e);We(t,s,e,e.$async)}(c):function(n){const i=e.scopeValue("schema",!0===o.code.source?{ref:n,code:(0,Le.stringify)(n)}:{ref:n}),r=e.name("valid"),a=t.subschema({schema:n,dataTypes:[],schemaPath:Le.nil,topSchemaRef:i,errSchemaPath:s},r);t.mergeEvaluated(a),t.ok(r)}(c)}};function Ye(t,e){const{gen:s}=t;return e.validate?s.scopeValue("validate",{ref:e.validate}):Le._`${s.scopeValue("wrapper",{ref:e})}.validate`}function We(t,e,s,n){const{gen:i,it:r}=t,{allErrors:a,schemaEnv:o,opts:h}=r,l=h.passContext?Ve.default.this:Le.nil;function c(t){const e=Le._`${t}.errors`;i.assign(Ve.default.vErrors,Le._`${Ve.default.vErrors} === null ? ${e} : ${Ve.default.vErrors}.concat(${e})`),i.assign(Ve.default.errors,Le._`${Ve.default.vErrors}.length`)}function u(t){var e;if(!r.opts.unevaluated)return;const n=null===(e=null==s?void 0:s.validate)||void 0===e?void 0:e.evaluated;if(!0!==r.props)if(n&&!n.dynamicProps)void 0!==n.props&&(r.props=Ue.mergeEvaluated.props(i,n.props,r.props));else{const e=i.var("props",Le._`${t}.evaluated.props`);r.props=Ue.mergeEvaluated.props(i,e,r.props,Le.Name)}if(!0!==r.items)if(n&&!n.dynamicItems)void 0!==n.items&&(r.items=Ue.mergeEvaluated.items(i,n.items,r.items));else{const e=i.var("items",Le._`${t}.evaluated.items`);r.items=Ue.mergeEvaluated.items(i,e,r.items,Le.Name)}}n?function(){if(!o.$async)throw new Error("async schema referenced by sync schema");const s=i.let("valid");i.try((()=>{i.code(Le._`await ${(0,Be.callValidateCode)(t,e,l)}`),u(e),a||i.assign(s,!0)}),(t=>{i.if(Le._`!(${t} instanceof ${r.ValidationError})`,(()=>i.throw(t))),c(t),a||i.assign(s,!1)})),t.ok(s)}():t.result((0,Be.callValidateCode)(t,e,l),(()=>u(e)),(()=>c(e)))}Oe.getValidate=Ye,Oe.callRef=We,Oe.default=Xe,Object.defineProperty(ke,"__esModule",{value:!0});const je=Oe,ze=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",De.default,je.default];ke.default=ze;var Ge={},He={};Object.defineProperty(He,"__esModule",{value:!0});const qe=A,Ke=qe.operators,Ze={maximum:{okStr:"<=",ok:Ke.LTE,fail:Ke.GT},minimum:{okStr:">=",ok:Ke.GTE,fail:Ke.LT},exclusiveMaximum:{okStr:"<",ok:Ke.LT,fail:Ke.GTE},exclusiveMinimum:{okStr:">",ok:Ke.GT,fail:Ke.LTE}},Qe={message:({keyword:t,schemaCode:e})=>qe.str`must be ${Ze[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>qe._`{comparison: ${Ze[t].okStr}, limit: ${e}}`},Je={keyword:Object.keys(Ze),type:"number",schemaType:"number",$data:!0,error:Qe,code(t){const{keyword:e,data:s,schemaCode:n}=t;t.fail$data(qe._`${s} ${Ze[e].fail} ${n} || isNaN(${s})`)}};He.default=Je;var ts={};Object.defineProperty(ts,"__esModule",{value:!0});const es=A,ss={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:{message:({schemaCode:t})=>es.str`must be multiple of ${t}`,params:({schemaCode:t})=>es._`{multipleOf: ${t}}`},code(t){const{gen:e,data:s,schemaCode:n,it:i}=t,r=i.opts.multipleOfPrecision,a=e.let("res"),o=r?es._`Math.abs(Math.round(${a}) - ${a}) > 1e-${r}`:es._`${a} !== parseInt(${a})`;t.fail$data(es._`(${n} === 0 || (${a} = ${s}/${n}, ${o}))`)}};ts.default=ss;var ns={},is={};function rs(t){const e=t.length;let s,n=0,i=0;for(;i<e;)n++,s=t.charCodeAt(i++),s>=55296&&s<=56319&&i<e&&(s=t.charCodeAt(i),56320==(64512&s)&&i++);return n}Object.defineProperty(is,"__esModule",{value:!0}),is.default=rs,rs.code='require("ajv/dist/runtime/ucs2length").default',Object.defineProperty(ns,"__esModule",{value:!0});const as=A,os=I,hs=is,ls={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:{message:({keyword:t,schemaCode:e})=>as.str`must NOT have ${"maxLength"===t?"more":"fewer"} than ${e} characters`,params:({schemaCode:t})=>as._`{limit: ${t}}`},code(t){const{keyword:e,data:s,schemaCode:n,it:i}=t,r="maxLength"===e?as.operators.GT:as.operators.LT,a=!1===i.opts.unicode?as._`${s}.length`:as._`${(0,os.useFunc)(t.gen,hs.default)}(${s})`;t.fail$data(as._`${a} ${r} ${n}`)}};ns.default=ls;var cs={};Object.defineProperty(cs,"__esModule",{value:!0});const us=q,ds=A,fs={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:{message:({schemaCode:t})=>ds.str`must match pattern "${t}"`,params:({schemaCode:t})=>ds._`{pattern: ${t}}`},code(t){const{data:e,$data:s,schema:n,schemaCode:i,it:r}=t,a=r.opts.unicodeRegExp?"u":"",o=s?ds._`(new RegExp(${i}, ${a}))`:(0,us.usePattern)(t,n);t.fail$data(ds._`!${o}.test(${e})`)}};cs.default=fs;var ps={};Object.defineProperty(ps,"__esModule",{value:!0});const ms=A,gs={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:{message:({keyword:t,schemaCode:e})=>ms.str`must NOT have ${"maxProperties"===t?"more":"fewer"} than ${e} properties`,params:({schemaCode:t})=>ms._`{limit: ${t}}`},code(t){const{keyword:e,data:s,schemaCode:n}=t,i="maxProperties"===e?ms.operators.GT:ms.operators.LT;t.fail$data(ms._`Object.keys(${s}).length ${i} ${n}`)}};ps.default=gs;var ys={};Object.defineProperty(ys,"__esModule",{value:!0});const vs=q,xs=A,_s=I,bs={keyword:"required",type:"object",schemaType:"array",$data:!0,error:{message:({params:{missingProperty:t}})=>xs.str`must have required property '${t}'`,params:({params:{missingProperty:t}})=>xs._`{missingProperty: ${t}}`},code(t){const{gen:e,schema:s,schemaCode:n,data:i,$data:r,it:a}=t,{opts:o}=a;if(!r&&0===s.length)return;const h=s.length>=o.loopRequired;if(a.allErrors?function(){if(h||r)t.block$data(xs.nil,l);else for(const e of s)(0,vs.checkReportMissingProp)(t,e)}():function(){const a=e.let("missing");if(h||r){const s=e.let("valid",!0);t.block$data(s,(()=>function(s,r){t.setParams({missingProperty:s}),e.forOf(s,n,(()=>{e.assign(r,(0,vs.propertyInData)(e,i,s,o.ownProperties)),e.if((0,xs.not)(r),(()=>{t.error(),e.break()}))}),xs.nil)}(a,s))),t.ok(s)}else e.if((0,vs.checkMissingProp)(t,s,a)),(0,vs.reportMissingProp)(t,a),e.else()}(),o.strictRequired){const e=t.parentSchema.properties,{definedProperties:n}=t.it;for(const t of s)if(void 0===(null==e?void 0:e[t])&&!n.has(t)){const e=a.schemaEnv.baseId+a.errSchemaPath;(0,_s.checkStrictMode)(a,`required property "${t}" is not defined at "${e}" (strictRequired)`,a.opts.strictRequired)}}function l(){e.forOf("prop",n,(s=>{t.setParams({missingProperty:s}),e.if((0,vs.noPropertyInData)(e,i,s,o.ownProperties),(()=>t.error()))}))}}};ys.default=bs;var ws={};Object.defineProperty(ws,"__esModule",{value:!0});const Es=A,Ss={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:{message:({keyword:t,schemaCode:e})=>Es.str`must NOT have ${"maxItems"===t?"more":"fewer"} than ${e} items`,params:({schemaCode:t})=>Es._`{limit: ${t}}`},code(t){const{keyword:e,data:s,schemaCode:n}=t,i="maxItems"===e?Es.operators.GT:Es.operators.LT;t.fail$data(Es._`${s}.length ${i} ${n}`)}};ws.default=Ss;var Ts={},As={};Object.defineProperty(As,"__esModule",{value:!0});const Cs=mt;Cs.code='require("ajv/dist/runtime/equal").default',As.default=Cs,Object.defineProperty(Ts,"__esModule",{value:!0});const Ms=L,Is=A,Ps=I,Rs=As,ks={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:{message:({params:{i:t,j:e}})=>Is.str`must NOT have duplicate items (items ## ${e} and ${t} are identical)`,params:({params:{i:t,j:e}})=>Is._`{i: ${t}, j: ${e}}`},code(t){const{gen:e,data:s,$data:n,schema:i,parentSchema:r,schemaCode:a,it:o}=t;if(!n&&!i)return;const h=e.let("valid"),l=r.items?(0,Ms.getSchemaTypes)(r.items):[];function c(n,i){const r=e.name("item"),a=(0,Ms.checkDataTypes)(l,r,o.opts.strictNumbers,Ms.DataType.Wrong),c=e.const("indices",Is._`{}`);e.for(Is._`;${n}--;`,(()=>{e.let(r,Is._`${s}[${n}]`),e.if(a,Is._`continue`),l.length>1&&e.if(Is._`typeof ${r} == "string"`,Is._`${r} += "_"`),e.if(Is._`typeof ${c}[${r}] == "number"`,(()=>{e.assign(i,Is._`${c}[${r}]`),t.error(),e.assign(h,!1).break()})).code(Is._`${c}[${r}] = ${n}`)}))}function u(n,i){const r=(0,Ps.useFunc)(e,Rs.default),a=e.name("outer");e.label(a).for(Is._`;${n}--;`,(()=>e.for(Is._`${i} = ${n}; ${i}--;`,(()=>e.if(Is._`${r}(${s}[${n}], ${s}[${i}])`,(()=>{t.error(),e.assign(h,!1).break(a)}))))))}t.block$data(h,(function(){const n=e.let("i",Is._`${s}.length`),i=e.let("j");t.setParams({i:n,j:i}),e.assign(h,!0),e.if(Is._`${n} > 1`,(()=>(l.length>0&&!l.some((t=>"object"===t||"array"===t))?c:u)(n,i)))}),Is._`${a} === false`),t.ok(h)}};Ts.default=ks;var Ds={};Object.defineProperty(Ds,"__esModule",{value:!0});const Fs=A,Os=I,Ns=As,Bs={keyword:"const",$data:!0,error:{message:"must be equal to constant",params:({schemaCode:t})=>Fs._`{allowedValue: ${t}}`},code(t){const{gen:e,data:s,$data:n,schemaCode:i,schema:r}=t;n||r&&"object"==typeof r?t.fail$data(Fs._`!${(0,Os.useFunc)(e,Ns.default)}(${s}, ${i})`):t.fail(Fs._`${r} !== ${s}`)}};Ds.default=Bs;var Ls={};Object.defineProperty(Ls,"__esModule",{value:!0});const Vs=A,$s=I,Us=As,Xs={keyword:"enum",schemaType:"array",$data:!0,error:{message:"must be equal to one of the allowed values",params:({schemaCode:t})=>Vs._`{allowedValues: ${t}}`},code(t){const{gen:e,data:s,$data:n,schema:i,schemaCode:r,it:a}=t;if(!n&&0===i.length)throw new Error("enum must have non-empty array");const o=i.length>=a.opts.loopEnum;let h;const l=()=>null!=h?h:h=(0,$s.useFunc)(e,Us.default);let c;if(o||n)c=e.let("valid"),t.block$data(c,(function(){e.assign(c,!1),e.forOf("v",r,(t=>e.if(Vs._`${l()}(${s}, ${t})`,(()=>e.assign(c,!0).break()))))}));else{if(!Array.isArray(i))throw new Error("ajv implementation error");const t=e.const("vSchema",r);c=(0,Vs.or)(...i.map(((e,n)=>function(t,e){const n=i[e];return"object"==typeof n&&null!==n?Vs._`${l()}(${s}, ${t}[${e}])`:Vs._`${s} === ${n}`}(t,n))))}t.pass(c)}};Ls.default=Xs,Object.defineProperty(Ge,"__esModule",{value:!0});const Ys=ts,Ws=ns,js=cs,zs=ps,Gs=ys,Hs=ws,qs=Ts,Ks=Ds,Zs=Ls,Qs=[He.default,Ys.default,Ws.default,js.default,zs.default,Gs.default,Hs.default,qs.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},Ks.default,Zs.default];Ge.default=Qs;var Js={},tn={};Object.defineProperty(tn,"__esModule",{value:!0}),tn.validateAdditionalItems=void 0;const en=A,sn=I,nn={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:{message:({params:{len:t}})=>en.str`must NOT have more than ${t} items`,params:({params:{len:t}})=>en._`{limit: ${t}}`},code(t){const{parentSchema:e,it:s}=t,{items:n}=e;Array.isArray(n)?rn(t,n):(0,sn.checkStrictMode)(s,'"additionalItems" is ignored when "items" is not an array of schemas')}};function rn(t,e){const{gen:s,schema:n,data:i,keyword:r,it:a}=t;a.items=!0;const o=s.const("len",en._`${i}.length`);if(!1===n)t.setParams({len:e.length}),t.pass(en._`${o} <= ${e.length}`);else if("object"==typeof n&&!(0,sn.alwaysValidSchema)(a,n)){const n=s.var("valid",en._`${o} <= ${e.length}`);s.if((0,en.not)(n),(()=>function(n){s.forRange("i",e.length,o,(e=>{t.subschema({keyword:r,dataProp:e,dataPropType:sn.Type.Num},n),a.allErrors||s.if((0,en.not)(n),(()=>s.break()))}))}(n))),t.ok(n)}}tn.validateAdditionalItems=rn,tn.default=nn;var an={},on={};Object.defineProperty(on,"__esModule",{value:!0}),on.validateTuple=void 0;const hn=A,ln=I,cn=q,un={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(t){const{schema:e,it:s}=t;if(Array.isArray(e))return dn(t,"additionalItems",e);s.items=!0,(0,ln.alwaysValidSchema)(s,e)||t.ok((0,cn.validateArray)(t))}};function dn(t,e,s=t.schema){const{gen:n,parentSchema:i,data:r,keyword:a,it:o}=t;!function(t){const{opts:n,errSchemaPath:i}=o,r=s.length,h=r===t.minItems&&(r===t.maxItems||!1===t[e]);if(n.strictTuples&&!h){const t=`"${a}" is ${r}-tuple, but minItems or maxItems/${e} are not specified or different at path "${i}"`;(0,ln.checkStrictMode)(o,t,n.strictTuples)}}(i),o.opts.unevaluated&&s.length&&!0!==o.items&&(o.items=ln.mergeEvaluated.items(n,s.length,o.items));const h=n.name("valid"),l=n.const("len",hn._`${r}.length`);s.forEach(((e,s)=>{(0,ln.alwaysValidSchema)(o,e)||(n.if(hn._`${l} > ${s}`,(()=>t.subschema({keyword:a,schemaProp:s,dataProp:s},h))),t.ok(h))}))}on.validateTuple=dn,on.default=un,Object.defineProperty(an,"__esModule",{value:!0});const fn=on,pn={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,fn.validateTuple)(t,"items")};an.default=pn;var mn={};Object.defineProperty(mn,"__esModule",{value:!0});const gn=A,yn=I,vn=q,xn=tn,_n={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:{message:({params:{len:t}})=>gn.str`must NOT have more than ${t} items`,params:({params:{len:t}})=>gn._`{limit: ${t}}`},code(t){const{schema:e,parentSchema:s,it:n}=t,{prefixItems:i}=s;n.items=!0,(0,yn.alwaysValidSchema)(n,e)||(i?(0,xn.validateAdditionalItems)(t,i):t.ok((0,vn.validateArray)(t)))}};mn.default=_n;var bn={};Object.defineProperty(bn,"__esModule",{value:!0});const wn=A,En=I,Sn={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:{message:({params:{min:t,max:e}})=>void 0===e?wn.str`must contain at least ${t} valid item(s)`:wn.str`must contain at least ${t} and no more than ${e} valid item(s)`,params:({params:{min:t,max:e}})=>void 0===e?wn._`{minContains: ${t}}`:wn._`{minContains: ${t}, maxContains: ${e}}`},code(t){const{gen:e,schema:s,parentSchema:n,data:i,it:r}=t;let a,o;const{minContains:h,maxContains:l}=n;r.opts.next?(a=void 0===h?1:h,o=l):a=1;const c=e.const("len",wn._`${i}.length`);if(t.setParams({min:a,max:o}),void 0===o&&0===a)return void(0,En.checkStrictMode)(r,'"minContains" == 0 without "maxContains": "contains" keyword ignored');if(void 0!==o&&a>o)return(0,En.checkStrictMode)(r,'"minContains" > "maxContains" is always invalid'),void t.fail();if((0,En.alwaysValidSchema)(r,s)){let e=wn._`${c} >= ${a}`;return void 0!==o&&(e=wn._`${e} && ${c} <= ${o}`),void t.pass(e)}r.items=!0;const u=e.name("valid");function d(){const t=e.name("_valid"),s=e.let("count",0);f(t,(()=>e.if(t,(()=>function(t){e.code(wn._`${t}++`),void 0===o?e.if(wn._`${t} >= ${a}`,(()=>e.assign(u,!0).break())):(e.if(wn._`${t} > ${o}`,(()=>e.assign(u,!1).break())),1===a?e.assign(u,!0):e.if(wn._`${t} >= ${a}`,(()=>e.assign(u,!0))))}(s)))))}function f(s,n){e.forRange("i",0,c,(e=>{t.subschema({keyword:"contains",dataProp:e,dataPropType:En.Type.Num,compositeRule:!0},s),n()}))}void 0===o&&1===a?f(u,(()=>e.if(u,(()=>e.break())))):0===a?(e.let(u,!0),void 0!==o&&e.if(wn._`${i}.length > 0`,d)):(e.let(u,!1),d()),t.result(u,(()=>t.reset()))}};bn.default=Sn;var Tn={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.validateSchemaDeps=t.validatePropertyDeps=t.error=void 0;const e=A,s=I,n=q;t.error={message:({params:{property:t,depsCount:s,deps:n}})=>{const i=1===s?"property":"properties";return e.str`must have ${i} ${n} when property ${t} is present`},params:({params:{property:t,depsCount:s,deps:n,missingProperty:i}})=>e._`{property: ${t},
    missingProperty: ${i},
    depsCount: ${s},
    deps: ${n}}`};const i={keyword:"dependencies",type:"object",schemaType:"object",error:t.error,code(t){const[e,s]=function({schema:t}){const e={},s={};for(const n in t){if("__proto__"===n)continue;(Array.isArray(t[n])?e:s)[n]=t[n]}return[e,s]}(t);r(t,e),a(t,s)}};function r(t,s=t.schema){const{gen:i,data:r,it:a}=t;if(0===Object.keys(s).length)return;const o=i.let("missing");for(const h in s){const l=s[h];if(0===l.length)continue;const c=(0,n.propertyInData)(i,r,h,a.opts.ownProperties);t.setParams({property:h,depsCount:l.length,deps:l.join(", ")}),a.allErrors?i.if(c,(()=>{for(const e of l)(0,n.checkReportMissingProp)(t,e)})):(i.if(e._`${c} && (${(0,n.checkMissingProp)(t,l,o)})`),(0,n.reportMissingProp)(t,o),i.else())}}function a(t,e=t.schema){const{gen:i,data:r,keyword:a,it:o}=t,h=i.name("valid");for(const l in e)(0,s.alwaysValidSchema)(o,e[l])||(i.if((0,n.propertyInData)(i,r,l,o.opts.ownProperties),(()=>{const e=t.subschema({keyword:a,schemaProp:l},h);t.mergeValidEvaluated(e,h)}),(()=>i.var(h,!0))),t.ok(h))}t.validatePropertyDeps=r,t.validateSchemaDeps=a,t.default=i}(Tn);var An={};Object.defineProperty(An,"__esModule",{value:!0});const Cn=A,Mn=I,In={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:{message:"property name must be valid",params:({params:t})=>Cn._`{propertyName: ${t.propertyName}}`},code(t){const{gen:e,schema:s,data:n,it:i}=t;if((0,Mn.alwaysValidSchema)(i,s))return;const r=e.name("valid");e.forIn("key",n,(s=>{t.setParams({propertyName:s}),t.subschema({keyword:"propertyNames",data:s,dataTypes:["string"],propertyName:s,compositeRule:!0},r),e.if((0,Cn.not)(r),(()=>{t.error(!0),i.allErrors||e.break()}))})),t.ok(r)}};An.default=In;var Pn={};Object.defineProperty(Pn,"__esModule",{value:!0});const Rn=q,kn=A,Dn=P,Fn=I,On={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:{message:"must NOT have additional properties",params:({params:t})=>kn._`{additionalProperty: ${t.additionalProperty}}`},code(t){const{gen:e,schema:s,parentSchema:n,data:i,errsCount:r,it:a}=t;if(!r)throw new Error("ajv implementation error");const{allErrors:o,opts:h}=a;if(a.props=!0,"all"!==h.removeAdditional&&(0,Fn.alwaysValidSchema)(a,s))return;const l=(0,Rn.allSchemaProperties)(n.properties),c=(0,Rn.allSchemaProperties)(n.patternProperties);function u(t){e.code(kn._`delete ${i}[${t}]`)}function d(n){if("all"===h.removeAdditional||h.removeAdditional&&!1===s)u(n);else{if(!1===s)return t.setParams({additionalProperty:n}),t.error(),void(o||e.break());if("object"==typeof s&&!(0,Fn.alwaysValidSchema)(a,s)){const s=e.name("valid");"failing"===h.removeAdditional?(f(n,s,!1),e.if((0,kn.not)(s),(()=>{t.reset(),u(n)}))):(f(n,s),o||e.if((0,kn.not)(s),(()=>e.break())))}}}function f(e,s,n){const i={keyword:"additionalProperties",dataProp:e,dataPropType:Fn.Type.Str};!1===n&&Object.assign(i,{compositeRule:!0,createErrors:!1,allErrors:!1}),t.subschema(i,s)}e.forIn("key",i,(s=>{l.length||c.length?e.if(function(s){let i;if(l.length>8){const t=(0,Fn.schemaRefOrVal)(a,n.properties,"properties");i=(0,Rn.isOwnProperty)(e,t,s)}else i=l.length?(0,kn.or)(...l.map((t=>kn._`${s} === ${t}`))):kn.nil;return c.length&&(i=(0,kn.or)(i,...c.map((e=>kn._`${(0,Rn.usePattern)(t,e)}.test(${s})`)))),(0,kn.not)(i)}(s),(()=>d(s))):d(s)})),t.ok(kn._`${r} === ${Dn.default.errors}`)}};Pn.default=On;var Nn={};Object.defineProperty(Nn,"__esModule",{value:!0});const Bn=E,Ln=q,Vn=I,$n=Pn,Un={keyword:"properties",type:"object",schemaType:"object",code(t){const{gen:e,schema:s,parentSchema:n,data:i,it:r}=t;"all"===r.opts.removeAdditional&&void 0===n.additionalProperties&&$n.default.code(new Bn.KeywordCxt(r,$n.default,"additionalProperties"));const a=(0,Ln.allSchemaProperties)(s);for(const u of a)r.definedProperties.add(u);r.opts.unevaluated&&a.length&&!0!==r.props&&(r.props=Vn.mergeEvaluated.props(e,(0,Vn.toHash)(a),r.props));const o=a.filter((t=>!(0,Vn.alwaysValidSchema)(r,s[t])));if(0===o.length)return;const h=e.name("valid");for(const u of o)l(u)?c(u):(e.if((0,Ln.propertyInData)(e,i,u,r.opts.ownProperties)),c(u),r.allErrors||e.else().var(h,!0),e.endIf()),t.it.definedProperties.add(u),t.ok(h);function l(t){return r.opts.useDefaults&&!r.compositeRule&&void 0!==s[t].default}function c(e){t.subschema({keyword:"properties",schemaProp:e,dataProp:e},h)}}};Nn.default=Un;var Xn={};Object.defineProperty(Xn,"__esModule",{value:!0});const Yn=q,Wn=A,jn=I,zn=I,Gn={keyword:"patternProperties",type:"object",schemaType:"object",code(t){const{gen:e,schema:s,data:n,parentSchema:i,it:r}=t,{opts:a}=r,o=(0,Yn.allSchemaProperties)(s),h=o.filter((t=>(0,jn.alwaysValidSchema)(r,s[t])));if(0===o.length||h.length===o.length&&(!r.opts.unevaluated||!0===r.props))return;const l=a.strictSchema&&!a.allowMatchingProperties&&i.properties,c=e.name("valid");!0===r.props||r.props instanceof Wn.Name||(r.props=(0,zn.evaluatedPropsToName)(e,r.props));const{props:u}=r;function d(t){for(const e in l)new RegExp(t).test(e)&&(0,jn.checkStrictMode)(r,`property ${e} matches pattern ${t} (use allowMatchingProperties)`)}function f(s){e.forIn("key",n,(n=>{e.if(Wn._`${(0,Yn.usePattern)(t,s)}.test(${n})`,(()=>{const i=h.includes(s);i||t.subschema({keyword:"patternProperties",schemaProp:s,dataProp:n,dataPropType:zn.Type.Str},c),r.opts.unevaluated&&!0!==u?e.assign(Wn._`${u}[${n}]`,!0):i||r.allErrors||e.if((0,Wn.not)(c),(()=>e.break()))}))}))}!function(){for(const t of o)l&&d(t),r.allErrors?f(t):(e.var(c,!0),f(t),e.if(c))}()}};Xn.default=Gn;var Hn={};Object.defineProperty(Hn,"__esModule",{value:!0});const qn=I,Kn={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){const{gen:e,schema:s,it:n}=t;if((0,qn.alwaysValidSchema)(n,s))return void t.fail();const i=e.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},i),t.failResult(i,(()=>t.reset()),(()=>t.error()))},error:{message:"must NOT be valid"}};Hn.default=Kn;var Zn={};Object.defineProperty(Zn,"__esModule",{value:!0});const Qn={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:q.validateUnion,error:{message:"must match a schema in anyOf"}};Zn.default=Qn;var Jn={};Object.defineProperty(Jn,"__esModule",{value:!0});const ti=A,ei=I,si={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:{message:"must match exactly one schema in oneOf",params:({params:t})=>ti._`{passingSchemas: ${t.passing}}`},code(t){const{gen:e,schema:s,parentSchema:n,it:i}=t;if(!Array.isArray(s))throw new Error("ajv implementation error");if(i.opts.discriminator&&n.discriminator)return;const r=s,a=e.let("valid",!1),o=e.let("passing",null),h=e.name("_valid");t.setParams({passing:o}),e.block((function(){r.forEach(((s,n)=>{let r;(0,ei.alwaysValidSchema)(i,s)?e.var(h,!0):r=t.subschema({keyword:"oneOf",schemaProp:n,compositeRule:!0},h),n>0&&e.if(ti._`${h} && ${a}`).assign(a,!1).assign(o,ti._`[${o}, ${n}]`).else(),e.if(h,(()=>{e.assign(a,!0),e.assign(o,n),r&&t.mergeEvaluated(r,ti.Name)}))}))})),t.result(a,(()=>t.reset()),(()=>t.error(!0)))}};Jn.default=si;var ni={};Object.defineProperty(ni,"__esModule",{value:!0});const ii=I,ri={keyword:"allOf",schemaType:"array",code(t){const{gen:e,schema:s,it:n}=t;if(!Array.isArray(s))throw new Error("ajv implementation error");const i=e.name("valid");s.forEach(((e,s)=>{if((0,ii.alwaysValidSchema)(n,e))return;const r=t.subschema({keyword:"allOf",schemaProp:s},i);t.ok(i),t.mergeEvaluated(r)}))}};ni.default=ri;var ai={};Object.defineProperty(ai,"__esModule",{value:!0});const oi=A,hi=I,li={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:{message:({params:t})=>oi.str`must match "${t.ifClause}" schema`,params:({params:t})=>oi._`{failingKeyword: ${t.ifClause}}`},code(t){const{gen:e,parentSchema:s,it:n}=t;void 0===s.then&&void 0===s.else&&(0,hi.checkStrictMode)(n,'"if" without "then" and "else" is ignored');const i=ci(n,"then"),r=ci(n,"else");if(!i&&!r)return;const a=e.let("valid",!0),o=e.name("_valid");if(function(){const e=t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},o);t.mergeEvaluated(e)}(),t.reset(),i&&r){const s=e.let("ifClause");t.setParams({ifClause:s}),e.if(o,h("then",s),h("else",s))}else i?e.if(o,h("then")):e.if((0,oi.not)(o),h("else"));function h(s,n){return()=>{const i=t.subschema({keyword:s},o);e.assign(a,o),t.mergeValidEvaluated(i,a),n?e.assign(n,oi._`${s}`):t.setParams({ifClause:s})}}t.pass(a,(()=>t.error(!0)))}};function ci(t,e){const s=t.schema[e];return void 0!==s&&!(0,hi.alwaysValidSchema)(t,s)}ai.default=li;var ui={};Object.defineProperty(ui,"__esModule",{value:!0});const di=I,fi={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:e,it:s}){void 0===e.if&&(0,di.checkStrictMode)(s,`"${t}" without "if" is ignored`)}};ui.default=fi,Object.defineProperty(Js,"__esModule",{value:!0});const pi=tn,mi=an,gi=on,yi=mn,vi=bn,xi=Tn,_i=An,bi=Pn,wi=Nn,Ei=Xn,Si=Hn,Ti=Zn,Ai=Jn,Ci=ni,Mi=ai,Ii=ui;Js.default=function(t=!1){const e=[Si.default,Ti.default,Ai.default,Ci.default,Mi.default,Ii.default,_i.default,bi.default,xi.default,wi.default,Ei.default];return t?e.push(mi.default,yi.default):e.push(pi.default,gi.default),e.push(vi.default),e};var Pi={},Ri={};Object.defineProperty(Ri,"__esModule",{value:!0});const ki=A,Di={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:{message:({schemaCode:t})=>ki.str`must match format "${t}"`,params:({schemaCode:t})=>ki._`{format: ${t}}`},code(t,e){const{gen:s,data:n,$data:i,schema:r,schemaCode:a,it:o}=t,{opts:h,errSchemaPath:l,schemaEnv:c,self:u}=o;h.validateFormats&&(i?function(){const i=s.scopeValue("formats",{ref:u.formats,code:h.code.formats}),r=s.const("fDef",ki._`${i}[${a}]`),o=s.let("fType"),l=s.let("format");s.if(ki._`typeof ${r} == "object" && !(${r} instanceof RegExp)`,(()=>s.assign(o,ki._`${r}.type || "string"`).assign(l,ki._`${r}.validate`)),(()=>s.assign(o,ki._`"string"`).assign(l,r))),t.fail$data((0,ki.or)(!1===h.strictSchema?ki.nil:ki._`${a} && !${l}`,function(){const t=c.$async?ki._`(${r}.async ? await ${l}(${n}) : ${l}(${n}))`:ki._`${l}(${n})`,s=ki._`(typeof ${l} == "function" ? ${t} : ${l}.test(${n}))`;return ki._`${l} && ${l} !== true && ${o} === ${e} && !${s}`}()))}():function(){const i=u.formats[r];if(!i)return void function(){if(!1===h.strictSchema)return void u.logger.warn(t());throw new Error(t());function t(){return`unknown format "${r}" ignored in schema at path "${l}"`}}();if(!0===i)return;const[a,o,d]=function(t){const e=t instanceof RegExp?(0,ki.regexpCode)(t):h.code.formats?ki._`${h.code.formats}${(0,ki.getProperty)(r)}`:void 0,n=s.scopeValue("formats",{key:r,ref:t,code:e});if("object"==typeof t&&!(t instanceof RegExp))return[t.type||"string",t.validate,ki._`${n}.validate`];return["string",t,n]}(i);a===e&&t.pass(function(){if("object"==typeof i&&!(i instanceof RegExp)&&i.async){if(!c.$async)throw new Error("async format in sync schema");return ki._`await ${d}(${n})`}return"function"==typeof o?ki._`${d}(${n})`:ki._`${d}.test(${n})`}())}())}};Ri.default=Di,Object.defineProperty(Pi,"__esModule",{value:!0});const Fi=[Ri.default];Pi.default=Fi;var Oi={};Object.defineProperty(Oi,"__esModule",{value:!0}),Oi.contentVocabulary=Oi.metadataVocabulary=void 0,Oi.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"],Oi.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"],Object.defineProperty(Re,"__esModule",{value:!0});const Ni=Ge,Bi=Js,Li=Pi,Vi=Oi,$i=[ke.default,Ni.default,(0,Bi.default)(),Li.default,Vi.metadataVocabulary,Vi.contentVocabulary];Re.default=$i;var Ui,Xi,Yi={},Wi={};Ui=Wi,Object.defineProperty(Ui,"__esModule",{value:!0}),Ui.DiscrError=void 0,(Xi=Ui.DiscrError||(Ui.DiscrError={})).Tag="tag",Xi.Mapping="mapping",Object.defineProperty(Yi,"__esModule",{value:!0});const ji=A,zi=Wi,Gi=de,Hi=I,qi={keyword:"discriminator",type:"object",schemaType:"object",error:{message:({params:{discrError:t,tagName:e}})=>t===zi.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:t,tag:e,tagName:s}})=>ji._`{error: ${t}, tag: ${s}, tagValue: ${e}}`},code(t){const{gen:e,data:s,schema:n,parentSchema:i,it:r}=t,{oneOf:a}=i;if(!r.opts.discriminator)throw new Error("discriminator: requires discriminator option");const o=n.propertyName;if("string"!=typeof o)throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!a)throw new Error("discriminator: requires oneOf keyword");const h=e.let("valid",!1),l=e.const("tag",ji._`${s}${(0,ji.getProperty)(o)}`);function c(s){const n=e.name("valid"),i=t.subschema({keyword:"oneOf",schemaProp:s},n);return t.mergeEvaluated(i,ji.Name),n}e.if(ji._`typeof ${l} == "string"`,(()=>function(){const s=function(){var t;const e={},s=h(i);let n=!0;for(let i=0;i<a.length;i++){let e=a[i];(null==e?void 0:e.$ref)&&!(0,Hi.schemaHasRulesButRef)(e,r.self.RULES)&&(e=Gi.resolveRef.call(r.self,r.schemaEnv.root,r.baseId,null==e?void 0:e.$ref),e instanceof Gi.SchemaEnv&&(e=e.schema));const c=null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t[o];if("object"!=typeof c)throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${o}"`);n=n&&(s||h(e)),l(c,i)}if(!n)throw new Error(`discriminator: "${o}" must be required`);return e;function h({required:t}){return Array.isArray(t)&&t.includes(o)}function l(t,e){if(t.const)c(t.const,e);else{if(!t.enum)throw new Error(`discriminator: "properties/${o}" must have "const" or "enum"`);for(const s of t.enum)c(s,e)}}function c(t,s){if("string"!=typeof t||t in e)throw new Error(`discriminator: "${o}" values must be unique strings`);e[t]=s}}();e.if(!1);for(const t in s)e.elseIf(ji._`${l} === ${t}`),e.assign(h,c(s[t]));e.else(),t.error(!1,{discrError:zi.DiscrError.Mapping,tag:l,tagName:o}),e.endIf()}()),(()=>t.error(!1,{discrError:zi.DiscrError.Tag,tag:l,tagName:o}))),t.ok(h)}};Yi.default=qi;const Ki={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.MissingRefError=e.ValidationError=e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=void 0;const s=w,n=Re,i=Yi,r=Ki,a=["/properties"],o="http://json-schema.org/draft-07/schema";class h extends s.default{_addVocabularies(){super._addVocabularies(),n.default.forEach((t=>this.addVocabulary(t))),this.opts.discriminator&&this.addKeyword(i.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const t=this.opts.$data?this.$dataMetaSchema(r,a):r;this.addMetaSchema(t,o,!1),this.refs["http://json-schema.org/schema"]=o}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(o)?o:void 0)}}t.exports=e=h,Object.defineProperty(e,"__esModule",{value:!0}),e.default=h;var l=E;Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return l.KeywordCxt}});var c=A;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return c._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return c.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return c.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return c.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return c.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return c.CodeGen}});var u=oe;Object.defineProperty(e,"ValidationError",{enumerable:!0,get:function(){return u.default}});var d=le;Object.defineProperty(e,"MissingRefError",{enumerable:!0,get:function(){return d.default}})}(b,_);const Zi={type:"object",properties:{},required:[]},Qi={type:"object",properties:{},required:[]},Ji={StartGame:{R:Qi},Bet:{S:{type:"object",properties:{state:{type:"string",enum:["bet","cheatbet"]},debug:{type:"string"},pick:{type:"number"},dice:{type:"array",items:{type:"number"}},isBonus:{type:"boolean"},bonusDice:{type:"number"}},required:["state","debug","pick","dice","isBonus","bonusDice"]},R:{type:"object",properties:l({},Zi.properties),required:Zi.required}},Step:{S:Qi,R:Qi}},tr=new class{constructor(){d(this,"totalwin",0),d(this,"debug",""),d(this,"state",""),d(this,"pick",0),d(this,"dice",[]),d(this,"isBonus",!1),d(this,"bonusDice",0),d(this,"nNonWin",0),d(this,"demoMessages",[]),d(this,"demoResults",[]),d(this,"combCheatTable",[[1066456,738475703,916907404],[64344603,801505779,894285542],[770991269,832449767,985385661],[814542285,872125537,1027873085],[908116364,962889641,1086056791],[977719840,1111690215,1146010273],[1129771500,1152912225,1162662783],[1145692058,1162657968,1166510409],[1152315930,1162673562,1166516494],[1120046750,1144839119,1162855544]])}getDemoExtraction(t){let e;e=!0===pgame.controlCaseGS?9:!0===pgame.controlCaseWild?10:7;let s=this.demoResults[e];Object.assign(this,s)}recvBetGameData(t){Object.assign(this,t)}};tr.demoMessages=['{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[9,4,4,7,4],[9,2,0,0,1],[5,6,3,7,8],[2,1,0,4,6],[5,0,1,6,0]],"mysteryWin":0,"nScatter":0,"ready":0,"shootingWild":[],"totalwin":0,"winningLines":[]}','{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[1,0,2,4,5],[4,2,9,5,3],[5,7,1,0,2],[0,0,2,4,8],[5,0,8,0,5]],"mysteryWin":0,"nScatter":1,"ready":0,"shootingWild":[],"totalwin":0,"winningLines":[]}','{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[3,4,3,0,3],[9,7,4,0,4],[1,7,2,0,1],[9,4,5,5,0],[4,1,7,6,1]],"mysteryWin":0,"nScatter":0,"ready":0,"shootingWild":[],"totalwin":50,"winningLines":[{"lineID":2,"numWinningSymbs":3,"position":[0,1,2,0,0],"symbID":0,"totWin":50}]}','{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[4,2,1,3,5],[2,8,0,3,0],[0,0,3,6,4],[9,1,0,0,3],[0,1,0,4,6]],"mysteryWin":0,"nScatter":0,"ready":0,"shootingWild":[],"totalwin":150,"winningLines":[{"lineID":6,"numWinningSymbs":3,"position":[0,1,2,0,0],"symbID":3,"totWin":150}]}','{"bonus":null,"bonusWin":3300,"freeSpins":[],"grid":[[6,6,2,2,7],[8,4,2,7,7],[6,4,8,5,8],[0,3,6,3,8],[1,7,7,1,5]],"mysteryWin":0,"nScatter":0,"ready":0,"shootingWild":[[0,1]],"totalwin":600,"winningLines":[{"lineID":0,"numWinningSymbs":3,"position":[0,1,2,3,4],"symbID":2,"totWin":100},{"lineID":1,"numWinningSymbs":3,"position":[0,1,2,3,4],"symbID":4,"totWin":250},{"lineID":5,"numWinningSymbs":3,"position":[0,1,2,3,0],"symbID":4,"totWin":250}]}','{"bonus":null,"bonusWin":11400,"freeSpins":[],"grid":[[7,5,2,3,2],[0,9,7,5,2],[0,4,2,0,1],[5,3,6,7,3],[7,0,4,0,1]],"mysteryWin":200,"nScatter":1,"ready":0,"shootingWild":[],"totalwin":200,"winningLines":[]}','{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[3,7,6,2,1],[2,2,8,7,3],[5,0,8,6,7],[5,4,0,1,6],[7,1,3,5,4]],"mysteryWin":500,"nScatter":0,"ready":0,"shootingWild":[],"totalwin":2000,"winningLines":[{"lineID":0,"numWinningSymbs":3,"position":[0,1,2,3,4],"symbID":6,"totWin":1500}]}','{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[7,0,3,9,4],[2,5,7,7,5],[8,5,1,0,1],[1,1,1,3,2],[9,5,0,9,1]],"mysteryWin":500,"nScatter":1,"ready":0,"shootingWild":[[3,1],[0,3]],"totalwin":0,"winningLines":[]}','{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[1,6,3,5,0],[5,6,4,0,0],[3,6,5,3,2],[0,7,9,1,6],[7,4,9,1,0]],"mysteryWin":1000,"nScatter":2,"ready":0,"shootingWild":[[3,3],[1,3]],"totalwin":3900,"winningLines":[{"lineID":1,"numWinningSymbs":3,"position":[0,1,2,3,4],"symbID":6,"totWin":1500},{"lineID":6,"numWinningSymbs":4,"position":[0,1,2,3,4],"symbID":5,"totWin":1200},{"lineID":8,"numWinningSymbs":4,"position":[0,1,2,3,0],"symbID":3,"totWin":200}]}','{"bonus":{"pickWins":[800,0,0,0,0],"scatters":[{"fakeValues0":600,"fakeValues1":700,"fakeValues2":900,"fakeValues3":1000,"reelID":2,"slotID":0},{"fakeValues0":0,"fakeValues1":0,"fakeValues2":0,"fakeValues3":0,"reelID":3,"slotID":1},{"fakeValues0":0,"fakeValues1":0,"fakeValues2":0,"fakeValues3":0,"reelID":0,"slotID":0},{"fakeValues0":0,"fakeValues1":0,"fakeValues2":0,"fakeValues3":0,"reelID":0,"slotID":0},{"fakeValues0":0,"fakeValues1":0,"fakeValues2":0,"fakeValues3":0,"reelID":0,"slotID":0}]},"bonusWin":500,"freeSpins":[{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[8,4,9,2,4],[8,4,9,1,0],[4,2,4,3,9],[8,4,0,5,0],[2,5,0,5,5]],"mysteryWin":0,"nScatter":2,"ready":0,"shootingWild":[],"totalwin":400,"winningLines":[{"lineID":5,"numWinningSymbs":4,"position":[0,1,2,3,3435973836],"symbID":4,"totWin":400}]},{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[2,2,0,0,6],[0,5,3,0,0],[2,6,9,5,5],[7,8,5,3,6],[1,3,0,1,3]],"mysteryWin":0,"nScatter":1,"ready":0,"shootingWild":[[0,3]],"totalwin":0,"winningLines":[]},{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[2,6,2,4,0],[0,0,8,0,9],[6,0,5,3,2],[8,2,1,1,5],[5,6,3,0,0]],"mysteryWin":0,"nScatter":0,"ready":0,"shootingWild":[],"totalwin":0,"winningLines":[]},{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[4,3,2,3,2],[8,9,1,1,8],[1,7,3,5,5],[2,4,1,9,8],[1,5,5,5,3]],"mysteryWin":0,"nScatter":2,"ready":0,"shootingWild":[],"totalwin":0,"winningLines":[]},{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[3,0,1,0,2],[3,1,0,0,6],[1,4,5,4,0],[1,2,1,6,2],[2,2,8,1,1]],"mysteryWin":0,"nScatter":0,"ready":0,"shootingWild":[],"totalwin":0,"winningLines":[]},{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[9,4,9,6,5],[7,4,9,1,8],[5,4,3,3,0],[0,4,1,3,4],[3,0,4,7,3]],"mysteryWin":0,"nScatter":2,"ready":0,"shootingWild":[],"totalwin":400,"winningLines":[{"lineID":1,"numWinningSymbs":4,"position":[0,1,2,3,3435973836],"symbID":4,"totWin":400}]},{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[4,3,5,8,4],[4,4,1,0,7],[9,8,8,3,0],[8,3,6,0,2],[0,0,5,0,7]],"mysteryWin":0,"nScatter":0,"ready":0,"shootingWild":[],"totalwin":300,"winningLines":[{"lineID":4,"numWinningSymbs":3,"position":[0,1,2,3435973836,3435973836],"symbID":1,"totWin":50},{"lineID":6,"numWinningSymbs":5,"position":[0,1,2,3,4],"symbID":0,"totWin":250}]},{"bonus":null,"bonusWin":0,"freeSpins":[],"grid":[[2,2,4,9,1],[6,9,4,4,9],[8,6,4,2,6],[3,5,4,0,1],[6,3,5,5,7]],"mysteryWin":100,"nScatter":2,"ready":0,"shootingWild":[],"totalwin":400,"winningLines":[{"lineID":0,"numWinningSymbs":4,"position":[0,1,2,3,3435973836],"symbID":4,"totWin":400}]}],"grid":[[3,9,2,8,7],[0,0,3,6,6],[9,9,1,2,2],[7,0,9,8,7],[3,3,0,1,4]],"mysteryWin":0,"nScatter":2,"ready":0,"shootingWild":[],"totalwin":1500,"winningLines":[]}','{"bonus":null,"bonusWin":9800,"freeSpins":[],"grid":[[8,8,3,5,6],[2,9,5,3,6],[6,3,4,4,0],[3,2,2,3,6],[6,9,3,6,2]],"mysteryWin":0,"nScatter":2,"shootingWild":[[3,2],[1,2],[2,3]],"totalwin":10900,"winningLines":[{"lineID":3,"numWinningSymbs":4,"position":[0,1,2,3],"symbID":7,"totWin":10000},{"lineID":8,"numWinningSymbs":5,"position":[0,1,2,3,4],"symbID":3,"totWin":700},{"lineID":9,"numWinningSymbs":4,"position":[0,1,2,3],"symbID":3,"totWin":200}]}'],tr.demoResults=tr.demoMessages.map((t=>JSON.parse(t)));var er=(t=>(t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2",t))(er||{}),sr=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS",t))(sr||{}),nr=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(nr||{}),ir=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(ir||{}),rr=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(rr||{}),ar=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(ar||{}),or=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(or||{}),hr=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(hr||{}),lr=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(lr||{}),cr=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(cr||{}),ur=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(ur||{}),dr=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(dr||{}),fr=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))(fr||{}),pr=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))(pr||{}),mr=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(mr||{}),gr=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(gr||{}),yr=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(yr||{}),vr=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(vr||{}),xr=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(xr||{});const _r={ADAPTER:{createCanvas:(t,e)=>{const s=document.createElement("canvas");return s.width=t,s.height=e,s},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>{var t;return null!=(t=document.baseURI)?t:window.location.href},getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>(new DOMParser).parseFromString(t,"text/xml")},RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var br=/iPhone/i,wr=/iPod/i,Er=/iPad/i,Sr=/\biOS-universal(?:.+)Mac\b/i,Tr=/\bAndroid(?:.+)Mobile\b/i,Ar=/Android/i,Cr=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Mr=/Silk/i,Ir=/Windows Phone/i,Pr=/\bWindows(?:.+)ARM\b/i,Rr=/BlackBerry/i,kr=/BB10/i,Dr=/Opera Mini/i,Fr=/\b(CriOS|Chrome)(?:.+)Mobile/i,Or=/Mobile(?:.+)Firefox\b/i,Nr=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};function Br(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var s=e.userAgent,n=s.split("[FBAN");void 0!==n[1]&&(s=n[0]),void 0!==(n=s.split("Twitter"))[1]&&(s=n[0]);var i=function(t){return function(e){return e.test(t)}}(s),r={apple:{phone:i(br)&&!i(Ir),ipod:i(wr),tablet:!i(br)&&(i(Er)||Nr(e))&&!i(Ir),universal:i(Sr),device:(i(br)||i(wr)||i(Er)||i(Sr)||Nr(e))&&!i(Ir)},amazon:{phone:i(Cr),tablet:!i(Cr)&&i(Mr),device:i(Cr)||i(Mr)},android:{phone:!i(Ir)&&i(Cr)||!i(Ir)&&i(Tr),tablet:!i(Ir)&&!i(Cr)&&!i(Tr)&&(i(Mr)||i(Ar)),device:!i(Ir)&&(i(Cr)||i(Mr)||i(Tr)||i(Ar))||i(/\bokhttp\b/i)},windows:{phone:i(Ir),tablet:i(Pr),device:i(Ir)||i(Pr)},other:{blackberry:i(Rr),blackberry10:i(kr),opera:i(Dr),firefox:i(Or),chrome:i(Fr),device:i(Rr)||i(kr)||i(Dr)||i(Or)||i(Fr)},any:!1,phone:!1,tablet:!1};return r.any=r.apple.device||r.android.device||r.windows.device||r.other.device,r.phone=r.apple.phone||r.android.phone||r.windows.phone,r.tablet=r.apple.tablet||r.android.tablet||r.windows.tablet,r}const Lr=(null!=(t=Br.default)?t:Br)(globalThis.navigator);_r.RETINA_PREFIX=/@([0-9\.]+)x/,_r.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Vr={};function $r(t,e,s){s=s||2;var n,i,r,a,o,h,l,c=e&&e.length,u=c?e[0]*s:t.length,d=Ur(t,0,u,s,!0),f=[];if(!d||d.next===d.prev)return f;if(c&&(d=function(t,e,s,n){var i,r,a,o=[];for(i=0,r=e.length;i<r;i++)(a=Ur(t,e[i]*n,i<r-1?e[i+1]*n:t.length,n,!1))===a.next&&(a.steiner=!0),o.push(Qr(a));for(o.sort(Hr),i=0;i<o.length;i++)s=qr(o[i],s);return s}(t,e,d,s)),t.length>80*s){n=r=t[0],i=a=t[1];for(var p=s;p<u;p+=s)(o=t[p])<n&&(n=o),(h=t[p+1])<i&&(i=h),o>r&&(r=o),h>a&&(a=h);l=0!==(l=Math.max(r-n,a-i))?32767/l:0}return Yr(d,f,s,n,i,l,0),f}function Ur(t,e,s,n,i){var r,a;if(i===ua(t,e,s,n)>0)for(r=e;r<s;r+=n)a=ha(r,t[r],t[r+1],a);else for(r=s-n;r>=e;r-=n)a=ha(r,t[r],t[r+1],a);return a&&sa(a,a.next)&&(la(a),a=a.next),a}function Xr(t,e){if(!t)return t;e||(e=t);var s,n=t;do{if(s=!1,n.steiner||!sa(n,n.next)&&0!==ea(n.prev,n,n.next))n=n.next;else{if(la(n),(n=e=n.prev)===n.next)break;s=!0}}while(s||n!==e);return e}function Yr(t,e,s,n,i,r,a){if(t){!a&&r&&function(t,e,s,n){var i=t;do{0===i.z&&(i.z=Zr(i.x,i.y,e,s,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,s,n,i,r,a,o,h,l=1;do{for(s=t,t=null,r=null,a=0;s;){for(a++,n=s,o=0,e=0;e<l&&(o++,n=n.nextZ);e++);for(h=l;o>0||h>0&&n;)0!==o&&(0===h||!n||s.z<=n.z)?(i=s,s=s.nextZ,o--):(i=n,n=n.nextZ,h--),r?r.nextZ=i:t=i,i.prevZ=r,r=i;s=n}r.nextZ=null,l*=2}while(a>1)}(i)}(t,n,i,r);for(var o,h,l=t;t.prev!==t.next;)if(o=t.prev,h=t.next,r?jr(t,n,i,r):Wr(t))e.push(o.i/s|0),e.push(t.i/s|0),e.push(h.i/s|0),la(t),t=h.next,l=h.next;else if((t=h)===l){a?1===a?Yr(t=zr(Xr(t),e,s),e,s,n,i,r,2):2===a&&Gr(t,e,s,n,i,r):Yr(Xr(t),e,s,n,i,r,1);break}}}function Wr(t){var e=t.prev,s=t,n=t.next;if(ea(e,s,n)>=0)return!1;for(var i=e.x,r=s.x,a=n.x,o=e.y,h=s.y,l=n.y,c=i<r?i<a?i:a:r<a?r:a,u=o<h?o<l?o:l:h<l?h:l,d=i>r?i>a?i:a:r>a?r:a,f=o>h?o>l?o:l:h>l?h:l,p=n.next;p!==e;){if(p.x>=c&&p.x<=d&&p.y>=u&&p.y<=f&&Jr(i,o,r,h,a,l,p.x,p.y)&&ea(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function jr(t,e,s,n){var i=t.prev,r=t,a=t.next;if(ea(i,r,a)>=0)return!1;for(var o=i.x,h=r.x,l=a.x,c=i.y,u=r.y,d=a.y,f=o<h?o<l?o:l:h<l?h:l,p=c<u?c<d?c:d:u<d?u:d,m=o>h?o>l?o:l:h>l?h:l,g=c>u?c>d?c:d:u>d?u:d,y=Zr(f,p,e,s,n),v=Zr(m,g,e,s,n),x=t.prevZ,_=t.nextZ;x&&x.z>=y&&_&&_.z<=v;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==i&&x!==a&&Jr(o,c,h,u,l,d,x.x,x.y)&&ea(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,_.x>=f&&_.x<=m&&_.y>=p&&_.y<=g&&_!==i&&_!==a&&Jr(o,c,h,u,l,d,_.x,_.y)&&ea(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;x&&x.z>=y;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==i&&x!==a&&Jr(o,c,h,u,l,d,x.x,x.y)&&ea(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;_&&_.z<=v;){if(_.x>=f&&_.x<=m&&_.y>=p&&_.y<=g&&_!==i&&_!==a&&Jr(o,c,h,u,l,d,_.x,_.y)&&ea(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function zr(t,e,s){var n=t;do{var i=n.prev,r=n.next.next;!sa(i,r)&&na(i,n,n.next,r)&&aa(i,r)&&aa(r,i)&&(e.push(i.i/s|0),e.push(n.i/s|0),e.push(r.i/s|0),la(n),la(n.next),n=t=r),n=n.next}while(n!==t);return Xr(n)}function Gr(t,e,s,n,i,r){var a=t;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&ta(a,o)){var h=oa(a,o);return a=Xr(a,a.next),h=Xr(h,h.next),Yr(a,e,s,n,i,r,0),void Yr(h,e,s,n,i,r,0)}o=o.next}a=a.next}while(a!==t)}function Hr(t,e){return t.x-e.x}function qr(t,e){var s=function(t,e){var s,n=e,i=t.x,r=t.y,a=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var o=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=i&&o>a&&(a=o,s=n.x<n.next.x?n:n.next,o===i))return s}n=n.next}while(n!==e);if(!s)return null;var h,l=s,c=s.x,u=s.y,d=1/0;n=s;do{i>=n.x&&n.x>=c&&i!==n.x&&Jr(r<u?i:a,r,c,u,r<u?a:i,r,n.x,n.y)&&(h=Math.abs(r-n.y)/(i-n.x),aa(n,t)&&(h<d||h===d&&(n.x>s.x||n.x===s.x&&Kr(s,n)))&&(s=n,d=h)),n=n.next}while(n!==l);return s}(t,e);if(!s)return e;var n=oa(s,t);return Xr(n,n.next),Xr(s,s.next)}function Kr(t,e){return ea(t.prev,t,e.prev)<0&&ea(e.next,t,t.next)<0}function Zr(t,e,s,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Qr(t){var e=t,s=t;do{(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next}while(e!==t);return s}function Jr(t,e,s,n,i,r,a,o){return(i-a)*(e-o)>=(t-a)*(r-o)&&(t-a)*(n-o)>=(s-a)*(e-o)&&(s-a)*(r-o)>=(i-a)*(n-o)}function ta(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var s=t;do{if(s.i!==t.i&&s.next.i!==t.i&&s.i!==e.i&&s.next.i!==e.i&&na(s,s.next,t,e))return!0;s=s.next}while(s!==t);return!1}(t,e)&&(aa(t,e)&&aa(e,t)&&function(t,e){var s=t,n=!1,i=(t.x+e.x)/2,r=(t.y+e.y)/2;do{s.y>r!=s.next.y>r&&s.next.y!==s.y&&i<(s.next.x-s.x)*(r-s.y)/(s.next.y-s.y)+s.x&&(n=!n),s=s.next}while(s!==t);return n}(t,e)&&(ea(t.prev,t,e.prev)||ea(t,e.prev,e))||sa(t,e)&&ea(t.prev,t,t.next)>0&&ea(e.prev,e,e.next)>0)}function ea(t,e,s){return(e.y-t.y)*(s.x-e.x)-(e.x-t.x)*(s.y-e.y)}function sa(t,e){return t.x===e.x&&t.y===e.y}function na(t,e,s,n){var i=ra(ea(t,e,s)),r=ra(ea(t,e,n)),a=ra(ea(s,n,t)),o=ra(ea(s,n,e));return i!==r&&a!==o||(!(0!==i||!ia(t,s,e))||(!(0!==r||!ia(t,n,e))||(!(0!==a||!ia(s,t,n))||!(0!==o||!ia(s,e,n)))))}function ia(t,e,s){return e.x<=Math.max(t.x,s.x)&&e.x>=Math.min(t.x,s.x)&&e.y<=Math.max(t.y,s.y)&&e.y>=Math.min(t.y,s.y)}function ra(t){return t>0?1:t<0?-1:0}function aa(t,e){return ea(t.prev,t,t.next)<0?ea(t,e,t.next)>=0&&ea(t,t.prev,e)>=0:ea(t,e,t.prev)<0||ea(t,t.next,e)<0}function oa(t,e){var s=new ca(t.i,t.x,t.y),n=new ca(e.i,e.x,e.y),i=t.next,r=e.prev;return t.next=e,e.prev=t,s.next=i,i.prev=s,n.next=s,s.prev=n,r.next=n,n.prev=r,n}function ha(t,e,s,n){var i=new ca(t,e,s);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function la(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ca(t,e,s){this.i=t,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ua(t,e,s,n){for(var i=0,r=e,a=s-n;r<s;r+=n)i+=(t[a]-t[r])*(t[r+1]+t[a+1]),a=r;return i}({get exports(){return Vr},set exports(t){Vr=t}}).exports=$r,Vr.default=$r,$r.deviation=function(t,e,s,n){var i=e&&e.length,r=i?e[0]*s:t.length,a=Math.abs(ua(t,0,r,s));if(i)for(var o=0,h=e.length;o<h;o++){var l=e[o]*s,c=o<h-1?e[o+1]*s:t.length;a-=Math.abs(ua(t,l,c,s))}var u=0;for(o=0;o<n.length;o+=3){var d=n[o]*s,f=n[o+1]*s,p=n[o+2]*s;u+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===a&&0===u?0:Math.abs((u-a)/a)},$r.flatten=function(t){for(var e=t[0][0].length,s={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var r=0;r<t[i].length;r++)for(var a=0;a<e;a++)s.vertices.push(t[i][r][a]);i>0&&(n+=t[i-1].length,s.holes.push(n))}return s};var da={};!function(t,e){!function(s){var n=e&&!e.nodeType&&e,i=t&&!t.nodeType&&t,r="object"==typeof m&&m;r.global!==r&&r.window!==r&&r.self!==r||(s=r);var a,o,h=2147483647,l=36,c=1,u=26,d=38,f=700,p=72,g=128,y="-",v=/^xn--/,x=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=l-c,E=Math.floor,S=String.fromCharCode;function T(t){throw RangeError(b[t])}function A(t,e){for(var s=t.length,n=[];s--;)n[s]=e(t[s]);return n}function C(t,e){var s=t.split("@"),n="";return s.length>1&&(n=s[0]+"@",t=s[1]),n+A((t=t.replace(_,".")).split("."),e).join(".")}function M(t){for(var e,s,n=[],i=0,r=t.length;i<r;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<r?56320==(64512&(s=t.charCodeAt(i++)))?n.push(((1023&e)<<10)+(1023&s)+65536):(n.push(e),i--):n.push(e);return n}function I(t){return A(t,(function(t){var e="";return t>65535&&(e+=S((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=S(t)})).join("")}function P(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function R(t,e,s){var n=0;for(t=s?E(t/f):t>>1,t+=E(t/e);t>w*u>>1;n+=l)t=E(t/w);return E(n+(w+1)*t/(t+d))}function k(t){var e,s,n,i,r,a,o,d,f,m,v,x=[],_=t.length,b=0,w=g,S=p;for((s=t.lastIndexOf(y))<0&&(s=0),n=0;n<s;++n)t.charCodeAt(n)>=128&&T("not-basic"),x.push(t.charCodeAt(n));for(i=s>0?s+1:0;i<_;){for(r=b,a=1,o=l;i>=_&&T("invalid-input"),((d=(v=t.charCodeAt(i++))-48<10?v-22:v-65<26?v-65:v-97<26?v-97:l)>=l||d>E((h-b)/a))&&T("overflow"),b+=d*a,!(d<(f=o<=S?c:o>=S+u?u:o-S));o+=l)a>E(h/(m=l-f))&&T("overflow"),a*=m;S=R(b-r,e=x.length+1,0==r),E(b/e)>h-w&&T("overflow"),w+=E(b/e),b%=e,x.splice(b++,0,w)}return I(x)}function D(t){var e,s,n,i,r,a,o,d,f,m,v,x,_,b,w,A=[];for(x=(t=M(t)).length,e=g,s=0,r=p,a=0;a<x;++a)(v=t[a])<128&&A.push(S(v));for(n=i=A.length,i&&A.push(y);n<x;){for(o=h,a=0;a<x;++a)(v=t[a])>=e&&v<o&&(o=v);for(o-e>E((h-s)/(_=n+1))&&T("overflow"),s+=(o-e)*_,e=o,a=0;a<x;++a)if((v=t[a])<e&&++s>h&&T("overflow"),v==e){for(d=s,f=l;!(d<(m=f<=r?c:f>=r+u?u:f-r));f+=l)w=d-m,b=l-m,A.push(S(P(m+w%b,0))),d=E(w/b);A.push(S(P(d,0))),r=R(s,_,n==i),s=0,++n}++s,++e}return A.join("")}if(a={version:"1.3.2",ucs2:{decode:M,encode:I},decode:k,encode:D,toASCII:function(t){return C(t,(function(t){return x.test(t)?"xn--"+D(t):t}))},toUnicode:function(t){return C(t,(function(t){return v.test(t)?k(t.slice(4).toLowerCase()):t}))}},n&&i)if(t.exports==n)i.exports=a;else for(o in a)a.hasOwnProperty(o)&&(n[o]=a[o]);else s.punycode=a}(m)}({get exports(){return da},set exports(t){da=t}},da);var fa={};function pa(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var ma=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};fa.decode=fa.parse=function(t,e,s,n){e=e||"&",s=s||"=";var i={};if("string"!=typeof t||0===t.length)return i;var r=/\+/g;t=t.split(e);var a=1e3;n&&"number"==typeof n.maxKeys&&(a=n.maxKeys);var o=t.length;a>0&&o>a&&(o=a);for(var h=0;h<o;++h){var l,c,u,d,f=t[h].replace(r,"%20"),p=f.indexOf(s);p>=0?(l=f.substr(0,p),c=f.substr(p+1)):(l=f,c=""),u=decodeURIComponent(l),d=decodeURIComponent(c),pa(i,u)?Array.isArray(i[u])?i[u].push(d):i[u]=[i[u],d]:i[u]=d}return i},fa.encode=fa.stringify=function(t,e,s,n){return e=e||"&",s=s||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map((function(n){var i=encodeURIComponent(ma(n))+s;return Array.isArray(t[n])?t[n].map((function(t){return i+encodeURIComponent(ma(t))})).join(e):i+encodeURIComponent(ma(t[n]))})).join(e):n?encodeURIComponent(ma(n))+s+encodeURIComponent(ma(t)):""};var ga=da,ya={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}},va=Oa,xa=function(t,e){return Oa(t,!1,!0).resolve(e)},_a=function(t){ya.isString(t)&&(t=Oa(t));return t instanceof ba?t.format():ba.prototype.format.call(t)};function ba(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var wa=/^([a-z0-9.+-]+:)/i,Ea=/:[0-9]*$/,Sa=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,Ta=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),Aa=["'"].concat(Ta),Ca=["%","/","?",";","#"].concat(Aa),Ma=["/","?","#"],Ia=/^[+a-z0-9A-Z_-]{0,63}$/,Pa=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Ra={javascript:!0,"javascript:":!0},ka={javascript:!0,"javascript:":!0},Da={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Fa=fa;function Oa(t,e,s){if(t&&ya.isObject(t)&&t instanceof ba)return t;var n=new ba;return n.parse(t,e,s),n}ba.prototype.parse=function(t,e,s){if(!ya.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var n=t.indexOf("?"),i=-1!==n&&n<t.indexOf("#")?"?":"#",r=t.split(i);r[0]=r[0].replace(/\\/g,"/");var a=t=r.join(i);if(a=a.trim(),!s&&1===t.split("#").length){var o=Sa.exec(a);if(o)return this.path=a,this.href=a,this.pathname=o[1],o[2]?(this.search=o[2],this.query=e?Fa.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var h=wa.exec(a);if(h){var l=(h=h[0]).toLowerCase();this.protocol=l,a=a.substr(h.length)}if(s||h||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var c="//"===a.substr(0,2);!c||h&&ka[h]||(a=a.substr(2),this.slashes=!0)}if(!ka[h]&&(c||h&&!Da[h])){for(var u,d,f=-1,p=0;p<Ma.length;p++){-1!==(m=a.indexOf(Ma[p]))&&(-1===f||m<f)&&(f=m)}-1!==(d=-1===f?a.lastIndexOf("@"):a.lastIndexOf("@",f))&&(u=a.slice(0,d),a=a.slice(d+1),this.auth=decodeURIComponent(u)),f=-1;for(p=0;p<Ca.length;p++){var m;-1!==(m=a.indexOf(Ca[p]))&&(-1===f||m<f)&&(f=m)}-1===f&&(f=a.length),this.host=a.slice(0,f),a=a.slice(f),this.parseHost(),this.hostname=this.hostname||"";var g="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!g)for(var y=this.hostname.split(/\./),v=(p=0,y.length);p<v;p++){var x=y[p];if(x&&!x.match(Ia)){for(var _="",b=0,w=x.length;b<w;b++)x.charCodeAt(b)>127?_+="x":_+=x[b];if(!_.match(Ia)){var E=y.slice(0,p),S=y.slice(p+1),T=x.match(Pa);T&&(E.push(T[1]),S.unshift(T[2])),S.length&&(a="/"+S.join(".")+a),this.hostname=E.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),g||(this.hostname=ga.toASCII(this.hostname));var A=this.port?":"+this.port:"",C=this.hostname||"";this.host=C+A,this.href+=this.host,g&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!Ra[l])for(p=0,v=Aa.length;p<v;p++){var M=Aa[p];if(-1!==a.indexOf(M)){var I=encodeURIComponent(M);I===M&&(I=escape(M)),a=a.split(M).join(I)}}var P=a.indexOf("#");-1!==P&&(this.hash=a.substr(P),a=a.slice(0,P));var R=a.indexOf("?");if(-1!==R?(this.search=a.substr(R),this.query=a.substr(R+1),e&&(this.query=Fa.parse(this.query)),a=a.slice(0,R)):e&&(this.search="",this.query={}),a&&(this.pathname=a),Da[l]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){A=this.pathname||"";var k=this.search||"";this.path=A+k}return this.href=this.format(),this},ba.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",s=this.pathname||"",n=this.hash||"",i=!1,r="";this.host?i=t+this.host:this.hostname&&(i=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&ya.isObject(this.query)&&Object.keys(this.query).length&&(r=Fa.stringify(this.query));var a=this.search||r&&"?"+r||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||Da[e])&&!1!==i?(i="//"+(i||""),s&&"/"!==s.charAt(0)&&(s="/"+s)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),e+i+(s=s.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(a=a.replace("#","%23"))+n},ba.prototype.resolve=function(t){return this.resolveObject(Oa(t,!1,!0)).format()},ba.prototype.resolveObject=function(t){if(ya.isString(t)){var e=new ba;e.parse(t,!1,!0),t=e}for(var s=new ba,n=Object.keys(this),i=0;i<n.length;i++){var r=n[i];s[r]=this[r]}if(s.hash=t.hash,""===t.href)return s.href=s.format(),s;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),o=0;o<a.length;o++){var h=a[o];"protocol"!==h&&(s[h]=t[h])}return Da[s.protocol]&&s.hostname&&!s.pathname&&(s.path=s.pathname="/"),s.href=s.format(),s}if(t.protocol&&t.protocol!==s.protocol){if(!Da[t.protocol]){for(var l=Object.keys(t),c=0;c<l.length;c++){var u=l[c];s[u]=t[u]}return s.href=s.format(),s}if(s.protocol=t.protocol,t.host||ka[t.protocol])s.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),s.pathname=d.join("/")}if(s.search=t.search,s.query=t.query,s.host=t.host||"",s.auth=t.auth,s.hostname=t.hostname||t.host,s.port=t.port,s.pathname||s.search){var f=s.pathname||"",p=s.search||"";s.path=f+p}return s.slashes=s.slashes||t.slashes,s.href=s.format(),s}var m=s.pathname&&"/"===s.pathname.charAt(0),g=t.host||t.pathname&&"/"===t.pathname.charAt(0),y=g||m||s.host&&t.pathname,v=y,x=s.pathname&&s.pathname.split("/")||[],_=(d=t.pathname&&t.pathname.split("/")||[],s.protocol&&!Da[s.protocol]);if(_&&(s.hostname="",s.port=null,s.host&&(""===x[0]?x[0]=s.host:x.unshift(s.host)),s.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),y=y&&(""===d[0]||""===x[0])),g)s.host=t.host||""===t.host?t.host:s.host,s.hostname=t.hostname||""===t.hostname?t.hostname:s.hostname,s.search=t.search,s.query=t.query,x=d;else if(d.length)x||(x=[]),x.pop(),x=x.concat(d),s.search=t.search,s.query=t.query;else if(!ya.isNullOrUndefined(t.search)){if(_)s.hostname=s.host=x.shift(),(T=!!(s.host&&s.host.indexOf("@")>0)&&s.host.split("@"))&&(s.auth=T.shift(),s.host=s.hostname=T.shift());return s.search=t.search,s.query=t.query,ya.isNull(s.pathname)&&ya.isNull(s.search)||(s.path=(s.pathname?s.pathname:"")+(s.search?s.search:"")),s.href=s.format(),s}if(!x.length)return s.pathname=null,s.search?s.path="/"+s.search:s.path=null,s.href=s.format(),s;for(var b=x.slice(-1)[0],w=(s.host||t.host||x.length>1)&&("."===b||".."===b)||""===b,E=0,S=x.length;S>=0;S--)"."===(b=x[S])?x.splice(S,1):".."===b?(x.splice(S,1),E++):E&&(x.splice(S,1),E--);if(!y&&!v)for(;E--;E)x.unshift("..");!y||""===x[0]||x[0]&&"/"===x[0].charAt(0)||x.unshift(""),w&&"/"!==x.join("/").substr(-1)&&x.push("");var T,A=""===x[0]||x[0]&&"/"===x[0].charAt(0);_&&(s.hostname=s.host=A?"":x.length?x.shift():"",(T=!!(s.host&&s.host.indexOf("@")>0)&&s.host.split("@"))&&(s.auth=T.shift(),s.host=s.hostname=T.shift()));return(y=y||s.host&&x.length)&&!A&&x.unshift(""),x.length?s.pathname=x.join("/"):(s.pathname=null,s.path=null),ya.isNull(s.pathname)&&ya.isNull(s.search)||(s.path=(s.pathname?s.pathname:"")+(s.search?s.search:"")),s.auth=t.auth||s.auth,s.slashes=s.slashes||t.slashes,s.href=s.format(),s},ba.prototype.parseHost=function(){var t=this.host,e=Ea.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};const Na={parse:va,format:_a,resolve:xa};function Ba(t){if("string"!=typeof t)throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function La(t){return t.split("?")[0].split("#")[0]}const Va={toPosix(t){return e="\\",s="/",t.replace(new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),s);var e,s},isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl:t=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t),hasProtocol(t){return/^[^/:]+:\//.test(this.toPosix(t))},getProtocol(t){Ba(t),t=this.toPosix(t);let e="";const s=/^file:\/\/\//.exec(t),n=/^[^/:]+:\/\//.exec(t),i=/^[^/:]+:\//.exec(t);if(s||n||i){const r=(null==s?void 0:s[0])||(null==n?void 0:n[0])||(null==i?void 0:i[0]);e=r,t=t.slice(r.length)}return e},toAbsolute(t,e,s){if(this.isDataUrl(t))return t;const n=La(this.toPosix(null!=e?e:_r.ADAPTER.getBaseUrl())),i=La(this.toPosix(null!=s?s:this.rootname(n)));if(Ba(t),(t=this.toPosix(t)).startsWith("/"))return Va.join(i,t.slice(1));return this.isAbsolute(t)?t:this.join(n,t)},normalize(t){if(Ba(t=this.toPosix(t)),0===t.length)return".";let e="";const s=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const n=t.endsWith("/");return(t=function(t,e){let s="",n=0,i=-1,r=0,a=-1;for(let o=0;o<=t.length;++o){if(o<t.length)a=t.charCodeAt(o);else{if(47===a)break;a=47}if(47===a){if(i===o-1||1===r);else if(i!==o-1&&2===r){if(s.length<2||2!==n||46!==s.charCodeAt(s.length-1)||46!==s.charCodeAt(s.length-2))if(s.length>2){const t=s.lastIndexOf("/");if(t!==s.length-1){-1===t?(s="",n=0):(s=s.slice(0,t),n=s.length-1-s.lastIndexOf("/")),i=o,r=0;continue}}else if(2===s.length||1===s.length){s="",n=0,i=o,r=0;continue}e&&(s.length>0?s+="/..":s="..",n=2)}else s.length>0?s+=`/${t.slice(i+1,o)}`:s=t.slice(i+1,o),n=o-i-1;i=o,r=0}else 46===a&&-1!==r?++r:r=-1}return s}(t,!1)).length>0&&n&&(t+="/"),s?`/${t}`:e+t},isAbsolute(t){return Ba(t),t=this.toPosix(t),!!this.hasProtocol(t)||t.startsWith("/")},join(...t){var e;if(0===t.length)return".";let s;for(let n=0;n<t.length;++n){const i=t[n];if(Ba(i),i.length>0)if(void 0===s)s=i;else{const r=null!=(e=t[n-1])?e:"";this.extname(r)?s+=`/../${i}`:s+=`/${i}`}}return void 0===s?".":this.normalize(s)},dirname(t){if(Ba(t),0===t.length)return".";let e=(t=this.toPosix(t)).charCodeAt(0);const s=47===e;let n=-1,i=!0;const r=this.getProtocol(t),a=t;for(let o=(t=t.slice(r.length)).length-1;o>=1;--o)if(e=t.charCodeAt(o),47===e){if(!i){n=o;break}}else i=!1;return-1===n?s?"/":this.isUrl(a)?r+t:r:s&&1===n?"//":r+t.slice(0,n)},rootname(t){Ba(t);let e="";if(e=(t=this.toPosix(t)).startsWith("/")?"/":this.getProtocol(t),this.isUrl(t)){const s=t.indexOf("/",e.length);e=-1!==s?t.slice(0,s):t,e.endsWith("/")||(e+="/")}return e},basename(t,e){Ba(t),e&&Ba(e),t=La(this.toPosix(t));let s,n=0,i=-1,r=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let a=e.length-1,o=-1;for(s=t.length-1;s>=0;--s){const h=t.charCodeAt(s);if(47===h){if(!r){n=s+1;break}}else-1===o&&(r=!1,o=s+1),a>=0&&(h===e.charCodeAt(a)?-1==--a&&(i=s):(a=-1,i=o))}return n===i?i=o:-1===i&&(i=t.length),t.slice(n,i)}for(s=t.length-1;s>=0;--s)if(47===t.charCodeAt(s)){if(!r){n=s+1;break}}else-1===i&&(r=!1,i=s+1);return-1===i?"":t.slice(n,i)},extname(t){Ba(t);let e=-1,s=0,n=-1,i=!0,r=0;for(let a=(t=La(this.toPosix(t))).length-1;a>=0;--a){const o=t.charCodeAt(a);if(47!==o)-1===n&&(i=!1,n=a+1),46===o?-1===e?e=a:1!==r&&(r=1):-1!==e&&(r=-1);else if(!i){s=a+1;break}}return-1===e||-1===n||0===r||1===r&&e===n-1&&e===s+1?"":t.slice(e,n)},parse(t){Ba(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;let s=(t=La(this.toPosix(t))).charCodeAt(0);const n=this.isAbsolute(t);let i;e.root=this.rootname(t),i=n||this.hasProtocol(t)?1:0;let r=-1,a=0,o=-1,h=!0,l=t.length-1,c=0;for(;l>=i;--l)if(s=t.charCodeAt(l),47!==s)-1===o&&(h=!1,o=l+1),46===s?-1===r?r=l:1!==c&&(c=1):-1!==r&&(c=-1);else if(!h){a=l+1;break}return-1===r||-1===o||0===c||1===c&&r===o-1&&r===a+1?-1!==o&&(e.base=e.name=0===a&&n?t.slice(1,o):t.slice(a,o)):(0===a&&n?(e.name=t.slice(1,r),e.base=t.slice(1,o)):(e.name=t.slice(a,r),e.base=t.slice(a,o)),e.ext=t.slice(r,o)),e.dir=this.dirname(t),e},sep:"/",delimiter:":"},$a={};function Ua(t,e,s=3){if($a[e])return;let n=(new Error).stack;void 0===n?console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`):(n=n.split("\n").splice(s).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}\nDeprecated since v${t}`),console.warn(n),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`),console.warn(n))),$a[e]=!0}let Xa;var Ya,Wa={grad:.9,turn:360,rad:360/(2*Math.PI)},ja=function(t){return"string"==typeof t?t.length>0:"number"==typeof t},za=function(t,e,s){return void 0===e&&(e=0),void 0===s&&(s=Math.pow(10,e)),Math.round(s*t)/s+0},Ga=function(t,e,s){return void 0===e&&(e=0),void 0===s&&(s=1),t>s?s:t>e?t:e},Ha=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},qa=function(t){return{r:Ga(t.r,0,255),g:Ga(t.g,0,255),b:Ga(t.b,0,255),a:Ga(t.a)}},Ka=function(t){return{r:za(t.r),g:za(t.g),b:za(t.b),a:za(t.a,3)}},Za=/^#([0-9a-f]{3,8})$/i,Qa=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},Ja=function(t){var e=t.r,s=t.g,n=t.b,i=t.a,r=Math.max(e,s,n),a=r-Math.min(e,s,n),o=a?r===e?(s-n)/a:r===s?2+(n-e)/a:4+(e-s)/a:0;return{h:60*(o<0?o+6:o),s:r?a/r*100:0,v:r/255*100,a:i}},to=function(t){var e=t.h,s=t.s,n=t.v,i=t.a;e=e/360*6,s/=100,n/=100;var r=Math.floor(e),a=n*(1-s),o=n*(1-(e-r)*s),h=n*(1-(1-e+r)*s),l=r%6;return{r:255*[n,o,a,a,h,n][l],g:255*[h,n,n,o,a,a][l],b:255*[a,a,h,n,n,o][l],a:i}},eo=function(t){return{h:Ha(t.h),s:Ga(t.s,0,100),l:Ga(t.l,0,100),a:Ga(t.a)}},so=function(t){return{h:za(t.h),s:za(t.s),l:za(t.l),a:za(t.a,3)}},no=function(t){return to((s=(e=t).s,{h:e.h,s:(s*=((n=e.l)<50?n:100-n)/100)>0?2*s/(n+s)*100:0,v:n+s,a:e.a}));var e,s,n},io=function(t){return{h:(e=Ja(t)).h,s:(i=(200-(s=e.s))*(n=e.v)/100)>0&&i<200?s*n/100/(i<=100?i:200-i)*100:0,l:i/2,a:e.a};var e,s,n,i},ro=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ao=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,oo=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ho=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,lo={string:[[function(t){var e=Za.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:4===t.length?za(parseInt(t[3]+t[3],16)/255,2):1}:6===t.length||8===t.length?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8===t.length?za(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=oo.exec(t)||ho.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:qa({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:void 0===e[7]?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=ro.exec(t)||ao.exec(t);if(!e)return null;var s,n,i=eo({h:(s=e[1],n=e[2],void 0===n&&(n="deg"),Number(s)*(Wa[n]||1)),s:Number(e[3]),l:Number(e[4]),a:void 0===e[5]?1:Number(e[5])/(e[6]?100:1)});return no(i)},"hsl"]],object:[[function(t){var e=t.r,s=t.g,n=t.b,i=t.a,r=void 0===i?1:i;return ja(e)&&ja(s)&&ja(n)?qa({r:Number(e),g:Number(s),b:Number(n),a:Number(r)}):null},"rgb"],[function(t){var e=t.h,s=t.s,n=t.l,i=t.a,r=void 0===i?1:i;if(!ja(e)||!ja(s)||!ja(n))return null;var a=eo({h:Number(e),s:Number(s),l:Number(n),a:Number(r)});return no(a)},"hsl"],[function(t){var e=t.h,s=t.s,n=t.v,i=t.a,r=void 0===i?1:i;if(!ja(e)||!ja(s)||!ja(n))return null;var a,o=(a={h:Number(e),s:Number(s),v:Number(n),a:Number(r)},{h:Ha(a.h),s:Ga(a.s,0,100),v:Ga(a.v,0,100),a:Ga(a.a)});return to(o)},"hsv"]]},co=function(t,e){for(var s=0;s<e.length;s++){var n=e[s][0](t);if(n)return[n,e[s][1]]}return[null,void 0]},uo=function(t){return"string"==typeof t?co(t.trim(),lo.string):"object"==typeof t&&null!==t?co(t,lo.object):[null,void 0]},fo=function(t,e){var s=io(t);return{h:s.h,s:Ga(s.s+100*e,0,100),l:s.l,a:s.a}},po=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},mo=function(t,e){var s=io(t);return{h:s.h,s:s.s,l:Ga(s.l+100*e,0,100),a:s.a}},go=function(){function t(t){this.parsed=uo(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return null!==this.parsed},t.prototype.brightness=function(){return za(po(this.rgba),2)},t.prototype.isDark=function(){return po(this.rgba)<.5},t.prototype.isLight=function(){return po(this.rgba)>=.5},t.prototype.toHex=function(){return e=(t=Ka(this.rgba)).r,s=t.g,n=t.b,r=(i=t.a)<1?Qa(za(255*i)):"","#"+Qa(e)+Qa(s)+Qa(n)+r;var t,e,s,n,i,r},t.prototype.toRgb=function(){return Ka(this.rgba)},t.prototype.toRgbString=function(){return e=(t=Ka(this.rgba)).r,s=t.g,n=t.b,(i=t.a)<1?"rgba("+e+", "+s+", "+n+", "+i+")":"rgb("+e+", "+s+", "+n+")";var t,e,s,n,i},t.prototype.toHsl=function(){return so(io(this.rgba))},t.prototype.toHslString=function(){return e=(t=so(io(this.rgba))).h,s=t.s,n=t.l,(i=t.a)<1?"hsla("+e+", "+s+"%, "+n+"%, "+i+")":"hsl("+e+", "+s+"%, "+n+"%)";var t,e,s,n,i},t.prototype.toHsv=function(){return t=Ja(this.rgba),{h:za(t.h),s:za(t.s),v:za(t.v),a:za(t.a,3)};var t},t.prototype.invert=function(){return yo({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},t.prototype.saturate=function(t){return void 0===t&&(t=.1),yo(fo(this.rgba,t))},t.prototype.desaturate=function(t){return void 0===t&&(t=.1),yo(fo(this.rgba,-t))},t.prototype.grayscale=function(){return yo(fo(this.rgba,-1))},t.prototype.lighten=function(t){return void 0===t&&(t=.1),yo(mo(this.rgba,t))},t.prototype.darken=function(t){return void 0===t&&(t=.1),yo(mo(this.rgba,-t))},t.prototype.rotate=function(t){return void 0===t&&(t=15),this.hue(this.hue()+t)},t.prototype.alpha=function(t){return"number"==typeof t?yo({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):za(this.rgba.a,3);var e},t.prototype.hue=function(t){var e=io(this.rgba);return"number"==typeof t?yo({h:t,s:e.s,l:e.l,a:e.a}):za(e.h)},t.prototype.isEqual=function(t){return this.toHex()===yo(t).toHex()},t}(),yo=function(t){return t instanceof go?t:new go(t)},vo=[];Ya=[function(t,e){var s={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},n={};for(var i in s)n[s[i]]=i;var r={};t.prototype.toName=function(e){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var i,a,o=n[this.toHex()];if(o)return o;if(null==e?void 0:e.closest){var h=this.toRgb(),l=1/0,c="black";if(!r.length)for(var u in s)r[u]=new t(s[u]).toRgb();for(var d in s){var f=(i=h,a=r[d],Math.pow(i.r-a.r,2)+Math.pow(i.g-a.g,2)+Math.pow(i.b-a.b,2));f<l&&(l=f,c=d)}return c}},e.string.push([function(e){var n=e.toLowerCase(),i="transparent"===n?"#0000":s[n];return i?new t(i).toRgb():null},"name"])}],Ya.forEach((function(t){vo.indexOf(t)<0&&(t(go,lo),vo.push(t))}));const xo=class{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof xo)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(null===t)throw new Error("Cannot set PIXI.Color#value to null");null!==this._value&&this.isSourceEqual(this._value,t)||(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return"string"==typeof t||"number"==typeof t||t instanceof Number||null===t?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):"object"==typeof t&&null!==t?l({},t):t}isSourceEqual(t,e){const s=typeof t;if(s!==typeof e)return!1;if("number"===s||"string"===s||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length===e.length&&t.every(((t,s)=>t===e[s]));if(null!==t&&null!==e){const s=Object.keys(t),n=Object.keys(e);return s.length===n.length&&s.every((s=>t[s]===e[s]))}return t===e}toRgba(){const[t,e,s,n]=this._components;return{r:t,g:e,b:s,a:n}}toRgb(){const[t,e,s]=this._components;return{r:t,g:e,b:s}}toRgbaString(){const[t,e,s]=this.toUint8RgbArray();return`rgba(${t},${e},${s},${this.alpha})`}toUint8RgbArray(t){const[e,s,n]=this._components;return(t=null!=t?t:[])[0]=Math.round(255*e),t[1]=Math.round(255*s),t[2]=Math.round(255*n),t}toRgbArray(t){t=null!=t?t:[];const[e,s,n]=this._components;return t[0]=e,t[1]=s,t[2]=n,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(65280&t)+((255&t)<<16)}multiply(t){const[e,s,n,i]=xo.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=s,this._components[2]*=n,this._components[3]*=i,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(1===t)return(255<<24)+this._int;if(0===t)return e?0:this._int;let s=this._int>>16&255,n=this._int>>8&255,i=255&this._int;return e&&(s=s*t+.5|0,n=n*t+.5|0,i=i*t+.5|0),(255*t<<24)+(s<<16)+(n<<8)+i}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,s,n]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(s*t)/t,this._components[2]=Math.round(n*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=null!=t?t:[];const[e,s,n,i]=this._components;return t[0]=e,t[1]=s,t[2]=n,t[3]=i,t}normalize(t){let e,s,n,i;if(("number"==typeof t||t instanceof Number)&&t>=0&&t<=16777215){e=(t>>16&255)/255,s=(t>>8&255)/255,n=(255&t)/255,i=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,s,n,i=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,s,n,i=255]=t,e/=255,s/=255,n/=255,i/=255;else if("string"==typeof t||"object"==typeof t){if("string"==typeof t){const e=xo.HEX_PATTERN.exec(t);e&&(t=`#${e[2]}`)}const r=yo(t);r.isValid()&&(({r:e,g:s,b:n,a:i}=r.rgba),e/=255,s/=255,n/=255)}if(void 0===e)throw new Error(`Unable to convert color ${t}`);this._components[0]=e,this._components[1]=s,this._components[2]=n,this._components[3]=i,this.refreshInt()}refreshInt(){this._clamp(this._components);const[t,e,s]=this._components;this._int=(255*t<<16)+(255*e<<8)+(255*s|0)}_clamp(t,e=0,s=1){return"number"==typeof t?Math.min(Math.max(t,e),s):(t.forEach(((n,i)=>{t[i]=Math.min(Math.max(n,e),s)})),t)}};let _o=xo;function bo(t,e=[]){return Ua("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),_o.shared.setValue(t).toRgbArray(e)}function wo(t){return Ua("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),_o.shared.setValue(t).toNumber()}_o.shared=new xo,_o.temp=new xo,_o.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;const Eo=function(){const t=[],e=[];for(let n=0;n<32;n++)t[n]=n,e[n]=n;t[ir.NORMAL_NPM]=ir.NORMAL,t[ir.ADD_NPM]=ir.ADD,t[ir.SCREEN_NPM]=ir.SCREEN,e[ir.NORMAL]=ir.NORMAL_NPM,e[ir.ADD]=ir.ADD_NPM,e[ir.SCREEN]=ir.SCREEN_NPM;const s=[];return s.push(e),s.push(t),s}();function So(t,e){return Eo[e?1:0][t]}function To(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}function Ao(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function Co(t){return!(t&t-1||!t)}function Mo(t){let e=(t>65535?1:0)<<4,s=((t>>>=e)>255?1:0)<<3;return e|=s,s=((t>>>=s)>15?1:0)<<2,e|=s,s=((t>>>=s)>3?1:0)<<1,e|=s,e|(t>>>=s)>>1}function Io(t,e,s){const n=t.length;let i;if(e>=n||0===s)return;const r=n-(s=e+s>n?n-e:s);for(i=e;i<r;++i)t[i]=t[i+s];t.length=r}function Po(t){return 0===t?0:t<0?-1:1}let Ro=0;function ko(){return++Ro}const Do=class{constructor(t,e,s,n){this.left=t,this.top=e,this.right=s,this.bottom=n}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let Fo=Do;Fo.EMPTY=new Do(0,0,0,0);const Oo={},No=Object.create(null),Bo=Object.create(null);class Lo{constructor(t,e,s){this._canvas=_r.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=s||_r.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function Vo(t,e,s){for(let n=0,i=4*s*e;n<e;++n,i+=4)if(0!==t[i+3])return!1;return!0}function $o(t,e,s,n,i){const r=4*e;for(let a=n,o=n*r+4*s;a<=i;++a,o+=r)if(0!==t[o+3])return!1;return!0}function Uo(t){const e=function(t){const{width:e,height:s}=t,n=t.getContext("2d",{willReadFrequently:!0});if(null===n)throw new TypeError("Failed to get canvas 2D context");const i=n.getImageData(0,0,e,s).data;let r=0,a=0,o=e-1,h=s-1;for(;a<s&&Vo(i,e,a);)++a;if(a===s)return Fo.EMPTY;for(;Vo(i,e,h);)--h;for(;$o(i,e,r,a,h);)++r;for(;$o(i,e,o,a,h);)--o;return++o,++h,new Fo(r,a,o,h)}(t),{width:s,height:n}=e;let i=null;if(!e.isEmpty()){const r=t.getContext("2d");if(null===r)throw new TypeError("Failed to get canvas 2D context");i=r.getImageData(e.left,e.top,s,n)}return{width:s,height:n,data:i}}let Xo;function Yo(t,e=1){var s;const n=null==(s=_r.RETINA_PREFIX)?void 0:s.exec(t);return n?parseFloat(n[1]):e}var Wo=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))(Wo||{});const jo=t=>{if("function"==typeof t||"object"==typeof t&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");const e="object"!=typeof t.extension?{type:t.extension}:t.extension;t=c(l({},e),{ref:t})}if("object"!=typeof t)throw new Error("Invalid extension type");return"string"==typeof(t=l({},t)).type&&(t.type=[t.type]),t},zo=(t,e)=>{var s;return null!=(s=jo(t).priority)?s:e},Go={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(jo).forEach((t=>{t.type.forEach((e=>{var s,n;return null==(n=(s=this._removeHandlers)[e])?void 0:n.call(s,t)}))})),this},add(...t){return t.map(jo).forEach((t=>{t.type.forEach((e=>{const s=this._addHandlers,n=this._queue;s[e]?s[e](t):(n[e]=n[e]||[],n[e].push(t))}))})),this},handle(t,e,s){const n=this._addHandlers,i=this._removeHandlers;if(n[t]||i[t])throw new Error(`Extension type ${t} already has a handler`);n[t]=e,i[t]=s;const r=this._queue;return r[t]&&(r[t].forEach((t=>e(t))),delete r[t]),this},handleByMap(t,e){return this.handle(t,(t=>{e[t.name]=t.ref}),(t=>{delete e[t.name]}))},handleByList(t,e,s=-1){return this.handle(t,(t=>{e.includes(t.ref)||(e.push(t.ref),e.sort(((t,e)=>zo(e,s)-zo(t,s))))}),(t=>{const s=e.indexOf(t.ref);-1!==s&&e.splice(s,1)}))}};class Ho{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const qo=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Ko(t){let e="";for(let s=0;s<t;++s)s>0&&(e+="\nelse "),s<t-1&&(e+=`if(test == ${s}.0){}`);return e}class Zo{constructor(){this.data=0,this.blendMode=ir.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==ir.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new Zo;return t.depthTest=!1,t.blend=!0,t}}const Qo=[];function Jo(t,e){if(!t)return null;let s="";if("string"==typeof t){const e=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);e&&(s=e[1].toLowerCase())}for(let n=Qo.length-1;n>=0;--n){const i=Qo[n];if(i.test&&i.test(t,s))return new i(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class th{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,s,n,i,r,a,o){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:l}=this;this._aliasCount++;for(let c=0,u=l.length;c<u;c++)l[c][h](t,e,s,n,i,r,a,o);return l===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(th.prototype,{dispatch:{value:th.prototype.emit},run:{value:th.prototype.emit}});class eh{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new th("setRealSize"),this.onUpdate=new th("update"),this.onError=new th("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,s){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class sh extends eh{constructor(t,e){const{width:s,height:n}=e||{};if(!s||!n)throw new Error("BufferResource width or height invalid");super(s,n),this.data=t}upload(t,e,s){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===fr.UNPACK);const i=e.realWidth,r=e.realHeight;return s.width===i&&s.height===r?n.texSubImage2D(e.target,0,0,0,i,r,e.format,s.type,this.data):(s.width=i,s.height=r,n.texImage2D(e.target,0,s.internalFormat,i,r,0,e.format,s.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const nh={scaleMode:cr.NEAREST,format:ar.RGBA,alphaMode:fr.NPM},ih=class extends g{constructor(t=null,e=null){super(),e=Object.assign({},ih.defaultOptions,e);const{alphaMode:s,mipmap:n,anisotropicLevel:i,scaleMode:r,width:a,height:o,wrapMode:h,format:l,type:c,target:u,resolution:d,resourceOptions:f}=e;!t||t instanceof eh||((t=Jo(t,f)).internal=!0),this.resolution=d||_r.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((o||0)*this.resolution)/this.resolution,this._mipmap=n,this.anisotropicLevel=i,this._wrapMode=h,this._scaleMode=r,this.format=l,this.type=c,this.target=u,this.alphaMode=s,this.uid=ko(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&o>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let s;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,s=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,s=!0),s&&this.dirtyStyleId++,this}setSize(t,e,s){return s=s||this.resolution,this.setRealSize(t*s,e*s,s)}setRealSize(t,e,s){return this.resolution=s||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Co(this.realWidth)&&Co(this.realHeight)}setResolution(t){const e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Bo[this.cacheId],delete No[this.cacheId],this.cacheId=null),this.dispose(),ih.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,s=_r.STRICT_TEXTURE_CACHE){const n="string"==typeof t;let i=null;if(n)i=t;else{if(!t._pixiId){const s=(null==e?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${s}_${ko()}`}i=t._pixiId}let r=Bo[i];if(n&&s&&!r)throw new Error(`The cacheId "${i}" does not exist in BaseTextureCache.`);return r||(r=new ih(t,e),r.cacheId=i,ih.addToCache(r,i)),r}static fromBuffer(t,e,s,n){t=t||new Float32Array(e*s*4);const i=new sh(t,{width:e,height:s}),r=t instanceof Float32Array?hr.FLOAT:hr.UNSIGNED_BYTE;return new ih(i,Object.assign({},nh,{type:r},n))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Bo[e]&&Bo[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),Bo[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=Bo[t];if(e){const s=e.textureCacheIds.indexOf(t);return s>-1&&e.textureCacheIds.splice(s,1),delete Bo[t],e}}else if(null==t?void 0:t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete Bo[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};let rh=ih;rh.defaultOptions={mipmap:dr.POW2,anisotropicLevel:0,scaleMode:cr.LINEAR,wrapMode:ur.CLAMP,alphaMode:fr.UNPACK,target:or.TEXTURE_2D,format:ar.RGBA,type:hr.UNSIGNED_BYTE},rh._globalBatch=0;class ah{constructor(){this.texArray=null,this.blend=0,this.type=rr.TRIANGLES,this.start=0,this.size=0,this.data=null}}let oh=0;class hh{constructor(t,e=!0,s=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=s,this.static=e,this.id=oh++,this.disposeRunner=new th("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?xr.ELEMENT_ARRAY_BUFFER:xr.ARRAY_BUFFER}get index(){return this.type===xr.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new hh(t)}}class lh{constructor(t,e=0,s=!1,n=hr.FLOAT,i,r,a,o=1){this.buffer=t,this.size=e,this.normalized=s,this.type=n,this.stride=i,this.start=r,this.instance=a,this.divisor=o}destroy(){this.buffer=null}static from(t,e,s,n,i){return new lh(t,e,s,n,i)}}const ch={Float32Array,Uint32Array,Int32Array,Uint8Array};const uh={5126:4,5123:2,5121:1};let dh=0;const fh={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class ph{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=dh++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new th("disposeGeometry"),this.refCount=0}addAttribute(t,e,s=0,n=!1,i,r,a,o=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof hh||(e instanceof Array&&(e=new Float32Array(e)),e=new hh(e));const h=t.split("|");if(h.length>1){for(let t=0;t<h.length;t++)this.addAttribute(h[t],e,s,n,i);return this}let l=this.buffers.indexOf(e);return-1===l&&(this.buffers.push(e),l=this.buffers.length-1),this.attributes[t]=new lh(l,s,n,i,r,a,o),this.instanced=this.instanced||o,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof hh||(t instanceof Array&&(t=new Uint16Array(t)),t=new hh(t)),t.type=xr.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const t=[],e=[],s=new hh;let n;for(n in this.attributes){const s=this.attributes[n],i=this.buffers[s.buffer];t.push(i.data),e.push(s.size*uh[s.type]/4),s.buffer=0}for(s.data=function(t,e){let s=0,n=0;const i={};for(let h=0;h<t.length;h++)n+=e[h],s+=t[h].length;const r=new ArrayBuffer(4*s);let a=null,o=0;for(let h=0;h<t.length;h++){const s=e[h],l=t[h],c=To(l);i[c]||(i[c]=new ch[c](r)),a=i[c];for(let t=0;t<l.length;t++)a[(t/s|0)*n+o+t%s]=l[t];o+=s}return new Float32Array(r)}(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[s],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new ph;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new hh(this.buffers[e].data.slice(0));for(const e in this.attributes){const s=this.attributes[e];t.attributes[e]=new lh(s.buffer,s.size,s.normalized,s.type,s.stride,s.start,s.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=xr.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new ph,s=[],n=[],i=[];let r;for(let a=0;a<t.length;a++){r=t[a];for(let t=0;t<r.buffers.length;t++)n[t]=n[t]||0,n[t]+=r.buffers[t].data.length,i[t]=0}for(let a=0;a<r.buffers.length;a++)s[a]=new(fh[To(r.buffers[a].data)])(n[a]),e.buffers[a]=new hh(s[a]);for(let a=0;a<t.length;a++){r=t[a];for(let t=0;t<r.buffers.length;t++)s[t].set(r.buffers[t].data,i[t]),i[t]+=r.buffers[t].data.length}if(e.attributes=r.attributes,r.indexBuffer){e.indexBuffer=e.buffers[r.buffers.indexOf(r.indexBuffer)],e.indexBuffer.type=xr.ELEMENT_ARRAY_BUFFER;let s=0,n=0,i=0,a=0;for(let t=0;t<r.buffers.length;t++)if(r.buffers[t]!==r.indexBuffer){a=t;break}for(const t in r.attributes){const e=r.attributes[t];(0|e.buffer)===a&&(n+=e.size*uh[e.type]/4)}for(let r=0;r<t.length;r++){const o=t[r].indexBuffer.data;for(let t=0;t<o.length;t++)e.indexBuffer.data[t+i]+=s;s+=t[r].buffers[a].data.length/n,i+=o.length}}return e}}class mh extends ph{constructor(t=!1){super(),this._buffer=new hh(null,t,!1),this._indexBuffer=new hh(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,hr.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,hr.FLOAT).addAttribute("aColor",this._buffer,4,!0,hr.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,hr.FLOAT).addIndex(this._indexBuffer)}}const gh=2*Math.PI,yh=180/Math.PI,vh=Math.PI/180;var xh=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))(xh||{});class _h{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new _h(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const bh=[new _h,new _h,new _h,new _h];let wh=class t{constructor(t=0,e=0,s=0,n=0){this.x=Number(t),this.y=Number(e),this.width=Number(s),this.height=Number(n),this.type=xh.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new t(0,0,0,0)}clone(){return new t(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)}intersects(t,e){if(!e){const e=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=e)return!1;const s=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>s}const s=this.left,n=this.right,i=this.top,r=this.bottom;if(n<=s||r<=i)return!1;const a=bh[0].set(t.left,t.top),o=bh[1].set(t.left,t.bottom),h=bh[2].set(t.right,t.top),l=bh[3].set(t.right,t.bottom);if(h.x<=a.x||o.y<=a.y)return!1;const c=Math.sign(e.a*e.d-e.b*e.c);if(0===c)return!1;if(e.apply(a,a),e.apply(o,o),e.apply(h,h),e.apply(l,l),Math.max(a.x,o.x,h.x,l.x)<=s||Math.min(a.x,o.x,h.x,l.x)>=n||Math.max(a.y,o.y,h.y,l.y)<=i||Math.min(a.y,o.y,h.y,l.y)>=r)return!1;const u=c*(o.y-a.y),d=c*(a.x-o.x),f=u*s+d*i,p=u*n+d*i,m=u*s+d*r,g=u*n+d*r;if(Math.max(f,p,m,g)<=u*a.x+d*a.y||Math.min(f,p,m,g)>=u*l.x+d*l.y)return!1;const y=c*(a.y-h.y),v=c*(h.x-a.x),x=y*s+v*i,_=y*n+v*i,b=y*s+v*r,w=y*n+v*r;return!(Math.max(x,_,b,w)<=y*a.x+v*a.y||Math.min(x,_,b,w)>=y*l.x+v*l.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),s=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),i=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(s-e,0),this.y=n,this.height=Math.max(i-n,0),this}ceil(t=1,e=.001){const s=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=s-this.x,this.height=n-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),s=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),i=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=s-e,this.y=n,this.height=i-n,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}};class Eh{constructor(t=0,e=0,s=0){this.x=t,this.y=e,this.radius=s,this.type=xh.CIRC}clone(){return new Eh(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const s=this.radius*this.radius;let n=this.x-t,i=this.y-e;return n*=n,i*=i,n+i<=s}getBounds(){return new wh(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Sh{constructor(t=0,e=0,s=0,n=0){this.x=t,this.y=e,this.width=s,this.height=n,this.type=xh.ELIP}clone(){return new Sh(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let s=(t-this.x)/this.width,n=(e-this.y)/this.height;return s*=s,n*=n,s+n<=1}getBounds(){return new wh(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Th{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let s=0,n=e.length;s<n;s++)t.push(e[s].x,e[s].y);e=t}this.points=e,this.type=xh.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new Th(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let s=!1;const n=this.points.length/2;for(let i=0,r=n-1;i<n;r=i++){const n=this.points[2*i],a=this.points[2*i+1],o=this.points[2*r],h=this.points[2*r+1];a>e!=h>e&&t<(e-a)/(h-a)*(o-n)+n&&(s=!s)}return s}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce(((t,e)=>`${t}, ${e}`),"")}]`}}class Ah{constructor(t=0,e=0,s=0,n=0,i=20){this.x=t,this.y=e,this.width=s,this.height=n,this.radius=i,this.type=xh.RREC}clone(){return new Ah(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const s=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+s&&e<=this.y+this.height-s||t>=this.x+s&&t<=this.x+this.width-s)return!0;let n=t-(this.x+s),i=e-(this.y+s);const r=s*s;if(n*n+i*i<=r)return!0;if(n=t-(this.x+this.width-s),n*n+i*i<=r)return!0;if(i=e-(this.y+this.height-s),n*n+i*i<=r)return!0;if(n=t-(this.x+s),n*n+i*i<=r)return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class Ch{constructor(t=1,e=0,s=0,n=1,i=0,r=0){this.array=null,this.a=t,this.b=e,this.c=s,this.d=n,this.tx=i,this.ty=r}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,s,n,i,r){return this.a=t,this.b=e,this.c=s,this.d=n,this.tx=i,this.ty=r,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const s=e||this.array;return t?(s[0]=this.a,s[1]=this.b,s[2]=0,s[3]=this.c,s[4]=this.d,s[5]=0,s[6]=this.tx,s[7]=this.ty,s[8]=1):(s[0]=this.a,s[1]=this.c,s[2]=this.tx,s[3]=this.b,s[4]=this.d,s[5]=this.ty,s[6]=0,s[7]=0,s[8]=1),s}apply(t,e){e=e||new _h;const s=t.x,n=t.y;return e.x=this.a*s+this.c*n+this.tx,e.y=this.b*s+this.d*n+this.ty,e}applyInverse(t,e){e=e||new _h;const s=1/(this.a*this.d+this.c*-this.b),n=t.x,i=t.y;return e.x=this.d*s*n+-this.c*s*i+(this.ty*this.c-this.tx*this.d)*s,e.y=this.a*s*i+-this.b*s*n+(-this.ty*this.a+this.tx*this.b)*s,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),s=Math.sin(t),n=this.a,i=this.c,r=this.tx;return this.a=n*e-this.b*s,this.b=n*s+this.b*e,this.c=i*e-this.d*s,this.d=i*s+this.d*e,this.tx=r*e-this.ty*s,this.ty=r*s+this.ty*e,this}append(t){const e=this.a,s=this.b,n=this.c,i=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*s+t.b*i,this.c=t.c*e+t.d*n,this.d=t.c*s+t.d*i,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*s+t.ty*i+this.ty,this}setTransform(t,e,s,n,i,r,a,o,h){return this.a=Math.cos(a+h)*i,this.b=Math.sin(a+h)*i,this.c=-Math.sin(a-o)*r,this.d=Math.cos(a-o)*r,this.tx=t-(s*this.a+n*this.c),this.ty=e-(s*this.b+n*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const e=this.a,s=this.c;this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,s=this.b,n=this.c,i=this.d,r=t.pivot,a=-Math.atan2(-n,i),o=Math.atan2(s,e),h=Math.abs(a+o);return h<1e-5||Math.abs(gh-h)<1e-5?(t.rotation=o,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=o),t.scale.x=Math.sqrt(e*e+s*s),t.scale.y=Math.sqrt(n*n+i*i),t.position.x=this.tx+(r.x*e+r.y*n),t.position.y=this.ty+(r.x*s+r.y*i),t}invert(){const t=this.a,e=this.b,s=this.c,n=this.d,i=this.tx,r=t*n-e*s;return this.a=n/r,this.b=-e/r,this.c=-s/r,this.d=t/r,this.tx=(s*this.ty-n*i)/r,this.ty=-(t*this.ty-e*i)/r,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Ch;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new Ch}static get TEMP_MATRIX(){return new Ch}}const Mh=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Ih=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Ph=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Rh=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],kh=[],Dh=[],Fh=Math.sign;!function(){for(let t=0;t<16;t++){const e=[];kh.push(e);for(let s=0;s<16;s++){const n=Fh(Mh[t]*Mh[s]+Ph[t]*Ih[s]),i=Fh(Ih[t]*Mh[s]+Rh[t]*Ih[s]),r=Fh(Mh[t]*Ph[s]+Ph[t]*Rh[s]),a=Fh(Ih[t]*Ph[s]+Rh[t]*Rh[s]);for(let t=0;t<16;t++)if(Mh[t]===n&&Ih[t]===i&&Ph[t]===r&&Rh[t]===a){e.push(t);break}}}for(let t=0;t<16;t++){const e=new Ch;e.set(Mh[t],Ih[t],Ph[t],Rh[t],0,0),Dh.push(e)}}();const Oh={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>Mh[t],uY:t=>Ih[t],vX:t=>Ph[t],vY:t=>Rh[t],inv:t=>8&t?15&t:7&-t,add:(t,e)=>kh[t][e],sub:(t,e)=>kh[t][Oh.inv(e)],rotate180:t=>4^t,isVertical:t=>2==(3&t),byDirection:(t,e)=>2*Math.abs(t)<=Math.abs(e)?e>=0?Oh.S:Oh.N:2*Math.abs(e)<=Math.abs(t)?t>0?Oh.E:Oh.W:e>0?t>0?Oh.SE:Oh.SW:t>0?Oh.NE:Oh.NW,matrixAppendRotationInv:(t,e,s=0,n=0)=>{const i=Dh[Oh.inv(e)];i.tx=s,i.ty=n,t.append(i)}};class Nh{constructor(t,e,s=0,n=0){this._x=s,this._y=n,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new Nh(t,e,this._x,this._y)}set(t=0,e=t){return this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const Bh=class{constructor(){this.worldTransform=new Ch,this.localTransform=new Ch,this.position=new Nh(this.onChange,this,0,0),this.scale=new Nh(this.onChange,this,1,1),this.pivot=new Nh(this.onChange,this,0,0),this.skew=new Nh(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){const s=t.worldTransform,n=this.worldTransform;n.a=e.a*s.a+e.b*s.c,n.b=e.a*s.b+e.b*s.d,n.c=e.c*s.a+e.d*s.c,n.d=e.c*s.b+e.d*s.d,n.tx=e.tx*s.a+e.ty*s.c+s.tx,n.ty=e.tx*s.b+e.ty*s.d+s.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}};let Lh=Bh;Lh.IDENTITY=new Bh;function Vh(t,e,s){const n=t.createShader(e);return t.shaderSource(n,s),t.compileShader(n),n}function $h(t){const e=new Array(t);for(let s=0;s<e.length;s++)e[s]=!1;return e}function Uh(t,e){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return $h(2*e);case"bvec3":return $h(3*e);case"bvec4":return $h(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Xh=[{test:t=>"float"===t.type&&1===t.size&&!t.isArray,code:t=>`\n            if(uv["${t}"] !== ud["${t}"].value)\n            {\n                ud["${t}"].value = uv["${t}"]\n                gl.uniform1f(ud["${t}"].location, uv["${t}"])\n            }\n            `},{test:(t,e)=>!("sampler2D"!==t.type&&"samplerCube"!==t.type&&"sampler2DArray"!==t.type||1!==t.size||t.isArray||null!=e&&void 0===e.castToBaseTexture),code:t=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${t}"], t);\n\n            if(ud["${t}"].value !== t)\n            {\n                ud["${t}"].value = t;\n                gl.uniform1i(ud["${t}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(t,e)=>"mat3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.a,code:t=>`\n            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));\n            `,codeUbo:t=>`\n                var ${t}_matrix = uv.${t}.toArray(true);\n\n                data[offset] = ${t}_matrix[0];\n                data[offset+1] = ${t}_matrix[1];\n                data[offset+2] = ${t}_matrix[2];\n        \n                data[offset + 4] = ${t}_matrix[3];\n                data[offset + 5] = ${t}_matrix[4];\n                data[offset + 6] = ${t}_matrix[5];\n        \n                data[offset + 8] = ${t}_matrix[6];\n                data[offset + 9] = ${t}_matrix[7];\n                data[offset + 10] = ${t}_matrix[8];\n            `},{test:(t,e)=>"vec2"===t.type&&1===t.size&&!t.isArray&&void 0!==e.x,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${t}"].location, v.x, v.y);\n                }`,codeUbo:t=>`\n                v = uv.${t};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:t=>"vec2"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);\n                }\n            `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.width,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(t,e)=>"vec3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:t=>"vec4"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])\n                }`}],Yh={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},Wh={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};const jh={};let zh,Gh=jh;function Hh(){if(!zh){zh=gr.MEDIUM;const t=function(){if(Gh===jh||(null==Gh?void 0:Gh.isContextLost())){const t=_r.ADAPTER.createCanvas();let e;_r.PREFER_ENV>=er.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),Gh=e}return Gh}();if(t&&t.getShaderPrecisionFormat){const e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);zh=e.precision?gr.HIGH:gr.MEDIUM}}return zh}function qh(t,e){const s=t.getShaderSource(e).split("\n").map(((t,e)=>`${e}: ${t}`)),n=t.getShaderInfoLog(e),i=n.split("\n"),r={},a=i.map((t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((t=>!(!t||r[t])&&(r[t]=!0,!0))),o=[""];a.forEach((t=>{s[t-1]=`%c${s[t-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const h=s.join("\n");o[0]=h,console.error(n),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}const Kh={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Zh(t){return Kh[t]}let Qh=null;const Jh={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function tl(t,e){if(!Qh){const e=Object.keys(Jh);Qh={};for(let s=0;s<e.length;++s){const n=e[s];Qh[t[n]]=Jh[n]}}return Qh[e]}function el(t,e,s){if("precision"!==t.substring(0,9)){let n=e;return e===gr.HIGH&&s!==gr.HIGH&&(n=gr.MEDIUM),`precision ${n} float;\n${t}`}return s!==gr.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}let sl;let nl=0;const il={},rl=class{constructor(t,e,s="pixi-shader",n={}){this.extra={},this.id=nl++,this.vertexSrc=t||rl.defaultVertexSrc,this.fragmentSrc=e||rl.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,"#version"!==this.vertexSrc.substring(0,8)&&(s=s.replace(/\s+/g,"-"),il[s]?(il[s]++,s+=`-${il[s]}`):il[s]=1,this.vertexSrc=`#define SHADER_NAME ${s}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${s}\n${this.fragmentSrc}`,this.vertexSrc=el(this.vertexSrc,rl.defaultVertexPrecision,gr.HIGH),this.fragmentSrc=el(this.fragmentSrc,rl.defaultFragmentPrecision,Hh())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(t,e,s){const n=t+e;let i=Oo[n];return i||(Oo[n]=i=new rl(t,e,s)),i}};let al=rl;al.defaultVertexPrecision=gr.HIGH,al.defaultFragmentPrecision=Lr.apple.device?gr.HIGH:gr.MEDIUM;let ol=0;class hl{constructor(t,e,s){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=ol++,this.static=!!e,this.ubo=!!s,t instanceof hh?(this.buffer=t,this.buffer.type=xr.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new hh(new Float32Array(1)),this.buffer.type=xr.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,s){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new hl(e,s)}static from(t,e,s){return new hl(t,e,s)}static uboFrom(t,e){return new hl(t,null==e||e,!0)}}class ll{constructor(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof hl?e:new hl(e):new hl({}),this.disposeRunner=new th("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const s in e.uniforms){const n=e.uniforms[s];if(n.group&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,s){const n=al.from(t,e);return new ll(n,s)}}class cl{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const e=new Int32Array(t);for(let n=0;n<t;n++)e[n]=n;this.defaultGroupCache[t]=hl.from({uSamplers:e},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${t}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new al(this.vertexSrc,s)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ch,default:this.defaultGroupCache[t]};return new ll(this.programCache[t],e)}generateSampleSrc(t){let e="";e+="\n",e+="\n";for(let s=0;s<t;s++)s>0&&(e+="\nelse "),s<t-1&&(e+=`if(vTextureId < ${s}.5)`),e+="\n{",e+=`\n\tcolor = texture2D(uSamplers[${s}], vTextureCoord);`,e+="\n}";return e+="\n",e+="\n",e}}class ul{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class dl{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}const fl=class extends dl{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=mh,this.vertexSize=6,this.state=Zo.for2d(),this.size=4*fl.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){var t;return this._defaultMaxTextures=null!=(t=this._defaultMaxTextures)?t:function(t){let e=!0;const s=_r.ADAPTER.getNavigator();if(Lr.tablet||Lr.phone){if(Lr.apple.device){const t=s.userAgent.match(/OS (\d+)_(\d+)?/);t&&parseInt(t[1],10)<11&&(e=!1)}if(Lr.android.device){const t=s.userAgent.match(/Android\s([0-9.]*)/);t&&parseInt(t[1],10)<7&&(e=!1)}}return e?t:4}(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){var t;return this._canUploadSameBuffer=null!=(t=this._canUploadSameBuffer)?t:!Lr.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return Ua("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:t=fl.defaultVertexSrc,fragment:e=fl.defaultFragmentTemplate}={}){this.shaderGenerator=new cl(t,e)}contextChange(){const t=this.renderer.gl;_r.PREFER_ENV===er.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),fl.defaultMaxTextures),this.maxTextures=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const s=e.createShader(e.FRAGMENT_SHADER);for(;;){const n=qo.replace(/%forloop%/gi,Ko(t));if(e.shaderSource(s,n),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS))break;t=t/2|0}return t}(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=fl,s=this.size/4,n=Math.floor(s/this.maxTextures)+1;for(;t.length<s;)t.push(new ah);for(;e.length<n;)e.push(new ul);for(let i=0;i<this.maxTextures;i++)this._tempBoundTextures[i]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,s=fl._textureArrayPool,n=this.renderer.batch,i=this._tempBoundTextures,r=this.renderer.textureGC.count;let a=++rh._globalBatch,o=0,h=s[0],l=0;n.copyBoundTextures(i,e);for(let c=0;c<this._bufferSize;++c){const u=t[c];t[c]=null,u._batchEnabled!==a&&(h.count>=e&&(n.boundArray(h,i,a,e),this.buildDrawCalls(h,l,c),l=c,h=s[++o],++a),u._batchEnabled=a,u.touched=r,h.elements[h.count++]=u)}h.count>0&&(n.boundArray(h,i,a,e),this.buildDrawCalls(h,l,this._bufferSize),++o,++a);for(let c=0;c<i.length;c++)i[c]=null;rh._globalBatch=a}buildDrawCalls(t,e,s){const{_bufferedElements:n,_attributeBuffer:i,_indexBuffer:r,vertexSize:a}=this,o=fl._drawCallPool;let h=this._dcIndex,l=this._aIndex,c=this._iIndex,u=o[h];u.start=this._iIndex,u.texArray=t;for(let d=e;d<s;++d){const s=n[d],f=s._texture.baseTexture,p=Eo[f.alphaMode?1:0][s.blendMode];n[d]=null,e<d&&u.blend!==p&&(u.size=c-u.start,e=d,u=o[++h],u.texArray=t,u.start=c),this.packInterleavedGeometry(s,i,r,l,c),l+=s.vertexData.length/2*a,c+=s.indices.length,u.blend=p}e<s&&(u.size=c-u.start,++h),this._dcIndex=h,this._aIndex=l,this._iIndex=c}bindAndClearTexArray(t){const e=this.renderer.texture;for(let s=0;s<t.count;s++)e.bind(t.elements[s],t.ids[s]),t.elements[s]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:s}=this;fl.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(s),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(s),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:s}=this.renderer,n=fl._drawCallPool;let i=null;for(let r=0;r<t;r++){const{texArray:t,type:a,size:o,start:h,blend:l}=n[r];i!==t&&(i=t,this.bindAndClearTexArray(t)),this.state.blendMode=l,s.set(this.state),e.drawElements(a,o,e.UNSIGNED_SHORT,2*h)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),fl.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=Ao(Math.ceil(t/8)),s=Mo(e),n=8*e;this._aBuffers.length<=s&&(this._iBuffers.length=s+1);let i=this._aBuffers[n];return i||(this._aBuffers[n]=i=new Ho(n*this.vertexSize*4)),i}getIndexBuffer(t){const e=Ao(Math.ceil(t/12)),s=Mo(e),n=12*e;this._iBuffers.length<=s&&(this._iBuffers.length=s+1);let i=this._iBuffers[s];return i||(this._iBuffers[s]=i=new Uint16Array(n)),i}packInterleavedGeometry(t,e,s,n,i){const{uint32View:r,float32View:a}=e,o=n/this.vertexSize,h=t.uvs,l=t.indices,c=t.vertexData,u=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),f=_o.shared.setValue(t._tintRGB).toPremultiplied(d,t._texture.baseTexture.alphaMode>0);for(let p=0;p<c.length;p+=2)a[n++]=c[p],a[n++]=c[p+1],a[n++]=h[p],a[n++]=h[p+1],r[n++]=f,a[n++]=u;for(let p=0;p<l.length;p++)s[i++]=o+l[p]}};let pl=fl;pl.defaultBatchSize=4096,pl.extension={name:"batch",type:Wo.RendererPlugin},pl._drawCallPool=[],pl._textureArrayPool=[],Go.add(pl);const ml=class extends ll{constructor(t,e,s){super(al.from(t||ml.defaultVertexSrc,e||ml.defaultFragmentSrc),s),this.padding=0,this.resolution=ml.defaultResolution,this.multisample=ml.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Zo}apply(t,e,s,n,i){t.applyFilter(this,e,s,n)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};let gl=ml;gl.defaultResolution=1,gl.defaultMultisample=vr.NONE;class yl{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new _o(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:s,backgroundAlpha:n}=t,i=null!=s?s:e;void 0!==i&&(this.color=i),this.alpha=n}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}yl.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},yl.extension={type:[Wo.RendererSystem,Wo.CanvasRendererSystem],name:"background"},Go.add(yl);class vl{constructor(t){this.renderer=t,this.emptyRenderer=new dl(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:s}=this.renderer.texture;for(let n=e-1;n>=0;--n)t[n]=s[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,e,s,n){const{elements:i,ids:r,count:a}=t;let o=0;for(let h=0;h<a;h++){const t=i[h],a=t._batchLocation;if(a>=0&&a<n&&e[a]===t)r[h]=a;else for(;o<n;){const n=e[o];if(!n||n._batchEnabled!==s||n._batchLocation!==o){r[h]=o,t._batchLocation=o,e[o]=t;break}o++}}}destroy(){this.renderer=null}}vl.extension={type:Wo.RendererSystem,name:"batch"},Go.add(vl);let xl=0;class _l{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=xl++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,s=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:s,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=xl++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;void 0!==e.addEventListener&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let s;if(_r.PREFER_ENV>=er.WEBGL2&&(s=t.getContext("webgl2",e)),s)this.webGLVersion=2;else if(this.webGLVersion=1,s=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!s)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=s,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout((()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()}),0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,void 0!==t.removeEventListener&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),s="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;s&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=s||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}_l.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},_l.extension={type:Wo.RendererSystem,name:"context"},Go.add(_l);class bl extends sh{upload(t,e,s){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===fr.UNPACK);const i=e.realWidth,r=e.realHeight;return s.width===i&&s.height===r?n.texSubImage2D(e.target,0,0,0,i,r,e.format,s.type,this.data):(s.width=i,s.height=r,n.texImage2D(e.target,0,s.internalFormat,i,r,0,e.format,s.type,this.data)),!0}}class wl{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new th("disposeFramebuffer"),this.multisample=vr.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new rh(null,{scaleMode:cr.NEAREST,resolution:1,mipmap:dr.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new rh(new bl(null,{width:this.width,height:this.height}),{scaleMode:cr.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:dr.OFF,format:ar.DEPTH_COMPONENT,type:hr.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let s=0;s<this.colorTextures.length;s++){const n=this.colorTextures[s],i=n.resolution;n.setSize(t/i,e/i)}if(this.depthTexture){const s=this.depthTexture.resolution;this.depthTexture.setSize(t/s,e/s)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class El extends rh{constructor(t={}){if("number"==typeof t){t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}}t.width=t.width||100,t.height=t.height||100,null!=t.multisample||(t.multisample=vr.NONE),super(null,t),this.mipmap=dr.OFF,this.valid=!0,this._clear=new _o([0,0,0,0]),this.framebuffer=new wl(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Sl extends eh{constructor(t){const e=t;super(e.naturalWidth||e.videoWidth||e.width,e.naturalHeight||e.videoHeight||e.height),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,s){void 0!==s||e.startsWith("data:")?!1!==s&&(t.crossOrigin="string"==typeof s?s:"anonymous"):t.crossOrigin=function(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location,Xo||(Xo=document.createElement("a")),Xo.href=t;const s=Na.parse(Xo.href),n=!s.port&&""===e.port||s.port===e.port;return s.hostname===e.hostname&&n&&s.protocol===e.protocol?"":"anonymous"}(e)}upload(t,e,s,n){const i=t.gl,r=e.realWidth,a=e.realHeight;if(n=n||this.source,"undefined"!=typeof HTMLImageElement&&n instanceof HTMLImageElement){if(!n.complete||0===n.naturalWidth)return!1}else if("undefined"!=typeof HTMLVideoElement&&n instanceof HTMLVideoElement&&n.readyState<=1&&0===n.buffered.length)return!1;return i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===fr.UNPACK),this.noSubImage||e.target!==i.TEXTURE_2D||s.width!==r||s.height!==a?(s.width=r,s.height=a,i.texImage2D(e.target,0,s.internalFormat,e.format,s.type,n)):i.texSubImage2D(i.TEXTURE_2D,0,0,0,e.format,s.type,n),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,s=t.naturalHeight||t.videoHeight||t.height;this.resize(e,s),super.update()}dispose(){this.source=null}}class Tl extends Sl{constructor(t,e){var s;if(e=e||{},"string"==typeof t){const s=new Image;Sl.crossOrigin(s,t,e.crossorigin),s.src=t,t=s}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(null!=(s=e.createBitmap)?s:_r.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.bitmap=null,this._load=null,!1!==e.autoLoad&&this.load()}load(t){return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise(((t,e)=>{const s=this.source;this.url=s.src;const n=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.resize(s.width,s.height),this._load=null,this.createBitmap?t(this.process()):t(this))};s.complete&&s.src?n():(s.onload=n,s.onerror=t=>{e(t),this.onError.emit(t)})}))),this._load}process(){const t=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,s=!t.crossOrigin||"anonymous"===t.crossOrigin;return this._process=fetch(t.src,{mode:s?"cors":"no-cors"}).then((t=>t.blob())).then((s=>e(s,0,0,t.width,t.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===fr.UNPACK?"premultiply":"none"}))).then((t=>this.destroyed?Promise.reject():(this.bitmap=t,this.update(),this._process=null,Promise.resolve(this)))),this._process}upload(t,e,s){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,s);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,s,this.bitmap),!this.preserveBitmap){let t=!0;const n=e._glTextures;for(const i in n){const r=n[i];if(r!==s&&r.dirtyId!==e.dirtyId){t=!1;break}}t&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return"undefined"!=typeof HTMLImageElement&&("string"==typeof t||t instanceof HTMLImageElement)}}class Al{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,s){const n=e.width,i=e.height;if(s){const e=t.width/2/n,r=t.height/2/i,a=t.x/n+e,o=t.y/i+r;s=Oh.add(s,Oh.NW),this.x0=a+e*Oh.uX(s),this.y0=o+r*Oh.uY(s),s=Oh.add(s,2),this.x1=a+e*Oh.uX(s),this.y1=o+r*Oh.uY(s),s=Oh.add(s,2),this.x2=a+e*Oh.uX(s),this.y2=o+r*Oh.uY(s),s=Oh.add(s,2),this.x3=a+e*Oh.uX(s),this.y3=o+r*Oh.uY(s)}else this.x0=t.x/n,this.y0=t.y/i,this.x1=(t.x+t.width)/n,this.y1=t.y/i,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/i,this.x3=t.x/n,this.y3=(t.y+t.height)/i;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const Cl=new Al;function Ml(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}class Il extends g{constructor(t,e,s,n,i,r,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new wh(0,0,1,1)),t instanceof Il&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this._uvs=Cl,this.uvMatrix=null,this.orig=s||e,this._rotate=Number(i||0),!0===i)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=r?new _h(r.x,r.y):new _h(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:t}=this.baseTexture;(null==t?void 0:t.url)&&No[t.url]&&Il.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Il.removeFromCache(this),this.textureCacheIds=null}clone(){var t;const e=this._frame.clone(),s=this._frame===this.orig?e:this.orig.clone(),n=new Il(this.baseTexture,!this.noFrame&&e,s,null==(t=this.trim)?void 0:t.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(n._frame=e),n}updateUvs(){this._uvs===Cl&&(this._uvs=new Al),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},s=_r.STRICT_TEXTURE_CACHE){const n="string"==typeof t;let i=null;if(n)i=t;else if(t instanceof rh){if(!t.cacheId){const s=(null==e?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${s}-${ko()}`,rh.addToCache(t,t.cacheId)}i=t.cacheId}else{if(!t._pixiId){const s=(null==e?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${s}_${ko()}`}i=t._pixiId}let r=No[i];if(n&&s&&!r)throw new Error(`The cacheId "${i}" does not exist in TextureCache.`);return r||t instanceof rh?!r&&t instanceof rh&&(r=new Il(t),Il.addToCache(r,i)):(e.resolution||(e.resolution=Yo(t)),r=new Il(new rh(t,e)),r.baseTexture.cacheId=i,rh.addToCache(r.baseTexture,i),Il.addToCache(r,i)),r}static fromURL(t,e){const s=Object.assign({autoLoad:!1},null==e?void 0:e.resourceOptions),n=Il.from(t,Object.assign({resourceOptions:s},e),!1),i=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):i.load().then((()=>Promise.resolve(n)))}static fromBuffer(t,e,s,n){return new Il(rh.fromBuffer(t,e,s,n))}static fromLoader(t,e,s,n){const i=new rh(t,Object.assign({scaleMode:rh.defaultOptions.scaleMode,resolution:Yo(e)},n)),{resource:r}=i;r instanceof Tl&&(r.url=e);const a=new Il(i);return s||(s=e),rh.addToCache(a.baseTexture,s),Il.addToCache(a,s),s!==e&&(rh.addToCache(a.baseTexture,e),Il.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise((t=>{a.baseTexture.once("loaded",(()=>t(a)))}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),No[e]&&No[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),No[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=No[t];if(e){const s=e.textureCacheIds.indexOf(t);return s>-1&&e.textureCacheIds.splice(s,1),delete No[t],e}}else if(null==t?void 0:t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)No[t.textureCacheIds[e]]===t&&delete No[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:s,width:n,height:i}=t,r=e+n>this.baseTexture.width,a=s+i>this.baseTexture.height;if(r||a){const t=r&&a?"and":"or",o=`X: ${e} + ${n} = ${e+n} > ${this.baseTexture.width}`,h=`Y: ${s} + ${i} = ${s+i} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${o} ${t} ${h}`)}this.valid=n&&i&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Il._EMPTY||(Il._EMPTY=new Il(new rh),Ml(Il._EMPTY),Ml(Il._EMPTY.baseTexture)),Il._EMPTY}static get WHITE(){if(!Il._WHITE){const t=_r.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Il._WHITE=new Il(rh.from(t)),Ml(Il._WHITE),Ml(Il._WHITE.baseTexture)}return Il._WHITE}}class Pl extends Il{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,s=!0){const n=this.baseTexture.resolution,i=Math.round(t*n)/n,r=Math.round(e*n)/n;this.valid=i>0&&r>0,this._frame.width=this.orig.width=i,this._frame.height=this.orig.height=r,s&&this.baseTexture.resize(i,r),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Pl(new El(t))}}class Rl{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,s=vr.NONE){const n=new El(Object.assign({width:t,height:e,resolution:1,multisample:s},this.textureOptions));return new Pl(n)}getOptimalTexture(t,e,s=1,n=vr.NONE){let i;t=Math.ceil(t*s-1e-6),e=Math.ceil(e*s-1e-6),this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight?i=n>1?-n:-1:(i=((65535&(t=Ao(t)))<<16|65535&(e=Ao(e)))>>>0,n>1&&(i+=4294967296*n)),this.texturePool[i]||(this.texturePool[i]=[]);let r=this.texturePool[i].pop();return r||(r=this.createTexture(t,e,n)),r.filterPoolKey=i,r.setResolution(s),r}getFilterTexture(t,e,s){const n=this.getOptimalTexture(t.width,t.height,e||t.resolution,s||vr.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=!1!==t)for(const e in this.texturePool){const t=this.texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0)}this.texturePool={}}setScreenSize(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){this.enableFullScreen=t.width>0&&t.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Rl.SCREEN_KEY=-1;class kl extends ph{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Dl extends ph{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new hh(this.vertices),this.uvBuffer=new hh(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let s=0,n=0;return this.uvs[0]=s,this.uvs[1]=n,this.uvs[2]=s+e.width/t.width,this.uvs[3]=n,this.uvs[4]=s+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=s,this.uvs[7]=n+e.height/t.height,s=e.x,n=e.y,this.vertices[0]=s,this.vertices[1]=n,this.vertices[2]=s+e.width,this.vertices[3]=n,this.vertices[4]=s+e.width,this.vertices[5]=n+e.height,this.vertices[6]=s,this.vertices[7]=n+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Fl{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=vr.NONE,this.sourceFrame=new wh,this.destinationFrame=new wh,this.bindingSourceFrame=new wh,this.bindingDestinationFrame=new wh,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Ol=[new _h,new _h,new _h,new _h],Nl=new Ch;class Bl{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Rl,this.statePool=[],this.quad=new kl,this.quadUv=new Dl,this.tempRect=new wh,this.activeState={},this.globalUniforms=new hl({outputFrame:new wh,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){var s,n;const i=this.renderer,r=this.defaultFilterStack,a=this.statePool.pop()||new Fl,o=this.renderer.renderTexture;let h=e[0].resolution,l=e[0].multisample,c=e[0].padding,u=e[0].autoFit,d=null==(s=e[0].legacy)||s;for(let m=1;m<e.length;m++){const t=e[m];h=Math.min(h,t.resolution),l=Math.min(l,t.multisample),c=this.useMaxPadding?Math.max(c,t.padding):c+t.padding,u=u&&t.autoFit,d=d||null==(n=t.legacy)||n}1===r.length&&(this.defaultFilterStack[0].renderTexture=o.current),r.push(a),a.resolution=h,a.multisample=l,a.legacy=d,a.target=t,a.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),a.sourceFrame.pad(c);const f=this.tempRect.copyFrom(o.sourceFrame);i.projection.transform&&this.transformAABB(Nl.copyFrom(i.projection.transform).invert(),f),u?(a.sourceFrame.fit(f),(a.sourceFrame.width<=0||a.sourceFrame.height<=0)&&(a.sourceFrame.width=0,a.sourceFrame.height=0)):a.sourceFrame.intersects(f)||(a.sourceFrame.width=0,a.sourceFrame.height=0),this.roundFrame(a.sourceFrame,o.current?o.current.resolution:i.resolution,o.sourceFrame,o.destinationFrame,i.projection.transform),a.renderTexture=this.getOptimalFilterTexture(a.sourceFrame.width,a.sourceFrame.height,h,l),a.filters=e,a.destinationFrame.width=a.renderTexture.width,a.destinationFrame.height=a.renderTexture.height;const p=this.tempRect;p.x=0,p.y=0,p.width=a.sourceFrame.width,p.height=a.sourceFrame.height,a.renderTexture.filterFrame=a.sourceFrame,a.bindingSourceFrame.copyFrom(o.sourceFrame),a.bindingDestinationFrame.copyFrom(o.destinationFrame),a.transform=i.projection.transform,i.projection.transform=null,o.bind(a.renderTexture,a.sourceFrame,p),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),s=e.filters;this.activeState=e;const n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;const i=n.inputSize,r=n.inputPixel,a=n.inputClamp;if(i[0]=e.destinationFrame.width,i[1]=e.destinationFrame.height,i[2]=1/i[0],i[3]=1/i[1],r[0]=Math.round(i[0]*e.resolution),r[1]=Math.round(i[1]*e.resolution),r[2]=1/r[0],r[3]=1/r[1],a[0]=.5*r[2],a[1]=.5*r[3],a[2]=e.sourceFrame.width*i[2]-.5*r[2],a[3]=e.sourceFrame.height*i[3]-.5*r[3],e.legacy){const t=n.filterArea;t[0]=e.destinationFrame.width,t[1]=e.destinationFrame.height,t[2]=e.sourceFrame.x,t[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const o=t[t.length-1];if(this.renderer.framebuffer.blit(),1===s.length)s[0].apply(this,e.renderTexture,o.renderTexture,pr.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let t=e.renderTexture,n=this.getOptimalFilterTexture(t.width,t.height,e.resolution);n.filterFrame=t.filterFrame;let i=0;for(i=0;i<s.length-1;++i){1===i&&e.multisample>1&&(n=this.getOptimalFilterTexture(t.width,t.height,e.resolution),n.filterFrame=t.filterFrame),s[i].apply(this,t,n,pr.CLEAR,e);const r=t;t=n,n=r}s[i].apply(this,t,o.renderTexture,pr.BLEND,e),i>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(t),this.returnFilterTexture(n)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=pr.CLEAR){const{renderTexture:s,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,null==t?void 0:t.filterFrame){const e=this.tempRect;e.x=0,e.y=0,e.width=t.filterFrame.width,e.height=t.filterFrame.height,s.bind(t,t.filterFrame,e)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?s.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const i=1&n.stateId||this.forceClear;(e===pr.CLEAR||e===pr.BLIT&&i)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,s,n){const i=this.renderer;i.state.set(t.state),this.bindAndClear(s,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,i.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),i.geometry.bind(this.quadUv),i.geometry.draw(rr.TRIANGLES)):(i.geometry.bind(this.quad),i.geometry.draw(rr.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:s,destinationFrame:n}=this.activeState,{orig:i}=e._texture,r=t.set(n.width,0,0,n.height,s.x,s.y),a=e.worldTransform.copyTo(Ch.TEMP_MATRIX);return a.invert(),r.prepend(a),r.scale(1/i.width,1/i.height),r.translate(e.anchor.x,e.anchor.y),r}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,s=1,n=vr.NONE){return this.texturePool.getOptimalTexture(t,e,s,n)}getFilterTexture(t,e,s){if("number"==typeof t){const s=t;t=e,e=s}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,s||vr.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const s=Ol[0],n=Ol[1],i=Ol[2],r=Ol[3];s.set(e.left,e.top),n.set(e.left,e.bottom),i.set(e.right,e.top),r.set(e.right,e.bottom),t.apply(s,s),t.apply(n,n),t.apply(i,i),t.apply(r,r);const a=Math.min(s.x,n.x,i.x,r.x),o=Math.min(s.y,n.y,i.y,r.y),h=Math.max(s.x,n.x,i.x,r.x),l=Math.max(s.y,n.y,i.y,r.y);e.x=a,e.y=o,e.width=h-a,e.height=l-o}roundFrame(t,e,s,n,i){if(!(t.width<=0||t.height<=0||s.width<=0||s.height<=0)){if(i){const{a:t,b:e,c:s,d:n}=i;if((Math.abs(e)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4))return}(i=i?Nl.copyFrom(i):Nl.identity()).translate(-s.x,-s.y).scale(n.width/s.width,n.height/s.height).translate(n.x,n.y),this.transformAABB(i,t),t.ceil(e),this.transformAABB(i.invert(),t)}}}Bl.extension={type:Wo.RendererSystem,name:"filter"},Go.add(Bl);class Ll{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=vr.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Vl=new wh;class $l{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new wl(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new wh,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let e=this.renderer.context.extensions.drawBuffers,s=this.renderer.context.extensions.depthTexture;_r.PREFER_ENV===er.WEBGL_LEGACY&&(e=null,s=null),e?t.drawBuffers=t=>e.drawBuffersWEBGL(t):(this.hasMRT=!1,t.drawBuffers=()=>{}),s||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,s=0){const{gl:n}=this;if(t){const i=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,i.framebuffer)),i.mipLevel!==s&&(t.dirtyId++,t.dirtyFormat++,i.mipLevel=s),i.dirtyId!==t.dirtyId&&(i.dirtyId=t.dirtyId,i.dirtyFormat!==t.dirtyFormat?(i.dirtyFormat=t.dirtyFormat,i.dirtySize=t.dirtySize,this.updateFramebuffer(t,s)):i.dirtySize!==t.dirtySize&&(i.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let e=0;e<t.colorTextures.length;e++){const s=t.colorTextures[e];this.renderer.texture.unbind(s.parentTextureArray||s)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const t=e.width>>s,n=e.height>>s,i=t/e.width;this.setViewport(e.x*i,e.y*i,t,n)}else{const e=t.width>>s,n=t.height>>s;this.setViewport(0,0,e,n)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,s,n){const i=this.viewport;t=Math.round(t),e=Math.round(e),s=Math.round(s),n=Math.round(n),i.width===s&&i.height===n&&i.x===t&&i.y===e||(i.x=t,i.y=e,i.width=s,i.height=n,this.gl.viewport(t,e,s,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,s,n,i=nr.COLOR|nr.DEPTH){const{gl:r}=this;r.clearColor(t,e,s,n),r.clear(i)}initFramebuffer(t){const{gl:e}=this,s=new Ll(e.createFramebuffer());return s.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=s,this.managedFramebuffers.push(t),t.disposeRunner.add(this),s}resizeFramebuffer(t){const{gl:e}=this,s=t.glFramebuffers[this.CONTEXT_UID];s.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,s.stencil),s.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,s.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const n=t.colorTextures;let i=n.length;e.drawBuffers||(i=Math.min(i,1));for(let r=0;r<i;r++){const i=n[r],a=i.parentTextureArray||i;this.renderer.texture.bind(a,0),0===r&&s.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,s.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,s.multisample,a._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:s}=this,n=t.glFramebuffers[this.CONTEXT_UID],i=t.colorTextures;let r=i.length;s.drawBuffers||(r=Math.min(r,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||s.createRenderbuffer():n.msaaBuffer&&(s.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const a=[];for(let o=0;o<r;o++){const r=i[o],h=r.parentTextureArray||r;this.renderer.texture.bind(h,0),0===o&&n.msaaBuffer?(s.bindRenderbuffer(s.RENDERBUFFER,n.msaaBuffer),s.renderbufferStorageMultisample(s.RENDERBUFFER,n.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,n.msaaBuffer)):(s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+o,r.target,h._glTextures[this.CONTEXT_UID].texture,e),a.push(s.COLOR_ATTACHMENT0+o))}if(a.length>1&&s.drawBuffers(a),t.depthTexture){if(this.writeDepthTexture){const n=t.depthTexture;this.renderer.texture.bind(n,0),s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,n._glTextures[this.CONTEXT_UID].texture,e)}}!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture?n.stencil&&(s.deleteRenderbuffer(n.stencil),n.stencil=null):(n.stencil=n.stencil||s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,n.stencil),n.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,n.multisample,s.DEPTH24_STENCIL8,t.width,t.height):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,t.width,t.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,n.stencil))}canMultisampleFramebuffer(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let s=vr.NONE;if(t<=1||null===e)return s;for(let n=0;n<e.length;n++)if(e[n]<=t){s=e[n];break}return 1===s&&(s=vr.NONE),s}blit(t,e,s){const{current:n,renderer:i,gl:r,CONTEXT_UID:a}=this;if(2!==i.context.webGLVersion)return;if(!n)return;const o=n.glFramebuffers[a];if(!o)return;if(!t){if(!o.msaaBuffer)return;const e=n.colorTextures[0];if(!e)return;o.blitFramebuffer||(o.blitFramebuffer=new wl(n.width,n.height),o.blitFramebuffer.addColorTexture(0,e)),(t=o.blitFramebuffer).colorTextures[0]!==e&&(t.colorTextures[0]=e,t.dirtyId++,t.dirtyFormat++),t.width===n.width&&t.height===n.height||(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||((e=Vl).width=n.width,e.height=n.height),s||(s=e);const h=e.width===s.width&&e.height===s.height;this.bind(t),r.bindFramebuffer(r.READ_FRAMEBUFFER,o.framebuffer),r.blitFramebuffer(e.left,e.top,e.right,e.bottom,s.left,s.top,s.right,s.bottom,r.COLOR_BUFFER_BIT,h?r.NEAREST:r.LINEAR),r.bindFramebuffer(r.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const s=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!s)return;delete t.glFramebuffers[this.CONTEXT_UID];const i=this.managedFramebuffers.indexOf(t);i>=0&&this.managedFramebuffers.splice(i,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(s.framebuffer),s.msaaBuffer&&n.deleteRenderbuffer(s.msaaBuffer),s.stencil&&n.deleteRenderbuffer(s.stencil)),s.blitFramebuffer&&this.disposeFramebuffer(s.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let s=0;s<e.length;s++)this.disposeFramebuffer(e[s],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const s=t.width,n=t.height,i=this.gl,r=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,r),e.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,e.multisample,i.DEPTH24_STENCIL8,s,n):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,s,n),e.stencil=r,i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,r)}reset(){this.current=this.unknownFramebuffer,this.viewport=new wh}destroy(){this.renderer=null}}$l.extension={type:Wo.RendererSystem,name:"framebuffer"},Go.add($l);const Ul={5126:4,5123:2,5121:1};class Xl{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){let e=this.renderer.context.extensions.vertexArrayObject;_r.PREFER_ENV===er.WEBGL_LEGACY&&(e=null),e?(t.createVertexArray=()=>e.createVertexArrayOES(),t.bindVertexArray=t=>e.bindVertexArrayOES(t),t.deleteVertexArray=t=>e.deleteVertexArrayOES(t)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(2!==e.webGLVersion){const e=t.getExtension("ANGLE_instanced_arrays");e?(t.vertexAttribDivisor=(t,s)=>e.vertexAttribDivisorANGLE(t,s),t.drawElementsInstanced=(t,s,n,i,r)=>e.drawElementsInstancedANGLE(t,s,n,i,r),t.drawArraysInstanced=(t,s,n,i)=>e.drawArraysInstancedANGLE(t,s,n,i)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:s}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],i=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},i=!0);const r=n[e.program.id]||this.initGeometryVao(t,e,i);this._activeGeometry=t,this._activeVao!==r&&(this._activeVao=r,this.hasVao?s.bindVertexArray(r):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let s=0;s<t.buffers.length;s++){const n=t.buffers[s];e.update(n)}}checkCompatibility(t,e){const s=t.attributes,n=e.attributeData;for(const i in n)if(!s[i])throw new Error(`shader and geometry incompatible, geometry missing the "${i}" attribute`)}getSignature(t,e){const s=t.attributes,n=e.attributeData,i=["g",t.id];for(const r in s)n[r]&&i.push(r,n[r].location);return i.join("-")}initGeometryVao(t,e,s=!0){const n=this.gl,i=this.CONTEXT_UID,r=this.renderer.buffer,a=e.program;a.glPrograms[i]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);const o=this.getSignature(t,a),h=t.glVertexArrayObjects[this.CONTEXT_UID];let l=h[o];if(l)return h[a.id]=l,l;const c=t.buffers,u=t.attributes,d={},f={};for(const p in c)d[p]=0,f[p]=0;for(const p in u)!u[p].size&&a.attributeData[p]?u[p].size=a.attributeData[p].size:u[p].size||console.warn(`PIXI Geometry attribute '${p}' size cannot be determined (likely the bound shader does not have the attribute)`),d[u[p].buffer]+=u[p].size*Ul[u[p].type];for(const p in u){const t=u[p],e=t.size;void 0===t.stride&&(d[t.buffer]===e*Ul[t.type]?t.stride=0:t.stride=d[t.buffer]),void 0===t.start&&(t.start=f[t.buffer],f[t.buffer]+=e*Ul[t.type])}l=n.createVertexArray(),n.bindVertexArray(l);for(let p=0;p<c.length;p++){const t=c[p];r.bind(t),s&&t._glBuffers[i].refCount++}return this.activateVao(t,a),h[a.id]=l,h[o]=l,n.bindVertexArray(null),r.unbind(xr.ARRAY_BUFFER),l}disposeGeometry(t,e){var s;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const n=t.glVertexArrayObjects[this.CONTEXT_UID],i=this.gl,r=t.buffers,a=null==(s=this.renderer)?void 0:s.buffer;if(t.disposeRunner.remove(this),n){if(a)for(let t=0;t<r.length;t++){const s=r[t]._glBuffers[this.CONTEXT_UID];s&&(s.refCount--,0!==s.refCount||e||a.dispose(r[t],e))}if(!e)for(const t in n)if("g"===t[0]){const e=n[t];this._activeVao===e&&this.unbind(),i.deleteVertexArray(e)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let s=0;s<e.length;s++)this.disposeGeometry(this.managedGeometries[e[s]],t)}activateVao(t,e){const s=this.gl,n=this.CONTEXT_UID,i=this.renderer.buffer,r=t.buffers,a=t.attributes;t.indexBuffer&&i.bind(t.indexBuffer);let o=null;for(const h in a){const t=a[h],l=r[t.buffer],c=l._glBuffers[n];if(e.attributeData[h]){o!==c&&(i.bind(l),o=c);const n=e.attributeData[h].location;if(s.enableVertexAttribArray(n),s.vertexAttribPointer(n,t.size,t.type||s.FLOAT,t.normalized,t.stride,t.start),t.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");s.vertexAttribDivisor(n,t.divisor)}}}}draw(t,e,s,n){const{gl:i}=this,r=this._activeGeometry;if(r.indexBuffer){const a=r.indexBuffer.data.BYTES_PER_ELEMENT,o=2===a?i.UNSIGNED_SHORT:i.UNSIGNED_INT;2===a||4===a&&this.canUseUInt32ElementIndex?r.instanced?i.drawElementsInstanced(t,e||r.indexBuffer.data.length,o,(s||0)*a,n||1):i.drawElements(t,e||r.indexBuffer.data.length,o,(s||0)*a):console.warn("unsupported index buffer type: uint32")}else r.instanced?i.drawArraysInstanced(t,s,e||r.getSize(),n||1):i.drawArrays(t,s,e||r.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Xl.extension={type:Wo.RendererSystem,name:"geometry"},Go.add(Xl);const Yl=new Ch;class Wl{constructor(t,e){this._texture=t,this.mapCoord=new Ch,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){void 0===e&&(e=t);const s=this.mapCoord;for(let n=0;n<t.length;n+=2){const i=t[n],r=t[n+1];e[n]=i*s.a+r*s.c+s.tx,e[n+1]=i*s.b+r*s.d+s.ty}return e}update(t){const e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const s=e._uvs;this.mapCoord.set(s.x1-s.x0,s.y1-s.y0,s.x3-s.x0,s.y3-s.y0,s.x0,s.y0);const n=e.orig,i=e.trim;i&&(Yl.set(n.width/i.width,0,0,n.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(Yl));const r=e.baseTexture,a=this.uClampFrame,o=this.clampMargin/r.resolution,h=this.clampOffset;return a[0]=(e._frame.x+o+h)/r.width,a[1]=(e._frame.y+o+h)/r.height,a[2]=(e._frame.x+e._frame.width-o+h)/r.width,a[3]=(e._frame.y+e._frame.height-o+h)/r.height,this.uClampOffset[0]=h/r.realWidth,this.uClampOffset[1]=h/r.realHeight,this.isSimple=e._frame.width===r.width&&e._frame.height===r.height&&0===e.rotate,!0}}class jl extends gl{constructor(t,e,s){let n=null;"string"!=typeof t&&void 0===e&&void 0===s&&(n=t,t=void 0,e=void 0,s=void 0),super(t||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",e||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",s),this.maskSprite=n,this.maskMatrix=new Ch}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,s,n){const i=this._maskSprite,r=i._texture;r.valid&&(r.uvMatrix||(r.uvMatrix=new Wl(r,0)),r.uvMatrix.update(),this.uniforms.npmAlpha=r.baseTexture.alphaMode?0:1,this.uniforms.mask=r,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,i).prepend(r.uvMatrix.mapCoord),this.uniforms.alpha=i.worldAlpha,this.uniforms.maskClamp=r.uvMatrix.uClampFrame,t.applyFilter(this,e,s,n))}}class zl{constructor(t=null){this.type=yr.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=gl.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=yr.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Gl{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let s=e;if(!s.isMaskData){const t=this.maskDataPool.pop()||new zl;t.pooled=!0,t.maskObject=e,s=t}const n=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(s.copyCountersOrReset(n),s._colorMask=n?n._colorMask:15,s.autoDetect&&this.detect(s),s._target=t,s.type!==yr.SPRITE&&this.maskStack.push(s),s.enabled)switch(s.type){case yr.SCISSOR:this.renderer.scissor.push(s);break;case yr.STENCIL:this.renderer.stencil.push(s);break;case yr.SPRITE:s.copyCountersOrReset(null),this.pushSpriteMask(s);break;case yr.COLOR:this.pushColorMask(s)}s.type===yr.SPRITE&&this.maskStack.push(s)}pop(t){const e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case yr.SCISSOR:this.renderer.scissor.pop(e);break;case yr.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case yr.SPRITE:this.popSpriteMask(e);break;case yr.COLOR:this.popColorMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){const t=this.maskStack[this.maskStack.length-1];t.type===yr.SPRITE&&t._filters&&(t._filters[0].maskSprite=t.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=yr.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=yr.SCISSOR:t.type=yr.STENCIL:t.type=yr.COLOR}pushSpriteMask(t){var e,s;const{maskObject:n}=t,i=t._target;let r=t._filters;r||(r=this.alphaMaskPool[this.alphaMaskIndex],r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new jl]));const a=this.renderer,o=a.renderTexture;let h,l;if(o.current){const s=o.current;h=t.resolution||s.resolution,l=null!=(e=t.multisample)?e:s.multisample}else h=t.resolution||a.resolution,l=null!=(s=t.multisample)?s:a.multisample;r[0].resolution=h,r[0].multisample=l,r[0].maskSprite=n;const c=i.filterArea;i.filterArea=n.getBounds(!0),a.filter.push(i,r),i.filterArea=c,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,s=t._colorMask=e&t.colorMask;s!==e&&this.renderer.gl.colorMask(0!=(1&s),0!=(2&s),0!=(4&s),0!=(8&s))}popColorMask(t){const e=t._colorMask,s=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;s!==e&&this.renderer.gl.colorMask(0!=(1&s),0!=(2&s),0!=(4&s),0!=(8&s))}destroy(){this.renderer=null}}Gl.extension={type:Wo.RendererSystem,name:"mask"},Go.add(Gl);class Hl{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,s=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==s&&(0===n?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const ql=new Ch,Kl=[],Zl=class extends Hl{constructor(t){super(t),this.glConst=_r.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){var e;if(t._scissorRectLocal)return;const s=t._scissorRect,{maskObject:n}=t,{renderer:i}=this,r=i.renderTexture,a=n.getBounds(!0,null!=(e=Kl.pop())?e:new wh);this.roundFrameToPixels(a,r.current?r.current.resolution:i.resolution,r.sourceFrame,r.destinationFrame,i.projection.transform),s&&a.fit(s),t._scissorRectLocal=a}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:s,c:n,d:i}=t;return(Math.abs(s)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(i)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect())return!1;if(Zl.isMatrixRotated(e.worldTransform))return!1;if(Zl.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const s=t._scissorRectLocal;return s.width>0&&s.height>0}roundFrameToPixels(t,e,s,n,i){Zl.isMatrixRotated(i)||((i=i?ql.copyFrom(i):ql.identity()).translate(-s.x,-s.y).scale(n.width/s.width,n.height/s.height).translate(n.x,n.y),this.renderer.filter.transformAABB(i,t),t.fit(n),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&Kl.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;e=this.renderer.renderTexture.current?t.y:this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};let Ql=Zl;Ql.extension={type:Wo.RendererSystem,name:"scissor"},Go.add(Ql);class Jl extends Hl{constructor(t){super(t),this.glConst=_r.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:s}=this.renderer,n=t._stencilCounter;0===n&&(this.renderer.framebuffer.forceStencil(),s.clearStencil(0),s.clear(s.STENCIL_BUFFER_BIT),s.enable(s.STENCIL_TEST)),t._stencilCounter++;const i=t._colorMask;0!==i&&(t._colorMask=0,s.colorMask(!1,!1,!1,!1)),s.stencilFunc(s.EQUAL,n,4294967295),s.stencilOp(s.KEEP,s.KEEP,s.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==i&&(t._colorMask=i,s.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))),this._useCurrent()}pop(t){const e=this.renderer.gl;if(0===this.getStackLength())e.disable(e.STENCIL_TEST);else{const s=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,n=s?s._colorMask:15;0!==n&&(s._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==n&&(s._colorMask=n,e.colorMask(0!=(1&n),0!=(2&n),0!=(4&n),0!=(8&n))),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Jl.extension={type:Wo.RendererSystem,name:"stencil"},Go.add(Jl);class tc{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(Ua("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract)},prepare:{enumerable:!1,get:()=>(Ua("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare)},interaction:{enumerable:!1,get:()=>(Ua("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events)}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}tc.extension={type:[Wo.RendererSystem,Wo.CanvasRendererSystem],name:"_plugin"},Go.add(tc);class ec{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Ch,this.transform=null}update(t,e,s,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,s,n),this.transform&&this.projectionMatrix.append(this.transform);const i=this.renderer;i.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,i.globalUniforms.update(),i.shader.shader&&i.shader.syncUniformGroup(i.shader.shader.uniforms.globals)}calculateProjection(t,e,s,n){const i=this.projectionMatrix,r=n?-1:1;i.identity(),i.a=1/e.width*2,i.d=r*(1/e.height*2),i.tx=-1-e.x*i.a,i.ty=-r-e.y*i.d}setTransform(t){}destroy(){this.renderer=null}}ec.extension={type:Wo.RendererSystem,name:"projection"},Go.add(ec);const sc=new Lh;class nc{constructor(t){this.renderer=t,this._tempMatrix=new Ch}generateTexture(t,e){const s=e||{},{region:n}=s,i=u(s,["region"]),r=n||t.getLocalBounds(null,!0);0===r.width&&(r.width=1),0===r.height&&(r.height=1);const a=Pl.create(l({width:r.width,height:r.height},i));this._tempMatrix.tx=-r.x,this._tempMatrix.ty=-r.y;const o=t.transform;return t.transform=sc,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=o,a}destroy(){}}nc.extension={type:[Wo.RendererSystem,Wo.CanvasRendererSystem],name:"textureGenerator"},Go.add(nc);const ic=new wh,rc=new wh;class ac{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new wh,this.destinationFrame=new wh,this.viewportFrame=new wh}contextChange(){var t;const e=null==(t=this.renderer)?void 0:t.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(t=null,e,s){const n=this.renderer;let i,r,a;this.current=t,t?(i=t.baseTexture,a=i.resolution,e||(ic.width=t.frame.width,ic.height=t.frame.height,e=ic),s||(rc.x=t.frame.x,rc.y=t.frame.y,rc.width=e.width,rc.height=e.height,s=rc),r=i.framebuffer):(a=n.resolution,e||(ic.width=n._view.screen.width,ic.height=n._view.screen.height,e=ic),s||((s=ic).width=e.width,s.height=e.height));const o=this.viewportFrame;o.x=s.x*a,o.y=s.y*a,o.width=s.width*a,o.height=s.height*a,t||(o.y=n.view.height-(o.y+o.height)),o.ceil(),this.renderer.framebuffer.bind(r,o),this.renderer.projection.update(s,e,a,!r),t?this.renderer.mask.setMaskStack(i.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(s)}clear(t,e){const s=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,n=_o.shared.setValue(t||s);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&n.premultiply(n.alpha);const i=this.destinationFrame,r=this.current?this.current.baseTexture:this.renderer._view.screen,a=i.width!==r.width||i.height!==r.height;if(a){let{x:t,y:e,width:s,height:n}=this.viewportFrame;t=Math.round(t),e=Math.round(e),s=Math.round(s),n=Math.round(n),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(t,e,s,n)}this.renderer.framebuffer.clear(n.red,n.green,n.blue,n.alpha,e),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}ac.extension={type:Wo.RendererSystem,name:"renderTexture"},Go.add(ac);class oc{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function hc(t,e){var s;const n=Vh(t,t.VERTEX_SHADER,e.vertexSrc),i=Vh(t,t.FRAGMENT_SHADER,e.fragmentSrc),r=t.createProgram();t.attachShader(r,n),t.attachShader(r,i);const a=null==(s=e.extra)?void 0:s.transformFeedbackVaryings;if(a&&("function"!=typeof t.transformFeedbackVaryings?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):t.transformFeedbackVaryings(r,a.names,"separate"===a.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS)||function(t,e,s,n){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(s,t.COMPILE_STATUS)||qh(t,s),t.getShaderParameter(n,t.COMPILE_STATUS)||qh(t,n),console.error("PixiJS Error: Could not initialize shader."),""!==t.getProgramInfoLog(e)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}(t,r,n,i),e.attributeData=function(t,e){const s={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const n=e.getActiveAttrib(t,i);if(n.name.startsWith("gl_"))continue;const r=tl(e,n.type),a={type:r,name:n.name,size:Zh(r),location:e.getAttribLocation(t,n.name)};s[n.name]=a}return s}(r,t),e.uniformData=function(t,e){const s={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;i++){const n=e.getActiveUniform(t,i),r=n.name.replace(/\[.*?\]$/,""),a=!!n.name.match(/\[.*?\]$/),o=tl(e,n.type);s[r]={name:r,index:i,type:o,size:n.size,isArray:a,value:Uh(o,n.size)}}return s}(r,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const s=Object.keys(e.attributeData);s.sort(((t,e)=>t>e?1:-1));for(let n=0;n<s.length;n++)e.attributeData[s[n]].location=n,t.bindAttribLocation(r,n,s[n]);t.linkProgram(r)}t.deleteShader(n),t.deleteShader(i);const o={};for(const h in e.uniformData){const s=e.uniformData[h];o[h]={location:t.getUniformLocation(r,h),value:Uh(s.type,s.size)}}return new oc(r,o)}function lc(t,e,s,n,i){s.buffer.update(i)}const cc={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},uc={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function dc(t,e){if(!t.autoManage)return{size:0,syncFunc:lc};const s=function(t,e){const s=[];for(const n in t)e[n]&&s.push(e[n]);return s.sort(((t,e)=>t.index-e.index)),s}(t.uniforms,e),{uboElements:n,size:i}=function(t){const e=t.map((t=>({data:t,offset:0,dataLen:0,dirty:0})));let s=0,n=0,i=0;for(let r=0;r<e.length;r++){const t=e[r];if(s=uc[t.data.type],t.data.size>1&&(s=Math.max(s,16)*t.data.size),t.dataLen=s,n%s!=0&&n<16){const t=n%s%16;n+=t,i+=t}n+s>16?(i=16*Math.ceil(i/16),t.offset=i,i+=s,n=s):(t.offset=i,n+=s,i+=s)}return i=16*Math.ceil(i/16),{uboElements:e,size:i}}(s),r=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let a=0;a<n.length;a++){const e=n[a],s=t.uniforms[e.data.name],i=e.data.name;let o=!1;for(let t=0;t<Xh.length;t++){const n=Xh[t];if(n.codeUbo&&n.test(e.data,s)){r.push(`offset = ${e.offset/4};`,Xh[t].codeUbo(e.data.name,s)),o=!0;break}}if(!o)if(e.data.size>1){const t=Zh(e.data.type),s=Math.max(uc[e.data.type]/16,1),n=t/s,a=(4-n%4)%4;r.push(`\n                cv = ud.${i}.value;\n                v = uv.${i};\n                offset = ${e.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${e.data.size*s}; i++)\n                {\n                    for(var j = 0; j < ${n}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${a};\n                }\n\n                `)}else{const t=cc[e.data.type];r.push(`\n                cv = ud.${i}.value;\n                v = uv.${i};\n                offset = ${e.offset/4};\n                ${t};\n                `)}}return r.push("\n       renderer.buffer.update(buffer);\n    "),{size:i,syncFunc:new Function("ud","uv","renderer","syncData","buffer",r.join("\n"))}}let fc=0;const pc={textureCount:0,uboCount:0};class mc{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=fc++}systemCheck(){if(!function(){if("boolean"==typeof sl)return sl;try{const t=new Function("param1","param2","param3","return param1[param2] === param3;");sl=!0===t({a:"b"},"a","b")}catch(jp){sl=!1}return sl}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const s=t.program,n=s.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==s&&(this.program=s,this.gl.useProgram(n.program)),e||(pc.textureCount=0,pc.uboCount=0,this.syncUniformGroup(t.uniformGroup,pc)),n}setUniforms(t){const e=this.shader.program,s=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(s.uniformData,t,this.renderer)}syncUniformGroup(t,e){const s=this.getGlProgram();t.static&&t.dirtyId===s.uniformDirtyGroups[t.id]||(s.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,s,e))}syncUniforms(t,e,s){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,s)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function(t,e){var s;const n=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const i in t.uniforms){const r=e[i];if(!r){(null==(s=t.uniforms[i])?void 0:s.group)&&(t.uniforms[i].ubo?n.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${i}, '${i}');\n                    `):n.push(`\n                        renderer.shader.syncUniformGroup(uv.${i}, syncData);\n                    `));continue}const a=t.uniforms[i];let o=!1;for(let t=0;t<Xh.length;t++)if(Xh[t].test(r,a)){n.push(Xh[t].code(i,a)),o=!0;break}if(!o){const t=(1!==r.size||r.isArray?Wh:Yh)[r.type].replace("location",`ud["${i}"].location`);n.push(`\n            cu = ud["${i}"];\n            cv = cu.value;\n            v = uv["${i}"];\n            ${t};`)}}return new Function("ud","uv","renderer","syncData",n.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const s=this.getGlProgram();if(!t.static||0!==t.dirtyId||!s.uniformGroups[t.id]){t.dirtyId=0;const n=s.uniformGroups[t.id]||this.createSyncBufferGroup(t,s,e);t.buffer.update(),n(s.uniformData,t.uniforms,this.renderer,pc,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,s.uniformBufferBindings[e])}createSyncBufferGroup(t,e,s){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const i=this.gl.getUniformBlockIndex(e.program,s);e.uniformBufferBindings[s]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,i,this.shader.uniformBindCount),this.shader.uniformBindCount++;const r=this.getSignature(t,this.shader.program.uniformData,"ubo");let a=this._uboCache[r];if(a||(a=this._uboCache[r]=dc(t,this.shader.program.uniformData)),t.autoManage){const e=new Float32Array(a.size/4);t.buffer.update(e)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,s){const n=t.uniforms,i=[`${s}-`];for(const r in n)i.push(r),e[r]&&i.push(e[r].type);return i.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,s=t.program,n=hc(e,s);return s.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}mc.extension={type:Wo.RendererSystem,name:"shader"},Go.add(mc);class gc{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.2.4 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}gc.defaultOptions={hello:!1},gc.extension={type:[Wo.RendererSystem,Wo.CanvasRendererSystem],name:"startup"},Go.add(gc);const yc=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=ir.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new Zo,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=function(t,e=[]){return e[ir.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ir.ADD]=[t.ONE,t.ONE],e[ir.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ir.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ir.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ir.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ir.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ir.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ir.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ir.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ir.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ir.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ir.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ir.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ir.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ir.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ir.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ir.NONE]=[0,0],e[ir.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ir.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[ir.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ir.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[ir.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[ir.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[ir.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[ir.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[ir.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[ir.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[ir.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[ir.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,s=0;for(;e;)1&e&&this.map[s].call(this,!!(t.data&1<<s)),e>>=1,s++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(yc.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(yc.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],s=this.gl;2===e.length?s.blendFunc(e[0],e[1]):s.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,s.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,s.blendEquationSeparate(s.FUNC_ADD,s.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const s=this.checks.indexOf(t);e&&-1===s?this.checks.push(t):e||-1===s||this.checks.splice(s,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};let vc=yc;vc.extension={type:Wo.RendererSystem,name:"state"},Go.add(vc);class xc extends g{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){var e;this.addRunners(...t.runners);const s=(null!=(e=t.priority)?e:[]).filter((e=>t.systems[e])),n=[...s,...Object.keys(t.systems).filter((t=>!s.includes(t)))];for(const i of n)this.addSystem(t.systems[i],i)}addRunners(...t){t.forEach((t=>{this.runners[t]=new th(t)}))}addSystem(t,e){const s=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=s,this._systemsHash[e]=s;for(const n in this.runners)this.runners[n].add(s);return this}emitWithCustomOptions(t,e){const s=Object.keys(this._systemsHash);t.items.forEach((n=>{const i=s.find((t=>this._systemsHash[t]===n));n[t.name](e[i])}))}destroy(){Object.values(this.runners).forEach((t=>{t.destroy()})),this._systemsHash={}}}const _c=class{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=_c.defaultMaxIdle,this.checkCountMax=_c.defaultCheckCountMax,this.mode=_c.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==mr.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let s=!1;for(let n=0;n<e.length;n++){const i=e[n];!i.framebuffer&&this.count-i.touched>this.maxIdle&&(t.destroyTexture(i,!0),e[n]=null,s=!0)}if(s){let t=0;for(let s=0;s<e.length;s++)null!==e[s]&&(e[t++]=e[s]);e.length=t}}unload(t){const e=this.renderer.texture,s=t._texture;s&&!s.framebuffer&&e.destroyTexture(s);for(let n=t.children.length-1;n>=0;n--)this.unload(t.children[n])}destroy(){this.renderer=null}};let bc=_c;bc.defaultMode=mr.AUTO,bc.defaultMaxIdle=3600,bc.defaultCheckCountMax=600,bc.extension={type:Wo.RendererSystem,name:"textureGC"},Go.add(bc);class wc{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=hr.UNSIGNED_BYTE,this.internalFormat=ar.RGBA,this.samplerType=0}}class Ec{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new rh,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[hr.UNSIGNED_BYTE]:{[ar.RGBA]:t.RGBA8,[ar.RGB]:t.RGB8,[ar.RG]:t.RG8,[ar.RED]:t.R8,[ar.RGBA_INTEGER]:t.RGBA8UI,[ar.RGB_INTEGER]:t.RGB8UI,[ar.RG_INTEGER]:t.RG8UI,[ar.RED_INTEGER]:t.R8UI,[ar.ALPHA]:t.ALPHA,[ar.LUMINANCE]:t.LUMINANCE,[ar.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[hr.BYTE]:{[ar.RGBA]:t.RGBA8_SNORM,[ar.RGB]:t.RGB8_SNORM,[ar.RG]:t.RG8_SNORM,[ar.RED]:t.R8_SNORM,[ar.RGBA_INTEGER]:t.RGBA8I,[ar.RGB_INTEGER]:t.RGB8I,[ar.RG_INTEGER]:t.RG8I,[ar.RED_INTEGER]:t.R8I},[hr.UNSIGNED_SHORT]:{[ar.RGBA_INTEGER]:t.RGBA16UI,[ar.RGB_INTEGER]:t.RGB16UI,[ar.RG_INTEGER]:t.RG16UI,[ar.RED_INTEGER]:t.R16UI,[ar.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[hr.SHORT]:{[ar.RGBA_INTEGER]:t.RGBA16I,[ar.RGB_INTEGER]:t.RGB16I,[ar.RG_INTEGER]:t.RG16I,[ar.RED_INTEGER]:t.R16I},[hr.UNSIGNED_INT]:{[ar.RGBA_INTEGER]:t.RGBA32UI,[ar.RGB_INTEGER]:t.RGB32UI,[ar.RG_INTEGER]:t.RG32UI,[ar.RED_INTEGER]:t.R32UI,[ar.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[hr.INT]:{[ar.RGBA_INTEGER]:t.RGBA32I,[ar.RGB_INTEGER]:t.RGB32I,[ar.RG_INTEGER]:t.RG32I,[ar.RED_INTEGER]:t.R32I},[hr.FLOAT]:{[ar.RGBA]:t.RGBA32F,[ar.RGB]:t.RGB32F,[ar.RG]:t.RG32F,[ar.RED]:t.R32F,[ar.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[hr.HALF_FLOAT]:{[ar.RGBA]:t.RGBA16F,[ar.RGB]:t.RGB16F,[ar.RG]:t.RG16F,[ar.RED]:t.R16F},[hr.UNSIGNED_SHORT_5_6_5]:{[ar.RGB]:t.RGB565},[hr.UNSIGNED_SHORT_4_4_4_4]:{[ar.RGBA]:t.RGBA4},[hr.UNSIGNED_SHORT_5_5_5_1]:{[ar.RGBA]:t.RGB5_A1},[hr.UNSIGNED_INT_2_10_10_10_REV]:{[ar.RGBA]:t.RGB10_A2,[ar.RGBA_INTEGER]:t.RGB10_A2UI},[hr.UNSIGNED_INT_10F_11F_11F_REV]:{[ar.RGB]:t.R11F_G11F_B10F},[hr.UNSIGNED_INT_5_9_9_9_REV]:{[ar.RGB]:t.RGB9_E5},[hr.UNSIGNED_INT_24_8]:{[ar.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[hr.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[ar.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:{[hr.UNSIGNED_BYTE]:{[ar.RGBA]:t.RGBA,[ar.RGB]:t.RGB,[ar.ALPHA]:t.ALPHA,[ar.LUMINANCE]:t.LUMINANCE,[ar.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[hr.UNSIGNED_SHORT_5_6_5]:{[ar.RGB]:t.RGB},[hr.UNSIGNED_SHORT_4_4_4_4]:{[ar.RGBA]:t.RGBA},[hr.UNSIGNED_SHORT_5_5_5_1]:{[ar.RGBA]:t.RGBA}},e}(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let n=0;n<e;n++)this.boundTextures[n]=null;this.emptyTextures={};const s=new wc(t.createTexture());t.bindTexture(t.TEXTURE_2D,s.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=s,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new wc(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(t,e=0){const{gl:s}=this;if((null==(t=null==t?void 0:t.castToBaseTexture())?void 0:t.valid)&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,s.activeTexture(s.TEXTURE0+e)),s.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,s.activeTexture(s.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,s.activeTexture(s.TEXTURE0+e)),s.bindTexture(s.TEXTURE_2D,this.emptyTextures[s.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:s}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let t=0;t<s.length;t++)s[t]===this.unknownTexture&&this.bind(null,t)}for(let n=0;n<s.length;n++)s[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),s[n]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:s,CONTEXT_UID:n}=this;if(s)for(let i=t-1;i>=0;--i){const t=e[i];if(t){t._glTextures[n].samplerType!==lr.FLOAT&&this.renderer.texture.unbind(t)}}}initTexture(t){const e=new wc(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var s,n;e.internalFormat=null!=(n=null==(s=this.internalFormats[t.type])?void 0:s[t.format])?n:t.format,2===this.webGLVersion&&t.type===hr.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var e;const s=t._glTextures[this.CONTEXT_UID];if(!s)return;const n=this.renderer;if(this.initTextureType(t,s),null==(e=t.resource)?void 0:e.upload(n,t,s))s.samplerType!==lr.FLOAT&&(this.hasIntegerTextures=!0);else{const e=t.realWidth,i=t.realHeight,r=n.gl;(s.width!==e||s.height!==i||s.dirtyId<0)&&(s.width=e,s.height=i,r.texImage2D(t.target,0,s.internalFormat,e,i,0,t.format,s.type,null))}t.dirtyStyleId!==s.dirtyStyleId&&this.updateTextureStyle(t),s.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:s}=this;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),s.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const e=this.managedTextures.indexOf(t);-1!==e&&Io(this.managedTextures,e,1)}}updateTextureStyle(t){var e;const s=t._glTextures[this.CONTEXT_UID];s&&(t.mipmap!==dr.POW2&&2===this.webGLVersion||t.isPowerOfTwo?s.mipmap=t.mipmap>=1:s.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?s.wrapMode=t.wrapMode:s.wrapMode=ur.CLAMP,(null==(e=t.resource)?void 0:e.style(this.renderer,t,s))||this.setStyle(t,s),s.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const s=this.gl;if(e.mipmap&&t.mipmap!==dr.ON_MANUAL&&s.generateMipmap(t.target),s.texParameteri(t.target,s.TEXTURE_WRAP_S,e.wrapMode),s.texParameteri(t.target,s.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){s.texParameteri(t.target,s.TEXTURE_MIN_FILTER,t.scaleMode===cr.LINEAR?s.LINEAR_MIPMAP_LINEAR:s.NEAREST_MIPMAP_NEAREST);const e=this.renderer.context.extensions.anisotropicFiltering;if(e&&t.anisotropicLevel>0&&t.scaleMode===cr.LINEAR){const n=Math.min(t.anisotropicLevel,s.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT));s.texParameterf(t.target,e.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else s.texParameteri(t.target,s.TEXTURE_MIN_FILTER,t.scaleMode===cr.LINEAR?s.LINEAR:s.NEAREST);s.texParameteri(t.target,s.TEXTURE_MAG_FILTER,t.scaleMode===cr.LINEAR?s.LINEAR:s.NEAREST)}destroy(){this.renderer=null}}Ec.extension={type:Wo.RendererSystem,name:"texture"},Go.add(Ec);class Sc{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:s}=this,n=t._glTransformFeedbacks[s]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:s,renderer:n}=this;e&&n.shader.bind(e),s.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:s,CONTEXT_UID:n}=this,i=e.createTransformFeedback();t._glTransformFeedbacks[n]=i,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,i);for(let r=0;r<t.buffers.length;r++){const i=t.buffers[r];i&&(s.buffer.update(i),i._glBuffers[n].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,r,i._glBuffers[n].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),i}disposeTransformFeedback(t,e){const s=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const i=this.renderer.buffer;if(i)for(let r=0;r<t.buffers.length;r++){const s=t.buffers[r];if(!s)continue;const n=s._glBuffers[this.CONTEXT_UID];n&&(n.refCount--,0!==n.refCount||e||i.dispose(s,e))}s&&(e||n.deleteTransformFeedback(s),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Sc.extension={type:Wo.RendererSystem,name:"transformFeedback"},Go.add(Sc);class Tc{constructor(t){this.renderer=t}init(t){this.screen=new wh(0,0,t.width,t.height),this.element=t.view||_r.ADAPTER.createCanvas(),this.resolution=t.resolution||_r.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const s=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=s,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${s}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",s,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&(null==(e=this.element.parentNode)||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}Tc.defaultOptions={width:800,height:600,resolution:_r.RESOLUTION,autoDensity:!1},Tc.extension={type:[Wo.RendererSystem,Wo.CanvasRendererSystem],name:"_view"},Go.add(Tc),_r.PREFER_ENV=er.WEBGL2,_r.STRICT_TEXTURE_CACHE=!1,_r.RENDER_OPTIONS=l(l(l(l({},_l.defaultOptions),yl.defaultOptions),Tc.defaultOptions),gc.defaultOptions),Object.defineProperties(_r,{WRAP_MODE:{get:()=>rh.defaultOptions.wrapMode,set(t){Ua("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),rh.defaultOptions.wrapMode=t}},SCALE_MODE:{get:()=>rh.defaultOptions.scaleMode,set(t){Ua("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),rh.defaultOptions.scaleMode=t}},MIPMAP_TEXTURES:{get:()=>rh.defaultOptions.mipmap,set(t){Ua("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),rh.defaultOptions.mipmap=t}},ANISOTROPIC_LEVEL:{get:()=>rh.defaultOptions.anisotropicLevel,set(t){Ua("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),rh.defaultOptions.anisotropicLevel=t}},FILTER_RESOLUTION:{get:()=>(Ua("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),gl.defaultResolution),set(t){gl.defaultResolution=t}},FILTER_MULTISAMPLE:{get:()=>(Ua("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),gl.defaultMultisample),set(t){gl.defaultMultisample=t}},SPRITE_MAX_TEXTURES:{get:()=>pl.defaultMaxTextures,set(t){Ua("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),pl.defaultMaxTextures=t}},SPRITE_BATCH_SIZE:{get:()=>pl.defaultBatchSize,set(t){Ua("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),pl.defaultBatchSize=t}},CAN_UPLOAD_SAME_BUFFER:{get:()=>pl.canUploadSameBuffer,set(t){Ua("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),pl.canUploadSameBuffer=t}},GC_MODE:{get:()=>bc.defaultMode,set(t){Ua("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),bc.defaultMode=t}},GC_MAX_IDLE:{get:()=>bc.defaultMaxIdle,set(t){Ua("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),bc.defaultMaxIdle=t}},GC_MAX_CHECK_COUNT:{get:()=>bc.defaultCheckCountMax,set(t){Ua("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),bc.defaultCheckCountMax=t}},PRECISION_VERTEX:{get:()=>al.defaultVertexPrecision,set(t){Ua("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),al.defaultVertexPrecision=t}},PRECISION_FRAGMENT:{get:()=>al.defaultFragmentPrecision,set(t){Ua("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),al.defaultFragmentPrecision=t}}});var Ac=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(Ac||{});class Cc{constructor(t,e=null,s=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=s,this.once=n}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Mc=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Cc(null,null,1/0),this.deltaMS=1/Mc.targetFPMS,this.elapsedMS=1/Mc.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,s=Ac.NORMAL){return this._addListener(new Cc(t,e,s))}addOnce(t,e,s=Ac.NORMAL){return this._addListener(new Cc(t,e,s,!0))}_addListener(t){let e=this._head.next,s=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(s);break}s=e,e=e.next}t.previous||t.connect(s)}else t.connect(s);return this._startIfPossible(),this}remove(t,e){let s=this._head.next;for(;s;)s=s.match(t,e)?s.destroy():s.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const e=t-this._lastFrame|0;if(e<this._minElapsedMS)return;this._lastFrame=t-e%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Mc.targetFPMS;const s=this._head;let n=s.next;for(;n;)n=n.emit(this.deltaTime);s.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),s=Math.min(Math.max(0,e)/1e3,Mc.targetFPMS);this._maxElapsedMS=1/s}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(0===t)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Mc._shared){const t=Mc._shared=new Mc;t.autoStart=!0,t._protected=!0}return Mc._shared}static get system(){if(!Mc._system){const t=Mc._system=new Mc;t.autoStart=!0,t._protected=!0}return Mc._system}};let Ic=Mc;Ic.targetFPMS=.06,Object.defineProperties(_r,{TARGET_FPMS:{get:()=>Ic.targetFPMS,set(t){Ua("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Ic.targetFPMS=t}}});class Pc{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,Ac.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Ic.shared:new Ic,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Pc.extension=Wo.Application,Go.add(Pc);const Rc=[];Go.handleByList(Wo.Renderer,Rc);const kc="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class Dc{constructor(t){this.renderer=t}contextChange(t){let e;if(1===this.renderer.context.webGLVersion){const s=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,s)}else{const s=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,s)}e>=vr.HIGH?this.multisample=vr.HIGH:e>=vr.MEDIUM?this.multisample=vr.MEDIUM:e>=vr.LOW?this.multisample=vr.LOW:this.multisample=vr.NONE}destroy(){}}Dc.extension={type:Wo.RendererSystem,name:"_multisample"},Go.add(Dc);class Fc{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Oc{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:s}=this,n=t._glBuffers[s]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:s,CONTEXT_UID:n}=this;if(this.boundBufferBases[e]!==t){const i=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,s.bindBufferBase(s.UNIFORM_BUFFER,e,i.buffer)}}bindBufferRange(t,e,s){const{gl:n,CONTEXT_UID:i}=this;s=s||0;const r=t._glBuffers[i]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,r.buffer,256*s,256)}update(t){const{gl:e,CONTEXT_UID:s}=this,n=t._glBuffers[s]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const s=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,s)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const s=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),s&&(e||n.deleteBuffer(s.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let s=0;s<e.length;s++)this.dispose(this.managedBuffers[e[s]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:s}=this;return t._glBuffers[e]=new Fc(s.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Oc.extension={type:Wo.RendererSystem,name:"buffer"},Go.add(Oc);class Nc{constructor(t){this.renderer=t}render(t,e){const s=this.renderer;let n,i,r,a;if(e&&(n=e.renderTexture,i=e.clear,r=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!n,s.runners.prerender.emit(),s.emit("prerender"),s.projection.transform=r,!s.context.isLost){if(n||(this.lastObjectRendered=t),!a){const e=t.enableTempParent();t.updateTransform(),t.disableTempParent(e)}s.renderTexture.bind(n),s.batch.currentRenderer.start(),(null!=i?i:s.background.clearBeforeRender)&&s.renderTexture.clear(),t.render(s),s.batch.currentRenderer.flush(),n&&(e.blit&&s.framebuffer.blit(),n.baseTexture.update()),s.runners.postrender.emit(),s.projection.transform=null,s.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Nc.extension={type:Wo.RendererSystem,name:"objectRenderer"},Go.add(Nc);const Bc=class extends xc{constructor(t){super(),this.type=sr.WEBGL,t=Object.assign({},_r.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new hl({projectionMatrix:new Ch},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Bc.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(Ua("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&"notMultiplied"!==t.useContextAlpha,t.backgroundAlpha=!1===t.useContextAlpha?1:t.backgroundAlpha),this._plugin.rendererPlugins=Bc.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return!(null==t?void 0:t.forceCanvas)&&(void 0===Xa&&(Xa=function(){var t;const e={stencil:!0,failIfMajorPerformanceCaveat:_r.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!_r.ADAPTER.getWebGLRenderingContext())return!1;const s=_r.ADAPTER.createCanvas();let n=s.getContext("webgl",e)||s.getContext("experimental-webgl",e);const i=!!(null==(t=null==n?void 0:n.getContextAttributes())?void 0:t.stencil);if(n){const t=n.getExtension("WEBGL_lose_context");t&&t.loseContext()}return n=null,i}catch(jp){return!1}}()),Xa)}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Ua("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Ua("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Ua("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Ua("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){Ua("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return Ua("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){Ua("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return Ua("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};let Lc=Bc;Lc.extension={type:Wo.Renderer,priority:1},Lc.__plugins={},Lc.__systems={},Go.handleByMap(Wo.RendererPlugin,Lc.__plugins),Go.handleByMap(Wo.RendererSystem,Lc.__systems),Go.add(Lc);class Vc extends eh{constructor(t,e){const{width:s,height:n}=e||{};super(s,n),this.items=[],this.itemDirtyIds=[];for(let i=0;i<t;i++){const t=new rh;this.items.push(t),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let s=0;s<this.length;s++)t[s]&&(t[s].castToBaseTexture?this.addBaseTextureAt(t[s].castToBaseTexture(),s):t[s]instanceof eh?this.addResourceAt(t[s],s):this.addResourceAt(Jo(t[s],e),s))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map((t=>t.resource)).filter((t=>t)).map((t=>t.load()));return this._load=Promise.all(t).then((()=>{const{realWidth:t,realHeight:e}=this.items[0];return this.resize(t,e),Promise.resolve(this)})),this._load}}const $c=class extends Vc{constructor(t,e){const{width:s,height:n,autoLoad:i,linkBaseTexture:r}=e||{};if(t&&t.length!==$c.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:s,height:n});for(let a=0;a<$c.SIDES;a++)this.items[a].target=or.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=!1!==r,t&&this.initFromArray(t,e),!1!==i&&this.load()}bind(t){super.bind(t),t.target=or.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,s){if(void 0===s&&(s=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=or.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,s){const n=this.itemDirtyIds;for(let i=0;i<$c.SIDES;i++){const r=this.items[i];(n[i]<r.dirtyId||s.dirtyId<e.dirtyId)&&(r.valid&&r.resource?(r.resource.upload(t,r,s),n[i]=r.dirtyId):n[i]<-1&&(t.gl.texImage2D(r.target,0,s.internalFormat,e.realWidth,e.realHeight,0,e.format,s.type,null),n[i]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===$c.SIDES}};let Uc=$c;Uc.SIDES=6;class Xc extends Sl{constructor(t,e){var s;let n,i;e=e||{},"string"==typeof t?(n=Xc.EMPTY,i=t):(n=t,i=null),super(n),this.url=i,this.crossOrigin=null==(s=e.crossOrigin)||s,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise(((t,e)=>f(this,null,(function*(){if(null!==this.url)try{const e=yield _r.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const s=yield e.blob();if(this.destroyed)return;const n=yield createImageBitmap(s,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===fr.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=n,this.update(),t(this)}catch(jp){if(this.destroyed)return;e(jp),this.onError.emit(jp)}else t(this)}))))),this._load}upload(t,e,s){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),super.upload(t,e,s)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&"undefined"!=typeof ImageBitmap&&("string"==typeof t||t instanceof ImageBitmap)}static get EMPTY(){var t;return Xc._EMPTY=null!=(t=Xc._EMPTY)?t:_r.ADAPTER.createCanvas(0,0),Xc._EMPTY}}const Yc=class extends Sl{constructor(t,e){e=e||{},super(_r.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((t=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),t(this)},Yc.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}))),this._load}_loadSvg(){const t=new Image;Sl.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,s=t.height;if(!e||!s)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let n=e*this.scale,i=s*this.scale;(this._overrideWidth||this._overrideHeight)&&(n=this._overrideWidth||this._overrideHeight/s*e,i=this._overrideHeight||this._overrideWidth/e*s),n=Math.round(n),i=Math.round(i);const r=this.source;r.width=n,r.height=i,r._pixiId=`canvas_${ko()}`,r.getContext("2d").drawImage(t,0,0,e,s,0,0,n,i),this._resolve(),this._resolve=null}}static getSize(t){const e=Yc.SVG_SIZE.exec(t),s={};return e&&(s[e[1]]=Math.round(parseFloat(e[3])),s[e[5]]=Math.round(parseFloat(e[7]))),s}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return"svg"===e||"string"==typeof t&&t.startsWith("data:image/svg+xml")||"string"==typeof t&&Yc.SVG_XML.test(t)}};let Wc=Yc;Wc.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Wc.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const jc=class extends Sl{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const s=document.createElement("video");s.setAttribute("preload","auto"),s.setAttribute("webkit-playsinline",""),s.setAttribute("playsinline",""),"string"==typeof t&&(t=[t]);const n=t[0].src||t[0];Sl.crossOrigin(s,n,e.crossorigin);for(let e=0;e<t.length;++e){const n=document.createElement("source");let{src:i,mime:r}=t[e];i=i||t[e];const a=i.split("?").shift().toLowerCase(),o=a.slice(a.lastIndexOf(".")+1);r=r||jc.MIME_TYPES[o]||`video/${o}`,n.src=i,n.type=r,s.appendChild(n)}t=s}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==e.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==e.autoLoad&&this.load()}update(t=0){if(!this.destroyed){const t=Ic.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e=>{this.valid?e(this):(this._resolve=e,t.load())})),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Ic.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Ic.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._isConnectedToTicker&&(Ic.shared.remove(this.update,this),this._isConnectedToTicker=!1);const t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Ic.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Ic.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t)}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||jc.TYPES.includes(e)}};let zc=jc;zc.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],zc.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},Qo.push(Xc,Tl,class extends Sl{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return!!(e&&t instanceof e)||globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}},zc,Wc,sh,Uc,class extends Vc{constructor(t,e){const{width:s,height:n}=e||{};let i,r;Array.isArray(t)?(i=t,r=t.length):r=t,super(r,{width:s,height:n}),i&&this.initFromArray(i,e)}addBaseTextureAt(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this}bind(t){super.bind(t),t.target=or.TEXTURE_2D_ARRAY}upload(t,e,s){const{length:n,itemDirtyIds:i,items:r}=this,{gl:a}=t;s.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,s.internalFormat,this._width,this._height,n,0,e.format,s.type,null);for(let o=0;o<n;o++){const t=r[o];i[o]<t.dirtyId&&(i[o]=t.dirtyId,t.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,o,t.resource.width,t.resource.height,1,e.format,s.type,t.resource.source))}return!0}});class Gc{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?wh.EMPTY:((t=t||new wh(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:s,b:n,c:i,d:r,tx:a,ty:o}=t,h=s*e.x+i*e.y+a,l=n*e.x+r*e.y+o;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,l),this.maxY=Math.max(this.maxY,l)}addQuad(t){let e=this.minX,s=this.minY,n=this.maxX,i=this.maxY,r=t[0],a=t[1];e=r<e?r:e,s=a<s?a:s,n=r>n?r:n,i=a>i?a:i,r=t[2],a=t[3],e=r<e?r:e,s=a<s?a:s,n=r>n?r:n,i=a>i?a:i,r=t[4],a=t[5],e=r<e?r:e,s=a<s?a:s,n=r>n?r:n,i=a>i?a:i,r=t[6],a=t[7],e=r<e?r:e,s=a<s?a:s,n=r>n?r:n,i=a>i?a:i,this.minX=e,this.minY=s,this.maxX=n,this.maxY=i}addFrame(t,e,s,n,i){this.addFrameMatrix(t.worldTransform,e,s,n,i)}addFrameMatrix(t,e,s,n,i){const r=t.a,a=t.b,o=t.c,h=t.d,l=t.tx,c=t.ty;let u=this.minX,d=this.minY,f=this.maxX,p=this.maxY,m=r*e+o*s+l,g=a*e+h*s+c;u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=r*n+o*s+l,g=a*n+h*s+c,u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=r*e+o*i+l,g=a*e+h*i+c,u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=r*n+o*i+l,g=a*n+h*i+c,u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,this.minX=u,this.minY=d,this.maxX=f,this.maxY=p}addVertexData(t,e,s){let n=this.minX,i=this.minY,r=this.maxX,a=this.maxY;for(let o=e;o<s;o+=2){const e=t[o],s=t[o+1];n=e<n?e:n,i=s<i?s:i,r=e>r?e:r,a=s>a?s:a}this.minX=n,this.minY=i,this.maxX=r,this.maxY=a}addVertices(t,e,s,n){this.addVerticesMatrix(t.worldTransform,e,s,n)}addVerticesMatrix(t,e,s,n,i=0,r=i){const a=t.a,o=t.b,h=t.c,l=t.d,c=t.tx,u=t.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY;for(let g=s;g<n;g+=2){const t=e[g],s=e[g+1],n=a*t+h*s+c,y=l*s+o*t+u;d=Math.min(d,n-i),p=Math.max(p,n+i),f=Math.min(f,y-r),m=Math.max(m,y+r)}this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addBounds(t){const e=this.minX,s=this.minY,n=this.maxX,i=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<s?t.minY:s,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>i?t.maxY:i}addBoundsMask(t,e){const s=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,i=t.maxX<e.maxX?t.maxX:e.maxX,r=t.maxY<e.maxY?t.maxY:e.maxY;if(s<=i&&n<=r){const t=this.minX,e=this.minY,a=this.maxX,o=this.maxY;this.minX=s<t?s:t,this.minY=n<e?n:e,this.maxX=i>a?i:a,this.maxY=r>o?r:o}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const s=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,i=t.maxX<e.x+e.width?t.maxX:e.x+e.width,r=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(s<=i&&n<=r){const t=this.minX,e=this.minY,a=this.maxX,o=this.maxY;this.minX=s<t?s:t,this.minY=n<e?n:e,this.maxX=i>a?i:a,this.maxY=r>o?r:o}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,s,n,i,r){t-=i,e-=r,s+=i,n+=r,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>s?this.maxX:s,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n}}class Hc extends g{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Lh,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Gc,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let s=0;s<e.length;++s){const n=e[s];Object.defineProperty(Hc.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new wh),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new wh),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Gc);const e=this.transform,s=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,i=this._boundsID;this._bounds=this._localBounds;const r=this.getBounds(!1,t);return this.parent=s,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-i,r}toGlobal(t,e,s=!1){return s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,s,n){return e&&(t=e.toGlobal(t,s,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,s)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;null==(t=this.parent)||t.removeChild(this)}setTransform(t=0,e=0,s=1,n=1,i=0,r=0,a=0,o=0,h=0){return this.position.x=t,this.position.y=e,this.scale.x=s||1,this.scale.y=n||1,this.rotation=i,this.skew.x=r,this.skew.y=a,this.pivot.x=o,this.pivot.y=h,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new qc),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*yh}set angle(t){this.transform.rotation=t*vh}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,0===t._maskRefCount&&(t.renderable=!0,t.isMask=!1))}if(this._mask=t,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(0===t._maskRefCount&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class qc extends Hc{constructor(){super(...arguments),this.sortDirty=null}}Hc.prototype.displayObjectUpdateTransform=Hc.prototype.updateTransform;const Kc=new Ch;function Zc(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}const Qc=class extends Hc{constructor(){super(),this.children=[],this.sortableChildren=Qc.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const s=this.getChildIndex(t),n=this.getChildIndex(e);this.children[s]=e,this.children[n]=t,this.onChildrenChange(s<n?s:n)}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const s=this.getChildIndex(t);Io(this.children,s,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],s=this.children.indexOf(e);if(-1===s)return null;e.parent=null,e.transform._parentID=-1,Io(this.children,s,1),this._boundsID++,this.onChildrenChange(s),e.emit("removed",this),this.emit("childRemoved",e,this,s)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Io(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const s=t,n=e-s;let i;if(n>0&&n<=e){i=this.children.splice(s,n);for(let t=0;t<i.length;++t)i[t].parent=null,i[t].transform&&(i[t].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let t=0;t<i.length;++t)i[t].emit("removed",this),this.emit("childRemoved",i[t],this,t);return i}if(0===n&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,s=this.children.length;e<s;++e){const s=this.children[e];s._lastSortedIndex=e,t||0===s.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(Zc),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){const t=e._mask.isMaskData?e._mask.maskObject:e._mask;t?(t.calculateBounds(),this._bounds.addBoundsMask(e._bounds,t._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const s=super.getLocalBounds(t);if(!e)for(let n=0,i=this.children.length;n<i;++n){const t=this.children[n];t.visible&&t.updateTransform()}return s}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let s,n;this.cullArea?(s=this.cullArea,n=this.worldTransform):this._render!==Qc.prototype._render&&(s=this.getBounds(!0));const i=t.projection.transform;if(i&&(n?(n=Kc.copyFrom(n),n.prepend(i)):n=i),s&&e.intersects(s,n))this._render(t);else if(this.cullArea)return;for(let r=0,a=this.children.length;r<a;++r){const e=this.children[r],s=e.cullable;e.cullable=s||!this.cullArea,e.render(t),e.cullable=s}}render(t){var e;if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||(null==(e=this.filters)?void 0:e.length))this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,s=this.children.length;e<s;++e)this.children[e].render(t)}}renderAdvanced(t){var e,s,n;const i=this.filters,r=this._mask;if(i){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let t=0;t<i.length;t++)i[t].enabled&&this._enabledFilters.push(i[t])}const a=i&&(null==(e=this._enabledFilters)?void 0:e.length)||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==yr.NONE));if(a&&t.batch.flush(),i&&(null==(s=this._enabledFilters)?void 0:s.length)&&t.filter.push(this,this._enabledFilters),r&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,s=this.children.length;e<s;++e)this.children[e].render(t)}a&&t.batch.flush(),r&&t.mask.pop(this),i&&(null==(n=this._enabledFilters)?void 0:n.length)&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e="boolean"==typeof t?t:null==t?void 0:t.children,s=this.removeChildren(0,this.children.length);if(e)for(let n=0;n<s.length;++n)s[n].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}};let Jc=Qc;Jc.defaultSortableChildren=!1,Jc.prototype.containerUpdateTransform=Jc.prototype.updateTransform,Object.defineProperties(_r,{SORTABLE_CHILDREN:{get:()=>Jc.defaultSortableChildren,set(t){Ua("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Jc.defaultSortableChildren=t}}});const tu=new _h,eu=new Uint16Array([0,1,2,0,2,3]);class su extends Jc{constructor(t){super(),this._anchor=new Nh(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new _o(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=ir.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Il.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=eu,this.pluginName="batch",this.isSprite=!0,this._roundPixels=_r.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Po(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Po(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,s=e.a,n=e.b,i=e.c,r=e.d,a=e.tx,o=e.ty,h=this.vertexData,l=t.trim,c=t.orig,u=this._anchor;let d=0,f=0,p=0,m=0;if(l?(f=l.x-u._x*c.width,d=f+l.width,m=l.y-u._y*c.height,p=m+l.height):(f=-u._x*c.width,d=f+c.width,m=-u._y*c.height,p=m+c.height),h[0]=s*f+i*m+a,h[1]=r*m+n*f+o,h[2]=s*d+i*m+a,h[3]=r*m+n*d+o,h[4]=s*d+i*p+a,h[5]=r*p+n*d+o,h[6]=s*f+i*p+a,h[7]=r*p+n*f+o,this._roundPixels){const t=_r.RESOLUTION;for(let e=0;e<h.length;++e)h[e]=Math.round(h[e]*t)/t}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,s=t.orig,n=this._anchor,i=this.transform.worldTransform,r=i.a,a=i.b,o=i.c,h=i.d,l=i.tx,c=i.ty,u=-n._x*s.width,d=u+s.width,f=-n._y*s.height,p=f+s.height;e[0]=r*u+o*f+l,e[1]=h*f+a*u+c,e[2]=r*d+o*f+l,e[3]=h*f+a*d+c,e[4]=r*d+o*p+l,e[5]=h*p+a*d+c,e[6]=r*u+o*p+l,e[7]=h*p+a*u+c}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return 0===this.children.length?(this._localBounds||(this._localBounds=new Gc),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new wh),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,tu);const e=this._texture.orig.width,s=this._texture.orig.height,n=-e*this.anchor.x;let i=0;return tu.x>=n&&tu.x<n+e&&(i=-s*this.anchor.y,tu.y>=i&&tu.y<i+s)}destroy(t){super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null;if("boolean"==typeof t?t:null==t?void 0:t.texture){const e="boolean"==typeof t?t:null==t?void 0:t.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const s=t instanceof Il?t:Il.from(t,e);return new su(s)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=Po(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=Po(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Il.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const nu=new Ch;Hc.prototype._cacheAsBitmap=!1,Hc.prototype._cacheData=null,Hc.prototype._cacheAsBitmapResolution=null,Hc.prototype._cacheAsBitmapMultisample=null;class iu{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Hc.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(t){if(this._cacheAsBitmap===t)return;let e;this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new iu),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}),Hc.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},Hc.prototype._initCachedDisplayObject=function(t){var e,s,n;if(null==(e=this._cacheData)?void 0:e.sprite)return;const i=this.alpha;this.alpha=1,t.batch.flush();const r=this.getLocalBounds(null,!0).clone();if(null==(s=this.filters)?void 0:s.length){const t=this.filters[0].padding;r.pad(t)}r.ceil(_r.RESOLUTION);const a=t.renderTexture.current,o=t.renderTexture.sourceFrame.clone(),h=t.renderTexture.destinationFrame.clone(),l=t.projection.transform,c=Pl.create({width:r.width,height:r.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:null!=(n=this.cacheAsBitmapMultisample)?n:t.multisample}),u=`cacheAsBitmap_${ko()}`;this._cacheData.textureCacheId=u,rh.addToCache(c.baseTexture,u),Il.addToCache(c,u);const d=this.transform.localTransform.copyTo(nu).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:c,clear:!0,transform:d,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=l,t.renderTexture.bind(a,o,h),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const f=new su(c);f.transform.worldTransform=this.transform.worldTransform,f.anchor.x=-r.x/r.width,f.anchor.y=-r.y/r.height,f.alpha=i,f._bounds=this._bounds,this._cacheData.sprite=f,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=f.containsPoint.bind(f)},Hc.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},Hc.prototype._initCachedDisplayObjectCanvas=function(t){var e;if(null==(e=this._cacheData)?void 0:e.sprite)return;const s=this.getLocalBounds(null,!0),n=this.alpha;this.alpha=1;const i=t.canvasContext.activeContext,r=t._projTransform;s.ceil(_r.RESOLUTION);const a=Pl.create({width:s.width,height:s.height}),o=`cacheAsBitmap_${ko()}`;this._cacheData.textureCacheId=o,rh.addToCache(a.baseTexture,o),Il.addToCache(a,o);const h=nu;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=s.x,h.ty-=s.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:a,clear:!0,transform:h,skipUpdateTransform:!1}),t.canvasContext.activeContext=i,t._projTransform=r,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=n;const l=new su(a);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-s.x/s.width,l.anchor.y=-s.y/s.height,l.alpha=n,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)},Hc.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},Hc.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},Hc.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,rh.removeFromCache(this._cacheData.textureCacheId),Il.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},Hc.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},Hc.prototype.name=null,Jc.prototype.getChildByName=function(t,e){for(let s=0,n=this.children.length;s<n;s++)if(this.children[s].name===t)return this.children[s];if(e)for(let s=0,n=this.children.length;s<n;s++){const e=this.children[s];if(!e.getChildByName)continue;const n=e.getChildByName(t,!0);if(n)return n}return null},Hc.prototype.getGlobalPosition=function(t=new _h,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};const ru={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},au=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");const ou="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }";class hu extends gl{constructor(t,e=8,s=4,n=gl.defaultResolution,i=5){const r=function(t,e){const s=Math.ceil(t/2);let n,i=ou,r="";n=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let a=0;a<t;a++){let t=n.replace("%index%",a.toString());t=t.replace("%sampleIndex%",a-(s-1)+".0"),r+=t,r+="\n"}return i=i.replace("%blur%",r),i=i.replace("%size%",t.toString()),i}(i,t),a=function(t){const e=ru[t],s=e.length;let n,i=au,r="";for(let a=0;a<t;a++){let i="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",a.toString());n=a,a>=s&&(n=t-a-1),i=i.replace("%value%",e[n].toString()),r+=i,r+="\n"}return i=i.replace("%blur%",r),i=i.replace("%size%",t.toString()),i}(i);super(r,a),this.horizontal=t,this.resolution=n,this._quality=0,this.quality=s,this.blur=e}apply(t,e,s,n){if(s?this.horizontal?this.uniforms.strength=1/s.width*(s.width/e.width):this.uniforms.strength=1/s.height*(s.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,s,n);else{const i=t.getFilterTexture(),r=t.renderer;let a=e,o=i;this.state.blend=!1,t.applyFilter(this,a,o,pr.CLEAR);for(let e=1;e<this.passes-1;e++){t.bindAndClear(a,pr.BLIT),this.uniforms.uSampler=o;const e=o;o=a,a=e,r.shader.bind(this),r.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,o,s,n),t.returnFilterTexture(i)}}get blur(){return this.strength}set blur(t){this.padding=1+2*Math.abs(t),this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class lu extends gl{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(kc,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",t),this.alpha=1}_loadMatrix(t,e=!1){let s=t;e&&(this._multiply(s,this.uniforms.m,t),s=this._colorMatrix(s)),this.uniforms.m=s}_multiply(t,e,s){return t[0]=e[0]*s[0]+e[1]*s[5]+e[2]*s[10]+e[3]*s[15],t[1]=e[0]*s[1]+e[1]*s[6]+e[2]*s[11]+e[3]*s[16],t[2]=e[0]*s[2]+e[1]*s[7]+e[2]*s[12]+e[3]*s[17],t[3]=e[0]*s[3]+e[1]*s[8]+e[2]*s[13]+e[3]*s[18],t[4]=e[0]*s[4]+e[1]*s[9]+e[2]*s[14]+e[3]*s[19]+e[4],t[5]=e[5]*s[0]+e[6]*s[5]+e[7]*s[10]+e[8]*s[15],t[6]=e[5]*s[1]+e[6]*s[6]+e[7]*s[11]+e[8]*s[16],t[7]=e[5]*s[2]+e[6]*s[7]+e[7]*s[12]+e[8]*s[17],t[8]=e[5]*s[3]+e[6]*s[8]+e[7]*s[13]+e[8]*s[18],t[9]=e[5]*s[4]+e[6]*s[9]+e[7]*s[14]+e[8]*s[19]+e[9],t[10]=e[10]*s[0]+e[11]*s[5]+e[12]*s[10]+e[13]*s[15],t[11]=e[10]*s[1]+e[11]*s[6]+e[12]*s[11]+e[13]*s[16],t[12]=e[10]*s[2]+e[11]*s[7]+e[12]*s[12]+e[13]*s[17],t[13]=e[10]*s[3]+e[11]*s[8]+e[12]*s[13]+e[13]*s[18],t[14]=e[10]*s[4]+e[11]*s[9]+e[12]*s[14]+e[13]*s[19]+e[14],t[15]=e[15]*s[0]+e[16]*s[5]+e[17]*s[10]+e[18]*s[15],t[16]=e[15]*s[1]+e[16]*s[6]+e[17]*s[11]+e[18]*s[16],t[17]=e[15]*s[2]+e[16]*s[7]+e[17]*s[12]+e[18]*s[17],t[18]=e[15]*s[3]+e[16]*s[8]+e[17]*s[13]+e[18]*s[18],t[19]=e[15]*s[4]+e[16]*s[9]+e[17]*s[14]+e[18]*s[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const s=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(s,e)}tint(t,e){const[s,n,i]=_o.shared.setValue(t).toArray(),r=[s,0,0,0,0,0,n,0,0,0,0,0,i,0,0,0,0,0,1,0];this._loadMatrix(r,e)}greyscale(t,e){const s=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(s,e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const s=Math.cos(t),n=Math.sin(t),i=1/3,r=(0,Math.sqrt)(i),a=[s+(1-s)*i,i*(1-s)-r*n,i*(1-s)+r*n,0,0,i*(1-s)+r*n,s+i*(1-s),i*(1-s)-r*n,0,0,i*(1-s)-r*n,i*(1-s)+r*n,s+i*(1-s),0,0,0,0,0,1,0];this._loadMatrix(a,e)}contrast(t,e){const s=(t||0)+1,n=-.5*(s-1),i=[s,0,0,0,n,0,s,0,0,n,0,0,s,0,n,0,0,0,1,0];this._loadMatrix(i,e)}saturate(t=0,e){const s=2*t/3+1,n=-.5*(s-1),i=[s,n,n,0,0,n,s,n,0,0,n,n,s,0,0,0,0,0,1,0];this._loadMatrix(i,e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,s,n,i){t=t||.2,e=e||.15,s=s||16770432,n=n||3375104;const r=_o.shared,[a,o,h]=r.setValue(s).toArray(),[l,c,u]=r.setValue(n).toArray(),d=[.3,.59,.11,0,0,a,o,h,t,0,l,c,u,e,0,a-l,o-c,h-u,0,0];this._loadMatrix(d,i)}night(t,e){const s=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(s,e)}predator(t,e){const s=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(s,e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}lu.prototype.grayscale=lu.prototype.greyscale;const cu={AlphaFilter:class extends gl{constructor(t=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}},BlurFilter:class extends gl{constructor(t=8,e=4,s=gl.defaultResolution,n=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new hu(!0,t,e,s,n),this.blurYFilter=new hu(!1,t,e,s,n),this.resolution=s,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,s,n){const i=Math.abs(this.blurXFilter.strength),r=Math.abs(this.blurYFilter.strength);if(i&&r){const i=t.getFilterTexture();this.blurXFilter.apply(t,e,i,pr.CLEAR),this.blurYFilter.apply(t,i,s,n),t.returnFilterTexture(i)}else r?this.blurYFilter.apply(t,e,s,n):this.blurXFilter.apply(t,e,s,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}},BlurFilterPass:hu,ColorMatrixFilter:lu,DisplacementFilter:class extends gl{constructor(t,e){const s=new Ch;t.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:t._texture,filterMatrix:s,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=s,null==e&&(e=20),this.scale=new _h(e,e)}apply(t,e,s,n){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const i=this.maskSprite.worldTransform,r=Math.sqrt(i.a*i.a+i.b*i.b),a=Math.sqrt(i.c*i.c+i.d*i.d);0!==r&&0!==a&&(this.uniforms.rotation[0]=i.a/r,this.uniforms.rotation[1]=i.b/r,this.uniforms.rotation[2]=i.c/a,this.uniforms.rotation[3]=i.d/a),t.applyFilter(this,e,s,n)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}},FXAAFilter:class extends gl{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}},NoiseFilter:class extends gl{constructor(t=.5,e=Math.random()){super(kc,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}};Object.entries(cu).forEach((([t,e])=>{Object.defineProperty(cu,t,{get:()=>(Ua("7.1.0",`filters.${t} has moved to ${t}`),e)})}));const uu=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){!this.tickerAdded&&this.domElement&&(Ic.system.add(this.tickerUpdate,this,Ac.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Ic.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===t.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())}};class du{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=du.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new _h,this.page=new _h,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,s){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,s,n,i){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class fu extends du{constructor(){super(...arguments),this.client=new _h,this.movement=new _h,this.offset=new _h,this.global=new _h,this.screen=new _h}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,s){return t.worldTransform.applyInverse(s||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,s,n,i,r,a,o,h,l,c,u,d,f,p){throw new Error("Method not implemented.")}}class pu extends fu{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class mu extends fu{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}mu.DOM_DELTA_PIXEL=0,mu.DOM_DELTA_LINE=1,mu.DOM_DELTA_PAGE=2;const gu=new _h,yu=new _h;class vu{constructor(t){this.dispatch=new g,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let s=0,n=e.length;s<n;s++)e[s].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){uu.pauseUpdate=!0;const s=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,gu.set(t,e),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(t,e){if(!t.target)return;const s=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,i=s.length-1;n<i;n++)if(t.currentTarget=s[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let n=s.length-2;n>=0;n--)if(t.currentTarget=s[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,s=this._allInteractiveElements){if(0===s.length)return;t.eventPhase=t.BUBBLING_PHASE;const n=Array.isArray(e)?e:[e];for(let i=s.length-1;i>=0;i--)n.forEach((e=>{t.currentTarget=s[i],this.notifyTarget(t,e)}))}propagationPath(t){const e=[t];for(let s=0;s<2048&&t!==this.rootTarget;s++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,s,n,i,r=!1){let a=!1;if(this._interactivePrune(t))return null;if("dynamic"!==t.eventMode&&"dynamic"!==e||(uu.pauseUpdate=!1),t.interactiveChildren&&t.children){const o=t.children;for(let h=o.length-1;h>=0;h--){const l=o[h],c=this.hitTestMoveRecursive(l,this._isInteractive(e)?e:l.eventMode,s,n,i,r||i(t,s));if(c){if(c.length>0&&!c[c.length-1].parent)continue;const e=t.isInteractive();(c.length>0||e)&&(e&&this._allInteractiveElements.push(t),c.push(t)),0===this._hitElements.length&&(this._hitElements=c),a=!0}}}const o=this._isInteractive(e),h=t.isInteractive();return h&&h&&this._allInteractiveElements.push(t),r||this._hitElements.length>0?null:a?this._hitElements:o&&!i(t,s)&&n(t,s)?h?[t]:[]:null}hitTestRecursive(t,e,s,n,i){if(this._interactivePrune(t)||i(t,s))return null;if("dynamic"!==t.eventMode&&"dynamic"!==e||(uu.pauseUpdate=!1),t.interactiveChildren&&t.children){const r=t.children;for(let a=r.length-1;a>=0;a--){const o=r[a],h=this.hitTestRecursive(o,this._isInteractive(e)?e:o.eventMode,s,n,i);if(h){if(h.length>0&&!h[h.length-1].parent)continue;const e=t.isInteractive();return(h.length>0||e)&&h.push(t),h}}}const r=this._isInteractive(e),a=t.isInteractive();return r&&n(t,s)?a?[t]:[]:null}_isInteractive(t){return"static"===t||"dynamic"===t}_interactivePrune(t){return!(t&&!t.isMask&&t.visible&&t.renderable)||("none"===t.eventMode||("passive"===t.eventMode&&!t.interactiveChildren||!!t.isMask))}hitPruneFn(t,e){var s;if(t.hitArea&&(t.worldTransform.applyInverse(e,yu),!t.hitArea.contains(yu.x,yu.y)))return!0;if(t._mask){const n=t._mask.isMaskData?t._mask.maskObject:t._mask;if(n&&!(null==(s=n.containsPoint)?void 0:s.call(n,e)))return!0}return!1}hitTestFn(t,e){return"passive"!==t.eventMode&&(!!t.hitArea||!!t.containsPoint&&t.containsPoint(e))}notifyTarget(t,e){var s,n;const i=`on${e=null!=e?e:t.type}`;null==(n=(s=t.currentTarget)[i])||n.call(s,t);const r=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,r),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof pu))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)this.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.dispatchEvent(e,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var e,s,n;if(!(t instanceof pu))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const i=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const r="mouse"===i.pointerType||"pen"===i.pointerType,a=this.trackingData(t.pointerId),o=this.findMountedTarget(a.overTargets);if((null==(e=a.overTargets)?void 0:e.length)>0&&o!==i.target){const e="mousemove"===t.type?"mouseout":"pointerout",s=this.createPointerEvent(t,e,o);if(this.dispatchEvent(s,"pointerout"),r&&this.dispatchEvent(s,"mouseout"),!i.composedPath().includes(o)){const e=this.createPointerEvent(t,"pointerleave",o);for(e.eventPhase=e.AT_TARGET;e.target&&!i.composedPath().includes(e.target);)e.currentTarget=e.target,this.notifyTarget(e),r&&this.notifyTarget(e,"mouseleave"),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(s)}if(o!==i.target){const e="mousemove"===t.type?"mouseover":"pointerover",s=this.clonePointerEvent(i,e);this.dispatchEvent(s,"pointerover"),r&&this.dispatchEvent(s,"mouseover");let n=null==o?void 0:o.parent;for(;n&&n!==this.rootTarget.parent&&n!==i.target;)n=n.parent;if(!n||n===this.rootTarget.parent){const t=this.clonePointerEvent(i,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==o&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),r&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(s)}const h=[],l=null==(s=this.enableGlobalMoveEvents)||s;this.moveOnAll?h.push("pointermove"):this.dispatchEvent(i,"pointermove"),l&&h.push("globalpointermove"),"touch"===i.pointerType&&(this.moveOnAll?h.splice(1,0,"touchmove"):this.dispatchEvent(i,"touchmove"),l&&h.push("globaltouchmove")),r&&(this.moveOnAll?h.splice(1,0,"mousemove"):this.dispatchEvent(i,"mousemove"),l&&h.push("globalmousemove"),this.cursor=null==(n=i.target)?void 0:n.cursor),h.length>0&&this.all(i,h),this._allInteractiveElements.length=0,this._hitElements.length=0,a.overTargets=i.composedPath(),this.freeEvent(i)}mapPointerOver(t){var e;if(!(t instanceof pu))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const s=this.trackingData(t.pointerId),n=this.createPointerEvent(t),i="mouse"===n.pointerType||"pen"===n.pointerType;this.dispatchEvent(n,"pointerover"),i&&this.dispatchEvent(n,"mouseover"),"mouse"===n.pointerType&&(this.cursor=null==(e=n.target)?void 0:e.cursor);const r=this.clonePointerEvent(n,"pointerenter");for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),i&&this.notifyTarget(r,"mouseenter"),r.target=r.target.parent;s.overTargets=n.composedPath(),this.freeEvent(n),this.freeEvent(r)}mapPointerOut(t){if(!(t instanceof pu))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId);if(e.overTargets){const s="mouse"===t.pointerType||"pen"===t.pointerType,n=this.findMountedTarget(e.overTargets),i=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(i),s&&this.dispatchEvent(i,"mouseout");const r=this.createPointerEvent(t,"pointerleave",n);for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),s&&this.notifyTarget(r,"mouseleave"),r.target=r.target.parent;e.overTargets=null,this.freeEvent(i),this.freeEvent(r)}this.cursor=null}mapPointerUp(t){if(!(t instanceof pu))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=performance.now(),s=this.createPointerEvent(t);if(this.dispatchEvent(s,"pointerup"),"touch"===s.pointerType)this.dispatchEvent(s,"touchend");else if("mouse"===s.pointerType||"pen"===s.pointerType){const t=2===s.button;this.dispatchEvent(s,t?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),i=this.findMountedTarget(n.pressTargetsByButton[t.button]);let r=i;if(i&&!s.composedPath().includes(i)){let e=i;for(;e&&!s.composedPath().includes(e);){if(s.currentTarget=e,this.notifyTarget(s,"pointerupoutside"),"touch"===s.pointerType)this.notifyTarget(s,"touchendoutside");else if("mouse"===s.pointerType||"pen"===s.pointerType){const t=2===s.button;this.notifyTarget(s,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete n.pressTargetsByButton[t.button],r=e}if(r){const i=this.clonePointerEvent(s,"click");i.target=r,i.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:i.target,timeStamp:e});const a=n.clicksByButton[t.button];if(a.target===i.target&&e-a.timeStamp<200?++a.clickCount:a.clickCount=1,a.target=i.target,a.timeStamp=e,i.detail=a.clickCount,"mouse"===i.pointerType){const t=2===i.button;this.dispatchEvent(i,t?"rightclick":"click")}else"touch"===i.pointerType&&this.dispatchEvent(i,"tap");this.dispatchEvent(i,"pointertap"),this.freeEvent(i)}this.freeEvent(s)}mapPointerUpOutside(t){if(!(t instanceof pu))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),s=this.findMountedTarget(e.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(s){let i=s;for(;i;)n.currentTarget=i,this.notifyTarget(n,"pointerupoutside"),"touch"===n.pointerType?this.notifyTarget(n,"touchendoutside"):"mouse"!==n.pointerType&&"pen"!==n.pointerType||this.notifyTarget(n,2===n.button?"rightupoutside":"mouseupoutside"),i=i.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof mu))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let s=1;s<t.length&&t[s].parent===e;s++)e=t[s];return e}createPointerEvent(t,e,s){var n;const i=this.allocateEvent(pu);return this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.nativeEvent=t.nativeEvent,i.originalEvent=t,i.target=null!=(n=null!=s?s:this.hitTest(i.global.x,i.global.y))?n:this._hitElements[0],"string"==typeof e&&(i.type=e),i}createWheelEvent(t){const e=this.allocateEvent(mu);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const s=this.allocateEvent(pu);return s.nativeEvent=t.nativeEvent,s.originalEvent=t.originalEvent,this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.target=t.target,s.path=t.composedPath().slice(),s.type=null!=e?e:s.type,s}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof pu&&e instanceof pu&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof fu&&e instanceof fu&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const s=t.currentTarget._events[e];if(s&&t.currentTarget.isInteractive())if("fn"in s)s.once&&t.currentTarget.removeListener(e,s.fn,void 0,!0),s.fn.call(s.context,t);else for(let n=0,i=s.length;n<i&&!t.propagationImmediatelyStopped;n++)s[n].once&&t.currentTarget.removeListener(e,s[n].fn,void 0,!0),s[n].fn.call(s[n].context,t)}}const xu={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},_u=class{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new vu(null),uu.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new pu(null),this.rootWheelEvent=new mu(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy(l({},_u.defaultEventFeatures),{set:(t,e,s)=>("globalMove"===e&&(this.rootBoundary.enableGlobalMoveEvents=s),t[e]=s,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){var e,s;const{view:n,resolution:i}=this.renderer;this.setTargetElement(n),this.resolution=i,_u._defaultEventMode=null!=(e=t.eventMode)?e:"auto",Object.assign(this.features,null!=(s=t.eventFeatures)?s:{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const s=this.cursorStyles[t];if(s)switch(typeof s){case"string":e&&(this.domElement.style.cursor=s);break;case"function":s(t);break;case"object":e&&Object.assign(this.domElement.style,s)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);if(this.autoPreventDefault&&e[0].isNormalized){(t.cancelable||!("cancelable"in t))&&t.preventDefault()}for(let s=0,n=e.length;s<n;s++){const t=e[s],n=this.bootstrapEvent(this.rootPointerEvent,t);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;uu.pointerMoved();const e=this.normalizeToPointerData(t);for(let s=0,n=e.length;s<n;s++){const t=this.bootstrapEvent(this.rootPointerEvent,e[s]);this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const s=e!==this.domElement?"outside":"",n=this.normalizeToPointerData(t);for(let i=0,r=n.length;i<r;i++){const t=this.bootstrapEvent(this.rootPointerEvent,n[i]);t.type+=s,this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let s=0,n=e.length;s<n;s++){const t=this.bootstrapEvent(this.rootPointerEvent,e[s]);this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,uu.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;uu.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;uu.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,s){let n;n=this.domElement.parentElement?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const i=1/this.resolution;t.x=(e-n.left)*(this.domElement.width/n.width)*i,t.y=(s-n.top)*(this.domElement.height/n.height)*i}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let s=0,n=t.changedTouches.length;s<n;s++){const n=t.changedTouches[s];void 0===n.button&&(n.button=0),void 0===n.buttons&&(n.buttons=1),void 0===n.isPrimary&&(n.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===n.width&&(n.width=n.radiusX||1),void 0===n.height&&(n.height=n.radiusY||1),void 0===n.tiltX&&(n.tiltX=0),void 0===n.tiltY&&(n.tiltY=0),void 0===n.pointerType&&(n.pointerType="touch"),void 0===n.pointerId&&(n.pointerId=n.identifier||0),void 0===n.pressure&&(n.pressure=n.force||.5),void 0===n.twist&&(n.twist=0),void 0===n.tangentialPressure&&(n.tangentialPressure=0),void 0===n.layerX&&(n.layerX=n.offsetX=n.clientX),void 0===n.layerY&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=t.type,e.push(n)}else if(globalThis.MouseEvent&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof globalThis.PointerEvent))e.push(t);else{const s=t;void 0===s.isPrimary&&(s.isPrimary=!0),void 0===s.width&&(s.width=1),void 0===s.height&&(s.height=1),void 0===s.tiltX&&(s.tiltX=0),void 0===s.tiltY&&(s.tiltY=0),void 0===s.pointerType&&(s.pointerType="mouse"),void 0===s.pointerId&&(s.pointerId=1),void 0===s.pressure&&(s.pressure=.5),void 0===s.twist&&(s.twist=0),void 0===s.tangentialPressure&&(s.tangentialPressure=0),s.isNormalized=!0,e.push(s)}return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=xu[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};let bu=_u;function wu(t){return"dynamic"===t||"static"===t}bu.extension={name:"events",type:[Wo.RendererSystem,Wo.CanvasRendererSystem]},bu.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0},Go.add(bu);const Eu={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){var t;return null!=(t=this._internalInteractive)?t:wu(bu.defaultEventMode)},set interactive(t){Ua("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=t,this.eventMode=t?"static":"auto"},_internalEventMode:void 0,get eventMode(){var t;return null!=(t=this._internalEventMode)?t:bu.defaultEventMode},set eventMode(t){this._internalInteractive=wu(t),this._internalEventMode=t},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(t,e,s){const n="function"==typeof e?void 0:e;t="boolean"==typeof s&&s||"object"==typeof s&&s.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.on(t,e,n)},removeEventListener(t,e,s){const n="function"==typeof e?void 0:e;t="boolean"==typeof s&&s||"object"==typeof s&&s.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.off(t,e,n)},dispatchEvent(t){if(!(t instanceof du))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};Hc.mixin(Eu);Hc.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class Su{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Lr.tablet||Lr.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()})),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),null==(t=this.renderer.view.parentNode)||t.appendChild(this.div))}deactivate(){var t;this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),null==(t=this.div.parentNode)||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let s=0;s<e.length;s++)this.updateAccessibleObjects(e[s])}update(){const t=performance.now();if(Lr.android.device&&t<this.androidUpdateCount)return;if(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen)return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:s,width:n,height:i}=this.renderer.view.getBoundingClientRect(),{width:r,height:a,resolution:o}=this.renderer,h=n/r*o,l=i/a*o;let c=this.div;c.style.left=`${e}px`,c.style.top=`${s}px`,c.style.width=`${r}px`,c.style.height=`${a}px`;for(let u=0;u<this.children.length;u++){const t=this.children[u];if(t.renderId!==this.renderId)t._accessibleActive=!1,Io(this.children,u,1),this.div.removeChild(t._accessibleDiv),this.pool.push(t._accessibleDiv),t._accessibleDiv=null,u--;else{c=t._accessibleDiv;let e=t.hitArea;const s=t.worldTransform;t.hitArea?(c.style.left=(s.tx+e.x*s.a)*h+"px",c.style.top=(s.ty+e.y*s.d)*l+"px",c.style.width=e.width*s.a*h+"px",c.style.height=e.height*s.d*l+"px"):(e=t.getBounds(),this.capHitArea(e),c.style.left=e.x*h+"px",c.style.top=e.y*l+"px",c.style.width=e.width*h+"px",c.style.height=e.height*l+"px",c.title!==t.accessibleTitle&&null!==t.accessibleTitle&&(c.title=t.accessibleTitle),c.getAttribute("aria-label")!==t.accessibleHint&&null!==t.accessibleHint&&c.setAttribute("aria-label",t.accessibleHint)),t.accessibleTitle===c.title&&t.tabIndex===c.tabIndex||(c.title=t.accessibleTitle,c.tabIndex=t.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:s}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>s&&(t.height=s-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:s}=t.target,n=this.renderer.events.rootBoundary,i=Object.assign(new du(n),{target:s});n.rootTarget=this.renderer.lastObjectRendered,e.forEach((t=>n.dispatchEvent(i,t)))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9===t.keyCode&&this.activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Su.extension={name:"accessibility",type:[Wo.RendererPlugin,Wo.CanvasRendererPlugin]},Go.add(Su);const Tu=class{constructor(t){this.stage=new Jc,t=Object.assign({forceCanvas:!1},t),this.renderer=function(t){for(const e of Rc)if(e.test(t))return new e(t);throw new Error("Unable to auto-detect a suitable renderer.")}(t),Tu._plugins.forEach((e=>{e.init.call(this,t)}))}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(t,e){const s=Tu._plugins.slice(0);s.reverse(),s.forEach((t=>{t.destroy.call(this)})),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};let Au=Tu;Au._plugins=[],Go.handleByList(Wo.Application,Au._plugins);class Cu{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this.cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:s,clientHeight:n}=this._resizeTo;t=s,e=n}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Cu.extension=Wo.Application,Go.add(Cu);const Mu={loader:Wo.LoadParser,resolver:Wo.ResolveParser,cache:Wo.CacheParser,detection:Wo.DetectionParser};Go.handle(Wo.Asset,(t=>{const e=t.ref;Object.entries(Mu).filter((([t])=>!!e[t])).forEach((([t,s])=>{var n;return Go.add(Object.assign(e[t],{extension:null!=(n=e[t].extension)?n:s}))}))}),(t=>{const e=t.ref;Object.keys(Mu).filter((t=>!!e[t])).forEach((t=>Go.remove(e[t])))}));class Iu{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach((t=>{this._assetList.push(t)})),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}_next(){return f(this,null,(function*(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let s=0;s<e;s++)t.push(this._assetList.pop());yield this._loader.load(t),this._isLoading=!1,this._next()}}))}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Pu(t,e){if(Array.isArray(e)){for(const s of e)if(t.startsWith(`data:${s}`))return!0;return!1}return t.startsWith(`data:${e}`)}function Ru(t,e){const s=t.split("?")[0],n=Va.extname(s).toLowerCase();return Array.isArray(e)?e.includes(n):n===e}const ku=(t,e)=>(Array.isArray(t)||(t=[t]),e?t.map((t=>"string"==typeof t?e(t):t)):t),Du=(t,e)=>{const s=e.split("?")[1];return s&&(t+=`?${s}`),t};function Fu(t,e,s,n,i){const r=e[s];for(let a=0;a<r.length;a++){const o=r[a];s<e.length-1?Fu(t.replace(n[s],o),e,s+1,n,i):i.push(t.replace(n[s],o))}}function Ou(t){const e=t.match(/\{(.*?)\}/g),s=[];if(e){const n=[];e.forEach((t=>{const e=t.substring(1,t.length-1).split(",");n.push(e)})),Fu(t,n,0,e,s)}else s.push(t);return s}const Nu=t=>!Array.isArray(t);const Bu=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const s=ku(t);let n;for(let a=0;a<this.parsers.length;a++){const t=this.parsers[a];if(t.test(e)){n=t.getCacheableAssets(s,e);break}}n||(n={},s.forEach((t=>{n[t]=e})));const i=Object.keys(n),r={cacheKeys:i,keys:s};if(s.forEach((t=>{this._cacheMap.set(t,r)})),i.forEach((t=>{this._cache.has(t)&&this._cache.get(t)!==e&&console.warn("[Cache] already has key:",t),this._cache.set(t,n[t])})),e instanceof Il){const t=e;s.forEach((e=>{t.baseTexture!==Il.EMPTY.baseTexture&&rh.addToCache(t.baseTexture,e),Il.addToCache(t,e)}))}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t))return void console.warn(`[Assets] Asset id ${t} was not found in the Cache`);const e=this._cacheMap.get(t);e.cacheKeys.forEach((t=>{this._cache.delete(t)})),e.keys.forEach((t=>{this._cacheMap.delete(t)}))}get parsers(){return this._parsers}};class Lu{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,s)=>(this._parsersValidated=!1,t[e]=s,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const s={promise:null,parser:null};return s.promise=(()=>f(this,null,(function*(){var n,i;let r=null,a=null;if(e.loadParser&&(a=this._parserHash[e.loadParser],a||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!a){for(let s=0;s<this.parsers.length;s++){const i=this.parsers[s];if(i.load&&(null==(n=i.test)?void 0:n.call(i,t,e,this))){a=i;break}}if(!a)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}r=yield a.load(t,e,this),s.parser=a;for(let t=0;t<this.parsers.length;t++){const n=this.parsers[t];n.parse&&n.parse&&(yield null==(i=n.testParse)?void 0:i.call(n,r,e,this))&&(r=(yield n.parse(r,e,this))||r,s.parser=n)}return r})))(),s}load(t,e){return f(this,null,(function*(){this._parsersValidated||this._validateParsers();let s=0;const n={},i=Nu(t),r=ku(t,(t=>({src:t}))),a=r.length,o=r.map((t=>f(this,null,(function*(){const i=Va.toAbsolute(t.src);if(!n[t.src])try{this.promiseCache[i]||(this.promiseCache[i]=this._getLoadPromiseAndParser(i,t)),n[t.src]=yield this.promiseCache[i].promise,e&&e(++s/a)}catch(jp){throw delete this.promiseCache[i],delete n[t.src],new Error(`[Loader.load] Failed to load ${i}.\n${jp}`)}}))));return yield Promise.all(o),i?n[r[0].src]:n}))}unload(t){return f(this,null,(function*(){const e=ku(t,(t=>({src:t}))).map((t=>f(this,null,(function*(){var e,s;const n=Va.toAbsolute(t.src),i=this.promiseCache[n];if(i){const r=yield i.promise;null==(s=null==(e=i.parser)?void 0:e.unload)||s.call(e,r,t,this),delete this.promiseCache[n]}}))));yield Promise.all(e)}))}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter((t=>t.name)).reduce(((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),c(l({},t),{[e.name]:e}))),{})}}var Vu=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(Vu||{});const $u={extension:{type:Wo.LoadParser,priority:Vu.Low},name:"loadJson",test:t=>Pu(t,"application/json")||Ru(t,".json"),load(t){return f(this,null,(function*(){const e=yield _r.ADAPTER.fetch(t);return yield e.json()}))}};Go.add($u);const Uu={name:"loadTxt",extension:{type:Wo.LoadParser,priority:Vu.Low},test:t=>Pu(t,"text/plain")||Ru(t,".txt"),load(t){return f(this,null,(function*(){const e=yield _r.ADAPTER.fetch(t);return yield e.text()}))}};Go.add(Uu);const Xu=["normal","bold","100","200","300","400","500","600","700","800","900"],Yu=[".ttf",".otf",".woff",".woff2"],Wu=["font/ttf","font/otf","font/woff","font/woff2"],ju=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;const zu={extension:{type:Wo.LoadParser,priority:Vu.Low},name:"loadWebFont",test:t=>Pu(t,Wu)||Ru(t,Yu),load(t,e){return f(this,null,(function*(){var s,n,i,r,a,o;const h=_r.ADAPTER.getFontFaceSet();if(h){const u=[],d=null!=(n=null==(s=e.data)?void 0:s.family)?n:function(t){const e=Va.extname(t),s=Va.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map((t=>t.charAt(0).toUpperCase()+t.slice(1)));let n=s.length>0;for(const r of s)if(!r.match(ju)){n=!1;break}let i=s.join(" ");return n||(i=`"${i.replace(/[\\"]/g,"\\$&")}"`),i}(t),f=null!=(a=null==(r=null==(i=e.data)?void 0:i.weights)?void 0:r.filter((t=>Xu.includes(t))))?a:["normal"],p=null!=(o=e.data)?o:{};for(let e=0;e<f.length;e++){const s=f[e],n=new FontFace(d,`url(${encodeURI(t)})`,c(l({},p),{weight:s}));yield n.load(),h.add(n),u.push(n)}return 1===u.length?u[0]:u}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null}))},unload(t){(Array.isArray(t)?t:[t]).forEach((t=>_r.ADAPTER.getFontFaceSet().delete(t)))}};Go.add(zu);let Gu,Hu=0;const qu={id:"checkImageBitmap",code:"\n    async function checkImageBitmap()\n    {\n        try\n        {\n            if (typeof createImageBitmap !== 'function') return false;\n\n            const response = await fetch('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=');\n            const imageBlob =  await response.blob();\n            const imageBitmap = await createImageBitmap(imageBlob);\n\n            return imageBitmap.width === 1 && imageBitmap.height === 1;\n        }\n        catch (e)\n        {\n            return false;\n        }\n    }\n    checkImageBitmap().then((result) => { self.postMessage(result); });\n    "},Ku={id:"loadImageBitmap",code:"\n    async function loadImageBitmap(url)\n    {\n        const response = await fetch(url);\n\n        if (!response.ok)\n        {\n            throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: `\n                + `${response.status} ${response.statusText}`);\n        }\n\n        const imageBlob =  await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n\n        return imageBitmap;\n    }\n    self.onmessage = async (event) =>\n    {\n        try\n        {\n            const imageBitmap = await loadImageBitmap(event.data.data[0]);\n\n            self.postMessage({\n                data: imageBitmap,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            }, [imageBitmap]);\n        }\n        catch(e)\n        {\n            self.postMessage({\n                error: e,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            });\n        }\n    };"};let Zu;const Qu=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((t=>{const e=URL.createObjectURL(new Blob([qu.code],{type:"application/javascript"})),s=new Worker(e);s.addEventListener("message",(n=>{s.terminate(),URL.revokeObjectURL(e),t(n.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}_initWorkers(){return f(this,null,(function*(){this._initialized||(this._initialized=!0)}))}getWorker(){void 0===Gu&&(Gu=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Gu&&(Zu||(Zu=URL.createObjectURL(new Blob([Ku.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Zu),t.addEventListener("message",(t=>{this.complete(t.data),this.returnWorker(t.target),this.next()}))),t}returnWorker(t){this.workerPool.push(t)}complete(t){void 0!==t.error?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}_run(t,e){return f(this,null,(function*(){yield this._initWorkers();const s=new Promise(((s,n)=>{this.queue.push({id:t,arguments:e,resolve:s,reject:n})}));return this.next(),s}))}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),s=e.id;this.resolveHash[Hu]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Hu++,id:s})}};function Ju(t,e,s){const n=new Il(t);return n.baseTexture.on("dispose",(()=>{delete e.promiseCache[s]})),n}const td=[".jpeg",".jpg",".png",".webp",".avif"],ed=["image/jpeg","image/png","image/webp","image/avif"];const sd={name:"loadTextures",extension:{type:Wo.LoadParser,priority:Vu.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:t=>Pu(t,ed)||Ru(t,td),load(t,e,s){return f(this,null,(function*(){let n=null;n=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&(yield Qu.isImageBitmapSupported())?yield Qu.loadImageBitmap(t):yield function(t){return f(this,null,(function*(){const e=yield _r.ADAPTER.fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);const s=yield e.blob();return yield createImageBitmap(s)}))}(t):yield new Promise((e=>{n=new Image,n.crossOrigin=this.config.crossOrigin,n.src=t,n.complete?e(n):n.onload=()=>{e(n)}}));const i=new rh(n,l({resolution:Yo(t)},e.data));return i.resource.src=t,Ju(i,s,t)}))},unload(t){t.destroy(!0)}};Go.add(sd);const nd={extension:{type:Wo.LoadParser,priority:Vu.High},name:"loadSVG",test:t=>Pu(t,"image/svg+xml")||Ru(t,".svg"),testParse(t){return f(this,null,(function*(){return Wc.test(t)}))},parse(t,e,s){return f(this,null,(function*(){var n;const i=new Wc(t,null==(n=null==e?void 0:e.data)?void 0:n.resourceOptions);yield i.load();const r=new rh(i,l({resolution:Yo(t)},null==e?void 0:e.data));r.resource.src=t;return Ju(r,s,t)}))},load(t,e){return f(this,null,(function*(){return(yield _r.ADAPTER.fetch(t)).text()}))},unload:sd.unload};Go.add(nd);class id{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){var e,s,n;if(this._bundleIdConnector=null!=(e=t.connector)?e:this._bundleIdConnector,this._createBundleAssetId=null!=(s=t.createBundleAssetId)?s:this._createBundleAssetId,this._extractAssetIdFromBundle=null!=(n=t.extractAssetIdFromBundle)?n:this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach((t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))})),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if("string"==typeof t)this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach((t=>{this.addBundle(t.name,t.assets)}))}addBundle(t,e){const s=[];Array.isArray(e)?e.forEach((e=>{if("string"==typeof e.name){const n=this._createBundleAssetId(t,e.name);s.push(n),this.add([e.name,n],e.srcs,e.data)}else{const n=e.name.map((e=>this._createBundleAssetId(t,e)));n.forEach((t=>{s.push(t)})),this.add([...e.name,...n],e.srcs)}})):Object.keys(e).forEach((n=>{s.push(this._createBundleAssetId(t,n)),this.add([n,this._createBundleAssetId(t,n)],e[n])})),this._bundles[t]=s}add(t,e,s){const n=ku(t);n.forEach((t=>{this.hasKey(t)&&console.warn(`[Resolver] already has key: ${t} overwriting`)})),Array.isArray(e)||(e="string"==typeof e?Ou(e):[e]);const i=e.map((t=>{var e;let i=t;if("string"==typeof t){let e=!1;for(let s=0;s<this._parsers.length;s++){const n=this._parsers[s];if(n.test(t)){i=n.parse(t),e=!0;break}}e||(i={src:t})}return i.format||(i.format=i.src.split(".").pop()),i.alias||(i.alias=n),(this._basePath||this._rootPath)&&(i.src=Va.toAbsolute(i.src,this._basePath,this._rootPath)),i.src=this._appendDefaultSearchParams(i.src),i.data=null!=(e=i.data)?e:s,i}));n.forEach((t=>{this._assetMap[t]=i}))}resolveBundle(t){const e=Nu(t);t=ku(t);const s={};return t.forEach((t=>{const e=this._bundles[t];if(e){const n=this.resolve(e),i={};for(const e in n){const s=n[e];i[this._extractAssetIdFromBundle(t,e)]=s}s[t]=i}})),e?s[t[0]]:s}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const t={};for(const s in e)t[s]=e[s].src;return t}return e.src}resolve(t){const e=Nu(t);t=ku(t);const s={};return t.forEach((t=>{var e;if(!this._resolverHash[t])if(this._assetMap[t]){let s=this._assetMap[t];const n=this._getPreferredOrder(s),i=s[0];null==n||n.priority.forEach((t=>{n.params[t].forEach((e=>{const n=s.filter((s=>!!s[t]&&s[t]===e));n.length&&(s=n)}))})),this._resolverHash[t]=null!=(e=s[0])?e:i}else{let e=t;(this._basePath||this._rootPath)&&(e=Va.toAbsolute(e,this._basePath,this._rootPath)),e=this._appendDefaultSearchParams(e),this._resolverHash[t]={src:e}}s[t]=this._resolverHash[t]})),e?s[t[0]]:s}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const e=t[0],s=this._preferredOrder.find((t=>t.params.format.includes(e.format)));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;return`${t}${/\?/.test(t)?"&":"?"}${this._defaultSearchParams}`}}class rd{constructor(){this._detections=[],this._initialized=!1,this.resolver=new id,this.loader=new Lu,this.cache=Bu,this._backgroundLoader=new Iu(this.loader),this._backgroundLoader.active=!0,this.reset()}init(){return f(this,arguments,(function*(t={}){var e,s,n,i;if(this._initialized)return void console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let e=t.manifest;"string"==typeof e&&(e=yield this.load(e)),this.resolver.addManifest(e)}const r=null!=(s=null==(e=t.texturePreference)?void 0:e.resolution)?s:1,a="number"==typeof r?[r]:r;let o=[];if(null==(n=t.texturePreference)?void 0:n.format){const e=null==(i=t.texturePreference)?void 0:i.format;o="string"==typeof e?[e]:e;for(const t of this._detections)(yield t.test())||(o=yield t.remove(o))}else for(const h of this._detections)(yield h.test())&&(o=yield h.add(o));this.resolver.prefer({params:{format:o,resolution:a}}),t.preferences&&this.setPreferences(t.preferences)}))}add(t,e,s){this.resolver.add(t,e,s)}load(t,e){return f(this,null,(function*(){this._initialized||(yield this.init());const s=Nu(t),n=ku(t).map((t=>"string"!=typeof t?(this.resolver.add(t.src,t),t.src):(this.resolver.hasKey(t)||this.resolver.add(t,t),t))),i=this.resolver.resolve(n),r=yield this._mapLoadToResolve(i,e);return s?r[n[0]]:r}))}addBundle(t,e){this.resolver.addBundle(t,e)}loadBundle(t,e){return f(this,null,(function*(){this._initialized||(yield this.init());let s=!1;"string"==typeof t&&(s=!0,t=[t]);const n=this.resolver.resolveBundle(t),i={},r=Object.keys(n);let a=0,o=0;const h=()=>{null==e||e(++a/o)},l=r.map((t=>{const e=n[t];return o+=Object.keys(e).length,this._mapLoadToResolve(e,h).then((e=>{i[t]=e}))}));return yield Promise.all(l),s?i[t[0]]:i}))}backgroundLoad(t){return f(this,null,(function*(){this._initialized||(yield this.init()),"string"==typeof t&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}))}backgroundLoadBundle(t){return f(this,null,(function*(){this._initialized||(yield this.init()),"string"==typeof t&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach((t=>{this._backgroundLoader.add(Object.values(t))}))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return Bu.get(t);const e={};for(let s=0;s<t.length;s++)e[s]=Bu.get(t[s]);return e}_mapLoadToResolve(t,e){return f(this,null,(function*(){const s=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const i=yield this.loader.load(s,e);this._backgroundLoader.active=!0;const r={};return s.forEach(((t,e)=>{const s=i[t.src],a=[t.src];t.alias&&a.push(...t.alias),r[n[e]]=s,Bu.set(a,s)})),r}))}unload(t){return f(this,null,(function*(){this._initialized||(yield this.init());const e=ku(t).map((t=>"string"!=typeof t?t.src:t)),s=this.resolver.resolve(e);yield this._unloadFromResolved(s)}))}unloadBundle(t){return f(this,null,(function*(){this._initialized||(yield this.init()),t=ku(t);const e=this.resolver.resolveBundle(t),s=Object.keys(e).map((t=>this._unloadFromResolved(e[t])));yield Promise.all(s)}))}_unloadFromResolved(t){return f(this,null,(function*(){const e=Object.values(t);e.forEach((t=>{Bu.remove(t.src)})),yield this.loader.unload(e)}))}get detections(){return this._detections}get preferWorkers(){return sd.config.preferWorkers}set preferWorkers(t){Ua("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach((e=>{e.config&&Object.keys(e.config).filter((e=>e in t)).forEach((s=>{e.config[s]=t[s]}))}))}}const ad=new rd;Go.handleByList(Wo.LoadParser,ad.loader.parsers).handleByList(Wo.ResolveParser,ad.resolver.parsers).handleByList(Wo.CacheParser,ad.cache.parsers).handleByList(Wo.DetectionParser,ad.detections);const od={extension:Wo.CacheParser,test:t=>Array.isArray(t)&&t.every((t=>t instanceof Il)),getCacheableAssets:(t,e)=>{const s={};return t.forEach((t=>{e.forEach(((e,n)=>{s[t+(0===n?"":n+1)]=e}))})),s}};Go.add(od);const hd={extension:{type:Wo.DetectionParser,priority:1},test:()=>f(void 0,null,(function*(){if(!globalThis.createImageBitmap)return!1;const t=yield _r.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))})),add:t=>f(void 0,null,(function*(){return[...t,"avif"]})),remove:t=>f(void 0,null,(function*(){return t.filter((t=>"avif"!==t))}))};Go.add(hd);const ld={extension:{type:Wo.DetectionParser,priority:0},test:()=>f(void 0,null,(function*(){if(!globalThis.createImageBitmap)return!1;const t=yield _r.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))})),add:t=>f(void 0,null,(function*(){return[...t,"webp"]})),remove:t=>f(void 0,null,(function*(){return t.filter((t=>"webp"!==t))}))};Go.add(ld);const cd=["png","jpg","jpeg"],ud={extension:{type:Wo.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:t=>f(void 0,null,(function*(){return[...t,...cd]})),remove:t=>f(void 0,null,(function*(){return t.filter((t=>!cd.includes(t)))}))};Go.add(ud);const dd={extension:Wo.ResolveParser,test:sd.test,parse:t=>{var e,s;return{resolution:parseFloat(null!=(s=null==(e=_r.RETINA_PREFIX.exec(t))?void 0:e[1])?s:"1"),format:t.split(".").pop(),src:t}}};Go.add(dd);var fd=(t=>(t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t))(fd||{});const pd={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let md,gd;function yd(){gd={s3tc:md.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:md.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:md.getExtension("WEBGL_compressed_texture_etc"),etc1:md.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:md.getExtension("WEBGL_compressed_texture_pvrtc")||md.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:md.getExtension("WEBGL_compressed_texture_atc"),astc:md.getExtension("WEBGL_compressed_texture_astc")}}const vd={extension:{type:Wo.DetectionParser,priority:2},test:()=>f(void 0,null,(function*(){const t=_r.ADAPTER.createCanvas().getContext("webgl");return t?(md=t,!0):(console.warn("WebGL not available for compressed textures."),!1)})),add:t=>f(void 0,null,(function*(){gd||yd();const e=[];for(const t in gd){gd[t]&&e.push(t)}return[...e,...t]})),remove:t=>f(void 0,null,(function*(){return gd||yd(),t.filter((t=>!(t in gd)))}))};Go.add(vd);class xd extends sh{constructor(t,e={width:1,height:1,autoLoad:!0}){let s,n;"string"==typeof t?(s=t,n=new Uint8Array):(s=null,n=t),super(n,e),this.origin=s,this.buffer=n?new Ho(n):null,this._load=null,this.loaded=!1,null!==this.origin&&!1!==e.autoLoad&&this.load(),null===this.origin&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load||(this._load=fetch(this.origin).then((t=>t.blob())).then((t=>t.arrayBuffer())).then((t=>(this.data=new Uint32Array(t),this.buffer=new Ho(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)))),this._load}}class _d extends xd{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=_d._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||_d._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,s){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let i=0,r=this.levels;i<r;i++){const{levelID:t,levelWidth:e,levelHeight:s,levelBuffer:r}=this._levelBuffers[i];n.compressedTexImage2D(n.TEXTURE_2D,t,this.format,e,s,0,r)}return!0}onBlobLoaded(){this._levelBuffers=_d._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,s,n,i,r,a){const o=new Array(s);let h=t.byteOffset,l=r,c=a,u=l+n-1&~(n-1),d=c+i-1&~(i-1),f=u*d*pd[e];for(let p=0;p<s;p++)o[p]={levelID:p,levelWidth:s>1?l:u,levelHeight:s>1?c:d,levelBuffer:new Uint8Array(t.buffer,h,f)},h+=f,l=l>>1||1,c=c>>1||1,u=l+n-1&~(n-1),d=c+i-1&~(i-1),f=u*d*pd[e];return o}}const bd=4,wd=124,Ed=32,Sd=20,Td=542327876,Ad={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},Cd={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},Md={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},Id=1,Pd=2,Rd=4,kd=64,Dd=512,Fd=131072,Od=808540228,Nd=4,Bd={827611204:fd.COMPRESSED_RGBA_S3TC_DXT1_EXT,861165636:fd.COMPRESSED_RGBA_S3TC_DXT3_EXT,894720068:fd.COMPRESSED_RGBA_S3TC_DXT5_EXT},Ld={70:fd.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:fd.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:fd.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:fd.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:fd.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:fd.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:fd.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:fd.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:fd.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};const Vd=[171,75,84,88,32,49,49,187,13,10,26,10],$d=67305985,Ud={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Xd=64,Yd={[hr.UNSIGNED_BYTE]:1,[hr.UNSIGNED_SHORT]:2,[hr.INT]:4,[hr.UNSIGNED_INT]:4,[hr.FLOAT]:4,[hr.HALF_FLOAT]:8},Wd={[ar.RGBA]:4,[ar.RGB]:3,[ar.RG]:2,[ar.RED]:1,[ar.LUMINANCE]:1,[ar.LUMINANCE_ALPHA]:2,[ar.ALPHA]:1},jd={[hr.UNSIGNED_SHORT_4_4_4_4]:2,[hr.UNSIGNED_SHORT_5_5_5_1]:2,[hr.UNSIGNED_SHORT_5_6_5]:2};function zd(t,e,s=!1){const n=new DataView(e);if(!function(t,e){for(let s=0;s<Vd.length;s++)if(e.getUint8(s)!==Vd[s])return console.error(`${t} is not a valid *.ktx file!`),!1;return!0}(t,n))return null;const i=n.getUint32(Ud.ENDIANNESS,!0)===$d,r=n.getUint32(Ud.GL_TYPE,i),a=n.getUint32(Ud.GL_FORMAT,i),o=n.getUint32(Ud.GL_INTERNAL_FORMAT,i),h=n.getUint32(Ud.PIXEL_WIDTH,i),l=n.getUint32(Ud.PIXEL_HEIGHT,i)||1,c=n.getUint32(Ud.PIXEL_DEPTH,i)||1,u=n.getUint32(Ud.NUMBER_OF_ARRAY_ELEMENTS,i)||1,d=n.getUint32(Ud.NUMBER_OF_FACES,i),f=n.getUint32(Ud.NUMBER_OF_MIPMAP_LEVELS,i),p=n.getUint32(Ud.BYTES_OF_KEY_VALUE_DATA,i);if(0===l||1!==c)throw new Error("Only 2D textures are supported");if(1!==d)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==u)throw new Error("WebGL does not support array textures");const m=h+3&-4,g=l+3&-4,y=new Array(u);let v,x=h*l;if(0===r&&(x=m*g),v=0!==r?Yd[r]?Yd[r]*Wd[a]:jd[r]:pd[o],void 0===v)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const _=s?function(t,e,s){const n=new Map;let i=0;for(;i<e;){const r=t.getUint32(Xd+i,s),a=Xd+i+4,o=3-(r+3)%4;if(0===r||r>e-i){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<r&&0!==t.getUint8(a+h);h++);if(-1===h){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=(new TextDecoder).decode(new Uint8Array(t.buffer,a,h)),c=new DataView(t.buffer,a+h+1,r-h-1);n.set(l,c),i+=4+r+o}return n}(n,p,i):null;let b=x*v,w=h,E=l,S=m,T=g,A=Xd+p;for(let C=0;C<f;C++){const t=n.getUint32(A,i);let s=A+4;for(let n=0;n<u;n++){let t=y[n];t||(t=y[n]=new Array(f)),t[C]={levelID:C,levelWidth:f>1||0!==r?w:S,levelHeight:f>1||0!==r?E:T,levelBuffer:new Uint8Array(e,s,b)},s+=b}A+=t+4,A=A%4!=0?A+4-A%4:A,w=w>>1||1,E=E>>1||1,S=w+4-1&-4,T=E+4-1&-4,b=S*T*v}return 0!==r?{uncompressed:y.map((t=>{let e=t[0].levelBuffer,s=!1;return r===hr.FLOAT?e=new Float32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4):r===hr.UNSIGNED_INT?(s=!0,e=new Uint32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)):r===hr.INT&&(s=!0,e=new Int32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)),{resource:new sh(e,{width:t[0].levelWidth,height:t[0].levelHeight}),type:r,format:s?Gd(a):a}})),kvData:_}:{compressed:y.map((t=>new _d(null,{format:o,width:h,height:l,levels:f,levelBuffers:t}))),kvData:_}}function Gd(t){switch(t){case ar.RGBA:return ar.RGBA_INTEGER;case ar.RGB:return ar.RGB_INTEGER;case ar.RG:return ar.RG_INTEGER;case ar.RED:return ar.RED_INTEGER;default:return t}}const Hd={extension:{type:Wo.LoadParser,priority:Vu.High},name:"loadDDS",test:t=>Ru(t,".dds"),load(t,e,s){return f(this,null,(function*(){const n=yield _r.ADAPTER.fetch(t),i=function(t){const e=new Uint32Array(t);if(e[0]!==Td)throw new Error("Invalid DDS file magic word");const s=new Uint32Array(t,0,wd/Uint32Array.BYTES_PER_ELEMENT),n=s[Ad.HEIGHT],i=s[Ad.WIDTH],r=s[Ad.MIPMAP_COUNT],a=new Uint32Array(t,Ad.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,Ed/Uint32Array.BYTES_PER_ELEMENT),o=a[Id];if(o&Rd){const s=a[Cd.FOURCC];if(s!==Od){const e=Bd[s],a=new Uint8Array(t,bd+wd);return[new _d(a,{format:e,width:i,height:n,levels:r})]}const o=bd+wd,h=new Uint32Array(e.buffer,o,Sd/Uint32Array.BYTES_PER_ELEMENT),l=h[Md.DXGI_FORMAT],c=h[Md.RESOURCE_DIMENSION],u=h[Md.MISC_FLAG],d=h[Md.ARRAY_SIZE],f=Ld[l];if(void 0===f)throw new Error(`DDSParser cannot parse texture data with DXGI format ${l}`);if(u===Nd)throw new Error("DDSParser does not support cubemap textures");if(6===c)throw new Error("DDSParser does not supported 3D texture data");const p=new Array,m=bd+wd+Sd;if(1===d)p.push(new Uint8Array(t,m));else{const e=pd[f];let s=0,a=i,o=n;for(let t=0;t<r;t++)s+=Math.max(1,a+3&-4)*Math.max(1,o+3&-4)*e,a>>>=1,o>>>=1;let h=m;for(let n=0;n<d;n++)p.push(new Uint8Array(t,h,s)),h+=s}return p.map((t=>new _d(t,{format:f,width:i,height:n,levels:r})))}if(o&kd)throw new Error("DDSParser does not support uncompressed texture data.");if(o&Dd)throw new Error("DDSParser does not supported YUV uncompressed texture data.");if(o&Fd)throw new Error("DDSParser does not support single-channel (lumninance) texture data!");if(o&Pd)throw new Error("DDSParser does not support single-channel (alpha) texture data!");throw new Error("DDSParser failed to load a texture file due to an unknown reason!")}(yield n.arrayBuffer()),r=i.map((n=>Ju(new rh(n,l({mipmap:dr.OFF,alphaMode:fr.NO_PREMULTIPLIED_ALPHA,resolution:Yo(t)},e.data)),s,t)));return 1===r.length?r[0]:r}))},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};Go.add(Hd);const qd={extension:{type:Wo.LoadParser,priority:Vu.High},name:"loadKTX",test:t=>Ru(t,".ktx"),load(t,e,s){return f(this,null,(function*(){const n=yield _r.ADAPTER.fetch(t),i=yield n.arrayBuffer(),{compressed:r,uncompressed:a,kvData:o}=zd(t,i),h=null!=r?r:a,c=l({mipmap:dr.OFF,alphaMode:fr.NO_PREMULTIPLIED_ALPHA,resolution:Yo(t)},e.data),u=h.map((e=>{h===a&&Object.assign(c,{type:e.type,format:e.format});const n=new rh(e,c);return n.ktxKeyValueData=o,Ju(n,s,t)}));return 1===u.length?u[0]:u}))},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};Go.add(qd);const Kd={extension:Wo.ResolveParser,test:t=>{const e=t.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(e)},parse:t=>{var e,s,n,i;if("ktx"===t.split("?")[0].split(".").pop()){const n=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(n.some((e=>t.endsWith(e))))return{resolution:parseFloat(null!=(s=null==(e=_r.RETINA_PREFIX.exec(t))?void 0:e[1])?s:"1"),format:n.find((e=>t.endsWith(e))),src:t}}return{resolution:parseFloat(null!=(i=null==(n=_r.RETINA_PREFIX.exec(t))?void 0:n[1])?i:"1"),format:t.split(".").pop(),src:t}}};Go.add(Kd);const Zd=new wh,Qd=class{constructor(t){this.renderer=t}image(t,e,s){return f(this,null,(function*(){const n=new Image;return n.src=yield this.base64(t,e,s),n}))}base64(t,e,s){return f(this,null,(function*(){const n=this.canvas(t);if(void 0!==n.toBlob)return new Promise(((t,i)=>{n.toBlob((e=>{if(!e)return void i(new Error("ICanvas.toBlob failed!"));const s=new FileReader;s.onload=()=>t(s.result),s.onerror=i,s.readAsDataURL(e)}),e,s)}));if(void 0!==n.toDataURL)return n.toDataURL(e,s);if(void 0!==n.convertToBlob){const t=yield n.convertToBlob({type:e,quality:s});return new Promise(((e,s)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=s,n.readAsDataURL(t)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}))}canvas(t,e){const{pixels:s,width:n,height:i,flipY:r}=this._rawPixels(t,e);r&&Qd._flipY(s,n,i),Qd._unpremultiplyAlpha(s);const a=new Lo(n,i,1),o=new ImageData(new Uint8ClampedArray(s.buffer),n,i);return a.context.putImageData(o,0,0),a.canvas}pixels(t,e){const{pixels:s,width:n,height:i,flipY:r}=this._rawPixels(t,e);return r&&Qd._flipY(s,n,i),Qd._unpremultiplyAlpha(s),s}_rawPixels(t,e){const s=this.renderer;if(!s)throw new Error("The Extract has already been destroyed");let n,i,r=!1,a=!1;if(t&&(t instanceof Pl?i=t:(i=s.generateTexture(t,{resolution:s.resolution,multisample:s.multisample}),a=!0)),i){if(n=i.baseTexture.resolution,e=null!=e?e:i.frame,r=!1,!a){s.renderTexture.bind(i);const t=i.framebuffer.glFramebuffers[s.CONTEXT_UID];t.blitFramebuffer&&s.framebuffer.bind(t.blitFramebuffer)}}else n=s.resolution,e||((e=Zd).width=s.width/n,e.height=s.height/n),r=!0,s.renderTexture.bind();const o=Math.round(e.width*n),h=Math.round(e.height*n),l=new Uint8Array(4*o*h),c=s.gl;return c.readPixels(Math.round(e.x*n),Math.round(e.y*n),o,h,c.RGBA,c.UNSIGNED_BYTE,l),a&&(null==i||i.destroy(!0)),{pixels:l,width:o,height:h,flipY:r}}destroy(){this.renderer=null}static _flipY(t,e,s){const n=e<<2,i=s>>1,r=new Uint8Array(n);for(let a=0;a<i;a++){const e=a*n,i=(s-a-1)*n;r.set(t.subarray(e,e+n)),t.copyWithin(e,i,i+n),t.set(r,i)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let s=0;s<e;s+=4){const e=t[s+3];if(0!==e){const n=255.001/e;t[s]=t[s]*n+.5,t[s+1]=t[s+1]*n+.5,t[s+2]=t[s+2]*n+.5}}}};let Jd=Qd;Jd.extension={name:"extract",type:Wo.RendererSystem},Go.add(Jd);const tf={build(t){const e=t.points;let s,n,i,r,a,o;if(t.type===xh.CIRC){const e=t.shape;s=e.x,n=e.y,a=o=e.radius,i=r=0}else if(t.type===xh.ELIP){const e=t.shape;s=e.x,n=e.y,a=e.width,o=e.height,i=r=0}else{const e=t.shape,h=e.width/2,l=e.height/2;s=e.x+h,n=e.y+l,a=o=Math.max(0,Math.min(e.radius,Math.min(h,l))),i=h-a,r=l-o}if(!(a>=0&&o>=0&&i>=0&&r>=0))return void(e.length=0);const h=Math.ceil(2.3*Math.sqrt(a+o)),l=8*h+(i?4:0)+(r?4:0);if(e.length=l,0===l)return;if(0===h)return e.length=8,e[0]=e[6]=s+i,e[1]=e[3]=n+r,e[2]=e[4]=s-i,void(e[5]=e[7]=n-r);let c=0,u=4*h+(i?2:0)+2,d=u,f=l;{const t=i+a,o=r,h=s+t,l=s-t,p=n+o;if(e[c++]=h,e[c++]=p,e[--u]=p,e[--u]=l,r){const t=n-o;e[d++]=l,e[d++]=t,e[--f]=t,e[--f]=h}}for(let p=1;p<h;p++){const t=Math.PI/2*(p/h),l=i+Math.cos(t)*a,m=r+Math.sin(t)*o,g=s+l,y=s-l,v=n+m,x=n-m;e[c++]=g,e[c++]=v,e[--u]=v,e[--u]=y,e[d++]=y,e[d++]=x,e[--f]=x,e[--f]=g}{const t=r+o,a=s+i,h=s-i,l=n+t,u=n-t;e[c++]=a,e[c++]=l,e[--f]=u,e[--f]=a,i&&(e[c++]=h,e[c++]=l,e[--f]=u,e[--f]=h)}},triangulate(t,e){const s=t.points,n=e.points,i=e.indices;if(0===s.length)return;let r=n.length/2;const a=r;let o,h;if(t.type!==xh.RREC){const e=t.shape;o=e.x,h=e.y}else{const e=t.shape;o=e.x+e.width/2,h=e.y+e.height/2}const l=t.matrix;n.push(t.matrix?l.a*o+l.c*h+l.tx:o,t.matrix?l.b*o+l.d*h+l.ty:h),r++,n.push(s[0],s[1]);for(let c=2;c<s.length;c+=2)n.push(s[c],s[c+1]),i.push(r++,a,r);i.push(a+1,a,r)}};function ef(t,e=!1){const s=t.length;if(s<6)return;let n=0;for(let i=0,r=t[s-2],a=t[s-1];i<s;i+=2){const e=t[i],s=t[i+1];n+=(e-r)*(s+a),r=e,a=s}if(!e&&n>0||e&&n<=0){const e=s/2;for(let n=e+e%2;n<s;n+=2){const e=s-n-2,i=s-n-1,r=n,a=n+1;[t[e],t[r]]=[t[r],t[e]],[t[i],t[a]]=[t[a],t[i]]}}}const sf={build(t){t.points=t.shape.points.slice()},triangulate(t,e){let s=t.points;const n=t.holes,i=e.points,r=e.indices;if(s.length>=6){ef(s,!1);const t=[];for(let i=0;i<n.length;i++){const e=n[i];ef(e.points,!0),t.push(s.length/2),s=s.concat(e.points)}const e=Vr(s,t,2);if(!e)return;const a=i.length/2;for(let s=0;s<e.length;s+=3)r.push(e[s]+a),r.push(e[s+1]+a),r.push(e[s+2]+a);for(let n=0;n<s.length;n++)i.push(s[n])}}},nf={build(t){const e=t.shape,s=e.x,n=e.y,i=e.width,r=e.height,a=t.points;a.length=0,i>=0&&r>=0&&a.push(s,n,s+i,n,s+i,n+r,s,n+r)},triangulate(t,e){const s=t.points,n=e.points;if(0===s.length)return;const i=n.length/2;n.push(s[0],s[1],s[2],s[3],s[6],s[7],s[4],s[5]),e.indices.push(i,i+1,i+2,i+1,i+2,i+3)}},rf={build(t){tf.build(t)},triangulate(t,e){tf.triangulate(t,e)}};var af=(t=>(t.MITER="miter",t.BEVEL="bevel",t.ROUND="round",t))(af||{}),of=(t=>(t.BUTT="butt",t.ROUND="round",t.SQUARE="square",t))(of||{});const hf={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(t,e=20){if(!this.adaptive||!t||isNaN(t))return e;let s=Math.ceil(t/this.maxLength);return s<this.minSegments?s=this.minSegments:s>this.maxSegments&&(s=this.maxSegments),s}};class lf{static curveTo(t,e,s,n,i,r){const a=r[r.length-2],o=r[r.length-1]-e,h=a-t,l=n-e,c=s-t,u=Math.abs(o*c-h*l);if(u<1e-8||0===i)return r[r.length-2]===t&&r[r.length-1]===e||r.push(t,e),null;const d=o*o+h*h,f=l*l+c*c,p=o*l+h*c,m=i*Math.sqrt(d)/u,g=i*Math.sqrt(f)/u,y=m*p/d,v=g*p/f,x=m*c+g*h,_=m*l+g*o,b=h*(g+y),w=o*(g+y),E=c*(m+v),S=l*(m+v);return{cx:x+t,cy:_+e,radius:i,startAngle:Math.atan2(w-_,b-x),endAngle:Math.atan2(S-_,E-x),anticlockwise:h*l>c*o}}static arc(t,e,s,n,i,r,a,o,h){const l=a-r,c=hf._segmentsCount(Math.abs(l)*i,40*Math.ceil(Math.abs(l)/gh)),u=l/(2*c),d=2*u,f=Math.cos(u),p=Math.sin(u),m=c-1,g=m%1/m;for(let y=0;y<=m;++y){const t=u+r+d*(y+g*y),e=Math.cos(t),a=-Math.sin(t);h.push((f*e+p*a)*i+s,(f*-a+p*e)*i+n)}}}class cf{constructor(){this.reset()}begin(t,e,s){this.reset(),this.style=t,this.start=e,this.attribStart=s}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class uf{static curveLength(t,e,s,n,i,r,a,o){let h=0,l=0,c=0,u=0,d=0,f=0,p=0,m=0,g=0,y=0,v=0,x=t,_=e;for(let b=1;b<=10;++b)l=b/10,c=l*l,u=c*l,d=1-l,f=d*d,p=f*d,m=p*t+3*f*l*s+3*d*c*i+u*a,g=p*e+3*f*l*n+3*d*c*r+u*o,y=x-m,v=_-g,x=m,_=g,h+=Math.sqrt(y*y+v*v);return h}static curveTo(t,e,s,n,i,r,a){const o=a[a.length-2],h=a[a.length-1];a.length-=2;const l=hf._segmentsCount(uf.curveLength(o,h,t,e,s,n,i,r));let c=0,u=0,d=0,f=0,p=0;a.push(o,h);for(let m=1,g=0;m<=l;++m)g=m/l,c=1-g,u=c*c,d=u*c,f=g*g,p=f*g,a.push(d*o+3*u*g*t+3*c*f*s+p*i,d*h+3*u*g*e+3*c*f*n+p*r)}}function df(t,e,s,n,i,r,a,o){let h,l;a?(h=n,l=-s):(h=-n,l=s);const c=t-s*i+h,u=e-n*i+l,d=t+s*r+h,f=e+n*r+l;return o.push(c,u,d,f),2}function ff(t,e,s,n,i,r,a,o){const h=s-t,l=n-e;let c=Math.atan2(h,l),u=Math.atan2(i-t,r-e);o&&c<u?c+=2*Math.PI:!o&&c>u&&(u+=2*Math.PI);let d=c;const f=u-c,p=Math.abs(f),m=Math.sqrt(h*h+l*l),g=1+(15*p*Math.sqrt(m)/Math.PI>>0),y=f/g;if(d+=y,o){a.push(t,e,s,n);for(let s=1,n=d;s<g;s++,n+=y)a.push(t,e,t+Math.sin(n)*m,e+Math.cos(n)*m);a.push(t,e,i,r)}else{a.push(s,n,t,e);for(let s=1,n=d;s<g;s++,n+=y)a.push(t+Math.sin(n)*m,e+Math.cos(n)*m,t,e);a.push(i,r,t,e)}return 2*g}function pf(t,e){t.lineStyle.native?function(t,e){let s=0;const n=t.shape,i=t.points||n.points,r=n.type!==xh.POLY||n.closeStroke;if(0===i.length)return;const a=e.points,o=e.indices,h=i.length/2,l=a.length/2;let c=l;for(a.push(i[0],i[1]),s=1;s<h;s++)a.push(i[2*s],i[2*s+1]),o.push(c,c+1),c++;r&&o.push(c,l)}(t,e):function(t,e){const s=t.shape;let n=t.points||s.points.slice();const i=e.closePointEps;if(0===n.length)return;const r=t.lineStyle,a=new _h(n[0],n[1]),o=new _h(n[n.length-2],n[n.length-1]),h=s.type!==xh.POLY||s.closeStroke,l=Math.abs(a.x-o.x)<i&&Math.abs(a.y-o.y)<i;if(h){n=n.slice(),l&&(n.pop(),n.pop(),o.set(n[n.length-2],n[n.length-1]));const t=.5*(a.x+o.x),e=.5*(o.y+a.y);n.unshift(t,e),n.push(t,e)}const c=e.points,u=n.length/2;let d=n.length;const f=c.length/2,p=r.width/2,m=p*p,g=r.miterLimit*r.miterLimit;let y=n[0],v=n[1],x=n[2],_=n[3],b=0,w=0,E=-(v-_),S=y-x,T=0,A=0,C=Math.sqrt(E*E+S*S);E/=C,S/=C,E*=p,S*=p;const M=r.alignment,I=2*(1-M),P=2*M;h||(r.cap===of.ROUND?d+=ff(y-E*(I-P)*.5,v-S*(I-P)*.5,y-E*I,v-S*I,y+E*P,v+S*P,c,!0)+2:r.cap===of.SQUARE&&(d+=df(y,v,E,S,I,P,!0,c))),c.push(y-E*I,v-S*I,y+E*P,v+S*P);for(let D=1;D<u-1;++D){y=n[2*(D-1)],v=n[2*(D-1)+1],x=n[2*D],_=n[2*D+1],b=n[2*(D+1)],w=n[2*(D+1)+1],E=-(v-_),S=y-x,C=Math.sqrt(E*E+S*S),E/=C,S/=C,E*=p,S*=p,T=-(_-w),A=x-b,C=Math.sqrt(T*T+A*A),T/=C,A/=C,T*=p,A*=p;const t=x-y,e=v-_,s=x-b,i=w-_,a=t*s+e*i,o=e*s-i*t,h=o<0;if(Math.abs(o)<.001*Math.abs(a)){c.push(x-E*I,_-S*I,x+E*P,_+S*P),a>=0&&(r.join===af.ROUND?d+=ff(x,_,x-E*I,_-S*I,x-T*I,_-A*I,c,!1)+4:d+=2,c.push(x-T*P,_-A*P,x+T*I,_+A*I));continue}const l=(-E+y)*(-S+_)-(-E+x)*(-S+v),u=(-T+b)*(-A+_)-(-T+x)*(-A+w),f=(t*u-s*l)/o,M=(i*l-e*u)/o,R=(f-x)*(f-x)+(M-_)*(M-_),k=x+(f-x)*I,F=_+(M-_)*I,O=x-(f-x)*P,N=_-(M-_)*P,B=h?I:P,L=R<=Math.min(t*t+e*e,s*s+i*i)+B*B*m;let V=r.join;if(V===af.MITER&&R/m>g&&(V=af.BEVEL),L)switch(V){case af.MITER:c.push(k,F,O,N);break;case af.BEVEL:h?c.push(k,F,x+E*P,_+S*P,k,F,x+T*P,_+A*P):c.push(x-E*I,_-S*I,O,N,x-T*I,_-A*I,O,N),d+=2;break;case af.ROUND:h?(c.push(k,F,x+E*P,_+S*P),d+=ff(x,_,x+E*P,_+S*P,x+T*P,_+A*P,c,!0)+4,c.push(k,F,x+T*P,_+A*P)):(c.push(x-E*I,_-S*I,O,N),d+=ff(x,_,x-E*I,_-S*I,x-T*I,_-A*I,c,!1)+4,c.push(x-T*I,_-A*I,O,N))}else{switch(c.push(x-E*I,_-S*I,x+E*P,_+S*P),V){case af.MITER:h?c.push(O,N,O,N):c.push(k,F,k,F),d+=2;break;case af.ROUND:d+=h?ff(x,_,x+E*P,_+S*P,x+T*P,_+A*P,c,!0)+2:ff(x,_,x-E*I,_-S*I,x-T*I,_-A*I,c,!1)+2}c.push(x-T*I,_-A*I,x+T*P,_+A*P),d+=2}}y=n[2*(u-2)],v=n[2*(u-2)+1],x=n[2*(u-1)],_=n[2*(u-1)+1],E=-(v-_),S=y-x,C=Math.sqrt(E*E+S*S),E/=C,S/=C,E*=p,S*=p,c.push(x-E*I,_-S*I,x+E*P,_+S*P),h||(r.cap===of.ROUND?d+=ff(x-E*(I-P)*.5,_-S*(I-P)*.5,x-E*I,_-S*I,x+E*P,_+S*P,c,!1)+2:r.cap===of.SQUARE&&(d+=df(x,_,E,S,I,P,!1,c)));const R=e.indices,k=hf.epsilon*hf.epsilon;for(let D=f;D<d+f-2;++D)y=c[2*D],v=c[2*D+1],x=c[2*(D+1)],_=c[2*(D+1)+1],b=c[2*(D+2)],w=c[2*(D+2)+1],Math.abs(y*(_-w)+x*(w-v)+b*(v-_))<k||R.push(D,D+1,D+2)}(t,e)}class mf{static curveLength(t,e,s,n,i,r){const a=t-2*s+i,o=e-2*n+r,h=2*s-2*t,l=2*n-2*e,c=4*(a*a+o*o),u=4*(a*h+o*l),d=h*h+l*l,f=2*Math.sqrt(c+u+d),p=Math.sqrt(c),m=2*c*p,g=2*Math.sqrt(d),y=u/p;return(m*f+p*u*(f-g)+(4*d*c-u*u)*Math.log((2*p+y+f)/(y+g)))/(4*m)}static curveTo(t,e,s,n,i){const r=i[i.length-2],a=i[i.length-1],o=hf._segmentsCount(mf.curveLength(r,a,t,e,s,n));let h=0,l=0;for(let c=1;c<=o;++c){const u=c/o;h=r+(t-r)*u,l=a+(e-a)*u,i.push(h+(t+(s-t)*u-h)*u,l+(e+(n-e)*u-l)*u)}}}const gf={[xh.POLY]:sf,[xh.CIRC]:tf,[xh.ELIP]:tf,[xh.RECT]:nf,[xh.RREC]:rf},yf=[],vf=[];class xf{constructor(t,e=null,s=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=s,this.fillStyle=e,this.matrix=n,this.type=t.type}clone(){return new xf(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const _f=new _h,bf=class extends mh{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Gc,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),vf.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),yf.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,s=null,n=null){const i=new xf(t,e,s,n);return this.graphicsData.push(i),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const s=new xf(t,null,null,e),n=this.graphicsData[this.graphicsData.length-1];return s.lineStyle=n.lineStyle,n.holes.push(s),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let s=0;s<e.length;++s){const n=e[s];if(n.fillStyle.visible&&(n.shape&&(n.matrix?n.matrix.applyInverse(t,_f):_f.copyFrom(t),n.shape.contains(_f.x,_f.y)))){let t=!1;if(n.holes)for(let e=0;e<n.holes.length;e++){if(n.holes[e].shape.contains(_f.x,_f.y)){t=!0;break}}if(!t)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let s=null,n=null;this.batches.length>0&&(s=this.batches[this.batches.length-1],n=s.style);for(let o=this.shapeIndex;o<e.length;o++){this.shapeIndex++;const i=e[o],r=i.fillStyle,a=i.lineStyle;gf[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix),(r.visible||a.visible)&&this.processHoles(i.holes);for(let e=0;e<2;e++){const o=0===e?r:a;if(!o.visible)continue;const h=o.texture.baseTexture,l=this.indices.length,c=this.points.length/2;h.wrapMode=ur.REPEAT,0===e?this.processFill(i):this.processLine(i);const u=this.points.length/2-c;0!==u&&(s&&!this._compareStyles(n,o)&&(s.end(l,c),s=null),s||(s=yf.pop()||new cf,s.begin(o,l,c),this.batches.push(s),n=o),this.addUvs(this.points,t,o.texture,c,u,o.matrix))}}const i=this.indices.length,r=this.points.length/2;if(s&&s.end(i,r),0===this.batches.length)return void(this.batchable=!0);const a=r>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e)&&(t.texture.baseTexture===e.texture.baseTexture&&(t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native))}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const e=this.graphicsData[t],s=e.fillStyle,n=e.lineStyle;if(s&&!s.texture.baseTexture.valid)return!1;if(n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,s=t.length;e<s;e++){const s=t[e];for(let t=0;t<s.size;t++){const e=s.start+t;this.indicesUint16[e]=this.indicesUint16[e]-s.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*bf.BATCHABLE_SIZE}buildDrawCalls(){let t=++rh._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),vf.push(this.drawCalls[c]);this.drawCalls.length=0;const e=this.colors,s=this.textureIds;let n=vf.pop();n||(n=new ah,n.texArray=new ul),n.texArray.count=0,n.start=0,n.size=0,n.type=rr.TRIANGLES;let i=0,r=null,a=0,o=!1,h=rr.TRIANGLES,l=0;this.drawCalls.push(n);for(let c=0;c<this.batches.length;c++){const u=this.batches[c],d=8,f=u.style,p=f.texture.baseTexture;o!==!!f.native&&(o=!!f.native,h=o?rr.LINES:rr.TRIANGLES,r=null,i=d,t++),r!==p&&(r=p,p._batchEnabled!==t&&(i===d&&(t++,i=0,n.size>0&&(n=vf.pop(),n||(n=new ah,n.texArray=new ul),this.drawCalls.push(n)),n.start=l,n.size=0,n.texArray.count=0,n.type=h),p.touched=1,p._batchEnabled=t,p._batchLocation=i,p.wrapMode=ur.REPEAT,n.texArray.elements[n.texArray.count++]=p,i++)),n.size+=u.size,l+=u.size,a=p._batchLocation,this.addColors(e,f.color,f.alpha,u.attribSize,u.attribStart),this.addTextureIds(s,a,u.attribSize,u.attribStart)}rh._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,s=this.colors,n=this.textureIds,i=new ArrayBuffer(3*t.length*4),r=new Float32Array(i),a=new Uint32Array(i);let o=0;for(let h=0;h<t.length/2;h++)r[o++]=t[2*h],r[o++]=t[2*h+1],r[o++]=e[2*h],r[o++]=e[2*h+1],a[o++]=s[h],r[o++]=n[h];this._buffer.update(i),this._indexBuffer.update(this.indicesUint16)}processFill(t){if(t.holes.length)sf.triangulate(t,this);else{gf[t.type].triangulate(t,this)}}processLine(t){pf(t,this);for(let e=0;e<t.holes.length;e++)pf(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const s=t[e];gf[s.type].build(s),s.matrix&&this.transformPoints(s.points,s.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let s=0;s<t.length/2;s++){const n=t[2*s],i=t[2*s+1];t[2*s]=e.a*n+e.c*i+e.tx,t[2*s+1]=e.b*n+e.d*i+e.ty}}addColors(t,e,s,n,i=0){const r=_o.shared.setValue(e).toLittleEndianNumber(),a=_o.shared.setValue(r).toPremultiplied(s);t.length=Math.max(t.length,i+n);for(let o=0;o<n;o++)t[i+o]=a}addTextureIds(t,e,s,n=0){t.length=Math.max(t.length,n+s);for(let i=0;i<s;i++)t[n+i]=e}addUvs(t,e,s,n,i,r=null){let a=0;const o=e.length,h=s.frame;for(;a<i;){let s=t[2*(n+a)],i=t[2*(n+a)+1];if(r){const t=r.a*s+r.c*i+r.tx;i=r.b*s+r.d*i+r.ty,s=t}a++,e.push(s/h.width,i/h.height)}const l=s.baseTexture;(h.width<l.width||h.height<l.height)&&this.adjustUvs(e,s,o,i)}adjustUvs(t,e,s,n){const i=e.baseTexture,r=1e-6,a=s+2*n,o=e.frame,h=o.width/i.width,l=o.height/i.height;let c=o.x/o.width,u=o.y/o.height,d=Math.floor(t[s]+r),f=Math.floor(t[s+1]+r);for(let p=s+2;p<a;p+=2)d=Math.min(d,Math.floor(t[p]+r)),f=Math.min(f,Math.floor(t[p+1]+r));c-=d,u-=f;for(let p=s;p<a;p+=2)t[p]=(t[p]+c)*h,t[p+1]=(t[p+1]+u)*l}};let wf=bf;wf.BATCHABLE_SIZE=100;class Ef{constructor(){this.color=16777215,this.alpha=1,this.texture=Il.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Ef;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Il.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Sf extends Ef{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=of.BUTT,this.join=af.MITER,this.miterLimit=10}clone(){const t=new Sf;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const Tf={},Af=class extends Jc{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Ef,this._lineStyle=new Sf,this._matrix=null,this._holeMode=!1,this.state=Zo.for2d(),this._geometry=t||new wf,this._geometry.refCount++,this._transformID=-1,this._tintColor=new _o(16777215),this.blendMode=ir.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Af(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,s,n=.5,i=!1){return"number"==typeof t&&(t={width:t,color:e,alpha:s,alignment:n,native:i}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:Il.WHITE,color:(null==t?void 0:t.texture)?16777215:0,matrix:null,alignment:.5,native:!1,cap:of.BUTT,join:af.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const s=t.width>0&&t.alpha>0;return s?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:s},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Th,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Th,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const s=this.currentPath.points,n=s[s.length-2],i=s[s.length-1];return n===t&&i===e||s.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,s,n){this._initCurve();const i=this.currentPath.points;return 0===i.length&&this.moveTo(0,0),mf.curveTo(t,e,s,n,i),this}bezierCurveTo(t,e,s,n,i,r){return this._initCurve(),uf.curveTo(t,e,s,n,i,r,this.currentPath.points),this}arcTo(t,e,s,n,i){this._initCurve(t,e);const r=this.currentPath.points,a=lf.curveTo(t,e,s,n,i,r);if(a){const{cx:t,cy:e,radius:s,startAngle:n,endAngle:i,anticlockwise:r}=a;this.arc(t,e,s,n,i,r)}return this}arc(t,e,s,n,i,r=!1){if(n===i)return this;!r&&i<=n?i+=gh:r&&n<=i&&(n+=gh);if(0===i-n)return this;const a=t+Math.cos(n)*s,o=e+Math.sin(n)*s,h=this._geometry.closePointEps;let l=this.currentPath?this.currentPath.points:null;if(l){const t=Math.abs(l[l.length-2]-a),e=Math.abs(l[l.length-1]-o);t<h&&e<h||l.push(a,o)}else this.moveTo(a,o),l=this.currentPath.points;return lf.arc(a,o,t,e,s,n,i,r,l),this}beginFill(t=0,e){return this.beginTextureFill({texture:Il.WHITE,color:t,alpha:e})}normalizeColor(t){var e;const s=_o.shared.setValue(null!=(e=t.color)?e:0);t.color=s.toNumber(),null!=t.alpha||(t.alpha=s.alpha)}beginTextureFill(t){const e={texture:Il.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const s=t.alpha>0;return s?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:s},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,s,n){return this.drawShape(new wh(t,e,s,n))}drawRoundedRect(t,e,s,n,i){return this.drawShape(new Ah(t,e,s,n,i))}drawCircle(t,e,s){return this.drawShape(new Eh(t,e,s))}drawEllipse(t,e,s,n){return this.drawShape(new Sh(t,e,s,n))}drawPolygon(...t){let e,s=!0;const n=t[0];n.points?(s=n.closeStroke,e=n.points):e=Array.isArray(t[0])?t[0]:t;const i=new Th(e);return i.closeStroke=s,this.drawShape(i),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==xh.RECT||t[0].matrix||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,s=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=s,this.vertexData=new Float32Array(t.points);for(let n=0;n<s;n++){const s=t.batches[n],i=s.style.color,r=new Float32Array(this.vertexData.buffer,4*s.attribStart*2,2*s.attribSize),a=new Float32Array(t.uvsFloat32.buffer,4*s.attribStart*2,2*s.attribSize),o={vertexData:r,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*s.start,s.size),uvs:a,_batchRGB:_o.shared.setValue(i).toRgbArray(),_tintRGB:i,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[n]=o}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,s=this.batches.length;e<s;e++){const s=this.batches[e];s.worldAlpha=this.worldAlpha*s.alpha,t.plugins[this.pluginName].render(s)}}}_renderDirect(t){const e=this._resolveDirectShader(t),s=this._geometry,n=this.worldAlpha,i=e.uniforms,r=s.drawCalls;i.translationMatrix=this.transform.worldTransform,_o.shared.setValue(this._tintColor).premultiply(n).toArray(i.tint),t.shader.bind(e),t.geometry.bind(s,e),t.state.set(this.state);for(let a=0,o=r.length;a<o;a++)this._renderDrawCallDirect(t,s.drawCalls[a])}_renderDrawCallDirect(t,e){const{texArray:s,type:n,size:i,start:r}=e,a=s.count;for(let o=0;o<a;o++)t.texture.bind(s.elements[o],o);t.geometry.draw(n,i,r)}_resolveDirectShader(t){let e=this.shader;const s=this.pluginName;if(!e){if(!Tf[s]){const{maxTextures:e}=t.plugins[s],n=new Int32Array(e);for(let t=0;t<e;t++)n[t]=t;const i={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ch,default:hl.from({uSamplers:n},!0)},r=t.plugins[s]._shader.program;Tf[s]=new ll(r,i)}e=Tf[s]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:s,maxX:n,maxY:i}=t.bounds;this._bounds.addFrame(this.transform,e,s,n,i)}containsPoint(t){return this.worldTransform.applyInverse(t,Af._TEMP_POINT),this._geometry.containsPoint(Af._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=_o.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,s=e.a,n=e.b,i=e.c,r=e.d,a=e.tx,o=e.ty,h=this._geometry.points,l=this.vertexData;let c=0;for(let u=0;u<h.length;u+=2){const t=h[u],e=h[u+1];l[c++]=s*t+i*e+a,l[c++]=r*e+n*t+o}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};let Cf=Af;Cf.curves=hf,Cf._TEMP_POINT=new _h;class Mf{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const If=new _h,Pf=new Th,Rf=class extends Jc{constructor(t,e,s,n=rr.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=s||Zo.for2d(),this.drawMode=n,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=_r.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===rr.TRIANGLES&&e.length<2*Rf.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,s=this.shader;s.uvMatrix&&(s.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=s._tintRGB,this._texture=s.texture;const n=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[n]),t.plugins[n].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,s=t._updateID;if(s===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const n=this.transform.worldTransform,i=n.a,r=n.b,a=n.c,o=n.d,h=n.tx,l=n.ty,c=this.vertexData;for(let u=0;u<c.length/2;u++){const t=e[2*u],s=e[2*u+1];c[2*u]=i*t+a*s+h,c[2*u+1]=r*t+o*s+l}if(this._roundPixels){const t=_r.RESOLUTION;for(let e=0;e<c.length;++e)c[e]=Math.round(c[e]*t)/t}this.vertexDirty=s}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new Mf(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,If);const e=this.geometry.getBuffer("aVertexPosition").data,s=Pf.points,n=this.geometry.getIndex().data,i=n.length,r=4===this.drawMode?3:1;for(let a=0;a+2<i;a+=r){const t=2*n[a],i=2*n[a+1],r=2*n[a+2];if(s[0]=e[t],s[1]=e[t+1],s[2]=e[i],s[3]=e[i+1],s[4]=e[r],s[5]=e[r+1],Pf.contains(If.x,If.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let kf=Rf;kf.BATCHABLE_SIZE=100;class Df extends ph{constructor(t,e,s){super();const n=new hh(t),i=new hh(e,!0),r=new hh(s,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,hr.FLOAT).addAttribute("aTextureCoord",i,2,!1,hr.FLOAT).addIndex(r),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class Ff extends ll{constructor(t,e){const s={uSampler:t,alpha:1,uTextureMatrix:Ch.IDENTITY,uColor:new Float32Array([1,1,1,1])};(e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e)).uniforms&&Object.assign(s,e.uniforms),super(e.program||al.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),s),this._colorDirty=!1,this.uvMatrix=new Wl(t),this.batchable=void 0===e.program,this.pluginName=e.pluginName,this._tintColor=new _o(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;_o.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Of extends kf{constructor(t=Il.EMPTY,e,s,n,i){const r=new Df(e,s,n);r.getBuffer("aVertexPosition").static=!1;super(r,new Ff(t),null,i),this.autoUpdate=!0}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}_render(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),super._render(t)}}class Nf extends Jc{constructor(t=1500,e,s=16384,n=!1){super();s>16384&&(s=16384),this._properties=[!1,!0,!1,!1,!1],this._maxSize=t,this._batchSize=s,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=ir.NORMAL,this.autoResize=n,this.roundPixels=!0,this.baseTexture=null,this.setProperties(e),this._tintColor=new _o(0),this.tintRgb=new Float32Array(3),this.tint=16777215}setProperties(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintColor.toRgbArray(this.tintRgb)}render(t){this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",(()=>this.onChildrenChange(0)))),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))}onChildrenChange(t){const e=Math.floor(t/this._batchSize);for(;this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID}dispose(){if(this._buffers){for(let t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}}destroy(t){super.destroy(t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}}class Bf{constructor(t,e,s){this.geometry=new ph,this.indexBuffer=null,this.size=s,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<t.length;++n){let s=t[n];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||hr.FLOAT,offset:s.offset},e[n]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new hh(function(t,e=null){const s=6*t;if((e=e||new Uint16Array(s)).length!==s)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${s}`);for(let n=0,i=0;n<s;n+=6,i+=4)e[n+0]=i+0,e[n+1]=i+1,e[n+2]=i+2,e[n+3]=i+0,e[n+4]=i+2,e[n+5]=i+3;return e}(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let r=0;r<this.dynamicProperties.length;++r){const t=this.dynamicProperties[r];t.offset=e,e+=t.size,this.dynamicStride+=t.size}const s=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(s),this.dynamicDataUint32=new Uint32Array(s),this.dynamicBuffer=new hh(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let r=0;r<this.staticProperties.length;++r){const t=this.staticProperties[r];t.offset=n,n+=t.size,this.staticStride+=t.size}const i=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(i),this.staticDataUint32=new Uint32Array(i),this.staticBuffer=new hh(this.staticData,!0,!1);for(let r=0;r<this.dynamicProperties.length;++r){const e=this.dynamicProperties[r];t.addAttribute(e.attributeName,this.dynamicBuffer,0,e.type===hr.UNSIGNED_BYTE,e.type,4*this.dynamicStride,4*e.offset)}for(let r=0;r<this.staticProperties.length;++r){const e=this.staticProperties[r];t.addAttribute(e.attributeName,this.staticBuffer,0,e.type===hr.UNSIGNED_BYTE,e.type,4*this.staticStride,4*e.offset)}}uploadDynamic(t,e,s){for(let n=0;n<this.dynamicProperties.length;n++){const i=this.dynamicProperties[n];i.uploadFunction(t,e,s,i.type===hr.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,i.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,s){for(let n=0;n<this.staticProperties.length;n++){const i=this.staticProperties[n];i.uploadFunction(t,e,s,i.type===hr.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,i.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class Lf extends dl{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new Ch,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:hr.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=ll.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=Zo.for2d()}render(t){const e=t.children,s=t._maxSize,n=t._batchSize,i=this.renderer;let r=e.length;if(0===r)return;r>s&&!t.autoResize&&(r=s);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));const o=e[0]._texture.baseTexture,h=o.alphaMode>0;this.state.blendMode=So(t.blendMode,h),i.state.set(this.state);const l=i.gl,c=t.worldTransform.copyTo(this.tempMatrix);c.prepend(i.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=_o.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=o,this.renderer.shader.bind(this.shader);let u=!1;for(let d=0,f=0;d<r;d+=n,f+=1){let s=r-d;s>n&&(s=n),f>=a.length&&a.push(this._generateOneMoreBuffer(t));const o=a[f];o.uploadDynamic(e,d,s);const h=t._bufferUpdateIDs[f]||0;u=u||o._updateID<h,u&&(o._updateID=t._updateID,o.uploadStatic(e,d,s)),i.geometry.bind(o.geometry),l.drawElements(l.TRIANGLES,6*s,l.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],s=t._maxSize,n=t._batchSize,i=t._properties;for(let r=0;r<s;r+=n)e.push(new Bf(this.properties,i,n));return e}_generateOneMoreBuffer(t){const e=t._batchSize,s=t._properties;return new Bf(this.properties,s,e)}uploadVertices(t,e,s,n,i,r){let a=0,o=0,h=0,l=0;for(let c=0;c<s;++c){const s=t[e+c],u=s._texture,d=s.scale.x,f=s.scale.y,p=u.trim,m=u.orig;p?(o=p.x-s.anchor.x*m.width,a=o+p.width,l=p.y-s.anchor.y*m.height,h=l+p.height):(a=m.width*(1-s.anchor.x),o=m.width*-s.anchor.x,h=m.height*(1-s.anchor.y),l=m.height*-s.anchor.y),n[r]=o*d,n[r+1]=l*f,n[r+i]=a*d,n[r+i+1]=l*f,n[r+2*i]=a*d,n[r+2*i+1]=h*f,n[r+3*i]=o*d,n[r+3*i+1]=h*f,r+=4*i}}uploadPosition(t,e,s,n,i,r){for(let a=0;a<s;a++){const s=t[e+a].position;n[r]=s.x,n[r+1]=s.y,n[r+i]=s.x,n[r+i+1]=s.y,n[r+2*i]=s.x,n[r+2*i+1]=s.y,n[r+3*i]=s.x,n[r+3*i+1]=s.y,r+=4*i}}uploadRotation(t,e,s,n,i,r){for(let a=0;a<s;a++){const s=t[e+a].rotation;n[r]=s,n[r+i]=s,n[r+2*i]=s,n[r+3*i]=s,r+=4*i}}uploadUvs(t,e,s,n,i,r){for(let a=0;a<s;++a){const s=t[e+a]._texture._uvs;s?(n[r]=s.x0,n[r+1]=s.y0,n[r+i]=s.x1,n[r+i+1]=s.y1,n[r+2*i]=s.x2,n[r+2*i+1]=s.y2,n[r+3*i]=s.x3,n[r+3*i+1]=s.y3,r+=4*i):(n[r]=0,n[r+1]=0,n[r+i]=0,n[r+i+1]=0,n[r+2*i]=0,n[r+2*i+1]=0,n[r+3*i]=0,n[r+3*i+1]=0,r+=4*i)}}uploadTint(t,e,s,n,i,r){for(let a=0;a<s;++a){const s=t[e+a],o=_o.shared.setValue(s._tintRGB).toPremultiplied(s.alpha,s.texture.baseTexture.alphaMode>0);n[r]=o,n[r+i]=o,n[r+2*i]=o,n[r+3*i]=o,r+=4*i}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Lf.extension={name:"particle",type:Wo.RendererPlugin},Go.add(Lf);var Vf=(t=>(t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",t))(Vf||{});const $f={willReadFrequently:!0},Uf=class{static get experimentalLetterSpacingSupported(){let t=Uf._experimentalLetterSpacingSupported;if(void 0!==t){const e=_r.ADAPTER.getCanvasRenderingContext2D().prototype;t=Uf._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,s,n,i,r,a,o,h){this.text=t,this.style=e,this.width=s,this.height=n,this.lines=i,this.lineWidths=r,this.lineHeight=a,this.maxLineWidth=o,this.fontProperties=h}static measureText(t,e,s,n=Uf._canvas){s=null==s?e.wordWrap:s;const i=e.toFontString(),r=Uf.measureFont(i);0===r.fontSize&&(r.fontSize=e.fontSize,r.ascent=e.fontSize);const a=n.getContext("2d",$f);a.font=i;const o=(s?Uf.wordWrap(t,e,n):t).split(/(?:\r\n|\r|\n)/),h=new Array(o.length);let l=0;for(let f=0;f<o.length;f++){const t=Uf._measureText(o[f],e.letterSpacing,a);h[f]=t,l=Math.max(l,t)}let c=l+e.strokeThickness;e.dropShadow&&(c+=e.dropShadowDistance);const u=e.lineHeight||r.fontSize+e.strokeThickness;let d=Math.max(u,r.fontSize+2*e.strokeThickness)+(o.length-1)*(u+e.leading);return e.dropShadow&&(d+=e.dropShadowDistance),new Uf(t,e,c,d,o,h,u+e.leading,l,r)}static _measureText(t,e,s){let n=!1;Uf.experimentalLetterSpacingSupported&&(Uf.experimentalLetterSpacing?(s.letterSpacing=`${e}px`,s.textLetterSpacing=`${e}px`,n=!0):(s.letterSpacing="0px",s.textLetterSpacing="0px"));let i=s.measureText(t).width;return i>0&&(n?i-=e:i+=(Uf.graphemeSegmenter(t).length-1)*e),i}static wordWrap(t,e,s=Uf._canvas){const n=s.getContext("2d",$f);let i=0,r="",a="";const o=Object.create(null),{letterSpacing:h,whiteSpace:l}=e,c=Uf.collapseSpaces(l),u=Uf.collapseNewlines(l);let d=!c;const f=e.wordWrapWidth+h,p=Uf.tokenize(t);for(let m=0;m<p.length;m++){let t=p[m];if(Uf.isNewline(t)){if(!u){a+=Uf.addLine(r),d=!c,r="",i=0;continue}t=" "}if(c){const e=Uf.isBreakingSpace(t),s=Uf.isBreakingSpace(r[r.length-1]);if(e&&s)continue}const s=Uf.getFromCache(t,h,o,n);if(s>f)if(""!==r&&(a+=Uf.addLine(r),r="",i=0),Uf.canBreakWords(t,e.breakWords)){const s=Uf.wordWrapSplit(t);for(let l=0;l<s.length;l++){let c=s[l],u=c,p=1;for(;s[l+p];){const n=s[l+p];if(Uf.canBreakChars(u,n,t,l,e.breakWords))break;c+=n,u=n,p++}l+=p-1;const m=Uf.getFromCache(c,h,o,n);m+i>f&&(a+=Uf.addLine(r),d=!1,r="",i=0),r+=c,i+=m}}else{r.length>0&&(a+=Uf.addLine(r),r="",i=0);const e=m===p.length-1;a+=Uf.addLine(t,!e),d=!1,r="",i=0}else s+i>f&&(d=!1,a+=Uf.addLine(r),r="",i=0),(r.length>0||!Uf.isBreakingSpace(t)||d)&&(r+=t,i+=s)}return a+=Uf.addLine(r,!1),a}static addLine(t,e=!0){return t=Uf.trimRight(t),t=e?`${t}\n`:t}static getFromCache(t,e,s,n){let i=s[t];return"number"!=typeof i&&(i=Uf._measureText(t,e,n)+e,s[t]=i),i}static collapseSpaces(t){return"normal"===t||"pre-line"===t}static collapseNewlines(t){return"normal"===t}static trimRight(t){if("string"!=typeof t)return"";for(let e=t.length-1;e>=0;e--){const s=t[e];if(!Uf.isBreakingSpace(s))break;t=t.slice(0,-1)}return t}static isNewline(t){return"string"==typeof t&&Uf._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return"string"==typeof t&&Uf._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let s="";if("string"!=typeof t)return e;for(let n=0;n<t.length;n++){const i=t[n],r=t[n+1];Uf.isBreakingSpace(i,r)||Uf.isNewline(i)?(""!==s&&(e.push(s),s=""),e.push(i)):s+=i}return""!==s&&e.push(s),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,s,n,i){return!0}static wordWrapSplit(t){return Uf.graphemeSegmenter(t)}static measureFont(t){if(Uf._fonts[t])return Uf._fonts[t];const e={ascent:0,descent:0,fontSize:0},s=Uf._canvas,n=Uf._context;n.font=t;const i=Uf.METRICS_STRING+Uf.BASELINE_SYMBOL,r=Math.ceil(n.measureText(i).width);let a=Math.ceil(n.measureText(Uf.BASELINE_SYMBOL).width);const o=Math.ceil(Uf.HEIGHT_MULTIPLIER*a);if(a=a*Uf.BASELINE_MULTIPLIER|0,0===r||0===o)return Uf._fonts[t]=e,e;s.width=r,s.height=o,n.fillStyle="#f00",n.fillRect(0,0,r,o),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(i,0,a);const h=n.getImageData(0,0,r,o).data,l=h.length,c=4*r;let u=0,d=0,f=!1;for(u=0;u<a;++u){for(let t=0;t<c;t+=4)if(255!==h[d+t]){f=!0;break}if(f)break;d+=c}for(e.ascent=a-u,d=l-c,f=!1,u=o;u>a;--u){for(let t=0;t<c;t+=4)if(255!==h[d+t]){f=!0;break}if(f)break;d-=c}return e.descent=u-a,e.fontSize=e.ascent+e.descent,Uf._fonts[t]=e,e}static clearMetrics(t=""){t?delete Uf._fonts[t]:Uf._fonts={}}static get _canvas(){if(!Uf.__canvas){let e;try{const t=new OffscreenCanvas(0,0),s=t.getContext("2d",$f);if(null==s?void 0:s.measureText)return Uf.__canvas=t,t;e=_r.ADAPTER.createCanvas()}catch(t){e=_r.ADAPTER.createCanvas()}e.width=e.height=10,Uf.__canvas=e}return Uf.__canvas}static get _context(){return Uf.__context||(Uf.__context=Uf._canvas.getContext("2d",$f)),Uf.__context}};let Xf=Uf;Xf.METRICS_STRING="|q",Xf.BASELINE_SYMBOL="M",Xf.BASELINE_MULTIPLIER=1.4,Xf.HEIGHT_MULTIPLIER=2,Xf.graphemeSegmenter=(()=>{if("function"==typeof(null==Intl?void 0:Intl.Segmenter)){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map((t=>t.segment))}return t=>[...t]})(),Xf.experimentalLetterSpacing=!1,Xf._fonts={},Xf._newlines=[10,13],Xf._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const Yf=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Wf=class{constructor(t){this.styleID=0,this.reset(),Gf(this,t,t)}clone(){const t={};return Gf(t,this,Wf.defaultStyle),new Wf(t)}reset(){Gf(this,Wf.defaultStyle,Wf.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=zf(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=zf(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=zf(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let s=e.length-1;s>=0;s--){let t=e[s].trim();/([\"\'])[^\'\"]+\1/.test(t)||Yf.includes(t)||(t=`"${t}"`),e[s]=t}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};let jf=Wf;function zf(t){const e=_o.shared;return Array.isArray(t)?t.map((t=>e.setValue(t).toHex())):e.setValue(t).toHex()}function Gf(t,e,s){for(const n in s)Array.isArray(e[n])?t[n]=e[n].slice():t[n]=e[n]}jf.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Vf.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};const Hf={texture:!0,children:!1,baseTexture:!0},qf=class extends su{constructor(t,e,s){var n;let i=!1;s||(s=_r.ADAPTER.createCanvas(),i=!0),s.width=3,s.height=3;const r=Il.from(s);r.orig=new wh,r.trim=new wh,super(r),this._ownCanvas=i,this.canvas=s,this.context=s.getContext("2d",{willReadFrequently:!0}),this._resolution=null!=(n=qf.defaultResolution)?n:_r.RESOLUTION,this._autoResolution=qf.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return Xf.experimentalLetterSpacing}static set experimentalLetterSpacing(t){Ua("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Xf.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const s=this.context,n=Xf.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),i=n.width,r=n.height,a=n.lines,o=n.lineHeight,h=n.lineWidths,l=n.maxLineWidth,c=n.fontProperties;let u,d;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,i)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,r)+2*e.padding)*this._resolution),s.scale(this._resolution,this._resolution),s.clearRect(0,0,this.canvas.width,this.canvas.height),s.font=this._font,s.lineWidth=e.strokeThickness,s.textBaseline=e.textBaseline,s.lineJoin=e.lineJoin,s.miterLimit=e.miterLimit;const f=e.dropShadow?2:1;for(let p=0;p<f;++p){const t=e.dropShadow&&0===p,i=t?Math.ceil(Math.max(1,r)+2*e.padding):0,f=i*this._resolution;if(t){s.fillStyle="black",s.strokeStyle="black";const t=e.dropShadowColor,n=e.dropShadowBlur*this._resolution,i=e.dropShadowDistance*this._resolution;s.shadowColor=_o.shared.setValue(t).setAlpha(e.dropShadowAlpha).toRgbaString(),s.shadowBlur=n,s.shadowOffsetX=Math.cos(e.dropShadowAngle)*i,s.shadowOffsetY=Math.sin(e.dropShadowAngle)*i+f}else s.fillStyle=this._generateFillStyle(e,a,n),s.strokeStyle=e.stroke,s.shadowColor="black",s.shadowBlur=0,s.shadowOffsetX=0,s.shadowOffsetY=0;let m=(o-c.fontSize)/2;o-c.fontSize<0&&(m=0);for(let s=0;s<a.length;s++)u=e.strokeThickness/2,d=e.strokeThickness/2+s*o+c.ascent+m,"right"===e.align?u+=l-h[s]:"center"===e.align&&(u+=(l-h[s])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(a[s],u+e.padding,d+e.padding-i,!0),e.fill&&this.drawLetterSpacing(a[s],u+e.padding,d+e.padding-i)}this.updateTexture()}drawLetterSpacing(t,e,s,n=!1){const i=this._style.letterSpacing;let r=!1;if(Xf.experimentalLetterSpacingSupported&&(Xf.experimentalLetterSpacing?(this.context.letterSpacing=`${i}px`,this.context.textLetterSpacing=`${i}px`,r=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===i||r)return void(n?this.context.strokeText(t,e,s):this.context.fillText(t,e,s));let a=e;const o=Xf.graphemeSegmenter(t);let h=this.context.measureText(t).width,l=0;for(let c=0;c<o.length;++c){const t=o[c];n?this.context.strokeText(t,a,s):this.context.fillText(t,a,s);let e="";for(let s=c+1;s<o.length;++s)e+=o[s];l=this.context.measureText(e).width,a+=h-l+i,h=l}}updateTexture(){const t=this.canvas;if(this._style.trim){const e=Uo(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}const e=this._texture,s=this._style,n=s.trim?0:s.padding,i=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-2*n,e.orig.height=e._frame.height-2*n,this._onTextureUpdate(),i.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),-1===this._textureID&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,s){const n=t.fill;if(!Array.isArray(n))return n;if(1===n.length)return n[0];let i;const r=t.dropShadow?t.dropShadowDistance:0,a=t.padding||0,o=this.canvas.width/this._resolution-r-2*a,h=this.canvas.height/this._resolution-r-2*a,l=n.slice(),c=t.fillGradientStops.slice();if(!c.length){const t=l.length+1;for(let e=1;e<t;++e)c.push(e/t)}if(l.unshift(n[0]),c.unshift(0),l.push(n[n.length-1]),c.push(1),t.fillGradientType===Vf.LINEAR_VERTICAL){i=this.context.createLinearGradient(o/2,a,o/2,h+a);const n=s.fontProperties.fontSize+t.strokeThickness;for(let t=0;t<e.length;t++){const r=s.lineHeight*(t-1)+n,a=s.lineHeight*t;let o=a;t>0&&r>a&&(o=(a+r)/2);const u=a+n,d=s.lineHeight*(t+1);let f=u;t+1<e.length&&d<u&&(f=(u+d)/2);const p=(f-o)/h;for(let t=0;t<l.length;t++){let e=0;e="number"==typeof c[t]?c[t]:t/l.length;let s=Math.min(1,Math.max(0,o/h+e*p));s=Number(s.toFixed(5)),i.addColorStop(s,l[t])}}}else{i=this.context.createLinearGradient(a,h/2,o+a,h/2);const t=l.length+1;let e=1;for(let s=0;s<l.length;s++){let n;n="number"==typeof c[s]?c[s]:e/t,i.addColorStop(n,l[s]),e++}}return i}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},Hf,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=Po(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=Po(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},this._style=t instanceof jf?t:new jf(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};let Kf=qf;Kf.defaultAutoResolution=!0;class Zf{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Qf(t,e){var s;let n=!1;if(null==(s=null==t?void 0:t._textures)?void 0:s.length)for(let i=0;i<t._textures.length;i++)if(t._textures[i]instanceof Il){const s=t._textures[i].baseTexture;e.includes(s)||(e.push(s),n=!0)}return n}function Jf(t,e){if(t.baseTexture instanceof rh){const s=t.baseTexture;return e.includes(s)||e.push(s),!0}return!1}function tp(t,e){if(t._texture&&t._texture instanceof Il){const s=t._texture.baseTexture;return e.includes(s)||e.push(s),!0}return!1}function ep(t,e){return e instanceof Kf&&(e.updateText(!0),!0)}function sp(t,e){if(e instanceof jf){const t=e.toFontString();return Xf.measureFont(t),!0}return!1}function np(t,e){if(t instanceof Kf){e.includes(t.style)||e.push(t.style),e.includes(t)||e.push(t);const s=t._texture.baseTexture;return e.includes(s)||e.push(s),!0}return!1}function ip(t,e){return t instanceof jf&&(e.includes(t)||e.push(t),!0)}const rp=class{constructor(t){this.limiter=new Zf(rp.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(np),this.registerFindHook(ip),this.registerFindHook(Qf),this.registerFindHook(Jf),this.registerFindHook(tp),this.registerUploadHook(ep),this.registerUploadHook(sp)}upload(t){return new Promise((e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Ic.system.addOnce(this.tick,this,Ac.UTILITY))):e()}))}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed)for(let s=0,n=this.uploadHooks.length;s<n;s++)if(this.uploadHooks[s](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)Ic.system.addOnce(this.tick,this,Ac.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,s=t.length;e<s;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,s=this.addHooks.length;e<s&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Jc)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&Ic.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let ap=rp;function op(t,e){return e instanceof rh&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function hp(t,e){if(!(e instanceof Cf))return!1;const{geometry:s}=e;e.finishPoly(),s.updateBatches();const{batches:n}=s;for(let i=0;i<n.length;i++){const{texture:e}=n[i].style;e&&op(t,e.baseTexture)}return s.batchable||t.geometry.bind(s,e._resolveDirectShader(t)),!0}function lp(t,e){return t instanceof Cf&&(e.push(t),!0)}ap.uploadsPerFrame=4,Object.defineProperties(_r,{UPLOADS_PER_FRAME:{get:()=>ap.uploadsPerFrame,set(t){Ua("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),ap.uploadsPerFrame=t}}});class cp extends ap{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(lp),this.registerUploadHook(op),this.registerUploadHook(hp)}}cp.extension={name:"prepare",type:Wo.RendererSystem},Go.add(cp);class up extends su{constructor(t,e=!0){super(t[0]instanceof Il?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=e,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Ic.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Ic.shared.add(this.update,this,Ac.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const e=this.animationSpeed*t,s=this.currentFrame;if(null!==this._durations){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=e/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];const n=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*n,this._currentTime+=n;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):s!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<s||this.animationSpeed<0&&this.currentFrame>s)&&this.onLoop(),this.updateTexture())}updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t){this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const e=[];for(let s=0;s<t.length;++s)e.push(Il.from(t[s]));return new up(e)}static fromImages(t){const e=[];for(let s=0;s<t.length;++s)e.push(Il.from(t[s]));return new up(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof Il)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Ic.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Ic.shared.add(this.update,this),this._isConnectedToTicker=!0))}}var dp="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const fp=new Ch;class pp extends dl{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Dl,this.state=Zo.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=ll.from(dp,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",e),this.shader=t.context.webGLVersion>1?ll.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",e):ll.from(dp,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",e)}render(t){const e=this.renderer,s=this.quad;let n=s.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const i=t.uvRespectAnchor?t.anchor.x:0,r=t.uvRespectAnchor?t.anchor.y:0;n=s.uvs,n[0]=n[6]=-i,n[1]=n[3]=-r,n[2]=n[4]=1-i,n[5]=n[7]=1-r,s.invalidate();const a=t._texture,o=a.baseTexture,h=o.alphaMode>0,l=t.tileTransform.localTransform,c=t.uvMatrix;let u=o.isPowerOfTwo&&a.frame.width===o.width&&a.frame.height===o.height;u&&(o._glTextures[e.CONTEXT_UID]?u=o.wrapMode!==ur.CLAMP:o.wrapMode===ur.CLAMP&&(o.wrapMode=ur.REPEAT));const d=u?this.simpleShader:this.shader,f=a.width,p=a.height,m=t._width,g=t._height;fp.set(l.a*f/m,l.b*f/g,l.c*p/m,l.d*p/g,l.tx/m,l.ty/g),fp.invert(),u?fp.prepend(c.mapCoord):(d.uniforms.uMapCoord=c.mapCoord.toArray(!0),d.uniforms.uClampFrame=c.uClampFrame,d.uniforms.uClampOffset=c.uClampOffset),d.uniforms.uTransform=fp.toArray(!0),d.uniforms.uColor=_o.shared.setValue(t.tint).premultiply(t.worldAlpha,h).toArray(d.uniforms.uColor),d.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),d.uniforms.uSampler=a,e.shader.bind(d),e.geometry.bind(s),this.state.blendMode=So(t.blendMode,h),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}pp.extension={name:"tilingSprite",type:Wo.RendererPlugin},Go.add(pp);const mp=class{constructor(t,e,s=null){this.linkedSheets=[],this._texture=t instanceof Il?t:null,this.baseTexture=t instanceof rh?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const n=this.baseTexture.resource;this.resolution=this._updateResolution(s||(n?n.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let s=Yo(t,null);return null===s&&(s=parseFloat(null!=e?e:"1")),1!==s&&this.baseTexture.setResolution(s),s}parse(){return new Promise((t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=mp.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(t){let e=t;const s=mp.BATCH_SIZE;for(;e-t<s&&e<this._frameKeys.length;){const t=this._frameKeys[e],s=this._frames[t],n=s.frame;if(n){let e=null,i=null;const r=!1!==s.trimmed&&s.sourceSize?s.sourceSize:s.frame,a=new wh(0,0,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution);e=s.rotated?new wh(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.h)/this.resolution,Math.floor(n.w)/this.resolution):new wh(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),!1!==s.trimmed&&s.spriteSourceSize&&(i=new wh(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution)),this.textures[t]=new Il(this.baseTexture,e,a,i,s.rotated?2:0,s.anchor,s.borders),Il.addToCache(this.textures[t],t)}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let s=0;s<t[e].length;s++){const n=t[e][s];this.animations[e].push(this.textures[n])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*mp.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*mp.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(t=!1){var e;for(const s in this.textures)this.textures[s].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(null==(e=this._texture)||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let gp=mp;gp.BATCH_SIZE=1e3;const yp=["jpg","png","jpeg","avif","webp"];function vp(t,e,s){const n={};if(t.forEach((t=>{n[t]=e})),Object.keys(e.textures).forEach((t=>{n[t]=e.textures[t]})),!s){const s=Va.dirname(t[0]);e.linkedSheets.forEach(((t,i)=>{const r=vp([`${s}/${e.data.meta.related_multi_packs[i]}`],t,!0);Object.assign(n,r)}))}return n}const xp={extension:Wo.Asset,cache:{test:t=>t instanceof gp,getCacheableAssets:(t,e)=>vp(t,e,!1)},resolver:{test:t=>{const e=t.split("?")[0].split("."),s=e.pop(),n=e.pop();return"json"===s&&yp.includes(n)},parse:t=>{var e,s;const n=t.split(".");return{resolution:parseFloat(null!=(s=null==(e=_r.RETINA_PREFIX.exec(t))?void 0:e[1])?s:"1"),format:n[n.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:Wo.LoadParser,priority:Vu.Normal},testParse(t,e){return f(this,null,(function*(){return".json"===Va.extname(e.src).toLowerCase()&&!!t.frames}))},parse(t,e,s){return f(this,null,(function*(){var n,i;let r=Va.dirname(e.src);r&&r.lastIndexOf("/")!==r.length-1&&(r+="/");let a=r+t.meta.image;a=Du(a,e.src);const o=(yield s.load([a]))[a],h=new gp(o.baseTexture,t,e.src);yield h.parse();const l=null==(n=null==t?void 0:t.meta)?void 0:n.related_multi_packs;if(Array.isArray(l)){const t=[];for(const a of l){if("string"!=typeof a)continue;let n=r+a;(null==(i=e.data)?void 0:i.ignoreMultiPack)||(n=Du(n,e.src),t.push(s.load({src:n,data:{ignoreMultiPack:!0}})))}const n=yield Promise.all(t);h.linkedSheets=n,n.forEach((t=>{t.linkedSheets=[h].concat(h.linkedSheets.filter((e=>e!==t)))}))}return h}))},unload(t){t.destroy(!0)}}};Go.add(xp);class _p{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class bp{static test(t){return"string"==typeof t&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),s={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const i in e){const t=e[i].match(/^[a-z]+/gm)[0],n=e[i].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),r={};for(const e in n){const t=n[e].split("="),s=t[0],i=t[1].replace(/"/gm,""),a=parseFloat(i),o=isNaN(a)?i:a;r[s]=o}s[t].push(r)}const n=new _p;return s.info.forEach((t=>n.info.push({face:t.face,size:parseInt(t.size,10)}))),s.common.forEach((t=>n.common.push({lineHeight:parseInt(t.lineHeight,10)}))),s.page.forEach((t=>n.page.push({id:parseInt(t.id,10),file:t.file}))),s.char.forEach((t=>n.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)}))),s.kerning.forEach((t=>n.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)}))),s.distanceField.forEach((t=>n.distanceField.push({distanceRange:parseInt(t.distanceRange,10),fieldType:t.fieldType}))),n}}class wp{static test(t){const e=t;return"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")}static parse(t){const e=new _p,s=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),i=t.getElementsByTagName("page"),r=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),o=t.getElementsByTagName("distanceField");for(let h=0;h<s.length;h++)e.info.push({face:s[h].getAttribute("face"),size:parseInt(s[h].getAttribute("size"),10)});for(let h=0;h<n.length;h++)e.common.push({lineHeight:parseInt(n[h].getAttribute("lineHeight"),10)});for(let h=0;h<i.length;h++)e.page.push({id:parseInt(i[h].getAttribute("id"),10)||0,file:i[h].getAttribute("file")});for(let h=0;h<r.length;h++){const t=r[h];e.char.push({id:parseInt(t.getAttribute("id"),10),page:parseInt(t.getAttribute("page"),10)||0,x:parseInt(t.getAttribute("x"),10),y:parseInt(t.getAttribute("y"),10),width:parseInt(t.getAttribute("width"),10),height:parseInt(t.getAttribute("height"),10),xoffset:parseInt(t.getAttribute("xoffset"),10),yoffset:parseInt(t.getAttribute("yoffset"),10),xadvance:parseInt(t.getAttribute("xadvance"),10)})}for(let h=0;h<a.length;h++)e.kerning.push({first:parseInt(a[h].getAttribute("first"),10),second:parseInt(a[h].getAttribute("second"),10),amount:parseInt(a[h].getAttribute("amount"),10)});for(let h=0;h<o.length;h++)e.distanceField.push({fieldType:o[h].getAttribute("fieldType"),distanceRange:parseInt(o[h].getAttribute("distanceRange"),10)});return e}}class Ep{static test(t){return!("string"!=typeof t||!t.includes("<font>"))&&wp.test(_r.ADAPTER.parseXML(t))}static parse(t){return wp.parse(_r.ADAPTER.parseXML(t))}}const Sp=[bp,wp,Ep];function Tp(t,e,s,n,i,r,a){const o=s.text,h=s.fontProperties;e.translate(n,i),e.scale(r,r);const l=a.strokeThickness/2,c=-a.strokeThickness/2;if(e.font=a.toFontString(),e.lineWidth=a.strokeThickness,e.textBaseline=a.textBaseline,e.lineJoin=a.lineJoin,e.miterLimit=a.miterLimit,e.fillStyle=function(t,e,s,n,i,r){const a=s.fill;if(!Array.isArray(a))return a;if(1===a.length)return a[0];let o;const h=s.dropShadow?s.dropShadowDistance:0,l=s.padding||0,c=t.width/n-h-2*l,u=t.height/n-h-2*l,d=a.slice(),f=s.fillGradientStops.slice();if(!f.length){const t=d.length+1;for(let e=1;e<t;++e)f.push(e/t)}if(d.unshift(a[0]),f.unshift(0),d.push(a[a.length-1]),f.push(1),s.fillGradientType===Vf.LINEAR_VERTICAL){o=e.createLinearGradient(c/2,l,c/2,u+l);let t=0;const n=(r.fontProperties.fontSize+s.strokeThickness)/u;for(let e=0;e<i.length;e++){const s=r.lineHeight*e;for(let e=0;e<d.length;e++){let i=0;i="number"==typeof f[e]?f[e]:e/d.length;const r=s/u+i*n;let a=Math.max(t,r);a=Math.min(a,1),o.addColorStop(a,d[e]),t=a}}}else{o=e.createLinearGradient(l,u/2,c+l,u/2);const t=d.length+1;let s=1;for(let e=0;e<d.length;e++){let n;n="number"==typeof f[e]?f[e]:s/t,o.addColorStop(n,d[e]),s++}}return o}(t,e,a,r,[o],s),e.strokeStyle=a.stroke,a.dropShadow){const t=a.dropShadowColor,s=a.dropShadowBlur*r,n=a.dropShadowDistance*r;e.shadowColor=_o.shared.setValue(t).setAlpha(a.dropShadowAlpha).toRgbaString(),e.shadowBlur=s,e.shadowOffsetX=Math.cos(a.dropShadowAngle)*n,e.shadowOffsetY=Math.sin(a.dropShadowAngle)*n}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;a.stroke&&a.strokeThickness&&e.strokeText(o,l,c+s.lineHeight-h.descent),a.fill&&e.fillText(o,l,c+s.lineHeight-h.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function Ap(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}function Cp(t){return Array.from?Array.from(t):t.split("")}const Mp=class{constructor(t,e,s){var n,i;const[r]=t.info,[a]=t.common,[o]=t.page,[h]=t.distanceField,l=Yo(o.file),c={};this._ownsTextures=s,this.font=r.face,this.size=r.size,this.lineHeight=a.lineHeight/l,this.chars={},this.pageTextures=c;for(let u=0;u<t.page.length;u++){const{id:s,file:n}=t.page[u];c[s]=e instanceof Array?e[u]:e[n],(null==h?void 0:h.fieldType)&&"none"!==h.fieldType&&(c[s].baseTexture.alphaMode=fr.NO_PREMULTIPLIED_ALPHA,c[s].baseTexture.mipmap=dr.OFF)}for(let u=0;u<t.char.length;u++){const{id:e,page:s}=t.char[u];let{x:n,y:i,width:r,height:a,xoffset:o,yoffset:h,xadvance:d}=t.char[u];n/=l,i/=l,r/=l,a/=l,o/=l,h/=l,d/=l;const f=new wh(n+c[s].frame.x/l,i+c[s].frame.y/l,r,a);this.chars[e]={xOffset:o,yOffset:h,xAdvance:d,kerning:{},texture:new Il(c[s].baseTexture,f),page:s}}for(let u=0;u<t.kerning.length;u++){let{first:e,second:s,amount:n}=t.kerning[u];e/=l,s/=l,n/=l,this.chars[s]&&(this.chars[s].kerning[e]=n)}this.distanceFieldRange=null==h?void 0:h.distanceRange,this.distanceFieldType=null!=(i=null==(n=null==h?void 0:h.fieldType)?void 0:n.toLowerCase())?i:"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,s){let n;if(t instanceof _p)n=t;else{const e=function(t){for(let e=0;e<Sp.length;e++)if(Sp[e].test(t))return Sp[e];return null}(t);if(!e)throw new Error("Unrecognized data format for font.");n=e.parse(t)}e instanceof Il&&(e=[e]);const i=new Mp(n,e,s);return Mp.available[i.font]=i,i}static uninstall(t){const e=Mp.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete Mp.available[t]}static from(t,e,s){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const n=Object.assign({},Mp.defaultOptions,s),{chars:i,padding:r,resolution:a,textureWidth:o,textureHeight:h}=n,c=u(n,["chars","padding","resolution","textureWidth","textureHeight"]),d=function(t){"string"==typeof t&&(t=[t]);const e=[];for(let s=0,n=t.length;s<n;s++){const n=t[s];if(Array.isArray(n)){if(2!==n.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const t=n[0].charCodeAt(0),s=n[1].charCodeAt(0);if(s<t)throw new Error("[BitmapFont]: Invalid character range.");for(let n=t,i=s;n<=i;n++)e.push(String.fromCharCode(n))}else e.push(...Cp(n))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(i),f=e instanceof jf?e:new jf(e),p=o,m=new _p;m.info[0]={face:f.fontFamily,size:f.fontSize},m.common[0]={lineHeight:f.fontSize};let g,y,v,x=0,_=0,b=0;const w=[];for(let u=0;u<d.length;u++){g||(g=_r.ADAPTER.createCanvas(),g.width=o,g.height=h,y=g.getContext("2d"),v=new rh(g,l({resolution:a},c)),w.push(new Il(v)),m.page.push({id:w.length-1,file:""}));const t=d[u],e=Xf.measureText(t,f,!1,g),s=e.width,n=Math.ceil(e.height),i=Math.ceil(("italic"===f.fontStyle?2:1)*s);if(_>=h-n*a){if(0===_)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${f.fontFamily}', fontSize: ${f.fontSize}px, char: '${t}')`);--u,g=null,y=null,v=null,_=0,x=0,b=0;continue}if(b=Math.max(n+e.fontProperties.descent,b),i*a+x>=p){if(0===x)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${f.fontFamily}', fontSize: ${f.fontSize}px, char: '${t}')`);--u,_+=b*a,_=Math.ceil(_),x=0,b=0;continue}Tp(g,y,e,x,_,a,f);const E=Ap(e.text);m.char.push({id:E,page:w.length-1,x:x/a,y:_/a,width:i,height:n,xoffset:0,yoffset:0,xadvance:s-(f.dropShadow?f.dropShadowDistance:0)-(f.stroke?f.strokeThickness:0)}),x+=(i+2*r)*a,x=Math.ceil(x)}for(let l=0,u=d.length;l<u;l++){const t=d[l];for(let e=0;e<u;e++){const s=d[e],n=y.measureText(t).width,i=y.measureText(s).width,r=y.measureText(t+s).width-(n+i);r&&m.kerning.push({first:Ap(t),second:Ap(s),amount:r})}}const E=new Mp(m,w,!0);return void 0!==Mp.available[t]&&Mp.uninstall(t),Mp.available[t]=E,E}};let Ip=Mp;Ip.ALPHA=[["a","z"],["A","Z"]," "],Ip.NUMERIC=[["0","9"]],Ip.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],Ip.ASCII=[[" ","~"]],Ip.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Mp.ALPHANUMERIC},Ip.available={};const Pp=[],Rp=[],kp=[],Dp=class extends Jc{constructor(t,e={}){super();const{align:s,tint:n,maxWidth:i,letterSpacing:r,fontName:a,fontSize:o}=Object.assign({},Dp.styleDefaults,e);if(!Ip.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=s,this._tintColor=new _o(n),this._font=void 0,this._fontName=a,this._fontSize=o,this.text=t,this._maxWidth=i,this._maxLineHeight=0,this._letterSpacing=r,this._anchor=new Nh((()=>{this.dirty=!0}),this,0,0),this._roundPixels=_r.ROUND_PIXELS,this.dirty=!0,this._resolution=_r.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var t;const e=Ip.available[this._fontName],s=this.fontSize,n=s/e.size,i=new _h,r=[],a=[],o=[],h=Cp(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),l=this._maxWidth*e.size/s,c="none"===e.distanceFieldType?Pp:Rp;let u=null,d=0,f=0,p=0,m=-1,g=0,y=0,v=0,x=0;for(let A=0;A<h.length;A++){const t=h[A],s=Ap(t);if(/(?:\s)/.test(t)&&(m=A,g=d,x++),"\r"===t||"\n"===t){a.push(d),o.push(-1),f=Math.max(f,d),++p,++y,i.x=0,i.y+=e.lineHeight,u=null,x=0;continue}const n=e.chars[s];if(!n)continue;u&&n.kerning[u]&&(i.x+=n.kerning[u]);const c=kp.pop()||{texture:Il.EMPTY,line:0,charCode:0,prevSpaces:0,position:new _h};c.texture=n.texture,c.line=p,c.charCode=s,c.position.x=Math.round(i.x+n.xOffset+this._letterSpacing/2),c.position.y=Math.round(i.y+n.yOffset),c.prevSpaces=x,r.push(c),d=c.position.x+Math.max(n.xAdvance-n.xOffset,n.texture.orig.width),i.x+=n.xAdvance+this._letterSpacing,v=Math.max(v,n.yOffset+n.texture.height),u=s,-1!==m&&l>0&&i.x>l&&(++y,Io(r,1+m-y,1+A-m),A=m,m=-1,a.push(g),o.push(r.length>0?r[r.length-1].prevSpaces:0),f=Math.max(f,g),p++,i.x=0,i.y+=e.lineHeight,u=null,x=0)}const _=h[h.length-1];"\r"!==_&&"\n"!==_&&(/(?:\s)/.test(_)&&(d=g),a.push(d),f=Math.max(f,d),o.push(-1));const b=[];for(let A=0;A<=p;A++){let t=0;"right"===this._align?t=f-a[A]:"center"===this._align?t=(f-a[A])/2:"justify"===this._align&&(t=o[A]<0?0:(f-a[A])/o[A]),b.push(t)}const w=r.length,E={},S=[],T=this._activePagesMeshData;c.push(...T);for(let A=0;A<w;A++){const t=r[A].texture,s=t.baseTexture.uid;if(!E[s]){let n=c.pop();if(!n){const t=new Df;let s,i;"none"===e.distanceFieldType?(s=new Ff(Il.EMPTY),i=ir.NORMAL):(s=new Ff(Il.EMPTY,{program:al.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n"),uniforms:{uFWidth:0}}),i=ir.NORMAL_NPM);const r=new kf(t,s);r.blendMode=i,n={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:r,vertices:null,uvs:null,indices:null}}n.index=0,n.indexCount=0,n.vertexCount=0,n.uvsCount=0,n.total=0;const{_textureCache:i}=this;i[s]=i[s]||new Il(t.baseTexture),n.mesh.texture=i[s],n.mesh.tint=this._tintColor.value,S.push(n),E[s]=n}E[s].total++}for(let A=0;A<T.length;A++)S.includes(T[A])||this.removeChild(T[A].mesh);for(let A=0;A<S.length;A++)S[A].mesh.parent!==this&&this.addChild(S[A].mesh);this._activePagesMeshData=S;for(const A in E){const e=E[A],s=e.total;if(!((null==(t=e.indices)?void 0:t.length)>6*s)||e.vertices.length<2*kf.BATCHABLE_SIZE)e.vertices=new Float32Array(8*s),e.uvs=new Float32Array(8*s),e.indices=new Uint16Array(6*s);else{const t=e.total,s=e.vertices;for(let e=4*t*2;e<s.length;e++)s[e]=0}e.mesh.size=6*s}for(let A=0;A<w;A++){const t=r[A];let e=t.position.x+b[t.line]*("justify"===this._align?t.prevSpaces:1);this._roundPixels&&(e=Math.round(e));const s=e*n,i=t.position.y*n,a=t.texture,o=E[a.baseTexture.uid],h=a.frame,l=a._uvs,c=o.index++;o.indices[6*c+0]=0+4*c,o.indices[6*c+1]=1+4*c,o.indices[6*c+2]=2+4*c,o.indices[6*c+3]=0+4*c,o.indices[6*c+4]=2+4*c,o.indices[6*c+5]=3+4*c,o.vertices[8*c+0]=s,o.vertices[8*c+1]=i,o.vertices[8*c+2]=s+h.width*n,o.vertices[8*c+3]=i,o.vertices[8*c+4]=s+h.width*n,o.vertices[8*c+5]=i+h.height*n,o.vertices[8*c+6]=s,o.vertices[8*c+7]=i+h.height*n,o.uvs[8*c+0]=l.x0,o.uvs[8*c+1]=l.y0,o.uvs[8*c+2]=l.x1,o.uvs[8*c+3]=l.y1,o.uvs[8*c+4]=l.x2,o.uvs[8*c+5]=l.y2,o.uvs[8*c+6]=l.x3,o.uvs[8*c+7]=l.y3}this._textWidth=f*n,this._textHeight=(i.y+e.lineHeight)*n;for(const A in E){const t=E[A];if(0!==this.anchor.x||0!==this.anchor.y){let e=0;const s=this._textWidth*this.anchor.x,n=this._textHeight*this.anchor.y;for(let i=0;i<t.total;i++)t.vertices[e++]-=s,t.vertices[e++]-=n,t.vertices[e++]-=s,t.vertices[e++]-=n,t.vertices[e++]-=s,t.vertices[e++]-=n,t.vertices[e++]-=s,t.vertices[e++]-=n}this._maxLineHeight=v*n;const e=t.mesh.geometry.getBuffer("aVertexPosition"),s=t.mesh.geometry.getBuffer("aTextureCoord"),i=t.mesh.geometry.getIndex();e.data=t.vertices,s.data=t.uvs,i.data=t.indices,e.update(),s.update(),i.update()}for(let A=0;A<r.length;A++)kp.push(r[A]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:s,size:n}=Ip.available[this._fontName];if("none"!==s){const{a:s,b:i,c:r,d:a}=this.worldTransform,o=Math.sqrt(s*s+i*i),h=Math.sqrt(r*r+a*a),l=(Math.abs(o)+Math.abs(h))/2,c=this.fontSize/n,u=t._view.resolution;for(const t of this._activePagesMeshData)t.mesh.shader.uniforms.uFWidth=l*e*c*u}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=Ip.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!Ip.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){var t;return null!=(t=this._fontSize)?t:Ip.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,s="none"===Ip.available[this._fontName].distanceFieldType?Pp:Rp;s.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],s.filter((t=>e[t.mesh.texture.baseTexture.uid])).forEach((t=>{t.mesh.texture=Il.EMPTY}));for(const n in e){e[n].destroy(),delete e[n]}this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};Dp.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const Fp=[".xml",".fnt"],Op={extension:{type:Wo.LoadParser,priority:Vu.Normal},name:"loadBitmapFont",test:t=>Fp.includes(Va.extname(t).toLowerCase()),testParse(t){return f(this,null,(function*(){return bp.test(t)||Ep.test(t)}))},parse(t,e,s){return f(this,null,(function*(){const n=bp.test(t)?bp.parse(t):Ep.parse(t),{src:i}=e,{page:r}=n,a=[];for(let t=0;t<r.length;++t){const e=r[t].file;let s=Va.join(Va.dirname(i),e);s=Du(s,i),a.push(s)}const o=yield s.load(a),h=a.map((t=>o[t]));return Ip.install(n,h,!0)}))},load(t,e){return f(this,null,(function*(){return(yield _r.ADAPTER.fetch(t)).text()}))},unload(t){t.destroy()}};Go.add(Op);const Np=class extends jf{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new Np(Object.keys(Np.defaultOptions).reduce(((e,s)=>c(l({},e),{[s]:t[s]})),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach((t=>{URL.revokeObjectURL(t.src),t.refs--,0===t.refs&&(t.fontFace&&document.fonts.delete(t.fontFace),delete Np.availableFonts[t.originalUrl])})),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:s}=Np;if(s[t]){const e=s[t];return this._fonts.push(e),e.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return _r.ADAPTER.fetch(t).then((t=>t.blob())).then((t=>f(this,null,(function*(){return new Promise(((e,s)=>{const n=URL.createObjectURL(t),i=new FileReader;i.onload=()=>e([n,i.result]),i.onerror=s,i.readAsDataURL(t)}))})))).then((n=>f(this,[n],(function*([n,i]){const r=Object.assign({family:Va.basename(t,Va.extname(t)),weight:"normal",style:"normal",src:n,dataSrc:i,refs:1,originalUrl:t,fontFace:null},e);s[t]=r,this._fonts.push(r),this.styleID++;const a=new FontFace(r.family,`url(${r.src})`,{weight:r.weight,style:r.style});r.fontFace=a,yield a.load(),document.fonts.add(a),yield document.fonts.ready,this.styleID++,this.fontsDirty=!0}))))}addOverride(...t){const e=t.filter((t=>!this._overrides.includes(t)));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter((t=>this._overrides.includes(t)));e.length>0&&(this._overrides=this._overrides.filter((t=>!e.includes(t))),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?["word-wrap: "+(this.breakWords?"break-all":"break-word"),`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce(((t,e)=>`${t}\n            @font-face {\n                font-family: "${e.family}";\n                src: url('${e.dataSrc}');\n                font-weight: ${e.weight};\n                font-style: ${e.style}; \n            }`),this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=wo(t)),"number"==typeof t?(e=t,Ua("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),_o.shared.setValue(e).toHex()):t;var e}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,s=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),n=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(255*e|0).toString(16).padStart(2,"0"));const i=`${s}px ${n}px`;return this.dropShadowBlur>0?`text-shadow: ${i} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${i} ${t}`}reset(){Object.assign(this,Np.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise((t=>setTimeout(t,100))):Promise.resolve()}get isSafari(){const{userAgent:t}=_r.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};let Bp=Np;Bp.availableFonts={},Bp.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};const Lp=class extends su{constructor(t="",e={}){var s;super(Il.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1,this.ownsStyle=!1;const n=new Image,i=Il.from(n,{scaleMode:_r.SCALE_MODE,resourceOptions:{autoLoad:!1}});i.orig=new wh,i.trim=new wh,this.texture=i;const r="http://www.w3.org/2000/svg",a="http://www.w3.org/1999/xhtml",o=document.createElementNS(r,"svg"),h=document.createElementNS(r,"foreignObject"),l=document.createElementNS(a,"div"),c=document.createElementNS(a,"style");h.setAttribute("width","10000"),h.setAttribute("height","10000"),h.style.overflow="hidden",o.appendChild(h),this.maxWidth=Lp.defaultMaxWidth,this.maxHeight=Lp.defaultMaxHeight,this._domElement=l,this._styleElement=c,this._svgRoot=o,this._foreignObject=h,this._foreignObject.appendChild(c),this._foreignObject.appendChild(l),this._image=n,this._loadImage=new Image,this._autoResolution=Lp.defaultAutoResolution,this._resolution=null!=(s=Lp.defaultResolution)?s:_r.RESOLUTION,this.text=t,this.style=e}measureText(t){var e,s;const{text:n,style:i,resolution:r}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:n,style:i.toCSS(r)}),this._styleElement.textContent=i.toGlobalCSS(),document.body.appendChild(this._svgRoot);const a=this._domElement.getBoundingClientRect();this._svgRoot.remove();const o=Math.min(this.maxWidth,Math.ceil(a.width)),h=Math.min(this.maxHeight,Math.ceil(a.height));return this._svgRoot.setAttribute("width",o.toString()),this._svgRoot.setAttribute("height",h.toString()),n!==this._text&&(this._domElement.innerHTML=this._text),i!==this._style&&(Object.assign(this._domElement,{style:null==(e=this._style)?void 0:e.toCSS(r)}),this._styleElement.textContent=null==(s=this._style)?void 0:s.toGlobalCSS()),{width:o+2*i.padding,height:h+2*i.padding}}updateText(t=!0){return f(this,null,(function*(){const{style:e,_image:s,_loadImage:n}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:i,height:r}=this.measureText();s.width=n.width=Math.ceil(Math.max(1,i)),s.height=n.height=Math.ceil(Math.max(1,r)),this._loading||(this._loading=!0,yield new Promise((t=>{n.onload=()=>f(this,null,(function*(){yield e.onBeforeDraw(),this._loading=!1,s.src=n.src,n.onload=null,n.src="",this.updateTexture(),t()}));const i=(new XMLSerializer).serializeToString(this._svgRoot);n.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(i)}`})))}))}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:s,resolution:n}=this,{padding:i}=t,{baseTexture:r}=e;e.trim.width=e._frame.width=s.width/n,e.trim.height=e._frame.height=s.height/n,e.trim.x=-i,e.trim.y=-i,e.orig.width=e._frame.width-2*i,e.orig.height=e._frame.height-2*i,this._onTextureUpdate(),r.setRealSize(s.width,s.height,n),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){var e,s,n,i,r;"boolean"==typeof t&&(t={children:t}),t=Object.assign({},Lp.defaultDestroyOptions,t),super.destroy(t);const a=null;this.ownsStyle&&(null==(e=this._style)||e.cleanFonts()),this._style=a,null==(s=this._svgRoot)||s.remove(),this._svgRoot=a,null==(n=this._domElement)||n.remove(),this._domElement=a,null==(i=this._foreignObject)||i.remove(),this._foreignObject=a,null==(r=this._styleElement)||r.remove(),this._styleElement=a,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=a,this._image.src="",this._image=a}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=Po(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=Po(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&((t=t||{})instanceof Bp?(this.ownsStyle=!1,this._style=t):t instanceof jf?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=Bp.from(t)):(this.ownsStyle=!0,this._style=new Bp(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(""===t||null==t?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};let Vp=Lp;Vp.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Vp.defaultMaxWidth=2024,Vp.defaultMaxHeight=2024,Vp.defaultAutoResolution=!0;let $p=class extends gl{constructor(t=4,e=3,s=!1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",s?"\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec2 uOffset;\nuniform vec4 filterClamp;\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n\n    // Sample top left pixel\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y), filterClamp.xy, filterClamp.zw));\n\n    // Sample top right pixel\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y), filterClamp.xy, filterClamp.zw));\n\n    // Sample bottom right pixel\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y), filterClamp.xy, filterClamp.zw));\n\n    // Sample bottom left pixel\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y), filterClamp.xy, filterClamp.zw));\n\n    // Average\n    color *= 0.25;\n\n    gl_FragColor = color;\n}\n":"\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec2 uOffset;\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n\n    // Sample top left pixel\n    color += texture2D(uSampler, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y));\n\n    // Sample top right pixel\n    color += texture2D(uSampler, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y));\n\n    // Sample bottom right pixel\n    color += texture2D(uSampler, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y));\n\n    // Sample bottom left pixel\n    color += texture2D(uSampler, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y));\n\n    // Average\n    color *= 0.25;\n\n    gl_FragColor = color;\n}"),this._kernels=[],this._blur=4,this._quality=3,this.uniforms.uOffset=new Float32Array(2),this._pixelSize=new _h,this.pixelSize=1,this._clamp=s,Array.isArray(t)?this.kernels=t:(this._blur=t,this.quality=e)}apply(t,e,s,n){const i=this._pixelSize.x/e._frame.width,r=this._pixelSize.y/e._frame.height;let a;if(1===this._quality||0===this._blur)a=this._kernels[0]+.5,this.uniforms.uOffset[0]=a*i,this.uniforms.uOffset[1]=a*r,t.applyFilter(this,e,s,n);else{const o=t.getFilterTexture();let h,l=e,c=o;const u=this._quality-1;for(let e=0;e<u;e++)a=this._kernels[e]+.5,this.uniforms.uOffset[0]=a*i,this.uniforms.uOffset[1]=a*r,t.applyFilter(this,l,c,1),h=l,l=c,c=h;a=this._kernels[u]+.5,this.uniforms.uOffset[0]=a*i,this.uniforms.uOffset[1]=a*r,t.applyFilter(this,l,s,n),t.returnFilterTexture(o)}}_updatePadding(){this.padding=Math.ceil(this._kernels.reduce(((t,e)=>t+e+.5),0))}_generateKernels(){const t=this._blur,e=this._quality,s=[t];if(t>0){let n=t;const i=t/e;for(let t=1;t<e;t++)n-=i,s.push(n)}this._kernels=s,this._updatePadding()}get kernels(){return this._kernels}set kernels(t){Array.isArray(t)&&t.length>0?(this._kernels=t,this._quality=t.length,this._blur=Math.max(...t)):(this._kernels=[0],this._quality=1)}get clamp(){return this._clamp}set pixelSize(t){"number"==typeof t?(this._pixelSize.x=t,this._pixelSize.y=t):Array.isArray(t)?(this._pixelSize.x=t[0],this._pixelSize.y=t[1]):t instanceof _h?(this._pixelSize.x=t.x,this._pixelSize.y=t.y):(this._pixelSize.x=1,this._pixelSize.y=1)}get pixelSize(){return this._pixelSize}get quality(){return this._quality}set quality(t){this._quality=Math.max(1,Math.round(t)),this._generateKernels()}get blur(){return this._blur}set blur(t){this._blur=t,this._generateKernels()}};var Up="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}";let Xp=class extends gl{constructor(t=.5){super(Up,"\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform float threshold;\n\nvoid main() {\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    // A simple & fast algorithm for getting brightness.\n    // It's inaccuracy , but good enought for this feature.\n    float _max = max(max(color.r, color.g), color.b);\n    float _min = min(min(color.r, color.g), color.b);\n    float brightness = (_max + _min) * 0.5;\n\n    if(brightness > threshold) {\n        gl_FragColor = color;\n    } else {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n}\n"),this.threshold=t}get threshold(){return this.uniforms.threshold}set threshold(t){this.uniforms.threshold=t}};const Yp=class extends gl{constructor(t){super(Up,"uniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D bloomTexture;\nuniform float bloomScale;\nuniform float brightness;\n\nvoid main() {\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    color.rgb *= brightness;\n    vec4 bloomColor = vec4(texture2D(bloomTexture, vTextureCoord).rgb, 0.0);\n    bloomColor.rgb *= bloomScale;\n    gl_FragColor = color + bloomColor;\n}\n"),this.bloomScale=1,this.brightness=1,this._resolution=_r.FILTER_RESOLUTION,"number"==typeof t&&(t={threshold:t});const e=Object.assign(Yp.defaults,t);this.bloomScale=e.bloomScale,this.brightness=e.brightness;const{kernels:s,blur:n,quality:i,pixelSize:r,resolution:a}=e;this._extractFilter=new Xp(e.threshold),this._extractFilter.resolution=a,this._blurFilter=s?new $p(s):new $p(n,i),this.pixelSize=r,this.resolution=a}apply(t,e,s,n,i){const r=t.getFilterTexture();this._extractFilter.apply(t,e,r,1,i);const a=t.getFilterTexture();this._blurFilter.apply(t,r,a,1),this.uniforms.bloomScale=this.bloomScale,this.uniforms.brightness=this.brightness,this.uniforms.bloomTexture=a,t.applyFilter(this,e,s,n),t.returnFilterTexture(a),t.returnFilterTexture(r)}get resolution(){return this._resolution}set resolution(t){this._resolution=t,this._extractFilter&&(this._extractFilter.resolution=t),this._blurFilter&&(this._blurFilter.resolution=t)}get threshold(){return this._extractFilter.threshold}set threshold(t){this._extractFilter.threshold=t}get kernels(){return this._blurFilter.kernels}set kernels(t){this._blurFilter.kernels=t}get blur(){return this._blurFilter.blur}set blur(t){this._blurFilter.blur=t}get quality(){return this._blurFilter.quality}set quality(t){this._blurFilter.quality=t}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(t){this._blurFilter.pixelSize=t}};Yp.defaults={threshold:.5,bloomScale:1,brightness:1,kernels:null,blur:8,quality:4,pixelSize:1,resolution:_r.FILTER_RESOLUTION};const Wp=class extends gl{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","uniform float radius;\nuniform float strength;\nuniform vec2 center;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\nuniform vec2 dimensions;\n\nvoid main()\n{\n    vec2 coord = vTextureCoord * filterArea.xy;\n    coord -= center * dimensions.xy;\n    float distance = length(coord);\n    if (distance < radius) {\n        float percent = distance / radius;\n        if (strength > 0.0) {\n            coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);\n        } else {\n            coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);\n        }\n    }\n    coord += center * dimensions.xy;\n    coord /= filterArea.xy;\n    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);\n    vec4 color = texture2D(uSampler, clampedCoord);\n    if (coord != clampedCoord) {\n        color *= max(0.0, 1.0 - length(coord - clampedCoord));\n    }\n\n    gl_FragColor = color;\n}\n"),this.uniforms.dimensions=new Float32Array(2),Object.assign(this,Wp.defaults,t)}apply(t,e,s,n){const{width:i,height:r}=e.filterFrame;this.uniforms.dimensions[0]=i,this.uniforms.dimensions[1]=r,t.applyFilter(this,e,s,n)}get radius(){return this.uniforms.radius}set radius(t){this.uniforms.radius=t}get strength(){return this.uniforms.strength}set strength(t){this.uniforms.strength=t}get center(){return this.uniforms.center}set center(t){this.uniforms.center=t}};Wp.defaults={center:[.5,.5],radius:100,strength:1};var jp,zp;(zp=zp||{}).stringify=(jp={"visit_linear-gradient":function(t){return jp.visit_gradient(t)},"visit_repeating-linear-gradient":function(t){return jp.visit_gradient(t)},"visit_radial-gradient":function(t){return jp.visit_gradient(t)},"visit_repeating-radial-gradient":function(t){return jp.visit_gradient(t)},visit_gradient:function(t){var e=jp.visit(t.orientation);return e&&(e+=", "),t.type+"("+e+jp.visit(t.colorStops)+")"},visit_shape:function(t){var e=t.value,s=jp.visit(t.at),n=jp.visit(t.style);return n&&(e+=" "+n),s&&(e+=" at "+s),e},"visit_default-radial":function(t){var e="",s=jp.visit(t.at);return s&&(e+=s),e},"visit_extent-keyword":function(t){var e=t.value,s=jp.visit(t.at);return s&&(e+=" at "+s),e},"visit_position-keyword":function(t){return t.value},visit_position:function(t){return jp.visit(t.value.x)+" "+jp.visit(t.value.y)},"visit_%":function(t){return t.value+"%"},visit_em:function(t){return t.value+"em"},visit_px:function(t){return t.value+"px"},visit_literal:function(t){return jp.visit_color(t.value,t)},visit_hex:function(t){return jp.visit_color("#"+t.value,t)},visit_rgb:function(t){return jp.visit_color("rgb("+t.value.join(", ")+")",t)},visit_rgba:function(t){return jp.visit_color("rgba("+t.value.join(", ")+")",t)},visit_color:function(t,e){var s=t,n=jp.visit(e.length);return n&&(s+=" "+n),s},visit_angular:function(t){return t.value+"deg"},visit_directional:function(t){return"to "+t.value},visit_array:function(t){var e="",s=t.length;return t.forEach((function(t,n){e+=jp.visit(t),n<s-1&&(e+=", ")})),e},visit:function(t){if(!t)return"";if(t instanceof Array)return jp.visit_array(t,"");if(t.type){var e=jp["visit_"+t.type];if(e)return e(t);throw Error("Missing visitor visit_"+t.type)}throw Error("Invalid node.")}},function(t){return jp.visit(t)}),(zp=zp||{}).parse=function(){var t={linearGradient:/^(\-(webkit|o|ms|moz)\-)?(linear\-gradient)/i,repeatingLinearGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-linear\-gradient)/i,radialGradient:/^(\-(webkit|o|ms|moz)\-)?(radial\-gradient)/i,repeatingRadialGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-radial\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/^\#([0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^rgb/i,rgbaColor:/^rgba/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/},e="";function s(t){var s=new Error(e+": "+t);throw s.source=e,s}function n(){var t=f(i);return e.length>0&&s("Invalid input not EOF"),t}function i(){return r("linear-gradient",t.linearGradient,o)||r("repeating-linear-gradient",t.repeatingLinearGradient,o)||r("radial-gradient",t.radialGradient,h)||r("repeating-radial-gradient",t.repeatingRadialGradient,h)}function r(e,n,i){return a(n,(function(n){var r=i();return r&&(x(t.comma)||s("Missing comma before color stops")),{type:e,orientation:r,colorStops:f(p)}}))}function a(e,n){var i=x(e);if(i){x(t.startCall)||s("Missing (");var r=n(i);return x(t.endCall)||s("Missing )"),r}}function o(){return v("directional",t.sideOrCorner,1)||v("angular",t.angleValue,1)}function h(){var s,n,i=l();return i&&((s=[]).push(i),n=e,x(t.comma)&&((i=l())?s.push(i):e=n)),s}function l(){var t=function(){var t=v("shape",/^(circle)/i,0);return t&&(t.style=y()||c()),t}()||function(){var t=v("shape",/^(ellipse)/i,0);return t&&(t.style=g()||c()),t}();if(t)t.at=u();else{var e=c();if(e){t=e;var s=u();s&&(t.at=s)}else{var n=d();n&&(t={type:"default-radial",at:n})}}return t}function c(){return v("extent-keyword",t.extentKeywords,1)}function u(){if(v("position",/^at/,0)){var t=d();return t||s("Missing positioning value"),t}}function d(){var t={x:g(),y:g()};if(t.x||t.y)return{type:"position",value:t}}function f(e){var n=e(),i=[];if(n)for(i.push(n);x(t.comma);)(n=e())?i.push(n):s("One extra comma");return i}function p(){var e=v("hex",t.hexColor,1)||a(t.rgbaColor,(function(){return{type:"rgba",value:f(m)}}))||a(t.rgbColor,(function(){return{type:"rgb",value:f(m)}}))||v("literal",t.literalColor,0);return e||s("Expected color definition"),e.length=g(),e}function m(){return x(t.number)[1]}function g(){return v("%",t.percentageValue,1)||v("position-keyword",t.positionKeywords,1)||y()}function y(){return v("px",t.pixelValue,1)||v("em",t.emValue,1)}function v(t,e,s){var n=x(e);if(n)return{type:t,value:n[s]}}function x(t){var s,n;return(n=/^[\n\r\t\s]+/.exec(e))&&_(n[0].length),(s=t.exec(e))&&_(s[0].length),s}function _(t){e=e.substr(t)}return function(t){return e=t.toString(),n()}}();var Gp=zp.parse;zp.stringify;var Hp={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},qp={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};var Kp={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]},Zp={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(t){var e,s,n,i,r,a=t[0]/360,o=t[1]/100,h=t[2]/100;if(0===o)return[r=255*h,r,r];e=2*h-(s=h<.5?h*(1+o):h+o-h*o),i=[0,0,0];for(var l=0;l<3;l++)(n=a+1/3*-(l-1))<0?n++:n>1&&n--,r=6*n<1?e+6*(s-e)*n:2*n<1?s:3*n<2?e+(s-e)*(2/3-n)*6:e,i[l]=255*r;return i}};function Qp(t){Array.isArray(t)&&t.raw&&(t=String.raw(...arguments));var e,s=function(t){var e,s,n=[],i=1;if("string"==typeof t)if(Hp[t])n=Hp[t].slice(),s="rgb";else if("transparent"===t)i=0,s="rgb",n=[0,0,0];else if(/^#[A-Fa-f0-9]+$/.test(t)){var r=t.slice(1);i=1,(h=r.length)<=4?(n=[parseInt(r[0]+r[0],16),parseInt(r[1]+r[1],16),parseInt(r[2]+r[2],16)],4===h&&(i=parseInt(r[3]+r[3],16)/255)):(n=[parseInt(r[0]+r[1],16),parseInt(r[2]+r[3],16),parseInt(r[4]+r[5],16)],8===h&&(i=parseInt(r[6]+r[7],16)/255)),n[0]||(n[0]=0),n[1]||(n[1]=0),n[2]||(n[2]=0),s="rgb"}else if(e=/^((?:rgb|hs[lvb]|hwb|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms)a?)\s*\(([^\)]*)\)/.exec(t)){var a=e[1],o="rgb"===a;s=r=a.replace(/a$/,"");var h="cmyk"===r?4:"gray"===r?1:3;n=e[2].trim().split(/\s*[,\/]\s*|\s+/).map((function(t,e){if(/%$/.test(t))return e===h?parseFloat(t)/100:"rgb"===r?255*parseFloat(t)/100:parseFloat(t);if("h"===r[e]){if(/deg$/.test(t))return parseFloat(t);if(void 0!==qp[t])return qp[t]}return parseFloat(t)})),a===r&&n.push(1),i=o||void 0===n[h]?1:n[h],n=n.slice(0,h)}else t.length>10&&/[0-9](?:\s|\/)/.test(t)&&(n=t.match(/([0-9]+)/g).map((function(t){return parseFloat(t)})),s=t.match(/([a-z])/gi).join("").toLowerCase());else isNaN(t)?Array.isArray(t)||t.length?(n=[t[0],t[1],t[2]],s="rgb",i=4===t.length?t[3]:1):t instanceof Object&&(null!=t.r||null!=t.red||null!=t.R?(s="rgb",n=[t.r||t.red||t.R||0,t.g||t.green||t.G||0,t.b||t.blue||t.B||0]):(s="hsl",n=[t.h||t.hue||t.H||0,t.s||t.saturation||t.S||0,t.l||t.lightness||t.L||t.b||t.brightness]),i=t.a||t.alpha||t.opacity||1,null!=t.opacity&&(i/=100)):(s="rgb",n=[t>>>16,(65280&t)>>>8,255&t]);return{space:s,values:n,alpha:i}}(t);if(!s.space)return[];const n="h"===s.space[0]?Zp.min:Kp.min,i="h"===s.space[0]?Zp.max:Kp.max;return(e=Array(3))[0]=Math.min(Math.max(s.values[0],n[0]),i[0]),e[1]=Math.min(Math.max(s.values[1],n[1]),i[1]),e[2]=Math.min(Math.max(s.values[2],n[2]),i[2]),"h"===s.space[0]&&(e=Zp.rgb(e)),e.push(Math.min(Math.max(s.alpha,0),1)),e}function Jp(t){switch(typeof t){case"string":return function(t){const e=Qp(t);if(!e)throw new Error(`Unable to parse color "${t}" as RGBA.`);return[e[0]/255,e[1]/255,e[2]/255,e[3]]}(t);case"number":return bo(t);default:return t}}function tm(t){const e=Gp(function(t){let e=t.replace(/\s{2,}/gu," ");return e=e.replace(/;/g,""),e=e.replace(/ ,/g,","),e=e.replace(/\( /g,"("),e=e.replace(/ \)/g,")"),e.trim()}(t));if(0===e.length)throw new Error("Invalid CSS gradient.");if(1!==e.length)throw new Error("Unsupported CSS gradient (multiple gradients is not supported).");const s=e[0],n=function(t){const e={"linear-gradient":0,"radial-gradient":1};if(!(t in e))throw new Error(`Unsupported gradient type "${t}"`);return e[t]}(s.type),i=function(t){const e=function(t){const e=[];for(let i=0;i<t.length;i++){const s=t[i];let n=-1;"literal"===s.type&&s.length&&"type"in s.length&&"%"===s.length.type&&"value"in s.length&&(n=parseFloat(s.length.value)/100),e.push(n)}const s=t=>{for(let s=t;s<e.length;s++)if(-1!==e[s])return{indexDelta:s-t,offset:e[s]};return{indexDelta:e.length-1-t,offset:1}};let n=0;for(let i=0;i<e.length;i++){const t=e[i];if(-1!==t)n=t;else if(0===i)e[i]=0;else if(i+1===e.length)e[i]=1;else{const t=s(i),r=(t.offset-n)/(1+t.indexDelta);for(let s=0;s<=t.indexDelta;s++)e[i+s]=n+(s+1)*r;i+=t.indexDelta,n=e[i]}}return e.map(sm)}(t),s=[];for(let n=0;n<t.length;n++){const i=em(t[n]);s.push({offset:e[n],color:i.slice(0,3),alpha:i[3]})}return s}(s.colorStops),r=function(t){if(void 0===t)return 0;if("type"in t&&"value"in t)switch(t.type){case"angular":return parseFloat(t.value);case"directional":return function(t){const e={left:270,top:0,bottom:180,right:90,"left top":315,"top left":315,"left bottom":225,"bottom left":225,"right top":45,"top right":45,"right bottom":135,"bottom right":135};if(!(t in e))throw new Error(`Unsupported directional value "${t}"`);return e[t]}(t.value)}return 0}(s.orientation);return{type:n,stops:i,angle:r}}function em(t){return Jp(function(t){switch(t.type){case"hex":return`#${t.value}`;case"literal":return t.value;default:return`${t.type}(${t.value.join(",")})`}}(t))}function sm(t){return t.toString().length>6?parseFloat(t.toString().substring(0,6)):t}Kp.hsl=function(t){var e,s,n=t[0]/255,i=t[1]/255,r=t[2]/255,a=Math.min(n,i,r),o=Math.max(n,i,r),h=o-a;return o===a?e=0:n===o?e=(i-r)/h:i===o?e=2+(r-n)/h:r===o&&(e=4+(n-i)/h),(e=Math.min(60*e,360))<0&&(e+=360),s=(a+o)/2,[e,100*(o===a?0:s<=.5?h/(o+a):h/(2-o-a)),100*s]};var nm=Object.defineProperty,im=Object.defineProperties,rm=Object.getOwnPropertyDescriptors,am=Object.getOwnPropertySymbols,om=Object.prototype.hasOwnProperty,hm=Object.prototype.propertyIsEnumerable,lm=(t,e,s)=>e in t?nm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,cm=(t,e)=>{for(var s in e||(e={}))om.call(e,s)&&lm(t,s,e[s]);if(am)for(var s of am(e))hm.call(e,s)&&lm(t,s,e[s]);return t};const um=class extends gl{constructor(t){t&&"css"in t&&(t=((t,e)=>im(t,rm(e)))(cm({},tm(t.css||"")),{alpha:t.alpha,maxColors:t.maxColors}));const e=cm(cm({},um.defaults),t);if(!e.stops||e.stops.length<2)throw new Error("ColorGradientFilter requires at least 2 color stops.");super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n    vFilterCoord = vTextureCoord * inputSize.xy / outputFrame.zw;\n}\n","const float PI = 3.1415926538;\nconst float PI_2 = PI*2.;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\nuniform sampler2D uSampler;\n\nconst int TYPE_LINEAR = 0;\nconst int TYPE_RADIAL = 1;\nconst int TYPE_CONIC = 2;\nconst int MAX_STOPS = 32;\n\nuniform int uNumStops;\nuniform float uAlphas[3*MAX_STOPS];\nuniform vec3 uColors[MAX_STOPS];\nuniform float uOffsets[MAX_STOPS];\nuniform int uType;\nuniform float uAngle;\nuniform float uAlpha;\nuniform int uMaxColors;\n\nstruct ColorStop {\n    float offset;\n    vec3 color;\n    float alpha;\n};\n\nmat2 rotate2d(float angle){\n    return mat2(cos(angle), -sin(angle),\n    sin(angle), cos(angle));\n}\n\nfloat projectLinearPosition(vec2 pos, float angle){\n    vec2 center = vec2(0.5);\n    vec2 result = pos - center;\n    result = rotate2d(angle) * result;\n    result = result + center;\n    return clamp(result.x, 0., 1.);\n}\n\nfloat projectRadialPosition(vec2 pos) {\n    float r = distance(vFilterCoord, vec2(0.5));\n    return clamp(2.*r, 0., 1.);\n}\n\nfloat projectAnglePosition(vec2 pos, float angle) {\n    vec2 center = pos - vec2(0.5);\n    float polarAngle=atan(-center.y, center.x);\n    return mod(polarAngle + angle, PI_2) / PI_2;\n}\n\nfloat projectPosition(vec2 pos, int type, float angle) {\n    if (type == TYPE_LINEAR) {\n        return projectLinearPosition(pos, angle);\n    } else if (type == TYPE_RADIAL) {\n        return projectRadialPosition(pos);\n    } else if (type == TYPE_CONIC) {\n        return projectAnglePosition(pos, angle);\n    }\n\n    return pos.y;\n}\n\nvoid main(void) {\n    // current/original color\n    vec4 currentColor = texture2D(uSampler, vTextureCoord);\n\n    // skip calculations if gradient alpha is 0\n    if (0.0 == uAlpha) {\n        gl_FragColor = currentColor;\n        return;\n    }\n\n    // project position\n    float y = projectPosition(vFilterCoord, uType, radians(uAngle));\n\n    // check gradient bounds\n    float offsetMin = uOffsets[0];\n    float offsetMax = 0.0;\n\n    for (int i = 0; i < MAX_STOPS; i++) {\n        if (i == uNumStops-1){ // last index\n            offsetMax = uOffsets[i];\n        }\n    }\n\n    if (y  < offsetMin || y > offsetMax) {\n        gl_FragColor = currentColor;\n        return;\n    }\n\n    // limit colors\n    if (uMaxColors > 0) {\n        float stepSize = 1./float(uMaxColors);\n        float stepNumber = float(floor(y/stepSize));\n        y = stepSize * (stepNumber + 0.5);// offset by 0.5 to use color from middle of segment\n    }\n\n    // find color stops\n    ColorStop from;\n    ColorStop to;\n\n    for (int i = 0; i < MAX_STOPS; i++) {\n        if (y >= uOffsets[i]) {\n            from = ColorStop(uOffsets[i], uColors[i], uAlphas[i]);\n            to = ColorStop(uOffsets[i+1], uColors[i+1], uAlphas[i+1]);\n        }\n\n        if (i == uNumStops-1){ // last index\n            break;\n        }\n    }\n\n    // mix colors from stops\n    vec4 colorFrom = vec4(from.color * from.alpha, from.alpha);\n    vec4 colorTo = vec4(to.color * to.alpha, to.alpha);\n\n    float segmentHeight = to.offset - from.offset;\n    float relativePos = y - from.offset;// position from 0 to [segmentHeight]\n    float relativePercent = relativePos / segmentHeight;// position in percent between [from.offset] and [to.offset].\n\n    float gradientAlpha = uAlpha * currentColor.a;\n    vec4 gradientColor = mix(colorFrom, colorTo, relativePercent) * gradientAlpha;\n\n    // mix resulting color with current color\n    gl_FragColor = gradientColor + currentColor*(1.-gradientColor.a);\n}\n"),this._stops=[],this.autoFit=!1,Object.assign(this,e)}get stops(){return this._stops}set stops(t){const e=function(t){return[...t].sort(((t,e)=>t.offset-e.offset))}(t),s=new Float32Array(3*e.length);for(let n=0;n<e.length;n++){const t=Jp(e[n].color),i=3*n;s[i+0]=t[0],s[i+1]=t[1],s[i+2]=t[2]}this.uniforms.uColors=s,this.uniforms.uOffsets=e.map((t=>t.offset)),this.uniforms.uAlphas=e.map((t=>t.alpha)),this.uniforms.uNumStops=e.length,this._stops=e}set type(t){this.uniforms.uType=t}get type(){return this.uniforms.uType}set angle(t){this.uniforms.uAngle=t-90}get angle(){return this.uniforms.uAngle+90}set alpha(t){this.uniforms.uAlpha=t}get alpha(){return this.uniforms.uAlpha}set maxColors(t){this.uniforms.uMaxColors=t}get maxColors(){return this.uniforms.uMaxColors}};let dm=um;dm.LINEAR=0,dm.RADIAL=1,dm.CONIC=2,dm.defaults={type:um.LINEAR,stops:[{offset:0,color:16711680,alpha:1},{offset:1,color:255,alpha:1}],alpha:1,angle:90,maxColors:0};let fm=class extends gl{constructor(t=0,e=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec3 color;\nuniform float alpha;\n\nvoid main(void) {\n    vec4 currentColor = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = vec4(mix(currentColor.rgb, color.rgb, currentColor.a * alpha), currentColor.a);\n}\n"),this._color=0,this._alpha=1,this.uniforms.color=new Float32Array(3),this.color=t,this.alpha=e}set color(t){const e=this.uniforms.color;"number"==typeof t?(bo(t,e),this._color=t):(e[0]=t[0],e[1]=t[1],e[2]=t[2],this._color=wo(e))}get color(){return this._color}set alpha(t){this.uniforms.alpha=t,this._alpha=t}get alpha(){return this._alpha}};const pm=class extends gl{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nconst float SQRT_2 = 1.414213;\n\nconst float light = 1.0;\n\nuniform float curvature;\nuniform float lineWidth;\nuniform float lineContrast;\nuniform bool verticalLine;\nuniform float noise;\nuniform float noiseSize;\n\nuniform float vignetting;\nuniform float vignettingAlpha;\nuniform float vignettingBlur;\n\nuniform float seed;\nuniform float time;\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main(void)\n{\n    vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;\n    vec2 dir = vec2(vTextureCoord.xy * filterArea.xy / dimensions - vec2(0.5, 0.5));\n    \n    gl_FragColor = texture2D(uSampler, vTextureCoord);\n    vec3 rgb = gl_FragColor.rgb;\n\n    if (noise > 0.0 && noiseSize > 0.0)\n    {\n        pixelCoord.x = floor(pixelCoord.x / noiseSize);\n        pixelCoord.y = floor(pixelCoord.y / noiseSize);\n        float _noise = rand(pixelCoord * noiseSize * seed) - 0.5;\n        rgb += _noise * noise;\n    }\n\n    if (lineWidth > 0.0)\n    {\n        float _c = curvature > 0. ? curvature : 1.;\n        float k = curvature > 0. ?(length(dir * dir) * 0.25 * _c * _c + 0.935 * _c) : 1.;\n        vec2 uv = dir * k;\n\n        float v = (verticalLine ? uv.x * dimensions.x : uv.y * dimensions.y) * min(1.0, 2.0 / lineWidth ) / _c;\n        float j = 1. + cos(v * 1.2 - time) * 0.5 * lineContrast;\n        rgb *= j;\n        float segment = verticalLine ? mod((dir.x + .5) * dimensions.x, 4.) : mod((dir.y + .5) * dimensions.y, 4.);\n        rgb *= 0.99 + ceil(segment) * 0.015;\n    }\n\n    if (vignetting > 0.0)\n    {\n        float outter = SQRT_2 - vignetting * SQRT_2;\n        float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + vignettingBlur * SQRT_2), 0.0, 1.0);\n        rgb *= darker + (1.0 - darker) * (1.0 - vignettingAlpha);\n    }\n\n    gl_FragColor.rgb = rgb;\n}\n"),this.time=0,this.seed=0,this.uniforms.dimensions=new Float32Array(2),Object.assign(this,pm.defaults,t)}apply(t,e,s,n){const{width:i,height:r}=e.filterFrame;this.uniforms.dimensions[0]=i,this.uniforms.dimensions[1]=r,this.uniforms.seed=this.seed,this.uniforms.time=this.time,t.applyFilter(this,e,s,n)}set curvature(t){this.uniforms.curvature=t}get curvature(){return this.uniforms.curvature}set lineWidth(t){this.uniforms.lineWidth=t}get lineWidth(){return this.uniforms.lineWidth}set lineContrast(t){this.uniforms.lineContrast=t}get lineContrast(){return this.uniforms.lineContrast}set verticalLine(t){this.uniforms.verticalLine=t}get verticalLine(){return this.uniforms.verticalLine}set noise(t){this.uniforms.noise=t}get noise(){return this.uniforms.noise}set noiseSize(t){this.uniforms.noiseSize=t}get noiseSize(){return this.uniforms.noiseSize}set vignetting(t){this.uniforms.vignetting=t}get vignetting(){return this.uniforms.vignetting}set vignettingAlpha(t){this.uniforms.vignettingAlpha=t}get vignettingAlpha(){return this.uniforms.vignettingAlpha}set vignettingBlur(t){this.uniforms.vignettingBlur=t}get vignettingBlur(){return this.uniforms.vignettingBlur}};pm.defaults={curvature:1,lineWidth:1,lineContrast:.25,verticalLine:!1,noise:0,noiseSize:1,seed:0,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3,time:0};var mm=Object.defineProperty,gm=Object.getOwnPropertySymbols,ym=Object.prototype.hasOwnProperty,vm=Object.prototype.propertyIsEnumerable,xm=(t,e,s)=>e in t?mm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,_m=(t,e)=>{for(var s in e||(e={}))ym.call(e,s)&&xm(t,s,e[s]);if(gm)for(var s of gm(e))vm.call(e,s)&&xm(t,s,e[s]);return t};const bm=class extends gl{constructor(t){super(),this.angle=45,this._distance=5,this._resolution=_r.FILTER_RESOLUTION;const e=t?_m(_m({},bm.defaults),t):bm.defaults,{kernels:s,blur:n,quality:i,pixelSize:r,resolution:a}=e;this._offset=new Nh(this._updatePadding,this),this._tintFilter=new gl("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float alpha;\nuniform vec3 color;\n\nuniform vec2 shift;\nuniform vec4 inputSize;\n\nvoid main(void){\n    vec4 sample = texture2D(uSampler, vTextureCoord - shift * inputSize.zw);\n\n    // Premultiply alpha\n    sample.rgb = color.rgb * sample.a;\n\n    // alpha user alpha\n    sample *= alpha;\n\n    gl_FragColor = sample;\n}"),this._tintFilter.uniforms.color=new Float32Array(4),this._tintFilter.uniforms.shift=this._offset,this._tintFilter.resolution=a,this._blurFilter=s?new $p(s):new $p(n,i),this.pixelSize=r,this.resolution=a;const{shadowOnly:o,rotation:h,distance:l,offset:c,alpha:u,color:d}=e;this.shadowOnly=o,void 0!==h&&void 0!==l?(this.rotation=h,this.distance=l):this.offset=c,this.alpha=u,this.color=d}apply(t,e,s,n){const i=t.getFilterTexture();this._tintFilter.apply(t,e,i,1),this._blurFilter.apply(t,i,s,n),!0!==this.shadowOnly&&t.applyFilter(this,e,s,0),t.returnFilterTexture(i)}_updatePadding(){const t=Math.max(Math.abs(this._offset.x),Math.abs(this._offset.y));this.padding=t+2*this.blur}_updateShift(){this._tintFilter.uniforms.shift.set(this.distance*Math.cos(this.angle),this.distance*Math.sin(this.angle))}set offset(t){this._offset.copyFrom(t),this._updatePadding()}get offset(){return this._offset}get resolution(){return this._resolution}set resolution(t){this._resolution=t,this._tintFilter&&(this._tintFilter.resolution=t),this._blurFilter&&(this._blurFilter.resolution=t)}get distance(){return this._distance}set distance(t){Ua("5.3.0","DropShadowFilter distance is deprecated, use offset"),this._distance=t,this._updatePadding(),this._updateShift()}get rotation(){return this.angle/vh}set rotation(t){Ua("5.3.0","DropShadowFilter rotation is deprecated, use offset"),this.angle=t*vh,this._updateShift()}get alpha(){return this._tintFilter.uniforms.alpha}set alpha(t){this._tintFilter.uniforms.alpha=t}get color(){return wo(this._tintFilter.uniforms.color)}set color(t){bo(t,this._tintFilter.uniforms.color)}get kernels(){return this._blurFilter.kernels}set kernels(t){this._blurFilter.kernels=t}get blur(){return this._blurFilter.blur}set blur(t){this._blurFilter.blur=t,this._updatePadding()}get quality(){return this._blurFilter.quality}set quality(t){this._blurFilter.quality=t}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(t){this._blurFilter.pixelSize=t}};bm.defaults={offset:{x:4,y:4},color:0,alpha:.5,shadowOnly:!1,kernels:null,blur:2,quality:3,pixelSize:1,resolution:_r.FILTER_RESOLUTION};const wm=class extends gl{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","// precision highp float;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\nuniform vec2 dimensions;\nuniform float aspect;\n\nuniform sampler2D displacementMap;\nuniform float offset;\nuniform float sinDir;\nuniform float cosDir;\nuniform int fillMode;\n\nuniform float seed;\nuniform vec2 red;\nuniform vec2 green;\nuniform vec2 blue;\n\nconst int TRANSPARENT = 0;\nconst int ORIGINAL = 1;\nconst int LOOP = 2;\nconst int CLAMP = 3;\nconst int MIRROR = 4;\n\nvoid main(void)\n{\n    vec2 coord = (vTextureCoord * filterArea.xy) / dimensions;\n\n    if (coord.x > 1.0 || coord.y > 1.0) {\n        return;\n    }\n\n    float cx = coord.x - 0.5;\n    float cy = (coord.y - 0.5) * aspect;\n    float ny = (-sinDir * cx + cosDir * cy) / aspect + 0.5;\n\n    // displacementMap: repeat\n    // ny = ny > 1.0 ? ny - 1.0 : (ny < 0.0 ? 1.0 + ny : ny);\n\n    // displacementMap: mirror\n    ny = ny > 1.0 ? 2.0 - ny : (ny < 0.0 ? -ny : ny);\n\n    vec4 dc = texture2D(displacementMap, vec2(0.5, ny));\n\n    float displacement = (dc.r - dc.g) * (offset / filterArea.x);\n\n    coord = vTextureCoord + vec2(cosDir * displacement, sinDir * displacement * aspect);\n\n    if (fillMode == CLAMP) {\n        coord = clamp(coord, filterClamp.xy, filterClamp.zw);\n    } else {\n        if( coord.x > filterClamp.z ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.x -= filterClamp.z;\n            } else if (fillMode == MIRROR) {\n                coord.x = filterClamp.z * 2.0 - coord.x;\n            }\n        } else if( coord.x < filterClamp.x ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.x += filterClamp.z;\n            } else if (fillMode == MIRROR) {\n                coord.x *= -filterClamp.z;\n            }\n        }\n\n        if( coord.y > filterClamp.w ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.y -= filterClamp.w;\n            } else if (fillMode == MIRROR) {\n                coord.y = filterClamp.w * 2.0 - coord.y;\n            }\n        } else if( coord.y < filterClamp.y ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.y += filterClamp.w;\n            } else if (fillMode == MIRROR) {\n                coord.y *= -filterClamp.w;\n            }\n        }\n    }\n\n    gl_FragColor.r = texture2D(uSampler, coord + red * (1.0 - seed * 0.4) / filterArea.xy).r;\n    gl_FragColor.g = texture2D(uSampler, coord + green * (1.0 - seed * 0.3) / filterArea.xy).g;\n    gl_FragColor.b = texture2D(uSampler, coord + blue * (1.0 - seed * 0.2) / filterArea.xy).b;\n    gl_FragColor.a = texture2D(uSampler, coord).a;\n}\n"),this.offset=100,this.fillMode=wm.TRANSPARENT,this.average=!1,this.seed=0,this.minSize=8,this.sampleSize=512,this._slices=0,this._offsets=new Float32Array(1),this._sizes=new Float32Array(1),this._direction=-1,this.uniforms.dimensions=new Float32Array(2),this._canvas=document.createElement("canvas"),this._canvas.width=4,this._canvas.height=this.sampleSize,this.texture=Il.from(this._canvas,{scaleMode:cr.NEAREST}),Object.assign(this,wm.defaults,t)}apply(t,e,s,n){const{width:i,height:r}=e.filterFrame;this.uniforms.dimensions[0]=i,this.uniforms.dimensions[1]=r,this.uniforms.aspect=r/i,this.uniforms.seed=this.seed,this.uniforms.offset=this.offset,this.uniforms.fillMode=this.fillMode,t.applyFilter(this,e,s,n)}_randomizeSizes(){const t=this._sizes,e=this._slices-1,s=this.sampleSize,n=Math.min(this.minSize/s,.9/this._slices);if(this.average){const s=this._slices;let i=1;for(let r=0;r<e;r++){const e=i/(s-r),a=Math.max(e*(1-.6*Math.random()),n);t[r]=a,i-=a}t[e]=i}else{let s=1;const i=Math.sqrt(1/this._slices);for(let r=0;r<e;r++){const e=Math.max(i*s*Math.random(),n);t[r]=e,s-=e}t[e]=s}this.shuffle()}shuffle(){const t=this._sizes;for(let e=this._slices-1;e>0;e--){const s=Math.random()*e>>0,n=t[e];t[e]=t[s],t[s]=n}}_randomizeOffsets(){for(let t=0;t<this._slices;t++)this._offsets[t]=Math.random()*(Math.random()<.5?-1:1)}refresh(){this._randomizeSizes(),this._randomizeOffsets(),this.redraw()}redraw(){const t=this.sampleSize,e=this.texture,s=this._canvas.getContext("2d");s.clearRect(0,0,8,t);let n,i=0;for(let r=0;r<this._slices;r++){n=Math.floor(256*this._offsets[r]);const e=this._sizes[r]*t,a=n>0?n:0,o=n<0?-n:0;s.fillStyle=`rgba(${a}, ${o}, 0, 1)`,s.fillRect(0,i>>0,t,e+1>>0),i+=e}e.baseTexture.update(),this.uniforms.displacementMap=e}set sizes(t){const e=Math.min(this._slices,t.length);for(let s=0;s<e;s++)this._sizes[s]=t[s]}get sizes(){return this._sizes}set offsets(t){const e=Math.min(this._slices,t.length);for(let s=0;s<e;s++)this._offsets[s]=t[s]}get offsets(){return this._offsets}get slices(){return this._slices}set slices(t){this._slices!==t&&(this._slices=t,this.uniforms.slices=t,this._sizes=this.uniforms.slicesWidth=new Float32Array(t),this._offsets=this.uniforms.slicesOffset=new Float32Array(t),this.refresh())}get direction(){return this._direction}set direction(t){if(this._direction===t)return;this._direction=t;const e=t*vh;this.uniforms.sinDir=Math.sin(e),this.uniforms.cosDir=Math.cos(e)}get red(){return this.uniforms.red}set red(t){this.uniforms.red=t}get green(){return this.uniforms.green}set green(t){this.uniforms.green=t}get blue(){return this.uniforms.blue}set blue(t){this.uniforms.blue=t}destroy(){var t;null==(t=this.texture)||t.destroy(!0),this.texture=this._canvas=this.red=this.green=this.blue=this._sizes=this._offsets=null}};let Em=wm;Em.defaults={slices:5,offset:100,direction:0,fillMode:0,average:!1,seed:0,red:[0,0],green:[0,0],blue:[0,0],minSize:8,sampleSize:512},Em.TRANSPARENT=0,Em.ORIGINAL=1,Em.LOOP=2,Em.CLAMP=3,Em.MIRROR=4;var Sm="varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nuniform float outerStrength;\nuniform float innerStrength;\n\nuniform vec4 glowColor;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\nuniform bool knockout;\nuniform float alpha;\n\nconst float PI = 3.14159265358979323846264;\n\nconst float DIST = __DIST__;\nconst float ANGLE_STEP_SIZE = min(__ANGLE_STEP_SIZE__, PI * 2.0);\nconst float ANGLE_STEP_NUM = ceil(PI * 2.0 / ANGLE_STEP_SIZE);\n\nconst float MAX_TOTAL_ALPHA = ANGLE_STEP_NUM * DIST * (DIST + 1.0) / 2.0;\n\nvoid main(void) {\n    vec2 px = vec2(1.0 / filterArea.x, 1.0 / filterArea.y);\n\n    float totalAlpha = 0.0;\n\n    vec2 direction;\n    vec2 displaced;\n    vec4 curColor;\n\n    for (float angle = 0.0; angle < PI * 2.0; angle += ANGLE_STEP_SIZE) {\n       direction = vec2(cos(angle), sin(angle)) * px;\n\n       for (float curDistance = 0.0; curDistance < DIST; curDistance++) {\n           displaced = clamp(vTextureCoord + direction * \n                   (curDistance + 1.0), filterClamp.xy, filterClamp.zw);\n\n           curColor = texture2D(uSampler, displaced);\n\n           totalAlpha += (DIST - curDistance) * curColor.a;\n       }\n    }\n    \n    curColor = texture2D(uSampler, vTextureCoord);\n\n    float alphaRatio = (totalAlpha / MAX_TOTAL_ALPHA);\n\n    float innerGlowAlpha = (1.0 - alphaRatio) * innerStrength * curColor.a;\n    float innerGlowStrength = min(1.0, innerGlowAlpha);\n    \n    vec4 innerColor = mix(curColor, glowColor, innerGlowStrength);\n\n    float outerGlowAlpha = alphaRatio * outerStrength * (1. - curColor.a);\n    float outerGlowStrength = min(1.0 - innerColor.a, outerGlowAlpha);\n\n    if (knockout) {\n      float resultAlpha = (outerGlowAlpha + innerGlowAlpha) * alpha;\n      gl_FragColor = vec4(glowColor.rgb * resultAlpha, resultAlpha);\n    }\n    else {\n      vec4 outerGlowColor = outerGlowStrength * glowColor.rgba * alpha;\n      gl_FragColor = innerColor + outerGlowColor;\n    }\n}\n";const Tm=class extends gl{constructor(t){const e=Object.assign({},Tm.defaults,t),{outerStrength:s,innerStrength:n,color:i,knockout:r,quality:a,alpha:o}=e,h=Math.round(e.distance);super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",Sm.replace(/__ANGLE_STEP_SIZE__/gi,`${(1/a/h).toFixed(7)}`).replace(/__DIST__/gi,`${h.toFixed(0)}.0`)),this.uniforms.glowColor=new Float32Array([0,0,0,1]),this.uniforms.alpha=1,Object.assign(this,{color:i,outerStrength:s,innerStrength:n,padding:h,knockout:r,alpha:o})}get color(){return wo(this.uniforms.glowColor)}set color(t){bo(t,this.uniforms.glowColor)}get outerStrength(){return this.uniforms.outerStrength}set outerStrength(t){this.uniforms.outerStrength=t}get innerStrength(){return this.uniforms.innerStrength}set innerStrength(t){this.uniforms.innerStrength=t}get knockout(){return this.uniforms.knockout}set knockout(t){this.uniforms.knockout=t}get alpha(){return this.uniforms.alpha}set alpha(t){this.uniforms.alpha=t}};Tm.defaults={distance:10,outerStrength:4,innerStrength:0,color:16777215,quality:.1,knockout:!1,alpha:1};var Am="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nuniform vec2 light;\nuniform bool parallel;\nuniform float aspect;\n\nuniform float gain;\nuniform float lacunarity;\nuniform float time;\nuniform float alpha;\n\n${perlin}\n\nvoid main(void) {\n    vec2 coord = vTextureCoord * filterArea.xy / dimensions.xy;\n\n    float d;\n\n    if (parallel) {\n        float _cos = light.x;\n        float _sin = light.y;\n        d = (_cos * coord.x) + (_sin * coord.y * aspect);\n    } else {\n        float dx = coord.x - light.x / dimensions.x;\n        float dy = (coord.y - light.y / dimensions.y) * aspect;\n        float dis = sqrt(dx * dx + dy * dy) + 0.00001;\n        d = dy / dis;\n    }\n\n    vec3 dir = vec3(d, d, 0.0);\n\n    float noise = turb(dir + vec3(time, 0.0, 62.1 + time) * 0.05, vec3(480.0, 320.0, 480.0), lacunarity, gain);\n    noise = mix(noise, 0.0, 0.3);\n    //fade vertically.\n    vec4 mist = vec4(noise, noise, noise, 1.0) * (1.0 - coord.y);\n    mist.a = 1.0;\n    // apply user alpha\n    mist *= alpha;\n\n    gl_FragColor = texture2D(uSampler, vTextureCoord) + mist;\n\n}\n";const Cm=class extends gl{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",Am.replace("${perlin}","vec3 mod289(vec3 x)\n{\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 mod289(vec4 x)\n{\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 permute(vec4 x)\n{\n    return mod289(((x * 34.0) + 1.0) * x);\n}\nvec4 taylorInvSqrt(vec4 r)\n{\n    return 1.79284291400159 - 0.85373472095314 * r;\n}\nvec3 fade(vec3 t)\n{\n    return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\n}\n// Classic Perlin noise, periodic variant\nfloat pnoise(vec3 P, vec3 rep)\n{\n    vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period\n    vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period\n    Pi0 = mod289(Pi0);\n    Pi1 = mod289(Pi1);\n    vec3 Pf0 = fract(P); // Fractional part for interpolation\n    vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n    vec4 iy = vec4(Pi0.yy, Pi1.yy);\n    vec4 iz0 = Pi0.zzzz;\n    vec4 iz1 = Pi1.zzzz;\n    vec4 ixy = permute(permute(ix) + iy);\n    vec4 ixy0 = permute(ixy + iz0);\n    vec4 ixy1 = permute(ixy + iz1);\n    vec4 gx0 = ixy0 * (1.0 / 7.0);\n    vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n    gx0 = fract(gx0);\n    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n    vec4 sz0 = step(gz0, vec4(0.0));\n    gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n    gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n    vec4 gx1 = ixy1 * (1.0 / 7.0);\n    vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n    gx1 = fract(gx1);\n    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n    vec4 sz1 = step(gz1, vec4(0.0));\n    gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n    gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n    vec3 g000 = vec3(gx0.x, gy0.x, gz0.x);\n    vec3 g100 = vec3(gx0.y, gy0.y, gz0.y);\n    vec3 g010 = vec3(gx0.z, gy0.z, gz0.z);\n    vec3 g110 = vec3(gx0.w, gy0.w, gz0.w);\n    vec3 g001 = vec3(gx1.x, gy1.x, gz1.x);\n    vec3 g101 = vec3(gx1.y, gy1.y, gz1.y);\n    vec3 g011 = vec3(gx1.z, gy1.z, gz1.z);\n    vec3 g111 = vec3(gx1.w, gy1.w, gz1.w);\n    vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n    g000 *= norm0.x;\n    g010 *= norm0.y;\n    g100 *= norm0.z;\n    g110 *= norm0.w;\n    vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n    g001 *= norm1.x;\n    g011 *= norm1.y;\n    g101 *= norm1.z;\n    g111 *= norm1.w;\n    float n000 = dot(g000, Pf0);\n    float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n    float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n    float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n    float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n    float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n    float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n    float n111 = dot(g111, Pf1);\n    vec3 fade_xyz = fade(Pf0);\n    vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n    vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n    float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n    return 2.2 * n_xyz;\n}\nfloat turb(vec3 P, vec3 rep, float lacunarity, float gain)\n{\n    float sum = 0.0;\n    float sc = 1.0;\n    float totalgain = 1.0;\n    for (float i = 0.0; i < 6.0; i++)\n    {\n        sum += totalgain * pnoise(P * sc, rep);\n        sc *= lacunarity;\n        totalgain *= gain;\n    }\n    return abs(sum);\n}\n")),this.parallel=!0,this.time=0,this._angle=0,this.uniforms.dimensions=new Float32Array(2);const e=Object.assign(Cm.defaults,t);this._angleLight=new _h,this.angle=e.angle,this.gain=e.gain,this.lacunarity=e.lacunarity,this.alpha=e.alpha,this.parallel=e.parallel,this.center=e.center,this.time=e.time}apply(t,e,s,n){const{width:i,height:r}=e.filterFrame;this.uniforms.light=this.parallel?this._angleLight:this.center,this.uniforms.parallel=this.parallel,this.uniforms.dimensions[0]=i,this.uniforms.dimensions[1]=r,this.uniforms.aspect=r/i,this.uniforms.time=this.time,this.uniforms.alpha=this.alpha,t.applyFilter(this,e,s,n)}get angle(){return this._angle}set angle(t){this._angle=t;const e=t*vh;this._angleLight.x=Math.cos(e),this._angleLight.y=Math.sin(e)}get gain(){return this.uniforms.gain}set gain(t){this.uniforms.gain=t}get lacunarity(){return this.uniforms.lacunarity}set lacunarity(t){this.uniforms.lacunarity=t}get alpha(){return this.uniforms.alpha}set alpha(t){this.uniforms.alpha=t}};Cm.defaults={angle:30,gain:.5,lacunarity:2.5,time:0,parallel:!0,center:[0,0],alpha:1};const Mm=class extends gl{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","precision mediump float;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float uHue;\nuniform float uAlpha;\nuniform bool uColorize;\nuniform float uSaturation;\nuniform float uLightness;\n\n// https://en.wikipedia.org/wiki/Luma_(video)\nconst vec3 weight = vec3(0.299, 0.587, 0.114);\n\nfloat getWeightedAverage(vec3 rgb) {\n    return rgb.r * weight.r + rgb.g * weight.g + rgb.b * weight.b;\n}\n\n// https://gist.github.com/mairod/a75e7b44f68110e1576d77419d608786?permalink_comment_id=3195243#gistcomment-3195243\nconst vec3 k = vec3(0.57735, 0.57735, 0.57735);\n\nvec3 hueShift(vec3 color, float angle) {\n    float cosAngle = cos(angle);\n    return vec3(\n    color * cosAngle +\n    cross(k, color) * sin(angle) +\n    k * dot(k, color) * (1.0 - cosAngle)\n    );\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    vec4 result = color;\n\n    // colorize\n    if (uColorize) {\n        result.rgb = vec3(getWeightedAverage(result.rgb), 0., 0.);\n    }\n\n    // hue\n    result.rgb = hueShift(result.rgb, uHue);\n\n    // saturation\n    // https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/huesaturation.js\n    float average = (result.r + result.g + result.b) / 3.0;\n\n    if (uSaturation > 0.) {\n        result.rgb += (average - result.rgb) * (1. - 1. / (1.001 - uSaturation));\n    } else {\n        result.rgb -= (average - result.rgb) * uSaturation;\n    }\n\n    // lightness\n    result.rgb = mix(result.rgb, vec3(ceil(uLightness)) * color.a, abs(uLightness));\n\n    // alpha\n    gl_FragColor = mix(color, result, uAlpha);\n}\n"),this._hue=0;const e=Object.assign({},Mm.defaults,t);Object.assign(this,e)}get hue(){return this._hue}set hue(t){this._hue=t,this.uniforms.uHue=this._hue*(Math.PI/180)}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}get colorize(){return this.uniforms.uColorize}set colorize(t){this.uniforms.uColorize=t}get lightness(){return this.uniforms.uLightness}set lightness(t){this.uniforms.uLightness=t}get saturation(){return this.uniforms.uSaturation}set saturation(t){this.uniforms.uSaturation=t}};Mm.defaults={hue:0,saturation:0,lightness:0,colorize:!1,alpha:1};const Im=class extends gl{constructor(t,e=0){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\nuniform vec2 dimensions;\n\nuniform float sepia;\nuniform float noise;\nuniform float noiseSize;\nuniform float scratch;\nuniform float scratchDensity;\nuniform float scratchWidth;\nuniform float vignetting;\nuniform float vignettingAlpha;\nuniform float vignettingBlur;\nuniform float seed;\n\nconst float SQRT_2 = 1.414213;\nconst vec3 SEPIA_RGB = vec3(112.0 / 255.0, 66.0 / 255.0, 20.0 / 255.0);\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvec3 Overlay(vec3 src, vec3 dst)\n{\n    // if (dst <= 0.5) then: 2 * src * dst\n    // if (dst > 0.5) then: 1 - 2 * (1 - dst) * (1 - src)\n    return vec3((dst.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)),\n                (dst.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)),\n                (dst.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)));\n}\n\n\nvoid main()\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord);\n    vec3 color = gl_FragColor.rgb;\n\n    if (sepia > 0.0)\n    {\n        float gray = (color.x + color.y + color.z) / 3.0;\n        vec3 grayscale = vec3(gray);\n\n        color = Overlay(SEPIA_RGB, grayscale);\n\n        color = grayscale + sepia * (color - grayscale);\n    }\n\n    vec2 coord = vTextureCoord * filterArea.xy / dimensions.xy;\n\n    if (vignetting > 0.0)\n    {\n        float outter = SQRT_2 - vignetting * SQRT_2;\n        vec2 dir = vec2(vec2(0.5, 0.5) - coord);\n        dir.y *= dimensions.y / dimensions.x;\n        float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + vignettingBlur * SQRT_2), 0.0, 1.0);\n        color.rgb *= darker + (1.0 - darker) * (1.0 - vignettingAlpha);\n    }\n\n    if (scratchDensity > seed && scratch != 0.0)\n    {\n        float phase = seed * 256.0;\n        float s = mod(floor(phase), 2.0);\n        float dist = 1.0 / scratchDensity;\n        float d = distance(coord, vec2(seed * dist, abs(s - seed * dist)));\n        if (d < seed * 0.6 + 0.4)\n        {\n            highp float period = scratchDensity * 10.0;\n\n            float xx = coord.x * period + phase;\n            float aa = abs(mod(xx, 0.5) * 4.0);\n            float bb = mod(floor(xx / 0.5), 2.0);\n            float yy = (1.0 - bb) * aa + bb * (2.0 - aa);\n\n            float kk = 2.0 * period;\n            float dw = scratchWidth / dimensions.x * (0.75 + seed);\n            float dh = dw * kk;\n\n            float tine = (yy - (2.0 - dh));\n\n            if (tine > 0.0) {\n                float _sign = sign(scratch);\n\n                tine = s * tine / period + scratch + 0.1;\n                tine = clamp(tine + 1.0, 0.5 + _sign * 0.5, 1.5 + _sign * 0.5);\n\n                color.rgb *= tine;\n            }\n        }\n    }\n\n    if (noise > 0.0 && noiseSize > 0.0)\n    {\n        vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;\n        pixelCoord.x = floor(pixelCoord.x / noiseSize);\n        pixelCoord.y = floor(pixelCoord.y / noiseSize);\n        // vec2 d = pixelCoord * noiseSize * vec2(1024.0 + seed * 512.0, 1024.0 - seed * 512.0);\n        // float _noise = snoise(d) * 0.5;\n        float _noise = rand(pixelCoord * noiseSize * seed) - 0.5;\n        color += _noise * noise;\n    }\n\n    gl_FragColor.rgb = color;\n}\n"),this.seed=0,this.uniforms.dimensions=new Float32Array(2),"number"==typeof t?(this.seed=t,t=void 0):this.seed=e,Object.assign(this,Im.defaults,t)}apply(t,e,s,n){var i,r;this.uniforms.dimensions[0]=null==(i=e.filterFrame)?void 0:i.width,this.uniforms.dimensions[1]=null==(r=e.filterFrame)?void 0:r.height,this.uniforms.seed=this.seed,t.applyFilter(this,e,s,n)}set sepia(t){this.uniforms.sepia=t}get sepia(){return this.uniforms.sepia}set noise(t){this.uniforms.noise=t}get noise(){return this.uniforms.noise}set noiseSize(t){this.uniforms.noiseSize=t}get noiseSize(){return this.uniforms.noiseSize}set scratch(t){this.uniforms.scratch=t}get scratch(){return this.uniforms.scratch}set scratchDensity(t){this.uniforms.scratchDensity=t}get scratchDensity(){return this.uniforms.scratchDensity}set scratchWidth(t){this.uniforms.scratchWidth=t}get scratchWidth(){return this.uniforms.scratchWidth}set vignetting(t){this.uniforms.vignetting=t}get vignetting(){return this.uniforms.vignetting}set vignettingAlpha(t){this.uniforms.vignettingAlpha=t}get vignettingAlpha(){return this.uniforms.vignettingAlpha}set vignettingBlur(t){this.uniforms.vignettingBlur=t}get vignettingBlur(){return this.uniforms.vignettingBlur}};Im.defaults={sepia:.3,noise:.3,noiseSize:1,scratch:.5,scratchDensity:.3,scratchWidth:1,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3};var Pm="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterClamp;\n\nuniform float uAlpha;\nuniform vec2 uThickness;\nuniform vec4 uColor;\nuniform bool uKnockout;\n\nconst float DOUBLE_PI = 2. * 3.14159265358979323846264;\nconst float ANGLE_STEP = ${angleStep};\n\nfloat outlineMaxAlphaAtPos(vec2 pos) {\n    if (uThickness.x == 0. || uThickness.y == 0.) {\n        return 0.;\n    }\n\n    vec4 displacedColor;\n    vec2 displacedPos;\n    float maxAlpha = 0.;\n\n    for (float angle = 0.; angle <= DOUBLE_PI; angle += ANGLE_STEP) {\n        displacedPos.x = vTextureCoord.x + uThickness.x * cos(angle);\n        displacedPos.y = vTextureCoord.y + uThickness.y * sin(angle);\n        displacedColor = texture2D(uSampler, clamp(displacedPos, filterClamp.xy, filterClamp.zw));\n        maxAlpha = max(maxAlpha, displacedColor.a);\n    }\n\n    return maxAlpha;\n}\n\nvoid main(void) {\n    vec4 sourceColor = texture2D(uSampler, vTextureCoord);\n    vec4 contentColor = sourceColor * float(!uKnockout);\n    float outlineAlpha = uAlpha * outlineMaxAlphaAtPos(vTextureCoord.xy) * (1.-sourceColor.a);\n    vec4 outlineColor = vec4(vec3(uColor) * outlineAlpha, outlineAlpha);\n    gl_FragColor = contentColor + outlineColor;\n}\n";const Rm=class extends gl{constructor(t=1,e=0,s=.1,n=1,i=!1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",Pm.replace(/\$\{angleStep\}/,Rm.getAngleStep(s))),this._thickness=1,this._alpha=1,this._knockout=!1,this.uniforms.uThickness=new Float32Array([0,0]),this.uniforms.uColor=new Float32Array([0,0,0,1]),this.uniforms.uAlpha=n,this.uniforms.uKnockout=i,Object.assign(this,{thickness:t,color:e,quality:s,alpha:n,knockout:i})}static getAngleStep(t){const e=Math.max(t*Rm.MAX_SAMPLES,Rm.MIN_SAMPLES);return(2*Math.PI/e).toFixed(7)}apply(t,e,s,n){this.uniforms.uThickness[0]=this._thickness/e._frame.width,this.uniforms.uThickness[1]=this._thickness/e._frame.height,this.uniforms.uAlpha=this._alpha,this.uniforms.uKnockout=this._knockout,t.applyFilter(this,e,s,n)}get alpha(){return this._alpha}set alpha(t){this._alpha=t}get color(){return wo(this.uniforms.uColor)}set color(t){bo(t,this.uniforms.uColor)}get knockout(){return this._knockout}set knockout(t){this._knockout=t}get thickness(){return this._thickness}set thickness(t){this._thickness=t,this.padding=t}};let km=Rm;km.MIN_SAMPLES=1,km.MAX_SAMPLES=100;const Dm=class extends gl{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\nuniform vec2 dimensions;\n\nuniform bool mirror;\nuniform float boundary;\nuniform vec2 amplitude;\nuniform vec2 waveLength;\nuniform vec2 alpha;\nuniform float time;\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main(void)\n{\n    vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;\n    vec2 coord = pixelCoord / dimensions;\n\n    if (coord.y < boundary) {\n        gl_FragColor = texture2D(uSampler, vTextureCoord);\n        return;\n    }\n\n    float k = (coord.y - boundary) / (1. - boundary + 0.0001);\n    float areaY = boundary * dimensions.y / filterArea.y;\n    float v = areaY + areaY - vTextureCoord.y;\n    float y = mirror ? v : vTextureCoord.y;\n\n    float _amplitude = ((amplitude.y - amplitude.x) * k + amplitude.x ) / filterArea.x;\n    float _waveLength = ((waveLength.y - waveLength.x) * k + waveLength.x) / filterArea.y;\n    float _alpha = (alpha.y - alpha.x) * k + alpha.x;\n\n    float x = vTextureCoord.x + cos(v * 6.28 / _waveLength - time) * _amplitude;\n    x = clamp(x, filterClamp.x, filterClamp.z);\n\n    vec4 color = texture2D(uSampler, vec2(x, y));\n\n    gl_FragColor = color * _alpha;\n}\n"),this.time=0,this.uniforms.amplitude=new Float32Array(2),this.uniforms.waveLength=new Float32Array(2),this.uniforms.alpha=new Float32Array(2),this.uniforms.dimensions=new Float32Array(2),Object.assign(this,Dm.defaults,t)}apply(t,e,s,n){var i,r;this.uniforms.dimensions[0]=null==(i=e.filterFrame)?void 0:i.width,this.uniforms.dimensions[1]=null==(r=e.filterFrame)?void 0:r.height,this.uniforms.time=this.time,t.applyFilter(this,e,s,n)}set mirror(t){this.uniforms.mirror=t}get mirror(){return this.uniforms.mirror}set boundary(t){this.uniforms.boundary=t}get boundary(){return this.uniforms.boundary}set amplitude(t){this.uniforms.amplitude[0]=t[0],this.uniforms.amplitude[1]=t[1]}get amplitude(){return this.uniforms.amplitude}set waveLength(t){this.uniforms.waveLength[0]=t[0],this.uniforms.waveLength[1]=t[1]}get waveLength(){return this.uniforms.waveLength}set alpha(t){this.uniforms.alpha[0]=t[0],this.uniforms.alpha[1]=t[1]}get alpha(){return this.uniforms.alpha}};Dm.defaults={mirror:!0,boundary:.5,amplitude:[0,20],waveLength:[30,100],alpha:[1,1],time:0};const Fm=class extends gl{constructor(t=[0,0],e,s=0){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\n\nuniform vec2 center;\n\nuniform float amplitude;\nuniform float wavelength;\n// uniform float power;\nuniform float brightness;\nuniform float speed;\nuniform float radius;\n\nuniform float time;\n\nconst float PI = 3.14159;\n\nvoid main()\n{\n    float halfWavelength = wavelength * 0.5 / filterArea.x;\n    float maxRadius = radius / filterArea.x;\n    float currentRadius = time * speed / filterArea.x;\n\n    float fade = 1.0;\n\n    if (maxRadius > 0.0) {\n        if (currentRadius > maxRadius) {\n            gl_FragColor = texture2D(uSampler, vTextureCoord);\n            return;\n        }\n        fade = 1.0 - pow(currentRadius / maxRadius, 2.0);\n    }\n\n    vec2 dir = vec2(vTextureCoord - center / filterArea.xy);\n    dir.y *= filterArea.y / filterArea.x;\n    float dist = length(dir);\n\n    if (dist <= 0.0 || dist < currentRadius - halfWavelength || dist > currentRadius + halfWavelength) {\n        gl_FragColor = texture2D(uSampler, vTextureCoord);\n        return;\n    }\n\n    vec2 diffUV = normalize(dir);\n\n    float diff = (dist - currentRadius) / halfWavelength;\n\n    float p = 1.0 - pow(abs(diff), 2.0);\n\n    // float powDiff = diff * pow(p, 2.0) * ( amplitude * fade );\n    float powDiff = 1.25 * sin(diff * PI) * p * ( amplitude * fade );\n\n    vec2 offset = diffUV * powDiff / filterArea.xy;\n\n    // Do clamp :\n    vec2 coord = vTextureCoord + offset;\n    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);\n    vec4 color = texture2D(uSampler, clampedCoord);\n    if (coord != clampedCoord) {\n        color *= max(0.0, 1.0 - length(coord - clampedCoord));\n    }\n\n    // No clamp :\n    // gl_FragColor = texture2D(uSampler, vTextureCoord + offset);\n\n    color.rgb *= 1.0 + (brightness - 1.0) * p * fade;\n\n    gl_FragColor = color;\n}\n"),this.center=t,Object.assign(this,Fm.defaults,e),this.time=s}apply(t,e,s,n){this.uniforms.time=this.time,t.applyFilter(this,e,s,n)}get center(){return this.uniforms.center}set center(t){this.uniforms.center=t}get amplitude(){return this.uniforms.amplitude}set amplitude(t){this.uniforms.amplitude=t}get wavelength(){return this.uniforms.wavelength}set wavelength(t){this.uniforms.wavelength=t}get brightness(){return this.uniforms.brightness}set brightness(t){this.uniforms.brightness=t}get speed(){return this.uniforms.speed}set speed(t){this.uniforms.speed=t}get radius(){return this.uniforms.radius}set radius(t){this.uniforms.radius=t}};Fm.defaults={amplitude:30,wavelength:160,brightness:1,speed:500,radius:-1};let Om=class extends gl{constructor(t){var e,s;super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float blur;\nuniform float gradientBlur;\nuniform vec2 start;\nuniform vec2 end;\nuniform vec2 delta;\nuniform vec2 texSize;\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n    vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\n    float radius = smoothstep(0.0, 1.0, abs(dot(vTextureCoord * texSize - start, normal)) / gradientBlur) * blur;\n\n    for (float t = -30.0; t <= 30.0; t++)\n    {\n        float percent = (t + offset - 0.5) / 30.0;\n        float weight = 1.0 - abs(percent);\n        vec4 sample = texture2D(uSampler, vTextureCoord + delta / texSize * percent * radius);\n        sample.rgb *= sample.a;\n        color += sample * weight;\n        total += weight;\n    }\n\n    color /= total;\n    color.rgb /= color.a + 0.00001;\n\n    gl_FragColor = color;\n}\n"),this.uniforms.blur=t.blur,this.uniforms.gradientBlur=t.gradientBlur,this.uniforms.start=null!=(e=t.start)?e:new _h(0,window.innerHeight/2),this.uniforms.end=null!=(s=t.end)?s:new _h(600,window.innerHeight/2),this.uniforms.delta=new _h(30,30),this.uniforms.texSize=new _h(window.innerWidth,window.innerHeight),this.updateDelta()}updateDelta(){this.uniforms.delta.x=0,this.uniforms.delta.y=0}get blur(){return this.uniforms.blur}set blur(t){this.uniforms.blur=t}get gradientBlur(){return this.uniforms.gradientBlur}set gradientBlur(t){this.uniforms.gradientBlur=t}get start(){return this.uniforms.start}set start(t){this.uniforms.start=t,this.updateDelta()}get end(){return this.uniforms.end}set end(t){this.uniforms.end=t,this.updateDelta()}},Nm=class extends Om{updateDelta(){const t=this.uniforms.end.x-this.uniforms.start.x,e=this.uniforms.end.y-this.uniforms.start.y,s=Math.sqrt(t*t+e*e);this.uniforms.delta.x=t/s,this.uniforms.delta.y=e/s}},Bm=class extends Om{updateDelta(){const t=this.uniforms.end.x-this.uniforms.start.x,e=this.uniforms.end.y-this.uniforms.start.y,s=Math.sqrt(t*t+e*e);this.uniforms.delta.x=-e/s,this.uniforms.delta.y=t/s}};const Lm=class extends gl{constructor(t,e,s,n){super(),"number"==typeof t&&(Ua("5.3.0","TiltShiftFilter constructor arguments is deprecated, use options."),t={blur:t,gradientBlur:e,start:s,end:n}),t=Object.assign({},Lm.defaults,t),this.tiltShiftXFilter=new Nm(t),this.tiltShiftYFilter=new Bm(t)}apply(t,e,s,n){const i=t.getFilterTexture();this.tiltShiftXFilter.apply(t,e,i,1),this.tiltShiftYFilter.apply(t,i,s,n),t.returnFilterTexture(i)}get blur(){return this.tiltShiftXFilter.blur}set blur(t){this.tiltShiftXFilter.blur=this.tiltShiftYFilter.blur=t}get gradientBlur(){return this.tiltShiftXFilter.gradientBlur}set gradientBlur(t){this.tiltShiftXFilter.gradientBlur=this.tiltShiftYFilter.gradientBlur=t}get start(){return this.tiltShiftXFilter.start}set start(t){this.tiltShiftXFilter.start=this.tiltShiftYFilter.start=t}get end(){return this.tiltShiftXFilter.end}set end(t){this.tiltShiftXFilter.end=this.tiltShiftYFilter.end=t}};Lm.defaults={blur:100,gradientBlur:600,start:void 0,end:void 0};const Vm=class extends gl{constructor(t){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform vec4 filterArea;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= filterArea.xy;\n    coord += filterArea.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= filterArea.zw;\n    coord /= filterArea.xy;\n\n    return coord;\n}\n\nvec2 twist(vec2 coord)\n{\n    coord -= offset;\n\n    float dist = length(coord);\n\n    if (dist < radius)\n    {\n        float ratioDist = (radius - dist) / radius;\n        float angleMod = ratioDist * ratioDist * angle;\n        float s = sin(angleMod);\n        float c = cos(angleMod);\n        coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);\n    }\n\n    coord += offset;\n\n    return coord;\n}\n\nvoid main(void)\n{\n\n    vec2 coord = mapCoord(vTextureCoord);\n\n    coord = twist(coord);\n\n    coord = unmapCoord(coord);\n\n    gl_FragColor = texture2D(uSampler, coord );\n\n}\n"),Object.assign(this,Vm.defaults,t)}get offset(){return this.uniforms.offset}set offset(t){this.uniforms.offset=t}get radius(){return this.uniforms.radius}set radius(t){this.uniforms.radius=t}get angle(){return this.uniforms.angle}set angle(t){this.uniforms.angle=t}};Vm.defaults={radius:200,angle:4,padding:20,offset:new _h};var $m="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\n\nuniform vec2 uCenter;\nuniform float uStrength;\nuniform float uInnerRadius;\nuniform float uRadius;\n\nconst float MAX_KERNEL_SIZE = ${maxKernelSize};\n\n// author: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand(vec2 co, float seed) {\n    const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n    highp float dt = dot(co + seed, vec2(a, b)), sn = mod(dt, 3.14159);\n    return fract(sin(sn) * c + seed);\n}\n\nvoid main() {\n\n    float minGradient = uInnerRadius * 0.3;\n    float innerRadius = (uInnerRadius + minGradient * 0.5) / filterArea.x;\n\n    float gradient = uRadius * 0.3;\n    float radius = (uRadius - gradient * 0.5) / filterArea.x;\n\n    float countLimit = MAX_KERNEL_SIZE;\n\n    vec2 dir = vec2(uCenter.xy / filterArea.xy - vTextureCoord);\n    float dist = length(vec2(dir.x, dir.y * filterArea.y / filterArea.x));\n\n    float strength = uStrength;\n\n    float delta = 0.0;\n    float gap;\n    if (dist < innerRadius) {\n        delta = innerRadius - dist;\n        gap = minGradient;\n    } else if (radius >= 0.0 && dist > radius) { // radius < 0 means it's infinity\n        delta = dist - radius;\n        gap = gradient;\n    }\n\n    if (delta > 0.0) {\n        float normalCount = gap / filterArea.x;\n        delta = (normalCount - delta) / normalCount;\n        countLimit *= delta;\n        strength *= delta;\n        if (countLimit < 1.0)\n        {\n            gl_FragColor = texture2D(uSampler, vTextureCoord);\n            return;\n        }\n    }\n\n    // randomize the lookup values to hide the fixed number of samples\n    float offset = rand(vTextureCoord, 0.0);\n\n    float total = 0.0;\n    vec4 color = vec4(0.0);\n\n    dir *= strength;\n\n    for (float t = 0.0; t < MAX_KERNEL_SIZE; t++) {\n        float percent = (t + offset) / MAX_KERNEL_SIZE;\n        float weight = 4.0 * (percent - percent * percent);\n        vec2 p = vTextureCoord + dir * percent;\n        vec4 sample = texture2D(uSampler, p);\n\n        // switch to pre-multiplied alpha to correctly blur transparent images\n        // sample.rgb *= sample.a;\n\n        color += sample * weight;\n        total += weight;\n\n        if (t > countLimit){\n            break;\n        }\n    }\n\n    color /= total;\n    // switch back from pre-multiplied alpha\n    // color.rgb /= color.a + 0.00001;\n\n    gl_FragColor = color;\n}\n",Um=Object.getOwnPropertySymbols,Xm=Object.prototype.hasOwnProperty,Ym=Object.prototype.propertyIsEnumerable;const Wm=class extends gl{constructor(t){const e=Object.assign(Wm.defaults,t),{maxKernelSize:s}=e,n=((t,e)=>{var s={};for(var n in t)Xm.call(t,n)&&e.indexOf(n)<0&&(s[n]=t[n]);if(null!=t&&Um)for(var n of Um(t))e.indexOf(n)<0&&Ym.call(t,n)&&(s[n]=t[n]);return s})(e,["maxKernelSize"]);super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",$m.replace("${maxKernelSize}",s.toFixed(1))),Object.assign(this,n)}get center(){return this.uniforms.uCenter}set center(t){this.uniforms.uCenter=t}get strength(){return this.uniforms.uStrength}set strength(t){this.uniforms.uStrength=t}get innerRadius(){return this.uniforms.uInnerRadius}set innerRadius(t){this.uniforms.uInnerRadius=t}get radius(){return this.uniforms.uRadius}set radius(t){(t<0||t===1/0)&&(t=-1),this.uniforms.uRadius=t}};Wm.defaults={strength:.1,center:[0,0],innerRadius:0,radius:-1,maxKernelSize:32};var jm=(t=>(t[t.None=0]="None",t[t.TopLeft=1]="TopLeft",t[t.TopMiddle=2]="TopMiddle",t[t.TopRight=3]="TopRight",t[t.Center=4]="Center",t[t.MiddleLeft=5]="MiddleLeft",t[t.MiddleRight=6]="MiddleRight",t[t.BottomLeft=7]="BottomLeft",t[t.BottomMiddle=8]="BottomMiddle",t[t.BottomRight=9]="BottomRight",t))(jm||{});function zm(t,e,s){switch(e){case 1:t.set(s.x,s.y);break;case 2:t.set(s.x+s.width/2,s.y);break;case 3:t.set(s.x+s.width,s.y);break;case 4:t.set(s.x+s.width/2,s.y+s.height/2);break;case 5:t.set(s.x,s.y+s.height/2);break;case 6:t.set(s.x+s.width,s.y+s.height/2);break;case 7:t.set(s.x,s.y+s.height);break;case 8:t.set(s.x+s.width/2,s.y+s.height);break;case 9:t.set(s.x+s.width,s.y+s.height)}}function Gm(t,e){switch(e){case 1:t.set(0);break;case 2:t.set(.5,0);break;case 3:t.set(1,0);break;case 4:t.set(.5);break;case 5:t.set(0,.5);break;case 6:t.set(1,.5);break;case 7:t.set(0,1);break;case 8:t.set(.5,1);break;case 9:t.set(1,1)}}const Hm={Black:0,White:16777215,Gray:8421504,LightGray:13882323,DarkGray:6316128,Brown:7217408,Red:16711680,DarkRed:9109504,Pink:16761035,DeepPink:16716947,Orange:16753920,Gold:16766720,Yellow:16776960,LightYellow:13613654,Green:65280,DarkGreen:25600,SpringGreen:65407,Aqua:8388564,Blue:255,DarkBlue:139,SkyBlue:49151,LightBlue:8900346,Purple:8388736,Magneta:16711935},qm={e:2.718281828459045,log2e:1.4426950408889634,log10e:.4342944819032518,ln2:.6931471805599453,ln10:2.302585092994046,pi:3.141592653589793,pi2:6.283185307179586,pi1_2:1.5707963267948966,pi1_4:.7853981633974483,_1_pi:.3183098861837907,_2_pi:.6366197723675814,sqrt2:1.4142135623730951,_1_sqrt2:.7071067811865476},Km=new class{constructor(){d(this,"minLayer",-9999),d(this,"maxLayer",9999),d(this,"colorFilter")}init(){this.colorFilter=new fm}};function Zm(t){const e=t,s=e===su||su.prototype.isPrototypeOf(e.prototype);class n extends e{constructor(){super(...arguments),d(this,"name",""),d(this,"_pivotRule",jm.None)}get parentContainer(){return this.parent}get pivotRule(){return this._pivotRule}set pivotRule(t){if(this._pivotRule=t,this.debugBox){this._hideDebugBox();const e=this.unscaledBound;s?Gm(this.anchor,t):zm(this.pivot,t,e),this._drawDebugBox(e)}else s?Gm(this.anchor,t):zm(this.pivot,t,this.unscaledBound)}refreshPivotPoint(){this.pivotRule=this._pivotRule}get unscaledBound(){return this.getLocalBounds(void 0,!0)}get layer(){return this.zIndex}set layer(t){this.zIndex=t}hasParent(){return!!this.parent}get radian(){return this.rotation}set radian(t){this.rotation=t%qm.pi2}useViewStyle(t){void 0!==t.xy&&(this.x=t.xy[0],this.y=t.xy[1]),void 0!==t.s&&(Array.isArray(t.s)?(this.width=t.s[0],this.height=t.s[1]):this.scale.set(t.s)),void 0!==t.vis&&(this.visible=t.vis)}addFilter(t){null===this.filters&&(this.filters=[]),this.filters.push(t)}get debugBox(){return void 0!==this._debugBox&&this._debugBox.visible}set debugBox(t){t?this._drawDebugBox(this.unscaledBound):this._hideDebugBox()}_drawDebugBox(t){void 0===this._debugBox?(this._debugBox=new Cf,this._debugBox.name="debugBox",this._debugBox.zIndex=Km.maxLayer+1,this.addChild(this._debugBox)):this._debugBox.visible=!0;const e=Object.getPrototypeOf(this).constructor._debugFillStyle,n=Object.getPrototypeOf(this).constructor._debugLineStyle;n.alignment=0;const i=s?new wh(0,0,5,5):new wh(this.pivot.x,this.pivot.y,5,5);this._debugBox.geometry.clear().drawShape(t,e,n).drawShape(i,n,n)}_hideDebugBox(){void 0!==this._debugBox&&(this._debugBox.visible=!1)}}return d(n,"_debugFillStyle",(()=>{const t=new Ef;return t.visible=!1,t})()),d(n,"_debugLineStyle",(()=>{const t=new Sf;return t.visible=!0,t.color=Hm.Blue,t.alpha=1,t.width=2,t})()),n}function Qm(t){return void 0!==t.useLocale}globalThis.doNothing=()=>{},Jc.prototype.update=globalThis.doNothing;const Jm={code:"",name:"",defaultFont:"",dict:{},styles:{}},tg={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.sin((1-t)*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.sin(Math.PI*(.5-t)))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){const e=1.70158;return 1===t?1:t*t*((e+1)*t-e)},Out:function(t){const e=1.70158;return 0===t?0:--t*t*((e+1)*t+e)+1},InOut:function(t){const e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-tg.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*tg.Bounce.In(2*t):.5*tg.Bounce.Out(2*t-1)+.5}},generatePow:function(t=4){return t=(t=t<Number.EPSILON?Number.EPSILON:t)>1e4?1e4:t,{In:function(e){return o(e,t)},Out:function(e){return 1-o(1-e,t)},InOut:function(e){return e<.5?o(2*e,t)/2:(1-o(2-2*e,t))/2+.5}}}},eg={Linear:function(t,e){const s=t.length-1,n=s*e,i=Math.floor(n),r=eg.Utils.Linear;return e<0?r(t[0],t[1],n):e>1?r(t[s],t[s-1],s-n):r(t[i],t[i+1>s?s:i+1],n-i)},Bezier:function(t,e){let s=0;const n=t.length-1,i=Math.pow,r=eg.Utils.Bernstein;for(let a=0;a<=n;a++)s+=i(1-e,n-a)*i(e,a)*t[a]*r(n,a);return s},CatmullRom:function(t,e){const s=t.length-1;let n=s*e,i=Math.floor(n);const r=eg.Utils.CatmullRom;return t[0]===t[s]?(e<0&&(i=Math.floor(n=s*(1+e))),r(t[(i-1+s)%s],t[i],t[(i+1)%s],t[(i+2)%s],n-i)):e<0?t[0]-(r(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[s]-(r(t[s],t[s],t[s-1],t[s-1],n-s)-t[s]):r(t[i?i-1:0],t[i],t[s<i+1?s:i+1],t[s<i+2?s:i+2],n-i)},Utils:{Linear:function(t,e,s){return(e-t)*s+t},Bernstein:function(t,e){const s=eg.Utils.Factorial;return s(t)/s(e)/s(t-e)},Factorial:function(){const t=[1];return function(e){let s=1;if(t[e])return t[e];for(let t=e;t>1;t--)s*=t;return t[e]=s,s}}(),CatmullRom:function(t,e,s,n,i){const r=.5*(s-t),a=.5*(n-e),o=i*i;return(2*e-2*s+r+a)*(i*o)+(-3*e+3*s-2*r-a)*o+r*i+e}}};class sg{constructor(t,e,s){d(this,"_name"),d(this,"_object"),d(this,"_group"),d(this,"_valuesStart",{}),d(this,"_valuesEnd",{}),d(this,"_valuesStartRepeat",{}),d(this,"_startTime",0),d(this,"_delayTime",0),d(this,"_duration",1e3),d(this,"_repeat",0),d(this,"_repeatDelayTime",0),d(this,"_isPlaying",!1),d(this,"_isPaused",!1),d(this,"_pauseStart",0),d(this,"_yoyo",!1),d(this,"_yoyoDelayTime",0),d(this,"_reversed",!1),d(this,"_easingFunction",tg.Linear.None),d(this,"_interpolationFunction",eg.Linear),d(this,"_chainedTweens",[]),d(this,"_isChainStopped",!1),d(this,"_allowChainedStop",!0),d(this,"_events",{}),d(this,"_onStartCallbackFired",!1),this._name=t,this._object=e,this._group=s}get name(){return this._name}isPlaying(){return this._isPlaying}isPaused(){return this._isPaused}isReversed(){return this._reversed}getRepeat(){return this._repeat}to(t,e=1e3){return this._valuesEnd=Object.create(t),this._duration=e,this}start(t=!1,e=globalThis.pgame.TotalMS){if(this._isPlaying){if(!t)return this}else this._group&&this._group.add(this);if(this._reversed){this._reversed=!1;for(const t in this._valuesStartRepeat)this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t]}return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this}stop(t=!1){return this.stopChainedTweens(),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this.emit("stop",this._object),t&&this.emit("end",this._object),this):this}end(){return this.updateTillEnd(),this._group&&this._group.remove(this),this}endRepeat(){return this._yoyo?this._reversed?this._repeat=0:this._repeat=1:this._repeat=0,this}pause(t=globalThis.pgame.TotalMS){return this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this)),this}resume(t=globalThis.pgame.TotalMS){return this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this.start(!1,t)}group(t){return this._group=t,this}duration(t){return this._duration=t,this}delay(t){return this._delayTime=t,this}repeat(t){return this._repeat=t,this}repeatDelay(t){return this._repeatDelayTime=t,this}yoyo(t){return this._yoyo=t,this}yoyoDelay(t){return this._yoyoDelayTime=t,this}easing(t){return this._easingFunction=t,this}interpolation(t){return this._interpolationFunction=t,this}on(t,e){const s=this._events[t];return void 0===s?this._events[t]=[e]:s.push(e),this}single(t,e){const s=this._events[t];return void 0===s?this._events[t]=[e]:(s.clear(),s.push(e)),this}off(t){const e=this._events[t];return void 0!==e&&e.clear(),this}emit(t,...e){const s=this._events[t];if(void 0!==s)for(const n of s)n(...e);return this}chain(...t){return this._chainedTweens=t,this}allowChainedStop(t){return this._allowChainedStop=t,this}stopChainedTweens(){if(this._isChainStopped)return this;for(const t of this._chainedTweens)t._allowChainedStop&&t.stop();return this._isChainStopped=!0,this}endChainedTweens(){if(this._isChainStopped)return this;for(const t of this._chainedTweens)t._allowChainedStop&&t.end();return this._isChainStopped=!0,this}update(t){if(this._isPaused)return!0;if(!this._isPlaying)return!1;if(t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this.emit("start",this._object),this._onStartCallbackFired=!0);let e,s=0!==this._duration?(t-this._startTime)/this._duration:1;s>1?(e=1,this._yoyo?s%=2:s%=1):e=0;do{if(e>0||s>=1){if(!(this._repeat>0))return this._updateProperties(this._object,this._valuesStart,this._valuesEnd,1),this.emit("update",this._object,1),this._isPlaying=!1,this._handleEndPlaying();{let t=Math.min(s,1);const e=this._easingFunction(t);this._updateProperties(this._object,this._valuesStart,this._valuesEnd,e),this.emit("update",this._object,t),this._handleRepeatEnd()}}else{let t=Math.min(s,1);const e=this._easingFunction(t);this._updateProperties(this._object,this._valuesStart,this._valuesEnd,e),this.emit("update",this._object,t)}s-=1,e=0}while(s>0);return!0}_handleRepeatEnd(){for(const t in this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[t]||(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo&&this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t];return this._yoyo?this._reversed?(this._reversed=!1,this.emit("repeat",this._object,this._repeat),this._startTime+=this._duration+this._repeatDelayTime):(this._repeat--,this._reversed=!0,this.emit("yoyo",this._object,this._repeat),this._startTime+=this._duration+this._yoyoDelayTime):(this._repeat--,this.emit("repeat",this._object,this._repeat),this._startTime+=this._duration+this._repeatDelayTime),!0}_handleEndPlaying(){this.emit("end",this._object);for(const t of this._chainedTweens)t.start(!1,this._startTime+this._duration);return this._isPlaying}updateTillEnd(){return!1===this._onStartCallbackFired&&(this.emit("start",this._object),this._onStartCallbackFired=!0),this._yoyo&&!this._reversed?this._updateProperties(this._object,this._valuesEnd,this._valuesStart,1):this._updateProperties(this._object,this._valuesStart,this._valuesEnd,1),this.emit("update",this._object,1),this.emit("end",this._object),this.endChainedTweens(),this._isPlaying=!1,!1}_setupProperties(t,e,s,n){for(const i in s){const r=t[i],a=Array.isArray(r),o=a?"array":typeof r,h=!a&&Array.isArray(s[i]);if("undefined"!==o&&"function"!==o){if(h){let t=s[i];if(0===t.length)continue;t=t.map(this._handleRelativeValue.bind(this,r)),s[i]=[r].concat(t)}if("object"!==o&&!a||!r||h)e[i]=r,a||(e[i]*=1),n[i]=h?s[i].slice().reverse():e[i]||0;else{e[i]=a?[]:{};for(const t in r)e[i][t]=r[t];n[i]=a?[]:{},this._setupProperties(r,e[i],s[i],n[i])}}}}_updateProperties(t,e,s,n){for(const i in s){if(void 0===e[i])continue;const r=e[i]||0;let a=s[i];const o=Array.isArray(t[i]),h=Array.isArray(a);!o&&h?t[i]=this._interpolationFunction(a,n):"object"==typeof a&&a?this._updateProperties(t[i],r,a,n):(a=this._handleRelativeValue(r,a),"number"==typeof a&&(t[i]=r+(a-r)*n))}}_handleRelativeValue(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)}_swapEndStartRepeatValues(t){const e=this._valuesStartRepeat[t],s=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof s?this._valuesStartRepeat[t]+parseFloat(s):this._valuesEnd[t],this._valuesEnd[t]=e}}class ng{constructor(){d(this,"_twMap"),d(this,"_tweensAddedDuringUpdate")}create(t,e,s,n=1e3){return new sg(t,e,this).to(s,n)}getByName(t){var e;return null==(e=this._twMap)?void 0:e.get(t)}size(){return void 0===this._twMap?0:this._twMap.size}add(t){void 0!==this._twMap&&void 0!==this._tweensAddedDuringUpdate||(this._twMap=new Map,this._tweensAddedDuringUpdate=new Map),this._twMap.set(t.name,t),this._tweensAddedDuringUpdate.set(t.name,t)}remove(t){var e,s;null==(e=this._twMap)||e.delete(t.name),null==(s=this._tweensAddedDuringUpdate)||s.delete(t.name)}getAll(){return void 0!==this._twMap?[...this._twMap.values()]:[]}removeAll(){var t,e;null==(t=this._twMap)||t.clear(),null==(e=this._tweensAddedDuringUpdate)||e.clear()}endAll(){this.updateTillEnd()}update(t){if(void 0===this._twMap||0==this._twMap.size||void 0===this._tweensAddedDuringUpdate)return;let e=[...this._twMap.keys()];for(;e.length>0;){this._tweensAddedDuringUpdate.clear();for(const s of e){const e=this._twMap.get(s);void 0!==e&&(!1===e.update(t)&&this._twMap.delete(e.name))}e=[...this._tweensAddedDuringUpdate.keys()]}}updateTillEnd(){if(void 0===this._twMap||0==this._twMap.size||void 0===this._tweensAddedDuringUpdate)return;let t=[...this._twMap.keys()];for(;t.length>0;){this._tweensAddedDuringUpdate.clear();for(const e of t){const t=this._twMap.get(e);void 0!==t&&(t.updateTillEnd(),this._twMap.delete(t.name))}t=[...this._tweensAddedDuringUpdate.keys()]}}}class ig extends(Zm(Jc)){constructor(t=!1){super(),this.sortableChildren=!0,t&&(this.eventMode="passive")}setObj(t,e,s){return void 0!==e&&(t.layer=e),void 0!==s&&(t.name=s),this}addObj(t,e,s){return void 0!==e&&(t.layer=e),void 0!==s&&(t.name=s),this.addChild(t),this}removeObj(t){this.removeChild(t)}useLocale(t){for(const e of this.children)Qm(e)&&e.useLocale(t)}}const rg=class extends ig{constructor(...t){super(!0),d(this,"tweens",new ng),d(this,"desz"),d(this,"sceneObjs"),d(this,"_frontChild"),d(this,"_backChild"),this.desz=new wh,t.length>0&&this.setDesiredSize(...t),this.update=this._update}setDesiredSize(...t){0==t.length?this.getLocalBounds(this.desz,!0):(t.length>=2&&(this.desz.width=t[0],this.desz.height=t[1]),t.length>=4&&(this.desz.x=t[2],this.desz.y=t[3])),zm(this.pivot,this._pivotRule,this.desz),this.debugBox&&this._drawDebugBox(this.desz)}get pivotRule(){return this._pivotRule}set pivotRule(t){this._pivotRule=t,zm(this.pivot,t,this.desz),this.debugBox&&this._drawDebugBox(this.desz)}refreshPivotPoint(){}get enable(){return this.update===this._update}set enable(t){this.update=t?this._update:globalThis.doNothing}_update(t){this.tweens.update(globalThis.pgame.TotalMS);for(const e of this.children){const s=e;s.visible&&s.update(t)}}addObjWithStyle(t,e,s){this.applyObjWithStyle(t,e,s),this.addChild(t)}applyObjWithStyle(t,e,s){const n=e[t.name];void 0!==n&&t.useViewStyle(n),Qm(t)&&t.useLocale(s)}sendObjToBack(t){void 0!==this._backChild&&(this._backChild.layer=Km.minLayer+1),t.layer=Km.minLayer,this._backChild=t}bringObjToFront(t){void 0!==this._frontChild&&(this._frontChild.layer=Km.maxLayer-1),t.layer=Km.maxLayer,this._frontChild=t}useViewStyle(t){super.useViewStyle(t),void 0!==t.dwh&&(this.desz.width=t.dwh[0],this.desz.height=t.dwh[1],this.setDesiredSize())}useViewStyleChildren(t){rg._viewStyleChildren(t,this.children)}static _viewStyleChildren(t,e){for(const s of e){const e=s,n=t[e.name];void 0!==n&&e.useViewStyle(n),og(e)&&e.useViewStyleChildren(t)}}get debugBox(){return void 0!==this._debugBox&&this._debugBox.visible}set debugBox(t){t?this._drawDebugBox(this.desz):this._hideDebugBox()}};let ag=rg;function og(t){return void 0!==t.desz}d(ag,"_debugFillStyle",(()=>{const t=new Ef;return t.visible=!0,t.color=Hm.White,t.alpha=.08,t})()),d(ag,"_debugLineStyle",(()=>{const t=new Sf;return t.visible=!0,t.color=Hm.Red,t.alpha=1,t.width=2.5,t})());class hg extends(Zm(Nf)){}const lg=/iPhone/i,cg=/iPod/i,ug=/iPad/i,dg=/\bAndroid(?:.+)Mobile\b/i,fg=/Android/i,pg=/Windows Phone/i,mg=/\bWindows(?:.+)ARM\b/i,gg=/BlackBerry/i,yg=/BB10/i,vg=/Opera Mini/i,xg=/\b(CriOS|Chrome)(?:.+)Mobile/i,_g=/Mobile(?:.+)Firefox\b/i,bg=t=>void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1;Element.prototype.requestFullscreen=Element.prototype.requestFullscreen||Element.prototype.mozRequestFullScreen||Element.prototype.webkitRequestFullscreen||Element.prototype.msRequestFullscreen||function(){return Promise.reject(new Error("Fullscreen API is not supported"))},Document.prototype.exitFullscreen=Document.prototype.exitFullscreen||Document.prototype.mozCancelFullScreen||Document.prototype.webkitExitFullscreen||Document.prototype.msExitFullscreen||function(){return Promise.reject(new Error("Fullscreen API is not supported"))};const wg=function(){const t=navigator;let e=t.userAgent,s=e.split("[FBAN");void 0!==s[1]&&(e=s[0]),s=e.split("Twitter"),void 0!==s[1]&&(e=s[0]);const n=t=>t.test(e),i={apple:{phone:n(lg)&&!n(pg),ipod:n(cg),tablet:!n(lg)&&(n(ug)||bg(t))&&!n(pg),any:!1},android:{phone:!n(pg)&&n(dg),tablet:!n(pg)&&!n(dg)&&n(fg),any:!1},windows:{phone:n(pg),tablet:n(mg),any:!1},other:{blackberry:n(gg)||n(yg),opera:n(vg),firefox:n(_g),chrome:n(xg),any:!1},any:!1,phone:!1,tablet:!1};return i.apple.any=i.apple.phone||i.apple.ipod||i.apple.tablet,i.android.any=i.android.phone||i.android.tablet||n(/\bokhttp\b/i),i.windows.any=i.windows.phone||i.windows.tablet,i.other.any=i.other.blackberry||i.other.opera||i.other.firefox||i.other.chrome,i.any=i.apple.any||i.android.any||i.windows.any||i.other.any,i.phone=i.apple.phone||i.android.phone||i.windows.phone,i.tablet=i.apple.tablet||i.android.tablet||i.windows.tablet,i}();function Eg(){return wg.any}function Sg(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||document.mozFullScreenElement)}function Tg(){document.documentElement.requestFullscreen().catch((()=>{}))}function Ag(){document.exitFullscreen().catch((()=>{}))}let Cg,Mg=!0,Ig=0;class Pg extends g{constructor(){super(),d(this,"_keySet",new Set)}listenKeyboard(t){t.addEventListener("keydown",(t=>{this._keySet.add(t.key),this.emit("down-any",t,this),this.emit(`down-${t.key}`,t,this)})),t.addEventListener("keyup",(t=>{this._keySet.delete(t.key),this.emit("up-any",t,this),this.emit(`up-${t.key}`,t,this)}))}isKeyDown(t){return this._keySet.has(t)}isKeyNotPressed(t){return!this._keySet.has(t)}canvasTapSnippet(t,e,s,n){const i=globalThis.pgame.stage,r=t=>{const e=t.global;n.getBounds(!0).contains(e.x,e.y)||(s(t),i.off("pointertapcapture",r),t.stopPropagation())};t.setOnClick((t=>{e(t),i.on("pointertapcapture",r)}))}}function Rg(t,e){for(const s in e)if(s in t){const n=t[s];"object"!=typeof n||Array.isArray(n)||Rg(n,e[s])}else t[s]=e[s]}function kg(t,e){for(const s in e){const n=t[s];"object"!=typeof n||Array.isArray(n)?t[s]=e[s]:kg(n,e[s])}}function Dg(){return Cg}Array.prototype.clear=function(){this.length=0},Array.prototype.front=function(){return this[0]},Array.prototype.back=function(){return this[this.length-1]},Array.prototype.moveToBack=function(t){let e=this[t];this.splice(t,1),this.push(e)},Array.prototype.swap=function(t,e){let s=this[t];this[t]=this[e],this[e]=s},Array.prototype.removeOnce=function(t){let e=this.indexOf(t);return e>-1&&this.splice(e,1),this},Array.prototype.union=function(t){return[...new Set([...this,...t])]},Array.prototype.intersect=function(t){return this.filter((e=>t.includes(e)))},Array.prototype.diff=function(t){return this.filter((e=>!t.includes(e)))},Array.isEqual=function(t,e){if(t.length!=e.length)return!1;for(let s of Array.range(t.length))if(t[s]!=e[s])return!1;return!0},Array.rangeFrom=function(t,e,s){return void 0===s&&(s=1),void 0===e&&(e=t,t=0),Array.from({length:(e-t)/s},((e,n)=>t+n*s))},Array.range=function(t,e,s){void 0===s&&(s=1),void 0===e&&(e=t,t=0);return function*(){for(let n=t;n!=e;n+=s)yield n}()},String.prototype.mapReplace=function(t){let e=this.toString();for(let[s,n]of t)e=e.replace(s,n);return e},String.prototype.format=function(...t){let e=this.toString();for(let s=0;s<t.length;s++)e=e.replace(`{${s}}`,t[s]);return e},Number.prototype.pad=function(t,e){return String(this).padStart(t,e)},Number.prototype.pad0=function(t){return String(this).padStart(t,"0")},Object.removeUndef=function(t){Object.keys(t).forEach((e=>void 0===t[e]&&delete t[e]))},Object.merge=function(t,e,s=!0){s?Rg(t,e):kg(t,e)},Object.rename=function(t,e,s){const n=t[e];void 0!==n&&(delete t[e],t[s]=n)},Set.prototype.union=function(t){return new Set([...this,...t])},Set.prototype.intersect=function(t){return new Set(Array.from(this).filter((e=>t.has(e))))},Set.prototype.diff=function(t){return new Set(Array.from(this).filter((e=>!t.has(e))))},Math.randInt=function(t){return Math.floor(Math.random()*t)},Math.randPickFromProbs=function(t){let e=[];for(let n=0;n<t.length;n++)e.push([t[n],n]);e.sort(((t,e)=>t[0]-e[0]));for(let n=1;n<t.length;n++)e[n][0]+=e[n-1][0];let s=Math.random();for(let[n,i]of e)if(s<=n)return i;return-1},Math.shuffle=function(t,e){void 0===e&&(e=t.length);for(let s=0;s<e;s++)t.swap(s,Math.randInt(t.length))};let Fg=0;const Og=class extends g{constructor(t){super(),this.id=Fg++,this.init(t)}set(t,e){if(void 0===this[t])throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"paused":this.paused=e;break;case"loop":this.loop=e;break;case"muted":this.muted=e}return this}get progress(){const{currentTime:t}=this._source;return t/this._duration}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}_onPlay(){this._playing=!0}_onPause(){this._playing=!1}init(t){this._playing=!1,this._duration=t.source.duration;const e=this._source=t.source.cloneNode(!1);e.src=t.parent.url,e.onplay=this._onPlay.bind(this),e.onpause=this._onPause.bind(this),t.context.on("refresh",this.refresh,this),t.context.on("refreshPaused",this.refreshPaused,this),this._media=t}_internalStop(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())}stop(){this._internalStop(),this._source&&this.emit("stop")}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh()}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(t){console.warn("HTML Audio does not support filters")}refresh(){const t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;const s=t.volume*(t.muted?0:1),n=e.volume*(e.muted?0:1),i=this._volume*(this._muted?0:1);this._source.volume=i*s*n,this._source.playbackRate=this._speed*t.speed*e.speed}refreshPaused(){const t=this._media.context,e=this._media.parent,s=this._paused||e.paused||t.paused;s!==this._pausedReal&&(this._pausedReal=s,s?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",s))}play(t){const{start:e,end:s,speed:n,loop:i,volume:r,muted:a}=t;s&&console.assert(s>e,"End time is before start time"),this._speed=n,this._volume=r,this._loop=!!i,this._muted=a,this.refresh(),this.loop&&null!==s&&(console.warn('Looping not support when specifying an "end" time'),this.loop=!1),this._start=e,this._end=s||this._duration,this._start=Math.max(0,this._start-Og.PADDING),this._end=Math.min(this._end+Og.PADDING,this._duration),this._source.onloadedmetadata=()=>{this._source&&(this._source.currentTime=e,this._source.onloadedmetadata=null,this.emit("progress",e,this._duration),Ic.shared.add(this._onUpdate,this))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")}_onUpdate(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()}_onComplete(){Ic.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)}destroy(){Ic.shared.remove(this._onUpdate,this),this.removeAllListeners();const t=this._source;t&&(t.onended=null,t.onplay=null,t.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)}toString(){return`[HTMLAudioInstance id=${this.id}]`}};let Ng=Og;Ng.PADDING=.1;let Bg=class extends g{init(t){this.parent=t,this._source=t.options.source||new Audio,t.url&&(this._source.src=t.url)}create(){return new Ng(this)}get isPlayable(){return!!this._source&&4===this._source.readyState}get duration(){return this._source.duration}get context(){return this.parent.context}get filters(){return null}set filters(t){console.warn("HTML Audio does not support filters")}destroy(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)}get source(){return this._source}load(t){const e=this._source,s=this.parent;if(4===e.readyState){s.isLoaded=!0;const e=s.autoPlayStart();return void(t&&setTimeout((()=>{t(null,s,e)}),0))}if(!s.url)return void t(new Error("sound.url or sound.source must be set"));e.src=s.url;const n=()=>{a(),s.isLoaded=!0;const e=s.autoPlayStart();t&&t(null,s,e)},i=()=>{a(),t&&t(new Error("Sound loading has been aborted"))},r=()=>{a();const s=`Failed to load audio element (code: ${e.error.code})`;t?t(new Error(s)):console.error(s)},a=()=>{e.removeEventListener("canplaythrough",n),e.removeEventListener("load",n),e.removeEventListener("abort",i),e.removeEventListener("error",r)};e.addEventListener("canplaythrough",n,!1),e.addEventListener("load",n,!1),e.addEventListener("abort",i,!1),e.addEventListener("error",r,!1),e.load()}},Lg=class{static setParamValue(t,e){if(t.setValueAtTime){const s=Dg().context;t.setValueAtTime(e,s.audioContext.currentTime)}else t.value=e;return e}},Vg=0,$g=class extends g{constructor(t){super(),this.id=Vg++,this._media=null,this._paused=!1,this._muted=!1,this._elapsed=0,this.init(t)}set(t,e){if(void 0===this[t])throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"muted":this.muted=e;break;case"loop":this.loop=e;break;case"paused":this.paused=e}return this}stop(){this._source&&(this._internalStop(),this.emit("stop"))}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh(),this._update(!0)}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get filters(){return this._filters}set filters(t){var e;this._filters&&(null==(e=this._filters)||e.filter((t=>t)).forEach((t=>t.disconnect())),this._filters=null,this._source.connect(this._gain)),this._filters=null!=t&&t.length?t.slice(0):null,this.refresh()}refresh(){if(!this._source)return;const t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;const s=t.volume*(t.muted?0:1),n=e.volume*(e.muted?0:1),i=this._volume*(this._muted?0:1);Lg.setParamValue(this._gain.gain,i*n*s),Lg.setParamValue(this._source.playbackRate,this._speed*e.speed*t.speed),this.applyFilters()}applyFilters(){var t;if(null!=(t=this._filters)&&t.length){this._source.disconnect();let t=this._source;this._filters.forEach((e=>{t.connect(e.destination),t=e})),t.connect(this._gain)}}refreshPaused(){const t=this._media.context,e=this._media.parent,s=this._paused||e.paused||t.paused;s!==this._pausedReal&&(this._pausedReal=s,s?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",s))}play(t){const{start:e,end:s,speed:n,loop:i,volume:r,muted:a,filters:o}=t;s&&console.assert(s>e,"End time is before start time"),this._paused=!1;const{source:h,gain:l}=this._media.nodes.cloneBufferSource();this._source=h,this._gain=l,this._speed=n,this._volume=r,this._loop=!!i,this._muted=a,this._filters=o,this.refresh();const c=this._source.buffer.duration;this._duration=c,this._end=s,this._lastUpdate=this._now(),this._elapsed=e,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=s,this._source.loopStart=e,this._source.start(0,e)):s?this._source.start(0,e,s-e):this._source.start(0,e),this.emit("start"),this._update(!0),this.enableTicker(!0)}enableTicker(t){Ic.shared.remove(this._updateListener,this),t&&Ic.shared.add(this._updateListener,this)}get progress(){return this._progress}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}destroy(){var t;this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),null==(t=this._filters)||t.forEach((t=>t.disconnect())),this._filters=null,this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1}toString(){return`[WebAudioInstance id=${this.id}]`}_now(){return this._media.context.audioContext.currentTime}_updateListener(){this._update()}_update(t=!1){if(this._source){const e=this._now(),s=e-this._lastUpdate;if(s>0||t){const t=this._source.playbackRate.value;this._elapsed+=s*t,this._lastUpdate=e;const n=this._duration;let i;if(this._source.loopStart){const t=this._source.loopEnd-this._source.loopStart;i=(this._source.loopStart+this._elapsed%t)/n}else i=this._elapsed%n/n;this._progress=i,this.emit("progress",this._progress,n)}}}init(t){this._media=t,t.context.events.on("refresh",this.refresh,this),t.context.events.on("refreshPaused",this.refreshPaused,this)}_internalStop(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null}}_onComplete(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}}this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)}},Ug=class{constructor(t,e){this._output=e,this._input=t}get destination(){return this._input}get filters(){return this._filters}set filters(t){if(this._filters&&(this._filters.forEach((t=>{t&&t.disconnect()})),this._filters=null,this._input.connect(this._output)),t&&t.length){this._filters=t.slice(0),this._input.disconnect();let e=null;t.forEach((t=>{null===e?this._input.connect(t.destination):e.connect(t.destination),e=t})),e.connect(this._output)}}destroy(){this.filters=null,this._input=null,this._output=null}};const Xg=class extends Ug{constructor(t){const e=t.audioContext,s=e.createBufferSource(),n=e.createGain(),i=e.createAnalyser();s.connect(i),i.connect(n),n.connect(t.destination),super(i,n),this.context=t,this.bufferSource=s,this.gain=n,this.analyser=i}get script(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(Xg.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script}destroy(){super.destroy(),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null}cloneBufferSource(){const t=this.bufferSource,e=this.context.audioContext.createBufferSource();e.buffer=t.buffer,Lg.setParamValue(e.playbackRate,t.playbackRate.value),e.loop=t.loop;const s=this.context.audioContext.createGain();return e.connect(s),s.connect(this.destination),{source:e,gain:s}}get bufferSize(){return this.script.bufferSize}};let Yg=Xg;Yg.BUFFER_SIZE=0;let Wg=class{init(t){this.parent=t,this._nodes=new Yg(this.context),this._source=this._nodes.bufferSource,this.source=t.options.source}destroy(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch(t){console.warn("Failed to set AudioBufferSourceNode.buffer to null:",t)}this._source=null,this.source=null}create(){return new $g(this)}get context(){return this.parent.context}get isPlayable(){return!!this._source&&!!this._source.buffer}get filters(){return this._nodes.filters}set filters(t){this._nodes.filters=t}get duration(){return console.assert(this.isPlayable,"Sound not yet playable, no duration"),this._source.buffer.duration}get buffer(){return this._source.buffer}set buffer(t){this._source.buffer=t}get nodes(){return this._nodes}load(t){this.source?this._decode(this.source,t):this.parent.url?this._loadUrl(t):t?t(new Error("sound.url or sound.source must be set")):console.error("sound.url or sound.source must be set")}_loadUrl(t){return f(this,null,(function*(){const e=this.parent.url,s=yield _r.ADAPTER.fetch(e);this._decode(yield s.arrayBuffer(),t)}))}_decode(t,e){const s=(t,s)=>{if(t)e&&e(t);else{this.parent.isLoaded=!0,this.buffer=s;const t=this.parent.autoPlayStart();e&&e(null,this.parent,t)}};t instanceof AudioBuffer?s(null,t):this.parent.context.decode(t,s)}};var jg=Object.defineProperty,zg=Object.getOwnPropertySymbols,Gg=Object.prototype.hasOwnProperty,Hg=Object.prototype.propertyIsEnumerable,qg=(t,e,s)=>e in t?jg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Kg=(t,e)=>{for(var s in e||(e={}))Gg.call(e,s)&&qg(t,s,e[s]);if(zg)for(var s of zg(e))Hg.call(e,s)&&qg(t,s,e[s]);return t};const Zg=class{static from(t){let e={};"string"==typeof t?e.url=t:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?e.source=t:e=t,e=Kg({autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1},e),Object.freeze(e);const s=Dg().useLegacy?new Bg:new Wg;return new Zg(s,e)}constructor(t,e){this.media=t,this.options=e,this._instances=[],this._sprites={},this.media.init(this);const s=e.complete;this._autoPlayOptions=s?{complete:s}:null,this.isLoaded=!1,this.isPlaying=!1,this.autoPlay=e.autoPlay,this.singleInstance=e.singleInstance,this.preload=e.preload||this.autoPlay,this.url=e.url,this.speed=e.speed,this.volume=e.volume,this.loop=e.loop,e.sprites&&this.addSprites(e.sprites),this.preload&&this._preload(e.loaded)}get context(){return Dg().context}pause(){return this.isPlaying=!1,this.paused=!0,this}resume(){return this.isPlaying=this._instances.length>0,this.paused=!1,this}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh()}get filters(){return this.media.filters}set filters(t){this.media.filters=t}addSprites(t,e){if("object"==typeof t){const e={};for(const s in t)e[s]=this.addSprites(s,t[s]);return e}console.assert(!this._sprites[t],`Alias ${t} is already taken`);const s=new class{constructor(t,e){this.parent=t,Object.assign(this,e),this.duration=this.end-this.start,console.assert(this.duration>0,"End time must be after start time")}play(t){return this.parent.play({complete:t,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})}destroy(){this.parent=null}}(this,e);return this._sprites[t]=s,s}destroy(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null}removeSprites(t){if(t){const e=this._sprites[t];void 0!==e&&(e.destroy(),delete this._sprites[t])}else for(const e in this._sprites)this.removeSprites(e);return this}get isPlayable(){return this.isLoaded&&this.media&&this.media.isPlayable}stop(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(let t=this._instances.length-1;t>=0;t--)this._instances[t].stop();return this}play(t,e){let s;if("string"==typeof t?s={sprite:t,loop:this.loop,complete:e}:"function"==typeof t?(s={},s.complete=t):s=t,s=Kg({complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1},s||{}),s.sprite){const t=s.sprite;console.assert(!!this._sprites[t],`Alias ${t} is not available`);const e=this._sprites[t];s.start=e.start+(s.start||0),s.end=e.end,s.speed=e.speed||1,s.loop=e.loop||s.loop,delete s.sprite}if(s.offset&&(s.start=s.offset),!this.isLoaded)return new Promise(((t,e)=>{this.autoPlay=!0,this._autoPlayOptions=s,this._preload(((n,i,r)=>{n?e(n):(s.loaded&&s.loaded(n,i,r),t(r))}))}));(this.singleInstance||s.singleInstance)&&this._removeInstances();const n=this._createInstance();return this._instances.push(n),this.isPlaying=!0,n.once("end",(()=>{s.complete&&s.complete(this),this._onComplete(n)})),n.once("stop",(()=>{this._onComplete(n)})),n.play(s),n}refresh(){const t=this._instances.length;for(let e=0;e<t;e++)this._instances[e].refresh()}refreshPaused(){const t=this._instances.length;for(let e=0;e<t;e++)this._instances[e].refreshPaused()}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}_preload(t){this.media.load(t)}get instances(){return this._instances}get sprites(){return this._sprites}get duration(){return this.media.duration}autoPlayStart(){let t;return this.autoPlay&&(t=this.play(this._autoPlayOptions)),t}_removeInstances(){for(let t=this._instances.length-1;t>=0;t--)this._poolInstance(this._instances[t]);this._instances.length=0}_onComplete(t){if(this._instances){const e=this._instances.indexOf(t);e>-1&&this._instances.splice(e,1),this.isPlaying=this._instances.length>0}this._poolInstance(t)}_createInstance(){if(Zg._pool.length>0){const t=Zg._pool.pop();return t.init(this.media),t}return this.media.create()}_poolInstance(t){t.destroy(),Zg._pool.indexOf(t)<0&&Zg._pool.push(t)}};let Qg=Zg;Qg._pool=[];let Jg=class extends g{constructor(){super(...arguments),this.speed=1,this.muted=!1,this.volume=1,this.paused=!1}refresh(){this.emit("refresh")}refreshPaused(){this.emit("refreshPaused")}get filters(){return console.warn("HTML Audio does not support filters"),null}set filters(t){console.warn("HTML Audio does not support filters")}get audioContext(){return console.warn("HTML Audio does not support audioContext"),null}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this.paused}destroy(){this.removeAllListeners()}};class ty extends Ug{constructor(){const t=window,e=new ty.AudioContext,s=e.createDynamicsCompressor(),n=e.createAnalyser();n.connect(s),s.connect(e.destination),super(n,s),this._ctx=e,this._offlineCtx=new ty.OfflineAudioContext(1,2,t.OfflineAudioContext?Math.max(8e3,Math.min(96e3,e.sampleRate)):44100),this._unlocked=!1,this.compressor=s,this.analyser=n,this.events=new g,this.volume=1,this.speed=1,this.muted=!1,this.paused=!1,"running"!==e.state&&(this._unlock(),this._unlock=this._unlock.bind(this),document.addEventListener("mousedown",this._unlock,!0),document.addEventListener("touchstart",this._unlock,!0),document.addEventListener("touchend",this._unlock,!0))}_unlock(){this._unlocked||(this.playEmptySound(),"running"===this._ctx.state&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._unlocked=!0))}playEmptySound(){const t=this._ctx.createBufferSource();t.buffer=this._ctx.createBuffer(1,1,22050),t.connect(this._ctx.destination),t.start(0,0,0),"suspended"===t.context.state&&t.context.resume()}static get AudioContext(){const t=window;return t.AudioContext||t.webkitAudioContext||null}static get OfflineAudioContext(){const t=window;return t.OfflineAudioContext||t.webkitOfflineAudioContext||null}destroy(){super.destroy();const t=this._ctx;void 0!==t.close&&t.close(),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null}get audioContext(){return this._ctx}get offlineContext(){return this._offlineCtx}set paused(t){t&&"running"===this._ctx.state?this._ctx.suspend():!t&&"suspended"===this._ctx.state&&this._ctx.resume(),this._paused=t}get paused(){return this._paused}refresh(){this.events.emit("refresh")}refreshPaused(){this.events.emit("refreshPaused")}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this._paused}decode(t,e){const s=t=>{e(new Error((null==t?void 0:t.message)||"Unable to decode file"))},n=this._offlineCtx.decodeAudioData(t,(t=>{e(null,t)}),s);n&&n.catch(s)}}var ey=Object.defineProperty,sy=Object.getOwnPropertySymbols,ny=Object.prototype.hasOwnProperty,iy=Object.prototype.propertyIsEnumerable,ry=(t,e,s)=>e in t?ey(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ay=(t,e)=>{for(var s in e||(e={}))ny.call(e,s)&&ry(t,s,e[s]);if(sy)for(var s of sy(e))iy.call(e,s)&&ry(t,s,e[s]);return t};let oy=class{constructor(){this.init()}init(){return this.supported&&(this._webAudioContext=new ty),this._htmlAudioContext=new Jg,this._sounds={},this.useLegacy=!this.supported,this}get context(){return this._context}get filtersAll(){return this.useLegacy?[]:this._context.filters}set filtersAll(t){this.useLegacy||(this._context.filters=t)}get supported(){return null!==ty.AudioContext}add(t,e){if("object"==typeof t){const s={};for(const n in t){const i=this._getOptions(t[n],e);s[n]=this.add(n,i)}return s}if(console.assert(!this._sounds[t],`Sound with alias ${t} already exists.`),e instanceof Qg)return this._sounds[t]=e,e;const s=this._getOptions(e),n=Qg.from(s);return this._sounds[t]=n,n}_getOptions(t,e){let s;return s="string"==typeof t?{url:t}:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?{source:t}:t,s=ay(ay({},s),e||{}),s}get useLegacy(){return this._useLegacy}set useLegacy(t){this._useLegacy=t,this._context=!t&&this.supported?this._webAudioContext:this._htmlAudioContext}remove(t){return this.exists(t,!0),this._sounds[t].destroy(),delete this._sounds[t],this}get volumeAll(){return this._context.volume}set volumeAll(t){this._context.volume=t,this._context.refresh()}get speedAll(){return this._context.speed}set speedAll(t){this._context.speed=t,this._context.refresh()}togglePauseAll(){return this._context.togglePause()}pauseAll(){return this._context.paused=!0,this._context.refreshPaused(),this}resumeAll(){return this._context.paused=!1,this._context.refreshPaused(),this}toggleMuteAll(){return this._context.toggleMute()}muteAll(){return this._context.muted=!0,this._context.refresh(),this}unmuteAll(){return this._context.muted=!1,this._context.refresh(),this}removeAll(){for(const t in this._sounds)this._sounds[t].destroy(),delete this._sounds[t];return this}stopAll(){for(const t in this._sounds)this._sounds[t].stop();return this}exists(t,e=!1){const s=!!this._sounds[t];return e&&console.assert(s,`No sound matching alias '${t}'.`),s}find(t){return this.exists(t,!0),this._sounds[t]}play(t,e){return this.find(t).play(e)}stop(t){return this.find(t).stop()}pause(t){return this.find(t).pause()}resume(t){return this.find(t).resume()}volume(t,e){const s=this.find(t);return void 0!==e&&(s.volume=e),s.volume}speed(t,e){const s=this.find(t);return void 0!==e&&(s.speed=e),s.speed}duration(t){return this.find(t).duration}close(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this}};var hy={__proto__:null,HTMLAudioMedia:Bg,HTMLAudioInstance:Ng,HTMLAudioContext:Jg},ly=$g;let cy=0;var uy=Object.defineProperty,dy=Object.getOwnPropertySymbols,fy=Object.prototype.hasOwnProperty,py=Object.prototype.propertyIsEnumerable,my=(t,e,s)=>e in t?uy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,gy=(t,e)=>{for(var s in e||(e={}))fy.call(e,s)&&my(t,s,e[s]);if(dy)for(var s of dy(e))py.call(e,s)&&my(t,s,e[s]);return t};var yy=Object.defineProperty,vy=Object.getOwnPropertySymbols,xy=Object.prototype.hasOwnProperty,_y=Object.prototype.propertyIsEnumerable,by=(t,e,s)=>e in t?yy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,wy=(t,e)=>{for(var s in e||(e={}))xy.call(e,s)&&by(t,s,e[s]);if(vy)for(var s of vy(e))_y.call(e,s)&&by(t,s,e[s]);return t};const Ey=["mp3","ogg","oga","opus","mpeg","wav","m4a","aiff","wma","mid","caf"],Sy={};function Ty(t){const e=wy({m4a:"audio/mp4",oga:"audio/ogg",opus:'audio/ogg; codecs="opus"',caf:'audio/x-caf; codecs="opus"'},t||{}),s=document.createElement("audio"),n={},i=/^no$/;Ey.forEach((t=>{const r=s.canPlayType(`audio/${t}`).replace(i,""),a=e[t]?s.canPlayType(e[t]).replace(i,""):"";n[t]=!!r||!!a})),Object.assign(Sy,n)}Ty();var Ay={__proto__:null,playOnce:function(t,e){const s="alias"+cy++;return Dg().add(s,{url:t,preload:!0,autoPlay:!0,loaded:t=>{t&&(console.error(t),Dg().remove(s),e&&e(t))},complete:()=>{Dg().remove(s),e&&e(null)}}),s},get PLAY_ID(){return cy},render:function(t,e){const s=document.createElement("canvas");e=gy({width:512,height:128,fill:"black"},e||{}),s.width=e.width,s.height=e.height;const n=rh.from(s);if(!(t.media instanceof Wg))return n;const i=t.media;console.assert(!!i.buffer,"No buffer found, load first");const r=s.getContext("2d");r.fillStyle=e.fill;const a=i.buffer.getChannelData(0),o=Math.ceil(a.length/e.width),h=e.height/2;for(let l=0;l<e.width;l++){let t=1,e=-1;for(let s=0;s<o;s++){const n=a[l*o+s];n<t&&(t=n),n>e&&(e=n)}r.fillRect(l,(1+t)*h,1,Math.max(1,(e-t)*h))}return n},sineTone:function(t=200,e=1){const s=Qg.from({singleInstance:!0});if(!(s.media instanceof Wg))return s;const n=s.media,i=s.context.audioContext.createBuffer(1,48e3*e,48e3),r=i.getChannelData(0);for(let a=0;a<r.length;a++){const e=t*(a/i.sampleRate)*Math.PI;r[a]=2*Math.sin(e)}return n.buffer=i,s.isLoaded=!0,s},validateFormats:Ty,supported:Sy,extensions:Ey},Cy=Object.defineProperty,My=Object.defineProperties,Iy=Object.getOwnPropertyDescriptors,Py=Object.getOwnPropertySymbols,Ry=Object.prototype.hasOwnProperty,ky=Object.prototype.propertyIsEnumerable,Dy=(t,e,s)=>e in t?Cy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;const Fy=t=>{var e,s;const n=t.src;return null!=(s=null==(e=null==t?void 0:t.alias)?void 0:e[0])?s:Va.basename(n,Va.extname(n))},Oy={extension:Wo.Asset,detection:{test:()=>f(void 0,null,(function*(){return!0})),add:t=>f(void 0,null,(function*(){return[...t,...Ey.filter((t=>Sy[t]))]})),remove:t=>f(void 0,null,(function*(){return t.filter((e=>t.includes(e)))}))},loader:{extension:{type:[Wo.LoadParser],priority:Vu.High},test(t){const e=Va.extname(t).slice(1);return!!Sy[e]},load(t,e){return f(this,null,(function*(){const s=yield new Promise(((s,n)=>Qg.from(((t,e)=>My(t,Iy(e)))(((t,e)=>{for(var s in e||(e={}))Ry.call(e,s)&&Dy(t,s,e[s]);if(Py)for(var s of Py(e))ky.call(e,s)&&Dy(t,s,e[s]);return t})({},e.data),{url:t,preload:!0,loaded(t,i){var r,a;t?n(t):s(i),null==(a=null==(r=e.data)?void 0:r.loaded)||a.call(r,t,i)}}))));return Dg().add(Fy(e),s),s}))},unload(t,e){return f(this,null,(function*(){Dg().remove(Fy(e))}))}}};Go.add(Oy);const Ny=(By=new oy,Cg=By,By);var By;class Ly{constructor(t){d(this,"list"),d(this,"_volume",1),d(this,"_muted",!1),this.list=t;for(const e of this.list)e.group=this}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}refresh(){for(const t of this.list)t.refresh()}}class Vy{constructor(t){d(this,"prev",null),d(this,"current",null),d(this,"list"),this.list=t;for(const e of this.list)e.mutexGroup=this,e.singleInstance=!0}}function $y(t,e){const s=t.sound;if(t.firstPlayed){if(t.fadeIn&&(t.fadeIn.startMS=pgame.TotalMS,t.fadeIn.endMS=pgame.TotalMS+t.fadeIn.timeMS),t.fadeOut){let n=1e3*((e.end||s.duration)-e.start);t.fadeOut.startMS=pgame.TotalMS+n-t.fadeOut.timeMS,t.fadeOut.endMS=pgame.TotalMS+n,t.fadeOut.wantsTo=" ",t.fadeOut.canStop=!1}}else{t.firstPlayed=!0;const n=e.fadeIn||s.fadeIn,i=e.fadeOut||s.fadeOut;if(!n&&!i)return;if(n&&(t.fadeIn={timeMS:n,startMS:pgame.TotalMS,endMS:pgame.TotalMS+n}),i){let n=1e3*(e.end||s.duration);t.fadeOut={timeMS:i,startMS:pgame.TotalMS+n-i,endMS:pgame.TotalMS+n,wantsTo:" ",canStop:!1}}const r=e.volume,a=(e,s)=>{if(t.fadeOut&&(" "!=t.fadeOut.wantsTo||!t.loopReal)&&pgame.TotalMS>=t.fadeOut.startMS){let e=(pgame.TotalMS-t.fadeOut.startMS)/t.fadeOut.timeMS;e=Math.min(e,1),1==e?(t.fadeOut.canStop=!0,"stop"==t.fadeOut.wantsTo?t.stop():"pause"==t.fadeOut.wantsTo&&t.refreshPaused()):t.volume=(1-e)*r}else if(t.fadeIn&&(pgame.TotalMS<=t.fadeIn.endMS||t.volume<r)){let e=(pgame.TotalMS-t.fadeIn.startMS)/t.fadeIn.timeMS;e=Math.min(e,1),t.volume=e*r}};t.on("progress",a)}}function Uy(t,e){const s=t.fadeOut;return!s||(s.wantsTo!=e?(s.wantsTo=e,s.startMS=pgame.TotalMS,s.endMS=Math.min(s.endMS,pgame.TotalMS+s.timeMS),!1):s.canStop)}function Xy(t){if(t.mutexGroup){if(t.mutexGroup.current){const e=t.mutexGroup.current;e.isPlaying&&(e.mutexPause?e.pause():e.stop()),t.mutexGroup.prev=e}t.mutexGroup.current=t}}const Yy=ly.prototype,Wy={init:Yy.init,play:Yy.play,stop:Yy.stop,refreshPaused:Yy.refreshPaused},jy=hy.HTMLAudioInstance.prototype,zy={init:jy.init,play:jy.play,stop:jy.stop,refreshPaused:jy.refreshPaused},Gy=Qg.prototype,Hy={play:Gy.play,resume:Gy.resume},qy=oy.prototype;Yy.init=function(t){this.firstPlayed=!1,Wy.init.call(this,t)},Yy.play=function(t){$y(this,t),Wy.play.call(this,t)},Yy.stop=function(){Uy(this,"stop")&&Wy.stop.call(this)},Yy.refreshPaused=function(){Uy(this,"pause")&&Wy.refreshPaused.call(this)},Object.defineProperties(Yy,{sound:{get:function(){return this._media.parent}},loopReal:{get:function(){return this._loop||this._media.parent.loop}}}),jy.init=function(t){this.firstPlayed=!1,zy.init.call(this,t)},jy.play=function(t){$y(this,t),zy.play.call(this,t)},jy.stop=function(){Uy(this,"stop")&&zy.stop.call(this)},jy.refreshPaused=function(){Uy(this,"pause")&&zy.refreshPaused.call(this)},Object.defineProperties(jy,{sound:{get:function(){return this._media.parent}},loopReal:{get:function(){return this._loop||this._media.parent.loop}}}),Gy.play=function(t,e){return Xy(this),Hy.play.call(this,t,e)},Gy.resume=function(){return Xy(this),Hy.resume.call(this)},Object.defineProperties(Gy,{volume:{get:function(){return this.group?this.group.volume*this._volume:this._volume}},muted:{get:function(){var t;return(null==(t=this.group)?void 0:t.muted)||this._muted}},selfVolume:{get:function(){return this._volume}},selfMuted:{get:function(){return this._muted}}}),Ny.groups={},Ny.mutexGroups={},qy.setGroup=function(t,e){const s=Object.fromEntries(Object.entries(e).map((([t,e])=>[t,this.find(e)])));return this.groups[t]=new Ly(Object.values(s)),s},qy.setMutexGroup=function(t,e){const s="string"==typeof e[0]?e.map((t=>this.find(t))):e;return this.mutexGroups[t]=new Vy(s),s};const Ky=Ay.supported,Zy=Object.freeze(Object.defineProperty({__proto__:null,SupportedSoundExts:Ky,arrToObj:function(t){const e={};for(let s of Array.range(t.length))e[s]=t[s];return e},assignPair:function(t,e){t.x=e[0],t.y=e[1]},assignPivotPoint:zm,assignPivotPointRatio:Gm,assignPoint:function(t,e){t.x=e.x,t.y=e.y},bufferToBase64:function(t,e){return f(this,null,(function*(){const s=yield new Promise((s=>{const n=new FileReader;n.onload=()=>s(n.result),n.readAsDataURL(new Blob([t],{type:e}))}));return void 0===e?s.split(",",2)[1]:s}))},distance:function(t,e){let s=t.x-e.x,n=t.y-e.y;return Math.sqrt(s*s+n*n)},distance2:function(t,e){let s=t.x-e.x,n=t.y-e.y;return s*s+n*n},doubleTapEnterFullscreen:function(){if(Mg)return Tg(),void(Mg=!1);let t=performance.now(),e=t-Ig;e<600&&e>0&&Tg(),Ig=t},enterFullscreen:Tg,exitFullscreen:Ag,isApple:function(){return wg.apple.any},isContainer:og,isFirefox:function(){return navigator.userAgent.includes("Firefox")},isFullscreen:Sg,isGraphicObject:function(t){return void 0!==t.useViewStyle},isKeyDown:function(t){var e;return!!(null==(e=pgame.interact)?void 0:e.isKeyDown(t))},isKeyNotPressed:function(t){var e;return!(null==(e=pgame.interact)?void 0:e.isKeyDown(t))},isLocalizedObject:Qm,isMinimalContainer:function(t){return void 0!==t.addObj},isMobile:Eg,isMobileResult:wg,pnt2:function(t){return{x:t,y:t}},recurseEventMode:function t(e,s){for(const n of e.children)n.eventMode=s,void 0!==n.children&&t(n,s)},shared:Km,soundAsset:Oy,toggleFullscreen:function(){Sg()?Ag():Tg()},unpackPoint:function(t){return{x:t[0],y:t[1]}}},Symbol.toStringTag,{value:"Module"}));var Qy,Jy={};Qy={get exports(){return Jy},set exports(t){Jy=t}},function(){function t(t,e){document.addEventListener?t.addEventListener("scroll",e,!1):t.attachEvent("scroll",e)}function e(t){this.g=document.createElement("div"),this.g.setAttribute("aria-hidden","true"),this.g.appendChild(document.createTextNode(t)),this.h=document.createElement("span"),this.i=document.createElement("span"),this.m=document.createElement("span"),this.j=document.createElement("span"),this.l=-1,this.h.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.i.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.j.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.m.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.h.appendChild(this.m),this.i.appendChild(this.j),this.g.appendChild(this.h),this.g.appendChild(this.i)}function s(t,e){t.g.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:"+e+";"}function n(t){var e=t.g.offsetWidth,s=e+100;return t.j.style.width=s+"px",t.i.scrollLeft=s,t.h.scrollLeft=t.h.scrollWidth+100,t.l!==e&&(t.l=e,!0)}function i(e,s){function i(){var t=r;n(t)&&null!==t.g.parentNode&&s(t.l)}var r=e;t(e.h,i),t(e.i,i),n(e)}function r(t,e,s){e=e||{},s=s||window,this.family=t,this.style=e.style||"normal",this.weight=e.weight||"normal",this.stretch=e.stretch||"normal",this.context=s}var a=null,o=null,h=null,l=null;function c(t){return null===l&&(l=!!t.document.fonts),l}function u(t,e){var s=t.style,n=t.weight;if(null===h){var i=document.createElement("div");try{i.style.font="condensed 100px sans-serif"}catch(r){}h=""!==i.style.font}return[s,n,h?t.stretch:"","100px",e].join(" ")}r.prototype.load=function(t,n){var r=this,h=t||"BESbswy",l=0,d=n||3e3,f=(new Date).getTime();return new Promise((function(t,n){if(c(r.context)&&!function(t){return null===o&&(c(t)&&/Apple/.test(window.navigator.vendor)?(t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))(?:\.([0-9]+))/.exec(window.navigator.userAgent),o=!!t&&603>parseInt(t[1],10)):o=!1),o}(r.context)){var p=new Promise((function(t,e){!function s(){(new Date).getTime()-f>=d?e(Error(d+"ms timeout exceeded")):r.context.document.fonts.load(u(r,'"'+r.family+'"'),h).then((function(e){1<=e.length?t():setTimeout(s,25)}),e)}()})),m=new Promise((function(t,e){l=setTimeout((function(){e(Error(d+"ms timeout exceeded"))}),d)}));Promise.race([m,p]).then((function(){clearTimeout(l),t(r)}),n)}else!function(t){document.body?t():document.addEventListener?document.addEventListener("DOMContentLoaded",(function e(){document.removeEventListener("DOMContentLoaded",e),t()})):document.attachEvent("onreadystatechange",(function e(){"interactive"!=document.readyState&&"complete"!=document.readyState||(document.detachEvent("onreadystatechange",e),t())}))}((function(){function o(){var e;(e=-1!=g&&-1!=y||-1!=g&&-1!=v||-1!=y&&-1!=v)&&((e=g!=y&&g!=v&&y!=v)||(null===a&&(e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),a=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))),e=a&&(g==x&&y==x&&v==x||g==_&&y==_&&v==_||g==b&&y==b&&v==b)),e=!e),e&&(null!==w.parentNode&&w.parentNode.removeChild(w),clearTimeout(l),t(r))}var c=new e(h),p=new e(h),m=new e(h),g=-1,y=-1,v=-1,x=-1,_=-1,b=-1,w=document.createElement("div");w.dir="ltr",s(c,u(r,"sans-serif")),s(p,u(r,"serif")),s(m,u(r,"monospace")),w.appendChild(c.g),w.appendChild(p.g),w.appendChild(m.g),r.context.document.body.appendChild(w),x=c.g.offsetWidth,_=p.g.offsetWidth,b=m.g.offsetWidth,function t(){if((new Date).getTime()-f>=d)null!==w.parentNode&&w.parentNode.removeChild(w),n(Error(d+"ms timeout exceeded"));else{var e=r.context.document.hidden;!0!==e&&void 0!==e||(g=c.g.offsetWidth,y=p.g.offsetWidth,v=m.g.offsetWidth,o()),l=setTimeout(t,50)}}(),i(c,(function(t){g=t,o()})),s(c,u(r,'"'+r.family+'",sans-serif')),i(p,(function(t){y=t,o()})),s(p,u(r,'"'+r.family+'",serif')),i(m,(function(t){v=t,o()})),s(m,u(r,'"'+r.family+'",monospace'))}))}))},Qy.exports=r}();const tv=Jy;function ev(t,e){const s=e.Resolution;if(void 0===s||!Array.isArray(s))throw Error("No resolution in style!");delete e.Resolution;const n={};return Object.assign(n,...Object.values(e)),{name:t,Resolution:s,list:n}}const sv={name:"",Resolution:[1,1],list:{}};rd.prototype.prepareLoading=function(t=!1){let e;this.starter={all:{n:0,nLoaded:0,fileSize:0},bundles:{},promises:[]},e=t?()=>Object.values(this.starter.bundles).reduce(((t,e)=>t+e.nLoaded/e.n*e.fileSize),0)/this.starter.all.fileSize:()=>this.starter.all.nLoaded/this.starter.all.n,this.starter.logProgress=(t,s)=>{var n;const i=(100*s).toFixed(2).padStart(6," ")+"%",r=e(),a=(100*r).toFixed(2).padStart(6," ")+"%";console.debug(`[LOADED] Total:${a}  |  ${t}:${i}`),null==(n=this.onTotalProgress)||n.call(this,r)}},rd.prototype.addCSSFont=function(t,e,s,n=9999999){let i=this.starter.bundles["CSS-Font"];void 0===i&&(i=this.starter.bundles["CSS-Font"]={n:0,nLoaded:0,fileSize:0});const r=2e5;i.n++,i.fileSize+=r,this.starter.all.n++,this.starter.all.fileSize+=r;const a=new tv(t,e);this.starter.promises.push((()=>a.load(s,n).then((()=>{i.nLoaded++,this.starter.all.nLoaded++,this.starter.logProgress("CSS-Font",i.nLoaded/i.n)}))))},rd.prototype.loadFromList=function(t){var e;null==(e=this.onPreprocessAssetList)||e.call(this,t),this.list=t,this.starter.all.fileSize+=t.fileSize;const s=(t,e)=>s=>{e.nLoaded++,this.starter.all.nLoaded++,this.starter.logProgress(t,s)},n=(t,e)=>{let n=0;"fileSize"in e&&(n=e.fileSize,delete e.fileSize);const i=Object.keys(e).length;if(0==i)return;this.starter.all.n+=i;const r=this.starter.bundles[t]={n:i,nLoaded:0,fileSize:n};this.addBundle(t,e),this.starter.promises.push((()=>this.loadBundle(t,s(t,r))))};return n("Image",t.img),n("Texture",t.img_atlas),n("Spine",t.spine_json),n("Sound",t.sound),n("Style",t.style.PROD),n("Localization",t.lang.PROD),console.debug("SupportedSoundExts:",JSON.stringify(Ky,void 0,2)),n("Custom",t.custom),Promise.all(this.starter.promises.map((t=>t())))},rd.prototype.get_multipack_textureMap=function(t){const e={};for(const i of Object.keys(t.img)){const t=this.get(i);e[i]=t}const s=t=>{Object.assign(e,t.textures)};for(const i of Object.keys(t.img_atlas)){const t=this.get(i);if(void 0!==t){s(t);for(const e of t.linkedSheets)s(e)}}const n={};for(const i of Object.keys(t.img_atlas)){const t=this.get(i);if(void 0!==t&&void 0!==t.data.animations)for(const s in t.data.animations){const i=t.data.animations[s];n[s]=i.map((t=>e[t]))}}return[e,n]},rd.prototype.get_SpineMap=function(t){const e={};for(const s of Object.keys(t)){const t=this.get(s);e[s]=t}return e},rd.prototype.get_viewStyleMap=function(t){const e={};{const t=this.get("styleBundle");for(const[s,n]of Object.entries(t))e[s]=ev(s,n)}return e},rd.prototype.get_localeMap=function(t){const e={};{const t=this.get("langBundle");for(const[s,n]of Object.entries(t))e[s]=l({code:s},n)}return e};class nv extends(Zm(su)){constructor(t){super(void 0!==t?globalThis.pgame.getTex(t):void 0)}setTex(t){this.texture=globalThis.pgame.getTex(t)}useViewStyle(t){super.useViewStyle(t),void 0!==t.tex&&this.setTex(t.tex)}}d(nv,"_debugLineStyle",(()=>{let t=new Sf;return t.visible=!0,t.color=Hm.Yellow,t.alpha=1,t.width=2,t})());class iv extends(Zm(up)){constructor(t,e=60,s=!1){super(globalThis.pgame.getSeq(t)),this.FPS=e,this.loop=s}setSeq(t){this.textures=globalThis.pgame.getSeq(t)}get FPS(){return 60*this.animationSpeed}set FPS(t){this.animationSpeed=t/60}update(t){up.prototype.update.call(this,t)}}d(iv,"_debugLineStyle",(()=>{let t=new Sf;return t.visible=!0,t.color=Hm.Orange,t.alpha=1,t.width=2,t})());class rv extends(Zm(Kf)){constructor(t){var e;const s=t.text,n=t.key,i=null!=(e=t.name)?e:"",r=rv.getStyleFromInitOptions(t,i);let a=!1;void 0===r.fontFamily&&(a=!0,r.fontFamily=globalThis.pgame.currLocale.defaultFont),super(s,r),d(this,"_key",""),d(this,"_args"),d(this,"_useDefaultFont"),d(this,"_fitType","None"),d(this,"fitBox",{width:1/0,height:1/0,scale:1}),this.name=i,this._useDefaultFont=a,void 0!==n&&this.setKey(n)}get text(){return super.text}set text(t){super.text=t,this.dirty&&this._fitScale()}get fitType(){return this._fitType}set fitType(t){if(this._fitType!=t){switch(this._fitType=t,t){case"None":this._fitScale=rv.prototype._fitScale;break;case"Shrink":this._fitScale=this._shrinkScale}this._fitScale()}}setFitBox(t=1/0,e=1/0,s=1){this.fitBox.width=t,this.fitBox.height=e,this.fitBox.scale=s,this._fitScale()}setTxtStyle(t){Object.assign(this.style,t)}setKey(t){this._key=t,this._args=void 0;const e=globalThis.pgame.currLocale.dict[t];void 0!==e&&(this.text=e)}setKeyFormat(t,...e){this._key=t,this._args=e;const s=globalThis.pgame.currLocale.dict[t];void 0!==s&&(this.text=s.format(...e))}useLocale(t){const e=t.dict[this._key];void 0!==e&&(void 0===this._args?this.text=e:this.text=e.format(...this._args));const s=t.styles[this.name];void 0!==s&&Object.assign(this.style,rv.getStyleFromItem(this,s))}clear(){this.text=""}_fitScale(){}_shrinkScale(){const t=this.fitBox;if(t.width==1/0&&t.height==1/0)return;const e=this.unscaledBound;let s=t.width/e.width,n=t.height/e.height,i=Math.min(t.scale,s,n);this.scale.set(i)}static getStyleFromInitOptions(t,e){var s;const n=t;delete t.text,delete t.key,delete t.name,Object.rename(t,"font","fontFamily"),Object.rename(t,"size","fontSize"),Object.rename(t,"weight","fontWeight"),Object.rename(t,"style","fontStyle"),n.fill=null!=(s=t.fill)?s:Hm.White,void 0!==t.width&&(n.wordWrap=!0,n.wordWrapWidth=t.width,delete t.width);const i=globalThis.pgame.currLocale.styles[e];return void 0!==i&&(Object.rename(i,"font","fontFamily"),Object.rename(i,"size","fontSize"),Object.assign(n,i)),n}static getStyleFromItem(t,e){const s=e;return void 0!==e.font?(s.fontFamily=e.font,delete e.font):t._useDefaultFont&&(s.fontFamily=globalThis.pgame.currLocale.defaultFont),Object.rename(e,"size","fontSize"),s}static getByKey(t){let e=globalThis.pgame.currLocale.dict[t];return e||""}static getByKeyFormat(t,...e){let s=globalThis.pgame.currLocale.dict[t];return s?s.format(...e):""}}class av{constructor(){d(this,"shape"),d(this,"_fillStyle",new Ef),d(this,"_lineStyle",new Sf),d(this,"matrix")}fill(t,e=1){return this._fillStyle.color=t,this._fillStyle.alpha=e,this._fillStyle.visible=!0,this}line(t,e,s=1){return this._lineStyle.width=t,this._lineStyle.color=e,this._lineStyle.alpha=s,this._lineStyle.visible=!0,this}reshape(...t){return this}getGraphicsData(){var t;return new xf(this.shape.clone(),this._fillStyle.clone(),this._lineStyle.clone(),null==(t=this.matrix)?void 0:t.clone())}}class ov extends av{constructor(t,e,s=0,n=0){super(),d(this,"shape"),this.shape=new wh(s,n,t,e)}reshape(t,e,s=0,n=0){return this.shape.width=t,this.shape.height=e,this.shape.x=s,this.shape.y=n,this}}class hv extends(Zm(Cf)){constructor(t){t instanceof wf?super(t):(super(),void 0!==t&&this.appendDraw(t))}appendDraw(t){const e=this.geometry;if(t instanceof av)this.geometry.graphicsData.push(t.getGraphicsData()),e.dirty++;else if(Array.isArray(t))for(const s of t)this.geometry.graphicsData.push(s.getGraphicsData()),e.dirty++;else for(const s of t.graphicsData)this.geometry.graphicsData.push(s),e.dirty++}redraw(t){this.clear().appendDraw(t)}}d(hv,"_debugLineStyle",(()=>{let t=new Sf;return t.visible=!0,t.color=Hm.Green,t.alpha=1,t.width=2,t})());d(class extends ig{constructor(t){super(),d(this,"bg"),d(this,"txt"),this.bg=t}addCenteredTxt(t,e=0,s=0){console.assert(void 0===this.txt,"Duplicate text objects"),this.txt=new rv(t),this.centerTxt(e,s),this.name=this.txt.name,this._addBoth()}centerTxt(t=0,e=0){this.txt.pivotRule=jm.Center,this.txt.position.set(this.bg.width/2+t,this.bg.height/2+e)}addTxtObj(t){console.assert(void 0===this.txt,"Duplicate text objects"),this.txt=new rv(t),this.name=this.txt.name,this._addBoth()}setText(t){this.txt.text=t}txtFitType(t){return this.txt.fitType=t,this}txtFitBox(t=1/0,e=1/0,s=1,n=!1){return n?this.txt.setFitBox(this.bg.height*e,this.bg.width*t,s):this.txt.setFitBox(this.bg.width*t,this.bg.height*e,s),this}txtStyle(t){Object.assign(this.txt.style,t)}txtKey(t){this.txt.setKey(t)}txtKeyFormat(t,...e){this.txt.setKeyFormat(t,...e)}update(t){this.bg.update(t),this.txt.update(t)}useLocale(t){this.txt.useLocale(t)}_addBoth(){this.isInteractive()&&(this.bg.eventMode=this.txt.eventMode="auto"),this.addObj(this.bg,0).addObj(this.txt,1)}},"_debugLineStyle",(()=>{let t=new Sf;return t.visible=!0,t.color=Hm.Magneta,t.alpha=1,t.width=2,t})());var lv=(t=>(t[t.Region=0]="Region",t[t.BoundingBox=1]="BoundingBox",t[t.Mesh=2]="Mesh",t[t.LinkedMesh=3]="LinkedMesh",t[t.Path=4]="Path",t[t.Point=5]="Point",t[t.Clipping=6]="Clipping",t))(lv||{});class cv{constructor(t,e=new Array,s=0,n=new DataView(t.buffer)){this.strings=e,this.index=s,this.buffer=n}readByte(){return this.buffer.getInt8(this.index++)}readUnsignedByte(){return this.buffer.getUint8(this.index++)}readShort(){const t=this.buffer.getInt16(this.index);return this.index+=2,t}readInt32(){const t=this.buffer.getInt32(this.index);return this.index+=4,t}readInt(t){let e=this.readByte(),s=127&e;return 0!=(128&e)&&(e=this.readByte(),s|=(127&e)<<7,0!=(128&e)&&(e=this.readByte(),s|=(127&e)<<14,0!=(128&e)&&(e=this.readByte(),s|=(127&e)<<21,0!=(128&e)&&(e=this.readByte(),s|=(127&e)<<28)))),t?s:s>>>1^-(1&s)}readStringRef(){const t=this.readInt(!0);return 0==t?null:this.strings[t-1]}readString(){let t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;let e="";for(let s=0;s<t;){const t=this.readUnsignedByte();switch(t>>4){case 12:case 13:e+=String.fromCharCode((31&t)<<6|63&this.readByte()),s+=2;break;case 14:e+=String.fromCharCode((15&t)<<12|(63&this.readByte())<<6|63&this.readByte()),s+=3;break;default:e+=String.fromCharCode(t),s++}}return e}readFloat(){const t=this.buffer.getFloat32(this.index);return this.index+=4,t}readBoolean(){return 0!=this.readByte()}}var uv=(t=>(t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add",t))(uv||{}),dv=(t=>(t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut",t))(dv||{}),fv=(t=>(t[t.Fixed=0]="Fixed",t[t.Percent=1]="Percent",t))(fv||{}),pv=(t=>(t[t.Tangent=0]="Tangent",t[t.Chain=1]="Chain",t[t.ChainScale=2]="ChainScale",t))(pv||{}),mv=(t=>(t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection",t))(mv||{});function gv(t){switch(t.toLowerCase()){case"nearest":return yv.Nearest;case"linear":return yv.Linear;case"mipmap":return yv.MipMap;case"mipmapnearestnearest":return yv.MipMapNearestNearest;case"mipmaplinearnearest":return yv.MipMapLinearNearest;case"mipmapnearestlinear":return yv.MipMapNearestLinear;case"mipmaplinearlinear":return yv.MipMapLinearLinear;default:throw new Error(`Unknown texture filter ${t}`)}}var yv=(t=>(t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear",t))(yv||{}),vv=(t=>(t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat",t))(vv||{});class xv{constructor(){this.size=null,this.names=null,this.values=null,this.renderObject=null}get width(){const t=this.texture;return t.trim?t.trim.width:t.orig.width}get height(){const t=this.texture;return t.trim?t.trim.height:t.orig.height}get u(){return this.texture._uvs.x0}get v(){return this.texture._uvs.y0}get u2(){return this.texture._uvs.x2}get v2(){return this.texture._uvs.y2}get offsetX(){const t=this.texture;return t.trim?t.trim.x:0}get offsetY(){return this.spineOffsetY}get pixiOffsetY(){const t=this.texture;return t.trim?t.trim.y:0}get spineOffsetY(){const t=this.texture;return this.originalHeight-this.height-(t.trim?t.trim.y:0)}get originalWidth(){return this.texture.orig.width}get originalHeight(){return this.texture.orig.height}get x(){return this.texture.frame.x}get y(){return this.texture.frame.y}get rotate(){return 0!==this.texture.rotate}get degrees(){return(360-45*this.texture.rotate)%360}}class _v{constructor(){this.x=0,this.y=0,this.width=0,this.height=0,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0,this.rotate=0,this.index=0}}class bv{constructor(t,e,s){this.pages=new Array,this.regions=new Array,t&&this.addSpineAtlas(t,e,s)}addTexture(t,e){const s=this.pages;let n=null;for(let r=0;r<s.length;r++)if(s[r].baseTexture===e.baseTexture){n=s[r];break}if(null===n){n=new Ev,n.name="texturePage";const t=e.baseTexture;n.width=t.realWidth,n.height=t.realHeight,n.baseTexture=t,n.minFilter=n.magFilter=yv.Nearest,n.uWrap=vv.ClampToEdge,n.vWrap=vv.ClampToEdge,s.push(n)}const i=new Sv;return i.name=t,i.page=n,i.texture=e,i.index=-1,this.regions.push(i),i}addTextureHash(t,e){for(const s in t)t.hasOwnProperty(s)&&this.addTexture(e&&-1!==s.indexOf(".")?s.substr(0,s.lastIndexOf(".")):s,t[s])}addSpineAtlas(t,e,s){return this.load(t,e,s)}load(t,e,s){if(null==e)throw new Error("textureLoader cannot be null.");const n=new wv(t),i=new Array(4);let r=null;const a={};let o=null;a.size=()=>{r.width=parseInt(i[1]),r.height=parseInt(i[2])},a.format=()=>{},a.filter=()=>{r.minFilter=gv(i[1]),r.magFilter=gv(i[2])},a.repeat=()=>{-1!=i[1].indexOf("x")&&(r.uWrap=vv.Repeat),-1!=i[1].indexOf("y")&&(r.vWrap=vv.Repeat)},a.pma=()=>{r.pma="true"==i[1]};const h={xy:()=>{o.x=parseInt(i[1]),o.y=parseInt(i[2])},size:()=>{o.width=parseInt(i[1]),o.height=parseInt(i[2])},bounds:()=>{o.x=parseInt(i[1]),o.y=parseInt(i[2]),o.width=parseInt(i[3]),o.height=parseInt(i[4])},offset:()=>{o.offsetX=parseInt(i[1]),o.offsetY=parseInt(i[2])},orig:()=>{o.originalWidth=parseInt(i[1]),o.originalHeight=parseInt(i[2])},offsets:()=>{o.offsetX=parseInt(i[1]),o.offsetY=parseInt(i[2]),o.originalWidth=parseInt(i[3]),o.originalHeight=parseInt(i[4])},rotate:()=>{const t=i[1];let e=0;e="true"==t.toLocaleLowerCase()?6:"false"==t.toLocaleLowerCase()?0:(720-parseFloat(t))%360/45,o.rotate=e},index:()=>{o.index=parseInt(i[1])}};let l=n.readLine();for(;null!=l&&0==l.trim().length;)l=n.readLine();for(;null!=l&&0!=l.trim().length&&0!=n.readEntry(i,l);)l=n.readLine();const c=()=>{for(;;){if(null==l)return s&&s(this);if(0==l.trim().length)r=null,l=n.readLine();else{if(null===r){for(r=new Ev,r.name=l.trim();0!=n.readEntry(i,l=n.readLine());){const t=a[i[0]];t&&t()}this.pages.push(r),e(r.name,(t=>{if(null===t)return this.pages.splice(this.pages.indexOf(r),1),s&&s(null);r.baseTexture=t,r.pma&&(t.alphaMode=fr.PMA),t.valid||t.setSize(r.width,r.height),r.setFilters(),r.width&&r.height||(r.width=t.realWidth,r.height=t.realHeight,r.width&&r.height||console.log(`ERROR spine atlas page ${r.name}: meshes wont work if you dont specify size in atlas (http://www.html5gamedevs.com/topic/18888-pixi-spines-and-meshes/?p=107121)`)),c()}));break}{o=new _v;const t=new Sv;t.name=l,t.page=r;let e=null,s=null;for(;;){const t=n.readEntry(i,l=n.readLine());if(0==t)break;const r=h[i[0]];if(r)r();else{null==e&&(e=[],s=[]),e.push(i[0]);const n=[];for(let e=0;e<t;e++)n.push(parseInt(i[e+1]));s.push(n)}}0==o.originalWidth&&0==o.originalHeight&&(o.originalWidth=o.width,o.originalHeight=o.height);const a=r.baseTexture.resolution;o.x/=a,o.y/=a,o.width/=a,o.height/=a,o.originalWidth/=a,o.originalHeight/=a,o.offsetX/=a,o.offsetY/=a;const c=o.rotate%4!=0,u=new wh(o.x,o.y,c?o.height:o.width,c?o.width:o.height),d=new wh(0,0,o.originalWidth,o.originalHeight),f=new wh(o.offsetX,o.originalHeight-o.height-o.offsetY,o.width,o.height);t.texture=new Il(t.page.baseTexture,u,d,f,o.rotate),t.index=o.index,t.texture.updateUvs(),this.regions.push(t)}}}};c()}findRegion(t){for(let e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null}dispose(){for(let t=0;t<this.pages.length;t++)this.pages[t].baseTexture.dispose()}}class wv{constructor(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}readLine(){return this.index>=this.lines.length?null:this.lines[this.index++]}readEntry(t,e){if(null==e)return 0;if(0==(e=e.trim()).length)return 0;const s=e.indexOf(":");if(-1==s)return 0;t[0]=e.substr(0,s).trim();for(let n=1,i=s+1;;n++){const s=e.indexOf(",",i);if(-1==s)return t[n]=e.substr(i).trim(),n;if(t[n]=e.substr(i,s-i).trim(),i=s+1,4==n)return 4}}}class Ev{constructor(){this.minFilter=yv.Nearest,this.magFilter=yv.Nearest,this.uWrap=vv.ClampToEdge,this.vWrap=vv.ClampToEdge}setFilters(){const t=this.baseTexture,e=this.minFilter;e==yv.Linear?t.scaleMode=cr.LINEAR:this.minFilter==yv.Nearest?t.scaleMode=cr.NEAREST:(t.mipmap=dr.POW2,e==yv.MipMapNearestNearest?t.scaleMode=cr.NEAREST:t.scaleMode=cr.LINEAR)}}class Sv extends xv{}class Tv{constructor(){this.array=new Array}add(t){const e=this.contains(t);return this.array[0|t]=0|t,!e}contains(t){return null!=this.array[0|t]}remove(t){this.array[0|t]=void 0}clear(){this.array.length=0}}class Av{constructor(){this.entries={},this.size=0}add(t){const e=this.entries[t];return this.entries[t]=!0,!e&&(this.size++,!0)}addAll(t){const e=this.size;for(let s=0,n=t.length;s<n;s++)this.add(t[s]);return e!=this.size}contains(t){return this.entries[t]}clear(){this.entries={},this.size=0}}const Cv=class{constructor(t=0,e=0,s=0,n=0){this.r=t,this.g=e,this.b=s,this.a=n}set(t,e,s,n){return this.r=t,this.g=e,this.b=s,this.a=n,this.clamp()}setFromColor(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}setFromString(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=8!=t.length?1:parseInt(t.substr(6,2),16)/255,this}add(t,e,s,n){return this.r+=t,this.g+=e,this.b+=s,this.a+=n,this.clamp()}clamp(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}static rgba8888ToColor(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255}static rgb888ToColor(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255}static fromString(t){return(new Cv).setFromString(t)}};let Mv=Cv;Mv.WHITE=new Cv(1,1,1,1),Mv.RED=new Cv(1,0,0,1),Mv.GREEN=new Cv(0,1,0,1),Mv.BLUE=new Cv(0,0,1,1),Mv.MAGENTA=new Cv(1,0,1,1);const Iv=class{static clamp(t,e,s){return t<e?e:t>s?s:t}static cosDeg(t){return Math.cos(t*Iv.degRad)}static sinDeg(t){return Math.sin(t*Iv.degRad)}static signum(t){return Math.sign(t)}static toInt(t){return t>0?Math.floor(t):Math.ceil(t)}static cbrt(t){const e=Math.pow(Math.abs(t),1/3);return t<0?-e:e}static randomTriangular(t,e){return Iv.randomTriangularWith(t,e,.5*(t+e))}static randomTriangularWith(t,e,s){const n=Math.random(),i=e-t;return n<=(s-t)/i?t+Math.sqrt(n*i*(s-t)):e-Math.sqrt((1-n)*i*(e-s))}static isPowerOfTwo(t){return t&&0==(t&t-1)}};let Pv=Iv;Pv.PI=3.1415927,Pv.PI2=2*Iv.PI,Pv.radiansToDegrees=180/Iv.PI,Pv.radDeg=Iv.radiansToDegrees,Pv.degreesToRadians=Iv.PI/180,Pv.degRad=Iv.degreesToRadians;class Rv{apply(t,e,s){return t+(e-t)*this.applyInternal(s)}}class kv extends Rv{constructor(t){super(),this.power=2,this.power=t}applyInternal(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1}}class Dv extends kv{applyInternal(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1}}const Fv=class{static arrayCopy(t,e,s,n,i){for(let r=e,a=n;r<e+i;r++,a++)s[a]=t[r]}static arrayFill(t,e,s,n){for(let i=e;i<s;i++)t[i]=n}static setArraySize(t,e,s=0){const n=t.length;if(n==e)return t;if(t.length=e,n<e)for(let i=n;i<e;i++)t[i]=s;return t}static ensureArrayCapacity(t,e,s=0){return t.length>=e?t:Fv.setArraySize(t,e,s)}static newArray(t,e){const s=new Array(t);for(let n=0;n<t;n++)s[n]=e;return s}static newFloatArray(t){if(Fv.SUPPORTS_TYPED_ARRAYS)return new Float32Array(t);const e=new Array(t);for(let s=0;s<e.length;s++)e[s]=0;return e}static newShortArray(t){if(Fv.SUPPORTS_TYPED_ARRAYS)return new Int16Array(t);const e=new Array(t);for(let s=0;s<e.length;s++)e[s]=0;return e}static toFloatArray(t){return Fv.SUPPORTS_TYPED_ARRAYS?new Float32Array(t):t}static toSinglePrecision(t){return Fv.SUPPORTS_TYPED_ARRAYS?Math.fround(t):t}static webkit602BugfixHelper(t,e){}static contains(t,e,s=!0){for(let n=0;n<t.length;n++)if(t[n]==e)return!0;return!1}static enumValue(t,e){return t[e[0].toUpperCase()+e.slice(1)]}};let Ov=Fv;Ov.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array;class Nv{constructor(t){this.items=new Array,this.instantiator=t}obtain(){return this.items.length>0?this.items.pop():this.instantiator()}free(t){t.reset&&t.reset(),this.items.push(t)}freeAll(t){for(let e=0;e<t.length;e++)this.free(t[e])}clear(){this.items.length=0}}class Bv{constructor(t=0,e=0){this.x=t,this.y=e}set(t,e){return this.x=t,this.y=e,this}length(){const t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}normalize(){const t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this}}class Lv{constructor(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new Nv((()=>Ov.newFloatArray(16)))}update(t,e){if(!t)throw new Error("skeleton cannot be null.");const s=this.boundingBoxes,n=this.polygons,i=this.polygonPool,r=t.slots,a=r.length;s.length=0,i.freeAll(n),n.length=0;for(let o=0;o<a;o++){const t=r[o];if(!t.bone.active)continue;const e=t.getAttachment();if(null!=e&&e.type===lv.BoundingBox){const r=e;s.push(r);let a=i.obtain();a.length!=r.worldVerticesLength&&(a=Ov.newFloatArray(r.worldVerticesLength)),n.push(a),r.computeWorldVertices(t,0,r.worldVerticesLength,a,0,2)}}e?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)}aabbCompute(){let t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY;const i=this.polygons;for(let r=0,a=i.length;r<a;r++){const a=i[r],o=a;for(let i=0,r=a.length;i<r;i+=2){const r=o[i],a=o[i+1];t=Math.min(t,r),e=Math.min(e,a),s=Math.max(s,r),n=Math.max(n,a)}}this.minX=t,this.minY=e,this.maxX=s,this.maxY=n}aabbContainsPoint(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY}aabbIntersectsSegment(t,e,s,n){const i=this.minX,r=this.minY,a=this.maxX,o=this.maxY;if(t<=i&&s<=i||e<=r&&n<=r||t>=a&&s>=a||e>=o&&n>=o)return!1;const h=(n-e)/(s-t);let l=h*(i-t)+e;if(l>r&&l<o)return!0;if(l=h*(a-t)+e,l>r&&l<o)return!0;let c=(r-e)/h+t;return c>i&&c<a||(c=(o-e)/h+t,c>i&&c<a)}aabbIntersectsSkeleton(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY}containsPoint(t,e){const s=this.polygons;for(let n=0,i=s.length;n<i;n++)if(this.containsPointPolygon(s[n],t,e))return this.boundingBoxes[n];return null}containsPointPolygon(t,e,s){const n=t,i=t.length;let r=i-2,a=!1;for(let o=0;o<i;o+=2){const t=n[o+1],i=n[r+1];if(t<s&&i>=s||i<s&&t>=s){const h=n[o];h+(s-t)/(i-t)*(n[r]-h)<e&&(a=!a)}r=o}return a}intersectsSegment(t,e,s,n){const i=this.polygons;for(let r=0,a=i.length;r<a;r++)if(this.intersectsSegmentPolygon(i[r],t,e,s,n))return this.boundingBoxes[r];return null}intersectsSegmentPolygon(t,e,s,n,i){const r=t,a=t.length,o=e-n,h=s-i,l=e*i-s*n;let c=r[a-2],u=r[a-1];for(let d=0;d<a;d+=2){const t=r[d],a=r[d+1],f=c*a-u*t,p=c-t,m=u-a,g=o*m-h*p,y=(l*p-o*f)/g;if((y>=c&&y<=t||y>=t&&y<=c)&&(y>=e&&y<=n||y>=n&&y<=e)){const t=(l*m-h*f)/g;if((t>=u&&t<=a||t>=a&&t<=u)&&(t>=s&&t<=i||t>=i&&t<=s))return!0}c=t,u=a}return!1}getPolygon(t){if(!t)throw new Error("boundingBox cannot be null.");const e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]}getWidth(){return this.maxX-this.minX}getHeight(){return this.maxY-this.minY}}const Vv=0,$v=[0,0,0];class Uv extends su{constructor(){super(...arguments),this.region=null,this.attachment=null}}class Xv extends Of{constructor(t,e,s,n,i){super(t,e,s,n,i),this.region=null,this.attachment=null}}const Yv=class extends Jc{constructor(t){if(super(),!t)throw new Error("The spineData param is required.");if("string"==typeof t)throw new Error('spineData param cant be string. Please use spine.Spine.fromAtlas("YOUR_RESOURCE_NAME") from now on.');this.spineData=t,this.createSkeleton(t),this.slotContainers=[],this.tempClipContainers=[];for(let e=0,s=this.skeleton.slots.length;e<s;e++){const t=this.skeleton.slots[e],s=t.getAttachment(),n=this.newContainer();if(this.slotContainers.push(n),this.addChild(n),this.tempClipContainers.push(null),s)if(s.type===lv.Region){const e=s.name,i=this.createSprite(t,s,e);t.currentSprite=i,t.currentSpriteName=e,n.addChild(i)}else if(s.type===lv.Mesh){const e=this.createMesh(t,s);t.currentMesh=e,t.currentMeshId=s.id,t.currentMeshName=s.name,n.addChild(e)}else s.type===lv.Clipping&&(this.createGraphics(t,s),n.addChild(t.clippingContainer),n.addChild(t.currentGraphics))}this.tintRgb=new Float32Array([1,1,1]),this.autoUpdate=!0,this.visible=!0}get debug(){return this._debug}set debug(t){var e;t!=this._debug&&(null==(e=this._debug)||e.unregisterSpine(this),null==t||t.registerSpine(this),this._debug=t)}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this.updateTransform=t?Yv.prototype.autoUpdateTransform:Jc.prototype.updateTransform)}get tint(){return wo(this.tintRgb)}set tint(t){this.tintRgb=bo(t,this.tintRgb)}get delayLimit(){return(void 0!==this.localDelayLimit?this.localDelayLimit:Vv)||Number.MAX_VALUE}update(t){var e;const s=this.delayLimit;if(t>s&&(t=s),this.state.update(t),this.state.apply(this.skeleton),!this.skeleton)return;this.skeleton.updateWorldTransform();const n=this.skeleton.slots,i=this.color;let r=null,a=null;i?(r=i.light,a=i.dark):r=this.tintRgb;for(let c=0,u=n.length;c<u;c++){const t=n[c],e=t.getAttachment(),s=this.slotContainers[c];if(!e){s.visible=!1;continue}let i=null;e.sequence&&e.sequence.apply(t,e);let o=e.region;const h=e.color;switch(null!=e&&e.type){case lv.Region:if(s.transform.setFromMatrix(t.bone.matrix),o=e.region,t.currentMesh&&(t.currentMesh.visible=!1,t.currentMesh=null,t.currentMeshId=void 0,t.currentMeshName=void 0),!o){t.currentSprite&&(t.currentSprite.renderable=!1);break}if(!t.currentSpriteName||t.currentSpriteName!==e.name){const n=e.name;if(t.currentSprite&&(t.currentSprite.visible=!1),t.sprites=t.sprites||{},void 0!==t.sprites[n])t.sprites[n].visible=!0;else{const i=this.createSprite(t,e,n);s.addChild(i)}t.currentSprite=t.sprites[n],t.currentSpriteName=n}t.currentSprite.renderable=!0,t.hackRegion||this.setSpriteRegion(e,t.currentSprite,o),t.currentSprite.color?i=t.currentSprite.color:($v[0]=r[0]*t.color.r*h.r,$v[1]=r[1]*t.color.g*h.g,$v[2]=r[2]*t.color.b*h.b,t.currentSprite.tint=wo($v)),t.currentSprite.blendMode=t.blendMode;break;case lv.Mesh:if(t.currentSprite){t.currentSprite.visible=!1,t.currentSprite=null,t.currentSpriteName=void 0;const e=new Lh;e._parentID=-1,e._worldID=s.transform._worldID,s.transform=e}if(!o){t.currentMesh&&(t.currentMesh.renderable=!1);break}const n=e.id;if(void 0===t.currentMeshId||t.currentMeshId!==n){const i=n;if(t.currentMesh&&(t.currentMesh.visible=!1),t.meshes=t.meshes||{},void 0!==t.meshes[i])t.meshes[i].visible=!0;else{const n=this.createMesh(t,e);s.addChild(n)}t.currentMesh=t.meshes[i],t.currentMeshName=e.name,t.currentMeshId=i}t.currentMesh.renderable=!0,e.computeWorldVerticesOld(t,t.currentMesh.vertices),t.currentMesh.color?i=t.currentMesh.color:($v[0]=r[0]*t.color.r*h.r,$v[1]=r[1]*t.color.g*h.g,$v[2]=r[2]*t.color.b*h.b,t.currentMesh.tint=wo($v)),t.currentMesh.blendMode=t.blendMode,t.hackRegion||this.setMeshRegion(e,t.currentMesh,o);break;case lv.Clipping:t.currentGraphics||(this.createGraphics(t,e),s.addChild(t.clippingContainer),s.addChild(t.currentGraphics)),this.updateGraphics(t,e),s.alpha=1,s.visible=!0;continue;default:s.visible=!1;continue}if(s.visible=!0,i){let e=t.color.r*h.r,s=t.color.g*h.g,n=t.color.b*h.b;i.setLight(r[0]*e+a[0]*(1-e),r[1]*s+a[1]*(1-s),r[2]*n+a[2]*(1-n)),t.darkColor?(e=t.darkColor.r,s=t.darkColor.g,n=t.darkColor.b):(e=0,s=0,n=0),i.setDark(r[0]*e+a[0]*(1-e),r[1]*s+a[1]*(1-s),r[2]*n+a[2]*(1-n))}s.alpha=t.color.a}const o=this.skeleton.drawOrder;let h=null,l=null;for(let c=0,u=o.length;c<u;c++){const t=n[o[c].data.index],e=this.slotContainers[o[c].data.index];if(l||null!==e.parent&&e.parent!==this&&(e.parent.removeChild(e),e.parent=this),t.currentGraphics&&t.getAttachment())l=t.clippingContainer,h=t.getAttachment(),l.children.length=0,this.children[c]=e,h.endSlot===t.data&&(h.endSlot=null);else if(l){let s=this.tempClipContainers[c];s||(s=this.tempClipContainers[c]=this.newContainer(),s.visible=!1),this.children[c]=s,e.parent=null,l.addChild(e),h.endSlot==t.data&&(l.renderable=!0,l=null,h=null)}else this.children[c]=e}null==(e=this._debug)||e.renderDebug(this)}setSpriteRegion(t,e,s){e.attachment===t&&e.region===s||(e.region=s,e.attachment=t,e.texture=s.texture,e.rotation=t.rotation*Pv.degRad,e.position.x=t.x,e.position.y=t.y,e.alpha=t.color.a,s.size?(e.scale.x=s.size.width/s.originalWidth,e.scale.y=-s.size.height/s.originalHeight):(e.scale.x=t.scaleX*t.width/s.originalWidth,e.scale.y=-t.scaleY*t.height/s.originalHeight))}setMeshRegion(t,e,s){e.attachment===t&&e.region===s||(e.region=s,e.attachment=t,e.texture=s.texture,s.texture.updateUvs(),e.uvBuffer.update(t.regionUVs))}autoUpdateTransform(){{this.lastTime=this.lastTime||Date.now();const t=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.update(t)}Jc.prototype.updateTransform.call(this)}createSprite(t,e,s){let n=e.region;t.hackAttachment===e&&(n=t.hackRegion);const i=n?n.texture:null,r=this.newSprite(i);return r.anchor.set(.5),n&&this.setSpriteRegion(e,r,e.region),t.sprites=t.sprites||{},t.sprites[s]=r,r}createMesh(t,e){let s=e.region;t.hackAttachment===e&&(s=t.hackRegion,t.hackAttachment=null,t.hackRegion=null);const n=this.newMesh(s?s.texture:null,new Float32Array(e.regionUVs.length),e.regionUVs,new Uint16Array(e.triangles),rr.TRIANGLES);return void 0!==n._canvasPadding&&(n._canvasPadding=1.5),n.alpha=e.color.a,n.region=e.region,s&&this.setMeshRegion(e,n,s),t.meshes=t.meshes||{},t.meshes[e.id]=n,n}createGraphics(t,e){const s=this.newGraphics(),n=new Th([]);return s.clear(),s.beginFill(16777215,1),s.drawPolygon(n),s.renderable=!1,t.currentGraphics=s,t.clippingContainer=this.newContainer(),t.clippingContainer.mask=t.currentGraphics,s}updateGraphics(t,e){const s=t.currentGraphics.geometry,n=s.graphicsData[0].shape.points,i=e.worldVerticesLength;n.length=i,e.computeWorldVertices(t,0,i,n,0,2),s.invalidate()}hackTextureBySlotIndex(t,e=null,s=null){const n=this.skeleton.slots[t];if(!n)return!1;const i=n.getAttachment();let r=i.region;return e?(r=new xv,r.texture=e,r.size=s,n.hackRegion=r,n.hackAttachment=i):(n.hackRegion=null,n.hackAttachment=null),n.currentSprite?this.setSpriteRegion(i,n.currentSprite,r):n.currentMesh&&this.setMeshRegion(i,n.currentMesh,r),!0}hackTextureBySlotName(t,e=null,s=null){const n=this.skeleton.findSlotIndex(t);return-1!=n&&this.hackTextureBySlotIndex(n,e,s)}hackTextureAttachment(t,e,s,n=null){const i=this.skeleton.findSlotIndex(t),r=this.skeleton.getAttachmentByName(t,e);r.region.texture=s;const a=this.skeleton.slots[i];if(!a)return!1;const o=a.getAttachment();if(e===o.name){let t=r.region;return s?(t=new xv,t.texture=s,t.size=n,a.hackRegion=t,a.hackAttachment=o):(a.hackRegion=null,a.hackAttachment=null),a.currentSprite&&a.currentSprite.region!=t?(this.setSpriteRegion(o,a.currentSprite,t),a.currentSprite.region=t):a.currentMesh&&a.currentMesh.region!=t&&this.setMeshRegion(o,a.currentMesh,t),!0}return!1}newContainer(){return new Jc}newSprite(t){return new Uv(t)}newGraphics(){return new Cf}newMesh(t,e,s,n,i){return new Xv(t,e,s,n,i)}transformHack(){return 1}hackAttachmentGroups(t,e,s){if(!t)return;const n=[],i=[];for(let r=0,a=this.skeleton.slots.length;r<a;r++){const a=this.skeleton.slots[r],o=a.currentSpriteName||a.currentMeshName||"",h=a.currentSprite||a.currentMesh;o.endsWith(t)?(h.parentGroup=e,i.push(h)):s&&h&&(h.parentGroup=s,n.push(h))}return[n,i]}destroy(t){this.debug=null;for(let e=0,s=this.skeleton.slots.length;e<s;e++){const s=this.skeleton.slots[e];for(const e in s.meshes)s.meshes[e].destroy(t);s.meshes=null;for(const e in s.sprites)s.sprites[e].destroy(t);s.sprites=null}for(let e=0,s=this.slotContainers.length;e<s;e++)this.slotContainers[e].destroy(t);this.spineData=null,this.skeleton=null,this.slotContainers=null,this.stateData=null,this.state=null,this.tempClipContainers=null,super.destroy(t)}};let Wv=Yv;Wv.clippingPolygon=[],Object.defineProperty(Wv.prototype,"visible",{get(){return this._visible},set(t){t!==this._visible&&(this._visible=t,t&&(this.lastTime=0))}});class jv{constructor(){this.registeredSpines=new Map,this.drawDebug=!0,this.drawMeshHull=!0,this.drawMeshTriangles=!0,this.drawBones=!0,this.drawPaths=!0,this.drawBoundingBoxes=!0,this.drawClipping=!0,this.drawRegionAttachments=!0,this.lineWidth=1,this.regionAttachmentsColor=30975,this.meshHullColor=30975,this.meshTrianglesColor=16763904,this.clippingPolygonColor=16711935,this.boundingBoxesRectColor=65280,this.boundingBoxesPolygonColor=65280,this.boundingBoxesCircleColor=65280,this.pathsCurveColor=16711680,this.pathsLineColor=16711935,this.skeletonXYColor=16711680,this.bonesColor=61132}registerSpine(t){this.registeredSpines.has(t)&&console.warn("SpineDebugRenderer.registerSpine() - this spine is already registered!",t);const e={parentDebugContainer:new Jc,bones:new Jc,skeletonXY:new Cf,regionAttachmentsShape:new Cf,meshTrianglesLine:new Cf,meshHullLine:new Cf,clippingPolygon:new Cf,boundingBoxesRect:new Cf,boundingBoxesCircle:new Cf,boundingBoxesPolygon:new Cf,pathsCurve:new Cf,pathsLine:new Cf};e.parentDebugContainer.addChild(e.bones),e.parentDebugContainer.addChild(e.skeletonXY),e.parentDebugContainer.addChild(e.regionAttachmentsShape),e.parentDebugContainer.addChild(e.meshTrianglesLine),e.parentDebugContainer.addChild(e.meshHullLine),e.parentDebugContainer.addChild(e.clippingPolygon),e.parentDebugContainer.addChild(e.boundingBoxesRect),e.parentDebugContainer.addChild(e.boundingBoxesCircle),e.parentDebugContainer.addChild(e.boundingBoxesPolygon),e.parentDebugContainer.addChild(e.pathsCurve),e.parentDebugContainer.addChild(e.pathsLine),t.addChild(e.parentDebugContainer),this.registeredSpines.set(t,e)}renderDebug(t){this.registeredSpines.has(t)||this.registerSpine(t);const e=this.registeredSpines.get(t);e.skeletonXY.clear(),e.regionAttachmentsShape.clear(),e.meshTrianglesLine.clear(),e.meshHullLine.clear(),e.clippingPolygon.clear(),e.boundingBoxesRect.clear(),e.boundingBoxesCircle.clear(),e.boundingBoxesPolygon.clear(),e.pathsCurve.clear(),e.pathsLine.clear();for(let i=e.bones.children.length;i>0;i--)e.bones.children[i-1].destroy({children:!0,texture:!0,baseTexture:!0});const s=t.scale.x||t.scale.y||1,n=this.lineWidth/s;this.drawBones&&this.drawBonesFunc(t,e,n,s),this.drawPaths&&this.drawPathsFunc(t,e,n),this.drawBoundingBoxes&&this.drawBoundingBoxesFunc(t,e,n),this.drawClipping&&this.drawClippingFunc(t,e,n),(this.drawMeshHull||this.drawMeshTriangles)&&this.drawMeshHullAndMeshTriangles(t,e,n),this.drawRegionAttachments&&this.drawRegionAttachmentsFunc(t,e,n)}drawBonesFunc(t,e,s,n){const i=t.skeleton,r=i.x,a=i.y,o=i.bones;e.skeletonXY.lineStyle(s,this.skeletonXYColor,1);for(let l=0,c=o.length;l<c;l++){const t=o[l],i=t.data.length,h=r+t.matrix.tx,c=a+t.matrix.ty,u=r+i*t.matrix.a+t.matrix.tx,d=a+i*t.matrix.b+t.matrix.ty;if("root"===t.data.name||null===t.data.parent)continue;const f=Math.abs(h-u),p=Math.abs(c-d),m=Math.pow(f,2),g=p,y=Math.pow(p,2),v=Math.sqrt(m+y),x=Math.pow(v,2),_=Math.PI/180,b=Math.acos((x+y-m)/(2*g*v))||0;if(0===v)continue;const w=new Cf;e.bones.addChild(w);const E=v/50/n;w.beginFill(this.bonesColor,1),w.drawPolygon(0,0,0-E,v-3*E,0,v-E,0+E,v-3*E),w.endFill(),w.x=h,w.y=c,w.pivot.y=v;let S=0;h<u&&c<d?S=180*_-b:h>u&&c<d?S=180*_+b:h>u&&c>d?S=-b:h<u&&c>d?S=b:c===d&&h<u?S=90*_:c===d&&h>u?S=-90*_:h===u&&c<d?S=180*_:h===u&&c>d&&(S=0),w.rotation=S,w.lineStyle(s+E/2.4,this.bonesColor,1),w.beginFill(0,.6),w.drawCircle(0,v,1.2*E),w.endFill()}const h=3*s;e.skeletonXY.moveTo(r-h,a-h),e.skeletonXY.lineTo(r+h,a+h),e.skeletonXY.moveTo(r+h,a-h),e.skeletonXY.lineTo(r-h,a+h)}drawRegionAttachmentsFunc(t,e,s){const n=t.skeleton.slots;e.regionAttachmentsShape.lineStyle(s,this.regionAttachmentsColor,1);for(let i=0,r=n.length;i<r;i++){const t=n[i],s=t.getAttachment();if(null==s||s.type!==lv.Region)continue;const r=s,a=new Float32Array(8);r.updateOffset&&r.updateOffset(),r.computeWorldVertices(t,a,0,2),e.regionAttachmentsShape.drawPolygon(Array.from(a.slice(0,8)))}}drawMeshHullAndMeshTriangles(t,e,s){const n=t.skeleton.slots;e.meshHullLine.lineStyle(s,this.meshHullColor,1),e.meshTrianglesLine.lineStyle(s,this.meshTrianglesColor,1);for(let i=0,r=n.length;i<r;i++){const t=n[i];if(!t.bone.active)continue;const s=t.getAttachment();if(null==s||s.type!==lv.Mesh)continue;const r=s,a=new Float32Array(r.worldVerticesLength),o=r.triangles;let h=r.hullLength;if(r.computeWorldVertices(t,0,r.worldVerticesLength,a,0,2),this.drawMeshTriangles)for(let n=0,i=o.length;n<i;n+=3){const t=2*o[n],s=2*o[n+1],i=2*o[n+2];e.meshTrianglesLine.moveTo(a[t],a[t+1]),e.meshTrianglesLine.lineTo(a[s],a[s+1]),e.meshTrianglesLine.lineTo(a[i],a[i+1])}if(this.drawMeshHull&&h>0){h=2*(h>>1);let t=a[h-2],s=a[h-1];for(let n=0,i=h;n<i;n+=2){const i=a[n],r=a[n+1];e.meshHullLine.moveTo(i,r),e.meshHullLine.lineTo(t,s),t=i,s=r}}}}drawClippingFunc(t,e,s){const n=t.skeleton.slots;e.clippingPolygon.lineStyle(s,this.clippingPolygonColor,1);for(let i=0,r=n.length;i<r;i++){const t=n[i];if(!t.bone.active)continue;const s=t.getAttachment();if(null==s||s.type!==lv.Clipping)continue;const r=s,a=r.worldVerticesLength,o=new Float32Array(a);r.computeWorldVertices(t,0,a,o,0,2),e.clippingPolygon.drawPolygon(Array.from(o))}}drawBoundingBoxesFunc(t,e,s){e.boundingBoxesRect.lineStyle(s,this.boundingBoxesRectColor,5);const n=new Lv;n.update(t.skeleton,!0),e.boundingBoxesRect.drawRect(n.minX,n.minY,n.getWidth(),n.getHeight());const i=n.polygons,r=(t,n,i)=>{if(e.boundingBoxesPolygon.lineStyle(s,this.boundingBoxesPolygonColor,1),e.boundingBoxesPolygon.beginFill(this.boundingBoxesPolygonColor,.1),i<3)throw new Error("Polygon must contain at least 3 vertices");const r=[],a=2*s;for(let s=0,o=t.length;s<o;s+=2){const n=t[s],i=t[s+1];e.boundingBoxesCircle.lineStyle(0),e.boundingBoxesCircle.beginFill(this.boundingBoxesCircleColor),e.boundingBoxesCircle.drawCircle(n,i,a),e.boundingBoxesCircle.endFill(),r.push(n,i)}e.boundingBoxesPolygon.drawPolygon(r),e.boundingBoxesPolygon.endFill()};for(let a=0,o=i.length;a<o;a++){const t=i[a];r(t,0,t.length)}}drawPathsFunc(t,e,s){const n=t.skeleton.slots;e.pathsCurve.lineStyle(s,this.pathsCurveColor,1),e.pathsLine.lineStyle(s,this.pathsLineColor,1);for(let i=0,r=n.length;i<r;i++){const t=n[i];if(!t.bone.active)continue;const s=t.getAttachment();if(null==s||s.type!==lv.Path)continue;const r=s;let a=r.worldVerticesLength;const o=new Float32Array(a);r.computeWorldVertices(t,0,a,o,0,2);let h=o[2],l=o[3],c=0,u=0;if(r.closed){const t=o[0],s=o[1],n=o[a-2],i=o[a-1];c=o[a-4],u=o[a-3],e.pathsCurve.moveTo(h,l),e.pathsCurve.bezierCurveTo(t,s,n,i,c,u),e.pathsLine.moveTo(h,l),e.pathsLine.lineTo(t,s),e.pathsLine.moveTo(c,u),e.pathsLine.lineTo(n,i)}a-=4;for(let n=4;n<a;n+=6){const t=o[n],s=o[n+1],i=o[n+2],r=o[n+3];c=o[n+4],u=o[n+5],e.pathsCurve.moveTo(h,l),e.pathsCurve.bezierCurveTo(t,s,i,r,c,u),e.pathsLine.moveTo(h,l),e.pathsLine.lineTo(t,s),e.pathsLine.moveTo(c,u),e.pathsLine.lineTo(i,r),h=c,l=u}}}unregisterSpine(t){this.registeredSpines.has(t)||console.warn("SpineDebugRenderer.unregisterSpine() - spine is not registered, can't unregister!",t);this.registeredSpines.get(t).parentDebugContainer.destroy({baseTexture:!0,children:!0,texture:!0}),this.registeredSpines.delete(t)}}const zv={extension:Wo.Asset,loader:{extension:{type:Wo.LoadParser,priority:Vu.Normal},test:t=>Ru(t,".atlas"),load(t){return f(this,null,(function*(){const e=yield _r.ADAPTER.fetch(t);return yield e.text()}))},testParse(t,e){const s=Ru(e.src,".atlas"),n="string"==typeof t;return Promise.resolve(s&&n)},parse(t,e,s){return f(this,null,(function*(){const n=e.data;let i=Va.dirname(e.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");let r=null,a=null;const o=new Promise(((t,e)=>{r=t,a=e}));let h;const l=t=>{t||a("Something went terribly wrong loading a spine .atlas file\nMost likely your texture failed to load."),r(h)};if(n.image||n.images){const e=Object.assign(n.image?{default:n.image}:{},n.images);h=new bv(t,((t,s)=>{const n=e[t]||e.default;n&&n.baseTexture?s(n.baseTexture):s(n)}),l)}else h=new bv(t,Gv(s,i,n.imageMetadata),l);return yield o}))},unload(t){t.dispose()}}},Gv=(t,e,s)=>(n,i)=>f(void 0,null,(function*(){const r=Va.normalize([...e.split(Va.sep),n].join(Va.sep)),a=yield t.load({src:r,data:s});i(a.baseTexture)}));function Hv(t){return t.hasOwnProperty("bones")}Go.add(zv);class qv{constructor(){}installLoader(){const t=this,e={extension:Wo.Asset,loader:{extension:{type:Wo.LoadParser,priority:Vu.Normal},test:t=>Ru(t,".skel"),load(t){return f(this,null,(function*(){const e=yield _r.ADAPTER.fetch(t);return yield e.arrayBuffer()}))},testParse(t,e){var s;const n=Ru(e.src,".json")&&Hv(t),i=Ru(e.src,".skel")&&t instanceof ArrayBuffer;const r=!1===(null==(s=e.data)?void 0:s.spineAtlas);return Promise.resolve(n&&!r||i)},parse(e,s,n){return f(this,null,(function*(){var i;const r=Va.extname(s.src).toLowerCase(),a=Va.basename(s.src,r);let o=Va.dirname(s.src);o&&o.lastIndexOf("/")!==o.length-1&&(o+="/");const h=Ru(s.src,".json")&&Hv(e);let l=null,c=e;h?l=t.createJsonParser():(l=t.createBinaryParser(),c=new Uint8Array(e));const u=s.data||{},d=null!=(i=null==u?void 0:u.spineSkeletonScale)?i:null;d&&(l.scale=d);const f=u.spineAtlas;if(f&&f.pages)return t.parseData(l,f,c);const p=u.atlasRawData;if(p){let e=null,s=null;const i=new Promise(((t,n)=>{e=t,s=n})),r=new bv(p,Gv(n,o,u.imageMetadata),(t=>{t||s("Something went terribly wrong loading a spine .atlas file\nMost likely your texture failed to load."),e(r)})),a=yield i;return t.parseData(l,a,c)}let m=u.spineAtlasFile;m||(m=`${o+a}.atlas`);const g=yield n.load({src:m,data:u,alias:u.spineAtlasAlias});return t.parseData(l,g,c)}))}}};return Go.add(e),e}}let Kv=class{constructor(t){if(null==t)throw new Error("name cannot be null.");this.name=t}};const Zv=class extends Kv{constructor(t){super(t),this.id=(65535&Zv.nextID++)<<11,this.worldVerticesLength=0,this.deformAttachment=this}computeWorldVerticesOld(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)}computeWorldVertices(t,e,s,n,i,r){s=i+(s>>1)*r;const a=t.bone.skeleton,o=t.deform;let h=this.vertices;const l=this.bones;if(null==l){o.length>0&&(h=o);const a=t.bone.matrix,l=a.tx,c=a.ty,u=a.a,d=a.c,f=a.b,p=a.d;for(let t=e,o=i;o<s;t+=2,o+=r){const e=h[t],s=h[t+1];n[o]=e*u+s*d+l,n[o+1]=e*f+s*p+c}return}let c=0,u=0;for(let f=0;f<e;f+=2){const t=l[c];c+=t+1,u+=t}const d=a.bones;if(0==o.length)for(let f=i,p=3*u;f<s;f+=r){let t=0,e=0,s=l[c++];for(s+=c;c<s;c++,p+=3){const s=d[l[c]].matrix,n=h[p],i=h[p+1],r=h[p+2];t+=(n*s.a+i*s.c+s.tx)*r,e+=(n*s.b+i*s.d+s.ty)*r}n[f]=t,n[f+1]=e}else{const t=o;for(let e=i,a=3*u,o=u<<1;e<s;e+=r){let s=0,i=0,r=l[c++];for(r+=c;c<r;c++,a+=3,o+=2){const e=d[l[c]].matrix,n=h[a]+t[o],r=h[a+1]+t[o+1],u=h[a+2];s+=(n*e.a+r*e.c+e.tx)*u,i+=(n*e.b+r*e.d+e.ty)*u}n[e]=s,n[e+1]=i}}}copyTo(t){null!=this.bones?(t.bones=new Array(this.bones.length),Ov.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,null!=this.vertices?(t.vertices=Ov.newFloatArray(this.vertices.length),Ov.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)):t.vertices=null,t.worldVerticesLength=this.worldVerticesLength,t.deformAttachment=this.deformAttachment}};let Qv=Zv;Qv.nextID=0;let Jv=class t extends Qv{constructor(t){super(t),this.type=lv.BoundingBox,this.color=new Mv(1,1,1,1)}copy(){const e=new t(this.name);return this.copyTo(e),e.color.setFromColor(this.color),e}},tx=class t extends Qv{constructor(t){super(t),this.type=lv.Clipping,this.color=new Mv(.2275,.2275,.8078,1)}copy(){const e=new t(this.name);return this.copyTo(e),e.endSlot=this.endSlot,e.color.setFromColor(this.color),e}},ex=class t extends Qv{constructor(t){super(t),this.type=lv.Mesh,this.color=new Mv(1,1,1,1),this.tempColor=new Mv(0,0,0,0)}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}copy(){if(null!=this.parentMesh)return this.newLinkedMesh();const e=new t(this.name);return e.region=this.region,e.path=this.path,e.color.setFromColor(this.color),this.copyTo(e),e.regionUVs=new Float32Array(this.regionUVs.length),Ov.arrayCopy(this.regionUVs,0,e.regionUVs,0,this.regionUVs.length),e.triangles=new Array(this.triangles.length),Ov.arrayCopy(this.triangles,0,e.triangles,0,this.triangles.length),e.hullLength=this.hullLength,null!=this.edges&&(e.edges=new Array(this.edges.length),Ov.arrayCopy(this.edges,0,e.edges,0,this.edges.length)),e.width=this.width,e.height=this.height,e}newLinkedMesh(){const e=new t(this.name);return e.region=this.region,e.path=this.path,e.color.setFromColor(this.color),e.deformAttachment=this.deformAttachment,e.setParentMesh(null!=this.parentMesh?this.parentMesh:this),e}},sx=class t extends Qv{constructor(t){super(t),this.type=lv.Path,this.closed=!1,this.constantSpeed=!1,this.color=new Mv(1,1,1,1)}copy(){const e=new t(this.name);return this.copyTo(e),e.lengths=new Array(this.lengths.length),Ov.arrayCopy(this.lengths,0,e.lengths,0,this.lengths.length),e.closed=closed,e.constantSpeed=this.constantSpeed,e.color.setFromColor(this.color),e}},nx=class t extends Qv{constructor(t){super(t),this.type=lv.Point,this.color=new Mv(.38,.94,0,1)}computeWorldPosition(t,e){const s=t.matrix;return e.x=this.x*s.a+this.y*s.c+t.worldX,e.y=this.x*s.b+this.y*s.d+t.worldY,e}computeWorldRotation(t){const e=t.matrix,s=Pv.cosDeg(this.rotation),n=Pv.sinDeg(this.rotation),i=s*e.a+n*e.c,r=s*e.b+n*e.d;return Math.atan2(r,i)*Pv.radDeg}copy(){const e=new t(this.name);return e.x=this.x,e.y=this.y,e.rotation=this.rotation,e.color.setFromColor(this.color),e}},ix=class{constructor(t,e){if(this.deform=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new Mv,this.darkColor=null==t.darkColor?null:new Mv,this.setToSetupPose(),this.blendMode=this.data.blendMode}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)}setAttachmentTime(t){this.attachmentTime=this.bone.skeleton.time-t}getAttachmentTime(){return this.bone.skeleton.time-this.attachmentTime}setToSetupPose(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))}};const rx=class extends Kv{constructor(t){super(t),this.type=lv.Region,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new Mv(1,1,1,1),this.offset=Ov.newFloatArray(8),this.uvs=Ov.newFloatArray(8),this.tempColor=new Mv(1,1,1,1)}updateOffset(){const t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,s=-this.width/2*this.scaleX+this.region.offsetX*t,n=-this.height/2*this.scaleY+this.region.offsetY*e,i=s+this.region.width*t,r=n+this.region.height*e,a=this.rotation*Math.PI/180,o=Math.cos(a),h=Math.sin(a),l=s*o+this.x,c=s*h,u=n*o+this.y,d=n*h,f=i*o+this.x,p=i*h,m=r*o+this.y,g=r*h,y=this.offset;y[rx.OX1]=l-d,y[rx.OY1]=u+c,y[rx.OX2]=l-g,y[rx.OY2]=m+c,y[rx.OX3]=f-g,y[rx.OY3]=m+p,y[rx.OX4]=f-d,y[rx.OY4]=u+p}setRegion(t){this.region=t;const e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}computeWorldVertices(t,e,s,n){const i=this.offset,r=t instanceof ix?t.bone.matrix:t.matrix,a=r.tx,o=r.ty,h=r.a,l=r.c,c=r.b,u=r.d;let d=0,f=0;d=i[rx.OX1],f=i[rx.OY1],e[s]=d*h+f*l+a,e[s+1]=d*c+f*u+o,s+=n,d=i[rx.OX2],f=i[rx.OY2],e[s]=d*h+f*l+a,e[s+1]=d*c+f*u+o,s+=n,d=i[rx.OX3],f=i[rx.OY3],e[s]=d*h+f*l+a,e[s+1]=d*c+f*u+o,s+=n,d=i[rx.OX4],f=i[rx.OY4],e[s]=d*h+f*l+a,e[s+1]=d*c+f*u+o}copy(){const t=new rx(this.name);return t.region=this.region,t.rendererObject=this.rendererObject,t.path=this.path,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,Ov.arrayCopy(this.uvs,0,t.uvs,0,8),Ov.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t}};let ax=rx;ax.OX1=0,ax.OY1=1,ax.OX2=2,ax.OY2=3,ax.OX3=4,ax.OY3=5,ax.OX4=6,ax.OY4=7,ax.X1=0,ax.Y1=1,ax.C1R=2,ax.C1G=3,ax.C1B=4,ax.C1A=5,ax.U1=6,ax.V1=7,ax.X2=8,ax.Y2=9,ax.C2R=10,ax.C2G=11,ax.C2B=12,ax.C2A=13,ax.U2=14,ax.V2=15,ax.X3=16,ax.Y3=17,ax.C3R=18,ax.C3G=19,ax.C3B=20,ax.C3A=21,ax.U3=22,ax.V3=23,ax.X4=24,ax.Y4=25,ax.C4R=26,ax.C4G=27,ax.C4B=28,ax.C4A=29,ax.U4=30,ax.V4=31;const ox=class{constructor(t){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t}begin(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY}transform(t,e,s,n){const i=this.angle*Pv.degreesToRadians,r=t.x-this.worldX,a=t.y-this.worldY,o=Math.sqrt(r*r+a*a);if(o<this.radius){const e=ox.interpolation.apply(0,i,(this.radius-o)/this.radius),s=Math.cos(e),n=Math.sin(e);t.x=s*r-n*a+this.worldX,t.y=n*r+s*a+this.worldY}}end(){}};let hx=ox;hx.interpolation=new Dv(2);let lx=class{constructor(t,e,s){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.timelineIds=[];for(let n=0;n<e.length;n++)this.timelineIds[e[n].getPropertyId()]=!0;this.duration=s}hasTimeline(t){return 1==this.timelineIds[t]}apply(t,e,s,n,i,r,a,o){if(null==t)throw new Error("skeleton cannot be null.");n&&0!=this.duration&&(s%=this.duration,e>0&&(e%=this.duration));const h=this.timelines;for(let l=0,c=h.length;l<c;l++)h[l].apply(t,e,s,i,r,a,o)}static binarySearch(t,e,s=1){let n=0,i=t.length/s-2;if(0==i)return s;let r=i>>>1;for(;;){if(t[(r+1)*s]<=e?n=r+1:i=r,n==i)return(n+1)*s;r=n+i>>>1}}static linearSearch(t,e,s){for(let n=0,i=t.length-s;n<=i;n+=s)if(t[n]>e)return n;return-1}};var cx=(t=>(t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor",t))(cx||{});const ux=class{constructor(t){if(t<=0)throw new Error(`frameCount must be > 0: ${t}`);this.curves=Ov.newFloatArray((t-1)*ux.BEZIER_SIZE)}getFrameCount(){return this.curves.length/ux.BEZIER_SIZE+1}setLinear(t){this.curves[t*ux.BEZIER_SIZE]=ux.LINEAR}setStepped(t){this.curves[t*ux.BEZIER_SIZE]=ux.STEPPED}getCurveType(t){const e=t*ux.BEZIER_SIZE;if(e==this.curves.length)return ux.LINEAR;const s=this.curves[e];return s==ux.LINEAR?ux.LINEAR:s==ux.STEPPED?ux.STEPPED:ux.BEZIER}setCurve(t,e,s,n,i){const r=.03*(2*-e+n),a=.03*(2*-s+i),o=.006*(3*(e-n)+1),h=.006*(3*(s-i)+1);let l=2*r+o,c=2*a+h,u=.3*e+r+.16666667*o,d=.3*s+a+.16666667*h,f=t*ux.BEZIER_SIZE;const p=this.curves;p[f++]=ux.BEZIER;let m=u,g=d;for(let y=f+ux.BEZIER_SIZE-1;f<y;f+=2)p[f]=m,p[f+1]=g,u+=l,d+=c,l+=o,c+=h,m+=u,g+=d}getCurvePercent(t,e){e=Pv.clamp(e,0,1);const s=this.curves;let n=t*ux.BEZIER_SIZE;const i=s[n];if(i==ux.LINEAR)return e;if(i==ux.STEPPED)return 0;n++;let r=0;for(let o=n,h=n+ux.BEZIER_SIZE-1;n<h;n+=2)if(r=s[n],r>=e){let t,i;return n==o?(t=0,i=0):(t=s[n-2],i=s[n-1]),i+(s[n+1]-i)*(e-t)/(r-t)}const a=s[n-1];return a+(1-a)*(e-r)/(1-r)}};let dx=ux;dx.LINEAR=0,dx.STEPPED=1,dx.BEZIER=2,dx.BEZIER_SIZE=19;const fx=class extends dx{constructor(t){super(t),this.frames=Ov.newFloatArray(t<<1)}getPropertyId(){return 0+this.boneIndex}setFrame(t,e,s){t<<=1,this.frames[t]=e,this.frames[t+fx.ROTATION]=s}apply(t,e,s,n,i,r,a){const o=this.frames,h=t.bones[this.boneIndex];if(!h.active)return;if(s<o[0]){switch(r){case uv.setup:return void(h.rotation=h.data.rotation);case uv.first:const t=h.data.rotation-h.rotation;h.rotation+=(t-360*(16384-(16384.499999999996-t/360|0)))*i}return}if(s>=o[o.length-fx.ENTRIES]){let t=o[o.length+fx.PREV_ROTATION];switch(r){case uv.setup:h.rotation=h.data.rotation+t*i;break;case uv.first:case uv.replace:t+=h.data.rotation-h.rotation,t-=360*(16384-(16384.499999999996-t/360|0));case uv.add:h.rotation+=t*i}return}const l=lx.binarySearch(o,s,fx.ENTRIES),c=o[l+fx.PREV_ROTATION],u=o[l],d=this.getCurvePercent((l>>1)-1,1-(s-u)/(o[l+fx.PREV_TIME]-u));let f=o[l+fx.ROTATION]-c;switch(f=c+(f-360*(16384-(16384.499999999996-f/360|0)))*d,r){case uv.setup:h.rotation=h.data.rotation+(f-360*(16384-(16384.499999999996-f/360|0)))*i;break;case uv.first:case uv.replace:f+=h.data.rotation-h.rotation;case uv.add:h.rotation+=(f-360*(16384-(16384.499999999996-f/360|0)))*i}}};let px=fx;px.ENTRIES=2,px.PREV_TIME=-2,px.PREV_ROTATION=-1,px.ROTATION=1;const mx=class extends dx{constructor(t){super(t),this.frames=Ov.newFloatArray(t*mx.ENTRIES)}getPropertyId(){return(1<<24)+this.boneIndex}setFrame(t,e,s,n){t*=mx.ENTRIES,this.frames[t]=e,this.frames[t+mx.X]=s,this.frames[t+mx.Y]=n}apply(t,e,s,n,i,r,a){const o=this.frames,h=t.bones[this.boneIndex];if(!h.active)return;if(s<o[0]){switch(r){case uv.setup:return h.x=h.data.x,void(h.y=h.data.y);case uv.first:h.x+=(h.data.x-h.x)*i,h.y+=(h.data.y-h.y)*i}return}let l=0,c=0;if(s>=o[o.length-mx.ENTRIES])l=o[o.length+mx.PREV_X],c=o[o.length+mx.PREV_Y];else{const t=lx.binarySearch(o,s,mx.ENTRIES);l=o[t+mx.PREV_X],c=o[t+mx.PREV_Y];const e=o[t],n=this.getCurvePercent(t/mx.ENTRIES-1,1-(s-e)/(o[t+mx.PREV_TIME]-e));l+=(o[t+mx.X]-l)*n,c+=(o[t+mx.Y]-c)*n}switch(r){case uv.setup:h.x=h.data.x+l*i,h.y=h.data.y+c*i;break;case uv.first:case uv.replace:h.x+=(h.data.x+l-h.x)*i,h.y+=(h.data.y+c-h.y)*i;break;case uv.add:h.x+=l*i,h.y+=c*i}}};let gx=mx;gx.ENTRIES=3,gx.PREV_TIME=-3,gx.PREV_X=-2,gx.PREV_Y=-1,gx.X=1,gx.Y=2;let yx=class t extends gx{constructor(t){super(t)}getPropertyId(){return(2<<24)+this.boneIndex}apply(e,s,n,i,r,a,o){const h=this.frames,l=e.bones[this.boneIndex];if(!l.active)return;if(n<h[0]){switch(a){case uv.setup:return l.scaleX=l.data.scaleX,void(l.scaleY=l.data.scaleY);case uv.first:l.scaleX+=(l.data.scaleX-l.scaleX)*r,l.scaleY+=(l.data.scaleY-l.scaleY)*r}return}let c=0,u=0;if(n>=h[h.length-t.ENTRIES])c=h[h.length+t.PREV_X]*l.data.scaleX,u=h[h.length+t.PREV_Y]*l.data.scaleY;else{const e=lx.binarySearch(h,n,t.ENTRIES);c=h[e+t.PREV_X],u=h[e+t.PREV_Y];const s=h[e],i=this.getCurvePercent(e/t.ENTRIES-1,1-(n-s)/(h[e+t.PREV_TIME]-s));c=(c+(h[e+t.X]-c)*i)*l.data.scaleX,u=(u+(h[e+t.Y]-u)*i)*l.data.scaleY}if(1==r)a==uv.add?(l.scaleX+=c-l.data.scaleX,l.scaleY+=u-l.data.scaleY):(l.scaleX=c,l.scaleY=u);else{let t=0,e=0;if(o==dv.mixOut)switch(a){case uv.setup:t=l.data.scaleX,e=l.data.scaleY,l.scaleX=t+(Math.abs(c)*Pv.signum(t)-t)*r,l.scaleY=e+(Math.abs(u)*Pv.signum(e)-e)*r;break;case uv.first:case uv.replace:t=l.scaleX,e=l.scaleY,l.scaleX=t+(Math.abs(c)*Pv.signum(t)-t)*r,l.scaleY=e+(Math.abs(u)*Pv.signum(e)-e)*r;break;case uv.add:t=l.scaleX,e=l.scaleY,l.scaleX=t+(Math.abs(c)*Pv.signum(t)-l.data.scaleX)*r,l.scaleY=e+(Math.abs(u)*Pv.signum(e)-l.data.scaleY)*r}else switch(a){case uv.setup:t=Math.abs(l.data.scaleX)*Pv.signum(c),e=Math.abs(l.data.scaleY)*Pv.signum(u),l.scaleX=t+(c-t)*r,l.scaleY=e+(u-e)*r;break;case uv.first:case uv.replace:t=Math.abs(l.scaleX)*Pv.signum(c),e=Math.abs(l.scaleY)*Pv.signum(u),l.scaleX=t+(c-t)*r,l.scaleY=e+(u-e)*r;break;case uv.add:t=Pv.signum(c),e=Pv.signum(u),l.scaleX=Math.abs(l.scaleX)*t+(c-Math.abs(l.data.scaleX)*t)*r,l.scaleY=Math.abs(l.scaleY)*e+(u-Math.abs(l.data.scaleY)*e)*r}}}},vx=class t extends gx{constructor(t){super(t)}getPropertyId(){return(3<<24)+this.boneIndex}apply(e,s,n,i,r,a,o){const h=this.frames,l=e.bones[this.boneIndex];if(!l.active)return;if(n<h[0]){switch(a){case uv.setup:return l.shearX=l.data.shearX,void(l.shearY=l.data.shearY);case uv.first:l.shearX+=(l.data.shearX-l.shearX)*r,l.shearY+=(l.data.shearY-l.shearY)*r}return}let c=0,u=0;if(n>=h[h.length-t.ENTRIES])c=h[h.length+t.PREV_X],u=h[h.length+t.PREV_Y];else{const e=lx.binarySearch(h,n,t.ENTRIES);c=h[e+t.PREV_X],u=h[e+t.PREV_Y];const s=h[e],i=this.getCurvePercent(e/t.ENTRIES-1,1-(n-s)/(h[e+t.PREV_TIME]-s));c+=(h[e+t.X]-c)*i,u+=(h[e+t.Y]-u)*i}switch(a){case uv.setup:l.shearX=l.data.shearX+c*r,l.shearY=l.data.shearY+u*r;break;case uv.first:case uv.replace:l.shearX+=(l.data.shearX+c-l.shearX)*r,l.shearY+=(l.data.shearY+u-l.shearY)*r;break;case uv.add:l.shearX+=c*r,l.shearY+=u*r}}};const xx=class extends dx{constructor(t){super(t),this.frames=Ov.newFloatArray(t*xx.ENTRIES)}getPropertyId(){return(5<<24)+this.slotIndex}setFrame(t,e,s,n,i,r){t*=xx.ENTRIES,this.frames[t]=e,this.frames[t+xx.R]=s,this.frames[t+xx.G]=n,this.frames[t+xx.B]=i,this.frames[t+xx.A]=r}apply(t,e,s,n,i,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=this.frames;if(s<h[0]){switch(r){case uv.setup:return void o.color.setFromColor(o.data.color);case uv.first:const t=o.color,e=o.data.color;t.add((e.r-t.r)*i,(e.g-t.g)*i,(e.b-t.b)*i,(e.a-t.a)*i)}return}let l=0,c=0,u=0,d=0;if(s>=h[h.length-xx.ENTRIES]){const t=h.length;l=h[t+xx.PREV_R],c=h[t+xx.PREV_G],u=h[t+xx.PREV_B],d=h[t+xx.PREV_A]}else{const t=lx.binarySearch(h,s,xx.ENTRIES);l=h[t+xx.PREV_R],c=h[t+xx.PREV_G],u=h[t+xx.PREV_B],d=h[t+xx.PREV_A];const e=h[t],n=this.getCurvePercent(t/xx.ENTRIES-1,1-(s-e)/(h[t+xx.PREV_TIME]-e));l+=(h[t+xx.R]-l)*n,c+=(h[t+xx.G]-c)*n,u+=(h[t+xx.B]-u)*n,d+=(h[t+xx.A]-d)*n}if(1==i)o.color.set(l,c,u,d);else{const t=o.color;r==uv.setup&&t.setFromColor(o.data.color),t.add((l-t.r)*i,(c-t.g)*i,(u-t.b)*i,(d-t.a)*i)}}};let _x=xx;_x.ENTRIES=5,_x.PREV_TIME=-5,_x.PREV_R=-4,_x.PREV_G=-3,_x.PREV_B=-2,_x.PREV_A=-1,_x.R=1,_x.G=2,_x.B=3,_x.A=4;const bx=class extends dx{constructor(t){super(t),this.frames=Ov.newFloatArray(t*bx.ENTRIES)}getPropertyId(){return(14<<24)+this.slotIndex}setFrame(t,e,s,n,i,r,a,o,h){t*=bx.ENTRIES,this.frames[t]=e,this.frames[t+bx.R]=s,this.frames[t+bx.G]=n,this.frames[t+bx.B]=i,this.frames[t+bx.A]=r,this.frames[t+bx.R2]=a,this.frames[t+bx.G2]=o,this.frames[t+bx.B2]=h}apply(t,e,s,n,i,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=this.frames;if(s<h[0]){switch(r){case uv.setup:return o.color.setFromColor(o.data.color),void o.darkColor.setFromColor(o.data.darkColor);case uv.first:const t=o.color,e=o.darkColor,s=o.data.color,n=o.data.darkColor;t.add((s.r-t.r)*i,(s.g-t.g)*i,(s.b-t.b)*i,(s.a-t.a)*i),e.add((n.r-e.r)*i,(n.g-e.g)*i,(n.b-e.b)*i,0)}return}let l=0,c=0,u=0,d=0,f=0,p=0,m=0;if(s>=h[h.length-bx.ENTRIES]){const t=h.length;l=h[t+bx.PREV_R],c=h[t+bx.PREV_G],u=h[t+bx.PREV_B],d=h[t+bx.PREV_A],f=h[t+bx.PREV_R2],p=h[t+bx.PREV_G2],m=h[t+bx.PREV_B2]}else{const t=lx.binarySearch(h,s,bx.ENTRIES);l=h[t+bx.PREV_R],c=h[t+bx.PREV_G],u=h[t+bx.PREV_B],d=h[t+bx.PREV_A],f=h[t+bx.PREV_R2],p=h[t+bx.PREV_G2],m=h[t+bx.PREV_B2];const e=h[t],n=this.getCurvePercent(t/bx.ENTRIES-1,1-(s-e)/(h[t+bx.PREV_TIME]-e));l+=(h[t+bx.R]-l)*n,c+=(h[t+bx.G]-c)*n,u+=(h[t+bx.B]-u)*n,d+=(h[t+bx.A]-d)*n,f+=(h[t+bx.R2]-f)*n,p+=(h[t+bx.G2]-p)*n,m+=(h[t+bx.B2]-m)*n}if(1==i)o.color.set(l,c,u,d),o.darkColor.set(f,p,m,1);else{const t=o.color,e=o.darkColor;r==uv.setup&&(t.setFromColor(o.data.color),e.setFromColor(o.data.darkColor)),t.add((l-t.r)*i,(c-t.g)*i,(u-t.b)*i,(d-t.a)*i),e.add((f-e.r)*i,(p-e.g)*i,(m-e.b)*i,0)}}};let wx=bx;wx.ENTRIES=8,wx.PREV_TIME=-8,wx.PREV_R=-7,wx.PREV_G=-6,wx.PREV_B=-5,wx.PREV_A=-4,wx.PREV_R2=-3,wx.PREV_G2=-2,wx.PREV_B2=-1,wx.R=1,wx.G=2,wx.B=3,wx.A=4,wx.R2=5,wx.G2=6,wx.B2=7;let Ex=class{constructor(t){this.frames=Ov.newFloatArray(t),this.attachmentNames=new Array(t)}getPropertyId(){return(4<<24)+this.slotIndex}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.attachmentNames[t]=s}apply(t,e,s,n,i,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;if(a==dv.mixOut)return void(r==uv.setup&&this.setAttachment(t,o,o.data.attachmentName));const h=this.frames;if(s<h[0])return void(r!=uv.setup&&r!=uv.first||this.setAttachment(t,o,o.data.attachmentName));let l=0;l=s>=h[h.length-1]?h.length-1:lx.binarySearch(h,s,1)-1;const c=this.attachmentNames[l];t.slots[this.slotIndex].setAttachment(null==c?null:t.getAttachment(this.slotIndex,c))}setAttachment(t,e,s){e.setAttachment(null==s?null:t.getAttachment(this.slotIndex,s))}},Sx=null,Tx=class extends dx{constructor(t){super(t),this.frames=Ov.newFloatArray(t),this.frameVertices=new Array(t),null==Sx&&(Sx=Ov.newFloatArray(64))}getPropertyId(){return(6<<27)+Number(this.attachment.id)+this.slotIndex}setFrame(t,e,s){this.frames[t]=e,this.frameVertices[t]=s}apply(t,e,s,n,i,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=o.getAttachment();if(!(h instanceof Qv)||h.deformAttachment!=this.attachment)return;const l=o.deform;0==l.length&&(r=uv.setup);const c=this.frameVertices,u=c[0].length,d=this.frames;if(s<d[0]){const t=h;switch(r){case uv.setup:return void(l.length=0);case uv.first:if(1==i){l.length=0;break}const e=Ov.setArraySize(l,u);if(null==t.bones){const s=t.vertices;for(let t=0;t<u;t++)e[t]+=(s[t]-e[t])*i}else{i=1-i;for(let t=0;t<u;t++)e[t]*=i}}return}const f=Ov.setArraySize(l,u);if(s>=d[d.length-1]){const t=c[d.length-1];if(1==i)if(r==uv.add){const e=h;if(null==e.bones){const s=e.vertices;for(let e=0;e<u;e++)f[e]+=t[e]-s[e]}else for(let s=0;s<u;s++)f[s]+=t[s]}else Ov.arrayCopy(t,0,f,0,u);else switch(r){case uv.setup:{const e=h;if(null==e.bones){const s=e.vertices;for(let e=0;e<u;e++){const n=s[e];f[e]=n+(t[e]-n)*i}}else for(let s=0;s<u;s++)f[s]=t[s]*i;break}case uv.first:case uv.replace:for(let s=0;s<u;s++)f[s]+=(t[s]-f[s])*i;break;case uv.add:const e=h;if(null==e.bones){const s=e.vertices;for(let e=0;e<u;e++)f[e]+=(t[e]-s[e])*i}else for(let s=0;s<u;s++)f[s]+=t[s]*i}return}const p=lx.binarySearch(d,s),m=c[p-1],g=c[p],y=d[p],v=this.getCurvePercent(p-1,1-(s-y)/(d[p-1]-y));if(1==i)if(r==uv.add){const t=h;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const s=m[t];f[t]+=s+(g[t]-s)*v-e[t]}}else for(let e=0;e<u;e++){const t=m[e];f[e]+=t+(g[e]-t)*v}}else for(let x=0;x<u;x++){const t=m[x];f[x]=t+(g[x]-t)*v}else switch(r){case uv.setup:{const t=h;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const s=m[t],n=e[t];f[t]=n+(s+(g[t]-s)*v-n)*i}}else for(let e=0;e<u;e++){const t=m[e];f[e]=(t+(g[e]-t)*v)*i}break}case uv.first:case uv.replace:for(let e=0;e<u;e++){const t=m[e];f[e]+=(t+(g[e]-t)*v-f[e])*i}break;case uv.add:const t=h;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const s=m[t];f[t]+=(s+(g[t]-s)*v-e[t])*i}}else for(let e=0;e<u;e++){const t=m[e];f[e]+=(t+(g[e]-t)*v)*i}}}},Ax=class{constructor(t){this.frames=Ov.newFloatArray(t),this.events=new Array(t)}getPropertyId(){return 7<<24}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,s,n,i,r,a){if(null==n)return;const o=this.frames,h=this.frames.length;if(e>s)this.apply(t,e,Number.MAX_VALUE,n,i,r,a),e=-1;else if(e>=o[h-1])return;if(s<o[0])return;let l=0;if(e<o[0])l=0;else{l=lx.binarySearch(o,e);const t=o[l];for(;l>0&&o[l-1]==t;)l--}for(;l<h&&s>=o[l];l++)n.push(this.events[l])}},Cx=class{constructor(t){this.frames=Ov.newFloatArray(t),this.drawOrders=new Array(t)}getPropertyId(){return 8<<24}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.drawOrders[t]=s}apply(t,e,s,n,i,r,a){const o=t.drawOrder,h=t.slots;if(a==dv.mixOut&&r==uv.setup)return void Ov.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);const l=this.frames;if(s<l[0])return void(r!=uv.setup&&r!=uv.first||Ov.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));let c=0;c=s>=l[l.length-1]?l.length-1:lx.binarySearch(l,s)-1;const u=this.drawOrders[c];if(null==u)Ov.arrayCopy(h,0,o,0,h.length);else for(let d=0,f=u.length;d<f;d++)o[d]=h[u[d]]}};const Mx=class extends dx{constructor(t){super(t),this.frames=Ov.newFloatArray(t*Mx.ENTRIES)}getPropertyId(){return(9<<24)+this.ikConstraintIndex}setFrame(t,e,s,n,i,r,a){t*=Mx.ENTRIES,this.frames[t]=e,this.frames[t+Mx.MIX]=s,this.frames[t+Mx.SOFTNESS]=n,this.frames[t+Mx.BEND_DIRECTION]=i,this.frames[t+Mx.COMPRESS]=r?1:0,this.frames[t+Mx.STRETCH]=a?1:0}apply(t,e,s,n,i,r,a){const o=this.frames,h=t.ikConstraints[this.ikConstraintIndex];if(!h.active)return;if(s<o[0]){switch(r){case uv.setup:return h.mix=h.data.mix,h.softness=h.data.softness,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,void(h.stretch=h.data.stretch);case uv.first:h.mix+=(h.data.mix-h.mix)*i,h.softness+=(h.data.softness-h.softness)*i,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch}return}if(s>=o[o.length-Mx.ENTRIES])return void(r==uv.setup?(h.mix=h.data.mix+(o[o.length+Mx.PREV_MIX]-h.data.mix)*i,h.softness=h.data.softness+(o[o.length+Mx.PREV_SOFTNESS]-h.data.softness)*i,a==dv.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=o[o.length+Mx.PREV_BEND_DIRECTION],h.compress=0!=o[o.length+Mx.PREV_COMPRESS],h.stretch=0!=o[o.length+Mx.PREV_STRETCH])):(h.mix+=(o[o.length+Mx.PREV_MIX]-h.mix)*i,h.softness+=(o[o.length+Mx.PREV_SOFTNESS]-h.softness)*i,a==dv.mixIn&&(h.bendDirection=o[o.length+Mx.PREV_BEND_DIRECTION],h.compress=0!=o[o.length+Mx.PREV_COMPRESS],h.stretch=0!=o[o.length+Mx.PREV_STRETCH])));const l=lx.binarySearch(o,s,Mx.ENTRIES),c=o[l+Mx.PREV_MIX],u=o[l+Mx.PREV_SOFTNESS],d=o[l],f=this.getCurvePercent(l/Mx.ENTRIES-1,1-(s-d)/(o[l+Mx.PREV_TIME]-d));r==uv.setup?(h.mix=h.data.mix+(c+(o[l+Mx.MIX]-c)*f-h.data.mix)*i,h.softness=h.data.softness+(u+(o[l+Mx.SOFTNESS]-u)*f-h.data.softness)*i,a==dv.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=o[l+Mx.PREV_BEND_DIRECTION],h.compress=0!=o[l+Mx.PREV_COMPRESS],h.stretch=0!=o[l+Mx.PREV_STRETCH])):(h.mix+=(c+(o[l+Mx.MIX]-c)*f-h.mix)*i,h.softness+=(u+(o[l+Mx.SOFTNESS]-u)*f-h.softness)*i,a==dv.mixIn&&(h.bendDirection=o[l+Mx.PREV_BEND_DIRECTION],h.compress=0!=o[l+Mx.PREV_COMPRESS],h.stretch=0!=o[l+Mx.PREV_STRETCH]))}};let Ix=Mx;Ix.ENTRIES=6,Ix.PREV_TIME=-6,Ix.PREV_MIX=-5,Ix.PREV_SOFTNESS=-4,Ix.PREV_BEND_DIRECTION=-3,Ix.PREV_COMPRESS=-2,Ix.PREV_STRETCH=-1,Ix.MIX=1,Ix.SOFTNESS=2,Ix.BEND_DIRECTION=3,Ix.COMPRESS=4,Ix.STRETCH=5;const Px=class extends dx{constructor(t){super(t),this.frames=Ov.newFloatArray(t*Px.ENTRIES)}getPropertyId(){return(10<<24)+this.transformConstraintIndex}setFrame(t,e,s,n,i,r){t*=Px.ENTRIES,this.frames[t]=e,this.frames[t+Px.ROTATE]=s,this.frames[t+Px.TRANSLATE]=n,this.frames[t+Px.SCALE]=i,this.frames[t+Px.SHEAR]=r}apply(t,e,s,n,i,r,a){const o=this.frames,h=t.transformConstraints[this.transformConstraintIndex];if(!h.active)return;if(s<o[0]){const t=h.data;switch(r){case uv.setup:return h.rotateMix=t.rotateMix,h.translateMix=t.translateMix,h.scaleMix=t.scaleMix,void(h.shearMix=t.shearMix);case uv.first:h.rotateMix+=(t.rotateMix-h.rotateMix)*i,h.translateMix+=(t.translateMix-h.translateMix)*i,h.scaleMix+=(t.scaleMix-h.scaleMix)*i,h.shearMix+=(t.shearMix-h.shearMix)*i}return}let l=0,c=0,u=0,d=0;if(s>=o[o.length-Px.ENTRIES]){const t=o.length;l=o[t+Px.PREV_ROTATE],c=o[t+Px.PREV_TRANSLATE],u=o[t+Px.PREV_SCALE],d=o[t+Px.PREV_SHEAR]}else{const t=lx.binarySearch(o,s,Px.ENTRIES);l=o[t+Px.PREV_ROTATE],c=o[t+Px.PREV_TRANSLATE],u=o[t+Px.PREV_SCALE],d=o[t+Px.PREV_SHEAR];const e=o[t],n=this.getCurvePercent(t/Px.ENTRIES-1,1-(s-e)/(o[t+Px.PREV_TIME]-e));l+=(o[t+Px.ROTATE]-l)*n,c+=(o[t+Px.TRANSLATE]-c)*n,u+=(o[t+Px.SCALE]-u)*n,d+=(o[t+Px.SHEAR]-d)*n}if(r==uv.setup){const t=h.data;h.rotateMix=t.rotateMix+(l-t.rotateMix)*i,h.translateMix=t.translateMix+(c-t.translateMix)*i,h.scaleMix=t.scaleMix+(u-t.scaleMix)*i,h.shearMix=t.shearMix+(d-t.shearMix)*i}else h.rotateMix+=(l-h.rotateMix)*i,h.translateMix+=(c-h.translateMix)*i,h.scaleMix+=(u-h.scaleMix)*i,h.shearMix+=(d-h.shearMix)*i}};let Rx=Px;Rx.ENTRIES=5,Rx.PREV_TIME=-5,Rx.PREV_ROTATE=-4,Rx.PREV_TRANSLATE=-3,Rx.PREV_SCALE=-2,Rx.PREV_SHEAR=-1,Rx.ROTATE=1,Rx.TRANSLATE=2,Rx.SCALE=3,Rx.SHEAR=4;const kx=class extends dx{constructor(t){super(t),this.frames=Ov.newFloatArray(t*kx.ENTRIES)}getPropertyId(){return(11<<24)+this.pathConstraintIndex}setFrame(t,e,s){t*=kx.ENTRIES,this.frames[t]=e,this.frames[t+kx.VALUE]=s}apply(t,e,s,n,i,r,a){const o=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(!h.active)return;if(s<o[0]){switch(r){case uv.setup:return void(h.position=h.data.position);case uv.first:h.position+=(h.data.position-h.position)*i}return}let l=0;if(s>=o[o.length-kx.ENTRIES])l=o[o.length+kx.PREV_VALUE];else{const t=lx.binarySearch(o,s,kx.ENTRIES);l=o[t+kx.PREV_VALUE];const e=o[t],n=this.getCurvePercent(t/kx.ENTRIES-1,1-(s-e)/(o[t+kx.PREV_TIME]-e));l+=(o[t+kx.VALUE]-l)*n}r==uv.setup?h.position=h.data.position+(l-h.data.position)*i:h.position+=(l-h.position)*i}};let Dx=kx;Dx.ENTRIES=2,Dx.PREV_TIME=-2,Dx.PREV_VALUE=-1,Dx.VALUE=1;let Fx=class t extends Dx{constructor(t){super(t)}getPropertyId(){return(12<<24)+this.pathConstraintIndex}apply(e,s,n,i,r,a,o){const h=this.frames,l=e.pathConstraints[this.pathConstraintIndex];if(!l.active)return;if(n<h[0]){switch(a){case uv.setup:return void(l.spacing=l.data.spacing);case uv.first:l.spacing+=(l.data.spacing-l.spacing)*r}return}let c=0;if(n>=h[h.length-t.ENTRIES])c=h[h.length+t.PREV_VALUE];else{const e=lx.binarySearch(h,n,t.ENTRIES);c=h[e+t.PREV_VALUE];const s=h[e],i=this.getCurvePercent(e/t.ENTRIES-1,1-(n-s)/(h[e+t.PREV_TIME]-s));c+=(h[e+t.VALUE]-c)*i}a==uv.setup?l.spacing=l.data.spacing+(c-l.data.spacing)*r:l.spacing+=(c-l.spacing)*r}};const Ox=class extends dx{constructor(t){super(t),this.frames=Ov.newFloatArray(t*Ox.ENTRIES)}getPropertyId(){return(13<<24)+this.pathConstraintIndex}setFrame(t,e,s,n){t*=Ox.ENTRIES,this.frames[t]=e,this.frames[t+Ox.ROTATE]=s,this.frames[t+Ox.TRANSLATE]=n}apply(t,e,s,n,i,r,a){const o=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(!h.active)return;if(s<o[0]){switch(r){case uv.setup:return h.rotateMix=h.data.rotateMix,void(h.translateMix=h.data.translateMix);case uv.first:h.rotateMix+=(h.data.rotateMix-h.rotateMix)*i,h.translateMix+=(h.data.translateMix-h.translateMix)*i}return}let l=0,c=0;if(s>=o[o.length-Ox.ENTRIES])l=o[o.length+Ox.PREV_ROTATE],c=o[o.length+Ox.PREV_TRANSLATE];else{const t=lx.binarySearch(o,s,Ox.ENTRIES);l=o[t+Ox.PREV_ROTATE],c=o[t+Ox.PREV_TRANSLATE];const e=o[t],n=this.getCurvePercent(t/Ox.ENTRIES-1,1-(s-e)/(o[t+Ox.PREV_TIME]-e));l+=(o[t+Ox.ROTATE]-l)*n,c+=(o[t+Ox.TRANSLATE]-c)*n}r==uv.setup?(h.rotateMix=h.data.rotateMix+(l-h.data.rotateMix)*i,h.translateMix=h.data.translateMix+(c-h.data.translateMix)*i):(h.rotateMix+=(l-h.rotateMix)*i,h.translateMix+=(c-h.translateMix)*i)}};let Nx=Ox;Nx.ENTRIES=3,Nx.PREV_TIME=-3,Nx.PREV_ROTATE=-2,Nx.PREV_TRANSLATE=-1,Nx.ROTATE=1,Nx.TRANSLATE=2;const Bx=class{constructor(t){this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new Xx(this),this.propertyIDs=new Tv,this.animationsChanged=!1,this.trackEntryPool=new Nv((()=>new $x)),this.data=t}update(t){t*=this.timeScale;const e=this.tracks;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(null==n)continue;n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast;let i=t*n.timeScale;if(n.delay>0){if(n.delay-=i,n.delay>0)continue;i=-n.delay,n.delay=0}let r=n.next;if(null!=r){const e=n.trackLast-r.delay;if(e>=0){for(r.delay=0,r.trackTime+=0==n.timeScale?0:(e/n.timeScale+t)*r.timeScale,n.trackTime+=i,this.setCurrent(s,r,!0);null!=r.mixingFrom;)r.mixTime+=t,r=r.mixingFrom;continue}}else if(n.trackLast>=n.trackEnd&&null==n.mixingFrom){e[s]=null,this.queue.end(n),this.disposeNext(n);continue}if(null!=n.mixingFrom&&this.updateMixingFrom(n,t)){let t=n.mixingFrom;for(n.mixingFrom=null,null!=t&&(t.mixingTo=null);null!=t;)this.queue.end(t),t=t.mixingFrom}n.trackTime+=i}this.queue.drain()}updateMixingFrom(t,e){const s=t.mixingFrom;if(null==s)return!0;const n=this.updateMixingFrom(s,e);return s.animationLast=s.nextAnimationLast,s.trackLast=s.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=s.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=s.mixingFrom,null!=s.mixingFrom&&(s.mixingFrom.mixingTo=t),t.interruptAlpha=s.interruptAlpha,this.queue.end(s)),n):(s.trackTime+=e*s.timeScale,t.mixTime+=e,!1)}apply(t){if(null==t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();const e=this.events,s=this.tracks;let n=!1;for(let a=0,o=s.length;a<o;a++){const i=s[a];if(null==i||i.delay>0)continue;n=!0;const r=0==a?uv.first:i.mixBlend;let o=i.alpha;null!=i.mixingFrom?o*=this.applyMixingFrom(i,t,r):i.trackTime>=i.trackEnd&&null==i.next&&(o=0);const h=i.animationLast,l=i.getAnimationTime(),c=i.animation.timelines.length,u=i.animation.timelines;if(0==a&&1==o||r==uv.add)for(let s=0;s<c;s++){const n=u[s];n instanceof Ex?this.applyAttachmentTimeline(n,t,l,r,!0):n.apply(t,h,l,e,o,r,dv.mixIn)}else{const s=i.timelineMode,n=0==i.timelinesRotation.length;n&&Ov.setArraySize(i.timelinesRotation,c<<1,null);const a=i.timelinesRotation;for(let i=0;i<c;i++){const c=u[i],d=s[i]==Bx.SUBSEQUENT?r:uv.setup;c instanceof px?this.applyRotateTimeline(c,t,l,o,d,a,i<<1,n):c instanceof Ex?this.applyAttachmentTimeline(c,t,l,r,!0):c.apply(t,h,l,e,o,d,dv.mixIn)}}this.queueEvents(i,l),e.length=0,i.nextAnimationLast=l,i.nextTrackLast=i.trackTime}const i=this.unkeyedState+Bx.SETUP,r=t.slots;for(let a=0,o=t.slots.length;a<o;a++){const e=r[a];if(e.attachmentState==i){const s=e.data.attachmentName;e.setAttachment(null==s?null:t.getAttachment(e.data.index,s))}}return this.unkeyedState+=2,this.queue.drain(),n}applyMixingFrom(t,e,s){const n=t.mixingFrom;null!=n.mixingFrom&&this.applyMixingFrom(n,e,s);let i=0;0==t.mixDuration?(i=1,s==uv.first&&(s=uv.setup)):(i=t.mixTime/t.mixDuration,i>1&&(i=1),s!=uv.first&&(s=n.mixBlend));const r=i<n.eventThreshold?this.events:null,a=i<n.attachmentThreshold,o=i<n.drawOrderThreshold,h=n.animationLast,l=n.getAnimationTime(),c=n.animation.timelines.length,u=n.animation.timelines,d=n.alpha*t.interruptAlpha,f=d*(1-i);if(s==uv.add)for(let p=0;p<c;p++)u[p].apply(e,h,l,r,f,s,dv.mixOut);else{const t=n.timelineMode,i=n.timelineHoldMix,p=0==n.timelinesRotation.length;p&&Ov.setArraySize(n.timelinesRotation,c<<1,null);const m=n.timelinesRotation;n.totalAlpha=0;for(let g=0;g<c;g++){const c=u[g];let y,v=dv.mixOut,x=0;switch(t[g]){case Bx.SUBSEQUENT:if(!o&&c instanceof Cx)continue;y=s,x=f;break;case Bx.FIRST:y=uv.setup,x=f;break;case Bx.HOLD_SUBSEQUENT:y=s,x=d;break;case Bx.HOLD_FIRST:y=uv.setup,x=d;break;default:y=uv.setup;const t=i[g];x=d*Math.max(0,1-t.mixTime/t.mixDuration)}n.totalAlpha+=x,c instanceof px?this.applyRotateTimeline(c,e,l,x,y,m,g<<1,p):c instanceof Ex?this.applyAttachmentTimeline(c,e,l,y,a):(o&&c instanceof Cx&&y==uv.setup&&(v=dv.mixIn),c.apply(e,h,l,r,x,y,v))}}return t.mixDuration>0&&this.queueEvents(n,l),this.events.length=0,n.nextAnimationLast=l,n.nextTrackLast=n.trackTime,i}applyAttachmentTimeline(t,e,s,n,i){const r=e.slots[t.slotIndex];if(!r.bone.active)return;const a=t.frames;if(s<a[0])n!=uv.setup&&n!=uv.first||this.setAttachment(e,r,r.data.attachmentName,i);else{let n;n=s>=a[a.length-1]?a.length-1:lx.binarySearch(a,s)-1,this.setAttachment(e,r,t.attachmentNames[n],i)}r.attachmentState<=this.unkeyedState&&(r.attachmentState=this.unkeyedState+Bx.SETUP)}setAttachment(t,e,s,n){e.setAttachment(null==s?null:t.getAttachment(e.data.index,s)),n&&(e.attachmentState=this.unkeyedState+Bx.CURRENT)}applyRotateTimeline(t,e,s,n,i,r,a,o){if(o&&(r[a]=0),1==n)return void t.apply(e,0,s,null,1,i,dv.mixIn);const h=t,l=h.frames,c=e.bones[h.boneIndex];if(!c.active)return;let u=0,d=0;if(s<l[0])switch(i){case uv.setup:c.rotation=c.data.rotation;default:return;case uv.first:u=c.rotation,d=c.data.rotation}else if(u=i==uv.setup?c.data.rotation:c.rotation,s>=l[l.length-px.ENTRIES])d=c.data.rotation+l[l.length+px.PREV_ROTATION];else{const t=lx.binarySearch(l,s,px.ENTRIES),e=l[t+px.PREV_ROTATION],n=l[t],i=h.getCurvePercent((t>>1)-1,1-(s-n)/(l[t+px.PREV_TIME]-n));d=l[t+px.ROTATION]-e,d-=360*(16384-(16384.499999999996-d/360|0)),d=e+d*i+c.data.rotation,d-=360*(16384-(16384.499999999996-d/360|0))}let f=0,p=d-u;if(p-=360*(16384-(16384.499999999996-p/360|0)),0==p)f=r[a];else{let t=0,e=0;o?(t=0,e=p):(t=r[a],e=r[a+1]);const s=p>0;let n=t>=0;Pv.signum(e)!=Pv.signum(p)&&Math.abs(e)<=90&&(Math.abs(t)>180&&(t+=360*Pv.signum(t)),n=s),f=p+t-t%360,n!=s&&(f+=360*Pv.signum(t)),r[a]=f}r[a+1]=p,u+=f*n,c.rotation=u-360*(16384-(16384.499999999996-u/360|0))}queueEvents(t,e){const s=t.animationStart,n=t.animationEnd,i=n-s,r=t.trackLast%i,a=this.events;let o=0;const h=a.length;for(;o<h;o++){const e=a[o];if(e.time<r)break;e.time>n||this.queue.event(t,e)}let l=!1;for(l=t.loop?0==i||r>t.trackTime%i:e>=n&&t.animationLast<n,l&&this.queue.complete(t);o<h;o++){a[o].time<s||this.queue.event(t,a[o])}}clearTracks(){const t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,s=this.tracks.length;e<s;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;const e=this.tracks[t];if(null==e)return;this.queue.end(e),this.disposeNext(e);let s=e;for(;;){const t=s.mixingFrom;if(null==t)break;this.queue.end(t),s.mixingFrom=null,s.mixingTo=null,s=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,s){const n=this.expandToIndex(t);this.tracks[t]=e,null!=n&&(s&&this.queue.interrupt(n),e.mixingFrom=n,n.mixingTo=e,e.mixTime=0,null!=n.mixingFrom&&n.mixDuration>0&&(e.interruptAlpha*=Math.min(1,n.mixTime/n.mixDuration)),n.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,s){const n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error(`Animation not found: ${e}`);return this.setAnimationWith(t,n,s)}setAnimationWith(t,e,s){if(null==e)throw new Error("animation cannot be null.");let n=!0,i=this.expandToIndex(t);null!=i&&(-1==i.nextTrackLast?(this.tracks[t]=i.mixingFrom,this.queue.interrupt(i),this.queue.end(i),this.disposeNext(i),i=i.mixingFrom,n=!1):this.disposeNext(i));const r=this.trackEntry(t,e,s,i);return this.setCurrent(t,r,n),this.queue.drain(),r}addAnimation(t,e,s,n){const i=this.data.skeletonData.findAnimation(e);if(null==i)throw new Error(`Animation not found: ${e}`);return this.addAnimationWith(t,i,s,n)}addAnimationWith(t,e,s,n){if(null==e)throw new Error("animation cannot be null.");let i=this.expandToIndex(t);if(null!=i)for(;null!=i.next;)i=i.next;const r=this.trackEntry(t,e,s,i);if(null==i)this.setCurrent(t,r,!0),this.queue.drain();else if(i.next=r,n<=0){const t=i.animationEnd-i.animationStart;0!=t?(i.loop?n+=t*(1+(i.trackTime/t|0)):n+=Math.max(t,i.trackTime),n-=this.data.getMix(i.animation,e)):n=i.trackTime}return r.delay=n,r}setEmptyAnimation(t,e){const s=this.setAnimationWith(t,Bx.emptyAnimation,!1);return s.mixDuration=e,s.trackEnd=e,s}addEmptyAnimation(t,e,s){s<=0&&(s-=e);const n=this.addAnimationWith(t,Bx.emptyAnimation,!1,s);return n.mixDuration=e,n.trackEnd=e,n}setEmptyAnimations(t){const e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let s=0,n=this.tracks.length;s<n;s++){const e=this.tracks[s];null!=e&&this.setEmptyAnimation(e.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(Ov.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,s,n){const i=this.trackEntryPool.obtain();return i.trackIndex=t,i.animation=e,i.loop=s,i.holdPrevious=!1,i.eventThreshold=0,i.attachmentThreshold=0,i.drawOrderThreshold=0,i.animationStart=0,i.animationEnd=e.duration,i.animationLast=-1,i.nextAnimationLast=-1,i.delay=0,i.trackTime=0,i.trackLast=-1,i.nextTrackLast=-1,i.trackEnd=Number.MAX_VALUE,i.timeScale=1,i.alpha=1,i.interruptAlpha=1,i.mixTime=0,i.mixDuration=null==n?0:this.data.getMix(n.animation,e),i.mixBlend=uv.replace,i}disposeNext(t){let e=t.next;for(;null!=e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();for(let t=0,e=this.tracks.length;t<e;t++){let e=this.tracks[t];if(null!=e){for(;null!=e.mixingFrom;)e=e.mixingFrom;do{null!=e.mixingFrom&&e.mixBlend==uv.add||this.computeHold(e),e=e.mixingTo}while(null!=e)}}}computeHold(t){const e=t.mixingTo,s=t.animation.timelines,n=t.animation.timelines.length,i=Ov.setArraySize(t.timelineMode,n);t.timelineHoldMix.length=0;const r=Ov.setArraySize(t.timelineHoldMix,n),a=this.propertyIDs;if(null!=e&&e.holdPrevious)for(let o=0;o<n;o++)i[o]=a.add(s[o].getPropertyId())?Bx.HOLD_FIRST:Bx.HOLD_SUBSEQUENT;else t:for(let o=0;o<n;o++){const n=s[o],h=n.getPropertyId();if(a.add(h))if(null==e||n instanceof Ex||n instanceof Cx||n instanceof Ax||!e.animation.hasTimeline(h))i[o]=Bx.FIRST;else{for(let s=e.mixingTo;null!=s;s=s.mixingTo)if(!s.animation.hasTimeline(h)){if(t.mixDuration>0){i[o]=Bx.HOLD_MIX,r[o]=s;continue t}break}i[o]=Bx.HOLD_FIRST}else i[o]=Bx.SUBSEQUENT}}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){const e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}setAnimationByName(t,e,s){Bx.deprecatedWarning1||(Bx.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")),this.setAnimation(t,e,s)}addAnimationByName(t,e,s,n){Bx.deprecatedWarning2||(Bx.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")),this.addAnimation(t,e,s,n)}hasAnimation(t){return null!==this.data.skeletonData.findAnimation(t)}hasAnimationByName(t){return Bx.deprecatedWarning3||(Bx.deprecatedWarning3=!0,console.warn("Spine Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")),this.hasAnimation(t)}};let Lx=Bx;Lx.emptyAnimation=new lx("<empty>",[],0),Lx.SUBSEQUENT=0,Lx.FIRST=1,Lx.HOLD_SUBSEQUENT=2,Lx.HOLD_FIRST=3,Lx.HOLD_MIX=4,Lx.SETUP=1,Lx.CURRENT=2,Lx.deprecatedWarning1=!1,Lx.deprecatedWarning2=!1,Lx.deprecatedWarning3=!1;const Vx=class{constructor(){this.mixBlend=uv.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){const t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}get time(){return Vx.deprecatedWarning1||(Vx.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime}set time(t){Vx.deprecatedWarning1||(Vx.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime=t}get endTime(){return Vx.deprecatedWarning2||(Vx.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime}set endTime(t){Vx.deprecatedWarning2||(Vx.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime=t}loopsCount(){return Math.floor(this.trackTime/this.trackEnd)}};let $x=Vx;$x.deprecatedWarning1=!1,$x.deprecatedWarning2=!1;const Ux=class{constructor(t){this.objects=[],this.drainDisabled=!1,this.animState=t}start(t){this.objects.push(Yx.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(Yx.interrupt),this.objects.push(t)}end(t){this.objects.push(Yx.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(Yx.dispose),this.objects.push(t)}complete(t){this.objects.push(Yx.complete),this.objects.push(t)}event(t,e){this.objects.push(Yx.event),this.objects.push(t),this.objects.push(e)}deprecateStuff(){return Ux.deprecatedWarning1||(Ux.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: onComplete, onStart, onEnd, onEvent art deprecated, please use listeners from now on. 'state.addListener({ complete: function(track, event) { } })'")),!0}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;const t=this.objects,e=this.animState.listeners;for(let s=0;s<t.length;s+=2){const n=t[s],i=t[s+1];switch(n){case Yx.start:null!=i.listener&&i.listener.start&&i.listener.start(i);for(let t=0;t<e.length;t++)e[t].start&&e[t].start(i);i.onStart&&this.deprecateStuff()&&i.onStart(i.trackIndex),this.animState.onStart&&this.deprecateStuff()&&this.deprecateStuff&&this.animState.onStart(i.trackIndex);break;case Yx.interrupt:null!=i.listener&&i.listener.interrupt&&i.listener.interrupt(i);for(let t=0;t<e.length;t++)e[t].interrupt&&e[t].interrupt(i);break;case Yx.end:null!=i.listener&&i.listener.end&&i.listener.end(i);for(let t=0;t<e.length;t++)e[t].end&&e[t].end(i);i.onEnd&&this.deprecateStuff()&&i.onEnd(i.trackIndex),this.animState.onEnd&&this.deprecateStuff()&&this.animState.onEnd(i.trackIndex);case Yx.dispose:null!=i.listener&&i.listener.dispose&&i.listener.dispose(i);for(let t=0;t<e.length;t++)e[t].dispose&&e[t].dispose(i);this.animState.trackEntryPool.free(i);break;case Yx.complete:null!=i.listener&&i.listener.complete&&i.listener.complete(i);for(let t=0;t<e.length;t++)e[t].complete&&e[t].complete(i);const n=Pv.toInt(i.loopsCount());i.onComplete&&this.deprecateStuff()&&i.onComplete(i.trackIndex,n),this.animState.onComplete&&this.deprecateStuff()&&this.animState.onComplete(i.trackIndex,n);break;case Yx.event:const r=t[2+s++];null!=i.listener&&i.listener.event&&i.listener.event(i,r);for(let t=0;t<e.length;t++)e[t].event&&e[t].event(i,r);i.onEvent&&this.deprecateStuff()&&i.onEvent(i.trackIndex,r),this.animState.onEvent&&this.deprecateStuff()&&this.animState.onEvent(i.trackIndex,r)}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}};let Xx=Ux;Xx.deprecatedWarning1=!1;var Yx=(t=>(t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event",t))(Yx||{});const Wx=class{constructor(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,s){const n=this.skeletonData.findAnimation(t);if(null==n)throw new Error(`Animation not found: ${t}`);const i=this.skeletonData.findAnimation(e);if(null==i)throw new Error(`Animation not found: ${e}`);this.setMixWith(n,i,s)}setMixByName(t,e,s){Wx.deprecatedWarning1||(Wx.deprecatedWarning1=!0,console.warn("Deprecation Warning: AnimationStateData.setMixByName is deprecated, please use setMix from now on.")),this.setMix(t,e,s)}setMixWith(t,e,s){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");const n=`${t.name}.${e.name}`;this.animationToMixTime[n]=s}getMix(t,e){const s=`${t.name}.${e.name}`,n=this.animationToMixTime[s];return void 0===n?this.defaultMix:n}};let jx=Wx;jx.deprecatedWarning1=!1;let zx=class{constructor(t){this.atlas=t}newRegionAttachment(t,e,s){const n=this.atlas.findRegion(s);if(null==n)throw new Error(`Region not found in atlas: ${s} (region attachment: ${e})`);const i=new ax(e);return i.region=n,i}newMeshAttachment(t,e,s){const n=this.atlas.findRegion(s);if(null==n)throw new Error(`Region not found in atlas: ${s} (mesh attachment: ${e})`);const i=new ex(e);return i.region=n,i}newBoundingBoxAttachment(t,e){return new Jv(e)}newPathAttachment(t,e){return new sx(e)}newPointAttachment(t,e){return new nx(e)}newClippingAttachment(t,e){return new tx(e)}},Gx=class{constructor(t,e,s){if(this.matrix=new Ch,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.sorted=!1,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=s,this.setToSetupPose()}get worldX(){return this.matrix.tx}get worldY(){return this.matrix.ty}isActive(){return this.active}update(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,s,n,i,r,a){this.ax=t,this.ay=e,this.arotation=s,this.ascaleX=n,this.ascaleY=i,this.ashearX=r,this.ashearY=a,this.appliedValid=!0;const o=this.parent,h=this.matrix,l=this.skeleton.scaleX,c=-this.skeleton.scaleY;if(null==o){const o=this.skeleton,u=s+90+a;return h.a=Pv.cosDeg(s+r)*n*l,h.c=Pv.cosDeg(u)*i*l,h.b=Pv.sinDeg(s+r)*n*c,h.d=Pv.sinDeg(u)*i*c,h.tx=t*l+o.x,void(h.ty=e*c+o.y)}let u=o.matrix.a,d=o.matrix.c,f=o.matrix.b,p=o.matrix.d;switch(h.tx=u*t+d*e+o.matrix.tx,h.ty=f*t+p*e+o.matrix.ty,this.data.transformMode){case mv.Normal:{const t=s+90+a,e=Pv.cosDeg(s+r)*n,o=Pv.cosDeg(t)*i,l=Pv.sinDeg(s+r)*n,c=Pv.sinDeg(t)*i;return h.a=u*e+d*l,h.c=u*o+d*c,h.b=f*e+p*l,void(h.d=f*o+p*c)}case mv.OnlyTranslation:{const t=s+90+a;h.a=Pv.cosDeg(s+r)*n,h.c=Pv.cosDeg(t)*i,h.b=Pv.sinDeg(s+r)*n,h.d=Pv.sinDeg(t)*i;break}case mv.NoRotationOrReflection:{let t=u*u+f*f,e=0;t>1e-4?(t=Math.abs(u*p-d*f)/t,u/=this.skeleton.scaleX,f/=this.skeleton.scaleY,d=f*t,p=u*t,e=Math.atan2(f,u)*Pv.radDeg):(u=0,f=0,e=90-Math.atan2(p,d)*Pv.radDeg);const o=s+r-e,l=s+a-e+90,c=Pv.cosDeg(o)*n,m=Pv.cosDeg(l)*i,g=Pv.sinDeg(o)*n,y=Pv.sinDeg(l)*i;h.a=u*c-d*g,h.c=u*m-d*y,h.b=f*c+p*g,h.d=f*m+p*y;break}case mv.NoScale:case mv.NoScaleOrReflection:{const t=Pv.cosDeg(s),e=Pv.sinDeg(s);let o=(u*t+d*e)/l,m=(f*t+p*e)/c,g=Math.sqrt(o*o+m*m);g>1e-5&&(g=1/g),o*=g,m*=g,g=Math.sqrt(o*o+m*m),this.data.transformMode==mv.NoScale&&u*p-d*f<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY>0)&&(g=-g);const y=Math.PI/2+Math.atan2(m,o),v=Math.cos(y)*g,x=Math.sin(y)*g,_=Pv.cosDeg(r)*n,b=Pv.cosDeg(90+a)*i,w=Pv.sinDeg(r)*n,E=Pv.sinDeg(90+a)*i;h.a=o*_+v*w,h.c=o*b+v*E,h.b=m*_+x*w,h.d=m*b+x*E;break}}h.a*=l,h.c*=l,h.b*=c,h.d*=c}setToSetupPose(){const t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.matrix.b,this.matrix.a)*Pv.radDeg}getWorldRotationY(){return Math.atan2(this.matrix.d,this.matrix.c)*Pv.radDeg}getWorldScaleX(){const t=this.matrix;return Math.sqrt(t.a*t.a+t.c*t.c)}getWorldScaleY(){const t=this.matrix;return Math.sqrt(t.b*t.b+t.d*t.d)}updateAppliedTransform(){this.appliedValid=!0;const t=this.parent,e=this.matrix;if(null==t)return this.ax=e.tx,this.ay=e.ty,this.arotation=Math.atan2(e.b,e.a)*Pv.radDeg,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*Pv.radDeg);const s=t.matrix,n=1/(s.a*s.d-s.b*s.c),i=e.tx-s.tx,r=e.ty-s.ty;this.ax=i*s.d*n-r*s.c*n,this.ay=r*s.a*n-i*s.b*n;const a=n*s.d,o=n*s.a,h=n*s.c,l=n*s.b,c=a*e.a-h*e.b,u=a*e.c-h*e.d,d=o*e.b-l*e.a,f=o*e.d-l*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(c*c+d*d),this.ascaleX>1e-4){const t=c*f-u*d;this.ascaleY=t/this.ascaleX,this.ashearY=Math.atan2(c*u+d*f,t)*Pv.radDeg,this.arotation=Math.atan2(d,c)*Pv.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(u*u+f*f),this.ashearY=0,this.arotation=90-Math.atan2(f,u)*Pv.radDeg}worldToLocal(t){const e=this.matrix,s=e.a,n=e.c,i=e.b,r=e.d,a=1/(s*r-n*i),o=t.x-e.tx,h=t.y-e.ty;return t.x=o*r*a-h*n*a,t.y=h*s*a-o*i*a,t}localToWorld(t){const e=this.matrix,s=t.x,n=t.y;return t.x=s*e.a+n*e.c+e.tx,t.y=s*e.b+n*e.d+e.ty,t}worldToLocalRotation(t){const e=Pv.sinDeg(t),s=Pv.cosDeg(t),n=this.matrix;return Math.atan2(n.a*e-n.b*s,n.d*s-n.c*e)*Pv.radDeg}localToWorldRotation(t){const e=Pv.sinDeg(t),s=Pv.cosDeg(t),n=this.matrix;return Math.atan2(s*n.b+e*n.d,s*n.a+e*n.c)*Pv.radDeg}rotateWorld(t){const e=this.matrix,s=e.a,n=e.c,i=e.b,r=e.d,a=Pv.cosDeg(t),o=Pv.sinDeg(t);e.a=a*s-o*i,e.c=a*n-o*r,e.b=o*s+a*i,e.d=o*n+a*r,this.appliedValid=!1}},Hx=class{constructor(t,e,s){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=mv.Normal,this.skinRequired=!1,this.color=new Mv,t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=s}},qx=class{constructor(t,e,s){this.name=t,this.order=e,this.skinRequired=s}},Kx=class{constructor(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e}},Zx=class{constructor(t){this.name=t}},Qx=class{constructor(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let s=0;s<t.bones.length;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findBone(t.target.name)}isActive(){return this.active}apply(){this.update()}update(){const t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}}apply1(t,e,s,n,i,r,a){t.appliedValid||t.updateAppliedTransform();const o=t.parent.matrix,h=o.a;let l=o.c;const c=o.b;let u=o.d,d=-t.ashearX-t.arotation,f=0,p=0;switch(t.data.transformMode){case mv.OnlyTranslation:f=e-t.worldX,p=s-t.worldY;break;case mv.NoRotationOrReflection:const n=Math.abs(h*u-l*c)/(h*h+c*c),i=h/t.skeleton.scaleX,r=c/t.skeleton.scaleY;l=-r*n*t.skeleton.scaleX,u=i*n*t.skeleton.scaleY,d+=Math.atan2(r,i)*Pv.radDeg;default:const a=e-o.tx,m=s-o.ty,g=h*u-l*c;f=(a*u-m*l)/g-t.ax,p=(m*h-a*c)/g-t.ay}d+=Math.atan2(p,f)*Pv.radDeg,t.ascaleX<0&&(d+=180),d>180?d-=360:d<-180&&(d+=360);let m=t.ascaleX,g=t.ascaleY;if(n||i){switch(t.data.transformMode){case mv.NoScale:case mv.NoScaleOrReflection:f=e-t.worldX,p=s-t.worldY}const o=t.data.length*m,h=Math.sqrt(f*f+p*p);if(n&&h<o||i&&h>o&&o>1e-4){const t=(h/o-1)*a+1;m*=t,r&&(g*=t)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+d*a,m,g,t.ashearX,t.ashearY)}apply2(t,e,s,n,i,r,a,o){if(0==o)return void e.updateWorldTransform();t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();const h=t.ax,l=t.ay;let c=t.ascaleX,u=c,d=t.ascaleY,f=e.ascaleX;const p=t.matrix;let m=0,g=0,y=0;c<0?(c=-c,m=180,y=-1):(m=0,y=1),d<0&&(d=-d,y=-y),f<0?(f=-f,g=180):g=0;const v=e.ax;let x=0,_=0,b=0,w=p.a,E=p.c,S=p.b,T=p.d;const A=Math.abs(c-d)<=1e-4;A?(x=e.ay,_=w*v+E*x+p.tx,b=S*v+T*x+p.ty):(x=0,_=w*v+p.tx,b=S*v+p.ty);const C=t.parent.matrix;w=C.a,E=C.c,S=C.b,T=C.d;const M=1/(w*T-E*S);let I=_-C.tx,P=b-C.ty;const R=(I*T-P*E)*M-h,k=(P*w-I*S)*M-l,D=Math.sqrt(R*R+k*k);let F,O,N=e.data.length*f;if(D<1e-4)return this.apply1(t,s,n,!1,r,!1,o),void e.updateWorldTransformWith(v,x,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);I=s-C.tx,P=n-C.ty;let B=(I*T-P*E)*M-h,L=(P*w-I*S)*M-l,V=B*B+L*L;if(0!=a){a*=c*(f+1)/2;const t=Math.sqrt(V),e=t-D-N*c+a;if(e>0){let s=Math.min(1,e/(2*a))-1;s=(e-a*(1-s*s))/t,B-=s*B,L-=s*L,V=B*B+L*L}}t:if(A){N*=c;let t=(V-D*D-N*N)/(2*D*N);t<-1?t=-1:t>1&&(t=1,r&&(u*=(Math.sqrt(V)/(D+N)-1)*o+1)),O=Math.acos(t)*i,w=D+N*t,E=N*Math.sin(O),F=Math.atan2(L*w-B*E,B*w+L*E)}else{w=c*N,E=d*N;const t=w*w,e=E*E,s=Math.atan2(L,B);S=e*D*D+t*V-t*e;const n=-2*e*D,r=e-t;if(T=n*n-4*r*S,T>=0){let t=Math.sqrt(T);n<0&&(t=-t),t=-(n+t)/2;const e=t/r,a=S/t,o=Math.abs(e)<Math.abs(a)?e:a;if(o*o<=V){P=Math.sqrt(V-o*o)*i,F=s-Math.atan2(P,o),O=Math.atan2(P/d,(o-D)/c);break t}}let a=Pv.PI,o=D-w,h=o*o,l=0,u=0,f=D+w,p=f*f,m=0;S=-w*D/(t-e),S>=-1&&S<=1&&(S=Math.acos(S),I=w*Math.cos(S)+D,P=E*Math.sin(S),T=I*I+P*P,T<h&&(a=S,h=T,o=I,l=P),T>p&&(u=S,p=T,f=I,m=P)),V<=(h+p)/2?(F=s-Math.atan2(l*i,o),O=a*i):(F=s-Math.atan2(m*i,f),O=u*i)}const $=Math.atan2(x,v)*y;let U=t.arotation;F=(F-$)*Pv.radDeg+m-U,F>180?F-=360:F<-180&&(F+=360),t.updateWorldTransformWith(h,l,U+F*o,u,t.ascaleY,0,0),U=e.arotation,O=((O+$)*Pv.radDeg-e.ashearX)*y+g-U,O>180?O-=360:O<-180&&(O+=360),e.updateWorldTransformWith(v,x,U+O*o,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}},Jx=class extends qx{constructor(t){super(t,0,!1),this.bones=new Array,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.softness=0}},t_=class extends qx{constructor(t){super(t,0,!1),this.bones=new Array}};var e_=(t=>(t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent",t))(e_||{});const s_=class{constructor(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let s=0,n=t.bones.length;s<n;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}isActive(){return this.active}apply(){this.update()}update(){const t=this.target.getAttachment();if(!(t instanceof sx))return;const e=this.rotateMix,s=this.translateMix,n=e>0;if(!(s>0)&&!n)return;const i=this.data,r=i.spacingMode,a=r==e_.Length,o=i.rotateMode,h=o==pv.Tangent,l=o==pv.ChainScale,c=this.bones.length,u=h?c:c+1,d=this.bones,f=Ov.setArraySize(this.spaces,u);let p=null;const m=this.spacing;if(l||a){l&&(p=Ov.setArraySize(this.lengths,c));for(let t=0,e=u-1;t<e;){const e=d[t],s=e.data.length;if(s<s_.epsilon)l&&(p[t]=0),f[++t]=0;else{const n=s*e.matrix.a,i=s*e.matrix.b,r=Math.sqrt(n*n+i*i);l&&(p[t]=r),f[++t]=(a?s+m:m)*r/s}}}else for(let b=1;b<u;b++)f[b]=m;const g=this.computeWorldPositions(t,u,h,i.positionMode==fv.Percent,r==e_.Percent);let y=g[0],v=g[1],x=i.offsetRotation,_=!1;if(0==x)_=o==pv.Chain;else{_=!1;const t=this.target.bone.matrix;x*=t.a*t.d-t.b*t.c>0?Pv.degRad:-Pv.degRad}for(let b=0,w=3;b<c;b++,w+=3){const t=d[b],i=t.matrix;i.tx+=(y-i.tx)*s,i.ty+=(v-i.ty)*s;const r=g[w],a=g[w+1],o=r-y,c=a-v;if(l){const t=p[b];if(0!=t){const s=(Math.sqrt(o*o+c*c)/t-1)*e+1;i.a*=s,i.b*=s}}if(y=r,v=a,n){const s=i.a,n=i.c,r=i.b,a=i.d;let l=0,u=0,d=0;if(h&&(l=h?g[w-1]:0==f[b+1]?g[w+2]:Math.atan2(c,o)),l-=Math.atan2(r,s),_){u=Math.cos(l),d=Math.sin(l);const n=t.data.length;y+=(n*(u*s-d*r)-o)*e,v+=(n*(d*s+u*r)-c)*e}else l+=x;l>Pv.PI?l-=Pv.PI2:l<-Pv.PI&&(l+=Pv.PI2),l*=e,u=Math.cos(l),d=Math.sin(l),i.a=u*s-d*r,i.c=u*n-d*a,i.b=d*s+u*r,i.d=d*n+u*a}t.appliedValid=!1}}computeWorldPositions(t,e,s,n,i){const r=this.target;let a=this.position;const o=this.spaces,h=Ov.setArraySize(this.positions,3*e+2);let l=null;const c=t.closed;let u=t.worldVerticesLength,d=u/6,f=s_.NONE;if(!t.constantSpeed){const p=t.lengths;d-=c?1:2;const m=p[d];if(n&&(a*=m),i)for(let t=0;t<e;t++)o[t]*=m;l=Ov.setArraySize(this.world,8);for(let n=0,i=0,g=0;n<e;n++,i+=3){const e=o[n];a+=e;let y=a;if(c)y%=m,y<0&&(y+=m),g=0;else{if(y<0){f!=s_.BEFORE&&(f=s_.BEFORE,t.computeWorldVertices(r,2,4,l,0,2)),this.addBeforePosition(y,l,0,h,i);continue}if(y>m){f!=s_.AFTER&&(f=s_.AFTER,t.computeWorldVertices(r,u-6,4,l,0,2)),this.addAfterPosition(y-m,l,0,h,i);continue}}for(;;g++){const t=p[g];if(!(y>t)){if(0==g)y/=t;else{const e=p[g-1];y=(y-e)/(t-e)}break}}g!=f&&(f=g,c&&g==d?(t.computeWorldVertices(r,u-4,4,l,0,2),t.computeWorldVertices(r,0,4,l,4,2)):t.computeWorldVertices(r,6*g+2,8,l,0,2)),this.addCurvePosition(y,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],h,i,s||n>0&&0==e)}return h}c?(u+=2,l=Ov.setArraySize(this.world,u),t.computeWorldVertices(r,2,u-4,l,0,2),t.computeWorldVertices(r,0,2,l,u-4,2),l[u-2]=l[0],l[u-1]=l[1]):(d--,u-=4,l=Ov.setArraySize(this.world,u),t.computeWorldVertices(r,2,u,l,0,2));const p=Ov.setArraySize(this.curves,d);let m=0,g=l[0],y=l[1],v=0,x=0,_=0,b=0,w=0,E=0,S=0,T=0,A=0,C=0,M=0,I=0,P=0,R=0;for(let F=0,O=2;F<d;F++,O+=6)v=l[O],x=l[O+1],_=l[O+2],b=l[O+3],w=l[O+4],E=l[O+5],S=.1875*(g-2*v+_),T=.1875*(y-2*x+b),A=.09375*(3*(v-_)-g+w),C=.09375*(3*(x-b)-y+E),M=2*S+A,I=2*T+C,P=.75*(v-g)+S+.16666667*A,R=.75*(x-y)+T+.16666667*C,m+=Math.sqrt(P*P+R*R),P+=M,R+=I,M+=A,I+=C,m+=Math.sqrt(P*P+R*R),P+=M,R+=I,m+=Math.sqrt(P*P+R*R),P+=M+A,R+=I+C,m+=Math.sqrt(P*P+R*R),p[F]=m,g=w,y=E;if(n&&(a*=m),i)for(let F=0;F<e;F++)o[F]*=m;const k=this.segments;let D=0;for(let F=0,O=0,N=0,B=0;F<e;F++,O+=3){const t=o[F];a+=t;let e=a;if(c)e%=m,e<0&&(e+=m),N=0;else{if(e<0){this.addBeforePosition(e,l,0,h,O);continue}if(e>m){this.addAfterPosition(e-m,l,u-4,h,O);continue}}for(;;N++){const t=p[N];if(!(e>t)){if(0==N)e/=t;else{const s=p[N-1];e=(e-s)/(t-s)}break}}if(N!=f){f=N;let t=6*N;for(g=l[t],y=l[t+1],v=l[t+2],x=l[t+3],_=l[t+4],b=l[t+5],w=l[t+6],E=l[t+7],S=.03*(g-2*v+_),T=.03*(y-2*x+b),A=.006*(3*(v-_)-g+w),C=.006*(3*(x-b)-y+E),M=2*S+A,I=2*T+C,P=.3*(v-g)+S+.16666667*A,R=.3*(x-y)+T+.16666667*C,D=Math.sqrt(P*P+R*R),k[0]=D,t=1;t<8;t++)P+=M,R+=I,M+=A,I+=C,D+=Math.sqrt(P*P+R*R),k[t]=D;P+=M,R+=I,D+=Math.sqrt(P*P+R*R),k[8]=D,P+=M+A,R+=I+C,D+=Math.sqrt(P*P+R*R),k[9]=D,B=0}for(e*=D;;B++){const t=k[B];if(!(e>t)){if(0==B)e/=t;else{const s=k[B-1];e=B+(e-s)/(t-s)}break}}this.addCurvePosition(.1*e,g,y,v,x,_,b,w,E,h,O,s||F>0&&0==t)}return h}addBeforePosition(t,e,s,n,i){const r=e[s],a=e[s+1],o=e[s+2]-r,h=e[s+3]-a,l=Math.atan2(h,o);n[i]=r+t*Math.cos(l),n[i+1]=a+t*Math.sin(l),n[i+2]=l}addAfterPosition(t,e,s,n,i){const r=e[s+2],a=e[s+3],o=r-e[s],h=a-e[s+1],l=Math.atan2(h,o);n[i]=r+t*Math.cos(l),n[i+1]=a+t*Math.sin(l),n[i+2]=l}addCurvePosition(t,e,s,n,i,r,a,o,h,l,c,u){(0==t||isNaN(t))&&(t=1e-4);const d=t*t,f=d*t,p=1-t,m=p*p,g=m*p,y=p*t,v=3*y,x=p*v,_=v*t,b=e*g+n*x+r*_+o*f,w=s*g+i*x+a*_+h*f;l[c]=b,l[c+1]=w,u&&(l[c+2]=Math.atan2(w-(s*m+i*y*2+a*d),b-(e*m+n*y*2+r*d)))}};let n_=s_;n_.NONE=-1,n_.BEFORE=-2,n_.AFTER=-3,n_.epsilon=1e-5;let i_=class{constructor(t,e){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new Bv,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array;for(let s=0;s<t.bones.length;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findBone(t.target.name)}isActive(){return this.active}apply(){this.update()}update(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()}applyAbsoluteWorld(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,n=this.shearMix,i=this.target,r=i.matrix,a=r.a,o=r.c,h=r.b,l=r.d,c=a*l-o*h>0?Pv.degRad:-Pv.degRad,u=this.data.offsetRotation*c,d=this.data.offsetShearY*c,f=this.bones;for(let p=0,m=f.length;p<m;p++){const r=f[p];let c=!1;const m=r.matrix;if(0!=t){const e=m.a,s=m.c,n=m.b,i=m.d;let r=Math.atan2(h,a)-Math.atan2(n,e)+u;r>Pv.PI?r-=Pv.PI2:r<-Pv.PI&&(r+=Pv.PI2),r*=t;const o=Math.cos(r),l=Math.sin(r);m.a=o*e-l*n,m.c=o*s-l*i,m.b=l*e+o*n,m.d=l*s+o*i,c=!0}if(0!=e){const t=this.temp;i.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=(t.x-m.tx)*e,m.ty+=(t.y-m.ty)*e,c=!0}if(s>0){let t=Math.sqrt(m.a*m.a+m.b*m.b),e=Math.sqrt(a*a+h*h);t>1e-5&&(t=(t+(e-t+this.data.offsetScaleX)*s)/t),m.a*=t,m.b*=t,t=Math.sqrt(m.c*m.c+m.d*m.d),e=Math.sqrt(o*o+l*l),t>1e-5&&(t=(t+(e-t+this.data.offsetScaleY)*s)/t),m.c*=t,m.d*=t,c=!0}if(n>0){const t=m.c,e=m.d,s=Math.atan2(e,t);let i=Math.atan2(l,o)-Math.atan2(h,a)-(s-Math.atan2(m.b,m.a));i>Pv.PI?i-=Pv.PI2:i<-Pv.PI&&(i+=Pv.PI2),i=s+(i+d)*n;const r=Math.sqrt(t*t+e*e);m.c=Math.cos(i)*r,m.d=Math.sin(i)*r,c=!0}c&&(r.appliedValid=!1)}}applyRelativeWorld(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,n=this.shearMix,i=this.target,r=i.matrix,a=r.a,o=r.c,h=r.b,l=r.d,c=a*l-o*h>0?Pv.degRad:-Pv.degRad,u=this.data.offsetRotation*c,d=this.data.offsetShearY*c,f=this.bones;for(let p=0,m=f.length;p<m;p++){const r=f[p];let c=!1;const m=r.matrix;if(0!=t){const e=m.a,s=m.c,n=m.b,i=m.d;let r=Math.atan2(h,a)+u;r>Pv.PI?r-=Pv.PI2:r<-Pv.PI&&(r+=Pv.PI2),r*=t;const o=Math.cos(r),l=Math.sin(r);m.a=o*e-l*n,m.c=o*s-l*i,m.b=l*e+o*n,m.d=l*s+o*i,c=!0}if(0!=e){const t=this.temp;i.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=t.x*e,m.ty+=t.y*e,c=!0}if(s>0){let t=(Math.sqrt(a*a+h*h)-1+this.data.offsetScaleX)*s+1;m.a*=t,m.b*=t,t=(Math.sqrt(o*o+l*l)-1+this.data.offsetScaleY)*s+1,m.c*=t,m.d*=t,c=!0}if(n>0){let t=Math.atan2(l,o)-Math.atan2(h,a);t>Pv.PI?t-=Pv.PI2:t<-Pv.PI&&(t+=Pv.PI2);const e=m.c,s=m.d;t=Math.atan2(s,e)+(t-Pv.PI/2+d)*n;const i=Math.sqrt(e*e+s*s);m.c=Math.cos(t)*i,m.d=Math.sin(t)*i,c=!0}c&&(r.appliedValid=!1)}}applyAbsoluteLocal(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,n=this.shearMix,i=this.target;i.appliedValid||i.updateAppliedTransform();const r=this.bones;for(let a=0,o=r.length;a<o;a++){const o=r[a];o.appliedValid||o.updateAppliedTransform();let h=o.arotation;if(0!=t){let e=i.arotation-h+this.data.offsetRotation;e-=360*(16384-(16384.499999999996-e/360|0)),h+=e*t}let l=o.ax,c=o.ay;0!=e&&(l+=(i.ax-l+this.data.offsetX)*e,c+=(i.ay-c+this.data.offsetY)*e);let u=o.ascaleX,d=o.ascaleY;s>0&&(u>1e-5&&(u=(u+(i.ascaleX-u+this.data.offsetScaleX)*s)/u),d>1e-5&&(d=(d+(i.ascaleY-d+this.data.offsetScaleY)*s)/d));const f=o.ashearY;if(n>0){let t=i.ashearY-f+this.data.offsetShearY;t-=360*(16384-(16384.499999999996-t/360|0)),o.shearY+=t*n}o.updateWorldTransformWith(l,c,h,u,d,o.ashearX,f)}}applyRelativeLocal(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,n=this.shearMix,i=this.target;i.appliedValid||i.updateAppliedTransform();const r=this.bones;for(let a=0,o=r.length;a<o;a++){const o=r[a];o.appliedValid||o.updateAppliedTransform();let h=o.arotation;0!=t&&(h+=(i.arotation+this.data.offsetRotation)*t);let l=o.ax,c=o.ay;0!=e&&(l+=(i.ax+this.data.offsetX)*e,c+=(i.ay+this.data.offsetY)*e);let u=o.ascaleX,d=o.ascaleY;s>0&&(u>1e-5&&(u*=(i.ascaleX-1+this.data.offsetScaleX)*s+1),d>1e-5&&(d*=(i.ascaleY-1+this.data.offsetScaleY)*s+1));let f=o.ashearY;n>0&&(f+=(i.ashearY+this.data.offsetShearY)*n),o.updateWorldTransformWith(l,c,h,u,d,o.ashearX,f)}}};const r_=class{constructor(t){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){const s=t.bones[e];let n;if(null==s.parent)n=new Gx(s,this,null);else{const t=this.bones[s.parent.index];n=new Gx(s,this,t),t.children.push(n)}this.bones.push(n)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){const s=t.slots[e],n=this.bones[s.boneData.index],i=new ix(s,n);this.slots.push(i),this.drawOrder.push(i)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){const s=t.ikConstraints[e];this.ikConstraints.push(new Qx(s,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){const s=t.transformConstraints[e];this.transformConstraints.push(new i_(s,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){const s=t.pathConstraints[e];this.pathConstraints.push(new n_(s,this))}this.color=new Mv(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0,this.updateCacheReset.length=0;const t=this.bones;for(let h=0,l=t.length;h<l;h++){const e=t[h];e.sorted=e.data.skinRequired,e.active=!e.sorted}if(null!=this.skin){const t=this.skin.bones;for(let e=0,s=this.skin.bones.length;e<s;e++){let s=this.bones[t[e].index];do{s.sorted=!1,s.active=!0,s=s.parent}while(null!=s)}}const e=this.ikConstraints,s=this.transformConstraints,n=this.pathConstraints,i=e.length,r=s.length,a=n.length,o=i+r+a;t:for(let h=0;h<o;h++){for(let t=0;t<i;t++){const s=e[t];if(s.data.order==h){this.sortIkConstraint(s);continue t}}for(let t=0;t<r;t++){const e=s[t];if(e.data.order==h){this.sortTransformConstraint(e);continue t}}for(let t=0;t<a;t++){const e=n[t];if(e.data.order==h){this.sortPathConstraint(e);continue t}}}for(let h=0,l=t.length;h<l;h++)this.sortBone(t[h])}sortIkConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&Ov.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target;this.sortBone(e);const s=t.bones,n=s[0];if(this.sortBone(n),s.length>1){const t=s[s.length-1];this._updateCache.indexOf(t)>-1||this.updateCacheReset.push(t)}this._updateCache.push(t),this.sortReset(n.children),s[s.length-1].sorted=!0}sortPathConstraint(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||null!=this.skin&&Ov.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target,s=e.data.index,n=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,s,n),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,s,n);for(let o=0,h=this.data.skins.length;o<h;o++)this.sortPathConstraintAttachment(this.data.skins[o],s,n);const i=e.getAttachment();i instanceof sx&&this.sortPathConstraintAttachmentWith(i,n);const r=t.bones,a=r.length;for(let o=0;o<a;o++)this.sortBone(r[o]);this._updateCache.push(t);for(let o=0;o<a;o++)this.sortReset(r[o].children);for(let o=0;o<a;o++)r[o].sorted=!0}sortTransformConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&Ov.contains(this.skin.constraints,t.data,!0)),!t.active)return;this.sortBone(t.target);const e=t.bones,s=e.length;if(t.data.local)for(let n=0;n<s;n++){const t=e[n];this.sortBone(t.parent),this._updateCache.indexOf(t)>-1||this.updateCacheReset.push(t)}else for(let n=0;n<s;n++)this.sortBone(e[n]);this._updateCache.push(t);for(let n=0;n<s;n++)this.sortReset(e[n].children);for(let n=0;n<s;n++)e[n].sorted=!0}sortPathConstraintAttachment(t,e,s){const n=t.attachments[e];if(n)for(const i in n)this.sortPathConstraintAttachmentWith(n[i],s)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof sx))return;const s=t.bones;if(null==s)this.sortBone(e);else{const t=this.bones;let e=0;for(;e<s.length;){const n=s[e++];for(let i=e+n;e<i;e++){const n=s[e];this.sortBone(t[n])}}}}sortBone(t){if(t.sorted)return;const e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,s=t.length;e<s;e++){const s=t[e];s.active&&(s.sorted&&this.sortReset(s.children),s.sorted=!1)}}updateWorldTransform(){const t=this.updateCacheReset;for(let s=0,n=t.length;s<n;s++){const e=t[s];e.ax=e.x,e.ay=e.y,e.arotation=e.rotation,e.ascaleX=e.scaleX,e.ascaleY=e.scaleY,e.ashearX=e.shearX,e.ashearY=e.shearY,e.appliedValid=!0}const e=this._updateCache;for(let s=0,n=e.length;s<n;s++)e[s].update()}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){const t=this.bones;for(let i=0,r=t.length;i<r;i++)t[i].setToSetupPose();const e=this.ikConstraints;for(let i=0,r=e.length;i<r;i++){const t=e[i];t.mix=t.data.mix,t.softness=t.data.softness,t.bendDirection=t.data.bendDirection,t.compress=t.data.compress,t.stretch=t.data.stretch}const s=this.transformConstraints;for(let i=0,r=s.length;i<r;i++){const t=s[i],e=t.data;t.rotateMix=e.rotateMix,t.translateMix=e.translateMix,t.scaleMix=e.scaleMix,t.shearMix=e.shearMix}const n=this.pathConstraints;for(let i=0,r=n.length;i<r;i++){const t=n[i],e=t.data;t.position=e.position,t.spacing=e.spacing,t.rotateMix=e.rotateMix,t.translateMix=e.translateMix}}setSlotsToSetupPose(){const t=this.slots;Ov.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,s=t.length;e<s;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.data.name==t)return n}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,n=e.length;s<n;s++)if(e[s].data.name==t)return s;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.data.name==t)return n}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,n=e.length;s<n;s++)if(e[s].data.name==t)return s;return-1}setSkinByName(t){const e=this.data.findSkin(t);if(null==e)throw new Error(`Skin not found: ${t}`);this.setSkin(e)}setSkin(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else{const e=this.slots;for(let s=0,n=e.length;s<n;s++){const n=e[s],i=n.data.attachmentName;if(null!=i){const e=t.getAttachment(s,i);null!=e&&n.setAttachment(e)}}}this.skin=t,this.updateCache()}}getAttachmentByName(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)}getAttachment(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){const s=this.skin.getAttachment(t,e);if(null!=s)return s}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(null==t)throw new Error("slotName cannot be null.");const s=this.slots;for(let n=0,i=s.length;n<i;n++){const i=s[n];if(i.data.name==t){let s=null;if(null!=e&&(s=this.getAttachment(n,e),null==s))throw new Error(`Attachment not found: ${e}, for slot: ${t}`);return void i.setAttachment(s)}}throw new Error(`Slot not found: ${t}`)}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.data.name==t)return n}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.data.name==t)return n}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.data.name==t)return n}return null}getBounds(t,e,s=new Array(2)){if(null==t)throw new Error("offset cannot be null.");if(null==e)throw new Error("size cannot be null.");const n=this.drawOrder;let i=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let h=0,l=n.length;h<l;h++){const t=n[h];if(!t.bone.active)continue;let e=0,l=null;const c=t.getAttachment();if(c instanceof ax)e=8,l=Ov.setArraySize(s,e,0),c.computeWorldVertices(t.bone,l,0,2);else if(c instanceof ex){const n=c;e=n.worldVerticesLength,l=Ov.setArraySize(s,e,0),n.computeWorldVertices(t,0,e,l,0,2)}if(null!=l)for(let s=0,n=l.length;s<n;s+=2){const t=l[s],e=l[s+1];i=Math.min(i,t),r=Math.min(r,e),a=Math.max(a,t),o=Math.max(o,e)}}t.set(i,r),e.set(a-i,o-r)}update(t){this.time+=t}get flipX(){return-1==this.scaleX}set flipX(t){r_.deprecatedWarning1||(r_.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleX=t?1:-1}get flipY(){return-1==this.scaleY}set flipY(t){r_.deprecatedWarning1||(r_.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleY=t?1:-1}};let a_=r_;a_.deprecatedWarning1=!1;let o_=class{constructor(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,n=e.length;s<n;s++)if(e[s].name==t)return s;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,n=e.length;s<n;s++)if(e[s].name==t)return s;return-1}findSkin(t){if(null==t)throw new Error("skinName cannot be null.");const e=this.skins;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findEvent(t){if(null==t)throw new Error("eventDataName cannot be null.");const e=this.events;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findAnimation(t){if(null==t)throw new Error("animationName cannot be null.");const e=this.animations;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findPathConstraintIndex(t){if(null==t)throw new Error("pathConstraintName cannot be null.");const e=this.pathConstraints;for(let s=0,n=e.length;s<n;s++)if(e[s].name==t)return s;return-1}},h_=class{constructor(t,e,s){if(this.color=new Mv(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");if(null==s)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=s}},l_=class extends qx{constructor(t){super(t,0,!1),this.bones=new Array,this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1}},c_=class{constructor(t,e,s){this.slotIndex=t,this.name=e,this.attachment=s}},u_=class{constructor(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==t)throw new Error("name cannot be null.");this.name=t}setAttachment(t,e,s){if(null==s)throw new Error("attachment cannot be null.");const n=this.attachments;t>=n.length&&(n.length=t+1),n[t]||(n[t]={}),n[t][e]=s}addSkin(t){for(let s=0;s<t.bones.length;s++){const e=t.bones[s];let n=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==e){n=!0;break}n||this.bones.push(e)}for(let s=0;s<t.constraints.length;s++){const e=t.constraints[s];let n=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==e){n=!0;break}n||this.constraints.push(e)}const e=t.getAttachments();for(let s=0;s<e.length;s++){const t=e[s];this.setAttachment(t.slotIndex,t.name,t.attachment)}}copySkin(t){for(let s=0;s<t.bones.length;s++){const e=t.bones[s];let n=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==e){n=!0;break}n||this.bones.push(e)}for(let s=0;s<t.constraints.length;s++){const e=t.constraints[s];let n=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==e){n=!0;break}n||this.constraints.push(e)}const e=t.getAttachments();for(let s=0;s<e.length;s++){const t=e[s];null!=t.attachment&&(t.attachment instanceof ex?(t.attachment=t.attachment.newLinkedMesh(),this.setAttachment(t.slotIndex,t.name,t.attachment)):(t.attachment=t.attachment.copy(),this.setAttachment(t.slotIndex,t.name,t.attachment)))}}getAttachment(t,e){const s=this.attachments[t];return s?s[e]:null}removeAttachment(t,e){const s=this.attachments[t];s&&(s[e]=null)}getAttachments(){const t=new Array;for(let e=0;e<this.attachments.length;e++){const s=this.attachments[e];if(s)for(const n in s){const i=s[n];i&&t.push(new c_(e,n,i))}}return t}getAttachmentsForSlot(t,e){const s=this.attachments[t];if(s)for(const n in s){const i=s[n];i&&e.push(new c_(t,n,i))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(t,e){let s=0;for(let n=0;n<t.slots.length;n++){const i=t.slots[n],r=i.getAttachment();if(r&&s<e.attachments.length){const t=e.attachments[s];for(const e in t){if(r==t[e]){const t=this.getAttachment(s,e);null!=t&&i.setAttachment(t);break}}}s++}}};const d_=class{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const e=this.scale,s=new o_;s.name="";const n=new cv(t);if(s.hash=n.readString(),s.version=n.readString(),"3.8.75"===s.version){const t="Unsupported skeleton data, 3.8.75 is deprecated, please export with a newer version of Spine.";console.error(t)}s.x=n.readFloat(),s.y=n.readFloat(),s.width=n.readFloat(),s.height=n.readFloat();const i=n.readBoolean();i&&(s.fps=n.readFloat(),s.imagesPath=n.readString(),s.audioPath=n.readString());let r=0;r=n.readInt(!0);for(let o=0;o<r;o++)n.strings.push(n.readString());r=n.readInt(!0);for(let o=0;o<r;o++){const t=n.readString(),r=0==o?null:s.bones[n.readInt(!0)],a=new Hx(o,t,r);a.rotation=n.readFloat(),a.x=n.readFloat()*e,a.y=n.readFloat()*e,a.scaleX=n.readFloat(),a.scaleY=n.readFloat(),a.shearX=n.readFloat(),a.shearY=n.readFloat(),a.length=n.readFloat()*e,a.transformMode=d_.TransformModeValues[n.readInt(!0)],a.skinRequired=n.readBoolean(),i&&Mv.rgba8888ToColor(a.color,n.readInt32()),s.bones.push(a)}r=n.readInt(!0);for(let o=0;o<r;o++){const t=n.readString(),e=s.bones[n.readInt(!0)],i=new h_(o,t,e);Mv.rgba8888ToColor(i.color,n.readInt32());const r=n.readInt32();-1!=r&&Mv.rgb888ToColor(i.darkColor=new Mv,r),i.attachmentName=n.readStringRef(),i.blendMode=d_.BlendModeValues[n.readInt(!0)],s.slots.push(i)}r=n.readInt(!0);for(let o,h=0;h<r;h++){const t=new Jx(n.readString());t.order=n.readInt(!0),t.skinRequired=n.readBoolean(),o=n.readInt(!0);for(let e=0;e<o;e++)t.bones.push(s.bones[n.readInt(!0)]);t.target=s.bones[n.readInt(!0)],t.mix=n.readFloat(),t.softness=n.readFloat()*e,t.bendDirection=n.readByte(),t.compress=n.readBoolean(),t.stretch=n.readBoolean(),t.uniform=n.readBoolean(),s.ikConstraints.push(t)}r=n.readInt(!0);for(let o,h=0;h<r;h++){const t=new l_(n.readString());t.order=n.readInt(!0),t.skinRequired=n.readBoolean(),o=n.readInt(!0);for(let e=0;e<o;e++)t.bones.push(s.bones[n.readInt(!0)]);t.target=s.bones[n.readInt(!0)],t.local=n.readBoolean(),t.relative=n.readBoolean(),t.offsetRotation=n.readFloat(),t.offsetX=n.readFloat()*e,t.offsetY=n.readFloat()*e,t.offsetScaleX=n.readFloat(),t.offsetScaleY=n.readFloat(),t.offsetShearY=n.readFloat(),t.rotateMix=n.readFloat(),t.translateMix=n.readFloat(),t.scaleMix=n.readFloat(),t.shearMix=n.readFloat(),s.transformConstraints.push(t)}r=n.readInt(!0);for(let o,h=0;h<r;h++){const t=new t_(n.readString());t.order=n.readInt(!0),t.skinRequired=n.readBoolean(),o=n.readInt(!0);for(let e=0;e<o;e++)t.bones.push(s.bones[n.readInt(!0)]);t.target=s.slots[n.readInt(!0)],t.positionMode=d_.PositionModeValues[n.readInt(!0)],t.spacingMode=d_.SpacingModeValues[n.readInt(!0)],t.rotateMode=d_.RotateModeValues[n.readInt(!0)],t.offsetRotation=n.readFloat(),t.position=n.readFloat(),t.positionMode==fv.Fixed&&(t.position*=e),t.spacing=n.readFloat(),t.spacingMode!=e_.Length&&t.spacingMode!=e_.Fixed||(t.spacing*=e),t.rotateMix=n.readFloat(),t.translateMix=n.readFloat(),s.pathConstraints.push(t)}const a=this.readSkin(n,s,!0,i);null!=a&&(s.defaultSkin=a,s.skins.push(a));{let t=s.skins.length;for(Ov.setArraySize(s.skins,r=t+n.readInt(!0));t<r;t++)s.skins[t]=this.readSkin(n,s,!1,i)}r=this.linkedMeshes.length;for(let o=0;o<r;o++){const t=this.linkedMeshes[o],e=null==t.skin?s.defaultSkin:s.findSkin(t.skin);if(null==e)throw new Error(`Skin not found: ${t.skin}`);const n=e.getAttachment(t.slotIndex,t.parent);if(null==n)throw new Error(`Parent mesh not found: ${t.parent}`);t.mesh.deformAttachment=t.inheritDeform?n:t.mesh,t.mesh.setParentMesh(n)}this.linkedMeshes.length=0,r=n.readInt(!0);for(let o=0;o<r;o++){const t=new Zx(n.readStringRef());t.intValue=n.readInt(!1),t.floatValue=n.readFloat(),t.stringValue=n.readString(),t.audioPath=n.readString(),null!=t.audioPath&&(t.volume=n.readFloat(),t.balance=n.readFloat()),s.events.push(t)}r=n.readInt(!0);for(let o=0;o<r;o++)s.animations.push(this.readAnimation(n,n.readString(),s));return s}readSkin(t,e,s,n){let i=null,r=0;if(s){if(r=t.readInt(!0),0==r)return null;i=new u_("default")}else{i=new u_(t.readStringRef()),i.bones.length=t.readInt(!0);for(let s=0,n=i.bones.length;s<n;s++)i.bones[s]=e.bones[t.readInt(!0)];for(let s=0,n=t.readInt(!0);s<n;s++)i.constraints.push(e.ikConstraints[t.readInt(!0)]);for(let s=0,n=t.readInt(!0);s<n;s++)i.constraints.push(e.transformConstraints[t.readInt(!0)]);for(let s=0,n=t.readInt(!0);s<n;s++)i.constraints.push(e.pathConstraints[t.readInt(!0)]);r=t.readInt(!0)}for(let a=0;a<r;a++){const s=t.readInt(!0);for(let r=0,a=t.readInt(!0);r<a;r++){const r=t.readStringRef(),a=this.readAttachment(t,e,i,s,r,n);null!=a&&i.setAttachment(s,r,a)}}return i}readAttachment(t,e,s,n,i,r){const a=this.scale;let o=t.readStringRef();null==o&&(o=i);const h=t.readByte();switch(d_.AttachmentTypeValues[h]){case lv.Region:{let e=t.readStringRef();const n=t.readFloat(),i=t.readFloat(),r=t.readFloat(),h=t.readFloat(),l=t.readFloat(),c=t.readFloat(),u=t.readFloat(),d=t.readInt32();null==e&&(e=o);const f=this.attachmentLoader.newRegionAttachment(s,o,e);return null==f?null:(f.path=e,f.x=i*a,f.y=r*a,f.scaleX=h,f.scaleY=l,f.rotation=n,f.width=c*a,f.height=u*a,Mv.rgba8888ToColor(f.color,d),f)}case lv.BoundingBox:{const e=t.readInt(!0),n=this.readVertices(t,e),i=r?t.readInt32():0,a=this.attachmentLoader.newBoundingBoxAttachment(s,o);return null==a?null:(a.worldVerticesLength=e<<1,a.vertices=n.vertices,a.bones=n.bones,r&&Mv.rgba8888ToColor(a.color,i),a)}case lv.Mesh:{let e=t.readStringRef();const n=t.readInt32(),i=t.readInt(!0),h=this.readFloatArray(t,i<<1,1),l=this.readShortArray(t),c=this.readVertices(t,i),u=t.readInt(!0);let d=null,f=0,p=0;r&&(d=this.readShortArray(t),f=t.readFloat(),p=t.readFloat()),null==e&&(e=o);const m=this.attachmentLoader.newMeshAttachment(s,o,e);return null==m?null:(m.path=e,Mv.rgba8888ToColor(m.color,n),m.bones=c.bones,m.vertices=c.vertices,m.worldVerticesLength=i<<1,m.triangles=l,m.regionUVs=new Float32Array(h),m.hullLength=u<<1,r&&(m.edges=d,m.width=f*a,m.height=p*a),m)}case lv.LinkedMesh:{let e=t.readStringRef();const i=t.readInt32(),h=t.readStringRef(),l=t.readStringRef(),c=t.readBoolean();let u=0,d=0;r&&(u=t.readFloat(),d=t.readFloat()),null==e&&(e=o);const f=this.attachmentLoader.newMeshAttachment(s,o,e);return null==f?null:(f.path=e,Mv.rgba8888ToColor(f.color,i),r&&(f.width=u*a,f.height=d*a),this.linkedMeshes.push(new p_(f,h,n,l,c)),f)}case lv.Path:{const e=t.readBoolean(),n=t.readBoolean(),i=t.readInt(!0),h=this.readVertices(t,i),l=Ov.newArray(i/3,0);for(let s=0,r=l.length;s<r;s++)l[s]=t.readFloat()*a;const c=r?t.readInt32():0,u=this.attachmentLoader.newPathAttachment(s,o);return null==u?null:(u.closed=e,u.constantSpeed=n,u.worldVerticesLength=i<<1,u.vertices=h.vertices,u.bones=h.bones,u.lengths=l,r&&Mv.rgba8888ToColor(u.color,c),u)}case lv.Point:{const e=t.readFloat(),n=t.readFloat(),i=t.readFloat(),h=r?t.readInt32():0,l=this.attachmentLoader.newPointAttachment(s,o);return null==l?null:(l.x=n*a,l.y=i*a,l.rotation=e,r&&Mv.rgba8888ToColor(l.color,h),l)}case lv.Clipping:{const n=t.readInt(!0),i=t.readInt(!0),a=this.readVertices(t,i),h=r?t.readInt32():0,l=this.attachmentLoader.newClippingAttachment(s,o);return null==l?null:(l.endSlot=e.slots[n],l.worldVerticesLength=i<<1,l.vertices=a.vertices,l.bones=a.bones,r&&Mv.rgba8888ToColor(l.color,h),l)}}return null}readVertices(t,e){const s=e<<1,n=new m_,i=this.scale;if(!t.readBoolean())return n.vertices=this.readFloatArray(t,s,i),n;const r=new Array,a=new Array;for(let o=0;o<e;o++){const e=t.readInt(!0);a.push(e);for(let s=0;s<e;s++)a.push(t.readInt(!0)),r.push(t.readFloat()*i),r.push(t.readFloat()*i),r.push(t.readFloat())}return n.vertices=Ov.toFloatArray(r),n.bones=a,n}readFloatArray(t,e,s){const n=new Array(e);if(1==s)for(let i=0;i<e;i++)n[i]=t.readFloat();else for(let i=0;i<e;i++)n[i]=t.readFloat()*s;return n}readShortArray(t){const e=t.readInt(!0),s=new Array(e);for(let n=0;n<e;n++)s[n]=t.readShort();return s}readAnimation(t,e,s){const n=new Array,i=this.scale;let r=0;const a=new Mv,o=new Mv;for(let c=0,u=t.readInt(!0);c<u;c++){const e=t.readInt(!0);for(let s=0,i=t.readInt(!0);s<i;s++){const s=t.readByte(),i=t.readInt(!0);switch(s){case d_.SLOT_ATTACHMENT:{const s=new Ex(i);s.slotIndex=e;for(let e=0;e<i;e++)s.setFrame(e,t.readFloat(),t.readStringRef());n.push(s),r=Math.max(r,s.frames[i-1]);break}case d_.SLOT_COLOR:{const s=new _x(i);s.slotIndex=e;for(let e=0;e<i;e++){const n=t.readFloat();Mv.rgba8888ToColor(a,t.readInt32()),s.setFrame(e,n,a.r,a.g,a.b,a.a),e<i-1&&this.readCurve(t,e,s)}n.push(s),r=Math.max(r,s.frames[(i-1)*_x.ENTRIES]);break}case d_.SLOT_TWO_COLOR:{const s=new wx(i);s.slotIndex=e;for(let e=0;e<i;e++){const n=t.readFloat();Mv.rgba8888ToColor(a,t.readInt32()),Mv.rgb888ToColor(o,t.readInt32()),s.setFrame(e,n,a.r,a.g,a.b,a.a,o.r,o.g,o.b),e<i-1&&this.readCurve(t,e,s)}n.push(s),r=Math.max(r,s.frames[(i-1)*wx.ENTRIES]);break}}}}for(let c=0,u=t.readInt(!0);c<u;c++){const e=t.readInt(!0);for(let s=0,a=t.readInt(!0);s<a;s++){const s=t.readByte(),a=t.readInt(!0);switch(s){case d_.BONE_ROTATE:{const s=new px(a);s.boneIndex=e;for(let e=0;e<a;e++)s.setFrame(e,t.readFloat(),t.readFloat()),e<a-1&&this.readCurve(t,e,s);n.push(s),r=Math.max(r,s.frames[(a-1)*px.ENTRIES]);break}case d_.BONE_TRANSLATE:case d_.BONE_SCALE:case d_.BONE_SHEAR:{let o,h=1;s==d_.BONE_SCALE?o=new yx(a):s==d_.BONE_SHEAR?o=new vx(a):(o=new gx(a),h=i),o.boneIndex=e;for(let e=0;e<a;e++)o.setFrame(e,t.readFloat(),t.readFloat()*h,t.readFloat()*h),e<a-1&&this.readCurve(t,e,o);n.push(o),r=Math.max(r,o.frames[(a-1)*gx.ENTRIES]);break}}}}for(let c=0,u=t.readInt(!0);c<u;c++){const e=t.readInt(!0),s=t.readInt(!0),a=new Ix(s);a.ikConstraintIndex=e;for(let n=0;n<s;n++)a.setFrame(n,t.readFloat(),t.readFloat(),t.readFloat()*i,t.readByte(),t.readBoolean(),t.readBoolean()),n<s-1&&this.readCurve(t,n,a);n.push(a),r=Math.max(r,a.frames[(s-1)*Ix.ENTRIES])}for(let c=0,u=t.readInt(!0);c<u;c++){const e=t.readInt(!0),s=t.readInt(!0),i=new Rx(s);i.transformConstraintIndex=e;for(let n=0;n<s;n++)i.setFrame(n,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()),n<s-1&&this.readCurve(t,n,i);n.push(i),r=Math.max(r,i.frames[(s-1)*Rx.ENTRIES])}for(let c=0,u=t.readInt(!0);c<u;c++){const e=t.readInt(!0),a=s.pathConstraints[e];for(let s=0,o=t.readInt(!0);s<o;s++){const s=t.readByte(),o=t.readInt(!0);switch(s){case d_.PATH_POSITION:case d_.PATH_SPACING:{let h,l=1;s==d_.PATH_SPACING?(h=new Fx(o),a.spacingMode!=e_.Length&&a.spacingMode!=e_.Fixed||(l=i)):(h=new Dx(o),a.positionMode==fv.Fixed&&(l=i)),h.pathConstraintIndex=e;for(let e=0;e<o;e++)h.setFrame(e,t.readFloat(),t.readFloat()*l),e<o-1&&this.readCurve(t,e,h);n.push(h),r=Math.max(r,h.frames[(o-1)*Dx.ENTRIES]);break}case d_.PATH_MIX:{const s=new Nx(o);s.pathConstraintIndex=e;for(let e=0;e<o;e++)s.setFrame(e,t.readFloat(),t.readFloat(),t.readFloat()),e<o-1&&this.readCurve(t,e,s);n.push(s),r=Math.max(r,s.frames[(o-1)*Nx.ENTRIES]);break}}}}for(let c=0,u=t.readInt(!0);c<u;c++){const e=s.skins[t.readInt(!0)];for(let s=0,a=t.readInt(!0);s<a;s++){const s=t.readInt(!0);for(let a=0,o=t.readInt(!0);a<o;a++){const a=e.getAttachment(s,t.readStringRef()),o=null!=a.bones,h=a.vertices,l=o?h.length/3*2:h.length,c=t.readInt(!0),u=new Tx(c);u.slotIndex=s,u.attachment=a;for(let e=0;e<c;e++){const s=t.readFloat();let n,r=t.readInt(!0);if(0==r)n=o?Ov.newFloatArray(l):h;else{n=Ov.newFloatArray(l);const e=t.readInt(!0);if(r+=e,1==i)for(let s=e;s<r;s++)n[s]=t.readFloat();else for(let s=e;s<r;s++)n[s]=t.readFloat()*i;if(!o)for(let t=0,s=n.length;t<s;t++)n[t]+=h[t]}u.setFrame(e,s,n),e<c-1&&this.readCurve(t,e,u)}n.push(u),r=Math.max(r,u.frames[c-1])}}}const h=t.readInt(!0);if(h>0){const e=new Cx(h),i=s.slots.length;for(let s=0;s<h;s++){const n=t.readFloat(),r=t.readInt(!0),a=Ov.newArray(i,0);for(let t=i-1;t>=0;t--)a[t]=-1;const o=Ov.newArray(i-r,0);let h=0,l=0;for(let e=0;e<r;e++){const e=t.readInt(!0);for(;h!=e;)o[l++]=h++;a[h+t.readInt(!0)]=h++}for(;h<i;)o[l++]=h++;for(let t=i-1;t>=0;t--)-1==a[t]&&(a[t]=o[--l]);e.setFrame(s,n,a)}n.push(e),r=Math.max(r,e.frames[h-1])}const l=t.readInt(!0);if(l>0){const e=new Ax(l);for(let n=0;n<l;n++){const i=t.readFloat(),r=s.events[t.readInt(!0)],a=new Kx(i,r);a.intValue=t.readInt(!1),a.floatValue=t.readFloat(),a.stringValue=t.readBoolean()?t.readString():r.stringValue,null!=a.data.audioPath&&(a.volume=t.readFloat(),a.balance=t.readFloat()),e.setFrame(n,a)}n.push(e),r=Math.max(r,e.frames[l-1])}return new lx(e,n,r)}readCurve(t,e,s){switch(t.readByte()){case d_.CURVE_STEPPED:s.setStepped(e);break;case d_.CURVE_BEZIER:this.setCurve(s,e,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat())}}setCurve(t,e,s,n,i,r){t.setCurve(e,s,n,i,r)}};let f_=d_;f_.AttachmentTypeValues=[0,1,2,3,4,5,6],f_.TransformModeValues=[mv.Normal,mv.OnlyTranslation,mv.NoRotationOrReflection,mv.NoScale,mv.NoScaleOrReflection],f_.PositionModeValues=[fv.Fixed,fv.Percent],f_.SpacingModeValues=[e_.Length,e_.Fixed,e_.Percent],f_.RotateModeValues=[pv.Tangent,pv.Chain,pv.ChainScale],f_.BlendModeValues=[ir.NORMAL,ir.ADD,ir.MULTIPLY,ir.SCREEN],f_.BONE_ROTATE=0,f_.BONE_TRANSLATE=1,f_.BONE_SCALE=2,f_.BONE_SHEAR=3,f_.SLOT_ATTACHMENT=0,f_.SLOT_COLOR=1,f_.SLOT_TWO_COLOR=2,f_.PATH_POSITION=0,f_.PATH_SPACING=1,f_.PATH_MIX=2,f_.CURVE_LINEAR=0,f_.CURVE_STEPPED=1,f_.CURVE_BEZIER=2;let p_=class{constructor(t,e,s,n,i){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=n,this.inheritDeform=i}},m_=class{constructor(t=null,e=null){this.bones=t,this.vertices=e}},g_=class t{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(e){const s=this.scale,n=new o_,i="string"==typeof e?JSON.parse(e):e,r=i.skeleton;if(null!=r){if(n.hash=r.hash,n.version=r.spine,"3.8"!==n.version.substr(0,3)){const t=`Spine 3.8 loader cant load version ${r.spine}. Please configure your pixi-spine bundle`;console.error(t)}if("3.8.75"===n.version){const t="Unsupported skeleton data, 3.8.75 is deprecated, please export with a newer version of Spine.";console.error(t)}n.x=r.x,n.y=r.y,n.width=r.width,n.height=r.height,n.fps=r.fps,n.imagesPath=r.images}if(i.bones)for(let a=0;a<i.bones.length;a++){const e=i.bones[a];let r=null;const o=this.getValue(e,"parent",null);if(null!=o&&(r=n.findBone(o),null==r))throw new Error(`Parent bone not found: ${o}`);const h=new Hx(n.bones.length,e.name,r);h.length=this.getValue(e,"length",0)*s,h.x=this.getValue(e,"x",0)*s,h.y=this.getValue(e,"y",0)*s,h.rotation=this.getValue(e,"rotation",0),h.scaleX=this.getValue(e,"scaleX",1),h.scaleY=this.getValue(e,"scaleY",1),h.shearX=this.getValue(e,"shearX",0),h.shearY=this.getValue(e,"shearY",0),h.transformMode=t.transformModeFromString(this.getValue(e,"transform","normal")),h.skinRequired=this.getValue(e,"skin",!1),n.bones.push(h)}if(i.slots)for(let a=0;a<i.slots.length;a++){const e=i.slots[a],s=e.name,r=e.bone,o=n.findBone(r);if(null==o)throw new Error(`Slot bone not found: ${r}`);const h=new h_(n.slots.length,s,o),l=this.getValue(e,"color",null);null!=l&&h.color.setFromString(l);const c=this.getValue(e,"dark",null);null!=c&&(h.darkColor=new Mv(1,1,1,1),h.darkColor.setFromString(c)),h.attachmentName=this.getValue(e,"attachment",null),h.blendMode=t.blendModeFromString(this.getValue(e,"blend","normal")),n.slots.push(h)}if(i.ik)for(let t=0;t<i.ik.length;t++){const e=i.ik[t],r=new Jx(e.name);r.order=this.getValue(e,"order",0),r.skinRequired=this.getValue(e,"skin",!1);for(let t=0;t<e.bones.length;t++){const s=e.bones[t],i=n.findBone(s);if(null==i)throw new Error(`IK bone not found: ${s}`);r.bones.push(i)}const a=e.target;if(r.target=n.findBone(a),null==r.target)throw new Error(`IK target bone not found: ${a}`);r.mix=this.getValue(e,"mix",1),r.softness=this.getValue(e,"softness",0)*s,r.bendDirection=this.getValue(e,"bendPositive",!0)?1:-1,r.compress=this.getValue(e,"compress",!1),r.stretch=this.getValue(e,"stretch",!1),r.uniform=this.getValue(e,"uniform",!1),n.ikConstraints.push(r)}if(i.transform)for(let t=0;t<i.transform.length;t++){const e=i.transform[t],r=new l_(e.name);r.order=this.getValue(e,"order",0),r.skinRequired=this.getValue(e,"skin",!1);for(let t=0;t<e.bones.length;t++){const s=e.bones[t],i=n.findBone(s);if(null==i)throw new Error(`Transform constraint bone not found: ${s}`);r.bones.push(i)}const a=e.target;if(r.target=n.findBone(a),null==r.target)throw new Error(`Transform constraint target bone not found: ${a}`);r.local=this.getValue(e,"local",!1),r.relative=this.getValue(e,"relative",!1),r.offsetRotation=this.getValue(e,"rotation",0),r.offsetX=this.getValue(e,"x",0)*s,r.offsetY=this.getValue(e,"y",0)*s,r.offsetScaleX=this.getValue(e,"scaleX",0),r.offsetScaleY=this.getValue(e,"scaleY",0),r.offsetShearY=this.getValue(e,"shearY",0),r.rotateMix=this.getValue(e,"rotateMix",1),r.translateMix=this.getValue(e,"translateMix",1),r.scaleMix=this.getValue(e,"scaleMix",1),r.shearMix=this.getValue(e,"shearMix",1),n.transformConstraints.push(r)}if(i.path)for(let a=0;a<i.path.length;a++){const e=i.path[a],r=new t_(e.name);r.order=this.getValue(e,"order",0),r.skinRequired=this.getValue(e,"skin",!1);for(let t=0;t<e.bones.length;t++){const s=e.bones[t],i=n.findBone(s);if(null==i)throw new Error(`Transform constraint bone not found: ${s}`);r.bones.push(i)}const o=e.target;if(r.target=n.findSlot(o),null==r.target)throw new Error(`Path target slot not found: ${o}`);r.positionMode=t.positionModeFromString(this.getValue(e,"positionMode","percent")),r.spacingMode=t.spacingModeFromString(this.getValue(e,"spacingMode","length")),r.rotateMode=t.rotateModeFromString(this.getValue(e,"rotateMode","tangent")),r.offsetRotation=this.getValue(e,"rotation",0),r.position=this.getValue(e,"position",0),r.positionMode==fv.Fixed&&(r.position*=s),r.spacing=this.getValue(e,"spacing",0),r.spacingMode!=e_.Length&&r.spacingMode!=e_.Fixed||(r.spacing*=s),r.rotateMix=this.getValue(e,"rotateMix",1),r.translateMix=this.getValue(e,"translateMix",1),n.pathConstraints.push(r)}if(i.skins)for(let t=0;t<i.skins.length;t++){const e=i.skins[t],s=new u_(e.name);if(e.bones)for(let i=0;i<e.bones.length;i++){const r=n.findBone(e.bones[i]);if(null==r)throw new Error(`Skin bone not found: ${e.bones[t]}`);s.bones.push(r)}if(e.ik)for(let i=0;i<e.ik.length;i++){const r=n.findIkConstraint(e.ik[i]);if(null==r)throw new Error(`Skin IK constraint not found: ${e.ik[t]}`);s.constraints.push(r)}if(e.transform)for(let i=0;i<e.transform.length;i++){const r=n.findTransformConstraint(e.transform[i]);if(null==r)throw new Error(`Skin transform constraint not found: ${e.transform[t]}`);s.constraints.push(r)}if(e.path)for(let i=0;i<e.path.length;i++){const r=n.findPathConstraint(e.path[i]);if(null==r)throw new Error(`Skin path constraint not found: ${e.path[t]}`);s.constraints.push(r)}for(const t in e.attachments){const i=n.findSlot(t);if(null==i)throw new Error(`Slot not found: ${t}`);const r=e.attachments[t];for(const t in r){const e=this.readAttachment(r[t],s,i.index,t,n);null!=e&&s.setAttachment(i.index,t,e)}}n.skins.push(s),"default"==s.name&&(n.defaultSkin=s)}for(let t=0,a=this.linkedMeshes.length;t<a;t++){const e=this.linkedMeshes[t],s=null==e.skin?n.defaultSkin:n.findSkin(e.skin);if(null==s)throw new Error(`Skin not found: ${e.skin}`);const i=s.getAttachment(e.slotIndex,e.parent);if(null==i)throw new Error(`Parent mesh not found: ${e.parent}`);e.mesh.deformAttachment=e.inheritDeform?i:e.mesh,e.mesh.setParentMesh(i)}if(this.linkedMeshes.length=0,i.events)for(const t in i.events){const e=i.events[t],s=new Zx(t);s.intValue=this.getValue(e,"int",0),s.floatValue=this.getValue(e,"float",0),s.stringValue=this.getValue(e,"string",""),s.audioPath=this.getValue(e,"audio",null),null!=s.audioPath&&(s.volume=this.getValue(e,"volume",1),s.balance=this.getValue(e,"balance",0)),n.events.push(s)}if(i.animations)for(const t in i.animations){const e=i.animations[t];this.readAnimation(e,t,n)}return n}readAttachment(t,e,s,n,i){const r=this.scale;n=this.getValue(t,"name",n);switch(this.getValue(t,"type","region")){case"region":{const s=this.getValue(t,"path",n),i=this.attachmentLoader.newRegionAttachment(e,n,s);if(null==i)return null;i.path=s,i.x=this.getValue(t,"x",0)*r,i.y=this.getValue(t,"y",0)*r,i.scaleX=this.getValue(t,"scaleX",1),i.scaleY=this.getValue(t,"scaleY",1),i.rotation=this.getValue(t,"rotation",0),i.width=t.width*r,i.height=t.height*r;const a=this.getValue(t,"color",null);return null!=a&&i.color.setFromString(a),i}case"boundingbox":{const s=this.attachmentLoader.newBoundingBoxAttachment(e,n);if(null==s)return null;this.readVertices(t,s,t.vertexCount<<1);const i=this.getValue(t,"color",null);return null!=i&&s.color.setFromString(i),s}case"mesh":case"linkedmesh":{const i=this.getValue(t,"path",n),a=this.attachmentLoader.newMeshAttachment(e,n,i);if(null==a)return null;a.path=i;const o=this.getValue(t,"color",null);null!=o&&a.color.setFromString(o),a.width=this.getValue(t,"width",0)*r,a.height=this.getValue(t,"height",0)*r;const h=this.getValue(t,"parent",null);if(null!=h)return this.linkedMeshes.push(new y_(a,this.getValue(t,"skin",null),s,h,this.getValue(t,"deform",!0))),a;const l=t.uvs;return this.readVertices(t,a,l.length),a.triangles=t.triangles,a.regionUVs=new Float32Array(l),a.edges=this.getValue(t,"edges",null),a.hullLength=2*this.getValue(t,"hull",0),a}case"path":{const s=this.attachmentLoader.newPathAttachment(e,n);if(null==s)return null;s.closed=this.getValue(t,"closed",!1),s.constantSpeed=this.getValue(t,"constantSpeed",!0);const i=t.vertexCount;this.readVertices(t,s,i<<1);const a=Ov.newArray(i/3,0);for(let e=0;e<t.lengths.length;e++)a[e]=t.lengths[e]*r;s.lengths=a;const o=this.getValue(t,"color",null);return null!=o&&s.color.setFromString(o),s}case"point":{const s=this.attachmentLoader.newPointAttachment(e,n);if(null==s)return null;s.x=this.getValue(t,"x",0)*r,s.y=this.getValue(t,"y",0)*r,s.rotation=this.getValue(t,"rotation",0);const i=this.getValue(t,"color",null);return null!=i&&s.color.setFromString(i),s}case"clipping":{const s=this.attachmentLoader.newClippingAttachment(e,n);if(null==s)return null;const r=this.getValue(t,"end",null);if(null!=r){const t=i.findSlot(r);if(null==t)throw new Error(`Clipping end slot not found: ${r}`);s.endSlot=t}const a=t.vertexCount;this.readVertices(t,s,a<<1);const o=this.getValue(t,"color",null);return null!=o&&s.color.setFromString(o),s}}return null}readVertices(t,e,s){const n=this.scale;e.worldVerticesLength=s;const i=t.vertices;if(s==i.length){const t=Ov.toFloatArray(i);if(1!=n)for(let e=0,s=i.length;e<s;e++)t[e]*=n;return void(e.vertices=t)}const r=new Array,a=new Array;for(let o=0,h=i.length;o<h;){const t=i[o++];a.push(t);for(let e=o+4*t;o<e;o+=4)a.push(i[o]),r.push(i[o+1]*n),r.push(i[o+2]*n),r.push(i[o+3])}e.bones=a,e.vertices=Ov.toFloatArray(r)}readAnimation(t,e,s){const n=this.scale,i=new Array;let r=0;if(t.slots)for(const o in t.slots){const e=t.slots[o],n=s.findSlotIndex(o);if(-1==n)throw new Error(`Slot not found: ${o}`);for(const t in e){const s=e[t];if("attachment"==t){const t=new Ex(s.length);t.slotIndex=n;let e=0;for(let n=0;n<s.length;n++){const i=s[n];t.setFrame(e++,this.getValue(i,"time",0),i.name)}i.push(t),r=Math.max(r,t.frames[t.getFrameCount()-1])}else if("color"==t){const t=new _x(s.length);t.slotIndex=n;let e=0;for(let n=0;n<s.length;n++){const i=s[n],r=new Mv;r.setFromString(i.color||"ffffffff"),t.setFrame(e,this.getValue(i,"time",0),r.r,r.g,r.b,r.a),this.readCurve(i,t,e),e++}i.push(t),r=Math.max(r,t.frames[(t.getFrameCount()-1)*_x.ENTRIES])}else{if("twoColor"!=t)throw new Error(`Invalid timeline type for a slot: ${t} (${o})`);{const t=new wx(s.length);t.slotIndex=n;let e=0;for(let n=0;n<s.length;n++){const i=s[n],r=new Mv,a=new Mv;r.setFromString(i.light),a.setFromString(i.dark),t.setFrame(e,this.getValue(i,"time",0),r.r,r.g,r.b,r.a,a.r,a.g,a.b),this.readCurve(i,t,e),e++}i.push(t),r=Math.max(r,t.frames[(t.getFrameCount()-1)*wx.ENTRIES])}}}}if(t.bones)for(const o in t.bones){const e=t.bones[o],a=s.findBoneIndex(o);if(-1==a)throw new Error(`Bone not found: ${o}`);for(const t in e){const s=e[t];if("rotate"===t){const t=new px(s.length);t.boneIndex=a;let e=0;for(let n=0;n<s.length;n++){const i=s[n];t.setFrame(e,this.getValue(i,"time",0),this.getValue(i,"angle",0)),this.readCurve(i,t,e),e++}i.push(t),r=Math.max(r,t.frames[(t.getFrameCount()-1)*px.ENTRIES])}else{if("translate"!==t&&"scale"!==t&&"shear"!==t)throw new Error(`Invalid timeline type for a bone: ${t} (${o})`);{let e=null,o=1,h=0;"scale"===t?(e=new yx(s.length),h=1):"shear"===t?e=new vx(s.length):(e=new gx(s.length),o=n),e.boneIndex=a;let l=0;for(let t=0;t<s.length;t++){const n=s[t],i=this.getValue(n,"x",h),r=this.getValue(n,"y",h);e.setFrame(l,this.getValue(n,"time",0),i*o,r*o),this.readCurve(n,e,l),l++}i.push(e),r=Math.max(r,e.frames[(e.getFrameCount()-1)*gx.ENTRIES])}}}}if(t.ik)for(const o in t.ik){const e=t.ik[o],a=s.findIkConstraint(o),h=new Ix(e.length);h.ikConstraintIndex=s.ikConstraints.indexOf(a);let l=0;for(let t=0;t<e.length;t++){const s=e[t];h.setFrame(l,this.getValue(s,"time",0),this.getValue(s,"mix",1),this.getValue(s,"softness",0)*n,this.getValue(s,"bendPositive",!0)?1:-1,this.getValue(s,"compress",!1),this.getValue(s,"stretch",!1)),this.readCurve(s,h,l),l++}i.push(h),r=Math.max(r,h.frames[(h.getFrameCount()-1)*Ix.ENTRIES])}if(t.transform)for(const o in t.transform){const e=t.transform[o],n=s.findTransformConstraint(o),a=new Rx(e.length);a.transformConstraintIndex=s.transformConstraints.indexOf(n);let h=0;for(let t=0;t<e.length;t++){const s=e[t];a.setFrame(h,this.getValue(s,"time",0),this.getValue(s,"rotateMix",1),this.getValue(s,"translateMix",1),this.getValue(s,"scaleMix",1),this.getValue(s,"shearMix",1)),this.readCurve(s,a,h),h++}i.push(a),r=Math.max(r,a.frames[(a.getFrameCount()-1)*Rx.ENTRIES])}if(t.path)for(const o in t.path){const e=t.path[o],a=s.findPathConstraintIndex(o);if(-1==a)throw new Error(`Path constraint not found: ${o}`);const h=s.pathConstraints[a];for(const t in e){const s=e[t];if("position"===t||"spacing"===t){let e=null,o=1;"spacing"===t?(e=new Fx(s.length),h.spacingMode!=e_.Length&&h.spacingMode!=e_.Fixed||(o=n)):(e=new Dx(s.length),h.positionMode==fv.Fixed&&(o=n)),e.pathConstraintIndex=a;let l=0;for(let n=0;n<s.length;n++){const i=s[n];e.setFrame(l,this.getValue(i,"time",0),this.getValue(i,t,0)*o),this.readCurve(i,e,l),l++}i.push(e),r=Math.max(r,e.frames[(e.getFrameCount()-1)*Dx.ENTRIES])}else if("mix"===t){const t=new Nx(s.length);t.pathConstraintIndex=a;let e=0;for(let n=0;n<s.length;n++){const i=s[n];t.setFrame(e,this.getValue(i,"time",0),this.getValue(i,"rotateMix",1),this.getValue(i,"translateMix",1)),this.readCurve(i,t,e),e++}i.push(t),r=Math.max(r,t.frames[(t.getFrameCount()-1)*Nx.ENTRIES])}}}if(t.deform)for(const o in t.deform){const e=t.deform[o],a=s.findSkin(o);if(null!=a)for(const t in e){const o=e[t],h=s.findSlotIndex(t);if(-1==h)throw new Error(`Slot not found: ${o.name}`);for(const t in o){const e=o[t],s=a.getAttachment(h,t);if(null==s)throw new Error(`Deform attachment not found: ${e.name}`);const l=null!=s.bones,c=s.vertices,u=l?c.length/3*2:c.length,d=new Tx(e.length);d.slotIndex=h,d.attachment=s;let f=0;for(let t=0;t<e.length;t++){const s=e[t];let i;const r=this.getValue(s,"vertices",null);if(null==r)i=l?Ov.newFloatArray(u):c;else{i=Ov.newFloatArray(u);const t=this.getValue(s,"offset",0);if(Ov.arrayCopy(r,0,i,t,r.length),1!=n)for(let e=t,s=e+r.length;e<s;e++)i[e]*=n;if(!l)for(let e=0;e<u;e++)i[e]+=c[e]}d.setFrame(f,this.getValue(s,"time",0),i),this.readCurve(s,d,f),f++}i.push(d),r=Math.max(r,d.frames[d.getFrameCount()-1])}}}let a=t.drawOrder;if(null==a&&(a=t.draworder),null!=a){const t=new Cx(a.length),e=s.slots.length;let n=0;for(let i=0;i<a.length;i++){const r=a[i];let o=null;const h=this.getValue(r,"offsets",null);if(null!=h){o=Ov.newArray(e,-1);const t=Ov.newArray(e-h.length,0);let n=0,i=0;for(let e=0;e<h.length;e++){const r=h[e],a=s.findSlotIndex(r.slot);if(-1==a)throw new Error(`Slot not found: ${r.slot}`);for(;n!=a;)t[i++]=n++;o[n+r.offset]=n++}for(;n<e;)t[i++]=n++;for(let s=e-1;s>=0;s--)-1==o[s]&&(o[s]=t[--i])}t.setFrame(n++,this.getValue(r,"time",0),o)}i.push(t),r=Math.max(r,t.frames[t.getFrameCount()-1])}if(t.events){const e=new Ax(t.events.length);let n=0;for(let i=0;i<t.events.length;i++){const r=t.events[i],a=s.findEvent(r.name);if(null==a)throw new Error(`Event not found: ${r.name}`);const o=new Kx(Ov.toSinglePrecision(this.getValue(r,"time",0)),a);o.intValue=this.getValue(r,"int",a.intValue),o.floatValue=this.getValue(r,"float",a.floatValue),o.stringValue=this.getValue(r,"string",a.stringValue),null!=o.data.audioPath&&(o.volume=this.getValue(r,"volume",1),o.balance=this.getValue(r,"balance",0)),e.setFrame(n++,o)}i.push(e),r=Math.max(r,e.frames[e.getFrameCount()-1])}if(isNaN(r))throw new Error("Error while parsing animation, duration is NaN");s.animations.push(new lx(e,i,r))}readCurve(t,e,s){if(t.hasOwnProperty("curve"))if("stepped"===t.curve)e.setStepped(s);else{const n=t.curve;e.setCurve(s,n,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1))}}getValue(t,e,s){return void 0!==t[e]?t[e]:s}static blendModeFromString(t){if("normal"==(t=t.toLowerCase()))return ir.NORMAL;if("additive"==t)return ir.ADD;if("multiply"==t)return ir.MULTIPLY;if("screen"==t)return ir.SCREEN;throw new Error(`Unknown blend mode: ${t}`)}static positionModeFromString(t){if("fixed"==(t=t.toLowerCase()))return fv.Fixed;if("percent"==t)return fv.Percent;throw new Error(`Unknown position mode: ${t}`)}static spacingModeFromString(t){if("length"==(t=t.toLowerCase()))return e_.Length;if("fixed"==t)return e_.Fixed;if("percent"==t)return e_.Percent;throw new Error(`Unknown position mode: ${t}`)}static rotateModeFromString(t){if("tangent"==(t=t.toLowerCase()))return pv.Tangent;if("chain"==t)return pv.Chain;if("chainscale"==t)return pv.ChainScale;throw new Error(`Unknown rotate mode: ${t}`)}static transformModeFromString(t){if("normal"==(t=t.toLowerCase()))return mv.Normal;if("onlytranslation"==t)return mv.OnlyTranslation;if("norotationorreflection"==t)return mv.NoRotationOrReflection;if("noscale"==t)return mv.NoScale;if("noscaleorreflection"==t)return mv.NoScaleOrReflection;throw new Error(`Unknown transform mode: ${t}`)}},y_=class{constructor(t,e,s,n,i){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=n,this.inheritDeform=i}};const v_=Object.freeze(Object.defineProperty({__proto__:null,Animation:lx,AnimationState:Lx,AnimationStateAdapter:class{start(t){}interrupt(t){}end(t){}dispose(t){}complete(t){}event(t,e){}},AnimationStateData:jx,AtlasAttachmentLoader:zx,Attachment:Kv,AttachmentTimeline:Ex,Bone:Gx,BoneData:Hx,BoundingBoxAttachment:Jv,ClippingAttachment:tx,ColorTimeline:_x,ConstraintData:qx,CurveTimeline:dx,DeformTimeline:Tx,DrawOrderTimeline:Cx,Event:Kx,EventData:Zx,EventQueue:Xx,EventTimeline:Ax,EventType:Yx,IkConstraint:Qx,IkConstraintData:Jx,IkConstraintTimeline:Ix,JitterEffect:class{constructor(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}begin(t){}transform(t,e,s,n){t.x+=Pv.randomTriangular(-this.jitterX,this.jitterY),t.y+=Pv.randomTriangular(-this.jitterX,this.jitterY)}end(){}},MeshAttachment:ex,PathAttachment:sx,PathConstraint:n_,PathConstraintData:t_,PathConstraintMixTimeline:Nx,PathConstraintPositionTimeline:Dx,PathConstraintSpacingTimeline:Fx,PointAttachment:nx,RegionAttachment:ax,RotateTimeline:px,ScaleTimeline:yx,ShearTimeline:vx,Skeleton:a_,SkeletonBinary:f_,SkeletonBounds:class extends Lv{},SkeletonData:o_,SkeletonJson:g_,Skin:u_,SkinEntry:c_,Slot:ix,SlotData:h_,SpacingMode:e_,Spine:class extends Wv{createSkeleton(t){this.skeleton=new a_(t),this.skeleton.updateWorldTransform(),this.stateData=new jx(t),this.state=new Lx(this.stateData)}},SwirlEffect:hx,TimelineType:cx,TrackEntry:$x,TransformConstraint:i_,TransformConstraintData:l_,TransformConstraintTimeline:Rx,TranslateTimeline:gx,TwoColorTimeline:wx,VertexAttachment:Qv},Symbol.toStringTag,{value:"Module"}));let x_=class{constructor(t){if(null==t)throw new Error("name cannot be null.");this.name=t}};const __=class extends x_{constructor(t){super(t),this.id=(65535&__.nextID++)<<11,this.worldVerticesLength=0}computeWorldVerticesOld(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)}computeWorldVertices(t,e,s,n,i,r){s=i+(s>>1)*r;const a=t.bone.skeleton,o=t.attachmentVertices;let h=this.vertices;const l=this.bones;if(null==l){o.length>0&&(h=o);const a=t.bone.matrix,l=a.tx,c=a.ty,u=a.a,d=a.c,f=a.b,p=a.d;for(let t=e,o=i;o<s;t+=2,o+=r){const e=h[t],s=h[t+1];n[o]=e*u+s*d+l,n[o+1]=e*f+s*p+c}return}let c=0,u=0;for(let f=0;f<e;f+=2){const t=l[c];c+=t+1,u+=t}const d=a.bones;if(0==o.length)for(let f=i,p=3*u;f<s;f+=r){let t=0,e=0,s=l[c++];for(s+=c;c<s;c++,p+=3){const s=d[l[c]].matrix,n=h[p],i=h[p+1],r=h[p+2];t+=(n*s.a+i*s.c+s.tx)*r,e+=(n*s.b+i*s.d+s.ty)*r}n[f]=t,n[f+1]=e}else{const t=o;for(let e=i,a=3*u,o=u<<1;e<s;e+=r){let s=0,i=0,r=l[c++];for(r+=c;c<r;c++,a+=3,o+=2){const e=d[l[c]].matrix,n=h[a]+t[o],r=h[a+1]+t[o+1],u=h[a+2];s+=(n*e.a+r*e.c+e.tx)*u,i+=(n*e.b+r*e.d+e.ty)*u}n[e]=s,n[e+1]=i}}}applyDeform(t){return this==t}};let b_=__;b_.nextID=0;let w_=class extends b_{constructor(t){super(t),this.type=lv.BoundingBox,this.color=new Mv(1,1,1,1)}},E_=class extends b_{constructor(t){super(t),this.type=lv.Clipping,this.color=new Mv(.2275,.2275,.8078,1)}},S_=class extends b_{constructor(t){super(t),this.type=lv.Mesh,this.color=new Mv(1,1,1,1),this.inheritDeform=!1,this.tempColor=new Mv(0,0,0,0)}applyDeform(t){return this==t||this.inheritDeform&&this.parentMesh==t}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}},T_=class extends b_{constructor(t){super(t),this.type=lv.Path,this.closed=!1,this.constantSpeed=!1,this.color=new Mv(1,1,1,1)}},A_=class extends b_{constructor(t){super(t),this.type=lv.Point,this.color=new Mv(.38,.94,0,1)}computeWorldPosition(t,e){const s=t.matrix;return e.x=this.x*s.a+this.y*s.c+t.worldX,e.y=this.x*s.b+this.y*s.d+t.worldY,e}computeWorldRotation(t){const e=t.matrix,s=Pv.cosDeg(this.rotation),n=Pv.sinDeg(this.rotation),i=s*e.a+n*e.c,r=s*e.b+n*e.d;return Math.atan2(r,i)*Pv.radDeg}},C_=class{constructor(t,e){if(this.attachmentVertices=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new Mv,this.darkColor=null==t.darkColor?null:new Mv,this.setToSetupPose(),this.blendMode=this.data.blendMode}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0)}setAttachmentTime(t){this.attachmentTime=this.bone.skeleton.time-t}getAttachmentTime(){return this.bone.skeleton.time-this.attachmentTime}setToSetupPose(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))}};const M_=class extends x_{constructor(t){super(t),this.type=lv.Region,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new Mv(1,1,1,1),this.offset=Ov.newFloatArray(8),this.uvs=Ov.newFloatArray(8),this.tempColor=new Mv(1,1,1,1)}updateOffset(){const t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,s=-this.width/2*this.scaleX+this.region.offsetX*t,n=-this.height/2*this.scaleY+this.region.offsetY*e,i=s+this.region.width*t,r=n+this.region.height*e,a=this.rotation*Math.PI/180,o=Math.cos(a),h=Math.sin(a),l=s*o+this.x,c=s*h,u=n*o+this.y,d=n*h,f=i*o+this.x,p=i*h,m=r*o+this.y,g=r*h,y=this.offset;y[M_.OX1]=l-d,y[M_.OY1]=u+c,y[M_.OX2]=l-g,y[M_.OY2]=m+c,y[M_.OX3]=f-g,y[M_.OY3]=m+p,y[M_.OX4]=f-d,y[M_.OY4]=u+p}setRegion(t){this.region=t;const e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}computeWorldVertices(t,e,s,n){const i=this.offset,r=t instanceof C_?t.bone.matrix:t.matrix,a=r.tx,o=r.ty,h=r.a,l=r.c,c=r.b,u=r.d;let d=0,f=0;d=i[M_.OX1],f=i[M_.OY1],e[s]=d*h+f*l+a,e[s+1]=d*c+f*u+o,s+=n,d=i[M_.OX2],f=i[M_.OY2],e[s]=d*h+f*l+a,e[s+1]=d*c+f*u+o,s+=n,d=i[M_.OX3],f=i[M_.OY3],e[s]=d*h+f*l+a,e[s+1]=d*c+f*u+o,s+=n,d=i[M_.OX4],f=i[M_.OY4],e[s]=d*h+f*l+a,e[s+1]=d*c+f*u+o}};let I_=M_;I_.OX1=0,I_.OY1=1,I_.OX2=2,I_.OY2=3,I_.OX3=4,I_.OY3=5,I_.OX4=6,I_.OY4=7,I_.X1=0,I_.Y1=1,I_.C1R=2,I_.C1G=3,I_.C1B=4,I_.C1A=5,I_.U1=6,I_.V1=7,I_.X2=8,I_.Y2=9,I_.C2R=10,I_.C2G=11,I_.C2B=12,I_.C2A=13,I_.U2=14,I_.V2=15,I_.X3=16,I_.Y3=17,I_.C3R=18,I_.C3G=19,I_.C3B=20,I_.C3A=21,I_.U3=22,I_.V3=23,I_.X4=24,I_.Y4=25,I_.C4R=26,I_.C4G=27,I_.C4B=28,I_.C4A=29,I_.U4=30,I_.V4=31;const P_=class{constructor(t){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t}begin(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY}transform(t,e,s,n){const i=this.angle*Pv.degreesToRadians,r=t.x-this.worldX,a=t.y-this.worldY,o=Math.sqrt(r*r+a*a);if(o<this.radius){const e=P_.interpolation.apply(0,i,(this.radius-o)/this.radius),s=Math.cos(e),n=Math.sin(e);t.x=s*r-n*a+this.worldX,t.y=n*r+s*a+this.worldY}}end(){}};let R_=P_;R_.interpolation=new Dv(2);let k_=class{constructor(t,e,s){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.duration=s}apply(t,e,s,n,i,r,a,o){if(null==t)throw new Error("skeleton cannot be null.");n&&0!=this.duration&&(s%=this.duration,e>0&&(e%=this.duration));const h=this.timelines;for(let l=0,c=h.length;l<c;l++)h[l].apply(t,e,s,i,r,a,o)}static binarySearch(t,e,s=1){let n=0,i=t.length/s-2;if(0==i)return s;let r=i>>>1;for(;;){if(t[(r+1)*s]<=e?n=r+1:i=r,n==i)return(n+1)*s;r=n+i>>>1}}static linearSearch(t,e,s){for(let n=0,i=t.length-s;n<=i;n+=s)if(t[n]>e)return n;return-1}};var D_=(t=>(t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor",t))(D_||{});const F_=class{constructor(t){if(t<=0)throw new Error(`frameCount must be > 0: ${t}`);this.curves=Ov.newFloatArray((t-1)*F_.BEZIER_SIZE)}getFrameCount(){return this.curves.length/F_.BEZIER_SIZE+1}setLinear(t){this.curves[t*F_.BEZIER_SIZE]=F_.LINEAR}setStepped(t){this.curves[t*F_.BEZIER_SIZE]=F_.STEPPED}getCurveType(t){const e=t*F_.BEZIER_SIZE;if(e==this.curves.length)return F_.LINEAR;const s=this.curves[e];return s==F_.LINEAR?F_.LINEAR:s==F_.STEPPED?F_.STEPPED:F_.BEZIER}setCurve(t,e,s,n,i){const r=.03*(2*-e+n),a=.03*(2*-s+i),o=.006*(3*(e-n)+1),h=.006*(3*(s-i)+1);let l=2*r+o,c=2*a+h,u=.3*e+r+.16666667*o,d=.3*s+a+.16666667*h,f=t*F_.BEZIER_SIZE;const p=this.curves;p[f++]=F_.BEZIER;let m=u,g=d;for(let y=f+F_.BEZIER_SIZE-1;f<y;f+=2)p[f]=m,p[f+1]=g,u+=l,d+=c,l+=o,c+=h,m+=u,g+=d}getCurvePercent(t,e){e=Pv.clamp(e,0,1);const s=this.curves;let n=t*F_.BEZIER_SIZE;const i=s[n];if(i==F_.LINEAR)return e;if(i==F_.STEPPED)return 0;n++;let r=0;for(let o=n,h=n+F_.BEZIER_SIZE-1;n<h;n+=2)if(r=s[n],r>=e){let t,i;return n==o?(t=0,i=0):(t=s[n-2],i=s[n-1]),i+(s[n+1]-i)*(e-t)/(r-t)}const a=s[n-1];return a+(1-a)*(e-r)/(1-r)}};let O_=F_;O_.LINEAR=0,O_.STEPPED=1,O_.BEZIER=2,O_.BEZIER_SIZE=19;const N_=class extends O_{constructor(t){super(t),this.frames=Ov.newFloatArray(t<<1)}getPropertyId(){return 0+this.boneIndex}setFrame(t,e,s){t<<=1,this.frames[t]=e,this.frames[t+N_.ROTATION]=s}apply(t,e,s,n,i,r,a){const o=this.frames,h=t.bones[this.boneIndex];if(s<o[0]){switch(r){case uv.setup:return void(h.rotation=h.data.rotation);case uv.first:const t=h.data.rotation-h.rotation;h.rotation+=(t-360*(16384-(16384.499999999996-t/360|0)))*i}return}if(s>=o[o.length-N_.ENTRIES]){let t=o[o.length+N_.PREV_ROTATION];switch(r){case uv.setup:h.rotation=h.data.rotation+t*i;break;case uv.first:case uv.replace:t+=h.data.rotation-h.rotation,t-=360*(16384-(16384.499999999996-t/360|0));case uv.add:h.rotation+=t*i}return}const l=k_.binarySearch(o,s,N_.ENTRIES),c=o[l+N_.PREV_ROTATION],u=o[l],d=this.getCurvePercent((l>>1)-1,1-(s-u)/(o[l+N_.PREV_TIME]-u));let f=o[l+N_.ROTATION]-c;switch(f=c+(f-360*(16384-(16384.499999999996-f/360|0)))*d,r){case uv.setup:h.rotation=h.data.rotation+(f-360*(16384-(16384.499999999996-f/360|0)))*i;break;case uv.first:case uv.replace:f+=h.data.rotation-h.rotation;case uv.add:h.rotation+=(f-360*(16384-(16384.499999999996-f/360|0)))*i}}};let B_=N_;B_.ENTRIES=2,B_.PREV_TIME=-2,B_.PREV_ROTATION=-1,B_.ROTATION=1;const L_=class extends O_{constructor(t){super(t),this.frames=Ov.newFloatArray(t*L_.ENTRIES)}getPropertyId(){return(1<<24)+this.boneIndex}setFrame(t,e,s,n){t*=L_.ENTRIES,this.frames[t]=e,this.frames[t+L_.X]=s,this.frames[t+L_.Y]=n}apply(t,e,s,n,i,r,a){const o=this.frames,h=t.bones[this.boneIndex];if(s<o[0]){switch(r){case uv.setup:return h.x=h.data.x,void(h.y=h.data.y);case uv.first:h.x+=(h.data.x-h.x)*i,h.y+=(h.data.y-h.y)*i}return}let l=0,c=0;if(s>=o[o.length-L_.ENTRIES])l=o[o.length+L_.PREV_X],c=o[o.length+L_.PREV_Y];else{const t=k_.binarySearch(o,s,L_.ENTRIES);l=o[t+L_.PREV_X],c=o[t+L_.PREV_Y];const e=o[t],n=this.getCurvePercent(t/L_.ENTRIES-1,1-(s-e)/(o[t+L_.PREV_TIME]-e));l+=(o[t+L_.X]-l)*n,c+=(o[t+L_.Y]-c)*n}switch(r){case uv.setup:h.x=h.data.x+l*i,h.y=h.data.y+c*i;break;case uv.first:case uv.replace:h.x+=(h.data.x+l-h.x)*i,h.y+=(h.data.y+c-h.y)*i;break;case uv.add:h.x+=l*i,h.y+=c*i}}};let V_=L_;V_.ENTRIES=3,V_.PREV_TIME=-3,V_.PREV_X=-2,V_.PREV_Y=-1,V_.X=1,V_.Y=2;let $_=class t extends V_{constructor(t){super(t)}getPropertyId(){return(2<<24)+this.boneIndex}apply(e,s,n,i,r,a,o){const h=this.frames,l=e.bones[this.boneIndex];if(n<h[0]){switch(a){case uv.setup:return l.scaleX=l.data.scaleX,void(l.scaleY=l.data.scaleY);case uv.first:l.scaleX+=(l.data.scaleX-l.scaleX)*r,l.scaleY+=(l.data.scaleY-l.scaleY)*r}return}let c=0,u=0;if(n>=h[h.length-t.ENTRIES])c=h[h.length+t.PREV_X]*l.data.scaleX,u=h[h.length+t.PREV_Y]*l.data.scaleY;else{const e=k_.binarySearch(h,n,t.ENTRIES);c=h[e+t.PREV_X],u=h[e+t.PREV_Y];const s=h[e],i=this.getCurvePercent(e/t.ENTRIES-1,1-(n-s)/(h[e+t.PREV_TIME]-s));c=(c+(h[e+t.X]-c)*i)*l.data.scaleX,u=(u+(h[e+t.Y]-u)*i)*l.data.scaleY}if(1==r)a==uv.add?(l.scaleX+=c-l.data.scaleX,l.scaleY+=u-l.data.scaleY):(l.scaleX=c,l.scaleY=u);else{let t=0,e=0;if(o==dv.mixOut)switch(a){case uv.setup:t=l.data.scaleX,e=l.data.scaleY,l.scaleX=t+(Math.abs(c)*Pv.signum(t)-t)*r,l.scaleY=e+(Math.abs(u)*Pv.signum(e)-e)*r;break;case uv.first:case uv.replace:t=l.scaleX,e=l.scaleY,l.scaleX=t+(Math.abs(c)*Pv.signum(t)-t)*r,l.scaleY=e+(Math.abs(u)*Pv.signum(e)-e)*r;break;case uv.add:t=l.scaleX,e=l.scaleY,l.scaleX=t+(Math.abs(c)*Pv.signum(t)-l.data.scaleX)*r,l.scaleY=e+(Math.abs(u)*Pv.signum(e)-l.data.scaleY)*r}else switch(a){case uv.setup:t=Math.abs(l.data.scaleX)*Pv.signum(c),e=Math.abs(l.data.scaleY)*Pv.signum(u),l.scaleX=t+(c-t)*r,l.scaleY=e+(u-e)*r;break;case uv.first:case uv.replace:t=Math.abs(l.scaleX)*Pv.signum(c),e=Math.abs(l.scaleY)*Pv.signum(u),l.scaleX=t+(c-t)*r,l.scaleY=e+(u-e)*r;break;case uv.add:t=Pv.signum(c),e=Pv.signum(u),l.scaleX=Math.abs(l.scaleX)*t+(c-Math.abs(l.data.scaleX)*t)*r,l.scaleY=Math.abs(l.scaleY)*e+(u-Math.abs(l.data.scaleY)*e)*r}}}},U_=class t extends V_{constructor(t){super(t)}getPropertyId(){return(3<<24)+this.boneIndex}apply(e,s,n,i,r,a,o){const h=this.frames,l=e.bones[this.boneIndex];if(n<h[0]){switch(a){case uv.setup:return l.shearX=l.data.shearX,void(l.shearY=l.data.shearY);case uv.first:l.shearX+=(l.data.shearX-l.shearX)*r,l.shearY+=(l.data.shearY-l.shearY)*r}return}let c=0,u=0;if(n>=h[h.length-t.ENTRIES])c=h[h.length+t.PREV_X],u=h[h.length+t.PREV_Y];else{const e=k_.binarySearch(h,n,t.ENTRIES);c=h[e+t.PREV_X],u=h[e+t.PREV_Y];const s=h[e],i=this.getCurvePercent(e/t.ENTRIES-1,1-(n-s)/(h[e+t.PREV_TIME]-s));c+=(h[e+t.X]-c)*i,u+=(h[e+t.Y]-u)*i}switch(a){case uv.setup:l.shearX=l.data.shearX+c*r,l.shearY=l.data.shearY+u*r;break;case uv.first:case uv.replace:l.shearX+=(l.data.shearX+c-l.shearX)*r,l.shearY+=(l.data.shearY+u-l.shearY)*r;break;case uv.add:l.shearX+=c*r,l.shearY+=u*r}}};const X_=class extends O_{constructor(t){super(t),this.frames=Ov.newFloatArray(t*X_.ENTRIES)}getPropertyId(){return(5<<24)+this.slotIndex}setFrame(t,e,s,n,i,r){t*=X_.ENTRIES,this.frames[t]=e,this.frames[t+X_.R]=s,this.frames[t+X_.G]=n,this.frames[t+X_.B]=i,this.frames[t+X_.A]=r}apply(t,e,s,n,i,r,a){const o=t.slots[this.slotIndex],h=this.frames;if(s<h[0]){switch(r){case uv.setup:return void o.color.setFromColor(o.data.color);case uv.first:const t=o.color,e=o.data.color;t.add((e.r-t.r)*i,(e.g-t.g)*i,(e.b-t.b)*i,(e.a-t.a)*i)}return}let l=0,c=0,u=0,d=0;if(s>=h[h.length-X_.ENTRIES]){const t=h.length;l=h[t+X_.PREV_R],c=h[t+X_.PREV_G],u=h[t+X_.PREV_B],d=h[t+X_.PREV_A]}else{const t=k_.binarySearch(h,s,X_.ENTRIES);l=h[t+X_.PREV_R],c=h[t+X_.PREV_G],u=h[t+X_.PREV_B],d=h[t+X_.PREV_A];const e=h[t],n=this.getCurvePercent(t/X_.ENTRIES-1,1-(s-e)/(h[t+X_.PREV_TIME]-e));l+=(h[t+X_.R]-l)*n,c+=(h[t+X_.G]-c)*n,u+=(h[t+X_.B]-u)*n,d+=(h[t+X_.A]-d)*n}if(1==i)o.color.set(l,c,u,d);else{const t=o.color;r==uv.setup&&t.setFromColor(o.data.color),t.add((l-t.r)*i,(c-t.g)*i,(u-t.b)*i,(d-t.a)*i)}}};let Y_=X_;Y_.ENTRIES=5,Y_.PREV_TIME=-5,Y_.PREV_R=-4,Y_.PREV_G=-3,Y_.PREV_B=-2,Y_.PREV_A=-1,Y_.R=1,Y_.G=2,Y_.B=3,Y_.A=4;const W_=class extends O_{constructor(t){super(t),this.frames=Ov.newFloatArray(t*W_.ENTRIES)}getPropertyId(){return(14<<24)+this.slotIndex}setFrame(t,e,s,n,i,r,a,o,h){t*=W_.ENTRIES,this.frames[t]=e,this.frames[t+W_.R]=s,this.frames[t+W_.G]=n,this.frames[t+W_.B]=i,this.frames[t+W_.A]=r,this.frames[t+W_.R2]=a,this.frames[t+W_.G2]=o,this.frames[t+W_.B2]=h}apply(t,e,s,n,i,r,a){const o=t.slots[this.slotIndex],h=this.frames;if(s<h[0]){switch(r){case uv.setup:return o.color.setFromColor(o.data.color),void o.darkColor.setFromColor(o.data.darkColor);case uv.first:const t=o.color,e=o.darkColor,s=o.data.color,n=o.data.darkColor;t.add((s.r-t.r)*i,(s.g-t.g)*i,(s.b-t.b)*i,(s.a-t.a)*i),e.add((n.r-e.r)*i,(n.g-e.g)*i,(n.b-e.b)*i,0)}return}let l=0,c=0,u=0,d=0,f=0,p=0,m=0;if(s>=h[h.length-W_.ENTRIES]){const t=h.length;l=h[t+W_.PREV_R],c=h[t+W_.PREV_G],u=h[t+W_.PREV_B],d=h[t+W_.PREV_A],f=h[t+W_.PREV_R2],p=h[t+W_.PREV_G2],m=h[t+W_.PREV_B2]}else{const t=k_.binarySearch(h,s,W_.ENTRIES);l=h[t+W_.PREV_R],c=h[t+W_.PREV_G],u=h[t+W_.PREV_B],d=h[t+W_.PREV_A],f=h[t+W_.PREV_R2],p=h[t+W_.PREV_G2],m=h[t+W_.PREV_B2];const e=h[t],n=this.getCurvePercent(t/W_.ENTRIES-1,1-(s-e)/(h[t+W_.PREV_TIME]-e));l+=(h[t+W_.R]-l)*n,c+=(h[t+W_.G]-c)*n,u+=(h[t+W_.B]-u)*n,d+=(h[t+W_.A]-d)*n,f+=(h[t+W_.R2]-f)*n,p+=(h[t+W_.G2]-p)*n,m+=(h[t+W_.B2]-m)*n}if(1==i)o.color.set(l,c,u,d),o.darkColor.set(f,p,m,1);else{const t=o.color,e=o.darkColor;r==uv.setup&&(t.setFromColor(o.data.color),e.setFromColor(o.data.darkColor)),t.add((l-t.r)*i,(c-t.g)*i,(u-t.b)*i,(d-t.a)*i),e.add((f-e.r)*i,(p-e.g)*i,(m-e.b)*i,0)}}};let j_=W_;j_.ENTRIES=8,j_.PREV_TIME=-8,j_.PREV_R=-7,j_.PREV_G=-6,j_.PREV_B=-5,j_.PREV_A=-4,j_.PREV_R2=-3,j_.PREV_G2=-2,j_.PREV_B2=-1,j_.R=1,j_.G=2,j_.B=3,j_.A=4,j_.R2=5,j_.G2=6,j_.B2=7;let z_=class{constructor(t){this.frames=Ov.newFloatArray(t),this.attachmentNames=new Array(t)}getPropertyId(){return(4<<24)+this.slotIndex}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.attachmentNames[t]=s}apply(t,e,s,n,i,r,a){const o=t.slots[this.slotIndex];if(a==dv.mixOut&&r==uv.setup){const e=o.data.attachmentName;return void o.setAttachment(null==e?null:t.getAttachment(this.slotIndex,e))}const h=this.frames;if(s<h[0]){if(r==uv.setup||r==uv.first){const e=o.data.attachmentName;o.setAttachment(null==e?null:t.getAttachment(this.slotIndex,e))}return}let l=0;l=s>=h[h.length-1]?h.length-1:k_.binarySearch(h,s,1)-1;const c=this.attachmentNames[l];t.slots[this.slotIndex].setAttachment(null==c?null:t.getAttachment(this.slotIndex,c))}},G_=null,H_=class extends O_{constructor(t){super(t),this.frames=Ov.newFloatArray(t),this.frameVertices=new Array(t),null==G_&&(G_=Ov.newFloatArray(64))}getPropertyId(){return(6<<27)+Number(this.attachment.id)+this.slotIndex}setFrame(t,e,s){this.frames[t]=e,this.frameVertices[t]=s}apply(t,e,s,n,i,r,a){const o=t.slots[this.slotIndex],h=o.getAttachment();if(!(h instanceof b_&&h.applyDeform(this.attachment)))return;const l=o.attachmentVertices;0==l.length&&(r=uv.setup);const c=this.frameVertices,u=c[0].length,d=this.frames;if(s<d[0]){const t=h;switch(r){case uv.setup:return void(l.length=0);case uv.first:if(1==i){l.length=0;break}const e=Ov.setArraySize(l,u);if(null==t.bones){const s=t.vertices;for(let t=0;t<u;t++)e[t]+=(s[t]-e[t])*i}else{i=1-i;for(let t=0;t<u;t++)e[t]*=i}}return}const f=Ov.setArraySize(l,u);if(s>=d[d.length-1]){const t=c[d.length-1];if(1==i)if(r==uv.add){const e=h;if(null==e.bones){const s=e.vertices;for(let e=0;e<u;e++)f[e]+=t[e]-s[e]}else for(let s=0;s<u;s++)f[s]+=t[s]}else Ov.arrayCopy(t,0,f,0,u);else switch(r){case uv.setup:{const e=h;if(null==e.bones){const s=e.vertices;for(let e=0;e<u;e++){const n=s[e];f[e]=n+(t[e]-n)*i}}else for(let s=0;s<u;s++)f[s]=t[s]*i;break}case uv.first:case uv.replace:for(let s=0;s<u;s++)f[s]+=(t[s]-f[s])*i;case uv.add:const e=h;if(null==e.bones){const s=e.vertices;for(let e=0;e<u;e++)f[e]+=(t[e]-s[e])*i}else for(let s=0;s<u;s++)f[s]+=t[s]*i}return}const p=k_.binarySearch(d,s),m=c[p-1],g=c[p],y=d[p],v=this.getCurvePercent(p-1,1-(s-y)/(d[p-1]-y));if(1==i)if(r==uv.add){const t=h;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const s=m[t];f[t]+=s+(g[t]-s)*v-e[t]}}else for(let e=0;e<u;e++){const t=m[e];f[e]+=t+(g[e]-t)*v}}else for(let x=0;x<u;x++){const t=m[x];f[x]=t+(g[x]-t)*v}else switch(r){case uv.setup:{const t=h;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const s=m[t],n=e[t];f[t]=n+(s+(g[t]-s)*v-n)*i}}else for(let e=0;e<u;e++){const t=m[e];f[e]=(t+(g[e]-t)*v)*i}break}case uv.first:case uv.replace:for(let e=0;e<u;e++){const t=m[e];f[e]+=(t+(g[e]-t)*v-f[e])*i}break;case uv.add:const t=h;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const s=m[t];f[t]+=(s+(g[t]-s)*v-e[t])*i}}else for(let e=0;e<u;e++){const t=m[e];f[e]+=(t+(g[e]-t)*v)*i}}}},q_=class{constructor(t){this.frames=Ov.newFloatArray(t),this.events=new Array(t)}getPropertyId(){return 7<<24}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,s,n,i,r,a){if(null==n)return;const o=this.frames,h=this.frames.length;if(e>s)this.apply(t,e,Number.MAX_VALUE,n,i,r,a),e=-1;else if(e>=o[h-1])return;if(s<o[0])return;let l=0;if(e<o[0])l=0;else{l=k_.binarySearch(o,e);const t=o[l];for(;l>0&&o[l-1]==t;)l--}for(;l<h&&s>=o[l];l++)n.push(this.events[l])}},K_=class{constructor(t){this.frames=Ov.newFloatArray(t),this.drawOrders=new Array(t)}getPropertyId(){return 8<<24}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.drawOrders[t]=s}apply(t,e,s,n,i,r,a){const o=t.drawOrder,h=t.slots;if(a==dv.mixOut&&r==uv.setup)return void Ov.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);const l=this.frames;if(s<l[0])return void(r!=uv.setup&&r!=uv.first||Ov.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));let c=0;c=s>=l[l.length-1]?l.length-1:k_.binarySearch(l,s)-1;const u=this.drawOrders[c];if(null==u)Ov.arrayCopy(h,0,o,0,h.length);else for(let d=0,f=u.length;d<f;d++)o[d]=h[u[d]]}};const Z_=class extends O_{constructor(t){super(t),this.frames=Ov.newFloatArray(t*Z_.ENTRIES)}getPropertyId(){return(9<<24)+this.ikConstraintIndex}setFrame(t,e,s,n,i,r){t*=Z_.ENTRIES,this.frames[t]=e,this.frames[t+Z_.MIX]=s,this.frames[t+Z_.BEND_DIRECTION]=n,this.frames[t+Z_.COMPRESS]=i?1:0,this.frames[t+Z_.STRETCH]=r?1:0}apply(t,e,s,n,i,r,a){const o=this.frames,h=t.ikConstraints[this.ikConstraintIndex];if(s<o[0]){switch(r){case uv.setup:return h.mix=h.data.mix,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,void(h.stretch=h.data.stretch);case uv.first:h.mix+=(h.data.mix-h.mix)*i,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch}return}if(s>=o[o.length-Z_.ENTRIES])return void(r==uv.setup?(h.mix=h.data.mix+(o[o.length+Z_.PREV_MIX]-h.data.mix)*i,a==dv.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=o[o.length+Z_.PREV_BEND_DIRECTION],h.compress=0!=o[o.length+Z_.PREV_COMPRESS],h.stretch=0!=o[o.length+Z_.PREV_STRETCH])):(h.mix+=(o[o.length+Z_.PREV_MIX]-h.mix)*i,a==dv.mixIn&&(h.bendDirection=o[o.length+Z_.PREV_BEND_DIRECTION],h.compress=0!=o[o.length+Z_.PREV_COMPRESS],h.stretch=0!=o[o.length+Z_.PREV_STRETCH])));const l=k_.binarySearch(o,s,Z_.ENTRIES),c=o[l+Z_.PREV_MIX],u=o[l],d=this.getCurvePercent(l/Z_.ENTRIES-1,1-(s-u)/(o[l+Z_.PREV_TIME]-u));r==uv.setup?(h.mix=h.data.mix+(c+(o[l+Z_.MIX]-c)*d-h.data.mix)*i,a==dv.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=o[l+Z_.PREV_BEND_DIRECTION],h.compress=0!=o[l+Z_.PREV_COMPRESS],h.stretch=0!=o[l+Z_.PREV_STRETCH])):(h.mix+=(c+(o[l+Z_.MIX]-c)*d-h.mix)*i,a==dv.mixIn&&(h.bendDirection=o[l+Z_.PREV_BEND_DIRECTION],h.compress=0!=o[l+Z_.PREV_COMPRESS],h.stretch=0!=o[l+Z_.PREV_STRETCH]))}};let Q_=Z_;Q_.ENTRIES=5,Q_.PREV_TIME=-5,Q_.PREV_MIX=-4,Q_.PREV_BEND_DIRECTION=-3,Q_.PREV_COMPRESS=-2,Q_.PREV_STRETCH=-1,Q_.MIX=1,Q_.BEND_DIRECTION=2,Q_.COMPRESS=3,Q_.STRETCH=4;const J_=class extends O_{constructor(t){super(t),this.frames=Ov.newFloatArray(t*J_.ENTRIES)}getPropertyId(){return(10<<24)+this.transformConstraintIndex}setFrame(t,e,s,n,i,r){t*=J_.ENTRIES,this.frames[t]=e,this.frames[t+J_.ROTATE]=s,this.frames[t+J_.TRANSLATE]=n,this.frames[t+J_.SCALE]=i,this.frames[t+J_.SHEAR]=r}apply(t,e,s,n,i,r,a){const o=this.frames,h=t.transformConstraints[this.transformConstraintIndex];if(s<o[0]){const t=h.data;switch(r){case uv.setup:return h.rotateMix=t.rotateMix,h.translateMix=t.translateMix,h.scaleMix=t.scaleMix,void(h.shearMix=t.shearMix);case uv.first:h.rotateMix+=(t.rotateMix-h.rotateMix)*i,h.translateMix+=(t.translateMix-h.translateMix)*i,h.scaleMix+=(t.scaleMix-h.scaleMix)*i,h.shearMix+=(t.shearMix-h.shearMix)*i}return}let l=0,c=0,u=0,d=0;if(s>=o[o.length-J_.ENTRIES]){const t=o.length;l=o[t+J_.PREV_ROTATE],c=o[t+J_.PREV_TRANSLATE],u=o[t+J_.PREV_SCALE],d=o[t+J_.PREV_SHEAR]}else{const t=k_.binarySearch(o,s,J_.ENTRIES);l=o[t+J_.PREV_ROTATE],c=o[t+J_.PREV_TRANSLATE],u=o[t+J_.PREV_SCALE],d=o[t+J_.PREV_SHEAR];const e=o[t],n=this.getCurvePercent(t/J_.ENTRIES-1,1-(s-e)/(o[t+J_.PREV_TIME]-e));l+=(o[t+J_.ROTATE]-l)*n,c+=(o[t+J_.TRANSLATE]-c)*n,u+=(o[t+J_.SCALE]-u)*n,d+=(o[t+J_.SHEAR]-d)*n}if(r==uv.setup){const t=h.data;h.rotateMix=t.rotateMix+(l-t.rotateMix)*i,h.translateMix=t.translateMix+(c-t.translateMix)*i,h.scaleMix=t.scaleMix+(u-t.scaleMix)*i,h.shearMix=t.shearMix+(d-t.shearMix)*i}else h.rotateMix+=(l-h.rotateMix)*i,h.translateMix+=(c-h.translateMix)*i,h.scaleMix+=(u-h.scaleMix)*i,h.shearMix+=(d-h.shearMix)*i}};let tb=J_;tb.ENTRIES=5,tb.PREV_TIME=-5,tb.PREV_ROTATE=-4,tb.PREV_TRANSLATE=-3,tb.PREV_SCALE=-2,tb.PREV_SHEAR=-1,tb.ROTATE=1,tb.TRANSLATE=2,tb.SCALE=3,tb.SHEAR=4;const eb=class extends O_{constructor(t){super(t),this.frames=Ov.newFloatArray(t*eb.ENTRIES)}getPropertyId(){return(11<<24)+this.pathConstraintIndex}setFrame(t,e,s){t*=eb.ENTRIES,this.frames[t]=e,this.frames[t+eb.VALUE]=s}apply(t,e,s,n,i,r,a){const o=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(s<o[0]){switch(r){case uv.setup:return void(h.position=h.data.position);case uv.first:h.position+=(h.data.position-h.position)*i}return}let l=0;if(s>=o[o.length-eb.ENTRIES])l=o[o.length+eb.PREV_VALUE];else{const t=k_.binarySearch(o,s,eb.ENTRIES);l=o[t+eb.PREV_VALUE];const e=o[t],n=this.getCurvePercent(t/eb.ENTRIES-1,1-(s-e)/(o[t+eb.PREV_TIME]-e));l+=(o[t+eb.VALUE]-l)*n}r==uv.setup?h.position=h.data.position+(l-h.data.position)*i:h.position+=(l-h.position)*i}};let sb=eb;sb.ENTRIES=2,sb.PREV_TIME=-2,sb.PREV_VALUE=-1,sb.VALUE=1;let nb=class t extends sb{constructor(t){super(t)}getPropertyId(){return(12<<24)+this.pathConstraintIndex}apply(e,s,n,i,r,a,o){const h=this.frames,l=e.pathConstraints[this.pathConstraintIndex];if(n<h[0]){switch(a){case uv.setup:return void(l.spacing=l.data.spacing);case uv.first:l.spacing+=(l.data.spacing-l.spacing)*r}return}let c=0;if(n>=h[h.length-t.ENTRIES])c=h[h.length+t.PREV_VALUE];else{const e=k_.binarySearch(h,n,t.ENTRIES);c=h[e+t.PREV_VALUE];const s=h[e],i=this.getCurvePercent(e/t.ENTRIES-1,1-(n-s)/(h[e+t.PREV_TIME]-s));c+=(h[e+t.VALUE]-c)*i}a==uv.setup?l.spacing=l.data.spacing+(c-l.data.spacing)*r:l.spacing+=(c-l.spacing)*r}};const ib=class extends O_{constructor(t){super(t),this.frames=Ov.newFloatArray(t*ib.ENTRIES)}getPropertyId(){return(13<<24)+this.pathConstraintIndex}setFrame(t,e,s,n){t*=ib.ENTRIES,this.frames[t]=e,this.frames[t+ib.ROTATE]=s,this.frames[t+ib.TRANSLATE]=n}apply(t,e,s,n,i,r,a){const o=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(s<o[0]){switch(r){case uv.setup:return h.rotateMix=h.data.rotateMix,void(h.translateMix=h.data.translateMix);case uv.first:h.rotateMix+=(h.data.rotateMix-h.rotateMix)*i,h.translateMix+=(h.data.translateMix-h.translateMix)*i}return}let l=0,c=0;if(s>=o[o.length-ib.ENTRIES])l=o[o.length+ib.PREV_ROTATE],c=o[o.length+ib.PREV_TRANSLATE];else{const t=k_.binarySearch(o,s,ib.ENTRIES);l=o[t+ib.PREV_ROTATE],c=o[t+ib.PREV_TRANSLATE];const e=o[t],n=this.getCurvePercent(t/ib.ENTRIES-1,1-(s-e)/(o[t+ib.PREV_TIME]-e));l+=(o[t+ib.ROTATE]-l)*n,c+=(o[t+ib.TRANSLATE]-c)*n}r==uv.setup?(h.rotateMix=h.data.rotateMix+(l-h.data.rotateMix)*i,h.translateMix=h.data.translateMix+(c-h.data.translateMix)*i):(h.rotateMix+=(l-h.rotateMix)*i,h.translateMix+=(c-h.translateMix)*i)}};let rb=ib;rb.ENTRIES=3,rb.PREV_TIME=-3,rb.PREV_ROTATE=-2,rb.PREV_TRANSLATE=-1,rb.ROTATE=1,rb.TRANSLATE=2;const ab=class{constructor(t){this.tracks=new Array,this.events=new Array,this.listeners=new Array,this.queue=new ub(this),this.propertyIDs=new Tv,this.animationsChanged=!1,this.timeScale=1,this.trackEntryPool=new Nv((()=>new lb)),this.data=t}update(t){t*=this.timeScale;const e=this.tracks;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(null==n)continue;n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast;let i=t*n.timeScale;if(n.delay>0){if(n.delay-=i,n.delay>0)continue;i=-n.delay,n.delay=0}let r=n.next;if(null!=r){const e=n.trackLast-r.delay;if(e>=0){for(r.delay=0,r.trackTime=0==n.timeScale?0:(e/n.timeScale+t)*r.timeScale,n.trackTime+=i,this.setCurrent(s,r,!0);null!=r.mixingFrom;)r.mixTime+=t,r=r.mixingFrom;continue}}else if(n.trackLast>=n.trackEnd&&null==n.mixingFrom){e[s]=null,this.queue.end(n),this.disposeNext(n);continue}if(null!=n.mixingFrom&&this.updateMixingFrom(n,t)){let t=n.mixingFrom;for(n.mixingFrom=null,null!=t&&(t.mixingTo=null);null!=t;)this.queue.end(t),t=t.mixingFrom}n.trackTime+=i}this.queue.drain()}updateMixingFrom(t,e){const s=t.mixingFrom;if(null==s)return!0;const n=this.updateMixingFrom(s,e);return s.animationLast=s.nextAnimationLast,s.trackLast=s.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=s.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=s.mixingFrom,null!=s.mixingFrom&&(s.mixingFrom.mixingTo=t),t.interruptAlpha=s.interruptAlpha,this.queue.end(s)),n):(s.trackTime+=e*s.timeScale,t.mixTime+=e,!1)}apply(t){if(null==t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();const e=this.events,s=this.tracks;let n=!1;for(let i=0,r=s.length;i<r;i++){const r=s[i];if(null==r||r.delay>0)continue;n=!0;const a=0==i?uv.first:r.mixBlend;let o=r.alpha;null!=r.mixingFrom?o*=this.applyMixingFrom(r,t,a):r.trackTime>=r.trackEnd&&null==r.next&&(o=0);const h=r.animationLast,l=r.getAnimationTime(),c=r.animation.timelines.length,u=r.animation.timelines;if(0==i&&1==o||a==uv.add)for(let s=0;s<c;s++)u[s].apply(t,h,l,e,o,a,dv.mixIn);else{const s=r.timelineMode,n=0==r.timelinesRotation.length;n&&Ov.setArraySize(r.timelinesRotation,c<<1,null);const i=r.timelinesRotation;for(let r=0;r<c;r++){const c=u[r],d=s[r]==ab.SUBSEQUENT?a:uv.setup;c instanceof B_?this.applyRotateTimeline(c,t,l,o,d,i,r<<1,n):c.apply(t,h,l,e,o,d,dv.mixIn)}}this.queueEvents(r,l),e.length=0,r.nextAnimationLast=l,r.nextTrackLast=r.trackTime}return this.queue.drain(),n}applyMixingFrom(t,e,s){const n=t.mixingFrom;null!=n.mixingFrom&&this.applyMixingFrom(n,e,s);let i=0;0==t.mixDuration?(i=1,s==uv.first&&(s=uv.setup)):(i=t.mixTime/t.mixDuration,i>1&&(i=1),s!=uv.first&&(s=n.mixBlend));const r=i<n.eventThreshold?this.events:null,a=i<n.attachmentThreshold,o=i<n.drawOrderThreshold,h=n.animationLast,l=n.getAnimationTime(),c=n.animation.timelines.length,u=n.animation.timelines,d=n.alpha*t.interruptAlpha,f=d*(1-i);if(s==uv.add)for(let p=0;p<c;p++)u[p].apply(e,h,l,r,f,s,dv.mixOut);else{const t=n.timelineMode,i=n.timelineHoldMix,p=0==n.timelinesRotation.length;p&&Ov.setArraySize(n.timelinesRotation,c<<1,null);const m=n.timelinesRotation;n.totalAlpha=0;for(let g=0;g<c;g++){const c=u[g];let y,v=dv.mixOut,x=0;switch(t[g]){case ab.SUBSEQUENT:if(!a&&c instanceof z_)continue;if(!o&&c instanceof K_)continue;y=s,x=f;break;case ab.FIRST:y=uv.setup,x=f;break;case ab.HOLD:y=uv.setup,x=d;break;default:y=uv.setup;const t=i[g];x=d*Math.max(0,1-t.mixTime/t.mixDuration)}n.totalAlpha+=x,c instanceof B_?this.applyRotateTimeline(c,e,l,x,y,m,g<<1,p):(y==uv.setup&&(c instanceof z_?a&&(v=dv.mixOut):c instanceof K_&&o&&(v=dv.mixOut)),c.apply(e,h,l,r,x,y,v))}}return t.mixDuration>0&&this.queueEvents(n,l),this.events.length=0,n.nextAnimationLast=l,n.nextTrackLast=n.trackTime,i}applyRotateTimeline(t,e,s,n,i,r,a,o){if(o&&(r[a]=0),1==n)return void t.apply(e,0,s,null,1,i,dv.mixIn);const h=t,l=h.frames,c=e.bones[h.boneIndex];let u=0,d=0;if(s<l[0])switch(i){case uv.setup:c.rotation=c.data.rotation;default:return;case uv.first:u=c.rotation,d=c.data.rotation}else if(u=i==uv.setup?c.data.rotation:c.rotation,s>=l[l.length-B_.ENTRIES])d=c.data.rotation+l[l.length+B_.PREV_ROTATION];else{const t=k_.binarySearch(l,s,B_.ENTRIES),e=l[t+B_.PREV_ROTATION],n=l[t],i=h.getCurvePercent((t>>1)-1,1-(s-n)/(l[t+B_.PREV_TIME]-n));d=l[t+B_.ROTATION]-e,d-=360*(16384-(16384.499999999996-d/360|0)),d=e+d*i+c.data.rotation,d-=360*(16384-(16384.499999999996-d/360|0))}let f=0,p=d-u;if(p-=360*(16384-(16384.499999999996-p/360|0)),0==p)f=r[a];else{let t=0,e=0;o?(t=0,e=p):(t=r[a],e=r[a+1]);const s=p>0;let n=t>=0;Pv.signum(e)!=Pv.signum(p)&&Math.abs(e)<=90&&(Math.abs(t)>180&&(t+=360*Pv.signum(t)),n=s),f=p+t-t%360,n!=s&&(f+=360*Pv.signum(t)),r[a]=f}r[a+1]=p,u+=f*n,c.rotation=u-360*(16384-(16384.499999999996-u/360|0))}queueEvents(t,e){const s=t.animationStart,n=t.animationEnd,i=n-s,r=t.trackLast%i,a=this.events;let o=0;const h=a.length;for(;o<h;o++){const e=a[o];if(e.time<r)break;e.time>n||this.queue.event(t,e)}let l=!1;for(l=t.loop?0==i||r>t.trackTime%i:e>=n&&t.animationLast<n,l&&this.queue.complete(t);o<h;o++){a[o].time<s||this.queue.event(t,a[o])}}clearTracks(){const t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,s=this.tracks.length;e<s;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;const e=this.tracks[t];if(null==e)return;this.queue.end(e),this.disposeNext(e);let s=e;for(;;){const t=s.mixingFrom;if(null==t)break;this.queue.end(t),s.mixingFrom=null,s.mixingTo=null,s=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,s){const n=this.expandToIndex(t);this.tracks[t]=e,null!=n&&(s&&this.queue.interrupt(n),e.mixingFrom=n,n.mixingTo=e,e.mixTime=0,null!=n.mixingFrom&&n.mixDuration>0&&(e.interruptAlpha*=Math.min(1,n.mixTime/n.mixDuration)),n.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,s){const n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error(`Animation not found: ${e}`);return this.setAnimationWith(t,n,s)}setAnimationWith(t,e,s){if(null==e)throw new Error("animation cannot be null.");let n=!0,i=this.expandToIndex(t);null!=i&&(-1==i.nextTrackLast?(this.tracks[t]=i.mixingFrom,this.queue.interrupt(i),this.queue.end(i),this.disposeNext(i),i=i.mixingFrom,n=!1):this.disposeNext(i));const r=this.trackEntry(t,e,s,i);return this.setCurrent(t,r,n),this.queue.drain(),r}addAnimation(t,e,s,n){const i=this.data.skeletonData.findAnimation(e);if(null==i)throw new Error(`Animation not found: ${e}`);return this.addAnimationWith(t,i,s,n)}addAnimationWith(t,e,s,n){if(null==e)throw new Error("animation cannot be null.");let i=this.expandToIndex(t);if(null!=i)for(;null!=i.next;)i=i.next;const r=this.trackEntry(t,e,s,i);if(null==i)this.setCurrent(t,r,!0),this.queue.drain();else if(i.next=r,n<=0){const t=i.animationEnd-i.animationStart;0!=t?(i.loop?n+=t*(1+(i.trackTime/t|0)):n+=Math.max(t,i.trackTime),n-=this.data.getMix(i.animation,e)):n=i.trackTime}return r.delay=n,r}setEmptyAnimation(t,e){const s=this.setAnimationWith(t,ab.emptyAnimation,!1);return s.mixDuration=e,s.trackEnd=e,s}addEmptyAnimation(t,e,s){s<=0&&(s-=e);const n=this.addAnimationWith(t,ab.emptyAnimation,!1,s);return n.mixDuration=e,n.trackEnd=e,n}setEmptyAnimations(t){const e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let s=0,n=this.tracks.length;s<n;s++){const e=this.tracks[s];null!=e&&this.setEmptyAnimation(e.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(Ov.ensureArrayCapacity(this.tracks,t-this.tracks.length+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,s,n){const i=this.trackEntryPool.obtain();return i.trackIndex=t,i.animation=e,i.loop=s,i.holdPrevious=!1,i.eventThreshold=0,i.attachmentThreshold=0,i.drawOrderThreshold=0,i.animationStart=0,i.animationEnd=e.duration,i.animationLast=-1,i.nextAnimationLast=-1,i.delay=0,i.trackTime=0,i.trackLast=-1,i.nextTrackLast=-1,i.trackEnd=Number.MAX_VALUE,i.timeScale=1,i.alpha=1,i.interruptAlpha=1,i.mixTime=0,i.mixDuration=null==n?0:this.data.getMix(n.animation,e),i}disposeNext(t){let e=t.next;for(;null!=e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();for(let t=0,e=this.tracks.length;t<e;t++){let e=this.tracks[t];if(null!=e){for(;null!=e.mixingFrom;)e=e.mixingFrom;do{null!=e.mixingFrom&&e.mixBlend==uv.add||this.setTimelineModes(e),e=e.mixingTo}while(null!=e)}}}setTimelineModes(t){const e=t.mixingTo,s=t.animation.timelines,n=t.animation.timelines.length,i=Ov.setArraySize(t.timelineMode,n);t.timelineHoldMix.length=0;const r=Ov.setArraySize(t.timelineHoldMix,n),a=this.propertyIDs;if(null!=e&&e.holdPrevious)for(let o=0;o<n;o++)a.add(s[o].getPropertyId()),i[o]=ab.HOLD;else t:for(let o=0;o<n;o++){const n=s[o].getPropertyId();if(a.add(n))if(null!=e&&this.hasTimeline(e,n)){for(let s=e.mixingTo;null!=s;s=s.mixingTo)if(!this.hasTimeline(s,n)){if(t.mixDuration>0){i[o]=ab.HOLD_MIX,r[o]=s;continue t}break}i[o]=ab.HOLD}else i[o]=ab.FIRST;else i[o]=ab.SUBSEQUENT}}hasTimeline(t,e){const s=t.animation.timelines;for(let n=0,i=s.length;n<i;n++)if(s[n].getPropertyId()==e)return!0;return!1}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){const e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}setAnimationByName(t,e,s){ab.deprecatedWarning1||(ab.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")),this.setAnimation(t,e,s)}addAnimationByName(t,e,s,n){ab.deprecatedWarning2||(ab.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")),this.addAnimation(t,e,s,n)}hasAnimation(t){return null!==this.data.skeletonData.findAnimation(t)}hasAnimationByName(t){return ab.deprecatedWarning3||(ab.deprecatedWarning3=!0,console.warn("Spine Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")),this.hasAnimation(t)}};let ob=ab;ob.emptyAnimation=new k_("<empty>",[],0),ob.SUBSEQUENT=0,ob.FIRST=1,ob.HOLD=2,ob.HOLD_MIX=3,ob.deprecatedWarning1=!1,ob.deprecatedWarning2=!1,ob.deprecatedWarning3=!1;const hb=class{constructor(){this.mixBlend=uv.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){const t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}get time(){return hb.deprecatedWarning1||(hb.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime}set time(t){hb.deprecatedWarning1||(hb.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime=t}get endTime(){return hb.deprecatedWarning2||(hb.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime}set endTime(t){hb.deprecatedWarning2||(hb.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime=t}loopsCount(){return Math.floor(this.trackTime/this.trackEnd)}};let lb=hb;lb.deprecatedWarning1=!1,lb.deprecatedWarning2=!1;const cb=class{constructor(t){this.objects=[],this.drainDisabled=!1,this.animState=t}start(t){this.objects.push(db.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(db.interrupt),this.objects.push(t)}end(t){this.objects.push(db.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(db.dispose),this.objects.push(t)}complete(t){this.objects.push(db.complete),this.objects.push(t)}event(t,e){this.objects.push(db.event),this.objects.push(t),this.objects.push(e)}deprecateStuff(){return cb.deprecatedWarning1||(cb.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: onComplete, onStart, onEnd, onEvent art deprecated, please use listeners from now on. 'state.addListener({ complete: function(track, event) { } })'")),!0}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;const t=this.objects,e=this.animState.listeners;for(let s=0;s<t.length;s+=2){const n=t[s],i=t[s+1];switch(n){case db.start:null!=i.listener&&i.listener.start&&i.listener.start(i);for(let t=0;t<e.length;t++)e[t].start&&e[t].start(i);i.onStart&&this.deprecateStuff()&&i.onStart(i.trackIndex),this.animState.onStart&&this.deprecateStuff()&&this.deprecateStuff&&this.animState.onStart(i.trackIndex);break;case db.interrupt:null!=i.listener&&i.listener.interrupt&&i.listener.interrupt(i);for(let t=0;t<e.length;t++)e[t].interrupt&&e[t].interrupt(i);break;case db.end:null!=i.listener&&i.listener.end&&i.listener.end(i);for(let t=0;t<e.length;t++)e[t].end&&e[t].end(i);i.onEnd&&this.deprecateStuff()&&i.onEnd(i.trackIndex),this.animState.onEnd&&this.deprecateStuff()&&this.animState.onEnd(i.trackIndex);case db.dispose:null!=i.listener&&i.listener.dispose&&i.listener.dispose(i);for(let t=0;t<e.length;t++)e[t].dispose&&e[t].dispose(i);this.animState.trackEntryPool.free(i);break;case db.complete:null!=i.listener&&i.listener.complete&&i.listener.complete(i);for(let t=0;t<e.length;t++)e[t].complete&&e[t].complete(i);const n=Pv.toInt(i.loopsCount());i.onComplete&&this.deprecateStuff()&&i.onComplete(i.trackIndex,n),this.animState.onComplete&&this.deprecateStuff()&&this.animState.onComplete(i.trackIndex,n);break;case db.event:const r=t[2+s++];null!=i.listener&&i.listener.event&&i.listener.event(i,r);for(let t=0;t<e.length;t++)e[t].event&&e[t].event(i,r);i.onEvent&&this.deprecateStuff()&&i.onEvent(i.trackIndex,r),this.animState.onEvent&&this.deprecateStuff()&&this.animState.onEvent(i.trackIndex,r)}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}};let ub=cb;ub.deprecatedWarning1=!1;var db=(t=>(t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event",t))(db||{});const fb=class{constructor(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,s){const n=this.skeletonData.findAnimation(t);if(null==n)throw new Error(`Animation not found: ${t}`);const i=this.skeletonData.findAnimation(e);if(null==i)throw new Error(`Animation not found: ${e}`);this.setMixWith(n,i,s)}setMixByName(t,e,s){fb.deprecatedWarning1||(fb.deprecatedWarning1=!0,console.warn("Deprecation Warning: AnimationStateData.setMixByName is deprecated, please use setMix from now on.")),this.setMix(t,e,s)}setMixWith(t,e,s){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");const n=`${t.name}.${e.name}`;this.animationToMixTime[n]=s}getMix(t,e){const s=`${t.name}.${e.name}`,n=this.animationToMixTime[s];return void 0===n?this.defaultMix:n}};let pb=fb;pb.deprecatedWarning1=!1;let mb=class{constructor(t){this.atlas=t}newRegionAttachment(t,e,s){const n=this.atlas.findRegion(s);if(null==n)throw new Error(`Region not found in atlas: ${s} (region attachment: ${e})`);const i=new I_(e);return i.region=n,i}newMeshAttachment(t,e,s){const n=this.atlas.findRegion(s);if(null==n)throw new Error(`Region not found in atlas: ${s} (mesh attachment: ${e})`);const i=new S_(e);return i.region=n,i}newBoundingBoxAttachment(t,e){return new w_(e)}newPathAttachment(t,e){return new T_(e)}newPointAttachment(t,e){return new A_(e)}newClippingAttachment(t,e){return new E_(e)}},gb=class{constructor(t,e,s){if(this.matrix=new Ch,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.sorted=!1,this.active=!0,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=s,this.setToSetupPose()}get worldX(){return this.matrix.tx}get worldY(){return this.matrix.ty}update(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,s,n,i,r,a){this.ax=t,this.ay=e,this.arotation=s,this.ascaleX=n,this.ascaleY=i,this.ashearX=r,this.ashearY=a,this.appliedValid=!0;const o=this.parent,h=this.matrix,l=this.skeleton.scaleX,c=-this.skeleton.scaleY;if(null==o){const o=this.skeleton,u=s+90+a;return h.a=Pv.cosDeg(s+r)*n*l,h.c=Pv.cosDeg(u)*i*l,h.b=Pv.sinDeg(s+r)*n*c,h.d=Pv.sinDeg(u)*i*c,h.tx=t*l+o.x,void(h.ty=e*c+o.y)}let u=o.matrix.a,d=o.matrix.c,f=o.matrix.b,p=o.matrix.d;switch(h.tx=u*t+d*e+o.matrix.tx,h.ty=f*t+p*e+o.matrix.ty,this.data.transformMode){case mv.Normal:{const t=s+90+a,e=Pv.cosDeg(s+r)*n,o=Pv.cosDeg(t)*i,l=Pv.sinDeg(s+r)*n,c=Pv.sinDeg(t)*i;return h.a=u*e+d*l,h.c=u*o+d*c,h.b=f*e+p*l,void(h.d=f*o+p*c)}case mv.OnlyTranslation:{const t=s+90+a;h.a=Pv.cosDeg(s+r)*n,h.c=Pv.cosDeg(t)*i,h.b=Pv.sinDeg(s+r)*n,h.d=Pv.sinDeg(t)*i;break}case mv.NoRotationOrReflection:{let t=u*u+f*f,e=0;t>1e-4?(t=Math.abs(u*p-d*f)/t,d=f*t,p=u*t,e=Math.atan2(f,u)*Pv.radDeg):(u=0,f=0,e=90-Math.atan2(p,d)*Pv.radDeg);const o=s+r-e,l=s+a-e+90,c=Pv.cosDeg(o)*n,m=Pv.cosDeg(l)*i,g=Pv.sinDeg(o)*n,y=Pv.sinDeg(l)*i;h.a=u*c-d*g,h.c=u*m-d*y,h.b=f*c+p*g,h.d=f*m+p*y;break}case mv.NoScale:case mv.NoScaleOrReflection:{const t=Pv.cosDeg(s),e=Pv.sinDeg(s);let o=(u*t+d*e)/l,m=(f*t+p*e)/c,g=Math.sqrt(o*o+m*m);g>1e-5&&(g=1/g),o*=g,m*=g,g=Math.sqrt(o*o+m*m),this.data.transformMode==mv.NoScale&&u*p-d*f<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY>0)&&(g=-g);const y=Math.PI/2+Math.atan2(m,o),v=Math.cos(y)*g,x=Math.sin(y)*g,_=Pv.cosDeg(r)*n,b=Pv.cosDeg(90+a)*i,w=Pv.sinDeg(r)*n,E=Pv.sinDeg(90+a)*i;h.a=o*_+v*w,h.c=o*b+v*E,h.b=m*_+x*w,h.d=m*b+x*E;break}}h.a*=l,h.c*=l,h.b*=c,h.d*=c}setToSetupPose(){const t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.matrix.b,this.matrix.a)*Pv.radDeg}getWorldRotationY(){return Math.atan2(this.matrix.d,this.matrix.c)*Pv.radDeg}getWorldScaleX(){const t=this.matrix;return Math.sqrt(t.a*t.a+t.c*t.c)}getWorldScaleY(){const t=this.matrix;return Math.sqrt(t.b*t.b+t.d*t.d)}updateAppliedTransform(){this.appliedValid=!0;const t=this.parent,e=this.matrix;if(null==t)return this.ax=e.tx,this.ay=e.ty,this.arotation=Math.atan2(e.b,e.a)*Pv.radDeg,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*Pv.radDeg);const s=t.matrix,n=1/(s.a*s.d-s.b*s.c),i=e.tx-s.tx,r=e.ty-s.ty;this.ax=i*s.d*n-r*s.c*n,this.ay=r*s.a*n-i*s.b*n;const a=n*s.d,o=n*s.a,h=n*s.c,l=n*s.b,c=a*e.a-h*e.b,u=a*e.c-h*e.d,d=o*e.b-l*e.a,f=o*e.d-l*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(c*c+d*d),this.ascaleX>1e-4){const t=c*f-u*d;this.ascaleY=t/this.ascaleX,this.ashearY=Math.atan2(c*u+d*f,t)*Pv.radDeg,this.arotation=Math.atan2(d,c)*Pv.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(u*u+f*f),this.ashearY=0,this.arotation=90-Math.atan2(f,u)*Pv.radDeg}worldToLocal(t){const e=this.matrix,s=e.a,n=e.c,i=e.b,r=e.d,a=1/(s*r-n*i),o=t.x-e.tx,h=t.y-e.ty;return t.x=o*r*a-h*n*a,t.y=h*s*a-o*i*a,t}localToWorld(t){const e=this.matrix,s=t.x,n=t.y;return t.x=s*e.a+n*e.c+e.tx,t.y=s*e.b+n*e.d+e.ty,t}worldToLocalRotation(t){const e=Pv.sinDeg(t),s=Pv.cosDeg(t),n=this.matrix;return Math.atan2(n.a*e-n.b*s,n.d*s-n.c*e)*Pv.radDeg}localToWorldRotation(t){const e=Pv.sinDeg(t),s=Pv.cosDeg(t),n=this.matrix;return Math.atan2(s*n.b+e*n.d,s*n.a+e*n.c)*Pv.radDeg}rotateWorld(t){const e=this.matrix,s=e.a,n=e.c,i=e.b,r=e.d,a=Pv.cosDeg(t),o=Pv.sinDeg(t);e.a=a*s-o*i,e.c=a*n-o*r,e.b=o*s+a*i,e.d=o*n+a*r,this.appliedValid=!1}},yb=class{constructor(t,e,s){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=mv.Normal,t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=s}},vb=class{constructor(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e}},xb=class{constructor(t){this.name=t}},_b=class{constructor(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let s=0;s<t.bones.length;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findBone(t.target.name)}getOrder(){return this.data.order}apply(){this.update()}update(){const t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.mix)}}apply1(t,e,s,n,i,r,a){t.appliedValid||t.updateAppliedTransform();const o=t.parent.matrix,h=1/(o.a*o.d-o.b*o.c),l=e-o.tx,c=s-o.ty,u=(l*o.d-c*o.c)*h-t.ax,d=(c*o.a-l*o.b)*h-t.ay;let f=Math.atan2(d,u)*Pv.radDeg-t.ashearX-t.arotation;t.ascaleX<0&&(f+=180),f>180?f-=360:f<-180&&(f+=360);let p=t.ascaleX,m=t.ascaleY;if(n||i){const e=t.data.length*p,s=Math.sqrt(u*u+d*d);if(n&&s<e||i&&s>e&&e>1e-4){const t=(s/e-1)*a+1;p*=t,r&&(m*=t)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+f*a,p,m,t.ashearX,t.ashearY)}apply2(t,e,s,n,i,r,a){if(0==a)return void e.updateWorldTransform();t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();const o=t.ax,h=t.ay;let l=t.ascaleX,c=l,u=t.ascaleY,d=e.ascaleX;const f=t.matrix;let p=0,m=0,g=0;l<0?(l=-l,p=180,g=-1):(p=0,g=1),u<0&&(u=-u,g=-g),d<0?(d=-d,m=180):m=0;const y=e.ax;let v=0,x=0,_=0,b=f.a,w=f.c,E=f.b,S=f.d;const T=Math.abs(l-u)<=1e-4;T?(v=e.ay,x=b*y+w*v+f.tx,_=E*y+S*v+f.ty):(v=0,x=b*y+f.tx,_=E*y+f.ty);const A=t.parent.matrix;b=A.a,w=A.c,E=A.b,S=A.d;const C=1/(b*S-w*E);let M=s-A.tx,I=n-A.ty;const P=(M*S-I*w)*C-o,R=(I*b-M*E)*C-h,k=P*P+R*R;M=x-A.tx,I=_-A.ty;const D=(M*S-I*w)*C-o,F=(I*b-M*E)*C-h,O=Math.sqrt(D*D+F*F);let N=e.data.length*d,B=0,L=0;t:if(T){N*=l;let t=(k-O*O-N*N)/(2*O*N);t<-1?t=-1:t>1&&(t=1,r&&O+N>1e-4&&(c*=(Math.sqrt(k)/(O+N)-1)*a+1)),L=Math.acos(t)*i,b=O+N*t,w=N*Math.sin(L),B=Math.atan2(R*b-P*w,P*b+R*w)}else{b=l*N,w=u*N;const t=b*b,e=w*w,s=Math.atan2(R,P);E=e*O*O+t*k-t*e;const n=-2*e*O,r=e-t;if(S=n*n-4*r*E,S>=0){let t=Math.sqrt(S);n<0&&(t=-t),t=-(n+t)/2;const e=t/r,a=E/t,o=Math.abs(e)<Math.abs(a)?e:a;if(o*o<=k){I=Math.sqrt(k-o*o)*i,B=s-Math.atan2(I,o),L=Math.atan2(I/u,(o-O)/l);break t}}let a=Pv.PI,o=O-b,h=o*o,c=0,d=0,f=O+b,p=f*f,m=0;E=-b*O/(t-e),E>=-1&&E<=1&&(E=Math.acos(E),M=b*Math.cos(E)+O,I=w*Math.sin(E),S=M*M+I*I,S<h&&(a=E,h=S,o=M,c=I),S>p&&(d=E,p=S,f=M,m=I)),k<=(h+p)/2?(B=s-Math.atan2(c*i,o),L=a*i):(B=s-Math.atan2(m*i,f),L=d*i)}const V=Math.atan2(v,y)*g;let $=t.arotation;B=(B-V)*Pv.radDeg+p-$,B>180?B-=360:B<-180&&(B+=360),t.updateWorldTransformWith(o,h,$+B*a,c,t.ascaleY,0,0),$=e.arotation,L=((L+V)*Pv.radDeg-e.ashearX)*g+m-$,L>180?L-=360:L<-180&&(L+=360),e.updateWorldTransformWith(y,v,$+L*a,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}},bb=class{constructor(t){this.order=0,this.bones=new Array,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.name=t}},wb=class{constructor(t){this.order=0,this.bones=new Array,this.name=t}};var Eb=(t=>(t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent",t))(Eb||{});const Sb=class{constructor(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let s=0,n=t.bones.length;s<n;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}apply(){this.update()}update(){const t=this.target.getAttachment();if(!(t instanceof T_))return;const e=this.rotateMix,s=this.translateMix,n=e>0;if(!(s>0)&&!n)return;const i=this.data,r=i.spacingMode,a=r==Eb.Length,o=i.rotateMode,h=o==pv.Tangent,l=o==pv.ChainScale,c=this.bones.length,u=h?c:c+1,d=this.bones,f=Ov.setArraySize(this.spaces,u);let p=null;const m=this.spacing;if(l||a){l&&(p=Ov.setArraySize(this.lengths,c));for(let t=0,e=u-1;t<e;){const e=d[t],s=e.data.length;if(s<Sb.epsilon)l&&(p[t]=0),f[++t]=0;else{const n=s*e.matrix.a,i=s*e.matrix.b,r=Math.sqrt(n*n+i*i);l&&(p[t]=r),f[++t]=(a?s+m:m)*r/s}}}else for(let b=1;b<u;b++)f[b]=m;const g=this.computeWorldPositions(t,u,h,i.positionMode==fv.Percent,r==Eb.Percent);let y=g[0],v=g[1],x=i.offsetRotation,_=!1;if(0==x)_=o==pv.Chain;else{_=!1;const t=this.target.bone.matrix;x*=t.a*t.d-t.b*t.c>0?Pv.degRad:-Pv.degRad}for(let b=0,w=3;b<c;b++,w+=3){const t=d[b],i=t.matrix;i.tx+=(y-i.tx)*s,i.ty+=(v-i.ty)*s;const r=g[w],a=g[w+1],o=r-y,c=a-v;if(l){const t=p[b];if(0!=t){const s=(Math.sqrt(o*o+c*c)/t-1)*e+1;i.a*=s,i.b*=s}}if(y=r,v=a,n){const s=i.a,n=i.c,r=i.b,a=i.d;let l=0,u=0,d=0;if(h&&(l=h?g[w-1]:0==f[b+1]?g[w+2]:Math.atan2(c,o)),l-=Math.atan2(r,s),_){u=Math.cos(l),d=Math.sin(l);const n=t.data.length;y+=(n*(u*s-d*r)-o)*e,v+=(n*(d*s+u*r)-c)*e}else l+=x;l>Pv.PI?l-=Pv.PI2:l<-Pv.PI&&(l+=Pv.PI2),l*=e,u=Math.cos(l),d=Math.sin(l),i.a=u*s-d*r,i.c=u*n-d*a,i.b=d*s+u*r,i.d=d*n+u*a}t.appliedValid=!1}}computeWorldPositions(t,e,s,n,i){const r=this.target;let a=this.position;const o=this.spaces,h=Ov.setArraySize(this.positions,3*e+2);let l=null;const c=t.closed;let u=t.worldVerticesLength,d=u/6,f=Sb.NONE;if(!t.constantSpeed){const p=t.lengths;d-=c?1:2;const m=p[d];if(n&&(a*=m),i)for(let t=0;t<e;t++)o[t]*=m;l=Ov.setArraySize(this.world,8);for(let n=0,i=0,g=0;n<e;n++,i+=3){const e=o[n];a+=e;let y=a;if(c)y%=m,y<0&&(y+=m),g=0;else{if(y<0){f!=Sb.BEFORE&&(f=Sb.BEFORE,t.computeWorldVertices(r,2,4,l,0,2)),this.addBeforePosition(y,l,0,h,i);continue}if(y>m){f!=Sb.AFTER&&(f=Sb.AFTER,t.computeWorldVertices(r,u-6,4,l,0,2)),this.addAfterPosition(y-m,l,0,h,i);continue}}for(;;g++){const t=p[g];if(!(y>t)){if(0==g)y/=t;else{const e=p[g-1];y=(y-e)/(t-e)}break}}g!=f&&(f=g,c&&g==d?(t.computeWorldVertices(r,u-4,4,l,0,2),t.computeWorldVertices(r,0,4,l,4,2)):t.computeWorldVertices(r,6*g+2,8,l,0,2)),this.addCurvePosition(y,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],h,i,s||n>0&&0==e)}return h}c?(u+=2,l=Ov.setArraySize(this.world,u),t.computeWorldVertices(r,2,u-4,l,0,2),t.computeWorldVertices(r,0,2,l,u-4,2),l[u-2]=l[0],l[u-1]=l[1]):(d--,u-=4,l=Ov.setArraySize(this.world,u),t.computeWorldVertices(r,2,u,l,0,2));const p=Ov.setArraySize(this.curves,d);let m=0,g=l[0],y=l[1],v=0,x=0,_=0,b=0,w=0,E=0,S=0,T=0,A=0,C=0,M=0,I=0,P=0,R=0;for(let F=0,O=2;F<d;F++,O+=6)v=l[O],x=l[O+1],_=l[O+2],b=l[O+3],w=l[O+4],E=l[O+5],S=.1875*(g-2*v+_),T=.1875*(y-2*x+b),A=.09375*(3*(v-_)-g+w),C=.09375*(3*(x-b)-y+E),M=2*S+A,I=2*T+C,P=.75*(v-g)+S+.16666667*A,R=.75*(x-y)+T+.16666667*C,m+=Math.sqrt(P*P+R*R),P+=M,R+=I,M+=A,I+=C,m+=Math.sqrt(P*P+R*R),P+=M,R+=I,m+=Math.sqrt(P*P+R*R),P+=M+A,R+=I+C,m+=Math.sqrt(P*P+R*R),p[F]=m,g=w,y=E;if(n&&(a*=m),i)for(let F=0;F<e;F++)o[F]*=m;const k=this.segments;let D=0;for(let F=0,O=0,N=0,B=0;F<e;F++,O+=3){const t=o[F];a+=t;let e=a;if(c)e%=m,e<0&&(e+=m),N=0;else{if(e<0){this.addBeforePosition(e,l,0,h,O);continue}if(e>m){this.addAfterPosition(e-m,l,u-4,h,O);continue}}for(;;N++){const t=p[N];if(!(e>t)){if(0==N)e/=t;else{const s=p[N-1];e=(e-s)/(t-s)}break}}if(N!=f){f=N;let t=6*N;for(g=l[t],y=l[t+1],v=l[t+2],x=l[t+3],_=l[t+4],b=l[t+5],w=l[t+6],E=l[t+7],S=.03*(g-2*v+_),T=.03*(y-2*x+b),A=.006*(3*(v-_)-g+w),C=.006*(3*(x-b)-y+E),M=2*S+A,I=2*T+C,P=.3*(v-g)+S+.16666667*A,R=.3*(x-y)+T+.16666667*C,D=Math.sqrt(P*P+R*R),k[0]=D,t=1;t<8;t++)P+=M,R+=I,M+=A,I+=C,D+=Math.sqrt(P*P+R*R),k[t]=D;P+=M,R+=I,D+=Math.sqrt(P*P+R*R),k[8]=D,P+=M+A,R+=I+C,D+=Math.sqrt(P*P+R*R),k[9]=D,B=0}for(e*=D;;B++){const t=k[B];if(!(e>t)){if(0==B)e/=t;else{const s=k[B-1];e=B+(e-s)/(t-s)}break}}this.addCurvePosition(.1*e,g,y,v,x,_,b,w,E,h,O,s||F>0&&0==t)}return h}addBeforePosition(t,e,s,n,i){const r=e[s],a=e[s+1],o=e[s+2]-r,h=e[s+3]-a,l=Math.atan2(h,o);n[i]=r+t*Math.cos(l),n[i+1]=a+t*Math.sin(l),n[i+2]=l}addAfterPosition(t,e,s,n,i){const r=e[s+2],a=e[s+3],o=r-e[s],h=a-e[s+1],l=Math.atan2(h,o);n[i]=r+t*Math.cos(l),n[i+1]=a+t*Math.sin(l),n[i+2]=l}addCurvePosition(t,e,s,n,i,r,a,o,h,l,c,u){(0==t||isNaN(t))&&(t=1e-4);const d=t*t,f=d*t,p=1-t,m=p*p,g=m*p,y=p*t,v=3*y,x=p*v,_=v*t,b=e*g+n*x+r*_+o*f,w=s*g+i*x+a*_+h*f;l[c]=b,l[c+1]=w,u&&(l[c+2]=Math.atan2(w-(s*m+i*y*2+a*d),b-(e*m+n*y*2+r*d)))}getOrder(){return this.data.order}};let Tb=Sb;Tb.NONE=-1,Tb.BEFORE=-2,Tb.AFTER=-3,Tb.epsilon=1e-5;let Ab=class{constructor(t,e){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new Bv,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array;for(let s=0;s<t.bones.length;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findBone(t.target.name)}apply(){this.update()}update(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()}applyAbsoluteWorld(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,n=this.shearMix,i=this.target,r=i.matrix,a=r.a,o=r.c,h=r.b,l=r.d,c=a*l-o*h>0?Pv.degRad:-Pv.degRad,u=this.data.offsetRotation*c,d=this.data.offsetShearY*c,f=this.bones;for(let p=0,m=f.length;p<m;p++){const r=f[p];let c=!1;const m=r.matrix;if(0!=t){const e=m.a,s=m.c,n=m.b,i=m.d;let r=Math.atan2(h,a)-Math.atan2(n,e)+u;r>Pv.PI?r-=Pv.PI2:r<-Pv.PI&&(r+=Pv.PI2),r*=t;const o=Math.cos(r),l=Math.sin(r);m.a=o*e-l*n,m.c=o*s-l*i,m.b=l*e+o*n,m.d=l*s+o*i,c=!0}if(0!=e){const t=this.temp;i.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=(t.x-m.tx)*e,m.ty+=(t.y-m.ty)*e,c=!0}if(s>0){let t=Math.sqrt(m.a*m.a+m.b*m.b),e=Math.sqrt(a*a+h*h);t>1e-5&&(t=(t+(e-t+this.data.offsetScaleX)*s)/t),m.a*=t,m.b*=t,t=Math.sqrt(m.c*m.c+m.d*m.d),e=Math.sqrt(o*o+l*l),t>1e-5&&(t=(t+(e-t+this.data.offsetScaleY)*s)/t),m.c*=t,m.d*=t,c=!0}if(n>0){const t=m.c,e=m.d,s=Math.atan2(e,t);let i=Math.atan2(l,o)-Math.atan2(h,a)-(s-Math.atan2(m.b,m.a));i>Pv.PI?i-=Pv.PI2:i<-Pv.PI&&(i+=Pv.PI2),i=s+(i+d)*n;const r=Math.sqrt(t*t+e*e);m.c=Math.cos(i)*r,m.d=Math.sin(i)*r,c=!0}c&&(r.appliedValid=!1)}}applyRelativeWorld(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,n=this.shearMix,i=this.target,r=i.matrix,a=r.a,o=r.c,h=r.b,l=r.d,c=a*l-o*h>0?Pv.degRad:-Pv.degRad,u=this.data.offsetRotation*c,d=this.data.offsetShearY*c,f=this.bones;for(let p=0,m=f.length;p<m;p++){const r=f[p];let c=!1;const m=r.matrix;if(0!=t){const e=m.a,s=m.c,n=m.b,i=m.d;let r=Math.atan2(h,a)+u;r>Pv.PI?r-=Pv.PI2:r<-Pv.PI&&(r+=Pv.PI2),r*=t;const o=Math.cos(r),l=Math.sin(r);m.a=o*e-l*n,m.c=o*s-l*i,m.b=l*e+o*n,m.d=l*s+o*i,c=!0}if(0!=e){const t=this.temp;i.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=t.x*e,m.ty+=t.y*e,c=!0}if(s>0){let t=(Math.sqrt(a*a+h*h)-1+this.data.offsetScaleX)*s+1;m.a*=t,m.b*=t,t=(Math.sqrt(o*o+l*l)-1+this.data.offsetScaleY)*s+1,m.c*=t,m.d*=t,c=!0}if(n>0){let t=Math.atan2(l,o)-Math.atan2(h,a);t>Pv.PI?t-=Pv.PI2:t<-Pv.PI&&(t+=Pv.PI2);const e=m.c,s=m.d;t=Math.atan2(s,e)+(t-Pv.PI/2+d)*n;const i=Math.sqrt(e*e+s*s);m.c=Math.cos(t)*i,m.d=Math.sin(t)*i,c=!0}c&&(r.appliedValid=!1)}}applyAbsoluteLocal(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,n=this.shearMix,i=this.target;i.appliedValid||i.updateAppliedTransform();const r=this.bones;for(let a=0,o=r.length;a<o;a++){const o=r[a];o.appliedValid||o.updateAppliedTransform();let h=o.arotation;if(0!=t){let e=i.arotation-h+this.data.offsetRotation;e-=360*(16384-(16384.499999999996-e/360|0)),h+=e*t}let l=o.ax,c=o.ay;0!=e&&(l+=(i.ax-l+this.data.offsetX)*e,c+=(i.ay-c+this.data.offsetY)*e);let u=o.ascaleX,d=o.ascaleY;s>0&&(u>1e-5&&(u=(u+(i.ascaleX-u+this.data.offsetScaleX)*s)/u),d>1e-5&&(d=(d+(i.ascaleY-d+this.data.offsetScaleY)*s)/d));const f=o.ashearY;if(n>0){let t=i.ashearY-f+this.data.offsetShearY;t-=360*(16384-(16384.499999999996-t/360|0)),o.shearY+=t*n}o.updateWorldTransformWith(l,c,h,u,d,o.ashearX,f)}}applyRelativeLocal(){const t=this.rotateMix,e=this.translateMix,s=this.scaleMix,n=this.shearMix,i=this.target;i.appliedValid||i.updateAppliedTransform();const r=this.bones;for(let a=0,o=r.length;a<o;a++){const o=r[a];o.appliedValid||o.updateAppliedTransform();let h=o.arotation;0!=t&&(h+=(i.arotation+this.data.offsetRotation)*t);let l=o.ax,c=o.ay;0!=e&&(l+=(i.ax+this.data.offsetX)*e,c+=(i.ay+this.data.offsetY)*e);let u=o.ascaleX,d=o.ascaleY;s>0&&(u>1e-5&&(u*=(i.ascaleX-1+this.data.offsetScaleX)*s+1),d>1e-5&&(d*=(i.ascaleY-1+this.data.offsetScaleY)*s+1));let f=o.ashearY;n>0&&(f+=(i.ashearY+this.data.offsetShearY)*n),o.updateWorldTransformWith(l,c,h,u,d,o.ashearX,f)}}getOrder(){return this.data.order}};const Cb=class{constructor(t){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){const s=t.bones[e];let n;if(null==s.parent)n=new gb(s,this,null);else{const t=this.bones[s.parent.index];n=new gb(s,this,t),t.children.push(n)}this.bones.push(n)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){const s=t.slots[e],n=this.bones[s.boneData.index],i=new C_(s,n);this.slots.push(i),this.drawOrder.push(i)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){const s=t.ikConstraints[e];this.ikConstraints.push(new _b(s,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){const s=t.transformConstraints[e];this.transformConstraints.push(new Ab(s,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){const s=t.pathConstraints[e];this.pathConstraints.push(new Tb(s,this))}this.color=new Mv(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0,this.updateCacheReset.length=0;const t=this.bones;for(let h=0,l=t.length;h<l;h++)t[h].sorted=!1;const e=this.ikConstraints,s=this.transformConstraints,n=this.pathConstraints,i=e.length,r=s.length,a=n.length,o=i+r+a;t:for(let h=0;h<o;h++){for(let t=0;t<i;t++){const s=e[t];if(s.data.order==h){this.sortIkConstraint(s);continue t}}for(let t=0;t<r;t++){const e=s[t];if(e.data.order==h){this.sortTransformConstraint(e);continue t}}for(let t=0;t<a;t++){const e=n[t];if(e.data.order==h){this.sortPathConstraint(e);continue t}}}for(let h=0,l=t.length;h<l;h++)this.sortBone(t[h])}sortIkConstraint(t){const e=t.target;this.sortBone(e);const s=t.bones,n=s[0];if(this.sortBone(n),s.length>1){const t=s[s.length-1];this._updateCache.indexOf(t)>-1||this.updateCacheReset.push(t)}this._updateCache.push(t),this.sortReset(n.children),s[s.length-1].sorted=!0}sortPathConstraint(t){const e=t.target,s=e.data.index,n=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,s,n),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,s,n);for(let o=0,h=this.data.skins.length;o<h;o++)this.sortPathConstraintAttachment(this.data.skins[o],s,n);const i=e.getAttachment();i instanceof T_&&this.sortPathConstraintAttachmentWith(i,n);const r=t.bones,a=r.length;for(let o=0;o<a;o++)this.sortBone(r[o]);this._updateCache.push(t);for(let o=0;o<a;o++)this.sortReset(r[o].children);for(let o=0;o<a;o++)r[o].sorted=!0}sortTransformConstraint(t){this.sortBone(t.target);const e=t.bones,s=e.length;if(t.data.local)for(let n=0;n<s;n++){const t=e[n];this.sortBone(t.parent),this._updateCache.indexOf(t)>-1||this.updateCacheReset.push(t)}else for(let n=0;n<s;n++)this.sortBone(e[n]);this._updateCache.push(t);for(let n=0;n<s;n++)this.sortReset(e[n].children);for(let n=0;n<s;n++)e[n].sorted=!0}sortPathConstraintAttachment(t,e,s){const n=t.attachments[e];if(n)for(const i in n)this.sortPathConstraintAttachmentWith(n[i],s)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof T_))return;const s=t.bones;if(null==s)this.sortBone(e);else{const t=this.bones;let e=0;for(;e<s.length;){const n=s[e++];for(let i=e+n;e<i;e++){const n=s[e];this.sortBone(t[n])}}}}sortBone(t){if(t.sorted)return;const e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,s=t.length;e<s;e++){const s=t[e];s.sorted&&this.sortReset(s.children),s.sorted=!1}}updateWorldTransform(){const t=this.updateCacheReset;for(let s=0,n=t.length;s<n;s++){const e=t[s];e.ax=e.x,e.ay=e.y,e.arotation=e.rotation,e.ascaleX=e.scaleX,e.ascaleY=e.scaleY,e.ashearX=e.shearX,e.ashearY=e.shearY,e.appliedValid=!0}const e=this._updateCache;for(let s=0,n=e.length;s<n;s++)e[s].update()}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){const t=this.bones;for(let i=0,r=t.length;i<r;i++)t[i].setToSetupPose();const e=this.ikConstraints;for(let i=0,r=e.length;i<r;i++){const t=e[i];t.bendDirection=t.data.bendDirection,t.mix=t.data.mix}const s=this.transformConstraints;for(let i=0,r=s.length;i<r;i++){const t=s[i],e=t.data;t.rotateMix=e.rotateMix,t.translateMix=e.translateMix,t.scaleMix=e.scaleMix,t.shearMix=e.shearMix}const n=this.pathConstraints;for(let i=0,r=n.length;i<r;i++){const t=n[i],e=t.data;t.position=e.position,t.spacing=e.spacing,t.rotateMix=e.rotateMix,t.translateMix=e.translateMix}}setSlotsToSetupPose(){const t=this.slots;Ov.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,s=t.length;e<s;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.data.name==t)return n}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,n=e.length;s<n;s++)if(e[s].data.name==t)return s;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.data.name==t)return n}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,n=e.length;s<n;s++)if(e[s].data.name==t)return s;return-1}setSkinByName(t){const e=this.data.findSkin(t);if(null==e)throw new Error(`Skin not found: ${t}`);this.setSkin(e)}setSkin(t){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else{const e=this.slots;for(let s=0,n=e.length;s<n;s++){const n=e[s],i=n.data.attachmentName;if(null!=i){const e=t.getAttachment(s,i);null!=e&&n.setAttachment(e)}}}this.skin=t}getAttachmentByName(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)}getAttachment(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){const s=this.skin.getAttachment(t,e);if(null!=s)return s}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(null==t)throw new Error("slotName cannot be null.");const s=this.slots;for(let n=0,i=s.length;n<i;n++){const i=s[n];if(i.data.name==t){let s=null;if(null!=e&&(s=this.getAttachment(n,e),null==s))throw new Error(`Attachment not found: ${e}, for slot: ${t}`);return void i.setAttachment(s)}}throw new Error(`Slot not found: ${t}`)}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.data.name==t)return n}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.data.name==t)return n}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.data.name==t)return n}return null}getBounds(t,e,s){if(null==t)throw new Error("offset cannot be null.");if(null==e)throw new Error("size cannot be null.");const n=this.drawOrder;let i=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let h=0,l=n.length;h<l;h++){const t=n[h];let e=0,l=null;const c=t.getAttachment();if(c instanceof I_)e=8,l=Ov.setArraySize(s,e,0),c.computeWorldVertices(t.bone,l,0,2);else if(c instanceof S_){const n=c;e=n.worldVerticesLength,l=Ov.setArraySize(s,e,0),n.computeWorldVertices(t,0,e,l,0,2)}if(null!=l)for(let s=0,n=l.length;s<n;s+=2){const t=l[s],e=l[s+1];i=Math.min(i,t),r=Math.min(r,e),a=Math.max(a,t),o=Math.max(o,e)}}t.set(i,r),e.set(a-i,o-r)}update(t){this.time+=t}get flipX(){return-1==this.scaleX}set flipX(t){Cb.deprecatedWarning1||(Cb.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleX=t?1:-1}get flipY(){return-1==this.scaleY}set flipY(t){Cb.deprecatedWarning1||(Cb.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleY=t?1:-1}};let Mb=Cb;Mb.deprecatedWarning1=!1;let Ib=class{constructor(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,n=e.length;s<n;s++)if(e[s].name==t)return s;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,n=e.length;s<n;s++)if(e[s].name==t)return s;return-1}findSkin(t){if(null==t)throw new Error("skinName cannot be null.");const e=this.skins;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findEvent(t){if(null==t)throw new Error("eventDataName cannot be null.");const e=this.events;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findAnimation(t){if(null==t)throw new Error("animationName cannot be null.");const e=this.animations;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findPathConstraintIndex(t){if(null==t)throw new Error("pathConstraintName cannot be null.");const e=this.pathConstraints;for(let s=0,n=e.length;s<n;s++)if(e[s].name==t)return s;return-1}},Pb=class{constructor(t,e,s){if(this.color=new Mv(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");if(null==s)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=s}},Rb=class{constructor(t){if(this.order=0,this.bones=new Array,this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1,null==t)throw new Error("name cannot be null.");this.name=t}},kb=class{constructor(t){if(this.attachments=new Array,null==t)throw new Error("name cannot be null.");this.name=t}addAttachment(t,e,s){if(null==s)throw new Error("attachment cannot be null.");const n=this.attachments;t>=n.length&&(n.length=t+1),n[t]||(n[t]={}),n[t][e]=s}getAttachment(t,e){const s=this.attachments[t];return s?s[e]:null}attachAll(t,e){let s=0;for(let n=0;n<t.slots.length;n++){const i=t.slots[n],r=i.getAttachment();if(r&&s<e.attachments.length){const t=e.attachments[s];for(const e in t){if(r==t[e]){const t=this.getAttachment(s,e);null!=t&&i.setAttachment(t);break}}}s++}}},Db=class t{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(e){const s=this.scale,n=new Ib,i="string"==typeof e?JSON.parse(e):e,r=i.skeleton;if(null!=r&&(n.hash=r.hash,n.version=r.spine,n.width=r.width,n.height=r.height,n.fps=r.fps,n.imagesPath=r.images),i.bones)for(let a=0;a<i.bones.length;a++){const e=i.bones[a];let r=null;const o=this.getValue(e,"parent",null);if(null!=o&&(r=n.findBone(o),null==r))throw new Error(`Parent bone not found: ${o}`);const h=new yb(n.bones.length,e.name,r);h.length=this.getValue(e,"length",0)*s,h.x=this.getValue(e,"x",0)*s,h.y=this.getValue(e,"y",0)*s,h.rotation=this.getValue(e,"rotation",0),h.scaleX=this.getValue(e,"scaleX",1),h.scaleY=this.getValue(e,"scaleY",1),h.shearX=this.getValue(e,"shearX",0),h.shearY=this.getValue(e,"shearY",0),h.transformMode=t.transformModeFromString(this.getValue(e,"transform","normal")),n.bones.push(h)}if(i.slots)for(let a=0;a<i.slots.length;a++){const e=i.slots[a],s=e.name,r=e.bone,o=n.findBone(r);if(null==o)throw new Error(`Slot bone not found: ${r}`);const h=new Pb(n.slots.length,s,o),l=this.getValue(e,"color",null);null!=l&&h.color.setFromString(l);const c=this.getValue(e,"dark",null);null!=c&&(h.darkColor=new Mv(1,1,1,1),h.darkColor.setFromString(c)),h.attachmentName=this.getValue(e,"attachment",null),h.blendMode=t.blendModeFromString(this.getValue(e,"blend","normal")),n.slots.push(h)}if(i.ik)for(let t=0;t<i.ik.length;t++){const e=i.ik[t],s=new bb(e.name);s.order=this.getValue(e,"order",0);for(let t=0;t<e.bones.length;t++){const i=e.bones[t],r=n.findBone(i);if(null==r)throw new Error(`IK bone not found: ${i}`);s.bones.push(r)}const r=e.target;if(s.target=n.findBone(r),null==s.target)throw new Error(`IK target bone not found: ${r}`);s.bendDirection=this.getValue(e,"bendPositive",!0)?1:-1,s.mix=this.getValue(e,"mix",1),n.ikConstraints.push(s)}if(i.transform)for(let t=0;t<i.transform.length;t++){const e=i.transform[t],r=new Rb(e.name);r.order=this.getValue(e,"order",0);for(let t=0;t<e.bones.length;t++){const s=e.bones[t],i=n.findBone(s);if(null==i)throw new Error(`Transform constraint bone not found: ${s}`);r.bones.push(i)}const a=e.target;if(r.target=n.findBone(a),null==r.target)throw new Error(`Transform constraint target bone not found: ${a}`);r.local=this.getValue(e,"local",!1),r.relative=this.getValue(e,"relative",!1),r.offsetRotation=this.getValue(e,"rotation",0),r.offsetX=this.getValue(e,"x",0)*s,r.offsetY=this.getValue(e,"y",0)*s,r.offsetScaleX=this.getValue(e,"scaleX",0),r.offsetScaleY=this.getValue(e,"scaleY",0),r.offsetShearY=this.getValue(e,"shearY",0),r.rotateMix=this.getValue(e,"rotateMix",1),r.translateMix=this.getValue(e,"translateMix",1),r.scaleMix=this.getValue(e,"scaleMix",1),r.shearMix=this.getValue(e,"shearMix",1),n.transformConstraints.push(r)}if(i.path)for(let a=0;a<i.path.length;a++){const e=i.path[a],r=new wb(e.name);r.order=this.getValue(e,"order",0);for(let t=0;t<e.bones.length;t++){const s=e.bones[t],i=n.findBone(s);if(null==i)throw new Error(`Transform constraint bone not found: ${s}`);r.bones.push(i)}const o=e.target;if(r.target=n.findSlot(o),null==r.target)throw new Error(`Path target slot not found: ${o}`);r.positionMode=t.positionModeFromString(this.getValue(e,"positionMode","percent")),r.spacingMode=t.spacingModeFromString(this.getValue(e,"spacingMode","length")),r.rotateMode=t.rotateModeFromString(this.getValue(e,"rotateMode","tangent")),r.offsetRotation=this.getValue(e,"rotation",0),r.position=this.getValue(e,"position",0),r.positionMode==fv.Fixed&&(r.position*=s),r.spacing=this.getValue(e,"spacing",0),r.spacingMode!=Eb.Length&&r.spacingMode!=Eb.Fixed||(r.spacing*=s),r.rotateMix=this.getValue(e,"rotateMix",1),r.translateMix=this.getValue(e,"translateMix",1),n.pathConstraints.push(r)}if(i.skins)for(const t in i.skins){const e=i.skins[t],s=new kb(t);for(const t in e){const i=n.findSlotIndex(t);if(-1==i)throw new Error(`Slot not found: ${t}`);const r=e[t];for(const t in r){const e=this.readAttachment(r[t],s,i,t,n);null!=e&&s.addAttachment(i,t,e)}}n.skins.push(s),"default"==s.name&&(n.defaultSkin=s)}for(let t=0,a=this.linkedMeshes.length;t<a;t++){const e=this.linkedMeshes[t],s=null==e.skin?n.defaultSkin:n.findSkin(e.skin);if(null==s)throw new Error(`Skin not found: ${e.skin}`);const i=s.getAttachment(e.slotIndex,e.parent);if(null==i)throw new Error(`Parent mesh not found: ${e.parent}`);e.mesh.setParentMesh(i)}if(this.linkedMeshes.length=0,i.events)for(const t in i.events){const e=i.events[t],s=new xb(t);s.intValue=this.getValue(e,"int",0),s.floatValue=this.getValue(e,"float",0),s.stringValue=this.getValue(e,"string",""),s.audioPath=this.getValue(e,"audio",null),null!=s.audioPath&&(s.volume=this.getValue(e,"volume",1),s.balance=this.getValue(e,"balance",0)),n.events.push(s)}if(i.animations)for(const t in i.animations){const e=i.animations[t];this.readAnimation(e,t,n)}return n}readAttachment(t,e,s,n,i){const r=this.scale;n=this.getValue(t,"name",n);switch(this.getValue(t,"type","region")){case"region":{const s=this.getValue(t,"path",n),i=this.attachmentLoader.newRegionAttachment(e,n,s);if(null==i)return null;i.path=s,i.x=this.getValue(t,"x",0)*r,i.y=this.getValue(t,"y",0)*r,i.scaleX=this.getValue(t,"scaleX",1),i.scaleY=this.getValue(t,"scaleY",1),i.rotation=this.getValue(t,"rotation",0),i.width=t.width*r,i.height=t.height*r;const a=this.getValue(t,"color",null);return null!=a&&i.color.setFromString(a),i}case"boundingbox":{const s=this.attachmentLoader.newBoundingBoxAttachment(e,n);if(null==s)return null;this.readVertices(t,s,t.vertexCount<<1);const i=this.getValue(t,"color",null);return null!=i&&s.color.setFromString(i),s}case"mesh":case"linkedmesh":{const i=this.getValue(t,"path",n),r=this.attachmentLoader.newMeshAttachment(e,n,i);if(null==r)return null;r.path=i;const a=this.getValue(t,"color",null);null!=a&&r.color.setFromString(a);const o=this.getValue(t,"parent",null);if(null!=o)return r.inheritDeform=this.getValue(t,"deform",!0),this.linkedMeshes.push(new Fb(r,this.getValue(t,"skin",null),s,o)),r;const h=t.uvs;return this.readVertices(t,r,h.length),r.triangles=t.triangles,r.regionUVs=new Float32Array(h),r.hullLength=2*this.getValue(t,"hull",0),r}case"path":{const s=this.attachmentLoader.newPathAttachment(e,n);if(null==s)return null;s.closed=this.getValue(t,"closed",!1),s.constantSpeed=this.getValue(t,"constantSpeed",!0);const i=t.vertexCount;this.readVertices(t,s,i<<1);const a=Ov.newArray(i/3,0);for(let e=0;e<t.lengths.length;e++)a[e]=t.lengths[e]*r;s.lengths=a;const o=this.getValue(t,"color",null);return null!=o&&s.color.setFromString(o),s}case"point":{const s=this.attachmentLoader.newPointAttachment(e,n);if(null==s)return null;s.x=this.getValue(t,"x",0)*r,s.y=this.getValue(t,"y",0)*r,s.rotation=this.getValue(t,"rotation",0);const i=this.getValue(t,"color",null);return null!=i&&s.color.setFromString(i),s}case"clipping":{const s=this.attachmentLoader.newClippingAttachment(e,n);if(null==s)return null;const r=this.getValue(t,"end",null);if(null!=r){const t=i.findSlot(r);if(null==t)throw new Error(`Clipping end slot not found: ${r}`);s.endSlot=t}const a=t.vertexCount;this.readVertices(t,s,a<<1);const o=this.getValue(t,"color",null);return null!=o&&s.color.setFromString(o),s}}return null}readVertices(t,e,s){const n=this.scale;e.worldVerticesLength=s;const i=t.vertices;if(s==i.length){const t=Ov.toFloatArray(i);if(1!=n)for(let e=0,s=i.length;e<s;e++)t[e]*=n;return void(e.vertices=t)}const r=new Array,a=new Array;for(let o=0,h=i.length;o<h;){const t=i[o++];a.push(t);for(let e=o+4*t;o<e;o+=4)a.push(i[o]),r.push(i[o+1]*n),r.push(i[o+2]*n),r.push(i[o+3])}e.bones=a,e.vertices=Ov.toFloatArray(r)}readAnimation(t,e,s){const n=this.scale,i=new Array;let r=0;if(t.slots)for(const o in t.slots){const e=t.slots[o],n=s.findSlotIndex(o);if(-1==n)throw new Error(`Slot not found: ${o}`);for(const t in e){const s=e[t];if("attachment"==t){const t=new z_(s.length);t.slotIndex=n;let e=0;for(let n=0;n<s.length;n++){const i=s[n];t.setFrame(e++,i.time,i.name)}i.push(t),r=Math.max(r,t.frames[t.getFrameCount()-1])}else if("color"==t){const t=new Y_(s.length);t.slotIndex=n;let e=0;for(let n=0;n<s.length;n++){const i=s[n],r=new Mv;r.setFromString(i.color||"ffffffff"),t.setFrame(e,i.time,r.r,r.g,r.b,r.a),this.readCurve(i,t,e),e++}i.push(t),r=Math.max(r,t.frames[(t.getFrameCount()-1)*Y_.ENTRIES])}else{if("twoColor"!=t)throw new Error(`Invalid timeline type for a slot: ${t} (${o})`);{const t=new j_(s.length);t.slotIndex=n;let e=0;for(let n=0;n<s.length;n++){const i=s[n],r=new Mv,a=new Mv;r.setFromString(i.light),a.setFromString(i.dark),t.setFrame(e,i.time,r.r,r.g,r.b,r.a,a.r,a.g,a.b),this.readCurve(i,t,e),e++}i.push(t),r=Math.max(r,t.frames[(t.getFrameCount()-1)*j_.ENTRIES])}}}}if(t.bones)for(const o in t.bones){const e=t.bones[o],a=s.findBoneIndex(o);if(-1==a)throw new Error(`Bone not found: ${o}`);for(const t in e){const s=e[t];if("rotate"===t){const t=new B_(s.length);t.boneIndex=a;let e=0;for(let n=0;n<s.length;n++){const i=s[n];t.setFrame(e,i.time,i.angle),this.readCurve(i,t,e),e++}i.push(t),r=Math.max(r,t.frames[(t.getFrameCount()-1)*B_.ENTRIES])}else{if("translate"!==t&&"scale"!==t&&"shear"!==t)throw new Error(`Invalid timeline type for a bone: ${t} (${o})`);{let e=null,o=1;"scale"===t?e=new $_(s.length):"shear"===t?e=new U_(s.length):(e=new V_(s.length),o=n),e.boneIndex=a;let h=0;for(let t=0;t<s.length;t++){const n=s[t],i=this.getValue(n,"x",0),r=this.getValue(n,"y",0);e.setFrame(h,n.time,i*o,r*o),this.readCurve(n,e,h),h++}i.push(e),r=Math.max(r,e.frames[(e.getFrameCount()-1)*V_.ENTRIES])}}}}if(t.ik)for(const o in t.ik){const e=t.ik[o],n=s.findIkConstraint(o),a=new Q_(e.length);a.ikConstraintIndex=s.ikConstraints.indexOf(n);let h=0;for(let t=0;t<e.length;t++){const s=e[t];a.setFrame(h,s.time,this.getValue(s,"mix",1),this.getValue(s,"bendPositive",!0)?1:-1,this.getValue(s,"compress",!1),this.getValue(s,"stretch",!1)),this.readCurve(s,a,h),h++}i.push(a),r=Math.max(r,a.frames[(a.getFrameCount()-1)*Q_.ENTRIES])}if(t.transform)for(const o in t.transform){const e=t.transform[o],n=s.findTransformConstraint(o),a=new tb(e.length);a.transformConstraintIndex=s.transformConstraints.indexOf(n);let h=0;for(let t=0;t<e.length;t++){const s=e[t];a.setFrame(h,s.time,this.getValue(s,"rotateMix",1),this.getValue(s,"translateMix",1),this.getValue(s,"scaleMix",1),this.getValue(s,"shearMix",1)),this.readCurve(s,a,h),h++}i.push(a),r=Math.max(r,a.frames[(a.getFrameCount()-1)*tb.ENTRIES])}if(t.paths)for(const o in t.paths){const e=t.paths[o],a=s.findPathConstraintIndex(o);if(-1==a)throw new Error(`Path constraint not found: ${o}`);const h=s.pathConstraints[a];for(const t in e){const s=e[t];if("position"===t||"spacing"===t){let e=null,o=1;"spacing"===t?(e=new nb(s.length),h.spacingMode!=Eb.Length&&h.spacingMode!=Eb.Fixed||(o=n)):(e=new sb(s.length),h.positionMode==fv.Fixed&&(o=n)),e.pathConstraintIndex=a;let l=0;for(let n=0;n<s.length;n++){const i=s[n];e.setFrame(l,i.time,this.getValue(i,t,0)*o),this.readCurve(i,e,l),l++}i.push(e),r=Math.max(r,e.frames[(e.getFrameCount()-1)*sb.ENTRIES])}else if("mix"===t){const t=new rb(s.length);t.pathConstraintIndex=a;let e=0;for(let n=0;n<s.length;n++){const i=s[n];t.setFrame(e,i.time,this.getValue(i,"rotateMix",1),this.getValue(i,"translateMix",1)),this.readCurve(i,t,e),e++}i.push(t),r=Math.max(r,t.frames[(t.getFrameCount()-1)*rb.ENTRIES])}}}if(t.deform)for(const o in t.deform){const e=t.deform[o],a=s.findSkin(o);if(null!=a)for(const t in e){const o=e[t],h=s.findSlotIndex(t);if(-1==h)throw new Error(`Slot not found: ${o.name}`);for(const t in o){const e=o[t],s=a.getAttachment(h,t);if(null==s)throw new Error(`Deform attachment not found: ${e.name}`);const l=null!=s.bones,c=s.vertices,u=l?c.length/3*2:c.length,d=new H_(e.length);d.slotIndex=h,d.attachment=s;let f=0;for(let t=0;t<e.length;t++){const s=e[t];let i;const r=this.getValue(s,"vertices",null);if(null==r)i=l?Ov.newFloatArray(u):c;else{i=Ov.newFloatArray(u);const t=this.getValue(s,"offset",0);if(Ov.arrayCopy(r,0,i,t,r.length),1!=n)for(let e=t,s=e+r.length;e<s;e++)i[e]*=n;if(!l)for(let e=0;e<u;e++)i[e]+=c[e]}d.setFrame(f,s.time,i),this.readCurve(s,d,f),f++}i.push(d),r=Math.max(r,d.frames[d.getFrameCount()-1])}}}let a=t.drawOrder;if(null==a&&(a=t.draworder),null!=a){const t=new K_(a.length),e=s.slots.length;let n=0;for(let i=0;i<a.length;i++){const r=a[i];let o=null;const h=this.getValue(r,"offsets",null);if(null!=h){o=Ov.newArray(e,-1);const t=Ov.newArray(e-h.length,0);let n=0,i=0;for(let e=0;e<h.length;e++){const r=h[e],a=s.findSlotIndex(r.slot);if(-1==a)throw new Error(`Slot not found: ${r.slot}`);for(;n!=a;)t[i++]=n++;o[n+r.offset]=n++}for(;n<e;)t[i++]=n++;for(let s=e-1;s>=0;s--)-1==o[s]&&(o[s]=t[--i])}t.setFrame(n++,r.time,o)}i.push(t),r=Math.max(r,t.frames[t.getFrameCount()-1])}if(t.events){const e=new q_(t.events.length);let n=0;for(let i=0;i<t.events.length;i++){const r=t.events[i],a=s.findEvent(r.name);if(null==a)throw new Error(`Event not found: ${r.name}`);const o=new vb(Ov.toSinglePrecision(r.time),a);o.intValue=this.getValue(r,"int",a.intValue),o.floatValue=this.getValue(r,"float",a.floatValue),o.stringValue=this.getValue(r,"string",a.stringValue),null!=o.data.audioPath&&(o.volume=this.getValue(r,"volume",1),o.balance=this.getValue(r,"balance",0)),e.setFrame(n++,o)}i.push(e),r=Math.max(r,e.frames[e.getFrameCount()-1])}if(isNaN(r))throw new Error("Error while parsing animation, duration is NaN");s.animations.push(new k_(e,i,r))}readCurve(t,e,s){if(t.curve)if("stepped"===t.curve)e.setStepped(s);else if("[object Array]"===Object.prototype.toString.call(t.curve)){const n=t.curve;e.setCurve(s,n[0],n[1],n[2],n[3])}}getValue(t,e,s){return void 0!==t[e]?t[e]:s}static blendModeFromString(t){if("normal"==(t=t.toLowerCase()))return ir.NORMAL;if("additive"==t)return ir.ADD;if("multiply"==t)return ir.MULTIPLY;if("screen"==t)return ir.SCREEN;throw new Error(`Unknown blend mode: ${t}`)}static positionModeFromString(t){if("fixed"==(t=t.toLowerCase()))return fv.Fixed;if("percent"==t)return fv.Percent;throw new Error(`Unknown position mode: ${t}`)}static spacingModeFromString(t){if("length"==(t=t.toLowerCase()))return Eb.Length;if("fixed"==t)return Eb.Fixed;if("percent"==t)return Eb.Percent;throw new Error(`Unknown position mode: ${t}`)}static rotateModeFromString(t){if("tangent"==(t=t.toLowerCase()))return pv.Tangent;if("chain"==t)return pv.Chain;if("chainscale"==t)return pv.ChainScale;throw new Error(`Unknown rotate mode: ${t}`)}static transformModeFromString(t){if("normal"==(t=t.toLowerCase()))return mv.Normal;if("onlytranslation"==t)return mv.OnlyTranslation;if("norotationorreflection"==t)return mv.NoRotationOrReflection;if("noscale"==t)return mv.NoScale;if("noscaleorreflection"==t)return mv.NoScaleOrReflection;throw new Error(`Unknown transform mode: ${t}`)}},Fb=class{constructor(t,e,s,n){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=n}};const Ob=Object.freeze(Object.defineProperty({__proto__:null,Animation:k_,AnimationState:ob,AnimationStateAdapter2:class{start(t){}interrupt(t){}end(t){}dispose(t){}complete(t){}event(t,e){}},AnimationStateData:pb,AtlasAttachmentLoader:mb,Attachment:x_,AttachmentTimeline:z_,Bone:gb,BoneData:yb,BoundingBoxAttachment:w_,ClippingAttachment:E_,ColorTimeline:Y_,CurveTimeline:O_,DeformTimeline:H_,DrawOrderTimeline:K_,Event:vb,EventData:xb,EventQueue:ub,EventTimeline:q_,EventType:db,IkConstraint:_b,IkConstraintData:bb,IkConstraintTimeline:Q_,JitterEffect:class{constructor(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}begin(t){}transform(t,e,s,n){t.x+=Pv.randomTriangular(-this.jitterX,this.jitterY),t.y+=Pv.randomTriangular(-this.jitterX,this.jitterY)}end(){}},MeshAttachment:S_,PathAttachment:T_,PathConstraint:Tb,PathConstraintData:wb,PathConstraintMixTimeline:rb,PathConstraintPositionTimeline:sb,PathConstraintSpacingTimeline:nb,PointAttachment:A_,RegionAttachment:I_,RotateTimeline:B_,ScaleTimeline:$_,ShearTimeline:U_,Skeleton:Mb,SkeletonBounds:class extends Lv{},SkeletonData:Ib,SkeletonJson:Db,Skin:kb,Slot:C_,SlotData:Pb,SpacingMode:Eb,Spine:class extends Wv{createSkeleton(t){this.skeleton=new Mb(t),this.skeleton.updateWorldTransform(),this.stateData=new pb(t),this.state=new ob(this.stateData)}},SwirlEffect:R_,TimelineType:D_,TrackEntry:lb,TransformConstraint:Ab,TransformConstraintData:Rb,TransformConstraintTimeline:tb,TranslateTimeline:V_,TwoColorTimeline:j_,VertexAttachment:b_},Symbol.toStringTag,{value:"Module"}));class Nb{constructor(t){if(!t)throw new Error("name cannot be null.");this.name=t}}const Bb=class extends Nb{constructor(t){super(t),this.id=Bb.nextID++,this.bones=null,this.vertices=[],this.worldVerticesLength=0,this.timelineAttachment=this}computeWorldVerticesOld(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)}computeWorldVertices(t,e,s,n,i,r){s=i+(s>>1)*r;const a=t.bone.skeleton,o=t.deform;let h=this.vertices;const l=this.bones;if(!l){o.length>0&&(h=o);const a=t.bone.matrix,l=a.tx,c=a.ty,u=a.a,d=a.c,f=a.b,p=a.d;for(let t=e,o=i;o<s;t+=2,o+=r){const e=h[t],s=h[t+1];n[o]=e*u+s*d+l,n[o+1]=e*f+s*p+c}return}let c=0,u=0;for(let f=0;f<e;f+=2){const t=l[c];c+=t+1,u+=t}const d=a.bones;if(0==o.length)for(let f=i,p=3*u;f<s;f+=r){let t=0,e=0,s=l[c++];for(s+=c;c<s;c++,p+=3){const s=d[l[c]].matrix,n=h[p],i=h[p+1],r=h[p+2];t+=(n*s.a+i*s.c+s.tx)*r,e+=(n*s.b+i*s.d+s.ty)*r}n[f]=t,n[f+1]=e}else{const t=o;for(let e=i,a=3*u,o=u<<1;e<s;e+=r){let s=0,i=0,r=l[c++];for(r+=c;c<r;c++,a+=3,o+=2){const e=d[l[c]].matrix,n=h[a]+t[o],r=h[a+1]+t[o+1],u=h[a+2];s+=(n*e.a+r*e.c+e.tx)*u,i+=(n*e.b+r*e.d+e.ty)*u}n[e]=s,n[e+1]=i}}}copyTo(t){this.bones?(t.bones=new Array(this.bones.length),Ov.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,this.vertices&&(t.vertices=Ov.newFloatArray(this.vertices.length),Ov.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)),t.worldVerticesLength=this.worldVerticesLength,t.timelineAttachment=this.timelineAttachment}};let Lb=Bb;Lb.nextID=0;class Vb extends Lb{constructor(t){super(t),this.type=lv.BoundingBox,this.color=new Mv(1,1,1,1)}copy(){const t=new Vb(this.name);return this.copyTo(t),t.color.setFromColor(this.color),t}}class $b extends Lb{constructor(t){super(t),this.type=lv.Clipping,this.endSlot=null,this.color=new Mv(.2275,.2275,.8078,1)}copy(){const t=new $b(this.name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t}}class Ub extends Lb{constructor(t,e){super(t),this.type=lv.Mesh,this.region=null,this.triangles=[],this.color=new Mv(1,1,1,1),this.width=0,this.height=0,this.hullLength=0,this.edges=[],this.parentMesh=null,this.sequence=null,this.tempColor=new Mv(0,0,0,0),this.path=e}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}copy(){if(this.parentMesh)return this.newLinkedMesh();const t=new Ub(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Float32Array(this.regionUVs.length),Ov.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.triangles=new Array(this.triangles.length),Ov.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,t.sequence=null!=this.sequence?this.sequence.copy():null,this.edges&&(t.edges=new Array(this.edges.length),Ov.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t}computeWorldVertices(t,e,s,n,i,r){null!=this.sequence&&this.sequence.apply(t,this),super.computeWorldVertices(t,e,s,n,i,r)}newLinkedMesh(){const t=new Ub(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),t.timelineAttachment=this.timelineAttachment,t.setParentMesh(this.parentMesh?this.parentMesh:this),t}}class Xb extends Lb{constructor(t){super(t),this.type=lv.Path,this.lengths=[],this.closed=!1,this.constantSpeed=!1,this.color=new Mv(1,1,1,1)}copy(){const t=new Xb(this.name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),Ov.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t}}class Yb extends Lb{constructor(t){super(t),this.type=lv.Point,this.x=0,this.y=0,this.rotation=0,this.color=new Mv(.38,.94,0,1)}computeWorldPosition(t,e){const s=t.matrix;return e.x=this.x*s.a+this.y*s.c+t.worldX,e.y=this.x*s.b+this.y*s.d+t.worldY,e}computeWorldRotation(t){const e=t.matrix,s=Pv.cosDeg(this.rotation),n=Pv.sinDeg(this.rotation),i=s*e.a+n*e.c,r=s*e.b+n*e.d;return Math.atan2(r,i)*Pv.radDeg}copy(){const t=new Yb(this.name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t}}const Wb=class extends Nb{constructor(t,e){super(t),this.type=lv.Region,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new Mv(1,1,1,1),this.rendererObject=null,this.region=null,this.sequence=null,this.offset=Ov.newFloatArray(8),this.uvs=Ov.newFloatArray(8),this.tempColor=new Mv(1,1,1,1),this.path=e}updateRegion(){if(!this.region)throw new Error("Region not set.");const t=this.region,e=this.width/this.region.originalWidth*this.scaleX,s=this.height/this.region.originalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.region.offsetX*e,i=-this.height/2*this.scaleY+this.region.offsetY*s,r=n+this.region.width*e,a=i+this.region.height*s,o=this.rotation*Math.PI/180,h=Math.cos(o),l=Math.sin(o),c=this.x,u=this.y,d=n*h+c,f=n*l,p=i*h+u,m=i*l,g=r*h+c,y=r*l,v=a*h+u,x=a*l,_=this.offset;_[0]=d-m,_[1]=p+f,_[2]=d-x,_[3]=v+f,_[4]=g-x,_[5]=v+y,_[6]=g-m,_[7]=p+y;const b=this.uvs;90==t.degrees?(b[2]=t.u,b[3]=t.v2,b[4]=t.u,b[5]=t.v,b[6]=t.u2,b[7]=t.v,b[0]=t.u2,b[1]=t.v2):(b[0]=t.u,b[1]=t.v2,b[2]=t.u,b[3]=t.v,b[4]=t.u2,b[5]=t.v,b[6]=t.u2,b[7]=t.v2)}computeWorldVertices(t,e,s,n){null!=this.sequence&&this.sequence.apply(t,this);const i=t.bone,r=this.offset,a=i.matrix,o=a.tx,h=a.ty,l=a.a,c=a.c,u=a.b,d=a.d;let f=0,p=0;f=r[0],p=r[1],e[s]=f*l+p*c+o,e[s+1]=f*u+p*d+h,s+=n,f=r[2],p=r[3],e[s]=f*l+p*c+o,e[s+1]=f*u+p*d+h,s+=n,f=r[4],p=r[5],e[s]=f*l+p*c+o,e[s+1]=f*u+p*d+h,s+=n,f=r[6],p=r[7],e[s]=f*l+p*c+o,e[s+1]=f*u+p*d+h}copy(){const t=new Wb(this.name,this.path);return t.region=this.region,t.rendererObject=this.rendererObject,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,Ov.arrayCopy(this.uvs,0,t.uvs,0,8),Ov.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t.sequence=null!=this.sequence?this.sequence.copy():null,t}};let jb=Wb;jb.X1=0,jb.Y1=1,jb.C1R=2,jb.C1G=3,jb.C1B=4,jb.C1A=5,jb.U1=6,jb.V1=7,jb.X2=8,jb.Y2=9,jb.C2R=10,jb.C2G=11,jb.C2B=12,jb.C2A=13,jb.U2=14,jb.V2=15,jb.X3=16,jb.Y3=17,jb.C3R=18,jb.C3G=19,jb.C3B=20,jb.C3A=21,jb.U3=22,jb.V3=23,jb.X4=24,jb.Y4=25,jb.C4R=26,jb.C4G=27,jb.C4B=28,jb.C4A=29,jb.U4=30,jb.V4=31;const zb=class{constructor(t){this.id=zb.nextID(),this.start=0,this.digits=0,this.setupIndex=0,this.regions=new Array(t)}copy(){const t=new zb(this.regions.length);return Ov.arrayCopy(this.regions,0,t.regions,0,this.regions.length),t.start=this.start,t.digits=this.digits,t.setupIndex=this.setupIndex,t}apply(t,e){let s=t.sequenceIndex;-1==s&&(s=this.setupIndex),s>=this.regions.length&&(s=this.regions.length-1);const n=this.regions[s];e.region!=n&&(e.region=n)}getPath(t,e){let s=t;const n=(this.start+e).toString();for(let i=this.digits-n.length;i>0;i--)s+="0";return s+=n,s}static nextID(){return zb._nextID++}};let Gb=zb;Gb._nextID=0;var Hb=(t=>(t[t.hold=0]="hold",t[t.once=1]="once",t[t.loop=2]="loop",t[t.pingpong=3]="pingpong",t[t.onceReverse=4]="onceReverse",t[t.loopReverse=5]="loopReverse",t[t.pingpongReverse=6]="pingpongReverse",t))(Hb||{});const qb=[0,1,2,3,4,5,6];class Kb{constructor(t,e,s){if(this.timelines=[],this.timelineIds=new Av,!t)throw new Error("name cannot be null.");this.name=t,this.setTimelines(e),this.duration=s}setTimelines(t){if(!t)throw new Error("timelines cannot be null.");this.timelines=t,this.timelineIds.clear();for(let e=0;e<t.length;e++)this.timelineIds.addAll(t[e].getPropertyIds())}hasTimeline(t){for(let e=0;e<t.length;e++)if(this.timelineIds.contains(t[e]))return!0;return!1}apply(t,e,s,n,i,r,a,o){if(!t)throw new Error("skeleton cannot be null.");n&&0!=this.duration&&(s%=this.duration,e>0&&(e%=this.duration));const h=this.timelines;for(let l=0,c=h.length;l<c;l++)h[l].apply(t,e,s,i,r,a,o)}}const Zb=0,Qb=1,Jb=2,tw=3,ew=4,sw=5,nw=6,iw=7,rw=8,aw=9,ow=10,hw=11,lw=12,cw=13,uw=14,dw=15,fw=16,pw=17,mw=18,gw=19;class yw{constructor(t,e){this.propertyIds=e,this.frames=Ov.newFloatArray(t*this.getFrameEntries())}getPropertyIds(){return this.propertyIds}getFrameEntries(){return 1}getFrameCount(){return this.frames.length/this.getFrameEntries()}getDuration(){return this.frames[this.frames.length-this.getFrameEntries()]}static search1(t,e){const s=t.length;for(let n=1;n<s;n++)if(t[n]>e)return n-1;return s-1}static search(t,e,s){const n=t.length;for(let i=s;i<n;i+=s)if(t[i]>e)return i-s;return n-s}}class vw extends yw{constructor(t,e,s){super(t,s),this.curves=Ov.newFloatArray(t+18*e),this.curves[t-1]=1}setLinear(t){this.curves[t]=0}setStepped(t){this.curves[t]=1}shrink(t){const e=this.getFrameCount()+18*t;if(this.curves.length>e){const t=Ov.newFloatArray(e);Ov.arrayCopy(this.curves,0,t,0,e),this.curves=t}}setBezier(t,e,s,n,i,r,a,o,h,l,c){const u=this.curves;let d=this.getFrameCount()+18*t;0==s&&(u[e]=2+d);const f=.03*(n-2*r+o),p=.03*(i-2*a+h),m=.006*(3*(r-o)-n+l),g=.006*(3*(a-h)-i+c);let y=2*f+m,v=2*p+g,x=.3*(r-n)+f+.16666667*m,_=.3*(a-i)+p+.16666667*g,b=n+x,w=i+_;for(let E=d+18;d<E;d+=2)u[d]=b,u[d+1]=w,x+=y,_+=v,y+=m,v+=g,b+=x,w+=_}getBezierValue(t,e,s,n){const i=this.curves;if(i[n]>t){const r=this.frames[e],a=this.frames[e+s];return a+(t-r)/(i[n]-r)*(i[n+1]-a)}const r=n+18;for(n+=2;n<r;n+=2)if(i[n]>=t){const e=i[n-2],s=i[n-1];return s+(t-e)/(i[n]-e)*(i[n+1]-s)}e+=this.getFrameEntries();const a=i[r-2],o=i[r-1];return o+(t-a)/(this.frames[e]-a)*(this.frames[e+s]-o)}}class xw extends vw{constructor(t,e,s){super(t,e,[s])}getFrameEntries(){return 2}setFrame(t,e,s){t<<=1,this.frames[t]=e,this.frames[t+1]=s}getCurveValue(t){const e=this.frames;let s=e.length-2;for(let i=2;i<=s;i+=2)if(e[i]>t){s=i-2;break}const n=this.curves[s>>1];switch(n){case 0:const n=e[s],i=e[s+1];return i+(t-n)/(e[s+2]-n)*(e[s+2+1]-i);case 1:return e[s+1]}return this.getBezierValue(t,s,1,n-2)}}class _w extends vw{constructor(t,e,s,n){super(t,e,[s,n])}getFrameEntries(){return 3}setFrame(t,e,s,n){t*=3,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=n}}class bw extends xw{constructor(t,e,s){super(t,e,`${Zb}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,n,i,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(r){case uv.setup:return void(o.rotation=o.data.rotation);case uv.first:o.rotation+=(o.data.rotation-o.rotation)*i}return}let h=this.getCurveValue(s);switch(r){case uv.setup:o.rotation=o.data.rotation+h*i;break;case uv.first:case uv.replace:h+=o.data.rotation-o.rotation;case uv.add:o.rotation+=h*i}}}class ww extends _w{constructor(t,e,s){super(t,e,`${Qb}|${s}`,`${Jb}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,n,i,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;const h=this.frames;if(s<h[0]){switch(r){case uv.setup:return o.x=o.data.x,void(o.y=o.data.y);case uv.first:o.x+=(o.data.x-o.x)*i,o.y+=(o.data.y-o.y)*i}return}let l=0,c=0;const u=yw.search(h,s,3),d=this.curves[u/3];switch(d){case 0:const t=h[u];l=h[u+1],c=h[u+2];const e=(s-t)/(h[u+3]-t);l+=(h[u+3+1]-l)*e,c+=(h[u+3+2]-c)*e;break;case 1:l=h[u+1],c=h[u+2];break;default:l=this.getBezierValue(s,u,1,d-2),c=this.getBezierValue(s,u,2,d+18-2)}switch(r){case uv.setup:o.x=o.data.x+l*i,o.y=o.data.y+c*i;break;case uv.first:case uv.replace:o.x+=(o.data.x+l-o.x)*i,o.y+=(o.data.y+c-o.y)*i;break;case uv.add:o.x+=l*i,o.y+=c*i}}}class Ew extends xw{constructor(t,e,s){super(t,e,`${Qb}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,n,i,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(r){case uv.setup:return void(o.x=o.data.x);case uv.first:o.x+=(o.data.x-o.x)*i}return}const h=this.getCurveValue(s);switch(r){case uv.setup:o.x=o.data.x+h*i;break;case uv.first:case uv.replace:o.x+=(o.data.x+h-o.x)*i;break;case uv.add:o.x+=h*i}}}class Sw extends xw{constructor(t,e,s){super(t,e,`${Jb}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,n,i,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(r){case uv.setup:return void(o.y=o.data.y);case uv.first:o.y+=(o.data.y-o.y)*i}return}const h=this.getCurveValue(s);switch(r){case uv.setup:o.y=o.data.y+h*i;break;case uv.first:case uv.replace:o.y+=(o.data.y+h-o.y)*i;break;case uv.add:o.y+=h*i}}}class Tw extends _w{constructor(t,e,s){super(t,e,`${tw}|${s}`,`${ew}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,n,i,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;const h=this.frames;if(s<h[0]){switch(r){case uv.setup:return o.scaleX=o.data.scaleX,void(o.scaleY=o.data.scaleY);case uv.first:o.scaleX+=(o.data.scaleX-o.scaleX)*i,o.scaleY+=(o.data.scaleY-o.scaleY)*i}return}let l,c;const u=yw.search(h,s,3),d=this.curves[u/3];switch(d){case 0:const t=h[u];l=h[u+1],c=h[u+2];const e=(s-t)/(h[u+3]-t);l+=(h[u+3+1]-l)*e,c+=(h[u+3+2]-c)*e;break;case 1:l=h[u+1],c=h[u+2];break;default:l=this.getBezierValue(s,u,1,d-2),c=this.getBezierValue(s,u,2,d+18-2)}if(l*=o.data.scaleX,c*=o.data.scaleY,1==i)r==uv.add?(o.scaleX+=l-o.data.scaleX,o.scaleY+=c-o.data.scaleY):(o.scaleX=l,o.scaleY=c);else{let t=0,e=0;if(a==dv.mixOut)switch(r){case uv.setup:t=o.data.scaleX,e=o.data.scaleY,o.scaleX=t+(Math.abs(l)*Pv.signum(t)-t)*i,o.scaleY=e+(Math.abs(c)*Pv.signum(e)-e)*i;break;case uv.first:case uv.replace:t=o.scaleX,e=o.scaleY,o.scaleX=t+(Math.abs(l)*Pv.signum(t)-t)*i,o.scaleY=e+(Math.abs(c)*Pv.signum(e)-e)*i;break;case uv.add:o.scaleX+=(l-o.data.scaleX)*i,o.scaleY+=(c-o.data.scaleY)*i}else switch(r){case uv.setup:t=Math.abs(o.data.scaleX)*Pv.signum(l),e=Math.abs(o.data.scaleY)*Pv.signum(c),o.scaleX=t+(l-t)*i,o.scaleY=e+(c-e)*i;break;case uv.first:case uv.replace:t=Math.abs(o.scaleX)*Pv.signum(l),e=Math.abs(o.scaleY)*Pv.signum(c),o.scaleX=t+(l-t)*i,o.scaleY=e+(c-e)*i;break;case uv.add:o.scaleX+=(l-o.data.scaleX)*i,o.scaleY+=(c-o.data.scaleY)*i}}}}class Aw extends xw{constructor(t,e,s){super(t,e,`${tw}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,n,i,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(r){case uv.setup:return void(o.scaleX=o.data.scaleX);case uv.first:o.scaleX+=(o.data.scaleX-o.scaleX)*i}return}const h=this.getCurveValue(s)*o.data.scaleX;if(1==i)r==uv.add?o.scaleX+=h-o.data.scaleX:o.scaleX=h;else{let t=0;if(a==dv.mixOut)switch(r){case uv.setup:t=o.data.scaleX,o.scaleX=t+(Math.abs(h)*Pv.signum(t)-t)*i;break;case uv.first:case uv.replace:t=o.scaleX,o.scaleX=t+(Math.abs(h)*Pv.signum(t)-t)*i;break;case uv.add:o.scaleX+=(h-o.data.scaleX)*i}else switch(r){case uv.setup:t=Math.abs(o.data.scaleX)*Pv.signum(h),o.scaleX=t+(h-t)*i;break;case uv.first:case uv.replace:t=Math.abs(o.scaleX)*Pv.signum(h),o.scaleX=t+(h-t)*i;break;case uv.add:o.scaleX+=(h-o.data.scaleX)*i}}}}class Cw extends xw{constructor(t,e,s){super(t,e,`${ew}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,n,i,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(r){case uv.setup:return void(o.scaleY=o.data.scaleY);case uv.first:o.scaleY+=(o.data.scaleY-o.scaleY)*i}return}const h=this.getCurveValue(s)*o.data.scaleY;if(1==i)r==uv.add?o.scaleY+=h-o.data.scaleY:o.scaleY=h;else{let t=0;if(a==dv.mixOut)switch(r){case uv.setup:t=o.data.scaleY,o.scaleY=t+(Math.abs(h)*Pv.signum(t)-t)*i;break;case uv.first:case uv.replace:t=o.scaleY,o.scaleY=t+(Math.abs(h)*Pv.signum(t)-t)*i;break;case uv.add:o.scaleY+=(h-o.data.scaleY)*i}else switch(r){case uv.setup:t=Math.abs(o.data.scaleY)*Pv.signum(h),o.scaleY=t+(h-t)*i;break;case uv.first:case uv.replace:t=Math.abs(o.scaleY)*Pv.signum(h),o.scaleY=t+(h-t)*i;break;case uv.add:o.scaleY+=(h-o.data.scaleY)*i}}}}class Mw extends _w{constructor(t,e,s){super(t,e,`${sw}|${s}`,`${nw}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,n,i,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;const h=this.frames;if(s<h[0]){switch(r){case uv.setup:return o.shearX=o.data.shearX,void(o.shearY=o.data.shearY);case uv.first:o.shearX+=(o.data.shearX-o.shearX)*i,o.shearY+=(o.data.shearY-o.shearY)*i}return}let l=0,c=0;const u=yw.search(h,s,3),d=this.curves[u/3];switch(d){case 0:const t=h[u];l=h[u+1],c=h[u+2];const e=(s-t)/(h[u+3]-t);l+=(h[u+3+1]-l)*e,c+=(h[u+3+2]-c)*e;break;case 1:l=h[u+1],c=h[u+2];break;default:l=this.getBezierValue(s,u,1,d-2),c=this.getBezierValue(s,u,2,d+18-2)}switch(r){case uv.setup:o.shearX=o.data.shearX+l*i,o.shearY=o.data.shearY+c*i;break;case uv.first:case uv.replace:o.shearX+=(o.data.shearX+l-o.shearX)*i,o.shearY+=(o.data.shearY+c-o.shearY)*i;break;case uv.add:o.shearX+=l*i,o.shearY+=c*i}}}class Iw extends xw{constructor(t,e,s){super(t,e,`${sw}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,n,i,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(r){case uv.setup:return void(o.shearX=o.data.shearX);case uv.first:o.shearX+=(o.data.shearX-o.shearX)*i}return}const h=this.getCurveValue(s);switch(r){case uv.setup:o.shearX=o.data.shearX+h*i;break;case uv.first:case uv.replace:o.shearX+=(o.data.shearX+h-o.shearX)*i;break;case uv.add:o.shearX+=h*i}}}class Pw extends xw{constructor(t,e,s){super(t,e,`${nw}|${s}`),this.boneIndex=0,this.boneIndex=s}apply(t,e,s,n,i,r,a){const o=t.bones[this.boneIndex];if(!o.active)return;if(s<this.frames[0]){switch(r){case uv.setup:return void(o.shearY=o.data.shearY);case uv.first:o.shearY+=(o.data.shearY-o.shearY)*i}return}const h=this.getCurveValue(s);switch(r){case uv.setup:o.shearY=o.data.shearY+h*i;break;case uv.first:case uv.replace:o.shearY+=(o.data.shearY+h-o.shearY)*i;break;case uv.add:o.shearY+=h*i}}}class Rw extends vw{constructor(t,e,s){super(t,e,[`${iw}|${s}`,`${rw}|${s}`]),this.slotIndex=0,this.slotIndex=s}getFrameEntries(){return 5}setFrame(t,e,s,n,i,r){t*=5,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=n,this.frames[t+3]=i,this.frames[t+4]=r}apply(t,e,s,n,i,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=this.frames,l=o.color;if(s<h[0]){const t=o.data.color;switch(r){case uv.setup:return void l.setFromColor(t);case uv.first:l.add((t.r-l.r)*i,(t.g-l.g)*i,(t.b-l.b)*i,(t.a-l.a)*i)}return}let c=0,u=0,d=0,f=0;const p=yw.search(h,s,5),m=this.curves[p/5];switch(m){case 0:const t=h[p];c=h[p+1],u=h[p+2],d=h[p+3],f=h[p+4];const e=(s-t)/(h[p+5]-t);c+=(h[p+5+1]-c)*e,u+=(h[p+5+2]-u)*e,d+=(h[p+5+3]-d)*e,f+=(h[p+5+4]-f)*e;break;case 1:c=h[p+1],u=h[p+2],d=h[p+3],f=h[p+4];break;default:c=this.getBezierValue(s,p,1,m-2),u=this.getBezierValue(s,p,2,m+18-2),d=this.getBezierValue(s,p,3,m+36-2),f=this.getBezierValue(s,p,4,m+54-2)}1==i?l.set(c,u,d,f):(r==uv.setup&&l.setFromColor(o.data.color),l.add((c-l.r)*i,(u-l.g)*i,(d-l.b)*i,(f-l.a)*i))}}class kw extends vw{constructor(t,e,s){super(t,e,[`${iw}|${s}`]),this.slotIndex=0,this.slotIndex=s}getFrameEntries(){return 4}setFrame(t,e,s,n,i){t<<=2,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=n,this.frames[t+3]=i}apply(t,e,s,n,i,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=this.frames,l=o.color;if(s<h[0]){const t=o.data.color;switch(r){case uv.setup:return l.r=t.r,l.g=t.g,void(l.b=t.b);case uv.first:l.r+=(t.r-l.r)*i,l.g+=(t.g-l.g)*i,l.b+=(t.b-l.b)*i}return}let c=0,u=0,d=0;const f=yw.search(h,s,4),p=this.curves[f>>2];switch(p){case 0:const t=h[f];c=h[f+1],u=h[f+2],d=h[f+3];const e=(s-t)/(h[f+4]-t);c+=(h[f+4+1]-c)*e,u+=(h[f+4+2]-u)*e,d+=(h[f+4+3]-d)*e;break;case 1:c=h[f+1],u=h[f+2],d=h[f+3];break;default:c=this.getBezierValue(s,f,1,p-2),u=this.getBezierValue(s,f,2,p+18-2),d=this.getBezierValue(s,f,3,p+36-2)}if(1==i)l.r=c,l.g=u,l.b=d;else{if(r==uv.setup){const t=o.data.color;l.r=t.r,l.g=t.g,l.b=t.b}l.r+=(c-l.r)*i,l.g+=(u-l.g)*i,l.b+=(d-l.b)*i}}}class Dw extends xw{constructor(t,e,s){super(t,e,`${rw}|${s}`),this.slotIndex=0,this.slotIndex=s}apply(t,e,s,n,i,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=o.color;if(s<this.frames[0]){const t=o.data.color;switch(r){case uv.setup:return void(h.a=t.a);case uv.first:h.a+=(t.a-h.a)*i}return}const l=this.getCurveValue(s);1==i?h.a=l:(r==uv.setup&&(h.a=o.data.color.a),h.a+=(l-h.a)*i)}}class Fw extends vw{constructor(t,e,s){super(t,e,[`${iw}|${s}`,`${rw}|${s}`,`${aw}|${s}`]),this.slotIndex=0,this.slotIndex=s}getFrameEntries(){return 8}setFrame(t,e,s,n,i,r,a,o,h){t<<=3,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=n,this.frames[t+3]=i,this.frames[t+4]=r,this.frames[t+5]=a,this.frames[t+6]=o,this.frames[t+7]=h}apply(t,e,s,n,i,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=this.frames,l=o.color,c=o.darkColor;if(s<h[0]){const t=o.data.color,e=o.data.darkColor;switch(r){case uv.setup:return l.setFromColor(t),c.r=e.r,c.g=e.g,void(c.b=e.b);case uv.first:l.add((t.r-l.r)*i,(t.g-l.g)*i,(t.b-l.b)*i,(t.a-l.a)*i),c.r+=(e.r-c.r)*i,c.g+=(e.g-c.g)*i,c.b+=(e.b-c.b)*i}return}let u=0,d=0,f=0,p=0,m=0,g=0,y=0;const v=yw.search(h,s,8),x=this.curves[v>>3];switch(x){case 0:const t=h[v];u=h[v+1],d=h[v+2],f=h[v+3],p=h[v+4],m=h[v+5],g=h[v+6],y=h[v+7];const e=(s-t)/(h[v+8]-t);u+=(h[v+8+1]-u)*e,d+=(h[v+8+2]-d)*e,f+=(h[v+8+3]-f)*e,p+=(h[v+8+4]-p)*e,m+=(h[v+8+5]-m)*e,g+=(h[v+8+6]-g)*e,y+=(h[v+8+7]-y)*e;break;case 1:u=h[v+1],d=h[v+2],f=h[v+3],p=h[v+4],m=h[v+5],g=h[v+6],y=h[v+7];break;default:u=this.getBezierValue(s,v,1,x-2),d=this.getBezierValue(s,v,2,x+18-2),f=this.getBezierValue(s,v,3,x+36-2),p=this.getBezierValue(s,v,4,x+54-2),m=this.getBezierValue(s,v,5,x+72-2),g=this.getBezierValue(s,v,6,x+90-2),y=this.getBezierValue(s,v,7,x+108-2)}if(1==i)l.set(u,d,f,p),c.r=m,c.g=g,c.b=y;else{if(r==uv.setup){l.setFromColor(o.data.color);const t=o.data.darkColor;c.r=t.r,c.g=t.g,c.b=t.b}l.add((u-l.r)*i,(d-l.g)*i,(f-l.b)*i,(p-l.a)*i),c.r+=(m-c.r)*i,c.g+=(g-c.g)*i,c.b+=(y-c.b)*i}}}class Ow extends vw{constructor(t,e,s){super(t,e,[`${iw}|${s}`,`${aw}|${s}`]),this.slotIndex=0,this.slotIndex=s}getFrameEntries(){return 7}setFrame(t,e,s,n,i,r,a,o){t*=7,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=n,this.frames[t+3]=i,this.frames[t+4]=r,this.frames[t+5]=a,this.frames[t+6]=o}apply(t,e,s,n,i,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=this.frames,l=o.color,c=o.darkColor;if(s<h[0]){const t=o.data.color,e=o.data.darkColor;switch(r){case uv.setup:return l.r=t.r,l.g=t.g,l.b=t.b,c.r=e.r,c.g=e.g,void(c.b=e.b);case uv.first:l.r+=(t.r-l.r)*i,l.g+=(t.g-l.g)*i,l.b+=(t.b-l.b)*i,c.r+=(e.r-c.r)*i,c.g+=(e.g-c.g)*i,c.b+=(e.b-c.b)*i}return}let u=0,d=0,f=0,p=0,m=0,g=0;const y=yw.search(h,s,7),v=this.curves[y/7];switch(v){case 0:const t=h[y];u=h[y+1],d=h[y+2],f=h[y+3],p=h[y+4],m=h[y+5],g=h[y+6];const e=(s-t)/(h[y+7]-t);u+=(h[y+7+1]-u)*e,d+=(h[y+7+2]-d)*e,f+=(h[y+7+3]-f)*e,p+=(h[y+7+4]-p)*e,m+=(h[y+7+5]-m)*e,g+=(h[y+7+6]-g)*e;break;case 1:u=h[y+1],d=h[y+2],f=h[y+3],p=h[y+4],m=h[y+5],g=h[y+6];break;default:u=this.getBezierValue(s,y,1,v-2),d=this.getBezierValue(s,y,2,v+18-2),f=this.getBezierValue(s,y,3,v+36-2),p=this.getBezierValue(s,y,4,v+54-2),m=this.getBezierValue(s,y,5,v+72-2),g=this.getBezierValue(s,y,6,v+90-2)}if(1==i)l.r=u,l.g=d,l.b=f,c.r=p,c.g=m,c.b=g;else{if(r==uv.setup){const t=o.data.color,e=o.data.darkColor;l.r=t.r,l.g=t.g,l.b=t.b,c.r=e.r,c.g=e.g,c.b=e.b}l.r+=(u-l.r)*i,l.g+=(d-l.g)*i,l.b+=(f-l.b)*i,c.r+=(p-c.r)*i,c.g+=(m-c.g)*i,c.b+=(g-c.b)*i}}}class Nw extends yw{constructor(t,e){super(t,[`${ow}|${e}`]),this.slotIndex=0,this.slotIndex=e,this.attachmentNames=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.attachmentNames[t]=s}apply(t,e,s,n,i,r,a){const o=t.slots[this.slotIndex];o.bone.active&&(a!=dv.mixOut?s<this.frames[0]?r!=uv.setup&&r!=uv.first||this.setAttachment(t,o,o.data.attachmentName):this.setAttachment(t,o,this.attachmentNames[yw.search1(this.frames,s)]):r==uv.setup&&this.setAttachment(t,o,o.data.attachmentName))}setAttachment(t,e,s){e.setAttachment(s?t.getAttachment(this.slotIndex,s):null)}}class Bw extends vw{constructor(t,e,s,n){super(t,e,[`${hw}|${s}|${n.id}`]),this.slotIndex=0,this.slotIndex=s,this.attachment=n,this.vertices=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.vertices[t]=s}setBezier(t,e,s,n,i,r,a,o,h,l,c){const u=this.curves;let d=this.getFrameCount()+18*t;0==s&&(u[e]=2+d);const f=.03*(n-2*r+o),p=.03*h-.06*a,m=.006*(3*(r-o)-n+l),g=.018*(a-h+.33333333);let y=2*f+m,v=2*p+g,x=.3*(r-n)+f+.16666667*m,_=.3*a+p+.16666667*g,b=n+x,w=_;for(let E=d+18;d<E;d+=2)u[d]=b,u[d+1]=w,x+=y,_+=v,y+=m,v+=g,b+=x,w+=_}getCurvePercent(t,e){const s=this.curves;let n=s[e];switch(n){case 0:const s=this.frames[e];return(t-s)/(this.frames[e+this.getFrameEntries()]-s);case 1:return 0}if(n-=2,s[n]>t){const i=this.frames[e];return s[n+1]*(t-i)/(s[n]-i)}const i=n+18;for(n+=2;n<i;n+=2)if(s[n]>=t){const e=s[n-2],i=s[n-1];return i+(t-e)/(s[n]-e)*(s[n+1]-i)}const r=s[i-2],a=s[i-1];return a+(1-a)*(t-r)/(this.frames[e+this.getFrameEntries()]-r)}apply(t,e,s,n,i,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=o.getAttachment();if(!h)return;if(!(h instanceof Lb)||h.timelineAttachment!=this.attachment)return;const l=o.deform;0==l.length&&(r=uv.setup);const c=this.vertices,u=c[0].length,d=this.frames;if(s<d[0]){switch(r){case uv.setup:return void(l.length=0);case uv.first:if(1==i)return void(l.length=0);l.length=u;const t=h;if(t.bones){i=1-i;for(let t=0;t<u;t++)l[t]*=i}else{const e=t.vertices;for(let t=0;t<u;t++)l[t]+=(e[t]-l[t])*i}}return}if(l.length=u,s>=d[d.length-1]){const t=c[d.length-1];if(1==i)if(r==uv.add){const e=h;if(e.bones)for(let s=0;s<u;s++)l[s]+=t[s];else{const s=e.vertices;for(let e=0;e<u;e++)l[e]+=t[e]-s[e]}}else Ov.arrayCopy(t,0,l,0,u);else switch(r){case uv.setup:{const e=h;if(e.bones)for(let s=0;s<u;s++)l[s]=t[s]*i;else{const s=e.vertices;for(let e=0;e<u;e++){const n=s[e];l[e]=n+(t[e]-n)*i}}break}case uv.first:case uv.replace:for(let s=0;s<u;s++)l[s]+=(t[s]-l[s])*i;break;case uv.add:const e=h;if(e.bones)for(let s=0;s<u;s++)l[s]+=t[s]*i;else{const s=e.vertices;for(let e=0;e<u;e++)l[e]+=(t[e]-s[e])*i}}return}const f=yw.search1(d,s),p=this.getCurvePercent(s,f),m=c[f],g=c[f+1];if(1==i)if(r==uv.add){const t=h;if(t.bones)for(let e=0;e<u;e++){const t=m[e];l[e]+=t+(g[e]-t)*p}else{const e=t.vertices;for(let t=0;t<u;t++){const s=m[t];l[t]+=s+(g[t]-s)*p-e[t]}}}else for(let y=0;y<u;y++){const t=m[y];l[y]=t+(g[y]-t)*p}else switch(r){case uv.setup:{const t=h;if(t.bones)for(let e=0;e<u;e++){const t=m[e];l[e]=(t+(g[e]-t)*p)*i}else{const e=t.vertices;for(let t=0;t<u;t++){const s=m[t],n=e[t];l[t]=n+(s+(g[t]-s)*p-n)*i}}break}case uv.first:case uv.replace:for(let e=0;e<u;e++){const t=m[e];l[e]+=(t+(g[e]-t)*p-l[e])*i}break;case uv.add:const t=h;if(t.bones)for(let e=0;e<u;e++){const t=m[e];l[e]+=(t+(g[e]-t)*p)*i}else{const e=t.vertices;for(let t=0;t<u;t++){const s=m[t];l[t]+=(s+(g[t]-s)*p-e[t])*i}}}}}const Lw=class extends yw{constructor(t){super(t,Lw.propertyIds),this.events=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,s,n,i,r,a){if(!n)return;const o=this.frames,h=this.frames.length;if(e>s)this.apply(t,e,Number.MAX_VALUE,n,i,r,a),e=-1;else if(e>=o[h-1])return;if(s<o[0])return;let l=0;if(e<o[0])l=0;else{l=yw.search1(o,e)+1;const t=o[l];for(;l>0&&o[l-1]==t;)l--}for(;l<h&&s>=o[l];l++)n.push(this.events[l])}};let Vw=Lw;Vw.propertyIds=[`${lw}`];const $w=class extends yw{constructor(t){super(t,$w.propertyIds),this.drawOrders=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.drawOrders[t]=s}apply(t,e,s,n,i,r,a){if(a==dv.mixOut)return void(r==uv.setup&&Ov.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));if(s<this.frames[0])return void(r!=uv.setup&&r!=uv.first||Ov.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));const o=yw.search1(this.frames,s),h=this.drawOrders[o];if(h){const e=t.drawOrder,s=t.slots;for(let t=0,n=h.length;t<n;t++)e[t]=s[h[t]]}else Ov.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)}};let Uw=$w;Uw.propertyIds=[`${cw}`];class Xw extends vw{constructor(t,e,s){super(t,e,[`${uw}|${s}`]),this.ikConstraintIndex=0,this.ikConstraintIndex=s}getFrameEntries(){return 6}setFrame(t,e,s,n,i,r,a){t*=6,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=n,this.frames[t+3]=i,this.frames[t+4]=r?1:0,this.frames[t+5]=a?1:0}apply(t,e,s,n,i,r,a){const o=t.ikConstraints[this.ikConstraintIndex];if(!o.active)return;const h=this.frames;if(s<h[0]){switch(r){case uv.setup:return o.mix=o.data.mix,o.softness=o.data.softness,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,void(o.stretch=o.data.stretch);case uv.first:o.mix+=(o.data.mix-o.mix)*i,o.softness+=(o.data.softness-o.softness)*i,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch}return}let l=0,c=0;const u=yw.search(h,s,6),d=this.curves[u/6];switch(d){case 0:const t=h[u];l=h[u+1],c=h[u+2];const e=(s-t)/(h[u+6]-t);l+=(h[u+6+1]-l)*e,c+=(h[u+6+2]-c)*e;break;case 1:l=h[u+1],c=h[u+2];break;default:l=this.getBezierValue(s,u,1,d-2),c=this.getBezierValue(s,u,2,d+18-2)}r==uv.setup?(o.mix=o.data.mix+(l-o.data.mix)*i,o.softness=o.data.softness+(c-o.data.softness)*i,a==dv.mixOut?(o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch):(o.bendDirection=h[u+3],o.compress=0!=h[u+4],o.stretch=0!=h[u+5])):(o.mix+=(l-o.mix)*i,o.softness+=(c-o.softness)*i,a==dv.mixIn&&(o.bendDirection=h[u+3],o.compress=0!=h[u+4],o.stretch=0!=h[u+5]))}}class Yw extends vw{constructor(t,e,s){super(t,e,[`${dw}|${s}`]),this.transformConstraintIndex=0,this.transformConstraintIndex=s}getFrameEntries(){return 7}setFrame(t,e,s,n,i,r,a,o){const h=this.frames;h[t*=7]=e,h[t+1]=s,h[t+2]=n,h[t+3]=i,h[t+4]=r,h[t+5]=a,h[t+6]=o}apply(t,e,s,n,i,r,a){const o=t.transformConstraints[this.transformConstraintIndex];if(!o.active)return;const h=this.frames;if(s<h[0]){const t=o.data;switch(r){case uv.setup:return o.mixRotate=t.mixRotate,o.mixX=t.mixX,o.mixY=t.mixY,o.mixScaleX=t.mixScaleX,o.mixScaleY=t.mixScaleY,void(o.mixShearY=t.mixShearY);case uv.first:o.mixRotate+=(t.mixRotate-o.mixRotate)*i,o.mixX+=(t.mixX-o.mixX)*i,o.mixY+=(t.mixY-o.mixY)*i,o.mixScaleX+=(t.mixScaleX-o.mixScaleX)*i,o.mixScaleY+=(t.mixScaleY-o.mixScaleY)*i,o.mixShearY+=(t.mixShearY-o.mixShearY)*i}return}let l,c,u,d,f,p;const m=yw.search(h,s,7),g=this.curves[m/7];switch(g){case 0:const t=h[m];l=h[m+1],c=h[m+2],u=h[m+3],d=h[m+4],f=h[m+5],p=h[m+6];const e=(s-t)/(h[m+7]-t);l+=(h[m+7+1]-l)*e,c+=(h[m+7+2]-c)*e,u+=(h[m+7+3]-u)*e,d+=(h[m+7+4]-d)*e,f+=(h[m+7+5]-f)*e,p+=(h[m+7+6]-p)*e;break;case 1:l=h[m+1],c=h[m+2],u=h[m+3],d=h[m+4],f=h[m+5],p=h[m+6];break;default:l=this.getBezierValue(s,m,1,g-2),c=this.getBezierValue(s,m,2,g+18-2),u=this.getBezierValue(s,m,3,g+36-2),d=this.getBezierValue(s,m,4,g+54-2),f=this.getBezierValue(s,m,5,g+72-2),p=this.getBezierValue(s,m,6,g+90-2)}if(r==uv.setup){const t=o.data;o.mixRotate=t.mixRotate+(l-t.mixRotate)*i,o.mixX=t.mixX+(c-t.mixX)*i,o.mixY=t.mixY+(u-t.mixY)*i,o.mixScaleX=t.mixScaleX+(d-t.mixScaleX)*i,o.mixScaleY=t.mixScaleY+(f-t.mixScaleY)*i,o.mixShearY=t.mixShearY+(p-t.mixShearY)*i}else o.mixRotate+=(l-o.mixRotate)*i,o.mixX+=(c-o.mixX)*i,o.mixY+=(u-o.mixY)*i,o.mixScaleX+=(d-o.mixScaleX)*i,o.mixScaleY+=(f-o.mixScaleY)*i,o.mixShearY+=(p-o.mixShearY)*i}}class Ww extends xw{constructor(t,e,s){super(t,e,`${fw}|${s}`),this.pathConstraintIndex=0,this.pathConstraintIndex=s}apply(t,e,s,n,i,r,a){const o=t.pathConstraints[this.pathConstraintIndex];if(!o.active)return;if(s<this.frames[0]){switch(r){case uv.setup:return void(o.position=o.data.position);case uv.first:o.position+=(o.data.position-o.position)*i}return}const h=this.getCurveValue(s);r==uv.setup?o.position=o.data.position+(h-o.data.position)*i:o.position+=(h-o.position)*i}}class jw extends xw{constructor(t,e,s){super(t,e,`${pw}|${s}`),this.pathConstraintIndex=0,this.pathConstraintIndex=s}apply(t,e,s,n,i,r,a){const o=t.pathConstraints[this.pathConstraintIndex];if(!o.active)return;if(s<this.frames[0]){switch(r){case uv.setup:return void(o.spacing=o.data.spacing);case uv.first:o.spacing+=(o.data.spacing-o.spacing)*i}return}const h=this.getCurveValue(s);r==uv.setup?o.spacing=o.data.spacing+(h-o.data.spacing)*i:o.spacing+=(h-o.spacing)*i}}class zw extends vw{constructor(t,e,s){super(t,e,[`${mw}|${s}`]),this.pathConstraintIndex=0,this.pathConstraintIndex=s}getFrameEntries(){return 4}setFrame(t,e,s,n,i){const r=this.frames;r[t<<=2]=e,r[t+1]=s,r[t+2]=n,r[t+3]=i}apply(t,e,s,n,i,r,a){const o=t.pathConstraints[this.pathConstraintIndex];if(!o.active)return;const h=this.frames;if(s<h[0]){switch(r){case uv.setup:return o.mixRotate=o.data.mixRotate,o.mixX=o.data.mixX,void(o.mixY=o.data.mixY);case uv.first:o.mixRotate+=(o.data.mixRotate-o.mixRotate)*i,o.mixX+=(o.data.mixX-o.mixX)*i,o.mixY+=(o.data.mixY-o.mixY)*i}return}let l,c,u;const d=yw.search(h,s,4),f=this.curves[d>>2];switch(f){case 0:const t=h[d];l=h[d+1],c=h[d+2],u=h[d+3];const e=(s-t)/(h[d+4]-t);l+=(h[d+4+1]-l)*e,c+=(h[d+4+2]-c)*e,u+=(h[d+4+3]-u)*e;break;case 1:l=h[d+1],c=h[d+2],u=h[d+3];break;default:l=this.getBezierValue(s,d,1,f-2),c=this.getBezierValue(s,d,2,f+18-2),u=this.getBezierValue(s,d,3,f+36-2)}if(r==uv.setup){const t=o.data;o.mixRotate=t.mixRotate+(l-t.mixRotate)*i,o.mixX=t.mixX+(c-t.mixX)*i,o.mixY=t.mixY+(u-t.mixY)*i}else o.mixRotate+=(l-o.mixRotate)*i,o.mixX+=(c-o.mixX)*i,o.mixY+=(u-o.mixY)*i}}const Gw=class extends yw{constructor(t,e,s){super(t,[`${gw}|${e}|${s.sequence.id}`]),this.slotIndex=e,this.attachment=s}getFrameEntries(){return Gw.ENTRIES}getSlotIndex(){return this.slotIndex}getAttachment(){return this.attachment}setFrame(t,e,s,n,i){const r=this.frames;r[t*=Gw.ENTRIES]=e,r[t+Gw.MODE]=s|n<<4,r[t+Gw.DELAY]=i}apply(t,e,s,n,i,r,a){const o=t.slots[this.slotIndex];if(!o.bone.active)return;const h=o.attachment,l=this.attachment;if(!(h==l||h instanceof Lb&&h.timelineAttachment==l))return;const c=this.frames;if(s<c[0])return void(r!=uv.setup&&r!=uv.first||(o.sequenceIndex=-1));const u=yw.search(c,s,Gw.ENTRIES),d=c[u],f=c[u+Gw.MODE],p=c[u+Gw.DELAY];if(!this.attachment.sequence)return;let m=f>>4;const g=this.attachment.sequence.regions.length,y=qb[15&f];if(y!=Hb.hold)switch(m+=(s-d)/p+1e-5|0,y){case Hb.once:m=Math.min(g-1,m);break;case Hb.loop:m%=g;break;case Hb.pingpong:{const t=(g<<1)-2;m=0==t?0:m%t,m>=g&&(m=t-m);break}case Hb.onceReverse:m=Math.max(g-1-m,0);break;case Hb.loopReverse:m=g-1-m%g;break;case Hb.pingpongReverse:{const t=(g<<1)-2;m=0==t?0:(m+g-1)%t,m>=g&&(m=t-m)}}o.sequenceIndex=m}};let Hw=Gw;Hw.ENTRIES=3,Hw.MODE=1,Hw.DELAY=2;const qw=class{constructor(t){this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new Jw(this),this.propertyIDs=new Av,this.animationsChanged=!1,this.trackEntryPool=new Nv((()=>new Qw)),this.data=t}static emptyAnimation(){return qw._emptyAnimation}update(t){t*=this.timeScale;const e=this.tracks;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(!n)continue;n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast;let i=t*n.timeScale;if(n.delay>0){if(n.delay-=i,n.delay>0)continue;i=-n.delay,n.delay=0}let r=n.next;if(r){const e=n.trackLast-r.delay;if(e>=0){for(r.delay=0,r.trackTime+=0==n.timeScale?0:(e/n.timeScale+t)*r.timeScale,n.trackTime+=i,this.setCurrent(s,r,!0);r.mixingFrom;)r.mixTime+=t,r=r.mixingFrom;continue}}else if(n.trackLast>=n.trackEnd&&!n.mixingFrom){e[s]=null,this.queue.end(n),this.clearNext(n);continue}if(n.mixingFrom&&this.updateMixingFrom(n,t)){let t=n.mixingFrom;for(n.mixingFrom=null,t&&(t.mixingTo=null);t;)this.queue.end(t),t=t.mixingFrom}n.trackTime+=i}this.queue.drain()}updateMixingFrom(t,e){const s=t.mixingFrom;if(!s)return!0;const n=this.updateMixingFrom(s,e);return s.animationLast=s.nextAnimationLast,s.trackLast=s.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=s.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=s.mixingFrom,s.mixingFrom&&(s.mixingFrom.mixingTo=t),t.interruptAlpha=s.interruptAlpha,this.queue.end(s)),n):(s.trackTime+=e*s.timeScale,t.mixTime+=e,!1)}apply(t){if(!t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();const e=this.events,s=this.tracks;let n=!1;for(let a=0,o=s.length;a<o;a++){const i=s[a];if(!i||i.delay>0)continue;n=!0;const r=0==a?uv.first:i.mixBlend;let o=i.alpha;i.mixingFrom?o*=this.applyMixingFrom(i,t,r):i.trackTime>=i.trackEnd&&!i.next&&(o=0);const h=i.animationLast,l=i.getAnimationTime();let c=l,u=e;i.reverse&&(c=i.animation.duration-c,u=null);const d=i.animation.timelines,f=d.length;if(0==a&&1==o||r==uv.add)for(let e=0;e<f;e++){const s=d[e];s instanceof Nw?this.applyAttachmentTimeline(s,t,c,r,!0):s.apply(t,h,c,u,o,r,dv.mixIn)}else{const e=i.timelineMode,s=i.shortestRotation,n=!s&&i.timelinesRotation.length!=f<<1;n&&(i.timelinesRotation.length=f<<1);for(let a=0;a<f;a++){const l=d[a],f=e[a]==eE?r:uv.setup;!s&&l instanceof bw?this.applyRotateTimeline(l,t,c,o,f,i.timelinesRotation,a<<1,n):l instanceof Nw?this.applyAttachmentTimeline(l,t,c,r,!0):l.apply(t,h,c,u,o,f,dv.mixIn)}}this.queueEvents(i,l),e.length=0,i.nextAnimationLast=l,i.nextTrackLast=i.trackTime}const i=this.unkeyedState+aE,r=t.slots;for(let a=0,o=t.slots.length;a<o;a++){const e=r[a];if(e.attachmentState==i){const s=e.data.attachmentName;e.setAttachment(s?t.getAttachment(e.data.index,s):null)}}return this.unkeyedState+=2,this.queue.drain(),n}applyMixingFrom(t,e,s){const n=t.mixingFrom;n.mixingFrom&&this.applyMixingFrom(n,e,s);let i=0;0==t.mixDuration?(i=1,s==uv.first&&(s=uv.setup)):(i=t.mixTime/t.mixDuration,i>1&&(i=1),s!=uv.first&&(s=n.mixBlend));const r=i<n.attachmentThreshold,a=i<n.drawOrderThreshold,o=n.animation.timelines,h=o.length,l=n.alpha*t.interruptAlpha,c=l*(1-i),u=n.animationLast,d=n.getAnimationTime();let f=d,p=null;if(n.reverse?f=n.animation.duration-f:i<n.eventThreshold&&(p=this.events),s==uv.add)for(let m=0;m<h;m++)o[m].apply(e,u,f,p,c,s,dv.mixOut);else{const t=n.timelineMode,i=n.timelineHoldMix,d=n.shortestRotation,m=!d&&n.timelinesRotation.length!=h<<1;m&&(n.timelinesRotation.length=h<<1),n.totalAlpha=0;for(let g=0;g<h;g++){const h=o[g];let y,v=dv.mixOut,x=0;switch(t[g]){case eE:if(!a&&h instanceof Uw)continue;y=s,x=c;break;case sE:y=uv.setup,x=c;break;case nE:y=s,x=l;break;case iE:y=uv.setup,x=l;break;default:y=uv.setup;const t=i[g];x=l*Math.max(0,1-t.mixTime/t.mixDuration)}n.totalAlpha+=x,!d&&h instanceof bw?this.applyRotateTimeline(h,e,f,x,y,n.timelinesRotation,g<<1,m):h instanceof Nw?this.applyAttachmentTimeline(h,e,f,y,r):(a&&h instanceof Uw&&y==uv.setup&&(v=dv.mixIn),h.apply(e,u,f,p,x,y,v))}}return t.mixDuration>0&&this.queueEvents(n,d),this.events.length=0,n.nextAnimationLast=d,n.nextTrackLast=n.trackTime,i}applyAttachmentTimeline(t,e,s,n,i){const r=e.slots[t.slotIndex];r.bone.active&&(s<t.frames[0]?n!=uv.setup&&n!=uv.first||this.setAttachment(e,r,r.data.attachmentName,i):this.setAttachment(e,r,t.attachmentNames[yw.search1(t.frames,s)],i),r.attachmentState<=this.unkeyedState&&(r.attachmentState=this.unkeyedState+aE))}setAttachment(t,e,s,n){e.setAttachment(s?t.getAttachment(e.data.index,s):null),n&&(e.attachmentState=this.unkeyedState+oE)}applyRotateTimeline(t,e,s,n,i,r,a,o){if(o&&(r[a]=0),1==n)return void t.apply(e,0,s,null,1,i,dv.mixIn);const h=e.bones[t.boneIndex];if(!h.active)return;let l=0,c=0;if(s<t.frames[0])switch(i){case uv.setup:h.rotation=h.data.rotation;default:return;case uv.first:l=h.rotation,c=h.data.rotation}else l=i==uv.setup?h.data.rotation:h.rotation,c=h.data.rotation+t.getCurveValue(s);let u=0,d=c-l;if(d-=360*(16384-(16384.499999999996-d/360|0)),0==d)u=r[a];else{let t=0,e=0;o?(t=0,e=d):(t=r[a],e=r[a+1]);const s=d>0;let n=t>=0;Pv.signum(e)!=Pv.signum(d)&&Math.abs(e)<=90&&(Math.abs(t)>180&&(t+=360*Pv.signum(t)),n=s),u=d+t-t%360,n!=s&&(u+=360*Pv.signum(t)),r[a]=u}r[a+1]=d,h.rotation=l+u*n}queueEvents(t,e){const s=t.animationStart,n=t.animationEnd,i=n-s,r=t.trackLast%i,a=this.events;let o=0;const h=a.length;for(;o<h;o++){const e=a[o];if(e.time<r)break;e.time>n||this.queue.event(t,e)}let l=!1;for(l=t.loop?0==i||r>t.trackTime%i:e>=n&&t.animationLast<n,l&&this.queue.complete(t);o<h;o++){const e=a[o];e.time<s||this.queue.event(t,e)}}clearTracks(){const t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,s=this.tracks.length;e<s;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;const e=this.tracks[t];if(!e)return;this.queue.end(e),this.clearNext(e);let s=e;for(;;){const t=s.mixingFrom;if(!t)break;this.queue.end(t),s.mixingFrom=null,s.mixingTo=null,s=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,s){const n=this.expandToIndex(t);this.tracks[t]=e,e.previous=null,n&&(s&&this.queue.interrupt(n),e.mixingFrom=n,n.mixingTo=e,e.mixTime=0,n.mixingFrom&&n.mixDuration>0&&(e.interruptAlpha*=Math.min(1,n.mixTime/n.mixDuration)),n.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,s=!1){const n=this.data.skeletonData.findAnimation(e);if(!n)throw new Error(`Animation not found: ${e}`);return this.setAnimationWith(t,n,s)}setAnimationWith(t,e,s=!1){if(!e)throw new Error("animation cannot be null.");let n=!0,i=this.expandToIndex(t);i&&(-1==i.nextTrackLast?(this.tracks[t]=i.mixingFrom,this.queue.interrupt(i),this.queue.end(i),this.clearNext(i),i=i.mixingFrom,n=!1):this.clearNext(i));const r=this.trackEntry(t,e,s,i);return this.setCurrent(t,r,n),this.queue.drain(),r}addAnimation(t,e,s=!1,n=0){const i=this.data.skeletonData.findAnimation(e);if(!i)throw new Error(`Animation not found: ${e}`);return this.addAnimationWith(t,i,s,n)}addAnimationWith(t,e,s=!1,n=0){if(!e)throw new Error("animation cannot be null.");let i=this.expandToIndex(t);if(i)for(;i.next;)i=i.next;const r=this.trackEntry(t,e,s,i);return i?(i.next=r,r.previous=i,n<=0&&(n+=i.getTrackComplete()-r.mixDuration)):(this.setCurrent(t,r,!0),this.queue.drain()),r.delay=n,r}setEmptyAnimation(t,e=0){const s=this.setAnimationWith(t,qw.emptyAnimation(),!1);return s.mixDuration=e,s.trackEnd=e,s}addEmptyAnimation(t,e=0,s=0){const n=this.addAnimationWith(t,qw.emptyAnimation(),!1,s);return s<=0&&(n.delay+=n.mixDuration-e),n.mixDuration=e,n.trackEnd=e,n}setEmptyAnimations(t=0){const e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let s=0,n=this.tracks.length;s<n;s++){const e=this.tracks[s];e&&this.setEmptyAnimation(e.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(Ov.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,s,n){const i=this.trackEntryPool.obtain();return i.reset(),i.trackIndex=t,i.animation=e,i.loop=s,i.holdPrevious=!1,i.reverse=!1,i.shortestRotation=!1,i.eventThreshold=0,i.attachmentThreshold=0,i.drawOrderThreshold=0,i.animationStart=0,i.animationEnd=e.duration,i.animationLast=-1,i.nextAnimationLast=-1,i.delay=0,i.trackTime=0,i.trackLast=-1,i.nextTrackLast=-1,i.trackEnd=Number.MAX_VALUE,i.timeScale=1,i.alpha=1,i.mixTime=0,i.mixDuration=n?this.data.getMix(n.animation,e):0,i.interruptAlpha=1,i.totalAlpha=0,i.mixBlend=uv.replace,i}clearNext(t){let e=t.next;for(;e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();const t=this.tracks;for(let e=0,s=t.length;e<s;e++){let s=t[e];if(s){for(;s.mixingFrom;)s=s.mixingFrom;do{s.mixingTo&&s.mixBlend==uv.add||this.computeHold(s),s=s.mixingTo}while(s)}}}computeHold(t){const e=t.mixingTo,s=t.animation.timelines,n=t.animation.timelines.length,i=t.timelineMode;i.length=n;const r=t.timelineHoldMix;r.length=0;const a=this.propertyIDs;if(e&&e.holdPrevious)for(let o=0;o<n;o++)i[o]=a.addAll(s[o].getPropertyIds())?iE:nE;else t:for(let o=0;o<n;o++){const n=s[o],h=n.getPropertyIds();if(a.addAll(h))if(!e||n instanceof Nw||n instanceof Uw||n instanceof Vw||!e.animation.hasTimeline(h))i[o]=sE;else{for(let s=e.mixingTo;s;s=s.mixingTo)if(!s.animation.hasTimeline(h)){if(t.mixDuration>0){i[o]=rE,r[o]=s;continue t}break}i[o]=iE}else i[o]=eE}}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(!t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){const e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}setAnimationByName(t,e,s){qw.deprecatedWarning1||(qw.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")),this.setAnimation(t,e,s)}addAnimationByName(t,e,s,n){qw.deprecatedWarning2||(qw.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")),this.addAnimation(t,e,s,n)}hasAnimation(t){return null!==this.data.skeletonData.findAnimation(t)}hasAnimationByName(t){return qw.deprecatedWarning3||(qw.deprecatedWarning3=!0,console.warn("Spine Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")),this.hasAnimation(t)}};let Kw=qw;Kw._emptyAnimation=new Kb("<empty>",[],0),Kw.deprecatedWarning1=!1,Kw.deprecatedWarning2=!1,Kw.deprecatedWarning3=!1;const Zw=class{constructor(){this.animation=null,this.previous=null,this.next=null,this.mixingFrom=null,this.mixingTo=null,this.listener=null,this.trackIndex=0,this.loop=!1,this.holdPrevious=!1,this.reverse=!1,this.shortestRotation=!1,this.eventThreshold=0,this.attachmentThreshold=0,this.drawOrderThreshold=0,this.animationStart=0,this.animationEnd=0,this.animationLast=0,this.nextAnimationLast=0,this.delay=0,this.trackTime=0,this.trackLast=0,this.nextTrackLast=0,this.trackEnd=0,this.timeScale=0,this.alpha=0,this.mixTime=0,this.mixDuration=0,this.interruptAlpha=0,this.totalAlpha=0,this.mixBlend=uv.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.previous=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){const t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}getTrackComplete(){const t=this.animationEnd-this.animationStart;if(0!=t){if(this.loop)return t*(1+(this.trackTime/t|0));if(this.trackTime<t)return t}return this.trackTime}get time(){return Zw.deprecatedWarning1||(Zw.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime}set time(t){Zw.deprecatedWarning1||(Zw.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime=t}get endTime(){return Zw.deprecatedWarning2||(Zw.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime}set endTime(t){Zw.deprecatedWarning2||(Zw.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime=t}loopsCount(){return Math.floor(this.trackTime/this.trackEnd)}};let Qw=Zw;Qw.deprecatedWarning1=!1,Qw.deprecatedWarning2=!1;class Jw{constructor(t){this.objects=[],this.drainDisabled=!1,this.animState=t}start(t){this.objects.push(tE.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(tE.interrupt),this.objects.push(t)}end(t){this.objects.push(tE.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(tE.dispose),this.objects.push(t)}complete(t){this.objects.push(tE.complete),this.objects.push(t)}event(t,e){this.objects.push(tE.event),this.objects.push(t),this.objects.push(e)}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;const t=this.objects,e=this.animState.listeners;for(let s=0;s<t.length;s+=2){const n=t[s],i=t[s+1];switch(n){case tE.start:i.listener&&i.listener.start&&i.listener.start(i);for(let t=0;t<e.length;t++){const s=e[t];s.start&&s.start(i)}break;case tE.interrupt:i.listener&&i.listener.interrupt&&i.listener.interrupt(i);for(let t=0;t<e.length;t++){const s=e[t];s.interrupt&&s.interrupt(i)}break;case tE.end:i.listener&&i.listener.end&&i.listener.end(i);for(let t=0;t<e.length;t++){const s=e[t];s.end&&s.end(i)}case tE.dispose:i.listener&&i.listener.dispose&&i.listener.dispose(i);for(let t=0;t<e.length;t++){const s=e[t];s.dispose&&s.dispose(i)}this.animState.trackEntryPool.free(i);break;case tE.complete:i.listener&&i.listener.complete&&i.listener.complete(i);for(let t=0;t<e.length;t++){const s=e[t];s.complete&&s.complete(i)}break;case tE.event:const n=t[2+s++];i.listener&&i.listener.event&&i.listener.event(i,n);for(let t=0;t<e.length;t++){const s=e[t];s.event&&s.event(i,n)}}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}}var tE=(t=>(t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event",t))(tE||{});const eE=0,sE=1,nE=2,iE=3,rE=4,aE=1,oE=2;class hE{constructor(t){if(this.animationToMixTime={},this.defaultMix=0,!t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,s){const n=this.skeletonData.findAnimation(t);if(!n)throw new Error(`Animation not found: ${t}`);const i=this.skeletonData.findAnimation(e);if(!i)throw new Error(`Animation not found: ${e}`);this.setMixWith(n,i,s)}setMixWith(t,e,s){if(!t)throw new Error("from cannot be null.");if(!e)throw new Error("to cannot be null.");const n=`${t.name}.${e.name}`;this.animationToMixTime[n]=s}getMix(t,e){const s=`${t.name}.${e.name}`,n=this.animationToMixTime[s];return void 0===n?this.defaultMix:n}}class lE{constructor(t){this.atlas=t}loadSequence(t,e,s){const n=s.regions;for(let i=0,r=n.length;i<r;i++){const r=s.getPath(e,i),a=this.atlas.findRegion(r);if(null==a)throw new Error(`Region not found in atlas: ${r} (sequence: ${t})`);n[i]=a,n[i].renderObject=n[i]}}newRegionAttachment(t,e,s,n){const i=new jb(e,s);if(null!=n)this.loadSequence(e,s,n);else{const t=this.atlas.findRegion(s);if(!t)throw new Error(`Region not found in atlas: ${s} (region attachment: ${e})`);t.renderObject=t,i.region=t}return i}newMeshAttachment(t,e,s,n){const i=new Ub(e,s);if(null!=n)this.loadSequence(e,s,n);else{const t=this.atlas.findRegion(s);if(!t)throw new Error(`Region not found in atlas: ${s} (mesh attachment: ${e})`);t.renderObject=t,i.region=t}return i}newBoundingBoxAttachment(t,e){return new Vb(e)}newPathAttachment(t,e){return new Xb(e)}newPointAttachment(t,e){return new Yb(e)}newClippingAttachment(t,e){return new $b(e)}}class cE{constructor(t,e,s){if(this.matrix=new Ch,this.parent=null,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.sorted=!1,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=s,this.setToSetupPose()}get worldX(){return this.matrix.tx}get worldY(){return this.matrix.ty}isActive(){return this.active}update(){this.updateWorldTransformWith(this.ax,this.ay,this.arotation,this.ascaleX,this.ascaleY,this.ashearX,this.ashearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,s,n,i,r,a){this.ax=t,this.ay=e,this.arotation=s,this.ascaleX=n,this.ascaleY=i,this.ashearX=r,this.ashearY=a;const o=this.parent,h=this.matrix,l=this.skeleton.scaleX,c=-this.skeleton.scaleY;if(!o){const o=this.skeleton,u=s+90+a;return h.a=Pv.cosDeg(s+r)*n*l,h.c=Pv.cosDeg(u)*i*l,h.b=Pv.sinDeg(s+r)*n*c,h.d=Pv.sinDeg(u)*i*c,h.tx=t*l+o.x,void(h.ty=e*c+o.y)}let u=o.matrix.a,d=o.matrix.c,f=o.matrix.b,p=o.matrix.d;switch(h.tx=u*t+d*e+o.matrix.tx,h.ty=f*t+p*e+o.matrix.ty,this.data.transformMode){case mv.Normal:{const t=s+90+a,e=Pv.cosDeg(s+r)*n,o=Pv.cosDeg(t)*i,l=Pv.sinDeg(s+r)*n,c=Pv.sinDeg(t)*i;return h.a=u*e+d*l,h.c=u*o+d*c,h.b=f*e+p*l,void(h.d=f*o+p*c)}case mv.OnlyTranslation:{const t=s+90+a;h.a=Pv.cosDeg(s+r)*n,h.c=Pv.cosDeg(t)*i,h.b=Pv.sinDeg(s+r)*n,h.d=Pv.sinDeg(t)*i;break}case mv.NoRotationOrReflection:{let t=u*u+f*f,e=0;t>1e-4?(t=Math.abs(u*p-d*f)/t,u/=l,f/=c,d=f*t,p=u*t,e=Math.atan2(f,u)*Pv.radDeg):(u=0,f=0,e=90-Math.atan2(p,d)*Pv.radDeg);const o=s+r-e,m=s+a-e+90,g=Pv.cosDeg(o)*n,y=Pv.cosDeg(m)*i,v=Pv.sinDeg(o)*n,x=Pv.sinDeg(m)*i;h.a=u*g-d*v,h.c=u*y-d*x,h.b=f*g+p*v,h.d=f*y+p*x;break}case mv.NoScale:case mv.NoScaleOrReflection:{const t=Pv.cosDeg(s),e=Pv.sinDeg(s);let o=(u*t+d*e)/l,m=(f*t+p*e)/c,g=Math.sqrt(o*o+m*m);g>1e-5&&(g=1/g),o*=g,m*=g,g=Math.sqrt(o*o+m*m),this.data.transformMode==mv.NoScale&&u*p-d*f<0!=(l<0!=c<0)&&(g=-g);const y=Math.PI/2+Math.atan2(m,o),v=Math.cos(y)*g,x=Math.sin(y)*g,_=Pv.cosDeg(r)*n,b=Pv.cosDeg(90+a)*i,w=Pv.sinDeg(r)*n,E=Pv.sinDeg(90+a)*i;h.a=o*_+v*w,h.c=o*b+v*E,h.b=m*_+x*w,h.d=m*b+x*E;break}}h.a*=l,h.c*=l,h.b*=c,h.d*=c}setToSetupPose(){const t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.matrix.b,this.matrix.a)*Pv.radDeg}getWorldRotationY(){return Math.atan2(this.matrix.d,this.matrix.c)*Pv.radDeg}getWorldScaleX(){const t=this.matrix;return Math.sqrt(t.a*t.a+t.b*t.b)}getWorldScaleY(){const t=this.matrix;return Math.sqrt(t.c*t.c+t.d*t.d)}updateAppliedTransform(){const t=this.parent,e=this.matrix;if(!t)return this.ax=e.tx-this.skeleton.x,this.ay=e.ty-this.skeleton.y,this.arotation=Math.atan2(e.b,e.a)*Pv.radDeg,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*Pv.radDeg);const s=t.matrix,n=1/(s.a*s.d-s.b*s.c),i=e.tx-s.tx,r=e.ty-s.ty;this.ax=i*s.d*n-r*s.c*n,this.ay=r*s.a*n-i*s.b*n;const a=n*s.d,o=n*s.a,h=n*s.c,l=n*s.b,c=a*e.a-h*e.b,u=a*e.c-h*e.d,d=o*e.b-l*e.a,f=o*e.d-l*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(c*c+d*d),this.ascaleX>1e-4){const t=c*f-u*d;this.ascaleY=t/this.ascaleX,this.ashearY=Math.atan2(c*u+d*f,t)*Pv.radDeg,this.arotation=Math.atan2(d,c)*Pv.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(u*u+f*f),this.ashearY=0,this.arotation=90-Math.atan2(f,u)*Pv.radDeg}worldToLocal(t){const e=this.matrix,s=e.a,n=e.c,i=e.b,r=e.d,a=1/(s*r-n*i),o=t.x-e.tx,h=t.y-e.ty;return t.x=o*r*a-h*n*a,t.y=h*s*a-o*i*a,t}localToWorld(t){const e=this.matrix,s=t.x,n=t.y;return t.x=s*e.a+n*e.c+e.tx,t.y=s*e.b+n*e.d+e.ty,t}worldToLocalRotation(t){const e=Pv.sinDeg(t),s=Pv.cosDeg(t),n=this.matrix;return Math.atan2(n.a*e-n.b*s,n.d*s-n.c*e)*Pv.radDeg}localToWorldRotation(t){t-=this.rotation-this.shearX;const e=Pv.sinDeg(t),s=Pv.cosDeg(t),n=this.matrix;return Math.atan2(s*n.b+e*n.d,s*n.a+e*n.c)*Pv.radDeg}rotateWorld(t){const e=this.matrix,s=e.a,n=e.c,i=e.b,r=e.d,a=Pv.cosDeg(t),o=Pv.sinDeg(t);e.a=a*s-o*i,e.c=a*n-o*r,e.b=o*s+a*i,e.d=o*n+a*r}}class uE{constructor(t,e,s){if(this.index=0,this.parent=null,this.length=0,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=mv.Normal,this.skinRequired=!1,this.color=new Mv,t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=s}}class dE{constructor(t,e,s){this.name=t,this.order=e,this.skinRequired=s}}let fE=class{constructor(t,e){if(this.intValue=0,this.floatValue=0,this.stringValue=null,this.time=0,this.volume=0,this.balance=0,!e)throw new Error("data cannot be null.");this.time=t,this.data=e}};class pE{constructor(t){this.intValue=0,this.floatValue=0,this.stringValue=null,this.audioPath=null,this.volume=0,this.balance=0,this.name=t}}class mE{constructor(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let n=0;n<t.bones.length;n++){const s=e.findBone(t.bones[n].name);if(!s)throw new Error(`Couldn't find bone ${t.bones[n].name}`);this.bones.push(s)}const s=e.findBone(t.target.name);if(!s)throw new Error(`Couldn't find bone ${t.target.name}`);this.target=s}isActive(){return this.active}update(){if(0==this.mix)return;const t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.data.uniform,this.softness,this.mix)}}apply1(t,e,s,n,i,r,a){const o=t.parent.matrix;if(!o)throw new Error("IK bone must have parent.");const h=o.a;let l=o.c;const c=o.b;let u=o.d,d=-t.ashearX-t.arotation,f=0,p=0;const m=t.skeleton.scaleX,g=-t.skeleton.scaleY;switch(t.data.transformMode){case mv.OnlyTranslation:f=e-t.worldX,p=s-t.worldY,p=-p;break;case mv.NoRotationOrReflection:const n=Math.abs(h*u-l*c)/(h*h+c*c),i=h/m,r=c/g;l=-r*n*m,u=i*n*g,d+=Math.atan2(r,i)*Pv.radDeg;default:const a=e-o.tx,y=s-o.ty,v=h*u-l*c;f=(a*u-y*l)/v-t.ax,p=(y*h-a*c)/v-t.ay}d+=Math.atan2(p,f)*Pv.radDeg,t.ascaleX<0&&(d+=180),d>180?d-=360:d<-180&&(d+=360);let y=t.ascaleX,v=t.ascaleY;if(n||i){switch(t.data.transformMode){case mv.NoScale:case mv.NoScaleOrReflection:f=e-t.worldX,p=s-t.worldY}const o=t.data.length*y,h=Math.sqrt(f*f+p*p);if(n&&h<o||i&&h>o&&o>1e-4){const t=(h/o-1)*a+1;y*=t,r&&(v*=t)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+d*a,y,v,t.ashearX,t.ashearY)}apply2(t,e,s,n,i,r,a,o,h){const l=t.ax,c=t.ay;let u=t.ascaleX,d=t.ascaleY,f=u,p=d,m=e.ascaleX;const g=t.matrix;let y=0,v=0,x=0;u<0?(u=-u,y=180,x=-1):(y=0,x=1),d<0&&(d=-d,x=-x),m<0?(m=-m,v=180):v=0;const _=e.ax;let b=0,w=0,E=0,S=g.a,T=g.c,A=g.b,C=g.d;const M=Math.abs(u-d)<=1e-4;!M||r?(b=0,w=S*_+g.tx,E=A*_+g.ty):(b=e.ay,w=S*_+T*b+g.tx,E=A*_+C*b+g.ty);const I=t.parent.matrix;if(!I)throw new Error("IK parent must itself have a parent.");S=I.a,T=I.c,A=I.b,C=I.d;const P=1/(S*C-T*A);let R=w-I.tx,k=E-I.ty;const D=(R*C-k*T)*P-l,F=(k*S-R*A)*P-c,O=Math.sqrt(D*D+F*F);let N,B,L=e.data.length*m;if(O<1e-4)return this.apply1(t,s,n,!1,r,!1,h),void e.updateWorldTransformWith(_,b,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);R=s-I.tx,k=n-I.ty;let V=(R*C-k*T)*P-l,$=(k*S-R*A)*P-c,U=V*V+$*$;if(0!=o){o*=u*(m+1)*.5;const t=Math.sqrt(U),e=t-O-L*u+o;if(e>0){let s=Math.min(1,e/(2*o))-1;s=(e-o*(1-s*s))/t,V-=s*V,$-=s*$,U=V*V+$*$}}t:if(M){L*=u;let t=(U-O*O-L*L)/(2*O*L);t<-1?(t=-1,B=Math.PI*i):t>1?(t=1,B=0,r&&(S=(Math.sqrt(U)/(O+L)-1)*h+1,f*=S,a&&(p*=S))):B=Math.acos(t)*i,S=O+L*t,T=L*Math.sin(B),N=Math.atan2($*S-V*T,V*S+$*T)}else{S=u*L,T=d*L;const t=S*S,e=T*T,s=Math.atan2($,V);A=e*O*O+t*U-t*e;const n=-2*e*O,r=e-t;if(C=n*n-4*r*A,C>=0){let t=Math.sqrt(C);n<0&&(t=-t),t=.5*-(n+t);const e=t/r,a=A/t,o=Math.abs(e)<Math.abs(a)?e:a;if(o*o<=U){k=Math.sqrt(U-o*o)*i,N=s-Math.atan2(k,o),B=Math.atan2(k/d,(o-O)/u);break t}}let a=Pv.PI,o=O-S,h=o*o,l=0,c=0,f=O+S,p=f*f,m=0;A=-S*O/(t-e),A>=-1&&A<=1&&(A=Math.acos(A),R=S*Math.cos(A)+O,k=T*Math.sin(A),C=R*R+k*k,C<h&&(a=A,h=C,o=R,l=k),C>p&&(c=A,p=C,f=R,m=k)),U<=.5*(h+p)?(N=s-Math.atan2(l*i,o),B=a*i):(N=s-Math.atan2(m*i,f),B=c*i)}const X=Math.atan2(b,_)*x;let Y=t.arotation;N=(N-X)*Pv.radDeg+y-Y,N>180?N-=360:N<-180&&(N+=360),t.updateWorldTransformWith(l,c,Y+N*h,f,p,0,0),Y=e.arotation,B=((B+X)*Pv.radDeg-e.ashearX)*x+v-Y,B>180?B-=360:B<-180&&(B+=360),e.updateWorldTransformWith(_,b,Y+B*h,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}}class gE extends dE{constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.softness=0}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}}class yE extends dE{constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.positionMode=fv.Fixed,this.spacingMode=vE.Fixed,this.rotateMode=pv.Chain,this.offsetRotation=0,this.position=0,this.spacing=0,this.mixRotate=0,this.mixX=0,this.mixY=0}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("SlotData not set.")}}var vE=(t=>(t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent",t[t.Proportional=3]="Proportional",t))(vE||{});const xE=class{constructor(t,e){if(this.position=0,this.spacing=0,this.mixRotate=0,this.mixX=0,this.mixY=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let n=0,i=t.bones.length;n<i;n++){const s=e.findBone(t.bones[n].name);if(!s)throw new Error(`Couldn't find bone ${t.bones[n].name}.`);this.bones.push(s)}const s=e.findSlot(t.target.name);if(!s)throw new Error(`Couldn't find target bone ${t.target.name}`);this.target=s,this.position=t.position,this.spacing=t.spacing,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY}isActive(){return this.active}update(){const t=this.target.getAttachment();if(!(t instanceof Xb))return;const e=this.mixRotate,s=this.mixX,n=this.mixY;if(0==e&&0==s&&0==n)return;const i=this.data,r=i.rotateMode==pv.Tangent,a=i.rotateMode==pv.ChainScale,o=this.bones,h=o.length,l=r?h:h+1,c=Ov.setArraySize(this.spaces,l),u=a?this.lengths=Ov.setArraySize(this.lengths,h):[],d=this.spacing;switch(i.spacingMode){case vE.Percent:if(a)for(let s=0,n=l-1;s<n;s++){const t=o[s],e=t.data.length;if(e<xE.epsilon)u[s]=0;else{const n=e*t.matrix.a,i=e*t.matrix.b;u[s]=Math.sqrt(n*n+i*i)}}Ov.arrayFill(c,1,l,d);break;case vE.Proportional:let t=0;for(let s=0,n=l-1;s<n;){const e=o[s],n=e.data.length;if(n<xE.epsilon)a&&(u[s]=0),c[++s]=d;else{const i=n*e.matrix.a,r=n*e.matrix.b,o=Math.sqrt(i*i+r*r);a&&(u[s]=o),c[++s]=o,t+=o}}if(t>0){t=l/t*d;for(let e=1;e<l;e++)c[e]*=t}break;default:const e=i.spacingMode==vE.Length;for(let s=0,n=l-1;s<n;){const t=o[s],n=t.data.length;if(n<xE.epsilon)a&&(u[s]=0),c[++s]=d;else{const i=n*t.matrix.a,r=n*t.matrix.b,o=Math.sqrt(i*i+r*r);a&&(u[s]=o),c[++s]=(e?n+d:d)*o/n}}}const f=this.computeWorldPositions(t,l,r);let p=f[0],m=f[1],g=i.offsetRotation,y=!1;if(0==g)y=i.rotateMode==pv.Chain;else{y=!1;const t=this.target.bone.matrix;g*=t.a*t.d-t.b*t.c>0?Pv.degRad:-Pv.degRad}for(let v=0,x=3;v<h;v++,x+=3){const t=o[v],i=t.matrix;i.tx+=(p-i.tx)*s,i.ty+=(m-i.ty)*n;const h=f[x],l=f[x+1],d=h-p,_=l-m;if(a){const t=u[v];if(0!=t){const s=(Math.sqrt(d*d+_*_)/t-1)*e+1;i.a*=s,i.b*=s}}if(p=h,m=l,e>0){const s=i.a,n=i.c,a=i.b,o=i.d;let h=0,l=0,u=0;if(h=r?f[x-1]:0==c[v+1]?f[x+2]:Math.atan2(_,d),h-=Math.atan2(a,s),y){l=Math.cos(h),u=Math.sin(h);const n=t.data.length;p+=(n*(l*s-u*a)-d)*e,m+=(n*(u*s+l*a)-_)*e}else h+=g;h>Pv.PI?h-=Pv.PI2:h<-Pv.PI&&(h+=Pv.PI2),h*=e,l=Math.cos(h),u=Math.sin(h),i.a=l*s-u*a,i.c=l*n-u*o,i.b=u*s+l*a,i.d=u*n+l*o}t.updateAppliedTransform()}}computeWorldPositions(t,e,s){const n=this.target;let i=this.position;const r=this.spaces,a=Ov.setArraySize(this.positions,3*e+2);let o=this.world;const h=t.closed;let l=t.worldVerticesLength,c=l/6,u=xE.NONE;if(!t.constantSpeed){const d=t.lengths;c-=h?1:2;const f=d[c];let p;switch(this.data.positionMode==fv.Percent&&(i*=f),this.data.spacingMode){case vE.Percent:p=f;break;case vE.Proportional:p=f/e;break;default:p=1}o=Ov.setArraySize(this.world,8);for(let m=0,g=0,y=0;m<e;m++,g+=3){const e=r[m]*p;i+=e;let v=i;if(h)v%=f,v<0&&(v+=f),y=0;else{if(v<0){u!=xE.BEFORE&&(u=xE.BEFORE,t.computeWorldVertices(n,2,4,o,0,2)),this.addBeforePosition(v,o,0,a,g);continue}if(v>f){u!=xE.AFTER&&(u=xE.AFTER,t.computeWorldVertices(n,l-6,4,o,0,2)),this.addAfterPosition(v-f,o,0,a,g);continue}}for(;;y++){const t=d[y];if(!(v>t)){if(0==y)v/=t;else{const e=d[y-1];v=(v-e)/(t-e)}break}}y!=u&&(u=y,h&&y==c?(t.computeWorldVertices(n,l-4,4,o,0,2),t.computeWorldVertices(n,0,4,o,4,2)):t.computeWorldVertices(n,6*y+2,8,o,0,2)),this.addCurvePosition(v,o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],a,g,s||m>0&&0==e)}return a}h?(l+=2,o=Ov.setArraySize(this.world,l),t.computeWorldVertices(n,2,l-4,o,0,2),t.computeWorldVertices(n,0,2,o,l-4,2),o[l-2]=o[0],o[l-1]=o[1]):(c--,l-=4,o=Ov.setArraySize(this.world,l),t.computeWorldVertices(n,2,l,o,0,2));const d=Ov.setArraySize(this.curves,c);let f,p=0,m=o[0],g=o[1],y=0,v=0,x=0,_=0,b=0,w=0,E=0,S=0,T=0,A=0,C=0,M=0,I=0,P=0;for(let D=0,F=2;D<c;D++,F+=6)y=o[F],v=o[F+1],x=o[F+2],_=o[F+3],b=o[F+4],w=o[F+5],E=.1875*(m-2*y+x),S=.1875*(g-2*v+_),T=.09375*(3*(y-x)-m+b),A=.09375*(3*(v-_)-g+w),C=2*E+T,M=2*S+A,I=.75*(y-m)+E+.16666667*T,P=.75*(v-g)+S+.16666667*A,p+=Math.sqrt(I*I+P*P),I+=C,P+=M,C+=T,M+=A,p+=Math.sqrt(I*I+P*P),I+=C,P+=M,p+=Math.sqrt(I*I+P*P),I+=C+T,P+=M+A,p+=Math.sqrt(I*I+P*P),d[D]=p,m=b,g=w;switch(this.data.positionMode==fv.Percent&&(i*=p),this.data.spacingMode){case vE.Percent:f=p;break;case vE.Proportional:f=p/e;break;default:f=1}const R=this.segments;let k=0;for(let D=0,F=0,O=0,N=0;D<e;D++,F+=3){const t=r[D]*f;i+=t;let e=i;if(h)e%=p,e<0&&(e+=p),O=0;else{if(e<0){this.addBeforePosition(e,o,0,a,F);continue}if(e>p){this.addAfterPosition(e-p,o,l-4,a,F);continue}}for(;;O++){const t=d[O];if(!(e>t)){if(0==O)e/=t;else{const s=d[O-1];e=(e-s)/(t-s)}break}}if(O!=u){u=O;let t=6*O;for(m=o[t],g=o[t+1],y=o[t+2],v=o[t+3],x=o[t+4],_=o[t+5],b=o[t+6],w=o[t+7],E=.03*(m-2*y+x),S=.03*(g-2*v+_),T=.006*(3*(y-x)-m+b),A=.006*(3*(v-_)-g+w),C=2*E+T,M=2*S+A,I=.3*(y-m)+E+.16666667*T,P=.3*(v-g)+S+.16666667*A,k=Math.sqrt(I*I+P*P),R[0]=k,t=1;t<8;t++)I+=C,P+=M,C+=T,M+=A,k+=Math.sqrt(I*I+P*P),R[t]=k;I+=C,P+=M,k+=Math.sqrt(I*I+P*P),R[8]=k,I+=C+T,P+=M+A,k+=Math.sqrt(I*I+P*P),R[9]=k,N=0}for(e*=k;;N++){const t=R[N];if(!(e>t)){if(0==N)e/=t;else{const s=R[N-1];e=N+(e-s)/(t-s)}break}}this.addCurvePosition(.1*e,m,g,y,v,x,_,b,w,a,F,s||D>0&&0==t)}return a}addBeforePosition(t,e,s,n,i){const r=e[s],a=e[s+1],o=e[s+2]-r,h=e[s+3]-a,l=Math.atan2(h,o);n[i]=r+t*Math.cos(l),n[i+1]=a+t*Math.sin(l),n[i+2]=l}addAfterPosition(t,e,s,n,i){const r=e[s+2],a=e[s+3],o=r-e[s],h=a-e[s+1],l=Math.atan2(h,o);n[i]=r+t*Math.cos(l),n[i+1]=a+t*Math.sin(l),n[i+2]=l}addCurvePosition(t,e,s,n,i,r,a,o,h,l,c,u){if(0==t||isNaN(t))return l[c]=e,l[c+1]=s,void(l[c+2]=Math.atan2(i-s,n-e));const d=t*t,f=d*t,p=1-t,m=p*p,g=m*p,y=p*t,v=3*y,x=p*v,_=v*t,b=e*g+n*x+r*_+o*f,w=s*g+i*x+a*_+h*f;l[c]=b,l[c+1]=w,u&&(l[c+2]=t<.001?Math.atan2(i-s,n-e):Math.atan2(w-(s*m+i*y*2+a*d),b-(e*m+n*y*2+r*d)))}};let _E=xE;_E.NONE=-1,_E.BEFORE=-2,_E.AFTER=-3,_E.epsilon=1e-5;class bE{constructor(t,e){if(this.darkColor=null,this.attachment=null,this.attachmentState=0,this.sequenceIndex=-1,this.deform=new Array,!t)throw new Error("data cannot be null.");if(!e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new Mv,this.darkColor=t.darkColor?new Mv:null,this.setToSetupPose(),this.blendMode=this.data.blendMode}getSkeleton(){return this.bone.skeleton}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(t instanceof Lb&&this.attachment instanceof Lb&&t.timelineAttachment==this.attachment.timelineAttachment||(this.deform.length=0),this.attachment=t,this.sequenceIndex=-1)}setToSetupPose(){this.color.setFromColor(this.data.color),this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),this.data.attachmentName?(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName))):this.attachment=null}}class wE{constructor(t,e){if(this.mixRotate=0,this.mixX=0,this.mixY=0,this.mixScaleX=0,this.mixScaleY=0,this.mixShearY=0,this.temp=new Bv,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY,this.mixScaleX=t.mixScaleX,this.mixScaleY=t.mixScaleY,this.mixShearY=t.mixShearY,this.bones=new Array;for(let n=0;n<t.bones.length;n++){const s=e.findBone(t.bones[n].name);if(!s)throw new Error(`Couldn't find bone ${t.bones[n].name}.`);this.bones.push(s)}const s=e.findBone(t.target.name);if(!s)throw new Error(`Couldn't find target bone ${t.target.name}.`);this.target=s}isActive(){return this.active}update(){0==this.mixRotate&&0==this.mixX&&0==this.mixY&&0==this.mixScaleX&&0==this.mixScaleX&&0==this.mixShearY||(this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld())}applyAbsoluteWorld(){const t=this.mixRotate,e=this.mixX,s=this.mixY,n=this.mixScaleX,i=this.mixScaleY,r=this.mixShearY,a=0!=e||0!=s,o=this.target,h=o.matrix,l=h.a,c=h.c,u=h.b,d=h.d,f=l*d-c*u>0?Pv.degRad:-Pv.degRad,p=this.data.offsetRotation*f,m=this.data.offsetShearY*f,g=this.bones;for(let y=0,v=g.length;y<v;y++){const h=g[y],f=h.matrix;if(0!=t){const e=f.a,s=f.c,n=f.b,i=f.d;let r=Math.atan2(u,l)-Math.atan2(n,e)+p;r>Pv.PI?r-=Pv.PI2:r<-Pv.PI&&(r+=Pv.PI2),r*=t;const a=Math.cos(r),o=Math.sin(r);f.a=a*e-o*n,f.c=a*s-o*i,f.b=o*e+a*n,f.d=o*s+a*i}if(a){const t=this.temp;o.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),f.tx+=(t.x-f.tx)*e,f.ty+=(t.y-f.ty)*s}if(0!=n){let t=Math.sqrt(f.a*f.a+f.b*f.b);0!=t&&(t=(t+(Math.sqrt(l*l+u*u)-t+this.data.offsetScaleX)*n)/t),f.a*=t,f.b*=t}if(0!=i){let t=Math.sqrt(f.c*f.c+f.d*f.d);0!=t&&(t=(t+(Math.sqrt(c*c+d*d)-t+this.data.offsetScaleY)*i)/t),f.c*=t,f.d*=t}if(r>0){const t=f.c,e=f.d,s=Math.atan2(e,t);let n=Math.atan2(d,c)-Math.atan2(u,l)-(s-Math.atan2(f.b,f.a));n>Pv.PI?n-=Pv.PI2:n<-Pv.PI&&(n+=Pv.PI2),n=s+(n+m)*r;const i=Math.sqrt(t*t+e*e);f.c=Math.cos(n)*i,f.d=Math.sin(n)*i}h.updateAppliedTransform()}}applyRelativeWorld(){const t=this.mixRotate,e=this.mixX,s=this.mixY,n=this.mixScaleX,i=this.mixScaleY,r=this.mixShearY,a=0!=e||0!=s,o=this.target,h=o.matrix,l=h.a,c=h.c,u=h.b,d=h.d,f=l*d-c*u>0?Pv.degRad:-Pv.degRad,p=this.data.offsetRotation*f,m=this.data.offsetShearY*f,g=this.bones;for(let y=0,v=g.length;y<v;y++){const h=g[y],f=h.matrix;if(0!=t){const e=f.a,s=f.c,n=f.b,i=f.d;let r=Math.atan2(u,l)+p;r>Pv.PI?r-=Pv.PI2:r<-Pv.PI&&(r+=Pv.PI2),r*=t;const a=Math.cos(r),o=Math.sin(r);f.a=a*e-o*n,f.c=a*s-o*i,f.b=o*e+a*n,f.d=o*s+a*i}if(a){const t=this.temp;o.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),f.tx+=t.x*e,f.ty+=t.y*s}if(0!=n){const t=(Math.sqrt(l*l+u*u)-1+this.data.offsetScaleX)*n+1;f.a*=t,f.b*=t}if(0!=i){const t=(Math.sqrt(c*c+d*d)-1+this.data.offsetScaleY)*i+1;f.c*=t,f.d*=t}if(r>0){let t=Math.atan2(d,c)-Math.atan2(u,l);t>Pv.PI?t-=Pv.PI2:t<-Pv.PI&&(t+=Pv.PI2);const e=f.c,s=f.d;t=Math.atan2(s,e)+(t-Pv.PI/2+m)*r;const n=Math.sqrt(e*e+s*s);f.c=Math.cos(t)*n,f.d=Math.sin(t)*n}h.updateAppliedTransform()}}applyAbsoluteLocal(){const t=this.mixRotate,e=this.mixX,s=this.mixY,n=this.mixScaleX,i=this.mixScaleY,r=this.mixShearY,a=this.target,o=this.bones;for(let h=0,l=o.length;h<l;h++){const l=o[h];let c=l.arotation;if(0!=t){let e=a.arotation-c+this.data.offsetRotation;e-=360*(16384-(16384.499999999996-e/360|0)),c+=e*t}let u=l.ax,d=l.ay;u+=(a.ax-u+this.data.offsetX)*e,d+=(a.ay-d+this.data.offsetY)*s;let f=l.ascaleX,p=l.ascaleY;0!=n&&0!=f&&(f=(f+(a.ascaleX-f+this.data.offsetScaleX)*n)/f),0!=i&&0!=p&&(p=(p+(a.ascaleY-p+this.data.offsetScaleY)*i)/p);let m=l.ashearY;if(0!=r){let t=a.ashearY-m+this.data.offsetShearY;t-=360*(16384-(16384.499999999996-t/360|0)),m+=t*r}l.updateWorldTransformWith(u,d,c,f,p,l.ashearX,m)}}applyRelativeLocal(){const t=this.mixRotate,e=this.mixX,s=this.mixY,n=this.mixScaleX,i=this.mixScaleY,r=this.mixShearY,a=this.target,o=this.bones;for(let h=0,l=o.length;h<l;h++){const l=o[h],c=l.arotation+(a.arotation+this.data.offsetRotation)*t,u=l.ax+(a.ax+this.data.offsetX)*e,d=l.ay+(a.ay+this.data.offsetY)*s,f=l.ascaleX*((a.ascaleX-1+this.data.offsetScaleX)*n+1),p=l.ascaleY*((a.ascaleY-1+this.data.offsetScaleY)*i+1),m=l.ashearY+(a.ashearY+this.data.offsetShearY)*r;l.updateWorldTransformWith(u,d,c,f,p,l.ashearX,m)}}}const EE=class{constructor(t){if(this._updateCache=new Array,this.skin=null,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,!t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){const s=t.bones[e];let n;if(s.parent){const t=this.bones[s.parent.index];n=new cE(s,this,t),t.children.push(n)}else n=new cE(s,this,null);this.bones.push(n)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){const s=t.slots[e],n=this.bones[s.boneData.index],i=new bE(s,n);this.slots.push(i),this.drawOrder.push(i)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){const s=t.ikConstraints[e];this.ikConstraints.push(new mE(s,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){const s=t.transformConstraints[e];this.transformConstraints.push(new wE(s,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){const s=t.pathConstraints[e];this.pathConstraints.push(new _E(s,this))}this.color=new Mv(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0;const t=this.bones;for(let h=0,l=t.length;h<l;h++){const e=t[h];e.sorted=e.data.skinRequired,e.active=!e.sorted}if(this.skin){const t=this.skin.bones;for(let e=0,s=this.skin.bones.length;e<s;e++){let s=this.bones[t[e].index];do{s.sorted=!1,s.active=!0,s=s.parent}while(s)}}const e=this.ikConstraints,s=this.transformConstraints,n=this.pathConstraints,i=e.length,r=s.length,a=n.length,o=i+r+a;t:for(let h=0;h<o;h++){for(let t=0;t<i;t++){const s=e[t];if(s.data.order==h){this.sortIkConstraint(s);continue t}}for(let t=0;t<r;t++){const e=s[t];if(e.data.order==h){this.sortTransformConstraint(e);continue t}}for(let t=0;t<a;t++){const e=n[t];if(e.data.order==h){this.sortPathConstraint(e);continue t}}}for(let h=0,l=t.length;h<l;h++)this.sortBone(t[h])}sortIkConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&Ov.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target;this.sortBone(e);const s=t.bones,n=s[0];if(this.sortBone(n),1==s.length)this._updateCache.push(t),this.sortReset(n.children);else{const e=s[s.length-1];this.sortBone(e),this._updateCache.push(t),this.sortReset(n.children),e.sorted=!0}}sortPathConstraint(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||this.skin&&Ov.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target,s=e.data.index,n=e.bone;this.skin&&this.sortPathConstraintAttachment(this.skin,s,n),this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,s,n);for(let o=0,h=this.data.skins.length;o<h;o++)this.sortPathConstraintAttachment(this.data.skins[o],s,n);const i=e.getAttachment();i instanceof Xb&&this.sortPathConstraintAttachmentWith(i,n);const r=t.bones,a=r.length;for(let o=0;o<a;o++)this.sortBone(r[o]);this._updateCache.push(t);for(let o=0;o<a;o++)this.sortReset(r[o].children);for(let o=0;o<a;o++)r[o].sorted=!0}sortTransformConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&Ov.contains(this.skin.constraints,t.data,!0)),!t.active)return;this.sortBone(t.target);const e=t.bones,s=e.length;if(t.data.local)for(let n=0;n<s;n++){const t=e[n];this.sortBone(t.parent),this.sortBone(t)}else for(let n=0;n<s;n++)this.sortBone(e[n]);this._updateCache.push(t);for(let n=0;n<s;n++)this.sortReset(e[n].children);for(let n=0;n<s;n++)e[n].sorted=!0}sortPathConstraintAttachment(t,e,s){const n=t.attachments[e];if(n)for(const i in n)this.sortPathConstraintAttachmentWith(n[i],s)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof Xb))return;const s=t.bones;if(s){const t=this.bones;for(let e=0,n=s.length;e<n;){let n=s[e++];for(n+=e;e<n;)this.sortBone(t[s[e++]])}}else this.sortBone(e)}sortBone(t){if(!t)return;if(t.sorted)return;const e=t.parent;e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,s=t.length;e<s;e++){const s=t[e];s.active&&(s.sorted&&this.sortReset(s.children),s.sorted=!1)}}updateWorldTransform(){const t=this.bones;for(let s=0,n=t.length;s<n;s++){const e=t[s];e.ax=e.x,e.ay=e.y,e.arotation=e.rotation,e.ascaleX=e.scaleX,e.ascaleY=e.scaleY,e.ashearX=e.shearX,e.ashearY=e.shearY}const e=this._updateCache;for(let s=0,n=e.length;s<n;s++)e[s].update()}updateWorldTransformWith(t){const e=this.getRootBone(),s=t.matrix.a,n=t.matrix.c,i=t.matrix.b,r=t.matrix.d;e.matrix.tx=s*this.x+n*this.y+t.worldX,e.matrix.ty=i*this.x+r*this.y+t.worldY;const a=e.rotation+90+e.shearY,o=Pv.cosDeg(e.rotation+e.shearX)*e.scaleX,h=Pv.cosDeg(a)*e.scaleY,l=Pv.sinDeg(e.rotation+e.shearX)*e.scaleX,c=Pv.sinDeg(a)*e.scaleY,u=this.scaleX,d=-this.scaleY;e.matrix.a=(s*o+n*l)*u,e.matrix.c=(s*h+n*c)*u,e.matrix.b=(i*o+r*l)*d,e.matrix.d=(i*h+r*c)*d;const f=this._updateCache;for(let p=0,m=f.length;p<m;p++){const t=f[p];t!=e&&t.update()}}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){const t=this.bones;for(let i=0,r=t.length;i<r;i++)t[i].setToSetupPose();const e=this.ikConstraints;for(let i=0,r=e.length;i<r;i++){const t=e[i];t.mix=t.data.mix,t.softness=t.data.softness,t.bendDirection=t.data.bendDirection,t.compress=t.data.compress,t.stretch=t.data.stretch}const s=this.transformConstraints;for(let i=0,r=s.length;i<r;i++){const t=s[i],e=t.data;t.mixRotate=e.mixRotate,t.mixX=e.mixX,t.mixY=e.mixY,t.mixScaleX=e.mixScaleX,t.mixScaleY=e.mixScaleY,t.mixShearY=e.mixShearY}const n=this.pathConstraints;for(let i=0,r=n.length;i<r;i++){const t=n[i],e=t.data;t.position=e.position,t.spacing=e.spacing,t.mixRotate=e.mixRotate,t.mixX=e.mixX,t.mixY=e.mixY}}setSlotsToSetupPose(){const t=this.slots;Ov.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,s=t.length;e<s;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.data.name==t)return n}return null}findBoneIndex(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,n=e.length;s<n;s++)if(e[s].data.name==t)return s;return-1}findSlot(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.data.name==t)return n}return null}findSlotIndex(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,n=e.length;s<n;s++)if(e[s].data.name==t)return s;return-1}setSkinByName(t){const e=this.data.findSkin(t);if(!e)throw new Error(`Skin not found: ${t}`);this.setSkin(e)}setSkin(t){if(t!=this.skin){if(t)if(this.skin)t.attachAll(this,this.skin);else{const e=this.slots;for(let s=0,n=e.length;s<n;s++){const n=e[s],i=n.data.attachmentName;if(i){const e=t.getAttachment(s,i);e&&n.setAttachment(e)}}}this.skin=t,this.updateCache()}}getAttachmentByName(t,e){const s=this.data.findSlot(t);if(!s)throw new Error(`Can't find slot with name ${t}`);return this.getAttachment(s.index,e)}getAttachment(t,e){if(!e)throw new Error("attachmentName cannot be null.");if(this.skin){const s=this.skin.getAttachment(t,e);if(s)return s}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(!t)throw new Error("slotName cannot be null.");const s=this.slots;for(let n=0,i=s.length;n<i;n++){const i=s[n];if(i.data.name==t){let s=null;if(e&&(s=this.getAttachment(n,e),!s))throw new Error(`Attachment not found: ${e}, for slot: ${t}`);return void i.setAttachment(s)}}throw new Error(`Slot not found: ${t}`)}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.data.name==t)return n}return null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.data.name==t)return n}return null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.data.name==t)return n}return null}getBoundsRect(){const t=new Bv,e=new Bv;return this.getBounds(t,e),{x:t.x,y:t.y,width:e.x,height:e.y}}getBounds(t,e,s=new Array(2)){if(!t)throw new Error("offset cannot be null.");if(!e)throw new Error("size cannot be null.");const n=this.drawOrder;let i=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let h=0,l=n.length;h<l;h++){const t=n[h];if(!t.bone.active)continue;let e=0,l=null;const c=t.getAttachment();if(c instanceof jb)e=8,l=Ov.setArraySize(s,e,0),c.computeWorldVertices(t,l,0,2);else if(c instanceof Ub){const n=c;e=n.worldVerticesLength,l=Ov.setArraySize(s,e,0),n.computeWorldVertices(t,0,e,l,0,2)}if(l)for(let s=0,n=l.length;s<n;s+=2){const t=l[s],e=l[s+1];i=Math.min(i,t),r=Math.min(r,e),a=Math.max(a,t),o=Math.max(o,e)}}t.set(i,r),e.set(a-i,o-r)}get flipX(){return-1==this.scaleX}set flipX(t){EE.deprecatedWarning1||(EE.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleX=t?1:-1}get flipY(){return-1==this.scaleY}set flipY(t){EE.deprecatedWarning1||(EE.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleY=t?1:-1}};let SE=EE;SE.deprecatedWarning1=!1;class TE{constructor(){this.name=null,this.bones=new Array,this.slots=new Array,this.skins=new Array,this.defaultSkin=null,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.x=0,this.y=0,this.width=0,this.height=0,this.version=null,this.hash=null,this.fps=0,this.imagesPath=null,this.audioPath=null}findBone(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findBoneIndex(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let s=0,n=e.length;s<n;s++)if(e[s].name==t)return s;return-1}findSlot(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findSlotIndex(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let s=0,n=e.length;s<n;s++)if(e[s].name==t)return s;return-1}findSkin(t){if(!t)throw new Error("skinName cannot be null.");const e=this.skins;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findEvent(t){if(!t)throw new Error("eventDataName cannot be null.");const e=this.events;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findAnimation(t){if(!t)throw new Error("animationName cannot be null.");const e=this.animations;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let s=0,n=e.length;s<n;s++){const n=e[s];if(n.name==t)return n}return null}findPathConstraintIndex(t){if(null==t)throw new Error("pathConstraintName cannot be null.");const e=this.pathConstraints;for(let s=0,n=e.length;s<n;s++)if(e[s].name==t)return s;return-1}}class AE{constructor(t,e,s){if(this.index=0,this.color=new Mv(1,1,1,1),this.darkColor=null,this.attachmentName=null,this.blendMode=ir.NORMAL,t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");if(!s)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=s}}class CE extends dE{constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.mixRotate=0,this.mixX=0,this.mixY=0,this.mixScaleX=0,this.mixScaleY=0,this.mixShearY=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}}class ME{constructor(t,e,s){this.slotIndex=t,this.name=e,this.attachment=s}}class IE{constructor(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,!t)throw new Error("name cannot be null.");this.name=t}setAttachment(t,e,s){if(!s)throw new Error("attachment cannot be null.");const n=this.attachments;t>=n.length&&(n.length=t+1),n[t]||(n[t]={}),n[t][e]=s}addSkin(t){for(let s=0;s<t.bones.length;s++){const e=t.bones[s];let n=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==e){n=!0;break}n||this.bones.push(e)}for(let s=0;s<t.constraints.length;s++){const e=t.constraints[s];let n=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==e){n=!0;break}n||this.constraints.push(e)}const e=t.getAttachments();for(let s=0;s<e.length;s++){const t=e[s];this.setAttachment(t.slotIndex,t.name,t.attachment)}}copySkin(t){for(let s=0;s<t.bones.length;s++){const e=t.bones[s];let n=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==e){n=!0;break}n||this.bones.push(e)}for(let s=0;s<t.constraints.length;s++){const e=t.constraints[s];let n=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==e){n=!0;break}n||this.constraints.push(e)}const e=t.getAttachments();for(let s=0;s<e.length;s++){const t=e[s];t.attachment&&(t.attachment instanceof Ub?(t.attachment=t.attachment.newLinkedMesh(),this.setAttachment(t.slotIndex,t.name,t.attachment)):(t.attachment=t.attachment.copy(),this.setAttachment(t.slotIndex,t.name,t.attachment)))}}getAttachment(t,e){const s=this.attachments[t];return s?s[e]:null}removeAttachment(t,e){const s=this.attachments[t];s&&delete s[e]}getAttachments(){const t=new Array;for(let e=0;e<this.attachments.length;e++){const s=this.attachments[e];if(s)for(const n in s){const i=s[n];i&&t.push(new ME(e,n,i))}}return t}getAttachmentsForSlot(t,e){const s=this.attachments[t];if(s)for(const n in s){const i=s[n];i&&e.push(new ME(t,n,i))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(t,e){let s=0;for(let n=0;n<t.slots.length;n++){const i=t.slots[n],r=i.getAttachment();if(r&&s<e.attachments.length){const t=e.attachments[s];for(const e in t){if(r==t[e]){const t=this.getAttachment(s,e);t&&i.setAttachment(t);break}}}s++}}}class PE{constructor(t){this.ver40=!1,this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const e=this.scale,s=new TE;s.name="";const n=new cv(t),i=n.readInt32(),r=n.readInt32();s.hash=0==r&&0==i?null:r.toString(16)+i.toString(16),s.version=n.readString();const a=s.version.substr(0,3);if("4.0"!==a&&"4.1"!==a){const t=`Spine 4.1 loader cant load version ${s.version}. Please configure your pixi-spine bundle`;console.error(t)}this.ver40="4.0"===a,s.x=n.readFloat(),s.y=n.readFloat(),s.width=n.readFloat(),s.height=n.readFloat();const o=n.readBoolean();o&&(s.fps=n.readFloat(),s.imagesPath=n.readString(),s.audioPath=n.readString());let h=0;h=n.readInt(!0);for(let c=0;c<h;c++){const t=n.readString();if(!t)throw new Error("String in string table must not be null.");n.strings.push(t)}h=n.readInt(!0);for(let c=0;c<h;c++){const t=n.readString();if(!t)throw new Error("Bone name must not be null.");const i=0==c?null:s.bones[n.readInt(!0)],r=new uE(c,t,i);r.rotation=n.readFloat(),r.x=n.readFloat()*e,r.y=n.readFloat()*e,r.scaleX=n.readFloat(),r.scaleY=n.readFloat(),r.shearX=n.readFloat(),r.shearY=n.readFloat(),r.length=n.readFloat()*e,r.transformMode=n.readInt(!0),r.skinRequired=n.readBoolean(),o&&Mv.rgba8888ToColor(r.color,n.readInt32()),s.bones.push(r)}h=n.readInt(!0);for(let c=0;c<h;c++){const t=n.readString();if(!t)throw new Error("Slot name must not be null.");const e=s.bones[n.readInt(!0)],i=new AE(c,t,e);Mv.rgba8888ToColor(i.color,n.readInt32());const r=n.readInt32();-1!=r&&Mv.rgb888ToColor(i.darkColor=new Mv,r),i.attachmentName=n.readStringRef(),i.blendMode=n.readInt(!0),s.slots.push(i)}h=n.readInt(!0);for(let c,u=0;u<h;u++){const t=n.readString();if(!t)throw new Error("IK constraint data name must not be null.");const i=new gE(t);i.order=n.readInt(!0),i.skinRequired=n.readBoolean(),c=n.readInt(!0);for(let e=0;e<c;e++)i.bones.push(s.bones[n.readInt(!0)]);i.target=s.bones[n.readInt(!0)],i.mix=n.readFloat(),i.softness=n.readFloat()*e,i.bendDirection=n.readByte(),i.compress=n.readBoolean(),i.stretch=n.readBoolean(),i.uniform=n.readBoolean(),s.ikConstraints.push(i)}h=n.readInt(!0);for(let c,u=0;u<h;u++){const t=n.readString();if(!t)throw new Error("Transform constraint data name must not be null.");const i=new CE(t);i.order=n.readInt(!0),i.skinRequired=n.readBoolean(),c=n.readInt(!0);for(let e=0;e<c;e++)i.bones.push(s.bones[n.readInt(!0)]);i.target=s.bones[n.readInt(!0)],i.local=n.readBoolean(),i.relative=n.readBoolean(),i.offsetRotation=n.readFloat(),i.offsetX=n.readFloat()*e,i.offsetY=n.readFloat()*e,i.offsetScaleX=n.readFloat(),i.offsetScaleY=n.readFloat(),i.offsetShearY=n.readFloat(),i.mixRotate=n.readFloat(),i.mixX=n.readFloat(),i.mixY=n.readFloat(),i.mixScaleX=n.readFloat(),i.mixScaleY=n.readFloat(),i.mixShearY=n.readFloat(),s.transformConstraints.push(i)}h=n.readInt(!0);for(let c,u=0;u<h;u++){const t=n.readString();if(!t)throw new Error("Path constraint data name must not be null.");const i=new yE(t);i.order=n.readInt(!0),i.skinRequired=n.readBoolean(),c=n.readInt(!0);for(let e=0;e<c;e++)i.bones.push(s.bones[n.readInt(!0)]);i.target=s.slots[n.readInt(!0)],i.positionMode=n.readInt(!0),i.spacingMode=n.readInt(!0),i.rotateMode=n.readInt(!0),i.offsetRotation=n.readFloat(),i.position=n.readFloat(),i.positionMode==fv.Fixed&&(i.position*=e),i.spacing=n.readFloat(),i.spacingMode!=vE.Length&&i.spacingMode!=vE.Fixed||(i.spacing*=e),i.mixRotate=n.readFloat(),i.mixX=n.readFloat(),i.mixY=n.readFloat(),s.pathConstraints.push(i)}const l=this.readSkin(n,s,!0,o);l&&(s.defaultSkin=l,s.skins.push(l));{let t=s.skins.length;for(Ov.setArraySize(s.skins,h=t+n.readInt(!0));t<h;t++){const e=this.readSkin(n,s,!1,o);if(!e)throw new Error("readSkin() should not have returned null.");s.skins[t]=e}}h=this.linkedMeshes.length;for(let c=0;c<h;c++){const t=this.linkedMeshes[c],e=t.skin?s.findSkin(t.skin):s.defaultSkin;if(!e)throw new Error("Not skin found for linked mesh.");if(!t.parent)throw new Error("Linked mesh parent must not be null");const n=e.getAttachment(t.slotIndex,t.parent);if(!n)throw new Error(`Parent mesh not found: ${t.parent}`);t.mesh.timelineAttachment=t.inheritTimeline?n:t.mesh,t.mesh.setParentMesh(n)}this.linkedMeshes.length=0,h=n.readInt(!0);for(let c=0;c<h;c++){const t=n.readStringRef();if(!t)throw new Error;const e=new pE(t);e.intValue=n.readInt(!1),e.floatValue=n.readFloat(),e.stringValue=n.readString(),e.audioPath=n.readString(),e.audioPath&&(e.volume=n.readFloat(),e.balance=n.readFloat()),s.events.push(e)}h=n.readInt(!0);for(let c=0;c<h;c++){const t=n.readString();if(!t)throw new Error("Animatio name must not be null.");s.animations.push(this.readAnimation(n,t,s))}return s}readSkin(t,e,s,n){let i=null,r=0;if(s){if(r=t.readInt(!0),0==r)return null;i=new IE("default")}else{const s=t.readStringRef();if(!s)throw new Error("Skin name must not be null.");i=new IE(s),i.bones.length=t.readInt(!0);for(let n=0,r=i.bones.length;n<r;n++)i.bones[n]=e.bones[t.readInt(!0)];for(let n=0,r=t.readInt(!0);n<r;n++)i.constraints.push(e.ikConstraints[t.readInt(!0)]);for(let n=0,r=t.readInt(!0);n<r;n++)i.constraints.push(e.transformConstraints[t.readInt(!0)]);for(let n=0,r=t.readInt(!0);n<r;n++)i.constraints.push(e.pathConstraints[t.readInt(!0)]);r=t.readInt(!0)}for(let a=0;a<r;a++){const s=t.readInt(!0);for(let r=0,a=t.readInt(!0);r<a;r++){const r=t.readStringRef();if(!r)throw new Error("Attachment name must not be null");const a=this.readAttachment(t,e,i,s,r,n);a&&i.setAttachment(s,r,a)}}return i}readAttachment(t,e,s,n,i,r){const a=this.scale;let o=t.readStringRef();switch(o||(o=i),t.readByte()){case lv.Region:{let e=t.readStringRef();const n=t.readFloat(),i=t.readFloat(),r=t.readFloat(),h=t.readFloat(),l=t.readFloat(),c=t.readFloat(),u=t.readFloat(),d=t.readInt32(),f=this.readSequence(t);e||(e=o);const p=this.attachmentLoader.newRegionAttachment(s,o,e,f);return p?(p.path=e,p.x=i*a,p.y=r*a,p.scaleX=h,p.scaleY=l,p.rotation=n,p.width=c*a,p.height=u*a,Mv.rgba8888ToColor(p.color,d),p.sequence=f,null==f&&p.updateRegion(),p):null}case lv.BoundingBox:{const e=t.readInt(!0),n=this.readVertices(t,e),i=r?t.readInt32():0,a=this.attachmentLoader.newBoundingBoxAttachment(s,o);return a?(a.worldVerticesLength=e<<1,a.vertices=n.vertices,a.bones=n.bones,r&&Mv.rgba8888ToColor(a.color,i),a):null}case lv.Mesh:{let e=t.readStringRef();const n=t.readInt32(),i=t.readInt(!0),h=this.readFloatArray(t,i<<1,1),l=this.readShortArray(t),c=this.readVertices(t,i),u=t.readInt(!0),d=this.readSequence(t);let f=[],p=0,m=0;r&&(f=this.readShortArray(t),p=t.readFloat(),m=t.readFloat()),e||(e=o);const g=this.attachmentLoader.newMeshAttachment(s,o,e,d);return g?(g.path=e,Mv.rgba8888ToColor(g.color,n),g.bones=c.bones,g.vertices=c.vertices,g.worldVerticesLength=i<<1,g.triangles=l,g.regionUVs=new Float32Array(h),g.hullLength=u<<1,g.sequence=d,r&&(g.edges=f,g.width=p*a,g.height=m*a),g):null}case lv.LinkedMesh:{let e=t.readStringRef();const i=t.readInt32(),h=t.readStringRef(),l=t.readStringRef(),c=t.readBoolean(),u=this.readSequence(t);let d=0,f=0;r&&(d=t.readFloat(),f=t.readFloat()),e||(e=o);const p=this.attachmentLoader.newMeshAttachment(s,o,e,u);return p?(p.path=e,Mv.rgba8888ToColor(p.color,i),p.sequence=u,r&&(p.width=d*a,p.height=f*a),this.linkedMeshes.push(new RE(p,h,n,l,c)),p):null}case lv.Path:{const e=t.readBoolean(),n=t.readBoolean(),i=t.readInt(!0),h=this.readVertices(t,i),l=Ov.newArray(i/3,0);for(let s=0,r=l.length;s<r;s++)l[s]=t.readFloat()*a;const c=r?t.readInt32():0,u=this.attachmentLoader.newPathAttachment(s,o);return u?(u.closed=e,u.constantSpeed=n,u.worldVerticesLength=i<<1,u.vertices=h.vertices,u.bones=h.bones,u.lengths=l,r&&Mv.rgba8888ToColor(u.color,c),u):null}case lv.Point:{const e=t.readFloat(),n=t.readFloat(),i=t.readFloat(),h=r?t.readInt32():0,l=this.attachmentLoader.newPointAttachment(s,o);return l?(l.x=n*a,l.y=i*a,l.rotation=e,r&&Mv.rgba8888ToColor(l.color,h),l):null}case lv.Clipping:{const n=t.readInt(!0),i=t.readInt(!0),a=this.readVertices(t,i),h=r?t.readInt32():0,l=this.attachmentLoader.newClippingAttachment(s,o);return l?(l.endSlot=e.slots[n],l.worldVerticesLength=i<<1,l.vertices=a.vertices,l.bones=a.bones,r&&Mv.rgba8888ToColor(l.color,h),l):null}}return null}readSequence(t){if(this.ver40||!t.readBoolean())return null;const e=new Gb(t.readInt(!0));return e.start=t.readInt(!0),e.digits=t.readInt(!0),e.setupIndex=t.readInt(!0),e}readDeformTimelineType(t){return this.ver40?QE:t.readByte()}readVertices(t,e){const s=this.scale,n=e<<1,i=new kE;if(!t.readBoolean())return i.vertices=this.readFloatArray(t,n,s),i;const r=new Array,a=new Array;for(let o=0;o<e;o++){const e=t.readInt(!0);a.push(e);for(let n=0;n<e;n++)a.push(t.readInt(!0)),r.push(t.readFloat()*s),r.push(t.readFloat()*s),r.push(t.readFloat())}return i.vertices=Ov.toFloatArray(r),i.bones=a,i}readFloatArray(t,e,s){const n=new Array(e);if(1==s)for(let i=0;i<e;i++)n[i]=t.readFloat();else for(let i=0;i<e;i++)n[i]=t.readFloat()*s;return n}readShortArray(t){const e=t.readInt(!0),s=new Array(e);for(let n=0;n<e;n++)s[n]=t.readShort();return s}readAnimation(t,e,s){t.readInt(!0);const n=new Array,i=this.scale;for(let h=0,l=t.readInt(!0);h<l;h++){const e=t.readInt(!0);for(let s=0,i=t.readInt(!0);s<i;s++){const s=t.readByte(),i=t.readInt(!0),r=i-1;switch(s){case zE:{const s=new Nw(i,e);for(let e=0;e<i;e++)s.setFrame(e,t.readFloat(),t.readStringRef());n.push(s);break}case GE:{const s=t.readInt(!0),a=new Rw(i,s,e);let o=t.readFloat(),h=t.readUnsignedByte()/255,l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255;for(let e=0,n=0;a.setFrame(e,o,h,l,c,u),e!=r;e++){const s=t.readFloat(),i=t.readUnsignedByte()/255,r=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255;switch(t.readByte()){case nS:a.setStepped(e);break;case iS:OE(t,a,n++,e,0,o,s,h,i,1),OE(t,a,n++,e,1,o,s,l,r,1),OE(t,a,n++,e,2,o,s,c,d,1),OE(t,a,n++,e,3,o,s,u,f,1)}o=s,h=i,l=r,c=d,u=f}n.push(a);break}case HE:{const s=t.readInt(!0),a=new kw(i,s,e);let o=t.readFloat(),h=t.readUnsignedByte()/255,l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255;for(let e=0,n=0;a.setFrame(e,o,h,l,c),e!=r;e++){const s=t.readFloat(),i=t.readUnsignedByte()/255,r=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255;switch(t.readByte()){case nS:a.setStepped(e);break;case iS:OE(t,a,n++,e,0,o,s,h,i,1),OE(t,a,n++,e,1,o,s,l,r,1),OE(t,a,n++,e,2,o,s,c,u,1)}o=s,h=i,l=r,c=u}n.push(a);break}case qE:{const s=t.readInt(!0),a=new Fw(i,s,e);let o=t.readFloat(),h=t.readUnsignedByte()/255,l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255,p=t.readUnsignedByte()/255;for(let e=0,n=0;a.setFrame(e,o,h,l,c,u,d,f,p),e!=r;e++){const s=t.readFloat(),i=t.readUnsignedByte()/255,r=t.readUnsignedByte()/255,m=t.readUnsignedByte()/255,g=t.readUnsignedByte()/255,y=t.readUnsignedByte()/255,v=t.readUnsignedByte()/255,x=t.readUnsignedByte()/255;switch(t.readByte()){case nS:a.setStepped(e);break;case iS:OE(t,a,n++,e,0,o,s,h,i,1),OE(t,a,n++,e,1,o,s,l,r,1),OE(t,a,n++,e,2,o,s,c,m,1),OE(t,a,n++,e,3,o,s,u,g,1),OE(t,a,n++,e,4,o,s,d,y,1),OE(t,a,n++,e,5,o,s,f,v,1),OE(t,a,n++,e,6,o,s,p,x,1)}o=s,h=i,l=r,c=m,u=g,d=y,f=v,p=x}n.push(a);break}case KE:{const s=t.readInt(!0),a=new Ow(i,s,e);let o=t.readFloat(),h=t.readUnsignedByte()/255,l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255;for(let e=0,n=0;a.setFrame(e,o,h,l,c,u,d,f),e!=r;e++){const s=t.readFloat(),i=t.readUnsignedByte()/255,r=t.readUnsignedByte()/255,p=t.readUnsignedByte()/255,m=t.readUnsignedByte()/255,g=t.readUnsignedByte()/255,y=t.readUnsignedByte()/255;switch(t.readByte()){case nS:a.setStepped(e);break;case iS:OE(t,a,n++,e,0,o,s,h,i,1),OE(t,a,n++,e,1,o,s,l,r,1),OE(t,a,n++,e,2,o,s,c,p,1),OE(t,a,n++,e,3,o,s,u,m,1),OE(t,a,n++,e,4,o,s,d,g,1),OE(t,a,n++,e,5,o,s,f,y,1)}o=s,h=i,l=r,c=p,u=m,d=g,f=y}n.push(a);break}case ZE:{const s=new Dw(i,t.readInt(!0),e);let a=t.readFloat(),o=t.readUnsignedByte()/255;for(let e=0,n=0;s.setFrame(e,a,o),e!=r;e++){const i=t.readFloat(),r=t.readUnsignedByte()/255;switch(t.readByte()){case nS:s.setStepped(e);break;case iS:OE(t,s,n++,e,0,a,i,o,r,1)}a=i,o=r}n.push(s)}}}}for(let h=0,l=t.readInt(!0);h<l;h++){const e=t.readInt(!0);for(let s=0,r=t.readInt(!0);s<r;s++){const s=t.readByte(),r=t.readInt(!0),a=t.readInt(!0);switch(s){case NE:n.push(DE(t,new bw(r,a,e),1));break;case BE:n.push(FE(t,new ww(r,a,e),i));break;case LE:n.push(DE(t,new Ew(r,a,e),i));break;case VE:n.push(DE(t,new Sw(r,a,e),i));break;case $E:n.push(FE(t,new Tw(r,a,e),1));break;case UE:n.push(DE(t,new Aw(r,a,e),1));break;case XE:n.push(DE(t,new Cw(r,a,e),1));break;case YE:n.push(FE(t,new Mw(r,a,e),1));break;case WE:n.push(DE(t,new Iw(r,a,e),1));break;case jE:n.push(DE(t,new Pw(r,a,e),1))}}}for(let h=0,l=t.readInt(!0);h<l;h++){const e=t.readInt(!0),s=t.readInt(!0),r=s-1,a=new Xw(s,t.readInt(!0),e);let o=t.readFloat(),h=t.readFloat(),l=t.readFloat()*i;for(let n=0,c=0;a.setFrame(n,o,h,l,t.readByte(),t.readBoolean(),t.readBoolean()),n!=r;n++){const e=t.readFloat(),s=t.readFloat(),r=t.readFloat()*i;switch(t.readByte()){case nS:a.setStepped(n);break;case iS:OE(t,a,c++,n,0,o,e,h,s,1),OE(t,a,c++,n,1,o,e,l,r,i)}o=e,h=s,l=r}n.push(a)}for(let h=0,l=t.readInt(!0);h<l;h++){const e=t.readInt(!0),s=t.readInt(!0),i=s-1,r=new Yw(s,t.readInt(!0),e);let a=t.readFloat(),o=t.readFloat(),h=t.readFloat(),l=t.readFloat(),c=t.readFloat(),u=t.readFloat(),d=t.readFloat();for(let n=0,f=0;r.setFrame(n,a,o,h,l,c,u,d),n!=i;n++){const e=t.readFloat(),s=t.readFloat(),i=t.readFloat(),p=t.readFloat(),m=t.readFloat(),g=t.readFloat(),y=t.readFloat();switch(t.readByte()){case nS:r.setStepped(n);break;case iS:OE(t,r,f++,n,0,a,e,o,s,1),OE(t,r,f++,n,1,a,e,h,i,1),OE(t,r,f++,n,2,a,e,l,p,1),OE(t,r,f++,n,3,a,e,c,m,1),OE(t,r,f++,n,4,a,e,u,g,1),OE(t,r,f++,n,5,a,e,d,y,1)}a=e,o=s,h=i,l=p,c=m,u=g,d=y}n.push(r)}for(let h=0,l=t.readInt(!0);h<l;h++){const e=t.readInt(!0),r=s.pathConstraints[e];for(let s=0,a=t.readInt(!0);s<a;s++)switch(t.readByte()){case tS:n.push(DE(t,new Ww(t.readInt(!0),t.readInt(!0),e),r.positionMode==fv.Fixed?i:1));break;case eS:n.push(DE(t,new jw(t.readInt(!0),t.readInt(!0),e),r.spacingMode==vE.Length||r.spacingMode==vE.Fixed?i:1));break;case sS:const s=new zw(t.readInt(!0),t.readInt(!0),e);let a=t.readFloat(),o=t.readFloat(),h=t.readFloat(),l=t.readFloat();for(let e=0,n=0,i=s.getFrameCount()-1;s.setFrame(e,a,o,h,l),e!=i;e++){const i=t.readFloat(),r=t.readFloat(),c=t.readFloat(),u=t.readFloat();switch(t.readByte()){case nS:s.setStepped(e);break;case iS:OE(t,s,n++,e,0,a,i,o,r,1),OE(t,s,n++,e,1,a,i,h,c,1),OE(t,s,n++,e,2,a,i,l,u,1)}a=i,o=r,h=c,l=u}n.push(s)}}for(let h=0,l=t.readInt(!0);h<l;h++){const e=s.skins[t.readInt(!0)];for(let s=0,r=t.readInt(!0);s<r;s++){const s=t.readInt(!0);for(let r=0,a=t.readInt(!0);r<a;r++){const r=t.readStringRef();if(!r)throw new Error("attachmentName must not be null.");const a=e.getAttachment(s,r),o=this.readDeformTimelineType(t),h=t.readInt(!0),l=h-1;switch(o){case QE:{const e=a,r=e.bones,o=e.vertices,c=r?o.length/3*2:o.length,u=t.readInt(!0),d=new Bw(h,u,s,e);let f=t.readFloat();for(let s=0,n=0;;s++){let e,a=t.readInt(!0);if(0==a)e=r?Ov.newFloatArray(c):o;else{e=Ov.newFloatArray(c);const s=t.readInt(!0);if(a+=s,1==i)for(let n=s;n<a;n++)e[n]=t.readFloat();else for(let n=s;n<a;n++)e[n]=t.readFloat()*i;if(!r)for(let t=0,n=e.length;t<n;t++)e[t]+=o[t]}if(d.setFrame(s,f,e),s==l)break;const h=t.readFloat();switch(t.readByte()){case nS:d.setStepped(s);break;case iS:OE(t,d,n++,s,0,f,h,0,1,1)}f=h}n.push(d);break}case JE:{const e=new Hw(h,s,a);for(let s=0;s<h;s++){const n=t.readFloat(),i=t.readInt32();e.setFrame(s,n,qb[15&i],i>>4,t.readFloat())}n.push(e);break}}}}}const r=t.readInt(!0);if(r>0){const e=new Uw(r),i=s.slots.length;for(let s=0;s<r;s++){const n=t.readFloat(),r=t.readInt(!0),a=Ov.newArray(i,0);for(let t=i-1;t>=0;t--)a[t]=-1;const o=Ov.newArray(i-r,0);let h=0,l=0;for(let e=0;e<r;e++){const e=t.readInt(!0);for(;h!=e;)o[l++]=h++;a[h+t.readInt(!0)]=h++}for(;h<i;)o[l++]=h++;for(let t=i-1;t>=0;t--)-1==a[t]&&(a[t]=o[--l]);e.setFrame(s,n,a)}n.push(e)}const a=t.readInt(!0);if(a>0){const e=new Vw(a);for(let n=0;n<a;n++){const i=t.readFloat(),r=s.events[t.readInt(!0)],a=new fE(i,r);a.intValue=t.readInt(!1),a.floatValue=t.readFloat(),a.stringValue=t.readBoolean()?t.readString():r.stringValue,a.data.audioPath&&(a.volume=t.readFloat(),a.balance=t.readFloat()),e.setFrame(n,a)}n.push(e)}let o=0;for(let h=0,l=n.length;h<l;h++)o=Math.max(o,n[h].getDuration());return new Kb(e,n,o)}}PE.BlendModeValues=[ir.NORMAL,ir.ADD,ir.MULTIPLY,ir.SCREEN];let RE=class{constructor(t,e,s,n,i){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=n,this.inheritTimeline=i}};class kE{constructor(t=null,e=null){this.bones=t,this.vertices=e}}function DE(t,e,s){let n=t.readFloat(),i=t.readFloat()*s;for(let r=0,a=0,o=e.getFrameCount()-1;e.setFrame(r,n,i),r!=o;r++){const o=t.readFloat(),h=t.readFloat()*s;switch(t.readByte()){case nS:e.setStepped(r);break;case iS:OE(t,e,a++,r,0,n,o,i,h,s)}n=o,i=h}return e}function FE(t,e,s){let n=t.readFloat(),i=t.readFloat()*s,r=t.readFloat()*s;for(let a=0,o=0,h=e.getFrameCount()-1;e.setFrame(a,n,i,r),a!=h;a++){const h=t.readFloat(),l=t.readFloat()*s,c=t.readFloat()*s;switch(t.readByte()){case nS:e.setStepped(a);break;case iS:OE(t,e,o++,a,0,n,h,i,l,s),OE(t,e,o++,a,1,n,h,r,c,s)}n=h,i=l,r=c}return e}function OE(t,e,s,n,i,r,a,o,h,l){e.setBezier(s,n,i,r,o,t.readFloat(),t.readFloat()*l,t.readFloat(),t.readFloat()*l,a,h)}const NE=0,BE=1,LE=2,VE=3,$E=4,UE=5,XE=6,YE=7,WE=8,jE=9,zE=0,GE=1,HE=2,qE=3,KE=4,ZE=5,QE=0,JE=1,tS=0,eS=1,sS=2,nS=1,iS=2;class rS{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const e=this.scale,s=new TE,n="string"==typeof t?JSON.parse(t):t,i=n.skeleton;if(i){s.hash=i.hash,s.version=i.spine;const t=s.version.substr(0,3);if("4.0"!==t&&"4.1"!==t){const t=`Spine 4.1 loader cant load version ${i.spine}. Please configure your pixi-spine bundle`;console.error(t)}s.x=i.x,s.y=i.y,s.width=i.width,s.height=i.height,s.fps=i.fps,s.imagesPath=i.images}if(n.bones)for(let r=0;r<n.bones.length;r++){const t=n.bones[r];let i=null;const a=cS(t,"parent",null);if(null!=a&&(i=s.findBone(a),null==i))throw new Error(`Parent bone not found: ${a}`);const o=new uE(s.bones.length,t.name,i);o.length=cS(t,"length",0)*e,o.x=cS(t,"x",0)*e,o.y=cS(t,"y",0)*e,o.rotation=cS(t,"rotation",0),o.scaleX=cS(t,"scaleX",1),o.scaleY=cS(t,"scaleY",1),o.shearX=cS(t,"shearX",0),o.shearY=cS(t,"shearY",0),o.transformMode=Ov.enumValue(mv,cS(t,"transform","Normal")),o.skinRequired=cS(t,"skin",!1);const h=cS(t,"color",null);h&&o.color.setFromString(h),s.bones.push(o)}if(n.slots)for(let r=0;r<n.slots.length;r++){const t=n.slots[r],e=s.findBone(t.bone);if(!e)throw new Error(`Couldn't find bone ${t.bone} for slot ${t.name}`);const i=new AE(s.slots.length,t.name,e),a=cS(t,"color",null);a&&i.color.setFromString(a);const o=cS(t,"dark",null);o&&(i.darkColor=Mv.fromString(o)),i.attachmentName=cS(t,"attachment",null),i.blendMode=rS.blendModeFromString(cS(t,"blend","normal")),s.slots.push(i)}if(n.ik)for(let r=0;r<n.ik.length;r++){const t=n.ik[r],i=new gE(t.name);i.order=cS(t,"order",0),i.skinRequired=cS(t,"skin",!1);for(let e=0;e<t.bones.length;e++){const n=t.bones[e],r=s.findBone(n);if(null==r)throw new Error(`IK bone not found: ${n}`);i.bones.push(r)}i.target=s.findBone(t.target),i.mix=cS(t,"mix",1),i.softness=cS(t,"softness",0)*e,i.bendDirection=cS(t,"bendPositive",!0)?1:-1,i.compress=cS(t,"compress",!1),i.stretch=cS(t,"stretch",!1),i.uniform=cS(t,"uniform",!1),s.ikConstraints.push(i)}if(n.transform)for(let r=0;r<n.transform.length;r++){const t=n.transform[r],i=new CE(t.name);i.order=cS(t,"order",0),i.skinRequired=cS(t,"skin",!1);for(let e=0;e<t.bones.length;e++){const n=t.bones[e],r=s.findBone(n);if(!r)throw new Error(`Couldn't find bone ${n} for transform constraint ${t.name}.`);i.bones.push(r)}const a=t.target,o=s.findBone(a);if(!o)throw new Error(`Couldn't find target bone ${a} for transform constraint ${t.name}.`);i.target=o,i.local=cS(t,"local",!1),i.relative=cS(t,"relative",!1),i.offsetRotation=cS(t,"rotation",0),i.offsetX=cS(t,"x",0)*e,i.offsetY=cS(t,"y",0)*e,i.offsetScaleX=cS(t,"scaleX",0),i.offsetScaleY=cS(t,"scaleY",0),i.offsetShearY=cS(t,"shearY",0),i.mixRotate=cS(t,"mixRotate",1),i.mixX=cS(t,"mixX",1),i.mixY=cS(t,"mixY",i.mixX),i.mixScaleX=cS(t,"mixScaleX",1),i.mixScaleY=cS(t,"mixScaleY",i.mixScaleX),i.mixShearY=cS(t,"mixShearY",1),s.transformConstraints.push(i)}if(n.path)for(let r=0;r<n.path.length;r++){const t=n.path[r],i=new yE(t.name);i.order=cS(t,"order",0),i.skinRequired=cS(t,"skin",!1);for(let e=0;e<t.bones.length;e++){const n=t.bones[e],r=s.findBone(n);if(!r)throw new Error(`Couldn't find bone ${n} for path constraint ${t.name}.`);i.bones.push(r)}const a=t.target,o=s.findSlot(a);if(!o)throw new Error(`Couldn't find target slot ${a} for path constraint ${t.name}.`);i.target=o,i.positionMode=Ov.enumValue(fv,cS(t,"positionMode","Percent")),i.spacingMode=Ov.enumValue(vE,cS(t,"spacingMode","Length")),i.rotateMode=Ov.enumValue(pv,cS(t,"rotateMode","Tangent")),i.offsetRotation=cS(t,"rotation",0),i.position=cS(t,"position",0),i.positionMode==fv.Fixed&&(i.position*=e),i.spacing=cS(t,"spacing",0),i.spacingMode!=vE.Length&&i.spacingMode!=vE.Fixed||(i.spacing*=e),i.mixRotate=cS(t,"mixRotate",1),i.mixX=cS(t,"mixX",1),i.mixY=cS(t,"mixY",i.mixX),s.pathConstraints.push(i)}if(n.skins)for(let r=0;r<n.skins.length;r++){const t=n.skins[r],e=new IE(t.name);if(t.bones)for(let n=0;n<t.bones.length;n++){const i=t.bones[n],r=s.findBone(i);if(!r)throw new Error(`Couldn't find bone ${i} for skin ${t.name}.`);e.bones.push(r)}if(t.ik)for(let n=0;n<t.ik.length;n++){const i=t.ik[n],r=s.findIkConstraint(i);if(!r)throw new Error(`Couldn't find IK constraint ${i} for skin ${t.name}.`);e.constraints.push(r)}if(t.transform)for(let n=0;n<t.transform.length;n++){const i=t.transform[n],r=s.findTransformConstraint(i);if(!r)throw new Error(`Couldn't find transform constraint ${i} for skin ${t.name}.`);e.constraints.push(r)}if(t.path)for(let n=0;n<t.path.length;n++){const i=t.path[n],r=s.findPathConstraint(i);if(!r)throw new Error(`Couldn't find path constraint ${i} for skin ${t.name}.`);e.constraints.push(r)}for(const n in t.attachments){const i=s.findSlot(n);if(!i)throw new Error(`Couldn't find slot ${n} for skin ${t.name}.`);const r=t.attachments[n];for(const t in r){const n=this.readAttachment(r[t],e,i.index,t,s);n&&e.setAttachment(i.index,t,n)}}s.skins.push(e),"default"==e.name&&(s.defaultSkin=e)}for(let r=0,a=this.linkedMeshes.length;r<a;r++){const t=this.linkedMeshes[r],e=t.skin?s.findSkin(t.skin):s.defaultSkin;if(!e)throw new Error(`Skin not found: ${t.skin}`);const n=e.getAttachment(t.slotIndex,t.parent);if(!n)throw new Error(`Parent mesh not found: ${t.parent}`);t.mesh.timelineAttachment=t.inheritTimeline?n:t.mesh,t.mesh.setParentMesh(n)}if(this.linkedMeshes.length=0,n.events)for(const r in n.events){const t=n.events[r],e=new pE(r);e.intValue=cS(t,"int",0),e.floatValue=cS(t,"float",0),e.stringValue=cS(t,"string",""),e.audioPath=cS(t,"audio",null),e.audioPath&&(e.volume=cS(t,"volume",1),e.balance=cS(t,"balance",0)),s.events.push(e)}if(n.animations)for(const r in n.animations){const t=n.animations[r];this.readAnimation(t,r,s)}return s}readAttachment(t,e,s,n,i){const r=this.scale;switch(n=cS(t,"name",n),cS(t,"type","region")){case"region":{const s=cS(t,"path",n),i=this.readSequence(cS(t,"sequence",null)),a=this.attachmentLoader.newRegionAttachment(e,n,s,i);if(!a)return null;a.path=s,a.x=cS(t,"x",0)*r,a.y=cS(t,"y",0)*r,a.scaleX=cS(t,"scaleX",1),a.scaleY=cS(t,"scaleY",1),a.rotation=cS(t,"rotation",0),a.width=t.width*r,a.height=t.height*r,a.sequence=i;const o=cS(t,"color",null);return o&&a.color.setFromString(o),a}case"boundingbox":{const s=this.attachmentLoader.newBoundingBoxAttachment(e,n);if(!s)return null;this.readVertices(t,s,t.vertexCount<<1);const i=cS(t,"color",null);return i&&s.color.setFromString(i),s}case"mesh":case"linkedmesh":{const i=cS(t,"path",n),a=this.readSequence(cS(t,"sequence",null)),o=this.attachmentLoader.newMeshAttachment(e,n,i,a);if(!o)return null;o.path=i;const h=cS(t,"color",null);h&&o.color.setFromString(h),o.width=cS(t,"width",0)*r,o.height=cS(t,"height",0)*r,o.sequence=a;const l=cS(t,"parent",null);if(l)return this.linkedMeshes.push(new aS(o,cS(t,"skin",null),s,l,cS(t,"timelines",!0))),o;const c=t.uvs;return this.readVertices(t,o,c.length),o.triangles=t.triangles,o.regionUVs=new Float32Array(c),o.edges=cS(t,"edges",null),o.hullLength=2*cS(t,"hull",0),o}case"path":{const s=this.attachmentLoader.newPathAttachment(e,n);if(!s)return null;s.closed=cS(t,"closed",!1),s.constantSpeed=cS(t,"constantSpeed",!0);const i=t.vertexCount;this.readVertices(t,s,i<<1);const a=Ov.newArray(i/3,0);for(let e=0;e<t.lengths.length;e++)a[e]=t.lengths[e]*r;s.lengths=a;const o=cS(t,"color",null);return o&&s.color.setFromString(o),s}case"point":{const s=this.attachmentLoader.newPointAttachment(e,n);if(!s)return null;s.x=cS(t,"x",0)*r,s.y=cS(t,"y",0)*r,s.rotation=cS(t,"rotation",0);const i=cS(t,"color",null);return i&&s.color.setFromString(i),s}case"clipping":{const s=this.attachmentLoader.newClippingAttachment(e,n);if(!s)return null;const r=cS(t,"end",null);if(null!=r){const t=i.findSlot(r);if(null==t)throw new Error(`Clipping end slot not found: ${r}`);s.endSlot=t}const a=t.vertexCount;this.readVertices(t,s,a<<1);const o=cS(t,"color",null);return o&&s.color.setFromString(o),s}}return null}readSequence(t){if(null==t)return null;const e=new Gb(cS(t,"count",0));return e.start=cS(t,"start",1),e.digits=cS(t,"digits",0),e.setupIndex=cS(t,"setup",0),e}readVertices(t,e,s){const n=this.scale;e.worldVerticesLength=s;const i=t.vertices;if(s==i.length){const t=Ov.toFloatArray(i);if(1!=n)for(let e=0,s=i.length;e<s;e++)t[e]*=n;return void(e.vertices=t)}const r=new Array,a=new Array;for(let o=0,h=i.length;o<h;){const t=i[o++];a.push(t);for(let e=o+4*t;o<e;o+=4)a.push(i[o]),r.push(i[o+1]*n),r.push(i[o+2]*n),r.push(i[o+3])}e.bones=a,e.vertices=Ov.toFloatArray(r)}readAnimation(t,e,s){const n=this.scale,i=new Array;if(t.slots)for(const a in t.slots){const e=t.slots[a],n=s.findSlot(a);if(!n)throw new Error(`Slot not found: ${a}`);const r=n.index;for(const t in e){const s=e[t];if(!s)continue;const n=s.length;if("attachment"==t){const t=new Nw(n,r);for(let e=0;e<n;e++){const n=s[e];t.setFrame(e,cS(n,"time",0),cS(n,"name",null))}i.push(t)}else if("rgba"==t){const t=new Rw(n,n<<2,r);let e=s[0],a=cS(e,"time",0),o=Mv.fromString(e.color);for(let n=0,i=0;;n++){t.setFrame(n,a,o.r,o.g,o.b,o.a);const r=s[n+1];if(!r){t.shrink(i);break}const h=cS(r,"time",0),l=Mv.fromString(r.color),c=e.curve;c&&(i=lS(c,t,i,n,0,a,h,o.r,l.r,1),i=lS(c,t,i,n,1,a,h,o.g,l.g,1),i=lS(c,t,i,n,2,a,h,o.b,l.b,1),i=lS(c,t,i,n,3,a,h,o.a,l.a,1)),a=h,o=l,e=r}i.push(t)}else if("rgb"==t){const t=new kw(n,3*n,r);let e=s[0],a=cS(e,"time",0),o=Mv.fromString(e.color);for(let n=0,i=0;;n++){t.setFrame(n,a,o.r,o.g,o.b);const r=s[n+1];if(!r){t.shrink(i);break}const h=cS(r,"time",0),l=Mv.fromString(r.color),c=e.curve;c&&(i=lS(c,t,i,n,0,a,h,o.r,l.r,1),i=lS(c,t,i,n,1,a,h,o.g,l.g,1),i=lS(c,t,i,n,2,a,h,o.b,l.b,1)),a=h,o=l,e=r}i.push(t)}else if("alpha"==t)i.push(oS(s,new Dw(n,n,r),0,1));else if("rgba2"==t){const t=new Fw(n,7*n,r);let e=s[0],a=cS(e,"time",0),o=Mv.fromString(e.light),h=Mv.fromString(e.dark);for(let n=0,i=0;;n++){t.setFrame(n,a,o.r,o.g,o.b,o.a,h.r,h.g,h.b);const r=s[n+1];if(!r){t.shrink(i);break}const l=cS(r,"time",0),c=Mv.fromString(r.light),u=Mv.fromString(r.dark),d=e.curve;d&&(i=lS(d,t,i,n,0,a,l,o.r,c.r,1),i=lS(d,t,i,n,1,a,l,o.g,c.g,1),i=lS(d,t,i,n,2,a,l,o.b,c.b,1),i=lS(d,t,i,n,3,a,l,o.a,c.a,1),i=lS(d,t,i,n,4,a,l,h.r,u.r,1),i=lS(d,t,i,n,5,a,l,h.g,u.g,1),i=lS(d,t,i,n,6,a,l,h.b,u.b,1)),a=l,o=c,h=u,e=r}i.push(t)}else if("rgb2"==t){const t=new Ow(n,6*n,r);let e=s[0],a=cS(e,"time",0),o=Mv.fromString(e.light),h=Mv.fromString(e.dark);for(let n=0,i=0;;n++){t.setFrame(n,a,o.r,o.g,o.b,h.r,h.g,h.b);const r=s[n+1];if(!r){t.shrink(i);break}const l=cS(r,"time",0),c=Mv.fromString(r.light),u=Mv.fromString(r.dark),d=e.curve;d&&(i=lS(d,t,i,n,0,a,l,o.r,c.r,1),i=lS(d,t,i,n,1,a,l,o.g,c.g,1),i=lS(d,t,i,n,2,a,l,o.b,c.b,1),i=lS(d,t,i,n,3,a,l,h.r,u.r,1),i=lS(d,t,i,n,4,a,l,h.g,u.g,1),i=lS(d,t,i,n,5,a,l,h.b,u.b,1)),a=l,o=c,h=u,e=r}i.push(t)}}}if(t.bones)for(const a in t.bones){const e=t.bones[a],r=s.findBone(a);if(!r)throw new Error(`Bone not found: ${a}`);const o=r.index;for(const t in e){const s=e[t],r=s.length;if(0!=r)if("rotate"===t)i.push(oS(s,new bw(r,r,o),0,1));else if("translate"===t){const t=new ww(r,r<<1,o);i.push(hS(s,t,"x","y",0,n))}else if("translatex"===t){const t=new Ew(r,r,o);i.push(oS(s,t,0,n))}else if("translatey"===t){const t=new Sw(r,r,o);i.push(oS(s,t,0,n))}else if("scale"===t){const t=new Tw(r,r<<1,o);i.push(hS(s,t,"x","y",1,1))}else if("scalex"===t){const t=new Aw(r,r,o);i.push(oS(s,t,1,1))}else if("scaley"===t){const t=new Cw(r,r,o);i.push(oS(s,t,1,1))}else if("shear"===t){const t=new Mw(r,r<<1,o);i.push(hS(s,t,"x","y",0,1))}else if("shearx"===t){const t=new Iw(r,r,o);i.push(oS(s,t,0,1))}else if("sheary"===t){const t=new Pw(r,r,o);i.push(oS(s,t,0,1))}}}if(t.ik)for(const a in t.ik){const e=t.ik[a];let r=e[0];if(!r)continue;const o=s.findIkConstraint(a);if(!o)throw new Error(`IK Constraint not found: ${a}`);const h=s.ikConstraints.indexOf(o),l=new Xw(e.length,e.length<<1,h);let c=cS(r,"time",0),u=cS(r,"mix",1),d=cS(r,"softness",0)*n;for(let t=0,s=0;;t++){l.setFrame(t,c,u,d,cS(r,"bendPositive",!0)?1:-1,cS(r,"compress",!1),cS(r,"stretch",!1));const i=e[t+1];if(!i){l.shrink(s);break}const a=cS(i,"time",0),o=cS(i,"mix",1),h=cS(i,"softness",0)*n,f=r.curve;f&&(s=lS(f,l,s,t,0,c,a,u,o,1),s=lS(f,l,s,t,1,c,a,d,h,n)),c=a,u=o,d=h,r=i}i.push(l)}if(t.transform)for(const a in t.transform){const e=t.transform[a];let n=e[0];if(!n)continue;const r=s.findTransformConstraint(a);if(!r)throw new Error(`Transform constraint not found: ${a}`);const o=s.transformConstraints.indexOf(r),h=new Yw(e.length,6*e.length,o);let l=cS(n,"time",0),c=cS(n,"mixRotate",1),u=cS(n,"mixX",1),d=cS(n,"mixY",u),f=cS(n,"mixScaleX",1),p=cS(n,"mixScaleY",f);const m=cS(n,"mixShearY",1);for(let t=0,s=0;;t++){h.setFrame(t,l,c,u,d,f,p,m);const i=e[t+1];if(!i){h.shrink(s);break}const r=cS(i,"time",0),a=cS(i,"mixRotate",1),o=cS(i,"mixX",1),g=cS(i,"mixY",o),y=cS(i,"mixScaleX",1),v=cS(i,"mixScaleY",y),x=cS(i,"mixShearY",1),_=n.curve;_&&(s=lS(_,h,s,t,0,l,r,c,a,1),s=lS(_,h,s,t,1,l,r,u,o,1),s=lS(_,h,s,t,2,l,r,d,g,1),s=lS(_,h,s,t,3,l,r,f,y,1),s=lS(_,h,s,t,4,l,r,p,v,1),s=lS(_,h,s,t,5,l,r,m,x,1)),l=r,c=a,u=o,d=g,f=y,p=v,f=y,n=i}i.push(h)}if(t.path)for(const a in t.path){const e=t.path[a],r=s.findPathConstraint(a);if(!r)throw new Error(`Path constraint not found: ${a}`);const o=s.pathConstraints.indexOf(r);for(const t in e){const s=e[t];let a=s[0];if(!a)continue;const h=s.length;if("position"===t){const t=new Ww(h,h,o);i.push(oS(s,t,0,r.positionMode==fv.Fixed?n:1))}else if("spacing"===t){const t=new jw(h,h,o);i.push(oS(s,t,0,r.spacingMode==vE.Length||r.spacingMode==vE.Fixed?n:1))}else if("mix"===t){const t=new zw(h,3*h,o);let e=cS(a,"time",0),n=cS(a,"mixRotate",1),r=cS(a,"mixX",1),l=cS(a,"mixY",r);for(let i=0,o=0;;i++){t.setFrame(i,e,n,r,l);const h=s[i+1];if(!h){t.shrink(o);break}const c=cS(h,"time",0),u=cS(h,"mixRotate",1),d=cS(h,"mixX",1),f=cS(h,"mixY",d),p=a.curve;p&&(o=lS(p,t,o,i,0,e,c,n,u,1),o=lS(p,t,o,i,1,e,c,r,d,1),o=lS(p,t,o,i,2,e,c,l,f,1)),e=c,n=u,r=d,l=f,a=h}i.push(t)}}}if(t.deform){t.attachments={};for(const e in t.deform){const s=t.deform[e],n=t.attachments[e]={};for(const t in s){const e=s[t],i=n[t]={};for(const t in e)i[t]={deform:e[t]}}}}if(t.attachments)for(const a in t.attachments){const e=t.attachments[a],r=s.findSkin(a);if(null!=r)for(const t in e){const a=e[t],o=s.findSlot(t);if(!o)throw new Error(`Slot not found: ${t}`);const h=o.index;for(const t in a){const e=a[t],s=r.getAttachment(h,t);for(const t in e){const r=e[t];let a=r[0];if(a)if("deform"==t){const t=s.bones,e=s.vertices,o=t?e.length/3*2:e.length,l=new Bw(r.length,r.length,h,s);let c=cS(a,"time",0);for(let s=0,i=0;;s++){let h;const u=cS(a,"vertices",null);if(u){h=Ov.newFloatArray(o);const s=cS(a,"offset",0);if(Ov.arrayCopy(u,0,h,s,u.length),1!=n)for(let t=s,e=t+u.length;t<e;t++)h[t]*=n;if(!t)for(let t=0;t<o;t++)h[t]+=e[t]}else h=t?Ov.newFloatArray(o):e;l.setFrame(s,c,h);const d=r[s+1];if(!d){l.shrink(i);break}const f=cS(d,"time",0),p=a.curve;p&&(i=lS(p,l,i,s,0,c,f,0,1,1)),c=f,a=d}i.push(l)}else if("sequence"==t){const t=new Hw(r.length,h,s);let e=0;for(let s=0;s<r.length;s++){const n=cS(a,"delay",e),i=cS(a,"time",0),o=Hb[cS(a,"mode","hold")],h=cS(a,"index",0);t.setFrame(s,i,o,h,n),e=n,a=r[s+1]}i.push(t)}}}}}if(t.drawOrder){const e=new Uw(t.drawOrder.length),n=s.slots.length;let r=0;for(let i=0;i<t.drawOrder.length;i++,r++){const a=t.drawOrder[i];let o=null;const h=cS(a,"offsets",null);if(h){o=Ov.newArray(n,-1);const t=Ov.newArray(n-h.length,0);let e=0,i=0;for(let n=0;n<h.length;n++){const r=h[n],a=s.findSlot(r.slot);if(!a)throw new Error(`Slot not found: ${a}`);const l=a.index;for(;e!=l;)t[i++]=e++;o[e+r.offset]=e++}for(;e<n;)t[i++]=e++;for(let s=n-1;s>=0;s--)-1==o[s]&&(o[s]=t[--i])}e.setFrame(r,cS(a,"time",0),o)}i.push(e)}if(t.events){const e=new Vw(t.events.length);let n=0;for(let i=0;i<t.events.length;i++,n++){const r=t.events[i],a=s.findEvent(r.name);if(!a)throw new Error(`Event not found: ${r.name}`);const o=new fE(Ov.toSinglePrecision(cS(r,"time",0)),a);o.intValue=cS(r,"int",a.intValue),o.floatValue=cS(r,"float",a.floatValue),o.stringValue=cS(r,"string",a.stringValue),o.data.audioPath&&(o.volume=cS(r,"volume",1),o.balance=cS(r,"balance",0)),e.setFrame(n,o)}i.push(e)}let r=0;for(let a=0,o=i.length;a<o;a++)r=Math.max(r,i[a].getDuration());if(isNaN(r))throw new Error("Error while parsing animation, duration is NaN");s.animations.push(new Kb(e,i,r))}static blendModeFromString(t){if("normal"==(t=t.toLowerCase()))return ir.NORMAL;if("additive"==t)return ir.ADD;if("multiply"==t)return ir.MULTIPLY;if("screen"==t)return ir.SCREEN;throw new Error(`Unknown blend mode: ${t}`)}}class aS{constructor(t,e,s,n,i){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=n,this.inheritTimeline=i}}function oS(t,e,s,n){let i=t[0],r=cS(i,"time",0),a=cS(i,"value",s)*n,o=0;for(let h=0;;h++){e.setFrame(h,r,a);const l=t[h+1];if(!l)return e.shrink(o),e;const c=cS(l,"time",0),u=cS(l,"value",s)*n;i.curve&&(o=lS(i.curve,e,o,h,0,r,c,a,u,n)),r=c,a=u,i=l}}function hS(t,e,s,n,i,r){let a=t[0],o=cS(a,"time",0),h=cS(a,s,i)*r,l=cS(a,n,i)*r,c=0;for(let u=0;;u++){e.setFrame(u,o,h,l);const d=t[u+1];if(!d)return e.shrink(c),e;const f=cS(d,"time",0),p=cS(d,s,i)*r,m=cS(d,n,i)*r,g=a.curve;g&&(c=lS(g,e,c,u,0,o,f,h,p,r),c=lS(g,e,c,u,1,o,f,l,m,r)),o=f,h=p,l=m,a=d}}function lS(t,e,s,n,i,r,a,o,h,l){if("stepped"==t)return e.setStepped(n),s;const c=i<<2,u=t[c],d=t[c+1]*l,f=t[c+2],p=t[c+3]*l;return e.setBezier(s,n,i,r,o,u,d,f,p,a,h),s+1}function cS(t,e,s){return void 0!==t[e]?t[e]:s}const uS=Object.freeze(Object.defineProperty({__proto__:null,AlphaTimeline:Dw,Animation:Kb,AnimationState:Kw,AnimationStateAdapter:class{start(t){}interrupt(t){}end(t){}dispose(t){}complete(t){}event(t,e){}},AnimationStateData:hE,AtlasAttachmentLoader:lE,Attachment:Nb,AttachmentTimeline:Nw,Bone:cE,BoneData:uE,BoundingBoxAttachment:Vb,ClippingAttachment:$b,ConstraintData:dE,CurveTimeline:vw,CurveTimeline1:xw,CurveTimeline2:_w,DeformTimeline:Bw,DrawOrderTimeline:Uw,Event:fE,EventData:pE,EventQueue:Jw,EventTimeline:Vw,EventType:tE,IkConstraint:mE,IkConstraintData:gE,IkConstraintTimeline:Xw,MeshAttachment:Ub,PathAttachment:Xb,PathConstraint:_E,PathConstraintData:yE,PathConstraintMixTimeline:zw,PathConstraintPositionTimeline:Ww,PathConstraintSpacingTimeline:jw,PointAttachment:Yb,RGB2Timeline:Ow,RGBA2Timeline:Fw,RGBATimeline:Rw,RGBTimeline:kw,RegionAttachment:jb,RotateTimeline:bw,ScaleTimeline:Tw,ScaleXTimeline:Aw,ScaleYTimeline:Cw,Sequence:Gb,SequenceMode:Hb,SequenceModeValues:qb,SequenceTimeline:Hw,ShearTimeline:Mw,ShearXTimeline:Iw,ShearYTimeline:Pw,Skeleton:SE,SkeletonBinary:PE,SkeletonBounds:class extends Lv{},SkeletonData:TE,SkeletonJson:rS,Skin:IE,SkinEntry:ME,Slot:bE,SlotData:AE,SpacingMode:vE,Spine:class extends Wv{createSkeleton(t){this.skeleton=new SE(t),this.skeleton.updateWorldTransform(),this.stateData=new hE(t),this.state=new Kw(this.stateData)}},Timeline:yw,TrackEntry:Qw,TransformConstraint:wE,TransformConstraintData:CE,TransformConstraintTimeline:Yw,TranslateTimeline:ww,TranslateXTimeline:Ew,TranslateYTimeline:Sw,VertexAttachment:Lb},Symbol.toStringTag,{value:"Module"}));var dS=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.VER37=37]="VER37",t[t.VER38=38]="VER38",t[t.VER40=40]="VER40",t[t.VER41=41]="VER41",t))(dS||{});function fS(t){const e=t.substr(0,3),s=Math.floor(10*Number(e)+.001);return"3.7"===e?37:"3.8"===e?38:"4.0"===e?40:"4.1"===e?41:s<37?37:0}class pS{constructor(){this.scale=1}readSkeletonData(t,e){let s=null,n=this.readVersionOldFormat(e),i=fS(n);if(i===dS.VER38&&(s=new f_(new zx(t))),n=this.readVersionNewFormat(e),i=fS(n),i!==dS.VER40&&i!==dS.VER41||(s=new PE(new lE(t))),!s){const t=`Unsupported version of spine model ${n}, please update pixi-spine`;console.error(t)}return s.scale=this.scale,s.readSkeletonData(e)}readVersionOldFormat(t){const e=new cv(t);let s;try{e.readString(),s=e.readString()}catch(jp){s=""}return s||""}readVersionNewFormat(t){const e=new cv(t);let s;e.readInt32(),e.readInt32();try{s=e.readString()}catch(jp){s=""}return s||""}}class mS{constructor(){this.scale=1}readSkeletonData(t,e){const s=e.skeleton.spine,n=fS(s);let i=null;if(n===dS.VER37&&(i=new Db(new mb(t))),n===dS.VER38&&(i=new g_(new zx(t))),n!==dS.VER40&&n!==dS.VER41||(i=new rS(new lE(t))),!i){const t=`Unsupported version of spine model ${s}, please update pixi-spine`;console.error(t)}return i.scale=this.scale,i.readSkeletonData(e)}}class gS extends Wv{createSkeleton(t){const e=fS(t.version);let s=null;if(e===dS.VER37&&(s=Ob),e===dS.VER38&&(s=v_),e!==dS.VER40&&e!==dS.VER41||(s=uS),!s){const e=`Cant detect version of spine model ${t.version}`;console.error(e)}this.skeleton=new s.Skeleton(t),this.skeleton.updateWorldTransform(),this.stateData=new s.AnimationStateData(t),this.state=new s.AnimationState(this.stateData)}}(new class extends qv{createBinaryParser(){return new pS}createJsonParser(){return new mS}parseData(t,e,s){return{spineData:t.readSkeletonData(e,s),spineAtlas:e}}}).installLoader();const yS=class extends(Zm(gS)){constructor(t){super(globalThis.pgame.getSpine(t).spineData),d(this,"_pivotRule",jm.Center),this.autoUpdate=!1,this.update=this._update}get pivotRule(){return jm.Center}get debugBox(){return!1}get enable(){return this.update===this._update}set enable(t){this.update=t?this._update:globalThis.doNothing}_update(t){gS.prototype.update.call(this,.001*globalThis.pgame.DeltaMS)}get debug(){return super.debug}set debug(t){super.debug=t}constructDebugRenderer(t=!0){void 0!==this.debug||(this.debug=t?yS.debug:new jv)}};d(yS,"debug",new jv);class vS extends(function(t){const e=t;return class extends e{constructor(...t){super(...t),d(this,"isPointerDown",!1),d(this,"isPointerOver",!1),d(this,"_vbEvents",{}),this.eventMode="static",this.defaultClickEffect(Hm.Black,.2).defaultHoverEffect(Hm.White,.3)}getListener(t){return this._vbEvents[t]}_toggle(t,e,s){const n=this._vbEvents[e];return void 0!==n&&this.off(t,n),!0===s?void 0!==n&&this.on(t,n):!1!==s&&(this._vbEvents[e]=s,this.on(t,s)),this}toggle(t,e){return this._toggle(t,t,e)}setOnClick(t){return this._toggle("pointertap","pointertap",t)}setClickSound(t,e){if("object"==typeof t){const s=()=>t.play(e);return this._toggle("pointertap","clicksound",s)}return this._toggle("pointertap","clicksound",t)}setHoverEffect(t,e){if(Eg())return this;if("boolean"==typeof t)return this._toggle("pointerover","hovereffect",t)._toggle("pointerout","clearhover",t);return this._toggle("pointerover","hovereffect",(e=>{var s,n;this.isPointerOver=!0,this.isPointerDown?null==(n=(s=this._vbEvents).clickeffect)||n.call(s,e):t(e)}))._toggle("pointerout","clearhover",(t=>{this.isPointerOver=!1,e(t)}))}setClickEffect(t,e){if("boolean"==typeof t)return this._toggle("pointerdown","clickeffect",t)._toggle("pointerup","clearclick",t)._toggle("pointerupoutside","clearclick",t);const s=t=>{this.isPointerDown=!1,e(t)};return this._toggle("pointerdown","clickeffect",(e=>{this.isPointerDown=!0,t(e)}))._toggle("pointerup","clearclick",s)._toggle("pointerupoutside","clearclick",s)}defaultHoverEffect(t,e,s=Km.colorFilter){return void 0===this._defaultColorFilter&&(this._defaultColorFilter=s),this.setHoverEffect((()=>{var n;s.color=t,s.alpha=e,(null==(n=this.filters)?void 0:n.includes(s))||this.addFilter(s)}),(()=>{var t;null==(t=this.filters)||t.removeOnce(s)}))}defaultClickEffect(t,e,s=Km.colorFilter){return void 0===this._defaultColorFilter&&(this._defaultColorFilter=s),this.setClickEffect((()=>{var n;s.color=t,s.alpha=e,(null==(n=this.filters)?void 0:n.includes(s))||this.addFilter(s)}),(()=>{var t;null==(t=this.filters)||t.removeOnce(s)}))}clearEffect(){var t;this.isPointerDown=this.isPointerOver=!1,null==(t=this.filters)||t.removeOnce(this._defaultColorFilter)}}}(nv)){}const xS=class extends rv{constructor(){super({font:"Arial",size:20,fill:Hm.Green}),d(this,"_totalFrames",0),d(this,"_totalFPS",0),this.style.dropShadow=!0,this.style.dropShadowColor=Hm.Black,this.style.dropShadowDistance=4}update(){this._totalFrames++,this._totalFPS+=globalThis.pgame.FPS,this._totalFrames>=xS.N_FRAME&&(this.text=(this._totalFPS/this._totalFrames).toFixed(0),this._totalFrames=0,this._totalFPS=0)}};let _S=xS;d(_S,"N_FRAME",5);class bS extends g{constructor(t,e,s=0,n=0,i=!1){super(),d(this,"enable"),d(this,"time"),d(this,"delay"),d(this,"repeat"),d(this,"isEnded"),d(this,"isStarted"),d(this,"preserved"),d(this,"_delayTime"),d(this,"_elapsedTime"),d(this,"_repeat"),d(this,"_timerManager"),d(this,"_next"),this.time=e,this.enable=!1,this.delay=n,this.repeat=s,this.preserved=i,this.isEnded=!1,this.isStarted=!1,this._delayTime=0,this._elapsedTime=0,this._repeat=0,this._timerManager=t,this.preserved&&t.add(this)}get timerManager(){return this._timerManager}set timerManager(t){this._timerManager!==t&&(this._timerManager.remove(this),this._timerManager=t,this.preserved&&t.add(this))}start(t=!1){return t&&this.reset(),this.enable=!0,this.preserved||this._timerManager.add(this),this}stop(t=!0){return this.isEnded=!0,this.enable=!1,t&&this.emit("end",this._elapsedTime),this}reset(){return this._elapsedTime=0,this._repeat=0,this._delayTime=0,this.isStarted=!1,this.isEnded=!1,this}remove(){return this._timerManager.remove(this),this}chain(t){return this._next=t,t.timerManager=this.timerManager,this}single(t,e,s){return this.off(t).on(t,e,s)}update(t){var e;if(this.delay>this._delayTime)this._delayTime+=t;else if(this.isStarted||(this.isStarted=!0,this.emit("start",this._elapsedTime)),this.time>this._elapsedTime){const s=this._elapsedTime+t,n=s>=this.time;if(this._elapsedTime=n?this.time:s,this.emit("update",this._elapsedTime,t),n){if(this.repeat>this._repeat)return this._repeat++,this.emit("repeat",this._elapsedTime,this._repeat),void(this._elapsedTime=0);this.stop(),null==(e=this._next)||e.start()}}}}class wS{constructor(){d(this,"_timers",[]),d(this,"_timersToDelete",[])}size(){return this._timers.length}update(t){if(this._timersToDelete.length){for(const t of this._timersToDelete)this._remove(t);this._timersToDelete.length=0}for(const e of this._timers)e.enable&&(e.update(t),e.isEnded&&!e.preserved&&this.remove(e))}add(t){(t.preserved||t.enable)&&this._timers.push(t)}stopAll(t=!1){for(const e of this._timers)e.stop(t)}remove(t){this._timersToDelete.push(t)}_remove(t){const e=this._timers.indexOf(t);e>-1&&this._timers.splice(e,1)}}const ES=class extends Au{constructor(t){if(t.resolution=_r.RESOLUTION=window.devicePixelRatio,gl.defaultResolution=window.devicePixelRatio,t.eventMode="none",t.eventFeatures={globalMove:!!t.dragEvent},super(t),d(this,"stage",new ag),d(this,"bgRect"),d(this,"assets",ad),d(this,"soundManager",Ny),d(this,"timers"),d(this,"interact"),d(this,"desiredWidth",0),d(this,"desiredHeight",0),d(this,"desiredRatio",0),d(this,"currState"),d(this,"currStyle",sv),d(this,"currLocale",Jm),d(this,"currScene",{}),d(this,"_states",{}),d(this,"_viewStyles",{"":sv}),d(this,"_locales",{"":Jm}),d(this,"_scenes",{}),d(this,"_textures"),d(this,"_sequences"),d(this,"_spines"),d(this,"onGameReady",globalThis.doNothing),d(this,"_txtFPS"),Km.init(),this.timers=new wS,this.stage.name="MAIN",this.stage.eventMode="static",void 0!==t.backgroundRect){let e=!0!==t.backgroundRect?t.backgroundRect:Hm.White;const s=new ov(100,100).fill(e,1);this.bgRect=new hv(s),this.bgRect.alpha=0,this.bgRect.eventMode="auto",this.stage.addObj(this.bgRect),this.stage.sendObjToBack(this.bgRect)}else this.bgRect=new hv}mainLoop(t){}startLoop(){this.mainLoop=this.mainLoop.bind(this),this.ticker.add(this.mainLoop,{},Ac.HIGH)}resizeAppView(t,e){}setResolution(t,e){this.desiredWidth=t,this.desiredHeight=e,this.desiredRatio=e/t,this.bgRect.width=t,this.bgRect.height=e,void 0!==this._txtFPS&&(this._txtFPS.x=t-40),this.stage.setDesiredSize(t,e)}createGlobalTimer(t,e=0,s=0,n=!1){return new bS(this.timers,t,e,s,n)}loadAssets(){return f(this,null,(function*(){const t=yield(e="assets-list.json",fetch(e).then((t=>t.json())));var e;const s=this.assets;yield s.loadFromList(t),[this._textures,this._sequences]=s.get_multipack_textureMap(t),this._spines=s.get_SpineMap(t.spine_json),Object.assign(this._viewStyles,s.get_viewStyleMap(t.style)),Object.assign(this._locales,s.get_localeMap(t.lang))}))}useCurrentViewStlye(){this.stage.useViewStyleChildren(this.currStyle.list)}useCurrentLocale(){this.stage.useLocale(this.currLocale)}state(t){return this._states[t]}setState(t){this.currState=this.state(t)}addState(...t){for(const e of t)this._states[e.name]=e}viewStyle(t){return ES.runtimeCheck(this._viewStyles,t,"style")}setViewStyle(t){this.currStyle=this.viewStyle(t)}locale(t){return ES.runtimeCheck(this._locales,t,"locale")}setLocale(t){this.currLocale=this.locale(t)}addLocale(t,e){this._locales[t]=e}scene(t){return ES.runtimeCheck(this._scenes,t,"scene")}setScene(t){this.currScene[t.rootContainer.name]=t}addScenes(...t){for(const e of t)this._scenes[e.name]=e}getTex(t){return ES.runtimeCheck(this._textures,t,"texture")}addTextures(t){Object.assign(this._textures,t)}getSeq(t){return ES.runtimeCheck(this._sequences,t,"sequence")}addSequences(t){Object.assign(this._sequences,t)}getSpine(t){return ES.runtimeCheck(this._spines,t,"spine")}addSpines(t){Object.assign(this._spines,t)}get DeltaMS(){return this.ticker.elapsedMS}get TotalMS(){return this.ticker.lastTime}get FPS(){return this.ticker.FPS}showFPS(){void 0===this._txtFPS&&(this._txtFPS=new _S,this._txtFPS.x=this.desiredWidth-40,this._txtFPS.y=0,this.stage.addObj(this._txtFPS,Km.maxLayer+1))}};let SS=ES;d(SS,"runtimeCheck",((t,e,s)=>t[e]));class TS{constructor(t){d(this,"name"),d(this,"_firstIn",!0),d(this,"_firstOut",!0),d(this,"_canExit",!1),d(this,"_nextState"),d(this,"timers"),this.name=t,this._nextState="",this.timers=new wS}enter(){}update(t){}prepareExit(){this._canExit=!0}exit(){}setNext(t){this._nextState=t}runFSM(t){return this._firstIn&&(this._firstIn=!1,this._firstOut=!0,this._canExit=!1,this._nextState="",this.enter()),globalThis.pgame.timers.update(globalThis.pgame.DeltaMS),this.timers.update(globalThis.pgame.DeltaMS),this.update(t),""!=this._nextState&&(this._firstOut&&(this._firstOut=!1,this.prepareExit()),this._canExit)?(this._firstIn=!0,this.exit(),this._nextState):""}createTimer(t,e=0,s=0,n=!1){return new bS(this.timers,t,e,s,n)}}class AS{constructor(t,e,s){this.value=t,this.time=e,this.next=null,this.isStepped=!1,this.ease=s?"function"==typeof s?s:FS(s):null}static createList(t){if("list"in t){const e=t.list;let s;const{value:n,time:i}=e[0],r=s=new AS("string"==typeof n?DS(n):n,i,t.ease);if(e.length>2||2===e.length&&e[1].value!==n)for(let t=1;t<e.length;++t){const{value:n,time:i}=e[t];s.next=new AS("string"==typeof n?DS(n):n,i),s=s.next}return r.isStepped=!!t.isStepped,r}const e=new AS("string"==typeof t.start?DS(t.start):t.start,0);return t.end!==t.start&&(e.next=new AS("string"==typeof t.end?DS(t.end):t.end,1)),e}}let CS=Il.from;const MS=Math.PI/180;function IS(t,e){if(!t)return;const s=Math.sin(t),n=Math.cos(t),i=e.x*n-e.y*s,r=e.x*s+e.y*n;e.x=i,e.y=r}function PS(t,e,s){return t<<16|e<<8|s}function RS(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function kS(t,e){t.x*=e,t.y*=e}function DS(t,e){let s;return e||(e={}),"#"===t.charAt(0)?t=t.substr(1):0===t.indexOf("0x")&&(t=t.substr(2)),8===t.length&&(s=t.substr(0,2),t=t.substr(2)),e.r=parseInt(t.substr(0,2),16),e.g=parseInt(t.substr(2,2),16),e.b=parseInt(t.substr(4,2),16),s&&(e.a=parseInt(s,16)),e}function FS(t){const e=t.length,s=1/e;return function(n){const i=e*n|0,r=(n-i*s)*e,a=t[i]||t[e-1];return a.s+r*(2*(1-r)*(a.cp-a.s)+r*(a.e-a.s))}}class OS extends su{constructor(t){super(),this.prevChild=this.nextChild=null,this.emitter=t,this.config={},this.anchor.x=this.anchor.y=.5,this.maxLife=0,this.age=0,this.agePercent=0,this.oneOverLife=0,this.next=null,this.prev=null,this.init=this.init,this.kill=this.kill}init(t){this.maxLife=t,this.age=this.agePercent=0,this.rotation=0,this.position.x=this.position.y=0,this.scale.x=this.scale.y=1,this.tint=16777215,this.alpha=1,this.oneOverLife=1/this.maxLife,this.visible=!0}kill(){this.emitter.recycle(this)}destroy(){this.parent&&this.parent.removeChild(this),this.emitter=this.next=this.prev=null,super.destroy()}}var NS,BS;(BS=NS||(NS={}))[BS.Spawn=0]="Spawn",BS[BS.Normal=2]="Normal",BS[BS.Late=5]="Late";const LS=Ic.shared,VS=Symbol("Position particle per emitter position");class $S{constructor(t,e){this.initBehaviors=[],this.updateBehaviors=[],this.recycleBehaviors=[],this.minLifetime=0,this.maxLifetime=0,this.customEase=null,this._frequency=1,this.spawnChance=1,this.maxParticles=1e3,this.emitterLifetime=-1,this.spawnPos=new _h,this.particlesPerWave=1,this.rotation=0,this.ownerPos=new _h,this._prevEmitterPos=new _h,this._prevPosIsValid=!1,this._posChanged=!1,this._parent=null,this.addAtBack=!1,this.particleCount=0,this._emit=!1,this._spawnTimer=0,this._emitterLife=-1,this._activeParticlesFirst=null,this._activeParticlesLast=null,this._poolFirst=null,this._origConfig=null,this._autoUpdate=!1,this._destroyWhenComplete=!1,this._completeCallback=null,this.parent=t,e&&this.init(e),this.recycle=this.recycle,this.update=this.update,this.rotate=this.rotate,this.updateSpawnPos=this.updateSpawnPos,this.updateOwnerPos=this.updateOwnerPos}static registerBehavior(t){$S.knownBehaviors[t.type]=t}get frequency(){return this._frequency}set frequency(t){this._frequency="number"==typeof t&&t>0?t:1}get parent(){return this._parent}set parent(t){this.cleanup(),this._parent=t}init(t){if(!t)return;this.cleanup(),this._origConfig=t,this.minLifetime=t.lifetime.min,this.maxLifetime=t.lifetime.max,t.ease?this.customEase="function"==typeof t.ease?t.ease:FS(t.ease):this.customEase=null,this.particlesPerWave=1,t.particlesPerWave&&t.particlesPerWave>1&&(this.particlesPerWave=t.particlesPerWave),this.frequency=t.frequency,this.spawnChance="number"==typeof t.spawnChance&&t.spawnChance>0?t.spawnChance:1,this.emitterLifetime=t.emitterLifetime||-1,this.maxParticles=t.maxParticles>0?t.maxParticles:1e3,this.addAtBack=!!t.addAtBack,this.rotation=0,this.ownerPos.set(0),t.pos?this.spawnPos.copyFrom(t.pos):this.spawnPos.set(0),this._prevEmitterPos.copyFrom(this.spawnPos),this._prevPosIsValid=!1,this._spawnTimer=0,this.emit=void 0===t.emit||!!t.emit,this.autoUpdate=!!t.autoUpdate;const e=t.behaviors.map((t=>{const e=$S.knownBehaviors[t.type];return e?new e(t.config):(console.error(`Unknown behavior: ${t.type}`),null)})).filter((t=>!!t));e.push(VS),e.sort(((t,e)=>t===VS?e.order===NS.Spawn?1:-1:e===VS?t.order===NS.Spawn?-1:1:t.order-e.order)),this.initBehaviors=e.slice(),this.updateBehaviors=e.filter((t=>t!==VS&&t.updateParticle)),this.recycleBehaviors=e.filter((t=>t!==VS&&t.recycleParticle))}getBehavior(t){return $S.knownBehaviors[t]&&this.initBehaviors.find((e=>e instanceof $S.knownBehaviors[t]))||null}fillPool(t){for(;t>0;--t){const t=new OS(this);t.next=this._poolFirst,this._poolFirst=t}}recycle(t,e=!1){for(let s=0;s<this.recycleBehaviors.length;++s)this.recycleBehaviors[s].recycleParticle(t,!e);t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next),t===this._activeParticlesLast&&(this._activeParticlesLast=t.prev),t===this._activeParticlesFirst&&(this._activeParticlesFirst=t.next),t.prev=null,t.next=this._poolFirst,this._poolFirst=t,t.parent&&t.parent.removeChild(t),--this.particleCount}rotate(t){if(this.rotation===t)return;const e=t-this.rotation;this.rotation=t,IS(e,this.spawnPos),this._posChanged=!0}updateSpawnPos(t,e){this._posChanged=!0,this.spawnPos.x=t,this.spawnPos.y=e}updateOwnerPos(t,e){this._posChanged=!0,this.ownerPos.x=t,this.ownerPos.y=e}resetPositionTracking(){this._prevPosIsValid=!1}get emit(){return this._emit}set emit(t){this._emit=!!t,this._emitterLife=this.emitterLifetime}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){this._autoUpdate&&!t?LS.remove(this.update,this):!this._autoUpdate&&t&&LS.add(this.update,this),this._autoUpdate=!!t}playOnceAndDestroy(t){this.autoUpdate=!0,this.emit=!0,this._destroyWhenComplete=!0,this._completeCallback=t}playOnce(t){this.emit=!0,this._completeCallback=t}update(t){if(this._autoUpdate&&(t=.001*LS.elapsedMS),!this._parent)return;for(let r,a=this._activeParticlesFirst;a;a=r)if(r=a.next,a.age+=t,a.age>a.maxLife||a.age<0)this.recycle(a);else{let e=a.age*a.oneOverLife;this.customEase&&(e=4===this.customEase.length?this.customEase(e,0,1,1):this.customEase(e)),a.agePercent=e;for(let s=0;s<this.updateBehaviors.length;++s)if(this.updateBehaviors[s].updateParticle(a,t)){this.recycle(a);break}}let e,s;this._prevPosIsValid&&(e=this._prevEmitterPos.x,s=this._prevEmitterPos.y);const n=this.ownerPos.x+this.spawnPos.x,i=this.ownerPos.y+this.spawnPos.y;if(this._emit)for(this._spawnTimer-=t<0?0:t;this._spawnTimer<=0;){if(this._emitterLife>=0&&(this._emitterLife-=this._frequency,this._emitterLife<=0)){this._spawnTimer=0,this._emitterLife=0,this.emit=!1;break}if(this.particleCount>=this.maxParticles){this._spawnTimer+=this._frequency;continue}let r,a;if(this._prevPosIsValid&&this._posChanged){const o=1+this._spawnTimer/t;r=(n-e)*o+e,a=(i-s)*o+s}else r=n,a=i;let o=null,h=null;for(let t=Math.min(this.particlesPerWave,this.maxParticles-this.particleCount),e=0;e<t;++e){if(this.spawnChance<1&&Math.random()>=this.spawnChance)continue;let t,e;(t=this.minLifetime===this.maxLifetime?this.minLifetime:Math.random()*(this.maxLifetime-this.minLifetime)+this.minLifetime,-this._spawnTimer>=t)||(this._poolFirst?(e=this._poolFirst,this._poolFirst=this._poolFirst.next,e.next=null):e=new OS(this),e.init(t),this.addAtBack?this._parent.addChildAt(e,0):this._parent.addChild(e),o?(h.next=e,e.prev=h,h=e):h=o=e,++this.particleCount)}if(o){this._activeParticlesLast?(this._activeParticlesLast.next=o,o.prev=this._activeParticlesLast,this._activeParticlesLast=h):(this._activeParticlesFirst=o,this._activeParticlesLast=h);for(let t=0;t<this.initBehaviors.length;++t){const e=this.initBehaviors[t];if(e===VS)for(let t,s=o;s;s=t){t=s.next,0!==this.rotation&&(IS(this.rotation,s.position),s.rotation+=this.rotation),s.position.x+=r,s.position.y+=a,s.age+=-this._spawnTimer;let e=s.age*s.oneOverLife;this.customEase&&(e=4===this.customEase.length?this.customEase(e,0,1,1):this.customEase(e)),s.agePercent=e}else e.initParticles(o)}for(let t,e=o;e;e=t){t=e.next;for(let t=0;t<this.updateBehaviors.length;++t)if(this.updateBehaviors[t].updateParticle(e,-this._spawnTimer)){this.recycle(e);break}}}this._spawnTimer+=this._frequency}if(this._posChanged&&(this._prevEmitterPos.x=n,this._prevEmitterPos.y=i,this._prevPosIsValid=!0,this._posChanged=!1),!this._emit&&!this._activeParticlesFirst){if(this._completeCallback){const t=this._completeCallback;this._completeCallback=null,t()}this._destroyWhenComplete&&this.destroy()}}emitNow(){const t=this.ownerPos.x+this.spawnPos.x,e=this.ownerPos.y+this.spawnPos.y;let s=null,n=null;for(let i=Math.min(this.particlesPerWave,this.maxParticles-this.particleCount),r=0;r<i;++r){if(this.spawnChance<1&&Math.random()>=this.spawnChance)continue;let t,e;this._poolFirst?(t=this._poolFirst,this._poolFirst=this._poolFirst.next,t.next=null):t=new OS(this),e=this.minLifetime===this.maxLifetime?this.minLifetime:Math.random()*(this.maxLifetime-this.minLifetime)+this.minLifetime,t.init(e),this.addAtBack?this._parent.addChildAt(t,0):this._parent.addChild(t),s?(n.next=t,t.prev=n,n=t):n=s=t,++this.particleCount}if(s){this._activeParticlesLast?(this._activeParticlesLast.next=s,s.prev=this._activeParticlesLast,this._activeParticlesLast=n):(this._activeParticlesFirst=s,this._activeParticlesLast=n);for(let n=0;n<this.initBehaviors.length;++n){const i=this.initBehaviors[n];if(i===VS)for(let n,r=s;r;r=n)n=r.next,0!==this.rotation&&(IS(this.rotation,r.position),r.rotation+=this.rotation),r.position.x+=t,r.position.y+=e;else i.initParticles(s)}}}cleanup(){let t,e;for(t=this._activeParticlesFirst;t;t=e)e=t.next,this.recycle(t,!0);this._activeParticlesFirst=this._activeParticlesLast=null,this.particleCount=0}get destroyed(){return!(this._parent&&this.initBehaviors.length)}destroy(){let t;this.autoUpdate=!1,this.cleanup();for(let e=this._poolFirst;e;e=t)t=e.next,e.destroy();this._poolFirst=this._parent=this.spawnPos=this.ownerPos=this.customEase=this._completeCallback=null,this.initBehaviors.length=this.updateBehaviors.length=this.recycleBehaviors.length=0}}$S.knownBehaviors={};class US{constructor(t){this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h}getRandPos(t){t.x=Math.random()*this.w+this.x,t.y=Math.random()*this.h+this.y}}US.type="rect",US.editorConfig=null;class XS{constructor(t){this.x=t.x||0,this.y=t.y||0,this.radius=t.radius,this.innerRadius=t.innerRadius||0,this.rotation=!!t.affectRotation}getRandPos(t){this.innerRadius!==this.radius?t.x=Math.random()*(this.radius-this.innerRadius)+this.innerRadius:t.x=this.radius,t.y=0;const e=Math.random()*Math.PI*2;this.rotation&&(t.rotation+=e),IS(e,t.position),t.position.x+=this.x,t.position.y+=this.y}}XS.type="torus",XS.editorConfig=null;class YS{constructor(t){this.segments=[],this.countingLengths=[],this.totalLength=0,this.init(t)}init(t){if(t&&t.length)if(Array.isArray(t[0]))for(let e=0;e<t.length;++e){const s=t[e];let n=s[0];for(let t=1;t<s.length;++t){const e=s[t];this.segments.push({p1:n,p2:e,l:0}),n=e}}else{let e=t[0];for(let s=1;s<t.length;++s){const n=t[s];this.segments.push({p1:e,p2:n,l:0}),e=n}}else this.segments.push({p1:{x:0,y:0},p2:{x:0,y:0},l:0});for(let e=0;e<this.segments.length;++e){const{p1:t,p2:s}=this.segments[e],n=Math.sqrt((s.x-t.x)*(s.x-t.x)+(s.y-t.y)*(s.y-t.y));this.segments[e].l=n,this.totalLength+=n,this.countingLengths.push(this.totalLength)}}getRandPos(t){const e=Math.random()*this.totalLength;let s,n;if(1===this.segments.length)s=this.segments[0],n=e;else for(let a=0;a<this.countingLengths.length;++a)if(e<this.countingLengths[a]){s=this.segments[a],n=0===a?e:e-this.countingLengths[a-1];break}n/=s.l||1;const{p1:i,p2:r}=s;t.x=i.x+n*(r.x-i.x),t.y=i.y+n*(r.y-i.y)}}YS.type="polygonalChain",YS.editorConfig=null;class WS{constructor(t){var e;this.order=NS.Late,this.minStart=t.minStart,this.maxStart=t.maxStart,this.accel=t.accel,this.rotate=!!t.rotate,this.maxSpeed=null!==(e=t.maxSpeed)&&void 0!==e?e:0}initParticles(t){let e=t;for(;e;){const t=Math.random()*(this.maxStart-this.minStart)+this.minStart;e.config.velocity?e.config.velocity.set(t,0):e.config.velocity=new _h(t,0),IS(e.rotation,e.config.velocity),e=e.next}}updateParticle(t,e){const s=t.config.velocity,n=s.x,i=s.y;if(s.x+=this.accel.x*e,s.y+=this.accel.y*e,this.maxSpeed){const t=RS(s);t>this.maxSpeed&&kS(s,this.maxSpeed/t)}t.x+=(n+s.x)/2*e,t.y+=(i+s.y)/2*e,this.rotate&&(t.rotation=Math.atan2(s.y,s.x))}}function jS(t){return this.ease&&(t=this.ease(t)),(this.first.next.value-this.first.value)*t+this.first.value}function zS(t){this.ease&&(t=this.ease(t));const e=this.first.value,s=this.first.next.value;return PS((s.r-e.r)*t+e.r,(s.g-e.g)*t+e.g,(s.b-e.b)*t+e.b)}function GS(t){this.ease&&(t=this.ease(t));let e=this.first,s=e.next;for(;t>s.time;)e=s,s=s.next;return t=(t-e.time)/(s.time-e.time),(s.value-e.value)*t+e.value}function HS(t){this.ease&&(t=this.ease(t));let e=this.first,s=e.next;for(;t>s.time;)e=s,s=s.next;t=(t-e.time)/(s.time-e.time);const n=e.value,i=s.value;return PS((i.r-n.r)*t+n.r,(i.g-n.g)*t+n.g,(i.b-n.b)*t+n.b)}function qS(t){this.ease&&(t=this.ease(t));let e=this.first;for(;e.next&&t>e.next.time;)e=e.next;return e.value}function KS(t){this.ease&&(t=this.ease(t));let e=this.first;for(;e.next&&t>e.next.time;)e=e.next;const s=e.value;return PS(s.r,s.g,s.b)}WS.type="moveAcceleration",WS.editorConfig=null;class ZS{constructor(t=!1){this.first=null,this.isColor=!!t,this.interpolate=null,this.ease=null}reset(t){this.first=t;t.next&&t.next.time>=1?this.interpolate=this.isColor?zS:jS:t.isStepped?this.interpolate=this.isColor?KS:qS:this.interpolate=this.isColor?HS:GS,this.ease=this.first.ease}}class QS{constructor(t){this.order=NS.Normal,this.list=new ZS(!1),this.list.reset(AS.createList(t.alpha))}initParticles(t){let e=t;for(;e;)e.alpha=this.list.first.value,e=e.next}updateParticle(t){t.alpha=this.list.interpolate(t.agePercent)}}QS.type="alpha",QS.editorConfig=null;class JS{constructor(t){this.order=NS.Normal,this.value=t.alpha}initParticles(t){let e=t;for(;e;)e.alpha=this.value,e=e.next}}function tT(t){const e=[];for(let s=0;s<t.length;++s){let n=t[s];if("string"==typeof n)e.push(CS(n));else if(n instanceof Il)e.push(n);else{let t=n.count||1;for(n="string"==typeof n.texture?CS(n.texture):n.texture;t>0;--t)e.push(n)}}return e}JS.type="alphaStatic",JS.editorConfig=null;class eT{constructor(t){this.order=NS.Normal,this.anims=[];for(let e=0;e<t.anims.length;++e){const s=t.anims[e],n=tT(s.textures),i=s.framerate<0?-1:s.framerate>0?s.framerate:60,r={textures:n,duration:i>0?n.length/i:0,framerate:i,loop:i>0&&!!s.loop};this.anims.push(r)}}initParticles(t){let e=t;for(;e;){const t=Math.floor(Math.random()*this.anims.length),s=e.config.anim=this.anims[t];e.texture=s.textures[0],e.config.animElapsed=0,-1===s.framerate?(e.config.animDuration=e.maxLife,e.config.animFramerate=s.textures.length/e.maxLife):(e.config.animDuration=s.duration,e.config.animFramerate=s.framerate),e=e.next}}updateParticle(t,e){const s=t.config,n=s.anim;s.animElapsed+=e,s.animElapsed>=s.animDuration&&(s.anim.loop?s.animElapsed=s.animElapsed%s.animDuration:s.animElapsed=s.animDuration-1e-6);const i=s.animElapsed*s.animFramerate+1e-7|0;t.texture=n.textures[i]||n.textures[n.textures.length-1]||Il.EMPTY}}eT.type="animatedRandom",eT.editorConfig=null;class sT{constructor(t){this.order=NS.Normal;const e=t.anim,s=tT(e.textures),n=e.framerate<0?-1:e.framerate>0?e.framerate:60;this.anim={textures:s,duration:n>0?s.length/n:0,framerate:n,loop:n>0&&!!e.loop}}initParticles(t){let e=t;const s=this.anim;for(;e;)e.texture=s.textures[0],e.config.animElapsed=0,-1===s.framerate?(e.config.animDuration=e.maxLife,e.config.animFramerate=s.textures.length/e.maxLife):(e.config.animDuration=s.duration,e.config.animFramerate=s.framerate),e=e.next}updateParticle(t,e){const s=this.anim,n=t.config;n.animElapsed+=e,n.animElapsed>=n.animDuration&&(s.loop?n.animElapsed=n.animElapsed%n.animDuration:n.animElapsed=n.animDuration-1e-6);const i=n.animElapsed*n.animFramerate+1e-7|0;t.texture=s.textures[i]||s.textures[s.textures.length-1]||Il.EMPTY}}sT.type="animatedSingle",sT.editorConfig=null;class nT{constructor(t){this.order=NS.Normal,this.value=t.blendMode}initParticles(t){let e=t;for(;e;)e.blendMode=(s=this.value)?(s=s.toUpperCase().replace(/ /g,"_"),ir[s]||ir.NORMAL):ir.NORMAL,e=e.next;var s}}nT.type="blendMode",nT.editorConfig=null;class iT{constructor(t){this.order=NS.Spawn,this.spacing=t.spacing*MS,this.start=t.start*MS,this.distance=t.distance}initParticles(t){let e=0,s=t;for(;s;){let t;t=this.spacing?this.start+this.spacing*e:Math.random()*Math.PI*2,s.rotation=t,this.distance&&(s.position.x=this.distance,IS(t,s.position)),s=s.next,++e}}}iT.type="spawnBurst",iT.editorConfig=null;class rT{constructor(t){this.order=NS.Normal,this.list=new ZS(!0),this.list.reset(AS.createList(t.color))}initParticles(t){let e=t;const s=this.list.first.value,n=PS(s.r,s.g,s.b);for(;e;)e.tint=n,e=e.next}updateParticle(t){t.tint=this.list.interpolate(t.agePercent)}}rT.type="color",rT.editorConfig=null;class aT{constructor(t){this.order=NS.Normal;let e=t.color;"#"===e.charAt(0)?e=e.substr(1):0===e.indexOf("0x")&&(e=e.substr(2)),this.value=parseInt(e,16)}initParticles(t){let e=t;for(;e;)e.tint=this.value,e=e.next}}aT.type="colorStatic",aT.editorConfig=null;class oT{constructor(t){this.order=NS.Normal,this.index=0,this.textures=t.textures.map((t=>"string"==typeof t?CS(t):t))}initParticles(t){let e=t;for(;e;)e.texture=this.textures[this.index],++this.index>=this.textures.length&&(this.index=0),e=e.next}}oT.type="textureOrdered",oT.editorConfig=null;const hT=new _h,lT=["E","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2","abs","acos","acosh","asin","asinh","atan","atanh","atan2","cbrt","ceil","cos","cosh","exp","expm1","floor","fround","hypot","log","log1p","log10","log2","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh"],cT=new RegExp(["[01234567890\\.\\*\\-\\+\\/\\(\\)x ,]"].concat(lT).join("|"),"g");class uT{constructor(t){var e;if(this.order=NS.Late,t.path)if("function"==typeof t.path)this.path=t.path;else try{this.path=function(t){const e=t.match(cT);for(let s=e.length-1;s>=0;--s)lT.indexOf(e[s])>=0&&(e[s]=`Math.${e[s]}`);return t=e.join(""),new Function("x",`return ${t};`)}(t.path)}catch(jp){this.path=null}else this.path=t=>t;this.list=new ZS(!1),this.list.reset(AS.createList(t.speed)),this.minMult=null!==(e=t.minMult)&&void 0!==e?e:1}initParticles(t){let e=t;for(;e;){e.config.initRotation=e.rotation,e.config.initPosition?e.config.initPosition.copyFrom(e.position):e.config.initPosition=new _h(e.x,e.y),e.config.movement=0;const t=Math.random()*(1-this.minMult)+this.minMult;e.config.speedMult=t,e=e.next}}updateParticle(t,e){const s=this.list.interpolate(t.agePercent)*t.config.speedMult;t.config.movement+=s*e,hT.x=t.config.movement,hT.y=this.path(hT.x),IS(t.config.initRotation,hT),t.position.x=t.config.initPosition.x+hT.x,t.position.y=t.config.initPosition.y+hT.y}}uT.type="movePath",uT.editorConfig=null;class dT{constructor(){this.order=NS.Spawn}initParticles(t){}}dT.type="spawnPoint",dT.editorConfig=null;class fT{constructor(t){this.order=NS.Normal,this.textures=t.textures.map((t=>"string"==typeof t?CS(t):t))}initParticles(t){let e=t;for(;e;){const t=Math.floor(Math.random()*this.textures.length);e.texture=this.textures[t],e=e.next}}}fT.type="textureRandom",fT.editorConfig=null;class pT{constructor(t){this.order=NS.Normal,this.minStart=t.minStart*MS,this.maxStart=t.maxStart*MS,this.minSpeed=t.minSpeed*MS,this.maxSpeed=t.maxSpeed*MS,this.accel=t.accel*MS}initParticles(t){let e=t;for(;e;)this.minStart===this.maxStart?e.rotation+=this.maxStart:e.rotation+=Math.random()*(this.maxStart-this.minStart)+this.minStart,e.config.rotSpeed=Math.random()*(this.maxSpeed-this.minSpeed)+this.minSpeed,e=e.next}updateParticle(t,e){if(this.accel){const s=t.config.rotSpeed;t.config.rotSpeed+=this.accel*e,t.rotation+=(t.config.rotSpeed+s)/2*e}else t.rotation+=t.config.rotSpeed*e}}pT.type="rotation",pT.editorConfig=null;class mT{constructor(t){this.order=NS.Normal,this.min=t.min*MS,this.max=t.max*MS}initParticles(t){let e=t;for(;e;)this.min===this.max?e.rotation+=this.max:e.rotation+=Math.random()*(this.max-this.min)+this.min,e=e.next}}mT.type="rotationStatic",mT.editorConfig=null;class gT{constructor(t){this.order=NS.Late+1,this.rotation=(t.rotation||0)*MS}initParticles(t){let e=t;for(;e;)e.rotation=this.rotation,e=e.next}}gT.type="noRotation",gT.editorConfig=null;class yT{constructor(t){var e;this.order=NS.Normal,this.list=new ZS(!1),this.list.reset(AS.createList(t.scale)),this.minMult=null!==(e=t.minMult)&&void 0!==e?e:1}initParticles(t){let e=t;for(;e;){const t=Math.random()*(1-this.minMult)+this.minMult;e.config.scaleMult=t,e.scale.x=e.scale.y=this.list.first.value*t,e=e.next}}updateParticle(t){t.scale.x=t.scale.y=this.list.interpolate(t.agePercent)*t.config.scaleMult}}yT.type="scale",yT.editorConfig=null;class vT{constructor(t){this.order=NS.Normal,this.min=t.min,this.max=t.max}initParticles(t){let e=t;for(;e;){const t=Math.random()*(this.max-this.min)+this.min;e.scale.x=e.scale.y=t,e=e.next}}}vT.type="scaleStatic",vT.editorConfig=null;class xT{constructor(t){this.order=NS.Spawn;const e=xT.shapes[t.type];if(!e)throw new Error(`No shape found with type '${t.type}'`);this.shape=new e(t.data)}static registerShape(t,e){xT.shapes[e||t.type]=t}initParticles(t){let e=t;for(;e;)this.shape.getRandPos(e),e=e.next}}xT.type="spawnShape",xT.editorConfig=null,xT.shapes={},xT.registerShape(YS),xT.registerShape(US),xT.registerShape(XS),xT.registerShape(XS,"circle");class _T{constructor(t){this.order=NS.Normal,this.texture="string"==typeof t.texture?CS(t.texture):t.texture}initParticles(t){let e=t;for(;e;)e.texture=this.texture,e=e.next}}_T.type="textureSingle",_T.editorConfig=null;class bT{constructor(t){var e;this.order=NS.Late,this.list=new ZS(!1),this.list.reset(AS.createList(t.speed)),this.minMult=null!==(e=t.minMult)&&void 0!==e?e:1}initParticles(t){let e=t;for(;e;){const t=Math.random()*(1-this.minMult)+this.minMult;e.config.speedMult=t,e.config.velocity?e.config.velocity.set(this.list.first.value*t,0):e.config.velocity=new _h(this.list.first.value*t,0),IS(e.rotation,e.config.velocity),e=e.next}}updateParticle(t,e){const s=this.list.interpolate(t.agePercent)*t.config.speedMult,n=t.config.velocity;!function(t){const e=1/RS(t);t.x*=e,t.y*=e}(n),kS(n,s),t.x+=n.x*e,t.y+=n.y*e}}bT.type="moveSpeed",bT.editorConfig=null;class wT{constructor(t){this.order=NS.Late,this.min=t.min,this.max=t.max}initParticles(t){let e=t;for(;e;){const t=Math.random()*(this.max-this.min)+this.min;e.config.velocity?e.config.velocity.set(t,0):e.config.velocity=new _h(t,0),IS(e.rotation,e.config.velocity),e=e.next}}updateParticle(t,e){const s=t.config.velocity;t.x+=s.x*e,t.y+=s.y*e}}wT.type="moveSpeedStatic",wT.editorConfig=null,$S.registerBehavior(WS),$S.registerBehavior(QS),$S.registerBehavior(JS),$S.registerBehavior(eT),$S.registerBehavior(sT),$S.registerBehavior(nT),$S.registerBehavior(iT),$S.registerBehavior(rT),$S.registerBehavior(aT),$S.registerBehavior(oT),$S.registerBehavior(uT),$S.registerBehavior(dT),$S.registerBehavior(fT),$S.registerBehavior(pT),$S.registerBehavior(mT),$S.registerBehavior(gT),$S.registerBehavior(yT),$S.registerBehavior(vT),$S.registerBehavior(xT),$S.registerBehavior(_T),$S.registerBehavior(bT),$S.registerBehavior(wT);var ET=Object.defineProperty,ST=(t,e,s)=>(((t,e,s)=>{e in t?ET(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s})(t,"symbol"!=typeof e?e+"":e,s),s);class TT{constructor(t){ST(this,"parent"),ST(this,"paused"),this.parent=t,this.paused=!1}destroy(){}down(t){return!1}move(t){return!1}up(t){return!1}wheel(t){return!1}update(t){}resize(){}reset(){}pause(){this.paused=!0}resume(){this.paused=!1}}var AT,CT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},MT={exports:{}};AT=MT,function(){var t,e;e=function(t){return AT.exports=t},t={linear:function(t,e,s,n){return s*t/n+e},easeInQuad:function(t,e,s,n){return s*(t/=n)*t+e},easeOutQuad:function(t,e,s,n){return-s*(t/=n)*(t-2)+e},easeInOutQuad:function(t,e,s,n){return(t/=n/2)<1?s/2*t*t+e:-s/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,s,n){return s*(t/=n)*t*t+e},easeOutCubic:function(t,e,s,n){return s*((t=t/n-1)*t*t+1)+e},easeInOutCubic:function(t,e,s,n){return(t/=n/2)<1?s/2*t*t*t+e:s/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,s,n){return s*(t/=n)*t*t*t+e},easeOutQuart:function(t,e,s,n){return-s*((t=t/n-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,s,n){return(t/=n/2)<1?s/2*t*t*t*t+e:-s/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,s,n){return s*(t/=n)*t*t*t*t+e},easeOutQuint:function(t,e,s,n){return s*((t=t/n-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,s,n){return(t/=n/2)<1?s/2*t*t*t*t*t+e:s/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,s,n){return-s*Math.cos(t/n*(Math.PI/2))+s+e},easeOutSine:function(t,e,s,n){return s*Math.sin(t/n*(Math.PI/2))+e},easeInOutSine:function(t,e,s,n){return-s/2*(Math.cos(Math.PI*t/n)-1)+e},easeInExpo:function(t,e,s,n){return 0===t?e:s*Math.pow(2,10*(t/n-1))+e},easeOutExpo:function(t,e,s,n){return t===n?e+s:s*(1-Math.pow(2,-10*t/n))+e},easeInOutExpo:function(t,e,s,n){return(t/=n/2)<1?s/2*Math.pow(2,10*(t-1))+e:s/2*(2-Math.pow(2,-10*--t))+e},easeInCirc:function(t,e,s,n){return-s*(Math.sqrt(1-(t/=n)*t)-1)+e},easeOutCirc:function(t,e,s,n){return s*Math.sqrt(1-(t=t/n-1)*t)+e},easeInOutCirc:function(t,e,s,n){return(t/=n/2)<1?-s/2*(Math.sqrt(1-t*t)-1)+e:s/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(t,e,s,n){var i,r,a;return a=1.70158,0===t||(t/=n),(r=0)||(r=.3*n),(i=s)<Math.abs(s)?(i=s,a=r/4):a=r/(2*Math.PI)*Math.asin(s/i),-i*Math.pow(2,10*(t-=1))*Math.sin((t*n-a)*(2*Math.PI)/r)+e},easeOutElastic:function(t,e,s,n){var i,r,a;return a=1.70158,0===t||(t/=n),(r=0)||(r=.3*n),(i=s)<Math.abs(s)?(i=s,a=r/4):a=r/(2*Math.PI)*Math.asin(s/i),i*Math.pow(2,-10*t)*Math.sin((t*n-a)*(2*Math.PI)/r)+s+e},easeInOutElastic:function(t,e,s,n){var i,r,a;return a=1.70158,0===t||(t/=n/2),(r=0)||(r=n*(.3*1.5)),(i=s)<Math.abs(s)?(i=s,a=r/4):a=r/(2*Math.PI)*Math.asin(s/i),t<1?i*Math.pow(2,10*(t-=1))*Math.sin((t*n-a)*(2*Math.PI)/r)*-.5+e:i*Math.pow(2,-10*(t-=1))*Math.sin((t*n-a)*(2*Math.PI)/r)*.5+s+e},easeInBack:function(t,e,s,n,i){return void 0===i&&(i=1.70158),s*(t/=n)*t*((i+1)*t-i)+e},easeOutBack:function(t,e,s,n,i){return void 0===i&&(i=1.70158),s*((t=t/n-1)*t*((i+1)*t+i)+1)+e},easeInOutBack:function(t,e,s,n,i){return void 0===i&&(i=1.70158),(t/=n/2)<1?s/2*(t*t*((1+(i*=1.525))*t-i))+e:s/2*((t-=2)*t*((1+(i*=1.525))*t+i)+2)+e},easeInBounce:function(e,s,n,i){return n-t.easeOutBounce(i-e,0,n,i)+s},easeOutBounce:function(t,e,s,n){return(t/=n)<1/2.75?s*(7.5625*t*t)+e:t<2/2.75?s*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?s*(7.5625*(t-=2.25/2.75)*t+.9375)+e:s*(7.5625*(t-=2.625/2.75)*t+.984375)+e},easeInOutBounce:function(e,s,n,i){return e<i/2?.5*t.easeInBounce(2*e,0,n,i)+s:.5*t.easeOutBounce(2*e-i,0,n,i)+.5*n+s}},e(t)}.call(CT);const IT=MT.exports;function PT(t,e){return t?"function"==typeof t?t:"string"==typeof t?IT[t]:void 0:IT[e]}const RT={removeOnInterrupt:!1,ease:"linear",time:1e3};class kT extends TT{constructor(t,e={}){super(t),ST(this,"options"),ST(this,"startX"),ST(this,"startY"),ST(this,"deltaX"),ST(this,"deltaY"),ST(this,"keepCenter"),ST(this,"startWidth",null),ST(this,"startHeight",null),ST(this,"deltaWidth",null),ST(this,"deltaHeight",null),ST(this,"width",null),ST(this,"height",null),ST(this,"time",0),this.options=Object.assign({},RT,e),this.options.ease=PT(this.options.ease),this.setupPosition(),this.setupZoom(),this.time=0}setupPosition(){typeof this.options.position<"u"?(this.startX=this.parent.center.x,this.startY=this.parent.center.y,this.deltaX=this.options.position.x-this.parent.center.x,this.deltaY=this.options.position.y-this.parent.center.y,this.keepCenter=!1):this.keepCenter=!0}setupZoom(){this.width=null,this.height=null,typeof this.options.scale<"u"?this.width=this.parent.screenWidth/this.options.scale:typeof this.options.scaleX<"u"||typeof this.options.scaleY<"u"?(typeof this.options.scaleX<"u"&&(this.width=this.parent.screenWidth/this.options.scaleX),typeof this.options.scaleY<"u"&&(this.height=this.parent.screenHeight/this.options.scaleY)):(typeof this.options.width<"u"&&(this.width=this.options.width),typeof this.options.height<"u"&&(this.height=this.options.height)),null!==this.width&&(this.startWidth=this.parent.screenWidthInWorldPixels,this.deltaWidth=this.width-this.startWidth),null!==this.height&&(this.startHeight=this.parent.screenHeightInWorldPixels,this.deltaHeight=this.height-this.startHeight)}down(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("animate"),!1}complete(){this.parent.plugins.remove("animate"),null!==this.width&&this.parent.fitWidth(this.width,this.keepCenter,null===this.height),null!==this.height&&this.parent.fitHeight(this.height,this.keepCenter,null===this.width),!this.keepCenter&&this.options.position&&this.parent.moveCenter(this.options.position),this.parent.emit("animate-end",this.parent),this.options.callbackOnComplete&&this.options.callbackOnComplete(this.parent)}update(t){if(this.paused)return;this.time+=t;const e=new _h(this.parent.scale.x,this.parent.scale.y);if(this.time>=this.options.time){const t=this.parent.width,s=this.parent.height;this.complete(),(t!==this.parent.width||s!==this.parent.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}else{const t=this.options.ease(this.time,0,1,this.options.time);if(null!==this.width){const e=this.startWidth,s=this.deltaWidth;this.parent.fitWidth(e+s*t,this.keepCenter,null===this.height)}if(null!==this.height){const e=this.startHeight,s=this.deltaHeight;this.parent.fitHeight(e+s*t,this.keepCenter,null===this.width)}if(null===this.width?this.parent.scale.x=this.parent.scale.y:null===this.height&&(this.parent.scale.y=this.parent.scale.x),!this.keepCenter){const e=this.startX,s=this.startY,n=this.deltaX,i=this.deltaY,r=new _h(this.parent.x,this.parent.y);this.parent.moveCenter(e+n*t,s+i*t),this.parent.emit("moved",{viewport:this.parent,original:r,type:"animate"})}(this.width||this.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}}}const DT={sides:"all",friction:.5,time:150,ease:"easeInOutSine",underflow:"center",bounceBox:null};class FT extends TT{constructor(t,e={}){super(t),ST(this,"options"),ST(this,"left"),ST(this,"top"),ST(this,"right"),ST(this,"bottom"),ST(this,"underflowX"),ST(this,"underflowY"),ST(this,"ease"),ST(this,"toX"),ST(this,"toY"),this.options=Object.assign({},DT,e),this.ease=PT(this.options.ease,"easeInOutSine"),this.options.sides?"all"===this.options.sides?this.top=this.bottom=this.left=this.right=!0:"horizontal"===this.options.sides?(this.right=this.left=!0,this.top=this.bottom=!1):"vertical"===this.options.sides?(this.left=this.right=!1,this.top=this.bottom=!0):(this.top=-1!==this.options.sides.indexOf("top"),this.bottom=-1!==this.options.sides.indexOf("bottom"),this.left=-1!==this.options.sides.indexOf("left"),this.right=-1!==this.options.sides.indexOf("right")):this.left=this.top=this.right=this.bottom=!1;const s=this.options.underflow.toLowerCase();"center"===s?(this.underflowX=0,this.underflowY=0):(this.underflowX=-1!==s.indexOf("left")?-1:-1!==s.indexOf("right")?1:0,this.underflowY=-1!==s.indexOf("top")?-1:-1!==s.indexOf("bottom")?1:0),this.reset()}isActive(){return null!==this.toX||null!==this.toY}down(){return this.toX=this.toY=null,!1}up(){return this.bounce(),!1}update(t){if(!this.paused){if(this.bounce(),this.toX){const e=this.toX;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-x"}),e.time>=this.options.time?(this.parent.x=e.end,this.toX=null,this.parent.emit("bounce-x-end",this.parent)):this.parent.x=this.ease(e.time,e.start,e.delta,this.options.time)}if(this.toY){const e=this.toY;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-y"}),e.time>=this.options.time?(this.parent.y=e.end,this.toY=null,this.parent.emit("bounce-y-end",this.parent)):this.parent.y=this.ease(e.time,e.start,e.delta,this.options.time)}}}calcUnderflowX(){let t;switch(this.underflowX){case-1:t=0;break;case 1:t=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:t=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}return t}calcUnderflowY(){let t;switch(this.underflowY){case-1:t=0;break;case 1:t=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:t=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}return t}oob(){const t=this.options.bounceBox;if(t){const e=typeof t.x>"u"?0:t.x,s=typeof t.y>"u"?0:t.y,n=typeof t.width>"u"?this.parent.worldWidth:t.width,i=typeof t.height>"u"?this.parent.worldHeight:t.height;return{left:this.parent.left<e,right:this.parent.right>n,top:this.parent.top<s,bottom:this.parent.bottom>i,topLeft:new _h(e*this.parent.scale.x,s*this.parent.scale.y),bottomRight:new _h(n*this.parent.scale.x-this.parent.screenWidth,i*this.parent.scale.y-this.parent.screenHeight)}}return{left:this.parent.left<0,right:this.parent.right>this.parent.worldWidth,top:this.parent.top<0,bottom:this.parent.bottom>this.parent.worldHeight,topLeft:new _h(0,0),bottomRight:new _h(this.parent.worldWidth*this.parent.scale.x-this.parent.screenWidth,this.parent.worldHeight*this.parent.scale.y-this.parent.screenHeight)}}bounce(){var t,e;if(this.paused)return;let s,n=this.parent.plugins.get("decelerate",!0);n&&(n.x||n.y)&&(n.x&&n.percentChangeX===(null==(t=n.options)?void 0:t.friction)||n.y&&n.percentChangeY===(null==(e=n.options)?void 0:e.friction))&&(s=this.oob(),(s.left&&this.left||s.right&&this.right)&&(n.percentChangeX=this.options.friction),(s.top&&this.top||s.bottom&&this.bottom)&&(n.percentChangeY=this.options.friction));const i=this.parent.plugins.get("drag",!0)||{},r=this.parent.plugins.get("pinch",!0)||{};if(n=n||{},!(null!=i&&i.active||null!=r&&r.active||this.toX&&this.toY||n.x&&n.y)){s=s||this.oob();const t=s.topLeft,e=s.bottomRight;if(!this.toX&&!n.x){let n=null;s.left&&this.left?n=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-t.x:s.right&&this.right&&(n=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-e.x),null!==n&&this.parent.x!==n&&(this.toX={time:0,start:this.parent.x,delta:n-this.parent.x,end:n},this.parent.emit("bounce-x-start",this.parent))}if(!this.toY&&!n.y){let n=null;s.top&&this.top?n=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-t.y:s.bottom&&this.bottom&&(n=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-e.y),null!==n&&this.parent.y!==n&&(this.toY={time:0,start:this.parent.y,delta:n-this.parent.y,end:n},this.parent.emit("bounce-y-start",this.parent))}}}reset(){this.toX=this.toY=null,this.bounce()}}const OT={left:!1,right:!1,top:!1,bottom:!1,direction:null,underflow:"center"};class NT extends TT{constructor(t,e={}){super(t),ST(this,"options"),ST(this,"last"),ST(this,"noUnderflow"),ST(this,"underflowX"),ST(this,"underflowY"),this.options=Object.assign({},OT,e),this.options.direction&&(this.options.left="x"===this.options.direction||"all"===this.options.direction||null,this.options.right="x"===this.options.direction||"all"===this.options.direction||null,this.options.top="y"===this.options.direction||"all"===this.options.direction||null,this.options.bottom="y"===this.options.direction||"all"===this.options.direction||null),this.parseUnderflow(),this.last={x:null,y:null,scaleX:null,scaleY:null},this.update()}parseUnderflow(){const t=this.options.underflow.toLowerCase();"none"===t?this.noUnderflow=!0:"center"===t?(this.underflowX=this.underflowY=0,this.noUnderflow=!1):(this.underflowX=-1!==t.indexOf("left")?-1:-1!==t.indexOf("right")?1:0,this.underflowY=-1!==t.indexOf("top")?-1:-1!==t.indexOf("bottom")?1:0,this.noUnderflow=!1)}move(){return this.update(),!1}update(){if(this.paused||this.parent.x===this.last.x&&this.parent.y===this.last.y&&this.parent.scale.x===this.last.scaleX&&this.parent.scale.y===this.last.scaleY)return;const t=new _h(this.parent.x,this.parent.y),e=this.parent.plugins.decelerate||{};if(null!==this.options.left||null!==this.options.right){let s=!1;if(!this.noUnderflow&&this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:0!==this.parent.x&&(this.parent.x=0,s=!0);break;case 1:this.parent.x!==this.parent.screenWidth-this.parent.screenWorldWidth&&(this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth,s=!0);break;default:this.parent.x!==(this.parent.screenWidth-this.parent.screenWorldWidth)/2&&(this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2,s=!0)}else null!==this.options.left&&this.parent.left<(!0===this.options.left?0:this.options.left)&&(this.parent.x=-(!0===this.options.left?0:this.options.left)*this.parent.scale.x,e.x=0,s=!0),null!==this.options.right&&this.parent.right>(!0===this.options.right?this.parent.worldWidth:this.options.right)&&(this.parent.x=-(!0===this.options.right?this.parent.worldWidth:this.options.right)*this.parent.scale.x+this.parent.screenWidth,e.x=0,s=!0);s&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-x"})}if(null!==this.options.top||null!==this.options.bottom){let s=!1;if(!this.noUnderflow&&this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:0!==this.parent.y&&(this.parent.y=0,s=!0);break;case 1:this.parent.y!==this.parent.screenHeight-this.parent.screenWorldHeight&&(this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight,s=!0);break;default:this.parent.y!==(this.parent.screenHeight-this.parent.screenWorldHeight)/2&&(this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2,s=!0)}else null!==this.options.top&&this.parent.top<(!0===this.options.top?0:this.options.top)&&(this.parent.y=-(!0===this.options.top?0:this.options.top)*this.parent.scale.y,e.y=0,s=!0),null!==this.options.bottom&&this.parent.bottom>(!0===this.options.bottom?this.parent.worldHeight:this.options.bottom)&&(this.parent.y=-(!0===this.options.bottom?this.parent.worldHeight:this.options.bottom)*this.parent.scale.y+this.parent.screenHeight,e.y=0,s=!0);s&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-y"})}this.last.x=this.parent.x,this.last.y=this.parent.y,this.last.scaleX=this.parent.scale.x,this.last.scaleY=this.parent.scale.y}reset(){this.update()}}const BT={minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,minScale:null,maxScale:null};class LT extends TT{constructor(t,e={}){super(t),ST(this,"options"),this.options=Object.assign({},BT,e),this.clamp()}resize(){this.clamp()}clamp(){if(!this.paused)if(this.options.minWidth||this.options.minHeight||this.options.maxWidth||this.options.maxHeight){let t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight;if(null!==this.options.minWidth&&t<this.options.minWidth){const s=this.parent.scale.x;this.parent.fitWidth(this.options.minWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/s,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(null!==this.options.maxWidth&&t>this.options.maxWidth){const s=this.parent.scale.x;this.parent.fitWidth(this.options.maxWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/s,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(null!==this.options.minHeight&&e<this.options.minHeight){const s=this.parent.scale.y;this.parent.fitHeight(this.options.minHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/s,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(null!==this.options.maxHeight&&e>this.options.maxHeight){const t=this.parent.scale.y;this.parent.fitHeight(this.options.maxHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/t,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}}else if(this.options.minScale||this.options.maxScale){const t={x:null,y:null},e={x:null,y:null};if("number"==typeof this.options.minScale)t.x=this.options.minScale,t.y=this.options.minScale;else if(null!==this.options.minScale){const e=this.options.minScale;t.x=typeof e.x>"u"?null:e.x,t.y=typeof e.y>"u"?null:e.y}if("number"==typeof this.options.maxScale)e.x=this.options.maxScale,e.y=this.options.maxScale;else if(null!==this.options.maxScale){const t=this.options.maxScale;e.x=typeof t.x>"u"?null:t.x,e.y=typeof t.y>"u"?null:t.y}let s=this.parent.scale.x,n=this.parent.scale.y;null!==t.x&&s<t.x&&(s=t.x),null!==e.x&&s>e.x&&(s=e.x),null!==t.y&&n<t.y&&(n=t.y),null!==e.y&&n>e.y&&(n=e.y),(s!==this.parent.scale.x||n!==this.parent.scale.y)&&(this.parent.scale.set(s,n),this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"}))}}reset(){this.clamp()}}const VT={friction:.98,bounce:.8,minSpeed:.01},$T=16;class UT extends TT{constructor(t,e={}){super(t),ST(this,"options"),ST(this,"x"),ST(this,"y"),ST(this,"percentChangeX"),ST(this,"percentChangeY"),ST(this,"saved"),ST(this,"timeSinceRelease"),this.options=Object.assign({},VT,e),this.saved=[],this.timeSinceRelease=0,this.reset(),this.parent.on("moved",(t=>this.handleMoved(t)))}down(){return this.saved=[],this.x=this.y=null,!1}isActive(){return!(!this.x&&!this.y)}move(){if(this.paused)return!1;const t=this.parent.input.count();return(1===t||t>1&&!this.parent.plugins.get("pinch",!0))&&(this.saved.push({x:this.parent.x,y:this.parent.y,time:performance.now()}),this.saved.length>60&&this.saved.splice(0,30)),!1}handleMoved(t){if(this.saved.length){const e=this.saved[this.saved.length-1];"clamp-x"===t.type&&t.original?e.x===t.original.x&&(e.x=this.parent.x):"clamp-y"===t.type&&t.original&&e.y===t.original.y&&(e.y=this.parent.y)}}up(){if(0===this.parent.input.count()&&this.saved.length){const t=performance.now();for(const e of this.saved)if(e.time>=t-100){const s=t-e.time;this.x=(this.parent.x-e.x)/s,this.y=(this.parent.y-e.y)/s,this.percentChangeX=this.percentChangeY=this.options.friction,this.timeSinceRelease=0;break}}return!1}activate(t){typeof(t=t||{}).x<"u"&&(this.x=t.x,this.percentChangeX=this.options.friction),typeof t.y<"u"&&(this.y=t.y,this.percentChangeY=this.options.friction)}update(t){if(this.paused)return;const e=this.x||this.y,s=this.timeSinceRelease,n=this.timeSinceRelease+t;if(this.x){const e=this.percentChangeX,i=Math.log(e);this.parent.x+=this.x*$T/i*(Math.pow(e,n/$T)-Math.pow(e,s/$T)),this.x*=Math.pow(this.percentChangeX,t/$T)}if(this.y){const e=this.percentChangeY,i=Math.log(e);this.parent.y+=this.y*$T/i*(Math.pow(e,n/$T)-Math.pow(e,s/$T)),this.y*=Math.pow(this.percentChangeY,t/$T)}this.timeSinceRelease+=t,this.x&&this.y?Math.abs(this.x)<this.options.minSpeed&&Math.abs(this.y)<this.options.minSpeed&&(this.x=0,this.y=0):(Math.abs(this.x||0)<this.options.minSpeed&&(this.x=0),Math.abs(this.y||0)<this.options.minSpeed&&(this.y=0)),e&&this.parent.emit("moved",{viewport:this.parent,type:"decelerate"})}reset(){this.x=this.y=null}}const XT={direction:"all",pressDrag:!0,wheel:!0,wheelScroll:1,reverse:!1,clampWheel:!1,underflow:"center",factor:1,mouseButtons:"all",keyToPress:null,ignoreKeyToPressOnTouch:!1,lineHeight:20,wheelSwapAxes:!1};class YT extends TT{constructor(t,e={}){super(t),ST(this,"options"),ST(this,"moved"),ST(this,"reverse"),ST(this,"xDirection"),ST(this,"yDirection"),ST(this,"keyIsPressed"),ST(this,"mouse"),ST(this,"underflowX"),ST(this,"underflowY"),ST(this,"last"),ST(this,"current"),ST(this,"windowEventHandlers",[]),this.options=Object.assign({},XT,e),this.moved=!1,this.reverse=this.options.reverse?1:-1,this.xDirection=!this.options.direction||"all"===this.options.direction||"x"===this.options.direction,this.yDirection=!this.options.direction||"all"===this.options.direction||"y"===this.options.direction,this.keyIsPressed=!1,this.parseUnderflow(),this.mouseButtons(this.options.mouseButtons),this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){this.addWindowEventHandler("keyup",(e=>{t.includes(e.code)&&(this.keyIsPressed=!1)})),this.addWindowEventHandler("keydown",(e=>{t.includes(e.code)&&(this.keyIsPressed=!0)}))}addWindowEventHandler(t,e){window.addEventListener(t,e),this.windowEventHandlers.push({event:t,handler:e})}destroy(){this.windowEventHandlers.forEach((({event:t,handler:e})=>{window.removeEventListener(t,e)}))}mouseButtons(t){this.mouse=t&&"all"!==t?[-1!==t.indexOf("left"),-1!==t.indexOf("middle"),-1!==t.indexOf("right")]:[!0,!0,!0]}parseUnderflow(){const t=this.options.underflow.toLowerCase();"center"===t?(this.underflowX=0,this.underflowY=0):(t.includes("left")?this.underflowX=-1:t.includes("right")?this.underflowX=1:this.underflowX=0,t.includes("top")?this.underflowY=-1:t.includes("bottom")?this.underflowY=1:this.underflowY=0)}checkButtons(t){const e="mouse"===t.pointerType,s=this.parent.input.count();return!(!(1===s||s>1&&!this.parent.plugins.get("pinch",!0))||e&&!this.mouse[t.button])}checkKeyPress(t){return!this.options.keyToPress||this.keyIsPressed||this.options.ignoreKeyToPressOnTouch&&"touch"===t.data.pointerType}down(t){return!(this.paused||!this.options.pressDrag)&&(this.checkButtons(t)&&this.checkKeyPress(t)?(this.last={x:t.global.x,y:t.global.y},this.current=t.pointerId,!0):(this.last=null,!1))}get active(){return this.moved}move(t){if(this.paused||!this.options.pressDrag)return!1;if(this.last&&this.current===t.data.pointerId){const e=t.global.x,s=t.global.y,n=this.parent.input.count();if(1===n||n>1&&!this.parent.plugins.get("pinch",!0)){const n=e-this.last.x,i=s-this.last.y;if(this.moved||this.xDirection&&this.parent.input.checkThreshold(n)||this.yDirection&&this.parent.input.checkThreshold(i)){const n={x:e,y:s};return this.xDirection&&(this.parent.x+=(n.x-this.last.x)*this.options.factor),this.yDirection&&(this.parent.y+=(n.y-this.last.y)*this.options.factor),this.last=n,this.moved||this.parent.emit("drag-start",{event:t,screen:new _h(this.last.x,this.last.y),world:this.parent.toWorld(new _h(this.last.x,this.last.y)),viewport:this.parent}),this.moved=!0,this.parent.emit("moved",{viewport:this.parent,type:"drag"}),!0}}else this.moved=!1}return!1}up(t){if(this.paused)return!1;const e=this.parent.input.touches;if(1===e.length){const t=e[0];return t.last&&(this.last={x:t.last.x,y:t.last.y},this.current=t.id),this.moved=!1,!0}if(this.last&&this.moved){const e=new _h(this.last.x,this.last.y);return this.parent.emit("drag-end",{event:t,screen:e,world:this.parent.toWorld(e),viewport:this.parent}),this.last=null,this.moved=!1,!0}return!1}wheel(t){if(this.paused)return!1;if(this.options.wheel){const e=this.parent.plugins.get("wheel",!0);if(!e||!e.options.wheelZoom&&!t.ctrlKey){const e=t.deltaMode?this.options.lineHeight:1,s=[t.deltaX,t.deltaY],[n,i]=this.options.wheelSwapAxes?s.reverse():s;return this.xDirection&&(this.parent.x+=n*e*this.options.wheelScroll*this.reverse),this.yDirection&&(this.parent.y+=i*e*this.options.wheelScroll*this.reverse),this.options.clampWheel&&this.clamp(),this.parent.emit("wheel-scroll",this.parent),this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.options.passiveWheel||t.preventDefault(),this.parent.options.stopPropagation&&t.stopPropagation(),!0}}return!1}resume(){this.last=null,this.paused=!1}clamp(){const t=this.parent.plugins.get("decelerate",!0)||{};if("y"!==this.options.clampWheel)if(this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x=0;break;case 1:this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}else this.parent.left<0?(this.parent.x=0,t.x=0):this.parent.right>this.parent.worldWidth&&(this.parent.x=-this.parent.worldWidth*this.parent.scale.x+this.parent.screenWidth,t.x=0);if("x"!==this.options.clampWheel)if(this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y=0;break;case 1:this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}else this.parent.top<0&&(this.parent.y=0,t.y=0),this.parent.bottom>this.parent.worldHeight&&(this.parent.y=-this.parent.worldHeight*this.parent.scale.y+this.parent.screenHeight,t.y=0)}}const WT={speed:0,acceleration:null,radius:null};class jT extends TT{constructor(t,e,s={}){super(t),ST(this,"options"),ST(this,"target"),ST(this,"velocity"),this.target=e,this.options=Object.assign({},WT,s),this.velocity={x:0,y:0}}update(t){if(this.paused)return;const e=this.parent.center;let s=this.target.x,n=this.target.y;if(this.options.radius){if(!(Math.sqrt(Math.pow(this.target.y-e.y,2)+Math.pow(this.target.x-e.x,2))>this.options.radius))return;{const t=Math.atan2(this.target.y-e.y,this.target.x-e.x);s=this.target.x-Math.cos(t)*this.options.radius,n=this.target.y-Math.sin(t)*this.options.radius}}const i=s-e.x,r=n-e.y;if(i||r)if(this.options.speed)if(this.options.acceleration){const t=Math.atan2(n-e.y,s-e.x),a=Math.sqrt(Math.pow(i,2)+Math.pow(r,2));if(a){const o=(Math.pow(this.velocity.x,2)+Math.pow(this.velocity.y,2))/(2*this.options.acceleration);this.velocity=a>o?{x:Math.min(this.velocity.x+(this.options.acceleration,this.options.speed)),y:Math.min(this.velocity.y+(this.options.acceleration,this.options.speed))}:{x:Math.max(this.velocity.x-this.options.acceleration*this.options.speed,0),y:Math.max(this.velocity.y-this.options.acceleration*this.options.speed,0)};const h=Math.cos(t)*this.velocity.x,l=Math.sin(t)*this.velocity.y,c=Math.abs(h)>Math.abs(i)?s:e.x+h,u=Math.abs(l)>Math.abs(r)?n:e.y+l;this.parent.moveCenter(c,u),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}else{const t=Math.atan2(n-e.y,s-e.x),a=Math.cos(t)*this.options.speed,o=Math.sin(t)*this.options.speed,h=Math.abs(a)>Math.abs(i)?s:e.x+a,l=Math.abs(o)>Math.abs(r)?n:e.y+o;this.parent.moveCenter(h,l),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}else this.parent.moveCenter(s,n),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}const zT={radius:null,distance:null,top:null,bottom:null,left:null,right:null,speed:8,reverse:!1,noDecelerate:!1,linear:!1,allowButtons:!1};class GT extends TT{constructor(t,e={}){super(t),ST(this,"options"),ST(this,"reverse"),ST(this,"radiusSquared"),ST(this,"left"),ST(this,"top"),ST(this,"right"),ST(this,"bottom"),ST(this,"horizontal"),ST(this,"vertical"),this.options=Object.assign({},zT,e),this.reverse=this.options.reverse?1:-1,this.radiusSquared="number"==typeof this.options.radius?Math.pow(this.options.radius,2):null,this.resize()}resize(){const t=this.options.distance;null!==t?(this.left=t,this.top=t,this.right=this.parent.screenWidth-t,this.bottom=this.parent.screenHeight-t):this.options.radius||(this.left=this.options.left,this.top=this.options.top,this.right=null===this.options.right?null:this.parent.screenWidth-this.options.right,this.bottom=null===this.options.bottom?null:this.parent.screenHeight-this.options.bottom)}down(){return this.paused||this.options.allowButtons||(this.horizontal=this.vertical=null),!1}move(t){if(this.paused||"mouse"!==t.pointerType&&1!==t.pointerId||!this.options.allowButtons&&0!==t.buttons)return!1;const e=t.global.x,s=t.global.y;if(this.radiusSquared){const t=this.parent.toScreen(this.parent.center);if(Math.pow(t.x-e,2)+Math.pow(t.y-s,2)>=this.radiusSquared){const n=Math.atan2(t.y-s,t.x-e);this.options.linear?(this.horizontal=Math.round(Math.cos(n))*this.options.speed*this.reverse*.06,this.vertical=Math.round(Math.sin(n))*this.options.speed*this.reverse*.06):(this.horizontal=Math.cos(n)*this.options.speed*this.reverse*.06,this.vertical=Math.sin(n)*this.options.speed*this.reverse*.06)}else this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=0}else null!==this.left&&e<this.left?this.horizontal=Number(this.reverse)*this.options.speed*.06:null!==this.right&&e>this.right?this.horizontal=-1*this.reverse*this.options.speed*.06:(this.decelerateHorizontal(),this.horizontal=0),null!==this.top&&s<this.top?this.vertical=Number(this.reverse)*this.options.speed*.06:null!==this.bottom&&s>this.bottom?this.vertical=-1*this.reverse*this.options.speed*.06:(this.decelerateVertical(),this.vertical=0);return!1}decelerateHorizontal(){const t=this.parent.plugins.get("decelerate",!0);this.horizontal&&t&&!this.options.noDecelerate&&t.activate({x:this.horizontal*this.options.speed*this.reverse/(1e3/60)})}decelerateVertical(){const t=this.parent.plugins.get("decelerate",!0);this.vertical&&t&&!this.options.noDecelerate&&t.activate({y:this.vertical*this.options.speed*this.reverse/(1e3/60)})}up(){return this.paused||(this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=null),!1}update(){if(!this.paused&&(this.horizontal||this.vertical)){const t=this.parent.center;this.horizontal&&(t.x+=this.horizontal*this.options.speed),this.vertical&&(t.y+=this.vertical*this.options.speed),this.parent.moveCenter(t),this.parent.emit("moved",{viewport:this.parent,type:"mouse-edges"})}}}const HT={noDrag:!1,percent:1,center:null,factor:1,axis:"all"};class qT extends TT{constructor(t,e={}){super(t),ST(this,"options"),ST(this,"active",!1),ST(this,"pinching",!1),ST(this,"moved",!1),ST(this,"lastCenter"),this.options=Object.assign({},HT,e)}down(){return this.parent.input.count()>=2&&(this.active=!0,!0)}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}move(t){if(this.paused||!this.active)return!1;const e=t.global.x,s=t.global.y,n=this.parent.input.touches;if(n.length>=2){const i=n[0],r=n[1],a=i.last&&r.last?Math.sqrt(Math.pow(r.last.x-i.last.x,2)+Math.pow(r.last.y-i.last.y,2)):null;if(i.id===t.pointerId?i.last={x:e,y:s,data:t}:r.id===t.pointerId&&(r.last={x:e,y:s,data:t}),a){let t;const e=new _h(i.last.x+(r.last.x-i.last.x)/2,i.last.y+(r.last.y-i.last.y)/2);this.options.center||(t=this.parent.toLocal(e));let s=Math.sqrt(Math.pow(r.last.x-i.last.x,2)+Math.pow(r.last.y-i.last.y,2));s=0===s?s=1e-10:s;const n=(1-a/s)*this.options.percent*(this.isAxisX()?this.parent.scale.x:this.parent.scale.y);this.isAxisX()&&(this.parent.scale.x+=n),this.isAxisY()&&(this.parent.scale.y+=n),this.parent.emit("zoomed",{viewport:this.parent,type:"pinch",center:e});const o=this.parent.plugins.get("clamp-zoom",!0);if(o&&o.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const s=this.parent.toGlobal(t);this.parent.x+=(e.x-s.x)*this.options.factor,this.parent.y+=(e.y-s.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})}!this.options.noDrag&&this.lastCenter&&(this.parent.x+=(e.x-this.lastCenter.x)*this.options.factor,this.parent.y+=(e.y-this.lastCenter.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})),this.lastCenter=e,this.moved=!0}else this.pinching||(this.parent.emit("pinch-start",this.parent),this.pinching=!0);return!0}return!1}up(){return!!(this.pinching&&this.parent.input.touches.length<=1)&&(this.active=!1,this.lastCenter=null,this.pinching=!1,this.moved=!1,this.parent.emit("pinch-end",this.parent),!0)}}const KT={topLeft:!1,friction:.8,time:1e3,ease:"easeInOutSine",interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1};class ZT extends TT{constructor(t,e,s,n={}){super(t),ST(this,"options"),ST(this,"ease"),ST(this,"x"),ST(this,"y"),ST(this,"percent"),ST(this,"snapping"),ST(this,"deltaX"),ST(this,"deltaY"),ST(this,"startX"),ST(this,"startY"),this.options=Object.assign({},KT,n),this.ease=PT(n.ease,"easeInOutSine"),this.x=e,this.y=s,this.options.forceStart&&this.snapStart()}snapStart(){this.percent=0,this.snapping={time:0};const t=this.options.topLeft?this.parent.corner:this.parent.center;this.deltaX=this.x-t.x,this.deltaY=this.y-t.y,this.startX=t.x,this.startY=t.y,this.parent.emit("snap-start",this.parent)}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap"):this.options.interrupt&&(this.snapping=null),!1}up(){if(0===this.parent.input.count()){const t=this.parent.plugins.get("decelerate",!0);t&&(t.x||t.y)&&(t.percentChangeX=t.percentChangeY=this.options.friction)}return!1}update(t){if(!(this.paused||this.options.interrupt&&0!==this.parent.input.count()))if(this.snapping){const e=this.snapping;let s,n,i;e.time+=t;const r=this.startX,a=this.startY,o=this.deltaX,h=this.deltaY;if(e.time>this.options.time)s=!0,n=r+o,i=a+h;else{const t=this.ease(e.time,0,1,this.options.time);n=r+o*t,i=a+h*t}this.options.topLeft?this.parent.moveCorner(n,i):this.parent.moveCenter(n,i),this.parent.emit("moved",{viewport:this.parent,type:"snap"}),s&&(this.options.removeOnComplete&&this.parent.plugins.remove("snap"),this.parent.emit("snap-end",this.parent),this.snapping=null)}else{const t=this.options.topLeft?this.parent.corner:this.parent.center;(t.x!==this.x||t.y!==this.y)&&this.snapStart()}}}const QT={width:0,height:0,time:1e3,ease:"easeInOutSine",center:null,interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1,noMove:!1};class JT extends TT{constructor(t,e={}){super(t),ST(this,"options"),ST(this,"ease"),ST(this,"xScale"),ST(this,"yScale"),ST(this,"xIndependent"),ST(this,"yIndependent"),ST(this,"snapping"),this.options=Object.assign({},QT,e),this.ease=PT(this.options.ease),this.xIndependent=!1,this.yIndependent=!1,this.xScale=0,this.yScale=0,this.options.width>0&&(this.xScale=t.screenWidth/this.options.width,this.xIndependent=!0),this.options.height>0&&(this.yScale=t.screenHeight/this.options.height,this.yIndependent=!0),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale,0===this.options.time?(t.container.scale.x=this.xScale,t.container.scale.y=this.yScale,this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom")):e.forceStart&&this.createSnapping()}createSnapping(){const t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,s=this.parent.screenWidth/this.xScale,n=this.parent.screenHeight/this.yScale;this.snapping={time:0,startX:t,startY:e,deltaX:s-t,deltaY:n-e},this.parent.emit("snap-zoom-start",this.parent)}resize(){this.snapping=null,this.options.width>0&&(this.xScale=this.parent.screenWidth/this.options.width),this.options.height>0&&(this.yScale=this.parent.screenHeight/this.options.height),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap-zoom"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap-zoom"):this.options.interrupt&&(this.snapping=null),!1}update(t){if(this.paused||this.options.interrupt&&0!==this.parent.input.count())return;let e;if(!this.options.center&&!this.options.noMove&&(e=this.parent.center),this.snapping){if(this.snapping){const s=this.snapping;if(s.time+=t,s.time>=this.options.time)this.parent.scale.set(this.xScale,this.yScale),this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom"),this.parent.emit("snap-zoom-end",this.parent),this.snapping=null;else{const t=this.snapping,e=this.ease(t.time,t.startX,t.deltaX,this.options.time),s=this.ease(t.time,t.startY,t.deltaY,this.options.time);this.parent.scale.x=this.parent.screenWidth/e,this.parent.scale.y=this.parent.screenHeight/s}const n=this.parent.plugins.get("clamp-zoom",!0);n&&n.clamp(),this.options.noMove||(this.options.center?this.parent.moveCenter(this.options.center):this.parent.moveCenter(e))}}else(this.parent.scale.x!==this.xScale||this.parent.scale.y!==this.yScale)&&this.createSnapping()}resume(){this.snapping=null,super.resume()}}const tA={percent:.1,smooth:!1,interrupt:!0,reverse:!1,center:null,lineHeight:20,axis:"all",keyToPress:null,trackpadPinch:!1,wheelZoom:!0};class eA extends TT{constructor(t,e={}){super(t),ST(this,"options"),ST(this,"smoothing"),ST(this,"smoothingCenter"),ST(this,"smoothingCount"),ST(this,"keyIsPressed"),this.options=Object.assign({},tA,e),this.keyIsPressed=!1,this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){window.addEventListener("keydown",(e=>{t.includes(e.code)&&(this.keyIsPressed=!0)})),window.addEventListener("keyup",(e=>{t.includes(e.code)&&(this.keyIsPressed=!1)}))}checkKeyPress(){return!this.options.keyToPress||this.keyIsPressed}down(){return this.options.interrupt&&(this.smoothing=null),!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}update(){if(this.smoothing){const t=this.smoothingCenter,e=this.smoothing;let s;this.options.center||(s=this.parent.toLocal(t)),this.isAxisX()&&(this.parent.scale.x+=e.x),this.isAxisY()&&(this.parent.scale.y+=e.y),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const n=this.parent.plugins.get("clamp-zoom",!0);if(n&&n.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const e=this.parent.toGlobal(s);this.parent.x+=t.x-e.x,this.parent.y+=t.y-e.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.smoothingCount++,this.smoothingCount>=this.options.smooth&&(this.smoothing=null)}}pinch(t){if(this.paused)return;const e=this.parent.input.getPointerPosition(t),s=-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/200,n=Math.pow(2,(1+this.options.percent)*s);let i;this.options.center||(i=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=n),this.isAxisY()&&(this.parent.scale.y*=n),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const r=this.parent.plugins.get("clamp-zoom",!0);if(r&&r.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const t=this.parent.toGlobal(i);this.parent.x+=e.x-t.x,this.parent.y+=e.y-t.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}wheel(t){if(this.paused||!this.checkKeyPress())return!1;if(t.ctrlKey&&this.options.trackpadPinch)this.pinch(t);else if(this.options.wheelZoom){const e=this.parent.input.getPointerPosition(t),s=(this.options.reverse?-1:1)*-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/500,n=Math.pow(2,(1+this.options.percent)*s);if(this.options.smooth){const t={x:this.smoothing?this.smoothing.x*(this.options.smooth-this.smoothingCount):0,y:this.smoothing?this.smoothing.y*(this.options.smooth-this.smoothingCount):0};this.smoothing={x:((this.parent.scale.x+t.x)*n-this.parent.scale.x)/this.options.smooth,y:((this.parent.scale.y+t.y)*n-this.parent.scale.y)/this.options.smooth},this.smoothingCount=0,this.smoothingCenter=e}else{let t;this.options.center||(t=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=n),this.isAxisY()&&(this.parent.scale.y*=n),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const s=this.parent.plugins.get("clamp-zoom",!0);if(s&&s.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const s=this.parent.toGlobal(t);this.parent.x+=e.x-s.x,this.parent.y+=e.y-s.y}}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}return!this.parent.options.passiveWheel}}class sA{constructor(t){ST(this,"viewport"),ST(this,"clickedAvailable"),ST(this,"isMouseDown"),ST(this,"last"),ST(this,"wheelFunction"),ST(this,"touches"),this.viewport=t,this.touches=[],this.addListeners()}addListeners(){this.viewport.interactive=!0,this.viewport.forceHitArea||(this.viewport.hitArea=new wh(0,0,this.viewport.worldWidth,this.viewport.worldHeight)),this.viewport.on("pointerdown",this.down,this),this.viewport.on("pointermove",this.move,this),this.viewport.on("pointerup",this.up,this),this.viewport.on("pointerupoutside",this.up,this),this.viewport.on("pointercancel",this.up,this),this.viewport.on("pointerout",this.up,this),this.wheelFunction=t=>this.handleWheel(t),this.viewport.options.events.domElement.addEventListener("wheel",this.wheelFunction,{passive:this.viewport.options.passiveWheel}),this.isMouseDown=!1}destroy(){this.viewport.options.events.domElement.removeEventListener("wheel",this.wheelFunction)}down(t){if(!this.viewport.pause&&this.viewport.worldVisible){if("mouse"===t.pointerType?this.isMouseDown=!0:this.get(t.pointerId)||this.touches.push({id:t.pointerId,last:null}),1===this.count()){this.last=t.global.clone();const e=this.viewport.plugins.get("decelerate",!0),s=this.viewport.plugins.get("bounce",!0);e&&e.isActive()||s&&s.isActive()?this.clickedAvailable=!1:this.clickedAvailable=!0}else this.clickedAvailable=!1;this.viewport.plugins.down(t)&&this.viewport.options.stopPropagation&&t.stopPropagation()}}clear(){this.isMouseDown=!1,this.touches=[],this.last=null}checkThreshold(t){return Math.abs(t)>=this.viewport.threshold}move(t){if(this.viewport.pause||!this.viewport.worldVisible)return;const e=this.viewport.plugins.move(t);if(this.clickedAvailable&&this.last){const e=t.global.x-this.last.x,s=t.global.y-this.last.y;(this.checkThreshold(e)||this.checkThreshold(s))&&(this.clickedAvailable=!1)}e&&this.viewport.options.stopPropagation&&t.stopPropagation()}up(t){if(this.viewport.pause||!this.viewport.worldVisible)return;"mouse"===t.pointerType&&(this.isMouseDown=!1),"mouse"!==t.pointerType&&this.remove(t.pointerId);const e=this.viewport.plugins.up(t);this.clickedAvailable&&0===this.count()&&this.last&&(this.viewport.emit("clicked",{event:t,screen:this.last,world:this.viewport.toWorld(this.last),viewport:this.viewport}),this.clickedAvailable=!1),e&&this.viewport.options.stopPropagation&&t.stopPropagation()}getPointerPosition(t){const e=new _h;return this.viewport.options.events.mapPositionToPoint(e,t.clientX,t.clientY),e}handleWheel(t){if(this.viewport.pause||!this.viewport.worldVisible)return;const e=this.viewport.toLocal(this.getPointerPosition(t));this.viewport.left<=e.x&&e.x<=this.viewport.right&&this.viewport.top<=e.y&&e.y<=this.viewport.bottom&&this.viewport.plugins.wheel(t)&&!this.viewport.options.passiveWheel&&t.preventDefault()}pause(){this.touches=[],this.isMouseDown=!1}get(t){for(const e of this.touches)if(e.id===t)return e;return null}remove(t){for(let e=0;e<this.touches.length;e++)if(this.touches[e].id===t)return void this.touches.splice(e,1)}count(){return(this.isMouseDown?1:0)+this.touches.length}}const nA=["drag","pinch","wheel","follow","mouse-edges","decelerate","animate","bounce","snap-zoom","clamp-zoom","snap","clamp"];class iA{constructor(t){ST(this,"plugins"),ST(this,"list"),ST(this,"viewport"),this.viewport=t,this.list=[],this.plugins={}}add(t,e,s=nA.length){const n=this.plugins[t];n&&n.destroy(),this.plugins[t]=e;const i=nA.indexOf(t);-1!==i&&nA.splice(i,1),nA.splice(s,0,t),this.sort()}get(t,e){var s;return e&&null!=(s=this.plugins[t])&&s.paused?null:this.plugins[t]}update(t){for(const e of this.list)e.update(t)}resize(){for(const t of this.list)t.resize()}reset(){for(const t of this.list)t.reset()}removeAll(){this.list.forEach((t=>{t.destroy()})),this.plugins={},this.sort()}remove(t){var e;this.plugins[t]&&(null==(e=this.plugins[t])||e.destroy(),delete this.plugins[t],this.viewport.emit("plugin-remove",t),this.sort())}pause(t){var e;null==(e=this.plugins[t])||e.pause()}resume(t){var e;null==(e=this.plugins[t])||e.resume()}sort(){this.list=[];for(const t of nA)this.plugins[t]&&this.list.push(this.plugins[t])}down(t){let e=!1;for(const s of this.list)s.down(t)&&(e=!0);return e}move(t){let e=!1;for(const s of this.viewport.plugins.list)s.move(t)&&(e=!0);return e}up(t){let e=!1;for(const s of this.list)s.up(t)&&(e=!0);return e}wheel(t){let e=!1;for(const s of this.list)s.wheel(t)&&(e=!0);return e}}const rA={screenWidth:window.innerWidth,screenHeight:window.innerHeight,worldWidth:null,worldHeight:null,threshold:5,passiveWheel:!0,stopPropagation:!1,forceHitArea:null,noTicker:!1,disableOnContextMenu:!1,ticker:Ic.shared};class aA extends Jc{constructor(t){super(),ST(this,"moving"),ST(this,"screenWidth"),ST(this,"screenHeight"),ST(this,"threshold"),ST(this,"input"),ST(this,"plugins"),ST(this,"zooming"),ST(this,"lastViewport"),ST(this,"options"),ST(this,"_dirty"),ST(this,"_forceHitArea"),ST(this,"_hitAreaDefault"),ST(this,"_pause"),ST(this,"tickerFunction"),ST(this,"_worldWidth"),ST(this,"_worldHeight"),ST(this,"_disableOnContextMenu",(t=>t.preventDefault())),this.options=l(l({},rA),t),this.screenWidth=this.options.screenWidth,this.screenHeight=this.options.screenHeight,this._worldWidth=this.options.worldWidth,this._worldHeight=this.options.worldHeight,this.forceHitArea=this.options.forceHitArea,this.threshold=this.options.threshold,this.options.disableOnContextMenu&&this.options.events.domElement.addEventListener("contextmenu",this._disableOnContextMenu),this.options.noTicker||(this.tickerFunction=()=>this.update(this.options.ticker.elapsedMS),this.options.ticker.add(this.tickerFunction)),this.input=new sA(this),this.plugins=new iA(this)}destroy(t){!this.options.noTicker&&this.tickerFunction&&this.options.ticker.remove(this.tickerFunction),this.options.disableOnContextMenu&&this.options.events.domElement.removeEventListener("contextmenu",this._disableOnContextMenu),this.input.destroy(),super.destroy(t)}update(t){this.pause||(this.plugins.update(t),this.lastViewport&&(this.lastViewport.x!==this.x||this.lastViewport.y!==this.y?this.moving=!0:this.moving&&(this.emit("moved-end",this),this.moving=!1),this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y?this.zooming=!0:this.zooming&&(this.emit("zoomed-end",this),this.zooming=!1)),this.forceHitArea||(this._hitAreaDefault=new wh(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight),this.hitArea=this._hitAreaDefault),this._dirty=this._dirty||!this.lastViewport||this.lastViewport.x!==this.x||this.lastViewport.y!==this.y||this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y,this.lastViewport={x:this.x,y:this.y,scaleX:this.scale.x,scaleY:this.scale.y},this.emit("frame-end",this))}resize(t=window.innerWidth,e=window.innerHeight,s,n){this.screenWidth=t,this.screenHeight=e,typeof s<"u"&&(this._worldWidth=s),typeof n<"u"&&(this._worldHeight=n),this.plugins.resize(),this.dirty=!0}get worldWidth(){return this._worldWidth?this._worldWidth:this.width/this.scale.x}set worldWidth(t){this._worldWidth=t,this.plugins.resize()}get worldHeight(){return this._worldHeight?this._worldHeight:this.height/this.scale.y}set worldHeight(t){this._worldHeight=t,this.plugins.resize()}getVisibleBounds(){return new wh(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight)}toWorld(t,e){return 2===arguments.length?this.toLocal(new _h(t,e)):this.toLocal(t)}toScreen(t,e){return 2===arguments.length?this.toGlobal(new _h(t,e)):this.toGlobal(t)}get worldScreenWidth(){return this.screenWidth/this.scale.x}get worldScreenHeight(){return this.screenHeight/this.scale.y}get screenWorldWidth(){return this.worldWidth*this.scale.x}get screenWorldHeight(){return this.worldHeight*this.scale.y}get center(){return new _h(this.worldScreenWidth/2-this.x/this.scale.x,this.worldScreenHeight/2-this.y/this.scale.y)}set center(t){this.moveCenter(t)}moveCenter(...t){let e,s;"number"==typeof t[0]?(e=t[0],s=t[1]):(e=t[0].x,s=t[0].y);const n=(this.worldScreenWidth/2-e)*this.scale.x,i=(this.worldScreenHeight/2-s)*this.scale.y;return(this.x!==n||this.y!==i)&&(this.position.set(n,i),this.plugins.reset(),this.dirty=!0),this}get corner(){return new _h(-this.x/this.scale.x,-this.y/this.scale.y)}set corner(t){this.moveCorner(t)}moveCorner(...t){let e,s;return 1===t.length?(e=-t[0].x*this.scale.x,s=-t[0].y*this.scale.y):(e=-t[0]*this.scale.x,s=-t[1]*this.scale.y),(e!==this.x||s!==this.y)&&(this.position.set(e,s),this.plugins.reset(),this.dirty=!0),this}get screenWidthInWorldPixels(){return this.screenWidth/this.scale.x}get screenHeightInWorldPixels(){return this.screenHeight/this.scale.y}findFitWidth(t){return this.screenWidth/t}findFitHeight(t){return this.screenHeight/t}findFit(t,e){const s=this.screenWidth/t,n=this.screenHeight/e;return Math.min(s,n)}findCover(t,e){const s=this.screenWidth/t,n=this.screenHeight/e;return Math.max(s,n)}fitWidth(t=this.worldWidth,e,s=!0,n){let i;e&&(i=this.center),this.scale.x=this.screenWidth/t,s&&(this.scale.y=this.scale.x);const r=this.plugins.get("clamp-zoom",!0);return!n&&r&&r.clamp(),e&&i&&this.moveCenter(i),this}fitHeight(t=this.worldHeight,e,s=!0,n){let i;e&&(i=this.center),this.scale.y=this.screenHeight/t,s&&(this.scale.x=this.scale.y);const r=this.plugins.get("clamp-zoom",!0);return!n&&r&&r.clamp(),e&&i&&this.moveCenter(i),this}fitWorld(t){let e;t&&(e=this.center),this.scale.x=this.screenWidth/this.worldWidth,this.scale.y=this.screenHeight/this.worldHeight,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const s=this.plugins.get("clamp-zoom",!0);return s&&s.clamp(),t&&e&&this.moveCenter(e),this}fit(t,e=this.worldWidth,s=this.worldHeight){let n;t&&(n=this.center),this.scale.x=this.screenWidth/e,this.scale.y=this.screenHeight/s,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const i=this.plugins.get("clamp-zoom",!0);return i&&i.clamp(),t&&n&&this.moveCenter(n),this}setZoom(t,e){let s;e&&(s=this.center),this.scale.set(t);const n=this.plugins.get("clamp-zoom",!0);return n&&n.clamp(),e&&s&&this.moveCenter(s),this}zoomPercent(t,e){return this.setZoom(this.scale.x+this.scale.x*t,e)}zoom(t,e){return this.fitWidth(t+this.worldScreenWidth,e),this}get scaled(){return this.scale.x}set scaled(t){this.setZoom(t,!0)}snapZoom(t){return this.plugins.add("snap-zoom",new JT(this,t)),this}OOB(){return{left:this.left<0,right:this.right>this.worldWidth,top:this.top<0,bottom:this.bottom>this.worldHeight,cornerPoint:new _h(this.worldWidth*this.scale.x-this.screenWidth,this.worldHeight*this.scale.y-this.screenHeight)}}get right(){return-this.x/this.scale.x+this.worldScreenWidth}set right(t){this.x=-t*this.scale.x+this.screenWidth,this.plugins.reset()}get left(){return-this.x/this.scale.x}set left(t){this.x=-t*this.scale.x,this.plugins.reset()}get top(){return-this.y/this.scale.y}set top(t){this.y=-t*this.scale.y,this.plugins.reset()}get bottom(){return-this.y/this.scale.y+this.worldScreenHeight}set bottom(t){this.y=-t*this.scale.y+this.screenHeight,this.plugins.reset()}get dirty(){return!!this._dirty}set dirty(t){this._dirty=t}get forceHitArea(){return this._forceHitArea}set forceHitArea(t){t?(this._forceHitArea=t,this.hitArea=t):(this._forceHitArea=null,this.hitArea=new wh(0,0,this.worldWidth,this.worldHeight))}drag(t){return this.plugins.add("drag",new YT(this,t)),this}clamp(t){return this.plugins.add("clamp",new NT(this,t)),this}decelerate(t){return this.plugins.add("decelerate",new UT(this,t)),this}bounce(t){return this.plugins.add("bounce",new FT(this,t)),this}pinch(t){return this.plugins.add("pinch",new qT(this,t)),this}snap(t,e,s){return this.plugins.add("snap",new ZT(this,t,e,s)),this}follow(t,e){return this.plugins.add("follow",new jT(this,t,e)),this}wheel(t){return this.plugins.add("wheel",new eA(this,t)),this}animate(t){return this.plugins.add("animate",new kT(this,t)),this}clampZoom(t){return this.plugins.add("clamp-zoom",new LT(this,t)),this}mouseEdges(t){return this.plugins.add("mouse-edges",new GT(this,t)),this}get pause(){return!!this._pause}set pause(t){this._pause=t,this.lastViewport=null,this.moving=!1,this.zooming=!1,t&&this.input.pause()}ensureVisible(t,e,s,n,i){i&&(s>this.worldScreenWidth||n>this.worldScreenHeight)&&(this.fit(!0,s,n),this.emit("zoomed",{viewport:this,type:"ensureVisible"}));let r=!1;t<this.left?(this.left=t,r=!0):t+s>this.right&&(this.right=t+s,r=!0),e<this.top?(this.top=e,r=!0):e+n>this.bottom&&(this.bottom=e+n,r=!0),r&&this.emit("moved",{viewport:this,type:"ensureVisible"})}}class oA extends(Zm(aA)){get parentContainer(){return this.parent}sendObjToBack(t){this.parentContainer.sendObjToBack(t)}bringObjToFront(t){this.parentContainer.bringObjToFront(t)}}var hA;(hA=Ji).StartGame.R,hA.Bet.S,hA.Bet.R,hA.Step.S,hA.Step.R;class lA extends TS{constructor(){super("Loading"),d(this,"isGameInitialized",!1),d(this,"isStartRequestReceived",!1)}enter(){console.log("STATE: LOADING")}update(){this.isGameInitialized&&this.setNext("SPage1")}exit(){"SPage1"==this._nextState&&(pgame.data.setDefaultBet(),pgame.data.syncCredits(),pgame.onGameReady(),pgame.music.Bg.play()),null!==API.params.get("cheat")&&null===API.params.get("cheatRND")&&(pgame.interact.on("down-p",(()=>API.showCheatPanel(!0))),pgame.interact.on("down-P",(()=>API.showCheatPanel(!0))))}}function cA(t=""){let e;return e={text:t,fill:[Hm.White],size:164,weight:"100",font:"Impact",stroke:Hm.Pink,strokeThickness:10,lineJoin:"round"},e}class uA extends ag{constructor(){super(),d(this,"imgBackground"),d(this,"btnGift"),d(this,"txtTitle",[]),d(this,"titleArray",["Trc khi nhn qu,","bn hy tr li 1 cu hi  chng ti bit"," giao qu cho ng ngi"]),this.imgBackground=new nv("page2_cover"),this.imgBackground.pivotRule=jm.Center,this.imgBackground.scale.set(.5),this.btnGift=new vS("gift"),this.btnGift.pivotRule=jm.Center,this.btnGift.scale.set(1.6),this.btnGift.position.set(10,40);for(let t=0;t<3;t++)this.txtTitle[t]=new rv(cA(this.titleArray[t])),this.txtTitle[t].setTxtStyle({fill:Hm.Pink,stroke:Hm.Black}),this.txtTitle[t].pivotRule=jm.Center,this.txtTitle[t].position.set(0,200*t-300),this.txtTitle[t].fitType="Shrink",this.txtTitle[t].setFitBox(500,100),this.addObj(this.txtTitle[t],1);this.addObj(this.imgBackground,0)}twGiftTransition1(){this.tweens.create("giftTransition1.2",this.btnGift,{x:2e3},1e3).start()}}class dA extends ag{constructor(){super(),d(this,"imgBackground"),d(this,"btnGift"),d(this,"txtTitleP1"),d(this,"isOpen",!1),this.imgBackground=new nv("page_1"),this.imgBackground.pivotRule=jm.Center,this.imgBackground.scale.set(.22),this.btnGift=new vS("gift"),this.btnGift.pivotRule=jm.Center,this.btnGift.scale.set(.4),this.btnGift.position.set(10,40),this.txtTitleP1=new rv(cA("Mt mn qu nh tng cho c b ca anh nhn ngy 20/10 ^^")),this.txtTitleP1.pivotRule=jm.Center,this.txtTitleP1.fitType="Shrink",this.txtTitleP1.setFitBox(600,600),this.addObj(this.imgBackground,0).addObj(this.txtTitleP1,0).addObj(this.btnGift,0),this.twGiftShaking()}twGiftShaking(t=400,e=32){this.tweens.create("giftShakingLeft",this.btnGift,{radian:gh/e},t).start().on("end",(()=>{this.tweens.create("giftShakingRight",this.btnGift,{radian:gh/-e},t).start().on("end",(()=>{this.isOpen?(this.btnGift.rotation=0,setTimeout((()=>{this.twGiftTransition1()}),300)):this.twGiftShaking()}))}))}twGiftTransition1(){this.tweens.create("giftTransition1",this.btnGift,{scale:{x:1.6,y:1.6}},600).start()}}class fA extends ag{constructor(){super(),d(this,"page1",new dA),d(this,"page2",new uA),this.name="GUI",this.page1.pivotRule=jm.Center,this.page1.visible=!1,this.page2.pivotRule=jm.Center,this.page2.visible=!0,this.addObj(this.page1,0,"page1").addObj(this.page2,0,"page2")}_setBtnCallBack(){}_setBtnEffect(){}useViewStyle(t){}}var pA={};!function(t,e){(function(){var s,n=200,i="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",r="Expected a function",a="Invalid `variable` option passed into `_.template`",o="__lodash_hash_undefined__",h=500,l="__lodash_placeholder__",c=1,u=2,d=4,f=1,p=2,g=1,y=2,v=4,x=8,_=16,b=32,w=64,E=128,S=256,T=512,A=30,C="...",M=800,I=16,P=1,R=2,k=1/0,D=9007199254740991,F=17976931348623157e292,O=NaN,N=4294967295,B=N-1,L=N>>>1,V=[["ary",E],["bind",g],["bindKey",y],["curry",x],["curryRight",_],["flip",T],["partial",b],["partialRight",w],["rearg",S]],$="[object Arguments]",U="[object Array]",X="[object AsyncFunction]",Y="[object Boolean]",W="[object Date]",j="[object DOMException]",z="[object Error]",G="[object Function]",H="[object GeneratorFunction]",q="[object Map]",K="[object Number]",Z="[object Null]",Q="[object Object]",J="[object Promise]",tt="[object Proxy]",et="[object RegExp]",st="[object Set]",nt="[object String]",it="[object Symbol]",rt="[object Undefined]",at="[object WeakMap]",ot="[object WeakSet]",ht="[object ArrayBuffer]",lt="[object DataView]",ct="[object Float32Array]",ut="[object Float64Array]",dt="[object Int8Array]",ft="[object Int16Array]",pt="[object Int32Array]",mt="[object Uint8Array]",gt="[object Uint8ClampedArray]",yt="[object Uint16Array]",vt="[object Uint32Array]",xt=/\b__p \+= '';/g,_t=/\b(__p \+=) '' \+/g,bt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,wt=/&(?:amp|lt|gt|quot|#39);/g,Et=/[&<>"']/g,St=RegExp(wt.source),Tt=RegExp(Et.source),At=/<%-([\s\S]+?)%>/g,Ct=/<%([\s\S]+?)%>/g,Mt=/<%=([\s\S]+?)%>/g,It=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Pt=/^\w*$/,Rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,kt=/[\\^$.*+?()[\]{}|]/g,Dt=RegExp(kt.source),Ft=/^\s+/,Ot=/\s/,Nt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Bt=/\{\n\/\* \[wrapped with (.+)\] \*/,Lt=/,? & /,Vt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,$t=/[()=,{}\[\]\/\s]/,Ut=/\\(\\)?/g,Xt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Yt=/\w*$/,Wt=/^[-+]0x[0-9a-f]+$/i,jt=/^0b[01]+$/i,zt=/^\[object .+?Constructor\]$/,Gt=/^0o[0-7]+$/i,Ht=/^(?:0|[1-9]\d*)$/,qt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Kt=/($^)/,Zt=/['\n\r\u2028\u2029\\]/g,Qt="\\ud800-\\udfff",Jt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",te="\\u2700-\\u27bf",ee="a-z\\xdf-\\xf6\\xf8-\\xff",se="A-Z\\xc0-\\xd6\\xd8-\\xde",ne="\\ufe0e\\ufe0f",ie="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",re="[']",ae="["+Qt+"]",oe="["+ie+"]",he="["+Jt+"]",le="\\d+",ce="["+te+"]",ue="["+ee+"]",de="[^"+Qt+ie+le+te+ee+se+"]",fe="\\ud83c[\\udffb-\\udfff]",pe="[^"+Qt+"]",me="(?:\\ud83c[\\udde6-\\uddff]){2}",ge="[\\ud800-\\udbff][\\udc00-\\udfff]",ye="["+se+"]",ve="\\u200d",xe="(?:"+ue+"|"+de+")",_e="(?:"+ye+"|"+de+")",be="(?:['](?:d|ll|m|re|s|t|ve))?",we="(?:['](?:D|LL|M|RE|S|T|VE))?",Ee="(?:"+he+"|"+fe+")"+"?",Se="["+ne+"]?",Te=Se+Ee+("(?:"+ve+"(?:"+[pe,me,ge].join("|")+")"+Se+Ee+")*"),Ae="(?:"+[ce,me,ge].join("|")+")"+Te,Ce="(?:"+[pe+he+"?",he,me,ge,ae].join("|")+")",Me=RegExp(re,"g"),Ie=RegExp(he,"g"),Pe=RegExp(fe+"(?="+fe+")|"+Ce+Te,"g"),Re=RegExp([ye+"?"+ue+"+"+be+"(?="+[oe,ye,"$"].join("|")+")",_e+"+"+we+"(?="+[oe,ye+xe,"$"].join("|")+")",ye+"?"+xe+"+"+be,ye+"+"+we,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",le,Ae].join("|"),"g"),ke=RegExp("["+ve+Qt+Jt+ne+"]"),De=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Fe=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Oe=-1,Ne={};Ne[ct]=Ne[ut]=Ne[dt]=Ne[ft]=Ne[pt]=Ne[mt]=Ne[gt]=Ne[yt]=Ne[vt]=!0,Ne[$]=Ne[U]=Ne[ht]=Ne[Y]=Ne[lt]=Ne[W]=Ne[z]=Ne[G]=Ne[q]=Ne[K]=Ne[Q]=Ne[et]=Ne[st]=Ne[nt]=Ne[at]=!1;var Be={};Be[$]=Be[U]=Be[ht]=Be[lt]=Be[Y]=Be[W]=Be[ct]=Be[ut]=Be[dt]=Be[ft]=Be[pt]=Be[q]=Be[K]=Be[Q]=Be[et]=Be[st]=Be[nt]=Be[it]=Be[mt]=Be[gt]=Be[yt]=Be[vt]=!0,Be[z]=Be[G]=Be[at]=!1;var Le={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ve=parseFloat,$e=parseInt,Ue="object"==typeof m&&m&&m.Object===Object&&m,Xe="object"==typeof self&&self&&self.Object===Object&&self,Ye=Ue||Xe||Function("return this")(),We=e&&!e.nodeType&&e,je=We&&t&&!t.nodeType&&t,ze=je&&je.exports===We,Ge=ze&&Ue.process,He=function(){try{var t=je&&je.require&&je.require("util").types;return t||Ge&&Ge.binding&&Ge.binding("util")}catch(jp){}}(),qe=He&&He.isArrayBuffer,Ke=He&&He.isDate,Ze=He&&He.isMap,Qe=He&&He.isRegExp,Je=He&&He.isSet,ts=He&&He.isTypedArray;function es(t,e,s){switch(s.length){case 0:return t.call(e);case 1:return t.call(e,s[0]);case 2:return t.call(e,s[0],s[1]);case 3:return t.call(e,s[0],s[1],s[2])}return t.apply(e,s)}function ss(t,e,s,n){for(var i=-1,r=null==t?0:t.length;++i<r;){var a=t[i];e(n,a,s(a),t)}return n}function ns(t,e){for(var s=-1,n=null==t?0:t.length;++s<n&&!1!==e(t[s],s,t););return t}function is(t,e){for(var s=null==t?0:t.length;s--&&!1!==e(t[s],s,t););return t}function rs(t,e){for(var s=-1,n=null==t?0:t.length;++s<n;)if(!e(t[s],s,t))return!1;return!0}function as(t,e){for(var s=-1,n=null==t?0:t.length,i=0,r=[];++s<n;){var a=t[s];e(a,s,t)&&(r[i++]=a)}return r}function os(t,e){return!!(null==t?0:t.length)&&ys(t,e,0)>-1}function hs(t,e,s){for(var n=-1,i=null==t?0:t.length;++n<i;)if(s(e,t[n]))return!0;return!1}function ls(t,e){for(var s=-1,n=null==t?0:t.length,i=Array(n);++s<n;)i[s]=e(t[s],s,t);return i}function cs(t,e){for(var s=-1,n=e.length,i=t.length;++s<n;)t[i+s]=e[s];return t}function us(t,e,s,n){var i=-1,r=null==t?0:t.length;for(n&&r&&(s=t[++i]);++i<r;)s=e(s,t[i],i,t);return s}function ds(t,e,s,n){var i=null==t?0:t.length;for(n&&i&&(s=t[--i]);i--;)s=e(s,t[i],i,t);return s}function fs(t,e){for(var s=-1,n=null==t?0:t.length;++s<n;)if(e(t[s],s,t))return!0;return!1}var ps=bs("length");function ms(t,e,s){var n;return s(t,(function(t,s,i){if(e(t,s,i))return n=s,!1})),n}function gs(t,e,s,n){for(var i=t.length,r=s+(n?1:-1);n?r--:++r<i;)if(e(t[r],r,t))return r;return-1}function ys(t,e,s){return e==e?function(t,e,s){var n=s-1,i=t.length;for(;++n<i;)if(t[n]===e)return n;return-1}(t,e,s):gs(t,xs,s)}function vs(t,e,s,n){for(var i=s-1,r=t.length;++i<r;)if(n(t[i],e))return i;return-1}function xs(t){return t!=t}function _s(t,e){var s=null==t?0:t.length;return s?Ss(t,e)/s:O}function bs(t){return function(e){return null==e?s:e[t]}}function ws(t){return function(e){return null==t?s:t[e]}}function Es(t,e,s,n,i){return i(t,(function(t,i,r){s=n?(n=!1,t):e(s,t,i,r)})),s}function Ss(t,e){for(var n,i=-1,r=t.length;++i<r;){var a=e(t[i]);a!==s&&(n=n===s?a:n+a)}return n}function Ts(t,e){for(var s=-1,n=Array(t);++s<t;)n[s]=e(s);return n}function As(t){return t?t.slice(0,Xs(t)+1).replace(Ft,""):t}function Cs(t){return function(e){return t(e)}}function Ms(t,e){return ls(e,(function(e){return t[e]}))}function Is(t,e){return t.has(e)}function Ps(t,e){for(var s=-1,n=t.length;++s<n&&ys(e,t[s],0)>-1;);return s}function Rs(t,e){for(var s=t.length;s--&&ys(e,t[s],0)>-1;);return s}var ks=ws({"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"}),Ds=ws({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Fs(t){return"\\"+Le[t]}function Os(t){return ke.test(t)}function Ns(t){var e=-1,s=Array(t.size);return t.forEach((function(t,n){s[++e]=[n,t]})),s}function Bs(t,e){return function(s){return t(e(s))}}function Ls(t,e){for(var s=-1,n=t.length,i=0,r=[];++s<n;){var a=t[s];a!==e&&a!==l||(t[s]=l,r[i++]=s)}return r}function Vs(t){var e=-1,s=Array(t.size);return t.forEach((function(t){s[++e]=t})),s}function $s(t){return Os(t)?function(t){var e=Pe.lastIndex=0;for(;Pe.test(t);)++e;return e}(t):ps(t)}function Us(t){return Os(t)?function(t){return t.match(Pe)||[]}(t):function(t){return t.split("")}(t)}function Xs(t){for(var e=t.length;e--&&Ot.test(t.charAt(e)););return e}var Ys=ws({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var Ws=function t(e){var m,Ot=(e=null==e?Ye:Ws.defaults(Ye.Object(),e,Ws.pick(Ye,Fe))).Array,Qt=e.Date,Jt=e.Error,te=e.Function,ee=e.Math,se=e.Object,ne=e.RegExp,ie=e.String,re=e.TypeError,ae=Ot.prototype,oe=te.prototype,he=se.prototype,le=e["__core-js_shared__"],ce=oe.toString,ue=he.hasOwnProperty,de=0,fe=(m=/[^.]+$/.exec(le&&le.keys&&le.keys.IE_PROTO||""))?"Symbol(src)_1."+m:"",pe=he.toString,me=ce.call(se),ge=Ye._,ye=ne("^"+ce.call(ue).replace(kt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ve=ze?e.Buffer:s,xe=e.Symbol,_e=e.Uint8Array,be=ve?ve.allocUnsafe:s,we=Bs(se.getPrototypeOf,se),Ee=se.create,Se=he.propertyIsEnumerable,Te=ae.splice,Ae=xe?xe.isConcatSpreadable:s,Ce=xe?xe.iterator:s,Pe=xe?xe.toStringTag:s,ke=function(){try{var t=$r(se,"defineProperty");return t({},"",{}),t}catch(jp){}}(),Le=e.clearTimeout!==Ye.clearTimeout&&e.clearTimeout,Ue=Qt&&Qt.now!==Ye.Date.now&&Qt.now,Xe=e.setTimeout!==Ye.setTimeout&&e.setTimeout,We=ee.ceil,je=ee.floor,Ge=se.getOwnPropertySymbols,He=ve?ve.isBuffer:s,ps=e.isFinite,ws=ae.join,js=Bs(se.keys,se),zs=ee.max,Gs=ee.min,Hs=Qt.now,qs=e.parseInt,Ks=ee.random,Zs=ae.reverse,Qs=$r(e,"DataView"),Js=$r(e,"Map"),tn=$r(e,"Promise"),en=$r(e,"Set"),sn=$r(e,"WeakMap"),nn=$r(se,"create"),rn=sn&&new sn,an={},on=ma(Qs),hn=ma(Js),ln=ma(tn),cn=ma(en),un=ma(sn),dn=xe?xe.prototype:s,fn=dn?dn.valueOf:s,pn=dn?dn.toString:s;function mn(t){if(Do(t)&&!wo(t)&&!(t instanceof xn)){if(t instanceof vn)return t;if(ue.call(t,"__wrapped__"))return ga(t)}return new vn(t)}var gn=function(){function t(){}return function(e){if(!ko(e))return{};if(Ee)return Ee(e);t.prototype=e;var n=new t;return t.prototype=s,n}}();function yn(){}function vn(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=s}function xn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=N,this.__views__=[]}function _n(t){var e=-1,s=null==t?0:t.length;for(this.clear();++e<s;){var n=t[e];this.set(n[0],n[1])}}function bn(t){var e=-1,s=null==t?0:t.length;for(this.clear();++e<s;){var n=t[e];this.set(n[0],n[1])}}function wn(t){var e=-1,s=null==t?0:t.length;for(this.clear();++e<s;){var n=t[e];this.set(n[0],n[1])}}function En(t){var e=-1,s=null==t?0:t.length;for(this.__data__=new wn;++e<s;)this.add(t[e])}function Sn(t){var e=this.__data__=new bn(t);this.size=e.size}function Tn(t,e){var s=wo(t),n=!s&&bo(t),i=!s&&!n&&Ao(t),r=!s&&!n&&!i&&Uo(t),a=s||n||i||r,o=a?Ts(t.length,ie):[],h=o.length;for(var l in t)!e&&!ue.call(t,l)||a&&("length"==l||i&&("offset"==l||"parent"==l)||r&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Gr(l,h))||o.push(l);return o}function An(t){var e=t.length;return e?t[Ei(0,e-1)]:s}function Cn(t,e){return la(ir(t),Nn(e,0,t.length))}function Mn(t){return la(ir(t))}function In(t,e,n){(n!==s&&!vo(t[e],n)||n===s&&!(e in t))&&Fn(t,e,n)}function Pn(t,e,n){var i=t[e];ue.call(t,e)&&vo(i,n)&&(n!==s||e in t)||Fn(t,e,n)}function Rn(t,e){for(var s=t.length;s--;)if(vo(t[s][0],e))return s;return-1}function kn(t,e,s,n){return Un(t,(function(t,i,r){e(n,t,s(t),r)})),n}function Dn(t,e){return t&&rr(e,lh(e),t)}function Fn(t,e,s){"__proto__"==e&&ke?ke(t,e,{configurable:!0,enumerable:!0,value:s,writable:!0}):t[e]=s}function On(t,e){for(var n=-1,i=e.length,r=Ot(i),a=null==t;++n<i;)r[n]=a?s:ih(t,e[n]);return r}function Nn(t,e,n){return t==t&&(n!==s&&(t=t<=n?t:n),e!==s&&(t=t>=e?t:e)),t}function Bn(t,e,n,i,r,a){var o,h=e&c,l=e&u,f=e&d;if(n&&(o=r?n(t,i,r,a):n(t)),o!==s)return o;if(!ko(t))return t;var p=wo(t);if(p){if(o=function(t){var e=t.length,s=new t.constructor(e);e&&"string"==typeof t[0]&&ue.call(t,"index")&&(s.index=t.index,s.input=t.input);return s}(t),!h)return ir(t,o)}else{var m=Yr(t),g=m==G||m==H;if(Ao(t))return Qi(t,h);if(m==Q||m==$||g&&!r){if(o=l||g?{}:jr(t),!h)return l?function(t,e){return rr(t,Xr(t),e)}(t,function(t,e){return t&&rr(e,ch(e),t)}(o,t)):function(t,e){return rr(t,Ur(t),e)}(t,Dn(o,t))}else{if(!Be[m])return r?t:{};o=function(t,e,s){var n=t.constructor;switch(e){case ht:return Ji(t);case Y:case W:return new n(+t);case lt:return function(t,e){var s=e?Ji(t.buffer):t.buffer;return new t.constructor(s,t.byteOffset,t.byteLength)}(t,s);case ct:case ut:case dt:case ft:case pt:case mt:case gt:case yt:case vt:return tr(t,s);case q:return new n;case K:case nt:return new n(t);case et:return function(t){var e=new t.constructor(t.source,Yt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case st:return new n;case it:return i=t,fn?se(fn.call(i)):{}}var i}(t,m,h)}}a||(a=new Sn);var y=a.get(t);if(y)return y;a.set(t,o),Lo(t)?t.forEach((function(s){o.add(Bn(s,e,n,s,t,a))})):Fo(t)&&t.forEach((function(s,i){o.set(i,Bn(s,e,n,i,t,a))}));var v=p?s:(f?l?Dr:kr:l?ch:lh)(t);return ns(v||t,(function(s,i){v&&(s=t[i=s]),Pn(o,i,Bn(s,e,n,i,t,a))})),o}function Ln(t,e,n){var i=n.length;if(null==t)return!i;for(t=se(t);i--;){var r=n[i],a=e[r],o=t[r];if(o===s&&!(r in t)||!a(o))return!1}return!0}function Vn(t,e,n){if("function"!=typeof t)throw new re(r);return ra((function(){t.apply(s,n)}),e)}function $n(t,e,s,i){var r=-1,a=os,o=!0,h=t.length,l=[],c=e.length;if(!h)return l;s&&(e=ls(e,Cs(s))),i?(a=hs,o=!1):e.length>=n&&(a=Is,o=!1,e=new En(e));t:for(;++r<h;){var u=t[r],d=null==s?u:s(u);if(u=i||0!==u?u:0,o&&d==d){for(var f=c;f--;)if(e[f]===d)continue t;l.push(u)}else a(e,d,i)||l.push(u)}return l}mn.templateSettings={escape:At,evaluate:Ct,interpolate:Mt,variable:"",imports:{_:mn}},mn.prototype=yn.prototype,mn.prototype.constructor=mn,vn.prototype=gn(yn.prototype),vn.prototype.constructor=vn,xn.prototype=gn(yn.prototype),xn.prototype.constructor=xn,_n.prototype.clear=function(){this.__data__=nn?nn(null):{},this.size=0},_n.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},_n.prototype.get=function(t){var e=this.__data__;if(nn){var n=e[t];return n===o?s:n}return ue.call(e,t)?e[t]:s},_n.prototype.has=function(t){var e=this.__data__;return nn?e[t]!==s:ue.call(e,t)},_n.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=nn&&e===s?o:e,this},bn.prototype.clear=function(){this.__data__=[],this.size=0},bn.prototype.delete=function(t){var e=this.__data__,s=Rn(e,t);return!(s<0)&&(s==e.length-1?e.pop():Te.call(e,s,1),--this.size,!0)},bn.prototype.get=function(t){var e=this.__data__,n=Rn(e,t);return n<0?s:e[n][1]},bn.prototype.has=function(t){return Rn(this.__data__,t)>-1},bn.prototype.set=function(t,e){var s=this.__data__,n=Rn(s,t);return n<0?(++this.size,s.push([t,e])):s[n][1]=e,this},wn.prototype.clear=function(){this.size=0,this.__data__={hash:new _n,map:new(Js||bn),string:new _n}},wn.prototype.delete=function(t){var e=Lr(this,t).delete(t);return this.size-=e?1:0,e},wn.prototype.get=function(t){return Lr(this,t).get(t)},wn.prototype.has=function(t){return Lr(this,t).has(t)},wn.prototype.set=function(t,e){var s=Lr(this,t),n=s.size;return s.set(t,e),this.size+=s.size==n?0:1,this},En.prototype.add=En.prototype.push=function(t){return this.__data__.set(t,o),this},En.prototype.has=function(t){return this.__data__.has(t)},Sn.prototype.clear=function(){this.__data__=new bn,this.size=0},Sn.prototype.delete=function(t){var e=this.__data__,s=e.delete(t);return this.size=e.size,s},Sn.prototype.get=function(t){return this.__data__.get(t)},Sn.prototype.has=function(t){return this.__data__.has(t)},Sn.prototype.set=function(t,e){var s=this.__data__;if(s instanceof bn){var i=s.__data__;if(!Js||i.length<n-1)return i.push([t,e]),this.size=++s.size,this;s=this.__data__=new wn(i)}return s.set(t,e),this.size=s.size,this};var Un=hr(qn),Xn=hr(Kn,!0);function Yn(t,e){var s=!0;return Un(t,(function(t,n,i){return s=!!e(t,n,i)})),s}function Wn(t,e,n){for(var i=-1,r=t.length;++i<r;){var a=t[i],o=e(a);if(null!=o&&(h===s?o==o&&!$o(o):n(o,h)))var h=o,l=a}return l}function jn(t,e){var s=[];return Un(t,(function(t,n,i){e(t,n,i)&&s.push(t)})),s}function zn(t,e,s,n,i){var r=-1,a=t.length;for(s||(s=zr),i||(i=[]);++r<a;){var o=t[r];e>0&&s(o)?e>1?zn(o,e-1,s,n,i):cs(i,o):n||(i[i.length]=o)}return i}var Gn=lr(),Hn=lr(!0);function qn(t,e){return t&&Gn(t,e,lh)}function Kn(t,e){return t&&Hn(t,e,lh)}function Zn(t,e){return as(e,(function(e){return Io(t[e])}))}function Qn(t,e){for(var n=0,i=(e=Hi(e,t)).length;null!=t&&n<i;)t=t[pa(e[n++])];return n&&n==i?t:s}function Jn(t,e,s){var n=e(t);return wo(t)?n:cs(n,s(t))}function ti(t){return null==t?t===s?rt:Z:Pe&&Pe in se(t)?function(t){var e=ue.call(t,Pe),n=t[Pe];try{t[Pe]=s;var i=!0}catch(jp){}var r=pe.call(t);i&&(e?t[Pe]=n:delete t[Pe]);return r}(t):function(t){return pe.call(t)}(t)}function ei(t,e){return t>e}function si(t,e){return null!=t&&ue.call(t,e)}function ni(t,e){return null!=t&&e in se(t)}function ii(t,e,n){for(var i=n?hs:os,r=t[0].length,a=t.length,o=a,h=Ot(a),l=1/0,c=[];o--;){var u=t[o];o&&e&&(u=ls(u,Cs(e))),l=Gs(u.length,l),h[o]=!n&&(e||r>=120&&u.length>=120)?new En(o&&u):s}u=t[0];var d=-1,f=h[0];t:for(;++d<r&&c.length<l;){var p=u[d],m=e?e(p):p;if(p=n||0!==p?p:0,!(f?Is(f,m):i(c,m,n))){for(o=a;--o;){var g=h[o];if(!(g?Is(g,m):i(t[o],m,n)))continue t}f&&f.push(m),c.push(p)}}return c}function ri(t,e,n){var i=null==(t=sa(t,e=Hi(e,t)))?t:t[pa(Ca(e))];return null==i?s:es(i,t,n)}function ai(t){return Do(t)&&ti(t)==$}function oi(t,e,n,i,r){return t===e||(null==t||null==e||!Do(t)&&!Do(e)?t!=t&&e!=e:function(t,e,n,i,r,a){var o=wo(t),h=wo(e),l=o?U:Yr(t),c=h?U:Yr(e),u=(l=l==$?Q:l)==Q,d=(c=c==$?Q:c)==Q,m=l==c;if(m&&Ao(t)){if(!Ao(e))return!1;o=!0,u=!1}if(m&&!u)return a||(a=new Sn),o||Uo(t)?Pr(t,e,n,i,r,a):function(t,e,s,n,i,r,a){switch(s){case lt:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case ht:return!(t.byteLength!=e.byteLength||!r(new _e(t),new _e(e)));case Y:case W:case K:return vo(+t,+e);case z:return t.name==e.name&&t.message==e.message;case et:case nt:return t==e+"";case q:var o=Ns;case st:var h=n&f;if(o||(o=Vs),t.size!=e.size&&!h)return!1;var l=a.get(t);if(l)return l==e;n|=p,a.set(t,e);var c=Pr(o(t),o(e),n,i,r,a);return a.delete(t),c;case it:if(fn)return fn.call(t)==fn.call(e)}return!1}(t,e,l,n,i,r,a);if(!(n&f)){var g=u&&ue.call(t,"__wrapped__"),y=d&&ue.call(e,"__wrapped__");if(g||y){var v=g?t.value():t,x=y?e.value():e;return a||(a=new Sn),r(v,x,n,i,a)}}if(!m)return!1;return a||(a=new Sn),function(t,e,n,i,r,a){var o=n&f,h=kr(t),l=h.length,c=kr(e),u=c.length;if(l!=u&&!o)return!1;var d=l;for(;d--;){var p=h[d];if(!(o?p in e:ue.call(e,p)))return!1}var m=a.get(t),g=a.get(e);if(m&&g)return m==e&&g==t;var y=!0;a.set(t,e),a.set(e,t);var v=o;for(;++d<l;){var x=t[p=h[d]],_=e[p];if(i)var b=o?i(_,x,p,e,t,a):i(x,_,p,t,e,a);if(!(b===s?x===_||r(x,_,n,i,a):b)){y=!1;break}v||(v="constructor"==p)}if(y&&!v){var w=t.constructor,E=e.constructor;w==E||!("constructor"in t)||!("constructor"in e)||"function"==typeof w&&w instanceof w&&"function"==typeof E&&E instanceof E||(y=!1)}return a.delete(t),a.delete(e),y}(t,e,n,i,r,a)}(t,e,n,i,oi,r))}function hi(t,e,n,i){var r=n.length,a=r,o=!i;if(null==t)return!a;for(t=se(t);r--;){var h=n[r];if(o&&h[2]?h[1]!==t[h[0]]:!(h[0]in t))return!1}for(;++r<a;){var l=(h=n[r])[0],c=t[l],u=h[1];if(o&&h[2]){if(c===s&&!(l in t))return!1}else{var d=new Sn;if(i)var m=i(c,u,l,t,e,d);if(!(m===s?oi(u,c,f|p,i,d):m))return!1}}return!0}function li(t){return!(!ko(t)||(e=t,fe&&fe in e))&&(Io(t)?ye:zt).test(ma(t));var e}function ci(t){return"function"==typeof t?t:null==t?Oh:"object"==typeof t?wo(t)?gi(t[0],t[1]):mi(t):Wh(t)}function ui(t){if(!Qr(t))return js(t);var e=[];for(var s in se(t))ue.call(t,s)&&"constructor"!=s&&e.push(s);return e}function di(t){if(!ko(t))return function(t){var e=[];if(null!=t)for(var s in se(t))e.push(s);return e}(t);var e=Qr(t),s=[];for(var n in t)("constructor"!=n||!e&&ue.call(t,n))&&s.push(n);return s}function fi(t,e){return t<e}function pi(t,e){var s=-1,n=So(t)?Ot(t.length):[];return Un(t,(function(t,i,r){n[++s]=e(t,i,r)})),n}function mi(t){var e=Vr(t);return 1==e.length&&e[0][2]?ta(e[0][0],e[0][1]):function(s){return s===t||hi(s,t,e)}}function gi(t,e){return qr(t)&&Jr(e)?ta(pa(t),e):function(n){var i=ih(n,t);return i===s&&i===e?rh(n,t):oi(e,i,f|p)}}function yi(t,e,n,i,r){t!==e&&Gn(e,(function(a,o){if(r||(r=new Sn),ko(a))!function(t,e,n,i,r,a,o){var h=na(t,n),l=na(e,n),c=o.get(l);if(c)return void In(t,n,c);var u=a?a(h,l,n+"",t,e,o):s,d=u===s;if(d){var f=wo(l),p=!f&&Ao(l),m=!f&&!p&&Uo(l);u=l,f||p||m?wo(h)?u=h:To(h)?u=ir(h):p?(d=!1,u=Qi(l,!0)):m?(d=!1,u=tr(l,!0)):u=[]:No(l)||bo(l)?(u=h,bo(h)?u=qo(h):ko(h)&&!Io(h)||(u=jr(l))):d=!1}d&&(o.set(l,u),r(u,l,i,a,o),o.delete(l));In(t,n,u)}(t,e,o,n,yi,i,r);else{var h=i?i(na(t,o),a,o+"",t,e,r):s;h===s&&(h=a),In(t,o,h)}}),ch)}function vi(t,e){var n=t.length;if(n)return Gr(e+=e<0?n:0,n)?t[e]:s}function xi(t,e,s){e=e.length?ls(e,(function(t){return wo(t)?function(e){return Qn(e,1===t.length?t[0]:t)}:t})):[Oh];var n=-1;return e=ls(e,Cs(Br())),function(t,e){var s=t.length;for(t.sort(e);s--;)t[s]=t[s].value;return t}(pi(t,(function(t,s,i){return{criteria:ls(e,(function(e){return e(t)})),index:++n,value:t}})),(function(t,e){return function(t,e,s){var n=-1,i=t.criteria,r=e.criteria,a=i.length,o=s.length;for(;++n<a;){var h=er(i[n],r[n]);if(h)return n>=o?h:h*("desc"==s[n]?-1:1)}return t.index-e.index}(t,e,s)}))}function _i(t,e,s){for(var n=-1,i=e.length,r={};++n<i;){var a=e[n],o=Qn(t,a);s(o,a)&&Mi(r,Hi(a,t),o)}return r}function bi(t,e,s,n){var i=n?vs:ys,r=-1,a=e.length,o=t;for(t===e&&(e=ir(e)),s&&(o=ls(t,Cs(s)));++r<a;)for(var h=0,l=e[r],c=s?s(l):l;(h=i(o,c,h,n))>-1;)o!==t&&Te.call(o,h,1),Te.call(t,h,1);return t}function wi(t,e){for(var s=t?e.length:0,n=s-1;s--;){var i=e[s];if(s==n||i!==r){var r=i;Gr(i)?Te.call(t,i,1):$i(t,i)}}return t}function Ei(t,e){return t+je(Ks()*(e-t+1))}function Si(t,e){var s="";if(!t||e<1||e>D)return s;do{e%2&&(s+=t),(e=je(e/2))&&(t+=t)}while(e);return s}function Ti(t,e){return aa(ea(t,e,Oh),t+"")}function Ai(t){return An(vh(t))}function Ci(t,e){var s=vh(t);return la(s,Nn(e,0,s.length))}function Mi(t,e,n,i){if(!ko(t))return t;for(var r=-1,a=(e=Hi(e,t)).length,o=a-1,h=t;null!=h&&++r<a;){var l=pa(e[r]),c=n;if("__proto__"===l||"constructor"===l||"prototype"===l)return t;if(r!=o){var u=h[l];(c=i?i(u,l,h):s)===s&&(c=ko(u)?u:Gr(e[r+1])?[]:{})}Pn(h,l,c),h=h[l]}return t}var Ii=rn?function(t,e){return rn.set(t,e),t}:Oh,Pi=ke?function(t,e){return ke(t,"toString",{configurable:!0,enumerable:!1,value:kh(e),writable:!0})}:Oh;function Ri(t){return la(vh(t))}function ki(t,e,s){var n=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(s=s>i?i:s)<0&&(s+=i),i=e>s?0:s-e>>>0,e>>>=0;for(var r=Ot(i);++n<i;)r[n]=t[n+e];return r}function Di(t,e){var s;return Un(t,(function(t,n,i){return!(s=e(t,n,i))})),!!s}function Fi(t,e,s){var n=0,i=null==t?n:t.length;if("number"==typeof e&&e==e&&i<=L){for(;n<i;){var r=n+i>>>1,a=t[r];null!==a&&!$o(a)&&(s?a<=e:a<e)?n=r+1:i=r}return i}return Oi(t,e,Oh,s)}function Oi(t,e,n,i){var r=0,a=null==t?0:t.length;if(0===a)return 0;for(var o=(e=n(e))!=e,h=null===e,l=$o(e),c=e===s;r<a;){var u=je((r+a)/2),d=n(t[u]),f=d!==s,p=null===d,m=d==d,g=$o(d);if(o)var y=i||m;else y=c?m&&(i||f):h?m&&f&&(i||!p):l?m&&f&&!p&&(i||!g):!p&&!g&&(i?d<=e:d<e);y?r=u+1:a=u}return Gs(a,B)}function Ni(t,e){for(var s=-1,n=t.length,i=0,r=[];++s<n;){var a=t[s],o=e?e(a):a;if(!s||!vo(o,h)){var h=o;r[i++]=0===a?0:a}}return r}function Bi(t){return"number"==typeof t?t:$o(t)?O:+t}function Li(t){if("string"==typeof t)return t;if(wo(t))return ls(t,Li)+"";if($o(t))return pn?pn.call(t):"";var e=t+"";return"0"==e&&1/t==-k?"-0":e}function Vi(t,e,s){var i=-1,r=os,a=t.length,o=!0,h=[],l=h;if(s)o=!1,r=hs;else if(a>=n){var c=e?null:Sr(t);if(c)return Vs(c);o=!1,r=Is,l=new En}else l=e?[]:h;t:for(;++i<a;){var u=t[i],d=e?e(u):u;if(u=s||0!==u?u:0,o&&d==d){for(var f=l.length;f--;)if(l[f]===d)continue t;e&&l.push(d),h.push(u)}else r(l,d,s)||(l!==h&&l.push(d),h.push(u))}return h}function $i(t,e){return null==(t=sa(t,e=Hi(e,t)))||delete t[pa(Ca(e))]}function Ui(t,e,s,n){return Mi(t,e,s(Qn(t,e)),n)}function Xi(t,e,s,n){for(var i=t.length,r=n?i:-1;(n?r--:++r<i)&&e(t[r],r,t););return s?ki(t,n?0:r,n?r+1:i):ki(t,n?r+1:0,n?i:r)}function Yi(t,e){var s=t;return s instanceof xn&&(s=s.value()),us(e,(function(t,e){return e.func.apply(e.thisArg,cs([t],e.args))}),s)}function Wi(t,e,s){var n=t.length;if(n<2)return n?Vi(t[0]):[];for(var i=-1,r=Ot(n);++i<n;)for(var a=t[i],o=-1;++o<n;)o!=i&&(r[i]=$n(r[i]||a,t[o],e,s));return Vi(zn(r,1),e,s)}function ji(t,e,n){for(var i=-1,r=t.length,a=e.length,o={};++i<r;){var h=i<a?e[i]:s;n(o,t[i],h)}return o}function zi(t){return To(t)?t:[]}function Gi(t){return"function"==typeof t?t:Oh}function Hi(t,e){return wo(t)?t:qr(t,e)?[t]:fa(Ko(t))}var qi=Ti;function Ki(t,e,n){var i=t.length;return n=n===s?i:n,!e&&n>=i?t:ki(t,e,n)}var Zi=Le||function(t){return Ye.clearTimeout(t)};function Qi(t,e){if(e)return t.slice();var s=t.length,n=be?be(s):new t.constructor(s);return t.copy(n),n}function Ji(t){var e=new t.constructor(t.byteLength);return new _e(e).set(new _e(t)),e}function tr(t,e){var s=e?Ji(t.buffer):t.buffer;return new t.constructor(s,t.byteOffset,t.length)}function er(t,e){if(t!==e){var n=t!==s,i=null===t,r=t==t,a=$o(t),o=e!==s,h=null===e,l=e==e,c=$o(e);if(!h&&!c&&!a&&t>e||a&&o&&l&&!h&&!c||i&&o&&l||!n&&l||!r)return 1;if(!i&&!a&&!c&&t<e||c&&n&&r&&!i&&!a||h&&n&&r||!o&&r||!l)return-1}return 0}function sr(t,e,s,n){for(var i=-1,r=t.length,a=s.length,o=-1,h=e.length,l=zs(r-a,0),c=Ot(h+l),u=!n;++o<h;)c[o]=e[o];for(;++i<a;)(u||i<r)&&(c[s[i]]=t[i]);for(;l--;)c[o++]=t[i++];return c}function nr(t,e,s,n){for(var i=-1,r=t.length,a=-1,o=s.length,h=-1,l=e.length,c=zs(r-o,0),u=Ot(c+l),d=!n;++i<c;)u[i]=t[i];for(var f=i;++h<l;)u[f+h]=e[h];for(;++a<o;)(d||i<r)&&(u[f+s[a]]=t[i++]);return u}function ir(t,e){var s=-1,n=t.length;for(e||(e=Ot(n));++s<n;)e[s]=t[s];return e}function rr(t,e,n,i){var r=!n;n||(n={});for(var a=-1,o=e.length;++a<o;){var h=e[a],l=i?i(n[h],t[h],h,n,t):s;l===s&&(l=t[h]),r?Fn(n,h,l):Pn(n,h,l)}return n}function ar(t,e){return function(s,n){var i=wo(s)?ss:kn,r=e?e():{};return i(s,t,Br(n,2),r)}}function or(t){return Ti((function(e,n){var i=-1,r=n.length,a=r>1?n[r-1]:s,o=r>2?n[2]:s;for(a=t.length>3&&"function"==typeof a?(r--,a):s,o&&Hr(n[0],n[1],o)&&(a=r<3?s:a,r=1),e=se(e);++i<r;){var h=n[i];h&&t(e,h,i,a)}return e}))}function hr(t,e){return function(s,n){if(null==s)return s;if(!So(s))return t(s,n);for(var i=s.length,r=e?i:-1,a=se(s);(e?r--:++r<i)&&!1!==n(a[r],r,a););return s}}function lr(t){return function(e,s,n){for(var i=-1,r=se(e),a=n(e),o=a.length;o--;){var h=a[t?o:++i];if(!1===s(r[h],h,r))break}return e}}function cr(t){return function(e){var n=Os(e=Ko(e))?Us(e):s,i=n?n[0]:e.charAt(0),r=n?Ki(n,1).join(""):e.slice(1);return i[t]()+r}}function ur(t){return function(e){return us(Ih(bh(e).replace(Me,"")),t,"")}}function dr(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var s=gn(t.prototype),n=t.apply(s,e);return ko(n)?n:s}}function fr(t){return function(e,n,i){var r=se(e);if(!So(e)){var a=Br(n,3);e=lh(e),n=function(t){return a(r[t],t,r)}}var o=t(e,n,i);return o>-1?r[a?e[o]:o]:s}}function pr(t){return Rr((function(e){var n=e.length,i=n,a=vn.prototype.thru;for(t&&e.reverse();i--;){var o=e[i];if("function"!=typeof o)throw new re(r);if(a&&!h&&"wrapper"==Or(o))var h=new vn([],!0)}for(i=h?i:n;++i<n;){var l=Or(o=e[i]),c="wrapper"==l?Fr(o):s;h=c&&Kr(c[0])&&c[1]==(E|x|b|S)&&!c[4].length&&1==c[9]?h[Or(c[0])].apply(h,c[3]):1==o.length&&Kr(o)?h[l]():h.thru(o)}return function(){var t=arguments,s=t[0];if(h&&1==t.length&&wo(s))return h.plant(s).value();for(var i=0,r=n?e[i].apply(this,t):s;++i<n;)r=e[i].call(this,r);return r}}))}function mr(t,e,n,i,r,a,o,h,l,c){var u=e&E,d=e&g,f=e&y,p=e&(x|_),m=e&T,v=f?s:dr(t);return function g(){for(var y=arguments.length,x=Ot(y),_=y;_--;)x[_]=arguments[_];if(p)var b=Nr(g),w=function(t,e){for(var s=t.length,n=0;s--;)t[s]===e&&++n;return n}(x,b);if(i&&(x=sr(x,i,r,p)),a&&(x=nr(x,a,o,p)),y-=w,p&&y<c){var E=Ls(x,b);return wr(t,e,mr,g.placeholder,n,x,E,h,l,c-y)}var S=d?n:this,T=f?S[t]:t;return y=x.length,h?x=function(t,e){var n=t.length,i=Gs(e.length,n),r=ir(t);for(;i--;){var a=e[i];t[i]=Gr(a,n)?r[a]:s}return t}(x,h):m&&y>1&&x.reverse(),u&&l<y&&(x.length=l),this&&this!==Ye&&this instanceof g&&(T=v||dr(T)),T.apply(S,x)}}function gr(t,e){return function(s,n){return function(t,e,s,n){return qn(t,(function(t,i,r){e(n,s(t),i,r)})),n}(s,t,e(n),{})}}function yr(t,e){return function(n,i){var r;if(n===s&&i===s)return e;if(n!==s&&(r=n),i!==s){if(r===s)return i;"string"==typeof n||"string"==typeof i?(n=Li(n),i=Li(i)):(n=Bi(n),i=Bi(i)),r=t(n,i)}return r}}function vr(t){return Rr((function(e){return e=ls(e,Cs(Br())),Ti((function(s){var n=this;return t(e,(function(t){return es(t,n,s)}))}))}))}function xr(t,e){var n=(e=e===s?" ":Li(e)).length;if(n<2)return n?Si(e,t):e;var i=Si(e,We(t/$s(e)));return Os(e)?Ki(Us(i),0,t).join(""):i.slice(0,t)}function _r(t){return function(e,n,i){return i&&"number"!=typeof i&&Hr(e,n,i)&&(n=i=s),e=jo(e),n===s?(n=e,e=0):n=jo(n),function(t,e,s,n){for(var i=-1,r=zs(We((e-t)/(s||1)),0),a=Ot(r);r--;)a[n?r:++i]=t,t+=s;return a}(e,n,i=i===s?e<n?1:-1:jo(i),t)}}function br(t){return function(e,s){return"string"==typeof e&&"string"==typeof s||(e=Ho(e),s=Ho(s)),t(e,s)}}function wr(t,e,n,i,r,a,o,h,l,c){var u=e&x;e|=u?b:w,(e&=~(u?w:b))&v||(e&=~(g|y));var d=[t,e,r,u?a:s,u?o:s,u?s:a,u?s:o,h,l,c],f=n.apply(s,d);return Kr(t)&&ia(f,d),f.placeholder=i,oa(f,t,e)}function Er(t){var e=ee[t];return function(t,s){if(t=Ho(t),(s=null==s?0:Gs(zo(s),292))&&ps(t)){var n=(Ko(t)+"e").split("e");return+((n=(Ko(e(n[0]+"e"+(+n[1]+s)))+"e").split("e"))[0]+"e"+(+n[1]-s))}return e(t)}}var Sr=en&&1/Vs(new en([,-0]))[1]==k?function(t){return new en(t)}:$h;function Tr(t){return function(e){var s=Yr(e);return s==q?Ns(e):s==st?function(t){var e=-1,s=Array(t.size);return t.forEach((function(t){s[++e]=[t,t]})),s}(e):function(t,e){return ls(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function Ar(t,e,n,i,a,o,h,c){var u=e&y;if(!u&&"function"!=typeof t)throw new re(r);var d=i?i.length:0;if(d||(e&=~(b|w),i=a=s),h=h===s?h:zs(zo(h),0),c=c===s?c:zo(c),d-=a?a.length:0,e&w){var f=i,p=a;i=a=s}var m=u?s:Fr(t),T=[t,e,n,i,a,f,p,o,h,c];if(m&&function(t,e){var s=t[1],n=e[1],i=s|n,r=i<(g|y|E),a=n==E&&s==x||n==E&&s==S&&t[7].length<=e[8]||n==(E|S)&&e[7].length<=e[8]&&s==x;if(!r&&!a)return t;n&g&&(t[2]=e[2],i|=s&g?0:v);var o=e[3];if(o){var h=t[3];t[3]=h?sr(h,o,e[4]):o,t[4]=h?Ls(t[3],l):e[4]}(o=e[5])&&(h=t[5],t[5]=h?nr(h,o,e[6]):o,t[6]=h?Ls(t[5],l):e[6]);(o=e[7])&&(t[7]=o);n&E&&(t[8]=null==t[8]?e[8]:Gs(t[8],e[8]));null==t[9]&&(t[9]=e[9]);t[0]=e[0],t[1]=i}(T,m),t=T[0],e=T[1],n=T[2],i=T[3],a=T[4],!(c=T[9]=T[9]===s?u?0:t.length:zs(T[9]-d,0))&&e&(x|_)&&(e&=~(x|_)),e&&e!=g)A=e==x||e==_?function(t,e,n){var i=dr(t);return function r(){for(var a=arguments.length,o=Ot(a),h=a,l=Nr(r);h--;)o[h]=arguments[h];var c=a<3&&o[0]!==l&&o[a-1]!==l?[]:Ls(o,l);return(a-=c.length)<n?wr(t,e,mr,r.placeholder,s,o,c,s,s,n-a):es(this&&this!==Ye&&this instanceof r?i:t,this,o)}}(t,e,c):e!=b&&e!=(g|b)||a.length?mr.apply(s,T):function(t,e,s,n){var i=e&g,r=dr(t);return function e(){for(var a=-1,o=arguments.length,h=-1,l=n.length,c=Ot(l+o),u=this&&this!==Ye&&this instanceof e?r:t;++h<l;)c[h]=n[h];for(;o--;)c[h++]=arguments[++a];return es(u,i?s:this,c)}}(t,e,n,i);else var A=function(t,e,s){var n=e&g,i=dr(t);return function e(){return(this&&this!==Ye&&this instanceof e?i:t).apply(n?s:this,arguments)}}(t,e,n);return oa((m?Ii:ia)(A,T),t,e)}function Cr(t,e,n,i){return t===s||vo(t,he[n])&&!ue.call(i,n)?e:t}function Mr(t,e,n,i,r,a){return ko(t)&&ko(e)&&(a.set(e,t),yi(t,e,s,Mr,a),a.delete(e)),t}function Ir(t){return No(t)?s:t}function Pr(t,e,n,i,r,a){var o=n&f,h=t.length,l=e.length;if(h!=l&&!(o&&l>h))return!1;var c=a.get(t),u=a.get(e);if(c&&u)return c==e&&u==t;var d=-1,m=!0,g=n&p?new En:s;for(a.set(t,e),a.set(e,t);++d<h;){var y=t[d],v=e[d];if(i)var x=o?i(v,y,d,e,t,a):i(y,v,d,t,e,a);if(x!==s){if(x)continue;m=!1;break}if(g){if(!fs(e,(function(t,e){if(!Is(g,e)&&(y===t||r(y,t,n,i,a)))return g.push(e)}))){m=!1;break}}else if(y!==v&&!r(y,v,n,i,a)){m=!1;break}}return a.delete(t),a.delete(e),m}function Rr(t){return aa(ea(t,s,wa),t+"")}function kr(t){return Jn(t,lh,Ur)}function Dr(t){return Jn(t,ch,Xr)}var Fr=rn?function(t){return rn.get(t)}:$h;function Or(t){for(var e=t.name+"",s=an[e],n=ue.call(an,e)?s.length:0;n--;){var i=s[n],r=i.func;if(null==r||r==t)return i.name}return e}function Nr(t){return(ue.call(mn,"placeholder")?mn:t).placeholder}function Br(){var t=mn.iteratee||Nh;return t=t===Nh?ci:t,arguments.length?t(arguments[0],arguments[1]):t}function Lr(t,e){var s,n,i=t.__data__;return("string"==(n=typeof(s=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==s:null===s)?i["string"==typeof e?"string":"hash"]:i.map}function Vr(t){for(var e=lh(t),s=e.length;s--;){var n=e[s],i=t[n];e[s]=[n,i,Jr(i)]}return e}function $r(t,e){var n=function(t,e){return null==t?s:t[e]}(t,e);return li(n)?n:s}var Ur=Ge?function(t){return null==t?[]:(t=se(t),as(Ge(t),(function(e){return Se.call(t,e)})))}:Gh,Xr=Ge?function(t){for(var e=[];t;)cs(e,Ur(t)),t=we(t);return e}:Gh,Yr=ti;function Wr(t,e,s){for(var n=-1,i=(e=Hi(e,t)).length,r=!1;++n<i;){var a=pa(e[n]);if(!(r=null!=t&&s(t,a)))break;t=t[a]}return r||++n!=i?r:!!(i=null==t?0:t.length)&&Ro(i)&&Gr(a,i)&&(wo(t)||bo(t))}function jr(t){return"function"!=typeof t.constructor||Qr(t)?{}:gn(we(t))}function zr(t){return wo(t)||bo(t)||!!(Ae&&t&&t[Ae])}function Gr(t,e){var s=typeof t;return!!(e=null==e?D:e)&&("number"==s||"symbol"!=s&&Ht.test(t))&&t>-1&&t%1==0&&t<e}function Hr(t,e,s){if(!ko(s))return!1;var n=typeof e;return!!("number"==n?So(s)&&Gr(e,s.length):"string"==n&&e in s)&&vo(s[e],t)}function qr(t,e){if(wo(t))return!1;var s=typeof t;return!("number"!=s&&"symbol"!=s&&"boolean"!=s&&null!=t&&!$o(t))||(Pt.test(t)||!It.test(t)||null!=e&&t in se(e))}function Kr(t){var e=Or(t),s=mn[e];if("function"!=typeof s||!(e in xn.prototype))return!1;if(t===s)return!0;var n=Fr(s);return!!n&&t===n[0]}(Qs&&Yr(new Qs(new ArrayBuffer(1)))!=lt||Js&&Yr(new Js)!=q||tn&&Yr(tn.resolve())!=J||en&&Yr(new en)!=st||sn&&Yr(new sn)!=at)&&(Yr=function(t){var e=ti(t),n=e==Q?t.constructor:s,i=n?ma(n):"";if(i)switch(i){case on:return lt;case hn:return q;case ln:return J;case cn:return st;case un:return at}return e});var Zr=le?Io:Hh;function Qr(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||he)}function Jr(t){return t==t&&!ko(t)}function ta(t,e){return function(n){return null!=n&&(n[t]===e&&(e!==s||t in se(n)))}}function ea(t,e,n){return e=zs(e===s?t.length-1:e,0),function(){for(var s=arguments,i=-1,r=zs(s.length-e,0),a=Ot(r);++i<r;)a[i]=s[e+i];i=-1;for(var o=Ot(e+1);++i<e;)o[i]=s[i];return o[e]=n(a),es(t,this,o)}}function sa(t,e){return e.length<2?t:Qn(t,ki(e,0,-1))}function na(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var ia=ha(Ii),ra=Xe||function(t,e){return Ye.setTimeout(t,e)},aa=ha(Pi);function oa(t,e,s){var n=e+"";return aa(t,function(t,e){var s=e.length;if(!s)return t;var n=s-1;return e[n]=(s>1?"& ":"")+e[n],e=e.join(s>2?", ":" "),t.replace(Nt,"{\n/* [wrapped with "+e+"] */\n")}(n,function(t,e){return ns(V,(function(s){var n="_."+s[0];e&s[1]&&!os(t,n)&&t.push(n)})),t.sort()}(function(t){var e=t.match(Bt);return e?e[1].split(Lt):[]}(n),s)))}function ha(t){var e=0,n=0;return function(){var i=Hs(),r=I-(i-n);if(n=i,r>0){if(++e>=M)return arguments[0]}else e=0;return t.apply(s,arguments)}}function la(t,e){var n=-1,i=t.length,r=i-1;for(e=e===s?i:e;++n<e;){var a=Ei(n,r),o=t[a];t[a]=t[n],t[n]=o}return t.length=e,t}var ca,ua,da,fa=(ca=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Rt,(function(t,s,n,i){e.push(n?i.replace(Ut,"$1"):s||t)})),e},ua=uo(ca,(function(t){return da.size===h&&da.clear(),t})),da=ua.cache,ua);function pa(t){if("string"==typeof t||$o(t))return t;var e=t+"";return"0"==e&&1/t==-k?"-0":e}function ma(t){if(null!=t){try{return ce.call(t)}catch(jp){}try{return t+""}catch(jp){}}return""}function ga(t){if(t instanceof xn)return t.clone();var e=new vn(t.__wrapped__,t.__chain__);return e.__actions__=ir(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var ya=Ti((function(t,e){return To(t)?$n(t,zn(e,1,To,!0)):[]})),va=Ti((function(t,e){var n=Ca(e);return To(n)&&(n=s),To(t)?$n(t,zn(e,1,To,!0),Br(n,2)):[]})),xa=Ti((function(t,e){var n=Ca(e);return To(n)&&(n=s),To(t)?$n(t,zn(e,1,To,!0),s,n):[]}));function _a(t,e,s){var n=null==t?0:t.length;if(!n)return-1;var i=null==s?0:zo(s);return i<0&&(i=zs(n+i,0)),gs(t,Br(e,3),i)}function ba(t,e,n){var i=null==t?0:t.length;if(!i)return-1;var r=i-1;return n!==s&&(r=zo(n),r=n<0?zs(i+r,0):Gs(r,i-1)),gs(t,Br(e,3),r,!0)}function wa(t){return(null==t?0:t.length)?zn(t,1):[]}function Ea(t){return t&&t.length?t[0]:s}var Sa=Ti((function(t){var e=ls(t,zi);return e.length&&e[0]===t[0]?ii(e):[]})),Ta=Ti((function(t){var e=Ca(t),n=ls(t,zi);return e===Ca(n)?e=s:n.pop(),n.length&&n[0]===t[0]?ii(n,Br(e,2)):[]})),Aa=Ti((function(t){var e=Ca(t),n=ls(t,zi);return(e="function"==typeof e?e:s)&&n.pop(),n.length&&n[0]===t[0]?ii(n,s,e):[]}));function Ca(t){var e=null==t?0:t.length;return e?t[e-1]:s}var Ma=Ti(Ia);function Ia(t,e){return t&&t.length&&e&&e.length?bi(t,e):t}var Pa=Rr((function(t,e){var s=null==t?0:t.length,n=On(t,e);return wi(t,ls(e,(function(t){return Gr(t,s)?+t:t})).sort(er)),n}));function Ra(t){return null==t?t:Zs.call(t)}var ka=Ti((function(t){return Vi(zn(t,1,To,!0))})),Da=Ti((function(t){var e=Ca(t);return To(e)&&(e=s),Vi(zn(t,1,To,!0),Br(e,2))})),Fa=Ti((function(t){var e=Ca(t);return e="function"==typeof e?e:s,Vi(zn(t,1,To,!0),s,e)}));function Oa(t){if(!t||!t.length)return[];var e=0;return t=as(t,(function(t){if(To(t))return e=zs(t.length,e),!0})),Ts(e,(function(e){return ls(t,bs(e))}))}function Na(t,e){if(!t||!t.length)return[];var n=Oa(t);return null==e?n:ls(n,(function(t){return es(e,s,t)}))}var Ba=Ti((function(t,e){return To(t)?$n(t,e):[]})),La=Ti((function(t){return Wi(as(t,To))})),Va=Ti((function(t){var e=Ca(t);return To(e)&&(e=s),Wi(as(t,To),Br(e,2))})),$a=Ti((function(t){var e=Ca(t);return e="function"==typeof e?e:s,Wi(as(t,To),s,e)})),Ua=Ti(Oa);var Xa=Ti((function(t){var e=t.length,n=e>1?t[e-1]:s;return n="function"==typeof n?(t.pop(),n):s,Na(t,n)}));function Ya(t){var e=mn(t);return e.__chain__=!0,e}function Wa(t,e){return e(t)}var ja=Rr((function(t){var e=t.length,n=e?t[0]:0,i=this.__wrapped__,r=function(e){return On(e,t)};return!(e>1||this.__actions__.length)&&i instanceof xn&&Gr(n)?((i=i.slice(n,+n+(e?1:0))).__actions__.push({func:Wa,args:[r],thisArg:s}),new vn(i,this.__chain__).thru((function(t){return e&&!t.length&&t.push(s),t}))):this.thru(r)}));var za=ar((function(t,e,s){ue.call(t,s)?++t[s]:Fn(t,s,1)}));var Ga=fr(_a),Ha=fr(ba);function qa(t,e){return(wo(t)?ns:Un)(t,Br(e,3))}function Ka(t,e){return(wo(t)?is:Xn)(t,Br(e,3))}var Za=ar((function(t,e,s){ue.call(t,s)?t[s].push(e):Fn(t,s,[e])}));var Qa=Ti((function(t,e,s){var n=-1,i="function"==typeof e,r=So(t)?Ot(t.length):[];return Un(t,(function(t){r[++n]=i?es(e,t,s):ri(t,e,s)})),r})),Ja=ar((function(t,e,s){Fn(t,s,e)}));function to(t,e){return(wo(t)?ls:pi)(t,Br(e,3))}var eo=ar((function(t,e,s){t[s?0:1].push(e)}),(function(){return[[],[]]}));var so=Ti((function(t,e){if(null==t)return[];var s=e.length;return s>1&&Hr(t,e[0],e[1])?e=[]:s>2&&Hr(e[0],e[1],e[2])&&(e=[e[0]]),xi(t,zn(e,1),[])})),no=Ue||function(){return Ye.Date.now()};function io(t,e,n){return e=n?s:e,e=t&&null==e?t.length:e,Ar(t,E,s,s,s,s,e)}function ro(t,e){var n;if("function"!=typeof e)throw new re(r);return t=zo(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=s),n}}var ao=Ti((function(t,e,s){var n=g;if(s.length){var i=Ls(s,Nr(ao));n|=b}return Ar(t,n,e,s,i)})),oo=Ti((function(t,e,s){var n=g|y;if(s.length){var i=Ls(s,Nr(oo));n|=b}return Ar(e,n,t,s,i)}));function ho(t,e,n){var i,a,o,h,l,c,u=0,d=!1,f=!1,p=!0;if("function"!=typeof t)throw new re(r);function m(e){var n=i,r=a;return i=a=s,u=e,h=t.apply(r,n)}function g(t){var n=t-c;return c===s||n>=e||n<0||f&&t-u>=o}function y(){var t=no();if(g(t))return v(t);l=ra(y,function(t){var s=e-(t-c);return f?Gs(s,o-(t-u)):s}(t))}function v(t){return l=s,p&&i?m(t):(i=a=s,h)}function x(){var t=no(),n=g(t);if(i=arguments,a=this,c=t,n){if(l===s)return function(t){return u=t,l=ra(y,e),d?m(t):h}(c);if(f)return Zi(l),l=ra(y,e),m(c)}return l===s&&(l=ra(y,e)),h}return e=Ho(e)||0,ko(n)&&(d=!!n.leading,o=(f="maxWait"in n)?zs(Ho(n.maxWait)||0,e):o,p="trailing"in n?!!n.trailing:p),x.cancel=function(){l!==s&&Zi(l),u=0,i=c=a=l=s},x.flush=function(){return l===s?h:v(no())},x}var lo=Ti((function(t,e){return Vn(t,1,e)})),co=Ti((function(t,e,s){return Vn(t,Ho(e)||0,s)}));function uo(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new re(r);var s=function(){var n=arguments,i=e?e.apply(this,n):n[0],r=s.cache;if(r.has(i))return r.get(i);var a=t.apply(this,n);return s.cache=r.set(i,a)||r,a};return s.cache=new(uo.Cache||wn),s}function fo(t){if("function"!=typeof t)throw new re(r);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}uo.Cache=wn;var po=qi((function(t,e){var s=(e=1==e.length&&wo(e[0])?ls(e[0],Cs(Br())):ls(zn(e,1),Cs(Br()))).length;return Ti((function(n){for(var i=-1,r=Gs(n.length,s);++i<r;)n[i]=e[i].call(this,n[i]);return es(t,this,n)}))})),mo=Ti((function(t,e){var n=Ls(e,Nr(mo));return Ar(t,b,s,e,n)})),go=Ti((function(t,e){var n=Ls(e,Nr(go));return Ar(t,w,s,e,n)})),yo=Rr((function(t,e){return Ar(t,S,s,s,s,e)}));function vo(t,e){return t===e||t!=t&&e!=e}var xo=br(ei),_o=br((function(t,e){return t>=e})),bo=ai(function(){return arguments}())?ai:function(t){return Do(t)&&ue.call(t,"callee")&&!Se.call(t,"callee")},wo=Ot.isArray,Eo=qe?Cs(qe):function(t){return Do(t)&&ti(t)==ht};function So(t){return null!=t&&Ro(t.length)&&!Io(t)}function To(t){return Do(t)&&So(t)}var Ao=He||Hh,Co=Ke?Cs(Ke):function(t){return Do(t)&&ti(t)==W};function Mo(t){if(!Do(t))return!1;var e=ti(t);return e==z||e==j||"string"==typeof t.message&&"string"==typeof t.name&&!No(t)}function Io(t){if(!ko(t))return!1;var e=ti(t);return e==G||e==H||e==X||e==tt}function Po(t){return"number"==typeof t&&t==zo(t)}function Ro(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=D}function ko(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Do(t){return null!=t&&"object"==typeof t}var Fo=Ze?Cs(Ze):function(t){return Do(t)&&Yr(t)==q};function Oo(t){return"number"==typeof t||Do(t)&&ti(t)==K}function No(t){if(!Do(t)||ti(t)!=Q)return!1;var e=we(t);if(null===e)return!0;var s=ue.call(e,"constructor")&&e.constructor;return"function"==typeof s&&s instanceof s&&ce.call(s)==me}var Bo=Qe?Cs(Qe):function(t){return Do(t)&&ti(t)==et};var Lo=Je?Cs(Je):function(t){return Do(t)&&Yr(t)==st};function Vo(t){return"string"==typeof t||!wo(t)&&Do(t)&&ti(t)==nt}function $o(t){return"symbol"==typeof t||Do(t)&&ti(t)==it}var Uo=ts?Cs(ts):function(t){return Do(t)&&Ro(t.length)&&!!Ne[ti(t)]};var Xo=br(fi),Yo=br((function(t,e){return t<=e}));function Wo(t){if(!t)return[];if(So(t))return Vo(t)?Us(t):ir(t);if(Ce&&t[Ce])return function(t){for(var e,s=[];!(e=t.next()).done;)s.push(e.value);return s}(t[Ce]());var e=Yr(t);return(e==q?Ns:e==st?Vs:vh)(t)}function jo(t){return t?(t=Ho(t))===k||t===-k?(t<0?-1:1)*F:t==t?t:0:0===t?t:0}function zo(t){var e=jo(t),s=e%1;return e==e?s?e-s:e:0}function Go(t){return t?Nn(zo(t),0,N):0}function Ho(t){if("number"==typeof t)return t;if($o(t))return O;if(ko(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=ko(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=As(t);var s=jt.test(t);return s||Gt.test(t)?$e(t.slice(2),s?2:8):Wt.test(t)?O:+t}function qo(t){return rr(t,ch(t))}function Ko(t){return null==t?"":Li(t)}var Zo=or((function(t,e){if(Qr(e)||So(e))rr(e,lh(e),t);else for(var s in e)ue.call(e,s)&&Pn(t,s,e[s])})),Qo=or((function(t,e){rr(e,ch(e),t)})),Jo=or((function(t,e,s,n){rr(e,ch(e),t,n)})),th=or((function(t,e,s,n){rr(e,lh(e),t,n)})),eh=Rr(On);var sh=Ti((function(t,e){t=se(t);var n=-1,i=e.length,r=i>2?e[2]:s;for(r&&Hr(e[0],e[1],r)&&(i=1);++n<i;)for(var a=e[n],o=ch(a),h=-1,l=o.length;++h<l;){var c=o[h],u=t[c];(u===s||vo(u,he[c])&&!ue.call(t,c))&&(t[c]=a[c])}return t})),nh=Ti((function(t){return t.push(s,Mr),es(dh,s,t)}));function ih(t,e,n){var i=null==t?s:Qn(t,e);return i===s?n:i}function rh(t,e){return null!=t&&Wr(t,e,ni)}var ah=gr((function(t,e,s){null!=e&&"function"!=typeof e.toString&&(e=pe.call(e)),t[e]=s}),kh(Oh)),oh=gr((function(t,e,s){null!=e&&"function"!=typeof e.toString&&(e=pe.call(e)),ue.call(t,e)?t[e].push(s):t[e]=[s]}),Br),hh=Ti(ri);function lh(t){return So(t)?Tn(t):ui(t)}function ch(t){return So(t)?Tn(t,!0):di(t)}var uh=or((function(t,e,s){yi(t,e,s)})),dh=or((function(t,e,s,n){yi(t,e,s,n)})),fh=Rr((function(t,e){var s={};if(null==t)return s;var n=!1;e=ls(e,(function(e){return e=Hi(e,t),n||(n=e.length>1),e})),rr(t,Dr(t),s),n&&(s=Bn(s,c|u|d,Ir));for(var i=e.length;i--;)$i(s,e[i]);return s}));var ph=Rr((function(t,e){return null==t?{}:function(t,e){return _i(t,e,(function(e,s){return rh(t,s)}))}(t,e)}));function mh(t,e){if(null==t)return{};var s=ls(Dr(t),(function(t){return[t]}));return e=Br(e),_i(t,s,(function(t,s){return e(t,s[0])}))}var gh=Tr(lh),yh=Tr(ch);function vh(t){return null==t?[]:Ms(t,lh(t))}var xh=ur((function(t,e,s){return e=e.toLowerCase(),t+(s?_h(e):e)}));function _h(t){return Mh(Ko(t).toLowerCase())}function bh(t){return(t=Ko(t))&&t.replace(qt,ks).replace(Ie,"")}var wh=ur((function(t,e,s){return t+(s?"-":"")+e.toLowerCase()})),Eh=ur((function(t,e,s){return t+(s?" ":"")+e.toLowerCase()})),Sh=cr("toLowerCase");var Th=ur((function(t,e,s){return t+(s?"_":"")+e.toLowerCase()}));var Ah=ur((function(t,e,s){return t+(s?" ":"")+Mh(e)}));var Ch=ur((function(t,e,s){return t+(s?" ":"")+e.toUpperCase()})),Mh=cr("toUpperCase");function Ih(t,e,n){return t=Ko(t),(e=n?s:e)===s?function(t){return De.test(t)}(t)?function(t){return t.match(Re)||[]}(t):function(t){return t.match(Vt)||[]}(t):t.match(e)||[]}var Ph=Ti((function(t,e){try{return es(t,s,e)}catch(jp){return Mo(jp)?jp:new Jt(jp)}})),Rh=Rr((function(t,e){return ns(e,(function(e){e=pa(e),Fn(t,e,ao(t[e],t))})),t}));function kh(t){return function(){return t}}var Dh=pr(),Fh=pr(!0);function Oh(t){return t}function Nh(t){return ci("function"==typeof t?t:Bn(t,c))}var Bh=Ti((function(t,e){return function(s){return ri(s,t,e)}})),Lh=Ti((function(t,e){return function(s){return ri(t,s,e)}}));function Vh(t,e,s){var n=lh(e),i=Zn(e,n);null!=s||ko(e)&&(i.length||!n.length)||(s=e,e=t,t=this,i=Zn(e,lh(e)));var r=!(ko(s)&&"chain"in s&&!s.chain),a=Io(t);return ns(i,(function(s){var n=e[s];t[s]=n,a&&(t.prototype[s]=function(){var e=this.__chain__;if(r||e){var s=t(this.__wrapped__);return(s.__actions__=ir(this.__actions__)).push({func:n,args:arguments,thisArg:t}),s.__chain__=e,s}return n.apply(t,cs([this.value()],arguments))})})),t}function $h(){}var Uh=vr(ls),Xh=vr(rs),Yh=vr(fs);function Wh(t){return qr(t)?bs(pa(t)):function(t){return function(e){return Qn(e,t)}}(t)}var jh=_r(),zh=_r(!0);function Gh(){return[]}function Hh(){return!1}var qh=yr((function(t,e){return t+e}),0),Kh=Er("ceil"),Zh=yr((function(t,e){return t/e}),1),Qh=Er("floor");var Jh,tl=yr((function(t,e){return t*e}),1),el=Er("round"),sl=yr((function(t,e){return t-e}),0);return mn.after=function(t,e){if("function"!=typeof e)throw new re(r);return t=zo(t),function(){if(--t<1)return e.apply(this,arguments)}},mn.ary=io,mn.assign=Zo,mn.assignIn=Qo,mn.assignInWith=Jo,mn.assignWith=th,mn.at=eh,mn.before=ro,mn.bind=ao,mn.bindAll=Rh,mn.bindKey=oo,mn.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return wo(t)?t:[t]},mn.chain=Ya,mn.chunk=function(t,e,n){e=(n?Hr(t,e,n):e===s)?1:zs(zo(e),0);var i=null==t?0:t.length;if(!i||e<1)return[];for(var r=0,a=0,o=Ot(We(i/e));r<i;)o[a++]=ki(t,r,r+=e);return o},mn.compact=function(t){for(var e=-1,s=null==t?0:t.length,n=0,i=[];++e<s;){var r=t[e];r&&(i[n++]=r)}return i},mn.concat=function(){var t=arguments.length;if(!t)return[];for(var e=Ot(t-1),s=arguments[0],n=t;n--;)e[n-1]=arguments[n];return cs(wo(s)?ir(s):[s],zn(e,1))},mn.cond=function(t){var e=null==t?0:t.length,s=Br();return t=e?ls(t,(function(t){if("function"!=typeof t[1])throw new re(r);return[s(t[0]),t[1]]})):[],Ti((function(s){for(var n=-1;++n<e;){var i=t[n];if(es(i[0],this,s))return es(i[1],this,s)}}))},mn.conforms=function(t){return function(t){var e=lh(t);return function(s){return Ln(s,t,e)}}(Bn(t,c))},mn.constant=kh,mn.countBy=za,mn.create=function(t,e){var s=gn(t);return null==e?s:Dn(s,e)},mn.curry=function t(e,n,i){var r=Ar(e,x,s,s,s,s,s,n=i?s:n);return r.placeholder=t.placeholder,r},mn.curryRight=function t(e,n,i){var r=Ar(e,_,s,s,s,s,s,n=i?s:n);return r.placeholder=t.placeholder,r},mn.debounce=ho,mn.defaults=sh,mn.defaultsDeep=nh,mn.defer=lo,mn.delay=co,mn.difference=ya,mn.differenceBy=va,mn.differenceWith=xa,mn.drop=function(t,e,n){var i=null==t?0:t.length;return i?ki(t,(e=n||e===s?1:zo(e))<0?0:e,i):[]},mn.dropRight=function(t,e,n){var i=null==t?0:t.length;return i?ki(t,0,(e=i-(e=n||e===s?1:zo(e)))<0?0:e):[]},mn.dropRightWhile=function(t,e){return t&&t.length?Xi(t,Br(e,3),!0,!0):[]},mn.dropWhile=function(t,e){return t&&t.length?Xi(t,Br(e,3),!0):[]},mn.fill=function(t,e,n,i){var r=null==t?0:t.length;return r?(n&&"number"!=typeof n&&Hr(t,e,n)&&(n=0,i=r),function(t,e,n,i){var r=t.length;for((n=zo(n))<0&&(n=-n>r?0:r+n),(i=i===s||i>r?r:zo(i))<0&&(i+=r),i=n>i?0:Go(i);n<i;)t[n++]=e;return t}(t,e,n,i)):[]},mn.filter=function(t,e){return(wo(t)?as:jn)(t,Br(e,3))},mn.flatMap=function(t,e){return zn(to(t,e),1)},mn.flatMapDeep=function(t,e){return zn(to(t,e),k)},mn.flatMapDepth=function(t,e,n){return n=n===s?1:zo(n),zn(to(t,e),n)},mn.flatten=wa,mn.flattenDeep=function(t){return(null==t?0:t.length)?zn(t,k):[]},mn.flattenDepth=function(t,e){return(null==t?0:t.length)?zn(t,e=e===s?1:zo(e)):[]},mn.flip=function(t){return Ar(t,T)},mn.flow=Dh,mn.flowRight=Fh,mn.fromPairs=function(t){for(var e=-1,s=null==t?0:t.length,n={};++e<s;){var i=t[e];n[i[0]]=i[1]}return n},mn.functions=function(t){return null==t?[]:Zn(t,lh(t))},mn.functionsIn=function(t){return null==t?[]:Zn(t,ch(t))},mn.groupBy=Za,mn.initial=function(t){return(null==t?0:t.length)?ki(t,0,-1):[]},mn.intersection=Sa,mn.intersectionBy=Ta,mn.intersectionWith=Aa,mn.invert=ah,mn.invertBy=oh,mn.invokeMap=Qa,mn.iteratee=Nh,mn.keyBy=Ja,mn.keys=lh,mn.keysIn=ch,mn.map=to,mn.mapKeys=function(t,e){var s={};return e=Br(e,3),qn(t,(function(t,n,i){Fn(s,e(t,n,i),t)})),s},mn.mapValues=function(t,e){var s={};return e=Br(e,3),qn(t,(function(t,n,i){Fn(s,n,e(t,n,i))})),s},mn.matches=function(t){return mi(Bn(t,c))},mn.matchesProperty=function(t,e){return gi(t,Bn(e,c))},mn.memoize=uo,mn.merge=uh,mn.mergeWith=dh,mn.method=Bh,mn.methodOf=Lh,mn.mixin=Vh,mn.negate=fo,mn.nthArg=function(t){return t=zo(t),Ti((function(e){return vi(e,t)}))},mn.omit=fh,mn.omitBy=function(t,e){return mh(t,fo(Br(e)))},mn.once=function(t){return ro(2,t)},mn.orderBy=function(t,e,n,i){return null==t?[]:(wo(e)||(e=null==e?[]:[e]),wo(n=i?s:n)||(n=null==n?[]:[n]),xi(t,e,n))},mn.over=Uh,mn.overArgs=po,mn.overEvery=Xh,mn.overSome=Yh,mn.partial=mo,mn.partialRight=go,mn.partition=eo,mn.pick=ph,mn.pickBy=mh,mn.property=Wh,mn.propertyOf=function(t){return function(e){return null==t?s:Qn(t,e)}},mn.pull=Ma,mn.pullAll=Ia,mn.pullAllBy=function(t,e,s){return t&&t.length&&e&&e.length?bi(t,e,Br(s,2)):t},mn.pullAllWith=function(t,e,n){return t&&t.length&&e&&e.length?bi(t,e,s,n):t},mn.pullAt=Pa,mn.range=jh,mn.rangeRight=zh,mn.rearg=yo,mn.reject=function(t,e){return(wo(t)?as:jn)(t,fo(Br(e,3)))},mn.remove=function(t,e){var s=[];if(!t||!t.length)return s;var n=-1,i=[],r=t.length;for(e=Br(e,3);++n<r;){var a=t[n];e(a,n,t)&&(s.push(a),i.push(n))}return wi(t,i),s},mn.rest=function(t,e){if("function"!=typeof t)throw new re(r);return Ti(t,e=e===s?e:zo(e))},mn.reverse=Ra,mn.sampleSize=function(t,e,n){return e=(n?Hr(t,e,n):e===s)?1:zo(e),(wo(t)?Cn:Ci)(t,e)},mn.set=function(t,e,s){return null==t?t:Mi(t,e,s)},mn.setWith=function(t,e,n,i){return i="function"==typeof i?i:s,null==t?t:Mi(t,e,n,i)},mn.shuffle=function(t){return(wo(t)?Mn:Ri)(t)},mn.slice=function(t,e,n){var i=null==t?0:t.length;return i?(n&&"number"!=typeof n&&Hr(t,e,n)?(e=0,n=i):(e=null==e?0:zo(e),n=n===s?i:zo(n)),ki(t,e,n)):[]},mn.sortBy=so,mn.sortedUniq=function(t){return t&&t.length?Ni(t):[]},mn.sortedUniqBy=function(t,e){return t&&t.length?Ni(t,Br(e,2)):[]},mn.split=function(t,e,n){return n&&"number"!=typeof n&&Hr(t,e,n)&&(e=n=s),(n=n===s?N:n>>>0)?(t=Ko(t))&&("string"==typeof e||null!=e&&!Bo(e))&&!(e=Li(e))&&Os(t)?Ki(Us(t),0,n):t.split(e,n):[]},mn.spread=function(t,e){if("function"!=typeof t)throw new re(r);return e=null==e?0:zs(zo(e),0),Ti((function(s){var n=s[e],i=Ki(s,0,e);return n&&cs(i,n),es(t,this,i)}))},mn.tail=function(t){var e=null==t?0:t.length;return e?ki(t,1,e):[]},mn.take=function(t,e,n){return t&&t.length?ki(t,0,(e=n||e===s?1:zo(e))<0?0:e):[]},mn.takeRight=function(t,e,n){var i=null==t?0:t.length;return i?ki(t,(e=i-(e=n||e===s?1:zo(e)))<0?0:e,i):[]},mn.takeRightWhile=function(t,e){return t&&t.length?Xi(t,Br(e,3),!1,!0):[]},mn.takeWhile=function(t,e){return t&&t.length?Xi(t,Br(e,3)):[]},mn.tap=function(t,e){return e(t),t},mn.throttle=function(t,e,s){var n=!0,i=!0;if("function"!=typeof t)throw new re(r);return ko(s)&&(n="leading"in s?!!s.leading:n,i="trailing"in s?!!s.trailing:i),ho(t,e,{leading:n,maxWait:e,trailing:i})},mn.thru=Wa,mn.toArray=Wo,mn.toPairs=gh,mn.toPairsIn=yh,mn.toPath=function(t){return wo(t)?ls(t,pa):$o(t)?[t]:ir(fa(Ko(t)))},mn.toPlainObject=qo,mn.transform=function(t,e,s){var n=wo(t),i=n||Ao(t)||Uo(t);if(e=Br(e,4),null==s){var r=t&&t.constructor;s=i?n?new r:[]:ko(t)&&Io(r)?gn(we(t)):{}}return(i?ns:qn)(t,(function(t,n,i){return e(s,t,n,i)})),s},mn.unary=function(t){return io(t,1)},mn.union=ka,mn.unionBy=Da,mn.unionWith=Fa,mn.uniq=function(t){return t&&t.length?Vi(t):[]},mn.uniqBy=function(t,e){return t&&t.length?Vi(t,Br(e,2)):[]},mn.uniqWith=function(t,e){return e="function"==typeof e?e:s,t&&t.length?Vi(t,s,e):[]},mn.unset=function(t,e){return null==t||$i(t,e)},mn.unzip=Oa,mn.unzipWith=Na,mn.update=function(t,e,s){return null==t?t:Ui(t,e,Gi(s))},mn.updateWith=function(t,e,n,i){return i="function"==typeof i?i:s,null==t?t:Ui(t,e,Gi(n),i)},mn.values=vh,mn.valuesIn=function(t){return null==t?[]:Ms(t,ch(t))},mn.without=Ba,mn.words=Ih,mn.wrap=function(t,e){return mo(Gi(e),t)},mn.xor=La,mn.xorBy=Va,mn.xorWith=$a,mn.zip=Ua,mn.zipObject=function(t,e){return ji(t||[],e||[],Pn)},mn.zipObjectDeep=function(t,e){return ji(t||[],e||[],Mi)},mn.zipWith=Xa,mn.entries=gh,mn.entriesIn=yh,mn.extend=Qo,mn.extendWith=Jo,Vh(mn,mn),mn.add=qh,mn.attempt=Ph,mn.camelCase=xh,mn.capitalize=_h,mn.ceil=Kh,mn.clamp=function(t,e,n){return n===s&&(n=e,e=s),n!==s&&(n=(n=Ho(n))==n?n:0),e!==s&&(e=(e=Ho(e))==e?e:0),Nn(Ho(t),e,n)},mn.clone=function(t){return Bn(t,d)},mn.cloneDeep=function(t){return Bn(t,c|d)},mn.cloneDeepWith=function(t,e){return Bn(t,c|d,e="function"==typeof e?e:s)},mn.cloneWith=function(t,e){return Bn(t,d,e="function"==typeof e?e:s)},mn.conformsTo=function(t,e){return null==e||Ln(t,e,lh(e))},mn.deburr=bh,mn.defaultTo=function(t,e){return null==t||t!=t?e:t},mn.divide=Zh,mn.endsWith=function(t,e,n){t=Ko(t),e=Li(e);var i=t.length,r=n=n===s?i:Nn(zo(n),0,i);return(n-=e.length)>=0&&t.slice(n,r)==e},mn.eq=vo,mn.escape=function(t){return(t=Ko(t))&&Tt.test(t)?t.replace(Et,Ds):t},mn.escapeRegExp=function(t){return(t=Ko(t))&&Dt.test(t)?t.replace(kt,"\\$&"):t},mn.every=function(t,e,n){var i=wo(t)?rs:Yn;return n&&Hr(t,e,n)&&(e=s),i(t,Br(e,3))},mn.find=Ga,mn.findIndex=_a,mn.findKey=function(t,e){return ms(t,Br(e,3),qn)},mn.findLast=Ha,mn.findLastIndex=ba,mn.findLastKey=function(t,e){return ms(t,Br(e,3),Kn)},mn.floor=Qh,mn.forEach=qa,mn.forEachRight=Ka,mn.forIn=function(t,e){return null==t?t:Gn(t,Br(e,3),ch)},mn.forInRight=function(t,e){return null==t?t:Hn(t,Br(e,3),ch)},mn.forOwn=function(t,e){return t&&qn(t,Br(e,3))},mn.forOwnRight=function(t,e){return t&&Kn(t,Br(e,3))},mn.get=ih,mn.gt=xo,mn.gte=_o,mn.has=function(t,e){return null!=t&&Wr(t,e,si)},mn.hasIn=rh,mn.head=Ea,mn.identity=Oh,mn.includes=function(t,e,s,n){t=So(t)?t:vh(t),s=s&&!n?zo(s):0;var i=t.length;return s<0&&(s=zs(i+s,0)),Vo(t)?s<=i&&t.indexOf(e,s)>-1:!!i&&ys(t,e,s)>-1},mn.indexOf=function(t,e,s){var n=null==t?0:t.length;if(!n)return-1;var i=null==s?0:zo(s);return i<0&&(i=zs(n+i,0)),ys(t,e,i)},mn.inRange=function(t,e,n){return e=jo(e),n===s?(n=e,e=0):n=jo(n),function(t,e,s){return t>=Gs(e,s)&&t<zs(e,s)}(t=Ho(t),e,n)},mn.invoke=hh,mn.isArguments=bo,mn.isArray=wo,mn.isArrayBuffer=Eo,mn.isArrayLike=So,mn.isArrayLikeObject=To,mn.isBoolean=function(t){return!0===t||!1===t||Do(t)&&ti(t)==Y},mn.isBuffer=Ao,mn.isDate=Co,mn.isElement=function(t){return Do(t)&&1===t.nodeType&&!No(t)},mn.isEmpty=function(t){if(null==t)return!0;if(So(t)&&(wo(t)||"string"==typeof t||"function"==typeof t.splice||Ao(t)||Uo(t)||bo(t)))return!t.length;var e=Yr(t);if(e==q||e==st)return!t.size;if(Qr(t))return!ui(t).length;for(var s in t)if(ue.call(t,s))return!1;return!0},mn.isEqual=function(t,e){return oi(t,e)},mn.isEqualWith=function(t,e,n){var i=(n="function"==typeof n?n:s)?n(t,e):s;return i===s?oi(t,e,s,n):!!i},mn.isError=Mo,mn.isFinite=function(t){return"number"==typeof t&&ps(t)},mn.isFunction=Io,mn.isInteger=Po,mn.isLength=Ro,mn.isMap=Fo,mn.isMatch=function(t,e){return t===e||hi(t,e,Vr(e))},mn.isMatchWith=function(t,e,n){return n="function"==typeof n?n:s,hi(t,e,Vr(e),n)},mn.isNaN=function(t){return Oo(t)&&t!=+t},mn.isNative=function(t){if(Zr(t))throw new Jt(i);return li(t)},mn.isNil=function(t){return null==t},mn.isNull=function(t){return null===t},mn.isNumber=Oo,mn.isObject=ko,mn.isObjectLike=Do,mn.isPlainObject=No,mn.isRegExp=Bo,mn.isSafeInteger=function(t){return Po(t)&&t>=-D&&t<=D},mn.isSet=Lo,mn.isString=Vo,mn.isSymbol=$o,mn.isTypedArray=Uo,mn.isUndefined=function(t){return t===s},mn.isWeakMap=function(t){return Do(t)&&Yr(t)==at},mn.isWeakSet=function(t){return Do(t)&&ti(t)==ot},mn.join=function(t,e){return null==t?"":ws.call(t,e)},mn.kebabCase=wh,mn.last=Ca,mn.lastIndexOf=function(t,e,n){var i=null==t?0:t.length;if(!i)return-1;var r=i;return n!==s&&(r=(r=zo(n))<0?zs(i+r,0):Gs(r,i-1)),e==e?function(t,e,s){for(var n=s+1;n--;)if(t[n]===e)return n;return n}(t,e,r):gs(t,xs,r,!0)},mn.lowerCase=Eh,mn.lowerFirst=Sh,mn.lt=Xo,mn.lte=Yo,mn.max=function(t){return t&&t.length?Wn(t,Oh,ei):s},mn.maxBy=function(t,e){return t&&t.length?Wn(t,Br(e,2),ei):s},mn.mean=function(t){return _s(t,Oh)},mn.meanBy=function(t,e){return _s(t,Br(e,2))},mn.min=function(t){return t&&t.length?Wn(t,Oh,fi):s},mn.minBy=function(t,e){return t&&t.length?Wn(t,Br(e,2),fi):s},mn.stubArray=Gh,mn.stubFalse=Hh,mn.stubObject=function(){return{}},mn.stubString=function(){return""},mn.stubTrue=function(){return!0},mn.multiply=tl,mn.nth=function(t,e){return t&&t.length?vi(t,zo(e)):s},mn.noConflict=function(){return Ye._===this&&(Ye._=ge),this},mn.noop=$h,mn.now=no,mn.pad=function(t,e,s){t=Ko(t);var n=(e=zo(e))?$s(t):0;if(!e||n>=e)return t;var i=(e-n)/2;return xr(je(i),s)+t+xr(We(i),s)},mn.padEnd=function(t,e,s){t=Ko(t);var n=(e=zo(e))?$s(t):0;return e&&n<e?t+xr(e-n,s):t},mn.padStart=function(t,e,s){t=Ko(t);var n=(e=zo(e))?$s(t):0;return e&&n<e?xr(e-n,s)+t:t},mn.parseInt=function(t,e,s){return s||null==e?e=0:e&&(e=+e),qs(Ko(t).replace(Ft,""),e||0)},mn.random=function(t,e,n){if(n&&"boolean"!=typeof n&&Hr(t,e,n)&&(e=n=s),n===s&&("boolean"==typeof e?(n=e,e=s):"boolean"==typeof t&&(n=t,t=s)),t===s&&e===s?(t=0,e=1):(t=jo(t),e===s?(e=t,t=0):e=jo(e)),t>e){var i=t;t=e,e=i}if(n||t%1||e%1){var r=Ks();return Gs(t+r*(e-t+Ve("1e-"+((r+"").length-1))),e)}return Ei(t,e)},mn.reduce=function(t,e,s){var n=wo(t)?us:Es,i=arguments.length<3;return n(t,Br(e,4),s,i,Un)},mn.reduceRight=function(t,e,s){var n=wo(t)?ds:Es,i=arguments.length<3;return n(t,Br(e,4),s,i,Xn)},mn.repeat=function(t,e,n){return e=(n?Hr(t,e,n):e===s)?1:zo(e),Si(Ko(t),e)},mn.replace=function(){var t=arguments,e=Ko(t[0]);return t.length<3?e:e.replace(t[1],t[2])},mn.result=function(t,e,n){var i=-1,r=(e=Hi(e,t)).length;for(r||(r=1,t=s);++i<r;){var a=null==t?s:t[pa(e[i])];a===s&&(i=r,a=n),t=Io(a)?a.call(t):a}return t},mn.round=el,mn.runInContext=t,mn.sample=function(t){return(wo(t)?An:Ai)(t)},mn.size=function(t){if(null==t)return 0;if(So(t))return Vo(t)?$s(t):t.length;var e=Yr(t);return e==q||e==st?t.size:ui(t).length},mn.snakeCase=Th,mn.some=function(t,e,n){var i=wo(t)?fs:Di;return n&&Hr(t,e,n)&&(e=s),i(t,Br(e,3))},mn.sortedIndex=function(t,e){return Fi(t,e)},mn.sortedIndexBy=function(t,e,s){return Oi(t,e,Br(s,2))},mn.sortedIndexOf=function(t,e){var s=null==t?0:t.length;if(s){var n=Fi(t,e);if(n<s&&vo(t[n],e))return n}return-1},mn.sortedLastIndex=function(t,e){return Fi(t,e,!0)},mn.sortedLastIndexBy=function(t,e,s){return Oi(t,e,Br(s,2),!0)},mn.sortedLastIndexOf=function(t,e){if(null==t?0:t.length){var s=Fi(t,e,!0)-1;if(vo(t[s],e))return s}return-1},mn.startCase=Ah,mn.startsWith=function(t,e,s){return t=Ko(t),s=null==s?0:Nn(zo(s),0,t.length),e=Li(e),t.slice(s,s+e.length)==e},mn.subtract=sl,mn.sum=function(t){return t&&t.length?Ss(t,Oh):0},mn.sumBy=function(t,e){return t&&t.length?Ss(t,Br(e,2)):0},mn.template=function(t,e,n){var i=mn.templateSettings;n&&Hr(t,e,n)&&(e=s),t=Ko(t),e=Jo({},e,i,Cr);var r,o,h=Jo({},e.imports,i.imports,Cr),l=lh(h),c=Ms(h,l),u=0,d=e.interpolate||Kt,f="__p += '",p=ne((e.escape||Kt).source+"|"+d.source+"|"+(d===Mt?Xt:Kt).source+"|"+(e.evaluate||Kt).source+"|$","g"),m="//# sourceURL="+(ue.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Oe+"]")+"\n";t.replace(p,(function(e,s,n,i,a,h){return n||(n=i),f+=t.slice(u,h).replace(Zt,Fs),s&&(r=!0,f+="' +\n__e("+s+") +\n'"),a&&(o=!0,f+="';\n"+a+";\n__p += '"),n&&(f+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),u=h+e.length,e})),f+="';\n";var g=ue.call(e,"variable")&&e.variable;if(g){if($t.test(g))throw new Jt(a)}else f="with (obj) {\n"+f+"\n}\n";f=(o?f.replace(xt,""):f).replace(_t,"$1").replace(bt,"$1;"),f="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(r?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var y=Ph((function(){return te(l,m+"return "+f).apply(s,c)}));if(y.source=f,Mo(y))throw y;return y},mn.times=function(t,e){if((t=zo(t))<1||t>D)return[];var s=N,n=Gs(t,N);e=Br(e),t-=N;for(var i=Ts(n,e);++s<t;)e(s);return i},mn.toFinite=jo,mn.toInteger=zo,mn.toLength=Go,mn.toLower=function(t){return Ko(t).toLowerCase()},mn.toNumber=Ho,mn.toSafeInteger=function(t){return t?Nn(zo(t),-D,D):0===t?t:0},mn.toString=Ko,mn.toUpper=function(t){return Ko(t).toUpperCase()},mn.trim=function(t,e,n){if((t=Ko(t))&&(n||e===s))return As(t);if(!t||!(e=Li(e)))return t;var i=Us(t),r=Us(e);return Ki(i,Ps(i,r),Rs(i,r)+1).join("")},mn.trimEnd=function(t,e,n){if((t=Ko(t))&&(n||e===s))return t.slice(0,Xs(t)+1);if(!t||!(e=Li(e)))return t;var i=Us(t);return Ki(i,0,Rs(i,Us(e))+1).join("")},mn.trimStart=function(t,e,n){if((t=Ko(t))&&(n||e===s))return t.replace(Ft,"");if(!t||!(e=Li(e)))return t;var i=Us(t);return Ki(i,Ps(i,Us(e))).join("")},mn.truncate=function(t,e){var n=A,i=C;if(ko(e)){var r="separator"in e?e.separator:r;n="length"in e?zo(e.length):n,i="omission"in e?Li(e.omission):i}var a=(t=Ko(t)).length;if(Os(t)){var o=Us(t);a=o.length}if(n>=a)return t;var h=n-$s(i);if(h<1)return i;var l=o?Ki(o,0,h).join(""):t.slice(0,h);if(r===s)return l+i;if(o&&(h+=l.length-h),Bo(r)){if(t.slice(h).search(r)){var c,u=l;for(r.global||(r=ne(r.source,Ko(Yt.exec(r))+"g")),r.lastIndex=0;c=r.exec(u);)var d=c.index;l=l.slice(0,d===s?h:d)}}else if(t.indexOf(Li(r),h)!=h){var f=l.lastIndexOf(r);f>-1&&(l=l.slice(0,f))}return l+i},mn.unescape=function(t){return(t=Ko(t))&&St.test(t)?t.replace(wt,Ys):t},mn.uniqueId=function(t){var e=++de;return Ko(t)+e},mn.upperCase=Ch,mn.upperFirst=Mh,mn.each=qa,mn.eachRight=Ka,mn.first=Ea,Vh(mn,(Jh={},qn(mn,(function(t,e){ue.call(mn.prototype,e)||(Jh[e]=t)})),Jh),{chain:!1}),mn.VERSION="4.17.21",ns(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){mn[t].placeholder=mn})),ns(["drop","take"],(function(t,e){xn.prototype[t]=function(n){n=n===s?1:zs(zo(n),0);var i=this.__filtered__&&!e?new xn(this):this.clone();return i.__filtered__?i.__takeCount__=Gs(n,i.__takeCount__):i.__views__.push({size:Gs(n,N),type:t+(i.__dir__<0?"Right":"")}),i},xn.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),ns(["filter","map","takeWhile"],(function(t,e){var s=e+1,n=s==P||3==s;xn.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:Br(t,3),type:s}),e.__filtered__=e.__filtered__||n,e}})),ns(["head","last"],(function(t,e){var s="take"+(e?"Right":"");xn.prototype[t]=function(){return this[s](1).value()[0]}})),ns(["initial","tail"],(function(t,e){var s="drop"+(e?"":"Right");xn.prototype[t]=function(){return this.__filtered__?new xn(this):this[s](1)}})),xn.prototype.compact=function(){return this.filter(Oh)},xn.prototype.find=function(t){return this.filter(t).head()},xn.prototype.findLast=function(t){return this.reverse().find(t)},xn.prototype.invokeMap=Ti((function(t,e){return"function"==typeof t?new xn(this):this.map((function(s){return ri(s,t,e)}))})),xn.prototype.reject=function(t){return this.filter(fo(Br(t)))},xn.prototype.slice=function(t,e){t=zo(t);var n=this;return n.__filtered__&&(t>0||e<0)?new xn(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==s&&(n=(e=zo(e))<0?n.dropRight(-e):n.take(e-t)),n)},xn.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},xn.prototype.toArray=function(){return this.take(N)},qn(xn.prototype,(function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),i=/^(?:head|last)$/.test(e),r=mn[i?"take"+("last"==e?"Right":""):e],a=i||/^find/.test(e);r&&(mn.prototype[e]=function(){var e=this.__wrapped__,o=i?[1]:arguments,h=e instanceof xn,l=o[0],c=h||wo(e),u=function(t){var e=r.apply(mn,cs([t],o));return i&&d?e[0]:e};c&&n&&"function"==typeof l&&1!=l.length&&(h=c=!1);var d=this.__chain__,f=!!this.__actions__.length,p=a&&!d,m=h&&!f;if(!a&&c){e=m?e:new xn(this);var g=t.apply(e,o);return g.__actions__.push({func:Wa,args:[u],thisArg:s}),new vn(g,d)}return p&&m?t.apply(this,o):(g=this.thru(u),p?i?g.value()[0]:g.value():g)})})),ns(["pop","push","shift","sort","splice","unshift"],(function(t){var e=ae[t],s=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",n=/^(?:pop|shift)$/.test(t);mn.prototype[t]=function(){var t=arguments;if(n&&!this.__chain__){var i=this.value();return e.apply(wo(i)?i:[],t)}return this[s]((function(s){return e.apply(wo(s)?s:[],t)}))}})),qn(xn.prototype,(function(t,e){var s=mn[e];if(s){var n=s.name+"";ue.call(an,n)||(an[n]=[]),an[n].push({name:e,func:s})}})),an[mr(s,y).name]=[{name:"wrapper",func:s}],xn.prototype.clone=function(){var t=new xn(this.__wrapped__);return t.__actions__=ir(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=ir(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=ir(this.__views__),t},xn.prototype.reverse=function(){if(this.__filtered__){var t=new xn(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},xn.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,s=wo(t),n=e<0,i=s?t.length:0,r=function(t,e,s){var n=-1,i=s.length;for(;++n<i;){var r=s[n],a=r.size;switch(r.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=Gs(e,t+a);break;case"takeRight":t=zs(t,e-a)}}return{start:t,end:e}}(0,i,this.__views__),a=r.start,o=r.end,h=o-a,l=n?o:a-1,c=this.__iteratees__,u=c.length,d=0,f=Gs(h,this.__takeCount__);if(!s||!n&&i==h&&f==h)return Yi(t,this.__actions__);var p=[];t:for(;h--&&d<f;){for(var m=-1,g=t[l+=e];++m<u;){var y=c[m],v=y.iteratee,x=y.type,_=v(g);if(x==R)g=_;else if(!_){if(x==P)continue t;break t}}p[d++]=g}return p},mn.prototype.at=ja,mn.prototype.chain=function(){return Ya(this)},mn.prototype.commit=function(){return new vn(this.value(),this.__chain__)},mn.prototype.next=function(){this.__values__===s&&(this.__values__=Wo(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?s:this.__values__[this.__index__++]}},mn.prototype.plant=function(t){for(var e,n=this;n instanceof yn;){var i=ga(n);i.__index__=0,i.__values__=s,e?r.__wrapped__=i:e=i;var r=i;n=n.__wrapped__}return r.__wrapped__=t,e},mn.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof xn){var e=t;return this.__actions__.length&&(e=new xn(this)),(e=e.reverse()).__actions__.push({func:Wa,args:[Ra],thisArg:s}),new vn(e,this.__chain__)}return this.thru(Ra)},mn.prototype.toJSON=mn.prototype.valueOf=mn.prototype.value=function(){return Yi(this.__wrapped__,this.__actions__)},mn.prototype.first=mn.prototype.head,Ce&&(mn.prototype[Ce]=function(){return this}),mn}();je?((je.exports=Ws)._=Ws,We._=Ws):Ye._=Ws}).call(m)}({get exports(){return pA},set exports(t){pA=t}},pA);class mA extends TS{constructor(){super("SPage1"),d(this,"page1",pgame.gui.page1),d(this,"btnGift",this.page1.btnGift)}enter(){this.btnGift.setOnClick((()=>{this.btnGift.setOnClick(!1),this.page1.isOpen=!0,setTimeout((()=>{this.setNext("SPage2")}),1500)}))}exit(){this.page1.visible=!1}}class gA extends TS{constructor(){super("SPage2"),d(this,"page2",pgame.gui.page2)}enter(){console.log("SPAGE 2"),this.page2.visible=!0,this.page2.twGiftTransition1()}update(){}exit(){}animOpenGift(){}}class yA extends SS{constructor(t){super({view:t,autoStart:!0,sharedTicker:!0,autoDensity:!0,antialias:!0,backgroundAlpha:0,backgroundRect:!0}),d(this,"interact",new Pg),d(this,"data"),d(this,"ce",tr),d(this,"title"),d(this,"gui"),d(this,"music"),d(this,"sound"),d(this,"vueLeftHandedMode",!1),d(this,"balanceDecreases"),d(this,"nonWinning"),d(this,"countNonWinning"),d(this,"controlCaseGS",!1),d(this,"controlCaseWild",!1),globalThis.pgame=this,this.ticker.minFPS=30,this.assets.prepareLoading(),this.assets.onPreprocessAssetList=t=>{},this.assets.addCSSFont("Anastasia",void 0,"abc"),this.assets.addCSSFont("Standly",void 0,"abc"),this.data=new y,this.addState(new lA),this.setState("Loading"),this.startLoop(),this.loadAssets().then((()=>(this.initSounds(),this.interact.listenKeyboard(document),this.setLocale(API.locale.value),this.addScenes(...function(){const t=new fA;return pgame.gui=t,pgame.stage.addObj(t),[]}()),this.addState(new mA),this.addState(new gA),this.setGameAPI(),window.addEventListener("message",this.updateBalanceListener.bind(this)),this.state("Loading").isGameInitialized=!0,this)))}mainLoop(t){let e=this.currState.runFSM(t);""!=e&&this.setState(e),this.stage.update(t)}detectStyleAndResize(t,e){t>=e?"landscape"!=this.currStyle.name&&this.applyLandscape():"portrait"!=this.currStyle.name&&this.applyPortrait(),this.resizeAppView(t,e)}resizeAppView(t,e){let s=t,n=e;t*this.desiredRatio<=e?n=s*this.desiredRatio:s=n/this.desiredRatio,this.renderer.resize(s,n),this.stage.scale.set(s/this.desiredWidth,n/this.desiredHeight)}prepareStyle(){this.stage.tweens.endAll();const t=this.currStyle.Resolution;this.setResolution(t[0],t[1])}applyLandscape(){this.setViewStyle("landscape"),this.prepareStyle(),this.useCurrentViewStlye(),API.isLandscape.value=!0}applyPortrait(){this.setViewStyle("portrait"),this.prepareStyle(),this.useCurrentViewStlye(),API.isLandscape.value=!1}initSounds(){var t,e;this.music=this.soundManager.setGroup("music",v),this.sound=this.soundManager.setGroup("sound",x),this.soundManager.setMutexGroup("bg",Object.values(this.music)),t=this.music,e=this.sound,t.Bg.volume=.3,t.Bg.loop=!0,t.Bg.fadeIn=t.Bg.fadeOut=1e3,t.Bg.mutexPause=!0,e.Click.volume=3.3,e.CoinIncrement.fadeOut=500,e.Hint.volume=2}setGameAPI(){p(API.locale,(t=>{this.setLocale(t),this.useCurrentLocale()})),p(API.volume,(t=>{this.soundManager.volumeAll=t}),{immediate:!0}),p([API.musicMuted,API.soundMuted],(([t,e])=>{const s=this.soundManager.groups.music,n=this.soundManager.groups.sound;s.muted=t,n.muted=e}),{immediate:!0})}updateBalanceListener(t){if(null!=t.data&&"EVO:REFRESH_BALANCE"==t.data.command&&null!=t.data.expectedBalance&&!isNaN(t.data.expectedBalance)){const e=this.gui.tweens.getByName("win");e&&e.stop(),this.data.realCredits=t.data.expectedBalance,this.data.syncCredits()}}}export{yA as MainGame,Zy as vb};
